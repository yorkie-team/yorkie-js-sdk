(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5149:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>nF});var n=r(2421),i=r(3616),s=r(2235),a=r(6128),o=r(6037),c=r(6772),l=r(6111),h=r(7727),d=r(2998),u=r(7048),f=function(e){return e[e.NULL=0]="NULL",e[e.BOOLEAN=1]="BOOLEAN",e[e.INTEGER=2]="INTEGER",e[e.LONG=3]="LONG",e[e.DOUBLE=4]="DOUBLE",e[e.STRING=5]="STRING",e[e.BYTES=6]="BYTES",e[e.DATE=7]="DATE",e[e.JSON_OBJECT=8]="JSON_OBJECT",e[e.JSON_ARRAY=9]="JSON_ARRAY",e[e.TEXT=10]="TEXT",e[e.INTEGER_CNT=11]="INTEGER_CNT",e[e.LONG_CNT=12]="LONG_CNT",e[e.TREE=13]="TREE",e}({});l.C.util.setEnumType(f,"yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER"},{no:3,name:"VALUE_TYPE_LONG"},{no:4,name:"VALUE_TYPE_DOUBLE"},{no:5,name:"VALUE_TYPE_STRING"},{no:6,name:"VALUE_TYPE_BYTES"},{no:7,name:"VALUE_TYPE_DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE"}]);var g=function(e){return e[e.DOCUMENT_CHANGED=0]="DOCUMENT_CHANGED",e[e.DOCUMENT_WATCHED=1]="DOCUMENT_WATCHED",e[e.DOCUMENT_UNWATCHED=2]="DOCUMENT_UNWATCHED",e[e.DOCUMENT_BROADCAST=3]="DOCUMENT_BROADCAST",e}({});l.C.util.setEnumType(g,"yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST"}]);class m extends c.Q{static fromBinary(e,t){return new m().fromBinary(e,t)}static fromJson(e,t){return new m().fromJson(e,t)}static fromJsonString(e,t){return new m().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(m,e,t)}constructor(e){super(),this.presences={},l.C.util.initPartial(e,this)}}m.runtime=l.C,m.typeName="yorkie.v1.Snapshot",m.fields=l.C.util.newFieldList(()=>[{no:1,name:"root",kind:"message",T:N},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:ei}}]);class p extends c.Q{static fromBinary(e,t){return new p().fromBinary(e,t)}static fromJson(e,t){return new p().fromJson(e,t)}static fromJsonString(e,t){return new p().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(p,e,t)}constructor(e){super(),this.documentKey="",this.snapshot=new Uint8Array(0),this.changes=[],this.isRemoved=!1,l.C.util.initPartial(e,this)}}p.runtime=l.C,p.typeName="yorkie.v1.ChangePack",p.fields=l.C.util.newFieldList(()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:ea},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:y,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:ec},{no:6,name:"is_removed",kind:"scalar",T:8},{no:7,name:"version_vector",kind:"message",T:C}]);class y extends c.Q{static fromBinary(e,t){return new y().fromBinary(e,t)}static fromJson(e,t){return new y().fromJson(e,t)}static fromJsonString(e,t){return new y().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(y,e,t)}constructor(e){super(),this.message="",this.operations=[],l.C.util.initPartial(e,this)}}y.runtime=l.C,y.typeName="yorkie.v1.Change",y.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:v},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:w,repeated:!0},{no:4,name:"presence_change",kind:"message",T:er}]);class v extends c.Q{static fromBinary(e,t){return new v().fromBinary(e,t)}static fromJson(e,t){return new v().fromJson(e,t)}static fromJsonString(e,t){return new v().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(v,e,t)}constructor(e){super(),this.clientSeq=0,this.serverSeq=h.M.zero,this.lamport=h.M.zero,this.actorId=new Uint8Array(0),l.C.util.initPartial(e,this)}}v.runtime=l.C,v.typeName="yorkie.v1.ChangeID",v.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3},{no:3,name:"lamport",kind:"scalar",T:3},{no:4,name:"actor_id",kind:"scalar",T:12},{no:5,name:"version_vector",kind:"message",T:C}]);class C extends c.Q{static fromBinary(e,t){return new C().fromBinary(e,t)}static fromJson(e,t){return new C().fromJson(e,t)}static fromJsonString(e,t){return new C().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(C,e,t)}constructor(e){super(),this.vector={},l.C.util.initPartial(e,this)}}C.runtime=l.C,C.typeName="yorkie.v1.VersionVector",C.fields=l.C.util.newFieldList(()=>[{no:1,name:"vector",kind:"map",K:9,V:{kind:"scalar",T:3}}]);class w extends c.Q{static fromBinary(e,t){return new w().fromBinary(e,t)}static fromJson(e,t){return new w().fromJson(e,t)}static fromJsonString(e,t){return new w().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(w,e,t)}constructor(e){super(),this.body={case:void 0},l.C.util.initPartial(e,this)}}w.runtime=l.C,w.typeName="yorkie.v1.Operation",w.fields=l.C.util.newFieldList(()=>[{no:1,name:"set",kind:"message",T:A,oneof:"body"},{no:2,name:"add",kind:"message",T:S,oneof:"body"},{no:3,name:"move",kind:"message",T:T,oneof:"body"},{no:4,name:"remove",kind:"message",T:x,oneof:"body"},{no:5,name:"edit",kind:"message",T:I,oneof:"body"},{no:7,name:"style",kind:"message",T:b,oneof:"body"},{no:8,name:"increase",kind:"message",T:k,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:P,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:E,oneof:"body"},{no:11,name:"array_set",kind:"message",T:D,oneof:"body"}]);class A extends c.Q{static fromBinary(e,t){return new A().fromBinary(e,t)}static fromJson(e,t){return new A().fromJson(e,t)}static fromJsonString(e,t){return new A().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(A,e,t)}constructor(e){super(),this.key="",l.C.util.initPartial(e,this)}}A.runtime=l.C,A.typeName="yorkie.v1.Operation.Set",A.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:R},{no:4,name:"executed_at",kind:"message",T:ec}]);class S extends c.Q{static fromBinary(e,t){return new S().fromBinary(e,t)}static fromJson(e,t){return new S().fromJson(e,t)}static fromJsonString(e,t){return new S().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(S,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}S.runtime=l.C,S.typeName="yorkie.v1.Operation.Add",S.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"prev_created_at",kind:"message",T:ec},{no:3,name:"value",kind:"message",T:R},{no:4,name:"executed_at",kind:"message",T:ec}]);class T extends c.Q{static fromBinary(e,t){return new T().fromBinary(e,t)}static fromJson(e,t){return new T().fromJson(e,t)}static fromJsonString(e,t){return new T().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(T,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}T.runtime=l.C,T.typeName="yorkie.v1.Operation.Move",T.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"prev_created_at",kind:"message",T:ec},{no:3,name:"created_at",kind:"message",T:ec},{no:4,name:"executed_at",kind:"message",T:ec}]);class x extends c.Q{static fromBinary(e,t){return new x().fromBinary(e,t)}static fromJson(e,t){return new x().fromJson(e,t)}static fromJsonString(e,t){return new x().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(x,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}x.runtime=l.C,x.typeName="yorkie.v1.Operation.Remove",x.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"created_at",kind:"message",T:ec},{no:3,name:"executed_at",kind:"message",T:ec}]);class I extends c.Q{static fromBinary(e,t){return new I().fromBinary(e,t)}static fromJson(e,t){return new I().fromJson(e,t)}static fromJsonString(e,t){return new I().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(I,e,t)}constructor(e){super(),this.createdAtMapByActor={},this.content="",this.attributes={},l.C.util.initPartial(e,this)}}I.runtime=l.C,I.typeName="yorkie.v1.Operation.Edit",I.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"from",kind:"message",T:eo},{no:3,name:"to",kind:"message",T:eo},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:ec}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:ec},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class b extends c.Q{static fromBinary(e,t){return new b().fromBinary(e,t)}static fromJson(e,t){return new b().fromJson(e,t)}static fromJsonString(e,t){return new b().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(b,e,t)}constructor(e){super(),this.attributes={},this.createdAtMapByActor={},l.C.util.initPartial(e,this)}}b.runtime=l.C,b.typeName="yorkie.v1.Operation.Style",b.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"from",kind:"message",T:eo},{no:3,name:"to",kind:"message",T:eo},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:ec},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:ec}}]);class k extends c.Q{static fromBinary(e,t){return new k().fromBinary(e,t)}static fromJson(e,t){return new k().fromJson(e,t)}static fromJsonString(e,t){return new k().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(k,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}k.runtime=l.C,k.typeName="yorkie.v1.Operation.Increase",k.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"value",kind:"message",T:R},{no:3,name:"executed_at",kind:"message",T:ec}]);class P extends c.Q{static fromBinary(e,t){return new P().fromBinary(e,t)}static fromJson(e,t){return new P().fromJson(e,t)}static fromJsonString(e,t){return new P().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(P,e,t)}constructor(e){super(),this.createdAtMapByActor={},this.contents=[],this.splitLevel=0,l.C.util.initPartial(e,this)}}P.runtime=l.C,P.typeName="yorkie.v1.Operation.TreeEdit",P.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"from",kind:"message",T:Q},{no:3,name:"to",kind:"message",T:Q},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:ec}},{no:5,name:"contents",kind:"message",T:j,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:ec}]);class E extends c.Q{static fromBinary(e,t){return new E().fromBinary(e,t)}static fromJson(e,t){return new E().fromJson(e,t)}static fromJsonString(e,t){return new E().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(E,e,t)}constructor(e){super(),this.attributes={},this.attributesToRemove=[],this.createdAtMapByActor={},l.C.util.initPartial(e,this)}}E.runtime=l.C,E.typeName="yorkie.v1.Operation.TreeStyle",E.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"from",kind:"message",T:Q},{no:3,name:"to",kind:"message",T:Q},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:ec},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:ec}}]);class D extends c.Q{static fromBinary(e,t){return new D().fromBinary(e,t)}static fromJson(e,t){return new D().fromJson(e,t)}static fromJsonString(e,t){return new D().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(D,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}D.runtime=l.C,D.typeName="yorkie.v1.Operation.ArraySet",D.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:ec},{no:2,name:"created_at",kind:"message",T:ec},{no:3,name:"value",kind:"message",T:R},{no:4,name:"executed_at",kind:"message",T:ec}]);class R extends c.Q{static fromBinary(e,t){return new R().fromBinary(e,t)}static fromJson(e,t){return new R().fromJson(e,t)}static fromJsonString(e,t){return new R().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(R,e,t)}constructor(e){super(),this.type=0,this.value=new Uint8Array(0),l.C.util.initPartial(e,this)}}R.runtime=l.C,R.typeName="yorkie.v1.JSONElementSimple",R.fields=l.C.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:ec},{no:2,name:"moved_at",kind:"message",T:ec},{no:3,name:"removed_at",kind:"message",T:ec},{no:4,name:"type",kind:"enum",T:l.C.getEnumType(f)},{no:5,name:"value",kind:"scalar",T:12}]);class N extends c.Q{static fromBinary(e,t){return new N().fromBinary(e,t)}static fromJson(e,t){return new N().fromJson(e,t)}static fromJsonString(e,t){return new N().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(N,e,t)}constructor(e){super(),this.body={case:void 0},l.C.util.initPartial(e,this)}}N.runtime=l.C,N.typeName="yorkie.v1.JSONElement",N.fields=l.C.util.newFieldList(()=>[{no:1,name:"json_object",kind:"message",T:B,oneof:"body"},{no:2,name:"json_array",kind:"message",T:J,oneof:"body"},{no:3,name:"primitive",kind:"message",T:O,oneof:"body"},{no:5,name:"text",kind:"message",T:_,oneof:"body"},{no:6,name:"counter",kind:"message",T:L,oneof:"body"},{no:7,name:"tree",kind:"message",T:z,oneof:"body"}]);class B extends c.Q{static fromBinary(e,t){return new B().fromBinary(e,t)}static fromJson(e,t){return new B().fromJson(e,t)}static fromJsonString(e,t){return new B().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(B,e,t)}constructor(e){super(),this.nodes=[],l.C.util.initPartial(e,this)}}B.runtime=l.C,B.typeName="yorkie.v1.JSONElement.JSONObject",B.fields=l.C.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:q,repeated:!0},{no:2,name:"created_at",kind:"message",T:ec},{no:3,name:"moved_at",kind:"message",T:ec},{no:4,name:"removed_at",kind:"message",T:ec}]);class J extends c.Q{static fromBinary(e,t){return new J().fromBinary(e,t)}static fromJson(e,t){return new J().fromJson(e,t)}static fromJsonString(e,t){return new J().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(J,e,t)}constructor(e){super(),this.nodes=[],l.C.util.initPartial(e,this)}}J.runtime=l.C,J.typeName="yorkie.v1.JSONElement.JSONArray",J.fields=l.C.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:M,repeated:!0},{no:2,name:"created_at",kind:"message",T:ec},{no:3,name:"moved_at",kind:"message",T:ec},{no:4,name:"removed_at",kind:"message",T:ec}]);class O extends c.Q{static fromBinary(e,t){return new O().fromBinary(e,t)}static fromJson(e,t){return new O().fromJson(e,t)}static fromJsonString(e,t){return new O().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(O,e,t)}constructor(e){super(),this.type=0,this.value=new Uint8Array(0),l.C.util.initPartial(e,this)}}O.runtime=l.C,O.typeName="yorkie.v1.JSONElement.Primitive",O.fields=l.C.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:l.C.getEnumType(f)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:ec},{no:4,name:"moved_at",kind:"message",T:ec},{no:5,name:"removed_at",kind:"message",T:ec}]);class _ extends c.Q{static fromBinary(e,t){return new _().fromBinary(e,t)}static fromJson(e,t){return new _().fromJson(e,t)}static fromJsonString(e,t){return new _().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(_,e,t)}constructor(e){super(),this.nodes=[],l.C.util.initPartial(e,this)}}_.runtime=l.C,_.typeName="yorkie.v1.JSONElement.Text",_.fields=l.C.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:F,repeated:!0},{no:2,name:"created_at",kind:"message",T:ec},{no:3,name:"moved_at",kind:"message",T:ec},{no:4,name:"removed_at",kind:"message",T:ec}]);class L extends c.Q{static fromBinary(e,t){return new L().fromBinary(e,t)}static fromJson(e,t){return new L().fromJson(e,t)}static fromJsonString(e,t){return new L().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(L,e,t)}constructor(e){super(),this.type=0,this.value=new Uint8Array(0),l.C.util.initPartial(e,this)}}L.runtime=l.C,L.typeName="yorkie.v1.JSONElement.Counter",L.fields=l.C.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:l.C.getEnumType(f)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:ec},{no:4,name:"moved_at",kind:"message",T:ec},{no:5,name:"removed_at",kind:"message",T:ec}]);class z extends c.Q{static fromBinary(e,t){return new z().fromBinary(e,t)}static fromJson(e,t){return new z().fromJson(e,t)}static fromJsonString(e,t){return new z().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(z,e,t)}constructor(e){super(),this.nodes=[],l.C.util.initPartial(e,this)}}z.runtime=l.C,z.typeName="yorkie.v1.JSONElement.Tree",z.fields=l.C.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:V,repeated:!0},{no:2,name:"created_at",kind:"message",T:ec},{no:3,name:"moved_at",kind:"message",T:ec},{no:4,name:"removed_at",kind:"message",T:ec}]);class q extends c.Q{static fromBinary(e,t){return new q().fromBinary(e,t)}static fromJson(e,t){return new q().fromJson(e,t)}static fromJsonString(e,t){return new q().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(q,e,t)}constructor(e){super(),this.key="",l.C.util.initPartial(e,this)}}q.runtime=l.C,q.typeName="yorkie.v1.RHTNode",q.fields=l.C.util.newFieldList(()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:N}]);class M extends c.Q{static fromBinary(e,t){return new M().fromBinary(e,t)}static fromJson(e,t){return new M().fromJson(e,t)}static fromJsonString(e,t){return new M().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(M,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}M.runtime=l.C,M.typeName="yorkie.v1.RGANode",M.fields=l.C.util.newFieldList(()=>[{no:1,name:"next",kind:"message",T:M},{no:2,name:"element",kind:"message",T:N}]);class K extends c.Q{static fromBinary(e,t){return new K().fromBinary(e,t)}static fromJson(e,t){return new K().fromJson(e,t)}static fromJsonString(e,t){return new K().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(K,e,t)}constructor(e){super(),this.value="",this.isRemoved=!1,l.C.util.initPartial(e,this)}}K.runtime=l.C,K.typeName="yorkie.v1.NodeAttr",K.fields=l.C.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:ec},{no:3,name:"is_removed",kind:"scalar",T:8}]);class F extends c.Q{static fromBinary(e,t){return new F().fromBinary(e,t)}static fromJson(e,t){return new F().fromJson(e,t)}static fromJsonString(e,t){return new F().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(F,e,t)}constructor(e){super(),this.value="",this.attributes={},l.C.util.initPartial(e,this)}}F.runtime=l.C,F.typeName="yorkie.v1.TextNode",F.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:U},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:ec},{no:4,name:"ins_prev_id",kind:"message",T:U},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:K}}]);class U extends c.Q{static fromBinary(e,t){return new U().fromBinary(e,t)}static fromJson(e,t){return new U().fromJson(e,t)}static fromJsonString(e,t){return new U().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(U,e,t)}constructor(e){super(),this.offset=0,l.C.util.initPartial(e,this)}}U.runtime=l.C,U.typeName="yorkie.v1.TextNodeID",U.fields=l.C.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:ec},{no:2,name:"offset",kind:"scalar",T:5}]);class V extends c.Q{static fromBinary(e,t){return new V().fromBinary(e,t)}static fromJson(e,t){return new V().fromJson(e,t)}static fromJsonString(e,t){return new V().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(V,e,t)}constructor(e){super(),this.type="",this.value="",this.depth=0,this.attributes={},l.C.util.initPartial(e,this)}}V.runtime=l.C,V.typeName="yorkie.v1.TreeNode",V.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:W},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:ec},{no:5,name:"ins_prev_id",kind:"message",T:W},{no:6,name:"ins_next_id",kind:"message",T:W},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:K}}]);class j extends c.Q{static fromBinary(e,t){return new j().fromBinary(e,t)}static fromJson(e,t){return new j().fromJson(e,t)}static fromJsonString(e,t){return new j().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(j,e,t)}constructor(e){super(),this.content=[],l.C.util.initPartial(e,this)}}j.runtime=l.C,j.typeName="yorkie.v1.TreeNodes",j.fields=l.C.util.newFieldList(()=>[{no:1,name:"content",kind:"message",T:V,repeated:!0}]);class W extends c.Q{static fromBinary(e,t){return new W().fromBinary(e,t)}static fromJson(e,t){return new W().fromJson(e,t)}static fromJsonString(e,t){return new W().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(W,e,t)}constructor(e){super(),this.offset=0,l.C.util.initPartial(e,this)}}W.runtime=l.C,W.typeName="yorkie.v1.TreeNodeID",W.fields=l.C.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:ec},{no:2,name:"offset",kind:"scalar",T:5}]);class Q extends c.Q{static fromBinary(e,t){return new Q().fromBinary(e,t)}static fromJson(e,t){return new Q().fromJson(e,t)}static fromJsonString(e,t){return new Q().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(Q,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}Q.runtime=l.C,Q.typeName="yorkie.v1.TreePos",Q.fields=l.C.util.newFieldList(()=>[{no:1,name:"parent_id",kind:"message",T:W},{no:2,name:"left_sibling_id",kind:"message",T:W}]);class G extends c.Q{static fromBinary(e,t){return new G().fromBinary(e,t)}static fromJson(e,t){return new G().fromJson(e,t)}static fromJsonString(e,t){return new G().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(G,e,t)}constructor(e){super(),this.id="",this.authProvider="",this.username="",l.C.util.initPartial(e,this)}}G.runtime=l.C,G.typeName="yorkie.v1.User",G.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"auth_provider",kind:"scalar",T:9},{no:3,name:"username",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:d.D}]);class H extends c.Q{static fromBinary(e,t){return new H().fromBinary(e,t)}static fromJson(e,t){return new H().fromJson(e,t)}static fromJsonString(e,t){return new H().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(H,e,t)}constructor(e){super(),this.id="",this.name="",this.publicKey="",this.secretKey="",this.authWebhookUrl="",this.authWebhookMethods=[],this.authWebhookMaxRetries=h.M.zero,this.authWebhookMinWaitInterval="",this.authWebhookMaxWaitInterval="",this.authWebhookRequestTimeout="",this.eventWebhookUrl="",this.eventWebhookEvents=[],this.eventWebhookMaxRetries=h.M.zero,this.eventWebhookMinWaitInterval="",this.eventWebhookMaxWaitInterval="",this.eventWebhookRequestTimeout="",this.clientDeactivateThreshold="",this.snapshotThreshold=h.M.zero,this.snapshotInterval=h.M.zero,this.maxSubscribersPerDocument=0,this.maxAttachmentsPerDocument=0,this.maxSizePerDocument=0,this.removeOnDetach=!1,this.autoRevisionEnabled=!1,this.allowedOrigins=[],l.C.util.initPartial(e,this)}}H.runtime=l.C,H.typeName="yorkie.v1.Project",H.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:17,name:"auth_webhook_max_retries",kind:"scalar",T:4},{no:18,name:"auth_webhook_min_wait_interval",kind:"scalar",T:9},{no:19,name:"auth_webhook_max_wait_interval",kind:"scalar",T:9},{no:20,name:"auth_webhook_request_timeout",kind:"scalar",T:9},{no:7,name:"event_webhook_url",kind:"scalar",T:9},{no:8,name:"event_webhook_events",kind:"scalar",T:9,repeated:!0},{no:21,name:"event_webhook_max_retries",kind:"scalar",T:4},{no:22,name:"event_webhook_min_wait_interval",kind:"scalar",T:9},{no:23,name:"event_webhook_max_wait_interval",kind:"scalar",T:9},{no:24,name:"event_webhook_request_timeout",kind:"scalar",T:9},{no:9,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:25,name:"snapshot_threshold",kind:"scalar",T:3},{no:26,name:"snapshot_interval",kind:"scalar",T:3},{no:10,name:"max_subscribers_per_document",kind:"scalar",T:5},{no:11,name:"max_attachments_per_document",kind:"scalar",T:5},{no:15,name:"max_size_per_document",kind:"scalar",T:5},{no:16,name:"remove_on_detach",kind:"scalar",T:8},{no:27,name:"auto_revision_enabled",kind:"scalar",T:8},{no:14,name:"allowed_origins",kind:"scalar",T:9,repeated:!0},{no:12,name:"created_at",kind:"message",T:d.D},{no:13,name:"updated_at",kind:"message",T:d.D}]);class Y extends c.Q{static fromBinary(e,t){return new Y().fromBinary(e,t)}static fromJson(e,t){return new Y().fromJson(e,t)}static fromJsonString(e,t){return new Y().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(Y,e,t)}constructor(e){super(),this.timestamp=h.M.zero,this.value=0,l.C.util.initPartial(e,this)}}Y.runtime=l.C,Y.typeName="yorkie.v1.MetricPoint",Y.fields=l.C.util.newFieldList(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"value",kind:"scalar",T:5}]);class X extends c.Q{static fromBinary(e,t){return new X().fromBinary(e,t)}static fromJson(e,t){return new X().fromJson(e,t)}static fromJsonString(e,t){return new X().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(X,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}X.runtime=l.C,X.typeName="yorkie.v1.UpdatableProjectFields",X.fields=l.C.util.newFieldList(()=>[{no:1,name:"name",kind:"message",T:u.hU},{no:2,name:"auth_webhook_url",kind:"message",T:u.hU},{no:3,name:"auth_webhook_methods",kind:"message",T:$},{no:12,name:"auth_webhook_max_retries",kind:"message",T:u.ol},{no:13,name:"auth_webhook_min_wait_interval",kind:"message",T:u.hU},{no:14,name:"auth_webhook_max_wait_interval",kind:"message",T:u.hU},{no:15,name:"auth_webhook_request_timeout",kind:"message",T:u.hU},{no:4,name:"event_webhook_url",kind:"message",T:u.hU},{no:5,name:"event_webhook_events",kind:"message",T:Z},{no:16,name:"event_webhook_max_retries",kind:"message",T:u.ol},{no:17,name:"event_webhook_min_wait_interval",kind:"message",T:u.hU},{no:18,name:"event_webhook_max_wait_interval",kind:"message",T:u.hU},{no:19,name:"event_webhook_request_timeout",kind:"message",T:u.hU},{no:20,name:"snapshot_threshold",kind:"message",T:u.j1},{no:21,name:"snapshot_interval",kind:"message",T:u.j1},{no:6,name:"client_deactivate_threshold",kind:"message",T:u.hU},{no:7,name:"max_subscribers_per_document",kind:"message",T:u.as},{no:8,name:"max_attachments_per_document",kind:"message",T:u.as},{no:10,name:"max_size_per_document",kind:"message",T:u.as},{no:11,name:"remove_on_detach",kind:"message",T:u._t},{no:22,name:"auto_revision_enabled",kind:"message",T:u._t},{no:9,name:"allowed_origins",kind:"message",T:ee}]);class $ extends c.Q{static fromBinary(e,t){return new $().fromBinary(e,t)}static fromJson(e,t){return new $().fromJson(e,t)}static fromJsonString(e,t){return new $().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals($,e,t)}constructor(e){super(),this.methods=[],l.C.util.initPartial(e,this)}}$.runtime=l.C,$.typeName="yorkie.v1.UpdatableProjectFields.AuthWebhookMethods",$.fields=l.C.util.newFieldList(()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}]);class Z extends c.Q{static fromBinary(e,t){return new Z().fromBinary(e,t)}static fromJson(e,t){return new Z().fromJson(e,t)}static fromJsonString(e,t){return new Z().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(Z,e,t)}constructor(e){super(),this.events=[],l.C.util.initPartial(e,this)}}Z.runtime=l.C,Z.typeName="yorkie.v1.UpdatableProjectFields.EventWebhookEvents",Z.fields=l.C.util.newFieldList(()=>[{no:1,name:"events",kind:"scalar",T:9,repeated:!0}]);class ee extends c.Q{static fromBinary(e,t){return new ee().fromBinary(e,t)}static fromJson(e,t){return new ee().fromJson(e,t)}static fromJsonString(e,t){return new ee().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ee,e,t)}constructor(e){super(),this.origins=[],l.C.util.initPartial(e,this)}}ee.runtime=l.C,ee.typeName="yorkie.v1.UpdatableProjectFields.AllowedOrigins",ee.fields=l.C.util.newFieldList(()=>[{no:1,name:"origins",kind:"scalar",T:9,repeated:!0}]);class et extends c.Q{static fromBinary(e,t){return new et().fromBinary(e,t)}static fromJson(e,t){return new et().fromJson(e,t)}static fromJsonString(e,t){return new et().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(et,e,t)}constructor(e){super(),this.id="",this.key="",this.root="",this.attachedClients=0,this.schemaKey="",this.presences={},l.C.util.initPartial(e,this)}}et.runtime=l.C,et.typeName="yorkie.v1.DocumentSummary",et.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"root",kind:"scalar",T:9},{no:7,name:"attached_clients",kind:"scalar",T:5},{no:8,name:"document_size",kind:"message",T:eg},{no:9,name:"schema_key",kind:"scalar",T:9},{no:10,name:"presences",kind:"map",K:9,V:{kind:"message",T:ei}},{no:4,name:"created_at",kind:"message",T:d.D},{no:5,name:"accessed_at",kind:"message",T:d.D},{no:6,name:"updated_at",kind:"message",T:d.D}]);class er extends c.Q{static fromBinary(e,t){return new er().fromBinary(e,t)}static fromJson(e,t){return new er().fromJson(e,t)}static fromJsonString(e,t){return new er().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(er,e,t)}constructor(e){super(),this.type=0,l.C.util.initPartial(e,this)}}er.runtime=l.C,er.typeName="yorkie.v1.PresenceChange",er.fields=l.C.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:l.C.getEnumType(en)},{no:2,name:"presence",kind:"message",T:ei}]);var en=function(e){return e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.PUT=1]="PUT",e[e.DELETE=2]="DELETE",e[e.CLEAR=3]="CLEAR",e}({});l.C.util.setEnumType(en,"yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT"},{no:2,name:"CHANGE_TYPE_DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR"}]);class ei extends c.Q{static fromBinary(e,t){return new ei().fromBinary(e,t)}static fromJson(e,t){return new ei().fromJson(e,t)}static fromJsonString(e,t){return new ei().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ei,e,t)}constructor(e){super(),this.data={},l.C.util.initPartial(e,this)}}ei.runtime=l.C,ei.typeName="yorkie.v1.Presence",ei.fields=l.C.util.newFieldList(()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class es extends c.Q{static fromBinary(e,t){return new es().fromBinary(e,t)}static fromJson(e,t){return new es().fromJson(e,t)}static fromJsonString(e,t){return new es().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(es,e,t)}constructor(e){super(),this.key="",this.presenceCount=0,l.C.util.initPartial(e,this)}}es.runtime=l.C,es.typeName="yorkie.v1.ChannelSummary",es.fields=l.C.util.newFieldList(()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"presence_count",kind:"scalar",T:5}]);class ea extends c.Q{static fromBinary(e,t){return new ea().fromBinary(e,t)}static fromJson(e,t){return new ea().fromJson(e,t)}static fromJsonString(e,t){return new ea().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ea,e,t)}constructor(e){super(),this.serverSeq=h.M.zero,this.clientSeq=0,l.C.util.initPartial(e,this)}}ea.runtime=l.C,ea.typeName="yorkie.v1.Checkpoint",ea.fields=l.C.util.newFieldList(()=>[{no:1,name:"server_seq",kind:"scalar",T:3},{no:2,name:"client_seq",kind:"scalar",T:13}]);class eo extends c.Q{static fromBinary(e,t){return new eo().fromBinary(e,t)}static fromJson(e,t){return new eo().fromJson(e,t)}static fromJsonString(e,t){return new eo().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eo,e,t)}constructor(e){super(),this.offset=0,this.relativeOffset=0,l.C.util.initPartial(e,this)}}eo.runtime=l.C,eo.typeName="yorkie.v1.TextNodePos",eo.fields=l.C.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:ec},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]);class ec extends c.Q{static fromBinary(e,t){return new ec().fromBinary(e,t)}static fromJson(e,t){return new ec().fromJson(e,t)}static fromJsonString(e,t){return new ec().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ec,e,t)}constructor(e){super(),this.lamport=h.M.zero,this.delimiter=0,this.actorId=new Uint8Array(0),l.C.util.initPartial(e,this)}}ec.runtime=l.C,ec.typeName="yorkie.v1.TimeTicket",ec.fields=l.C.util.newFieldList(()=>[{no:1,name:"lamport",kind:"scalar",T:3},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}]);class el extends c.Q{static fromBinary(e,t){return new el().fromBinary(e,t)}static fromJson(e,t){return new el().fromJson(e,t)}static fromJsonString(e,t){return new el().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(el,e,t)}constructor(e){super(),this.topic="",this.payload=new Uint8Array(0),l.C.util.initPartial(e,this)}}el.runtime=l.C,el.typeName="yorkie.v1.DocEventBody",el.fields=l.C.util.newFieldList(()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]);class eh extends c.Q{static fromBinary(e,t){return new eh().fromBinary(e,t)}static fromJson(e,t){return new eh().fromJson(e,t)}static fromJsonString(e,t){return new eh().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eh,e,t)}constructor(e){super(),this.type=0,this.publisher="",l.C.util.initPartial(e,this)}}eh.runtime=l.C,eh.typeName="yorkie.v1.DocEvent",eh.fields=l.C.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:l.C.getEnumType(g)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:el}]);class ed extends c.Q{static fromBinary(e,t){return new ed().fromBinary(e,t)}static fromJson(e,t){return new ed().fromJson(e,t)}static fromJsonString(e,t){return new ed().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ed,e,t)}constructor(e){super(),this.type=0,this.publisher="",this.count=h.M.zero,this.seq=h.M.zero,this.topic="",this.payload=new Uint8Array(0),l.C.util.initPartial(e,this)}}ed.runtime=l.C,ed.typeName="yorkie.v1.ChannelEvent",ed.fields=l.C.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:l.C.getEnumType(eu)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"count",kind:"scalar",T:3},{no:4,name:"seq",kind:"scalar",T:3},{no:5,name:"topic",kind:"scalar",T:9},{no:6,name:"payload",kind:"scalar",T:12}]);var eu=function(e){return e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.PRESENCE=1]="PRESENCE",e[e.BROADCAST=2]="BROADCAST",e}({});l.C.util.setEnumType(eu,"yorkie.v1.ChannelEvent.Type",[{no:0,name:"TYPE_UNSPECIFIED"},{no:1,name:"TYPE_PRESENCE"},{no:2,name:"TYPE_BROADCAST"}]);class ef extends c.Q{static fromBinary(e,t){return new ef().fromBinary(e,t)}static fromJson(e,t){return new ef().fromJson(e,t)}static fromJsonString(e,t){return new ef().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ef,e,t)}constructor(e){super(),this.data=0,this.meta=0,l.C.util.initPartial(e,this)}}ef.runtime=l.C,ef.typeName="yorkie.v1.DataSize",ef.fields=l.C.util.newFieldList(()=>[{no:1,name:"data",kind:"scalar",T:5},{no:2,name:"meta",kind:"scalar",T:5}]);class eg extends c.Q{static fromBinary(e,t){return new eg().fromBinary(e,t)}static fromJson(e,t){return new eg().fromJson(e,t)}static fromJsonString(e,t){return new eg().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eg,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eg.runtime=l.C,eg.typeName="yorkie.v1.DocSize",eg.fields=l.C.util.newFieldList(()=>[{no:1,name:"live",kind:"message",T:ef},{no:2,name:"gc",kind:"message",T:ef}]);class em extends c.Q{static fromBinary(e,t){return new em().fromBinary(e,t)}static fromJson(e,t){return new em().fromJson(e,t)}static fromJsonString(e,t){return new em().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(em,e,t)}constructor(e){super(),this.id="",this.name="",this.version=0,this.body="",this.rules=[],l.C.util.initPartial(e,this)}}em.runtime=l.C,em.typeName="yorkie.v1.Schema",em.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"version",kind:"scalar",T:5},{no:4,name:"body",kind:"scalar",T:9},{no:5,name:"rules",kind:"message",T:ep,repeated:!0},{no:6,name:"created_at",kind:"message",T:d.D}]);class ep extends c.Q{static fromBinary(e,t){return new ep().fromBinary(e,t)}static fromJson(e,t){return new ep().fromJson(e,t)}static fromJsonString(e,t){return new ep().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ep,e,t)}constructor(e){super(),this.path="",this.type="",l.C.util.initPartial(e,this)}}ep.runtime=l.C,ep.typeName="yorkie.v1.Rule",ep.fields=l.C.util.newFieldList(()=>[{no:1,name:"path",kind:"scalar",T:9},{no:2,name:"type",kind:"scalar",T:9}]);class ey extends c.Q{static fromBinary(e,t){return new ey().fromBinary(e,t)}static fromJson(e,t){return new ey().fromJson(e,t)}static fromJsonString(e,t){return new ey().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ey,e,t)}constructor(e){super(),this.id="",this.label="",this.description="",this.snapshot="",l.C.util.initPartial(e,this)}}ey.runtime=l.C,ey.typeName="yorkie.v1.RevisionSummary",ey.fields=l.C.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"label",kind:"scalar",T:9},{no:3,name:"description",kind:"scalar",T:9},{no:4,name:"snapshot",kind:"scalar",T:9},{no:5,name:"created_at",kind:"message",T:d.D}]);class ev extends c.Q{static fromBinary(e,t){return new ev().fromBinary(e,t)}static fromJson(e,t){return new ev().fromJson(e,t)}static fromJsonString(e,t){return new ev().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ev,e,t)}constructor(e){super(),this.clientKey="",this.metadata={},l.C.util.initPartial(e,this)}}ev.runtime=l.C,ev.typeName="yorkie.v1.ActivateClientRequest",ev.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_key",kind:"scalar",T:9},{no:2,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]);class eC extends c.Q{static fromBinary(e,t){return new eC().fromBinary(e,t)}static fromJson(e,t){return new eC().fromJson(e,t)}static fromJsonString(e,t){return new eC().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eC,e,t)}constructor(e){super(),this.clientId="",l.C.util.initPartial(e,this)}}eC.runtime=l.C,eC.typeName="yorkie.v1.ActivateClientResponse",eC.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9}]);class ew extends c.Q{static fromBinary(e,t){return new ew().fromBinary(e,t)}static fromJson(e,t){return new ew().fromJson(e,t)}static fromJsonString(e,t){return new ew().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ew,e,t)}constructor(e){super(),this.clientId="",this.synchronous=!1,l.C.util.initPartial(e,this)}}ew.runtime=l.C,ew.typeName="yorkie.v1.DeactivateClientRequest",ew.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"synchronous",kind:"scalar",T:8}]);class eA extends c.Q{static fromBinary(e,t){return new eA().fromBinary(e,t)}static fromJson(e,t){return new eA().fromJson(e,t)}static fromJsonString(e,t){return new eA().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eA,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eA.runtime=l.C,eA.typeName="yorkie.v1.DeactivateClientResponse",eA.fields=l.C.util.newFieldList(()=>[]);class eS extends c.Q{static fromBinary(e,t){return new eS().fromBinary(e,t)}static fromJson(e,t){return new eS().fromJson(e,t)}static fromJsonString(e,t){return new eS().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eS,e,t)}constructor(e){super(),this.clientId="",this.schemaKey="",l.C.util.initPartial(e,this)}}eS.runtime=l.C,eS.typeName="yorkie.v1.AttachDocumentRequest",eS.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:p},{no:3,name:"schema_key",kind:"scalar",T:9}]);class eT extends c.Q{static fromBinary(e,t){return new eT().fromBinary(e,t)}static fromJson(e,t){return new eT().fromJson(e,t)}static fromJsonString(e,t){return new eT().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eT,e,t)}constructor(e){super(),this.documentId="",this.maxSizePerDocument=0,this.schemaRules=[],l.C.util.initPartial(e,this)}}eT.runtime=l.C,eT.typeName="yorkie.v1.AttachDocumentResponse",eT.fields=l.C.util.newFieldList(()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:p},{no:3,name:"max_size_per_document",kind:"scalar",T:5},{no:4,name:"schema_rules",kind:"message",T:ep,repeated:!0}]);class ex extends c.Q{static fromBinary(e,t){return new ex().fromBinary(e,t)}static fromJson(e,t){return new ex().fromJson(e,t)}static fromJsonString(e,t){return new ex().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ex,e,t)}constructor(e){super(),this.clientId="",this.documentId="",this.removeIfNotAttached=!1,l.C.util.initPartial(e,this)}}ex.runtime=l.C,ex.typeName="yorkie.v1.DetachDocumentRequest",ex.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:p},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]);class eI extends c.Q{static fromBinary(e,t){return new eI().fromBinary(e,t)}static fromJson(e,t){return new eI().fromJson(e,t)}static fromJsonString(e,t){return new eI().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eI,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eI.runtime=l.C,eI.typeName="yorkie.v1.DetachDocumentResponse",eI.fields=l.C.util.newFieldList(()=>[{no:2,name:"change_pack",kind:"message",T:p}]);class eb extends c.Q{static fromBinary(e,t){return new eb().fromBinary(e,t)}static fromJson(e,t){return new eb().fromJson(e,t)}static fromJsonString(e,t){return new eb().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eb,e,t)}constructor(e){super(),this.clientId="",this.documentId="",l.C.util.initPartial(e,this)}}eb.runtime=l.C,eb.typeName="yorkie.v1.WatchDocumentRequest",eb.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]);class ek extends c.Q{static fromBinary(e,t){return new ek().fromBinary(e,t)}static fromJson(e,t){return new ek().fromJson(e,t)}static fromJsonString(e,t){return new ek().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ek,e,t)}constructor(e){super(),this.body={case:void 0},l.C.util.initPartial(e,this)}}ek.runtime=l.C,ek.typeName="yorkie.v1.WatchDocumentResponse",ek.fields=l.C.util.newFieldList(()=>[{no:1,name:"initialization",kind:"message",T:eP,oneof:"body"},{no:2,name:"event",kind:"message",T:eh,oneof:"body"}]);class eP extends c.Q{static fromBinary(e,t){return new eP().fromBinary(e,t)}static fromJson(e,t){return new eP().fromJson(e,t)}static fromJsonString(e,t){return new eP().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eP,e,t)}constructor(e){super(),this.clientIds=[],l.C.util.initPartial(e,this)}}eP.runtime=l.C,eP.typeName="yorkie.v1.WatchDocumentResponse.Initialization",eP.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}]);class eE extends c.Q{static fromBinary(e,t){return new eE().fromBinary(e,t)}static fromJson(e,t){return new eE().fromJson(e,t)}static fromJsonString(e,t){return new eE().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eE,e,t)}constructor(e){super(),this.clientId="",this.documentId="",l.C.util.initPartial(e,this)}}eE.runtime=l.C,eE.typeName="yorkie.v1.RemoveDocumentRequest",eE.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:p}]);class eD extends c.Q{static fromBinary(e,t){return new eD().fromBinary(e,t)}static fromJson(e,t){return new eD().fromJson(e,t)}static fromJsonString(e,t){return new eD().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eD,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eD.runtime=l.C,eD.typeName="yorkie.v1.RemoveDocumentResponse",eD.fields=l.C.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:p}]);class eR extends c.Q{static fromBinary(e,t){return new eR().fromBinary(e,t)}static fromJson(e,t){return new eR().fromJson(e,t)}static fromJsonString(e,t){return new eR().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eR,e,t)}constructor(e){super(),this.clientId="",this.documentId="",this.pushOnly=!1,l.C.util.initPartial(e,this)}}eR.runtime=l.C,eR.typeName="yorkie.v1.PushPullChangesRequest",eR.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:p},{no:4,name:"push_only",kind:"scalar",T:8}]);class eN extends c.Q{static fromBinary(e,t){return new eN().fromBinary(e,t)}static fromJson(e,t){return new eN().fromJson(e,t)}static fromJsonString(e,t){return new eN().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eN,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eN.runtime=l.C,eN.typeName="yorkie.v1.PushPullChangesResponse",eN.fields=l.C.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:p}]);class eB extends c.Q{static fromBinary(e,t){return new eB().fromBinary(e,t)}static fromJson(e,t){return new eB().fromJson(e,t)}static fromJsonString(e,t){return new eB().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eB,e,t)}constructor(e){super(),this.clientId="",this.documentId="",this.label="",this.description="",l.C.util.initPartial(e,this)}}eB.runtime=l.C,eB.typeName="yorkie.v1.CreateRevisionRequest",eB.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"label",kind:"scalar",T:9},{no:4,name:"description",kind:"scalar",T:9}]);class eJ extends c.Q{static fromBinary(e,t){return new eJ().fromBinary(e,t)}static fromJson(e,t){return new eJ().fromJson(e,t)}static fromJsonString(e,t){return new eJ().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eJ,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eJ.runtime=l.C,eJ.typeName="yorkie.v1.CreateRevisionResponse",eJ.fields=l.C.util.newFieldList(()=>[{no:1,name:"revision",kind:"message",T:ey}]);class eO extends c.Q{static fromBinary(e,t){return new eO().fromBinary(e,t)}static fromJson(e,t){return new eO().fromJson(e,t)}static fromJsonString(e,t){return new eO().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eO,e,t)}constructor(e){super(),this.projectId="",this.documentId="",this.pageSize=0,this.offset=0,this.isForward=!1,l.C.util.initPartial(e,this)}}eO.runtime=l.C,eO.typeName="yorkie.v1.ListRevisionsRequest",eO.fields=l.C.util.newFieldList(()=>[{no:1,name:"project_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"page_size",kind:"scalar",T:5},{no:4,name:"offset",kind:"scalar",T:5},{no:5,name:"is_forward",kind:"scalar",T:8}]);class e_ extends c.Q{static fromBinary(e,t){return new e_().fromBinary(e,t)}static fromJson(e,t){return new e_().fromJson(e,t)}static fromJsonString(e,t){return new e_().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(e_,e,t)}constructor(e){super(),this.revisions=[],l.C.util.initPartial(e,this)}}e_.runtime=l.C,e_.typeName="yorkie.v1.ListRevisionsResponse",e_.fields=l.C.util.newFieldList(()=>[{no:1,name:"revisions",kind:"message",T:ey,repeated:!0}]);class eL extends c.Q{static fromBinary(e,t){return new eL().fromBinary(e,t)}static fromJson(e,t){return new eL().fromJson(e,t)}static fromJsonString(e,t){return new eL().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eL,e,t)}constructor(e){super(),this.clientId="",this.revisionId="",l.C.util.initPartial(e,this)}}eL.runtime=l.C,eL.typeName="yorkie.v1.RestoreRevisionRequest",eL.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"revision_id",kind:"scalar",T:9}]);class ez extends c.Q{static fromBinary(e,t){return new ez().fromBinary(e,t)}static fromJson(e,t){return new ez().fromJson(e,t)}static fromJsonString(e,t){return new ez().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ez,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}ez.runtime=l.C,ez.typeName="yorkie.v1.RestoreRevisionResponse",ez.fields=l.C.util.newFieldList(()=>[]);class eq extends c.Q{static fromBinary(e,t){return new eq().fromBinary(e,t)}static fromJson(e,t){return new eq().fromJson(e,t)}static fromJsonString(e,t){return new eq().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eq,e,t)}constructor(e){super(),this.clientId="",this.channelKey="",l.C.util.initPartial(e,this)}}eq.runtime=l.C,eq.typeName="yorkie.v1.AttachChannelRequest",eq.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"channel_key",kind:"scalar",T:9}]);class eM extends c.Q{static fromBinary(e,t){return new eM().fromBinary(e,t)}static fromJson(e,t){return new eM().fromJson(e,t)}static fromJsonString(e,t){return new eM().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eM,e,t)}constructor(e){super(),this.sessionId="",this.count=h.M.zero,l.C.util.initPartial(e,this)}}eM.runtime=l.C,eM.typeName="yorkie.v1.AttachChannelResponse",eM.fields=l.C.util.newFieldList(()=>[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",T:3}]);class eK extends c.Q{static fromBinary(e,t){return new eK().fromBinary(e,t)}static fromJson(e,t){return new eK().fromJson(e,t)}static fromJsonString(e,t){return new eK().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eK,e,t)}constructor(e){super(),this.clientId="",this.channelKey="",this.sessionId="",l.C.util.initPartial(e,this)}}eK.runtime=l.C,eK.typeName="yorkie.v1.DetachChannelRequest",eK.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"channel_key",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}]);class eF extends c.Q{static fromBinary(e,t){return new eF().fromBinary(e,t)}static fromJson(e,t){return new eF().fromJson(e,t)}static fromJsonString(e,t){return new eF().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eF,e,t)}constructor(e){super(),this.count=h.M.zero,l.C.util.initPartial(e,this)}}eF.runtime=l.C,eF.typeName="yorkie.v1.DetachChannelResponse",eF.fields=l.C.util.newFieldList(()=>[{no:1,name:"count",kind:"scalar",T:3}]);class eU extends c.Q{static fromBinary(e,t){return new eU().fromBinary(e,t)}static fromJson(e,t){return new eU().fromJson(e,t)}static fromJsonString(e,t){return new eU().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eU,e,t)}constructor(e){super(),this.clientId="",this.channelKey="",this.sessionId="",l.C.util.initPartial(e,this)}}eU.runtime=l.C,eU.typeName="yorkie.v1.RefreshChannelRequest",eU.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"channel_key",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}]);class eV extends c.Q{static fromBinary(e,t){return new eV().fromBinary(e,t)}static fromJson(e,t){return new eV().fromJson(e,t)}static fromJsonString(e,t){return new eV().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eV,e,t)}constructor(e){super(),this.count=h.M.zero,l.C.util.initPartial(e,this)}}eV.runtime=l.C,eV.typeName="yorkie.v1.RefreshChannelResponse",eV.fields=l.C.util.newFieldList(()=>[{no:1,name:"count",kind:"scalar",T:3}]);class ej extends c.Q{static fromBinary(e,t){return new ej().fromBinary(e,t)}static fromJson(e,t){return new ej().fromJson(e,t)}static fromJsonString(e,t){return new ej().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(ej,e,t)}constructor(e){super(),this.clientId="",this.channelKey="",l.C.util.initPartial(e,this)}}ej.runtime=l.C,ej.typeName="yorkie.v1.WatchChannelRequest",ej.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"channel_key",kind:"scalar",T:9}]);class eW extends c.Q{static fromBinary(e,t){return new eW().fromBinary(e,t)}static fromJson(e,t){return new eW().fromJson(e,t)}static fromJsonString(e,t){return new eW().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eW,e,t)}constructor(e){super(),this.body={case:void 0},l.C.util.initPartial(e,this)}}eW.runtime=l.C,eW.typeName="yorkie.v1.WatchChannelResponse",eW.fields=l.C.util.newFieldList(()=>[{no:1,name:"initialized",kind:"message",T:eQ,oneof:"body"},{no:2,name:"event",kind:"message",T:ed,oneof:"body"}]);class eQ extends c.Q{static fromBinary(e,t){return new eQ().fromBinary(e,t)}static fromJson(e,t){return new eQ().fromJson(e,t)}static fromJsonString(e,t){return new eQ().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eQ,e,t)}constructor(e){super(),this.count=h.M.zero,this.seq=h.M.zero,l.C.util.initPartial(e,this)}}eQ.runtime=l.C,eQ.typeName="yorkie.v1.WatchChannelInitialized",eQ.fields=l.C.util.newFieldList(()=>[{no:1,name:"count",kind:"scalar",T:3},{no:2,name:"seq",kind:"scalar",T:3}]);class eG extends c.Q{static fromBinary(e,t){return new eG().fromBinary(e,t)}static fromJson(e,t){return new eG().fromJson(e,t)}static fromJsonString(e,t){return new eG().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eG,e,t)}constructor(e){super(),this.clientId="",this.channelKey="",this.topic="",this.payload=new Uint8Array(0),l.C.util.initPartial(e,this)}}eG.runtime=l.C,eG.typeName="yorkie.v1.BroadcastRequest",eG.fields=l.C.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"channel_key",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]);class eH extends c.Q{static fromBinary(e,t){return new eH().fromBinary(e,t)}static fromJson(e,t){return new eH().fromJson(e,t)}static fromJsonString(e,t){return new eH().fromJsonString(e,t)}static equals(e,t){return l.C.util.equals(eH,e,t)}constructor(e){super(),l.C.util.initPartial(e,this)}}eH.runtime=l.C,eH.typeName="yorkie.v1.BroadcastResponse",eH.fields=l.C.util.newFieldList(()=>[]);var eY=r(7195);let eX={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:ev,O:eC,kind:eY.I.Unary},deactivateClient:{name:"DeactivateClient",I:ew,O:eA,kind:eY.I.Unary},attachDocument:{name:"AttachDocument",I:eS,O:eT,kind:eY.I.Unary},detachDocument:{name:"DetachDocument",I:ex,O:eI,kind:eY.I.Unary},removeDocument:{name:"RemoveDocument",I:eE,O:eD,kind:eY.I.Unary},pushPullChanges:{name:"PushPullChanges",I:eR,O:eN,kind:eY.I.Unary},watchDocument:{name:"WatchDocument",I:eb,O:ek,kind:eY.I.ServerStreaming},createRevision:{name:"CreateRevision",I:eB,O:eJ,kind:eY.I.Unary},listRevisions:{name:"ListRevisions",I:eO,O:e_,kind:eY.I.Unary},restoreRevision:{name:"RestoreRevision",I:eL,O:ez,kind:eY.I.Unary},attachChannel:{name:"AttachChannel",I:eq,O:eM,kind:eY.I.Unary},detachChannel:{name:"DetachChannel",I:eK,O:eF,kind:eY.I.Unary},refreshChannel:{name:"RefreshChannel",I:eU,O:eV,kind:eY.I.Unary},watchChannel:{name:"WatchChannel",I:ej,O:eW,kind:eY.I.ServerStreaming},broadcast:{name:"Broadcast",I:eG,O:eH,kind:eY.I.Unary}}};var e$=r(9841),eZ=function(e){return e.Ok="ok",e.ErrClientNotActivated="ErrClientNotActivated",e.ErrClientNotFound="ErrClientNotFound",e.ErrUnimplemented="ErrUnimplemented",e.ErrInvalidType="ErrInvalidType",e.ErrDummy="ErrDummy",e.ErrNotAttached="ErrNotAttached",e.ErrNotDetached="ErrNotDetached",e.ErrDocumentRemoved="ErrDocumentRemoved",e.ErrDocumentSizeExceedsLimit="ErrDocumentSizeExceedsLimit",e.ErrDocumentSchemaValidationFailed="ErrDocumentSchemaValidationFailed",e.ErrInvalidObjectKey="ErrInvalidObjectKey",e.ErrInvalidArgument="ErrInvalidArgument",e.ErrNotInitialized="ErrNotInitialized",e.ErrNotReady="ErrNotReady",e.ErrRefused="ErrRefused",e.ErrContextNotProvided="ErrContextNotProvided",e.ErrPermissionDenied="ErrPermissionDenied",e.ErrUnauthenticated="ErrUnauthenticated",e.ErrTooManySubscribers="ErrTooManySubscribers",e.ErrTooManyAttachments="ErrTooManyAttachments",e}({});class e0 extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="YorkieError",this.toString=()=>"[code=".concat(this.code,"]: ").concat(this.message)}}var e1=function(e){return e.Put="put",e.Clear="clear",e}({});let e2="000000000000000000000000";class e9{static of(e,t,r){return new e9(e,t,r)}static fromStruct(e){return e9.of(BigInt(e.lamport),e.delimiter,e.actorID)}toIDString(){return"".concat(this.lamport.toString(),":").concat(this.actorID,":").concat(this.delimiter)}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return"".concat(this.lamport.toString(),":").concat(this.actorID.slice(-2),":").concat(this.delimiter)}setActor(e){return new e9(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return 0===this.compare(e)}compare(e){if(this.lamport>e.lamport)return 1;if(e.lamport>this.lamport)return -1;let t=this.actorID.localeCompare(e.actorID);return 0!==t?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}constructor(e,t,r){this.lamport=e,this.delimiter=t,this.actorID=r}}let e3=new e9(0n,0,e2);function e4(e){return e.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case"\n":return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}new e9(0x7fffffffffffffffn,0xffffffff,"FFFFFFFFFFFFFFFFFFFFFFFF");class e5{getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setCreatedAt(e){this.createdAt=e}setMovedAt(e){return!!(!this.movedAt||e&&e.after(this.movedAt))&&(this.movedAt=e,!0)}setRemovedAt(e){this.removedAt=e}remove(e){return!!(e&&e.after(this.createdAt)&&(!this.removedAt||e.after(this.removedAt)))&&(this.removedAt=e,!0)}isRemoved(){return!!this.removedAt}getMetaUsage(){let e=0;return this.getCreatedAt()&&(e+=24),this.getMovedAt()&&(e+=24),this.getRemovedAt()&&(e+=24),e}constructor(e){this.createdAt=e}}class e8 extends e5{constructor(e){super(e)}}class e6{static of(e,t){return new e6(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}constructor(e,t){this.strKey=e,this.value=t}}class e7{static create(){return new e7}set(e,t,r){let n;let i=this.nodeMapByKey.get(e);i&&!i.isRemoved()&&i.remove(r)&&(n=i.getValue());let s=e6.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),s),(!i||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,s),t.setMovedAt(r)),n}delete(e,t){if(!this.nodeMapByCreatedAt.has(e.toIDString()))throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(e.toIDString()));let r=this.nodeMapByCreatedAt.get(e.toIDString());return r.remove(t),r.getValue()}subPathOf(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return t.getStrKey()}purge(e){let t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(e.getCreatedAt().toIDString()));let r=this.nodeMapByKey.get(t.getStrKey());t===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){let r=this.nodeMapByKey.get(e);if(r&&r.remove(t))return r.getValue()}has(e){let t=this.nodeMapByKey.get(e);return!!t&&!t.isRemoved()}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){let t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}deepcopy(){let e=e7.create();for(let[,t]of this.nodeMapByCreatedAt)e.nodeMapByCreatedAt.set(t.getValue().getCreatedAt().toIDString(),e6.of(t.getStrKey(),t.getValue().deepcopy()));for(let[t,r]of this.nodeMapByKey)e.nodeMapByKey.set(t,e.nodeMapByCreatedAt.get(r.getValue().getCreatedAt().toIDString()));return e}*[Symbol.iterator](){for(let[,e]of this.nodeMapByCreatedAt)yield e}constructor(){this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}}class te extends e8{static create(e,t){if(!t)return new te(e,e7.create());let r=e7.create();for(let[e,n]of Object.entries(t))r.set(e,n.deepcopy(),n.getCreatedAt());return new te(e,r)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,t,r){return this.memberNodes.set(e,t,r)}delete(e,t){return this.memberNodes.delete(e,t)}deleteByKey(e,t){return this.memberNodes.deleteByKey(e,t)}get(e){let t=this.memberNodes.get(e);return null==t?void 0:t.getValue()}getByID(e){let t=this.memberNodes.getByID(e);return null==t?void 0:t.getValue()}has(e){return this.memberNodes.has(e)}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){let e=[];for(let[t,r]of this)e.push('"'.concat(e4(t),'":').concat(r.toJSON()));return"{".concat(e.join(","),"}")}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){let e={};for(let[t,r]of this){let{createdAt:n,value:i,type:s}=r.toJSForTest();e[t]={key:t,createdAt:n,value:i,type:s}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){let e=[];for(let[t]of this)e.push(t);return e}toSortedJSON(){let e=new Set;for(let[t]of this)e.add(t);let t=[];for(let n of Array.from(e).sort()){var r;let e=null===(r=this.memberNodes.get(n))||void 0===r?void 0:r.getValue();t.push('"'.concat(e4(n),'":').concat(e.toSortedJSON()))}return"{".concat(t.join(","),"}")}getRHT(){return this.memberNodes}deepcopy(){let e=te.create(this.getCreatedAt());return e.memberNodes=this.memberNodes.deepcopy(),e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}getDescendants(e){for(let t of this.memberNodes){let r=t.getValue();if(e(r,this))return;r instanceof e8&&r.getDescendants(e)}}*[Symbol.iterator](){for(let e of this.memberNodes)!e.isRemoved()&&(yield[e.getStrKey(),e.getValue()])}constructor(e,t){super(e),this.memberNodes=t}}var tt=function(e){return e.Local="local",e.Remote="remote",e.UndoRedo="undoredo",e}({});class tr{getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new e0(eZ.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}constructor(e,t){this.parentCreatedAt=e,this.executedAt=t}}class tn{getNodeString(){return"".concat(this.weight).concat(this.value)}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}constructor(e){this.value=e,this.initWeight()}}class ti{get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}if(e>t.getLength())throw new e0(eZ.ErrInvalidArgument,"out of index range: pos: ".concat(e," > node.length: ").concat(t.getLength()));return this.splayNode(t),[t,e]}indexOf(e){return e&&(e===this.root||e.hasLinks())?(this.splayNode(e),this.root.getLeftWeight()):-1}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t)):this.root=t,t}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);let t=new ti(e.getLeft());t.root&&t.root.setParent();let r=new ti(e.getRight());if(r.root&&r.root.setParent(),t.root){let e=t.getRightmost();t.splayNode(e),t.root.setRight(r.root),r.root&&r.root.setParent(t.root),this.root=t.root}else this.root=r.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){let t=[];for(let r of(this.traversePostorder(e.getRight(),t),t))r.initWeight();this.updateTreeWeight(e)}toTestString(){let e=[];return this.traverseInorder(this.root,e),e.map(e=>"[".concat(e.getWeight(),",").concat(e.getLength(),"]").concat(e.getValue()||"")).join("")}checkWeight(){let e=[];for(let t of(this.traverseInorder(this.root,e),e))if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){e&&(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){e&&(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){let t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){let t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return!!(e&&e.hasParent())&&e.getParent().getLeft()===e}isRightChild(e){return!!(e&&e.hasParent())&&e.getParent().getRight()===e}constructor(e){this.root=e}}var ts=r(1153),ta=function(e){return e[e.Null=0]="Null",e[e.Boolean=1]="Boolean",e[e.Integer=2]="Integer",e[e.Long=3]="Long",e[e.Double=4]="Double",e[e.String=5]="String",e[e.Bytes=6]="Bytes",e[e.Date=7]="Date",e}({});class to extends e5{static of(e,t){return new to(e,t)}static valueFromBytes(e,t){switch(e){case 0:return null;case 1:return!!t[0];case 2:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 4:{let e=new DataView(t.buffer);return t.forEach(function(t,r){e.setUint8(r,t)}),e.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(t);case 3:return ts.A.fromBytesLE(Array.from(t));case 6:return t;case 7:return new Date(ts.A.fromBytesLE(Array.from(t),!0).toNumber());default:throw new e0(eZ.ErrUnimplemented,"unimplemented type: ".concat(e))}}getValueSize(){switch(this.valueType){case 0:case 3:case 4:case 7:return 8;case 1:case 2:return 4;case 5:return 2*this.value.length;case 6:return this.value.length;default:throw new e0(eZ.ErrUnimplemented,"unimplemented type: ".concat(this.valueType))}}getDataSize(){return{data:this.getValueSize(),meta:this.getMetaUsage()}}toJSON(){return 5===this.valueType?'"'.concat(e4(this.value),'"'):"".concat(this.value)}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){let e=to.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":if(this.isInteger(e))return 2;return 4;case"string":return 5;case"object":if(null===e)return 0;if(e instanceof ts.A)return 3;if(e instanceof Uint8Array)return 6;else if(e instanceof Date)return 7}}static isSupport(e){return void 0!==to.getPrimitiveType(e)}static isInteger(e){return e%1==0}isNumericType(){let e=this.valueType;return 2===e||3===e||4===e}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return new Uint8Array(this.value?[1]:[0]);case 2:{let e=this.value;return new Uint8Array([255&e,e>>8&255,e>>16&255,e>>24&255])}case 4:{let e=this.value,t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),t}case 5:return new TextEncoder().encode(this.value);case 3:{let e=this.value.toBytesLE();return Uint8Array.from(e)}case 6:return this.value;case 7:{let e=this.value,t=ts.A.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(t)}default:throw new e0(eZ.ErrUnimplemented,"unimplemented type: ".concat(this.valueType))}}constructor(e,t){super(t),this.valueType=to.getPrimitiveType(e),this.value=void 0===e?null:e}}class tc extends tn{static createAfter(e,t){let r=new tc(t),n=e.next;return e.next=r,r.prev=e,r.next=n,n&&(n.prev=r),r}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return+!this.value.isRemoved()}getPrev(){return this.prev}getNext(){return this.next}getMovedFrom(){return this.movedFrom}setMovedFrom(e){this.movedFrom=e}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}constructor(e){super(e),this.value=e}}class tl{static create(){return new tl}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString());if(!r)throw new e0(eZ.ErrInvalidArgument,"cant find the given node: ".concat(e.toIDString()));for(;r.getValue().getMovedAt()&&r.getValue().getMovedAt().after(t)&&r.getMovedFrom();)r=r.getMovedFrom();for(;r.getNext()&&r.getNext().getPositionedAt().after(t);)r=r.getNext();return r}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getCreatedAt(),n=this.findNextBeforeExecutedAt(e,r),i=tc.createAfter(n,t);return n===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(n,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i),i}moveAfter(e,t,r){let n=this.nodeMapByCreatedAt.get(e.toIDString());if(!n)throw new e0(eZ.ErrInvalidArgument,"cant find the given node: ".concat(e.toIDString()));let i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new e0(eZ.ErrInvalidArgument,"cant find the given node: ".concat(t.toIDString()));if(n!==i&&r.after(i.getPositionedAt())){let e=i.getPrev(),t=i.getNext();for(this.release(i),(i=this.insertAfter(n.getCreatedAt(),i.getValue(),r)).getValue().setMovedAt(r),i.setMovedFrom(e);t&&t.getPositionedAt().after(r);)n=i,t=(i=t).getNext(),this.release(i),(i=this.insertAfter(n.getCreatedAt(),i.getValue(),r)).getValue().setMovedAt(r),i.setMovedFrom(e)}}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){let t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new e0(eZ.ErrInvalidArgument,"fail to find the given createdAt: ".concat(e.getCreatedAt().toIDString()));this.release(t)}getByIndex(e){if(e>=this.length)return;let[t,r]=this.nodeMapByIndex.find(e),n=t;if(0===e&&t===this.dummyHead||r>0)do n&&(n=n.getNext());while(n&&n.isRemoved());return n}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString()),n=r.isRemoved();return r.remove(t)&&!n&&this.nodeMapByIndex.splayNode(r),r.getValue()}set(e,t,r){let n=this.nodeMapByCreatedAt.get(e.toIDString());if(!n)throw new e0(eZ.ErrInvalidArgument,"cant find the given node: ".concat(e.toIDString()));return this.insertAfter(n.getCreatedAt(),t,r),this.delete(e,r)}deleteByIndex(e,t){let r=this.getByIndex(e);if(r)return r.remove(t)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){let e=[];for(let t of this){let r="".concat(t.getCreatedAt().toIDString(),":").concat(t.getValue().toJSON());t.isRemoved()?e.push("{".concat(r,"}")):e.push("[".concat(r,"]"))}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}constructor(){let e=to.of(0,e3);e.setRemovedAt(e3),this.dummyHead=new tc(e),this.last=this.dummyHead,this.nodeMapByIndex=new ti,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}}class th extends e8{static create(e,t){if(!t)return new th(e,tl.create());let r=tl.create();for(let e of t)r.insertAfter(r.getLastCreatedAt(),e.deepcopy());return new th(e,r)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,t,r){this.elements.insertAfter(e,t,r)}moveAfter(e,t,r){this.elements.moveAfter(e,t,r)}get(e){let t=this.elements.getByIndex(e);return null==t?void 0:t.getValue()}getByID(e){let t=this.elements.getByID(e);return null==t?void 0:t.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,t){return this.elements.delete(e,t)}deleteByIndex(e,t){return this.elements.deleteByIndex(e,t)}set(e,t,r){return this.elements.set(e,t,r)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(let e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(let t of this.elements){let r=t.getValue();if(e(r,this))return;r instanceof e8&&r.getDescendants(e)}}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){let e=[];for(let t of this)e.push(t.toJSON());return"[".concat(e.join(","),"]")}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){let e={};for(let t=0;t<this.length;t++){let{createdAt:r,value:n,type:i}=this.get(t).toJSForTest();e[t]={key:String(t),createdAt:r,value:n,type:i}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){let e=th.create(this.getCreatedAt());for(let t of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),t.getValue().deepcopy());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}constructor(e,t){super(e),this.elements=t}}class td extends tr{static create(e,t,r,n){return new td(e,t,r,n)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof th))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only array can execute add");let r=this.value.deepcopy();return t.insertAfter(this.prevCreatedAt,r,this.getExecutedAt()),e.registerElement(r,t),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(t.subPathOf(this.getEffectedCreatedAt()))}],reverseOp:this.toReverseOperation()}}toReverseOperation(){return tu.create(this.getParentCreatedAt(),this.value.getCreatedAt())}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".ADD.").concat(this.value.toJSON())}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}setPrevCreatedAt(e){this.prevCreatedAt=e}constructor(e,t,r,n){super(e,n),this.prevCreatedAt=t,this.value=r}}class tu extends tr{static create(e,t,r){return new tu(e,t,r)}execute(e,t){let r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(r instanceof e8))throw new e0(eZ.ErrInvalidArgument,"only object and array can execute remove: ".concat(r));if(t===tt.UndoRedo){let t=r.getByID(this.createdAt);for(;t;){var n;if(t.getRemovedAt())return;t=null===(n=e.findElementPairByCreatedAt(t.getCreatedAt()))||void 0===n?void 0:n.parent}}let i=r.subPathOf(this.createdAt),s=this.toReverseOperation(r),a=r.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(a),{opInfos:r instanceof th?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:i}],reverseOp:s}}toReverseOperation(e){if(e instanceof th){let t=e.getByID(this.createdAt);if(void 0!==t){let r=e.getPrevCreatedAt(this.createdAt);return td.create(this.getParentCreatedAt(),r,t.deepcopy())}}if(e instanceof te){let t=e.subPathOf(this.createdAt);if(void 0!==t){let r=e.get(t);if(void 0!==r)return tf.create(t,r.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".REMOVE.").concat(this.createdAt.toTestString())}getCreatedAt(){return this.createdAt}setCreatedAt(e){this.createdAt=e}constructor(e,t,r){super(e,r),this.createdAt=t}}class tf extends tr{static create(e,t,r,n){return new tf(e,t,r,n)}execute(e,t){let r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(r instanceof te))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only object can execute set");if(t===tt.UndoRedo){let t=r;for(;t;){var n;if(t.getRemovedAt())return;t=null===(n=e.findElementPairByCreatedAt(t.getCreatedAt()))||void 0===n?void 0:n.parent}}let i=r.get(this.key),s=this.toReverseOperation(i),a=this.value.deepcopy(),o=r.set(this.key,a,this.getExecutedAt());return t===tt.UndoRedo&&e.findByCreatedAt(a.getCreatedAt())&&e.deregisterElement(a),e.registerElement(a,r),o&&e.registerRemovedElement(o),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:s}}toReverseOperation(e){let t=tu.create(this.getParentCreatedAt(),this.value.getCreatedAt());return void 0===e||e.isRemoved()||(t=tf.create(this.key,e.deepcopy(),this.getParentCreatedAt())),t}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".SET.").concat(this.key,"=").concat(this.value.toSortedJSON())}getKey(){return this.key}getValue(){return this.value}constructor(e,t,r,n){super(r,n),this.key=e,this.value=t}}class tg extends tr{static create(e,t,r,n){return new tg(e,t,r,n)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof th))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only array can execute move");let r=this.toReverseOperation(t),n=Number(t.subPathOf(this.createdAt));t.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());let i=Number(t.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:i,previousIndex:n}],reverseOp:r}}toReverseOperation(e){let t=e.getPrevCreatedAt(this.createdAt);return tg.create(this.getParentCreatedAt(),t,this.createdAt)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".MOVE")}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}setPrevCreatedAt(e){this.prevCreatedAt=e}setCreatedAt(e){this.createdAt=e}constructor(e,t,r,n){super(e,n),this.prevCreatedAt=t,this.createdAt=r}}class tm{static of(e,t,r,n){return new tm(e,t,r,n)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return"".concat(this.updatedAt.toIDString(),":").concat(this.key)}getRemovedAt(){if(this._isRemoved)return this.updatedAt}getDataSize(){return{data:(this.key.length+this.value.length)*2,meta:24}}constructor(e,t,r,n){this.key=e,this.value=t,this.updatedAt=r,this._isRemoved=n}}class tp{static create(){return new tp}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,r){let n=this.nodeMapByKey.get(e);if(n&&n.isRemoved()&&r.after(n.getUpdatedAt())&&(this.numberOfRemovedElement-=1),void 0===n||r.after(n.getUpdatedAt())){let i=tm.of(e,t,r,!1);return(this.nodeMapByKey.set(e,i),void 0!==n&&n.isRemoved())?[n,i]:[void 0,i]}return n.isRemoved()?[n,void 0]:[void 0,void 0]}setInternal(e,t,r,n){let i=tm.of(e,t,r,n);this.nodeMapByKey.set(e,i),n&&this.numberOfRemovedElement++}remove(e,t){let r=this.nodeMapByKey.get(e),n=[];if(void 0===r||t.after(r.getUpdatedAt())){if(void 0===r){this.numberOfRemovedElement+=1;let r=tm.of(e,"",t,!0);return this.nodeMapByKey.set(e,r),n.push(r),n}let i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&n.push(r);let s=tm.of(e,r.getValue(),t,!0);this.nodeMapByKey.set(e,s),n.push(s)}return n}has(e){if(this.nodeMapByKey.has(e)){let t=this.nodeMapByKey.get(e);return void 0!==t&&!t.isRemoved()}return!1}get(e){if(this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){let e=new tp;for(let[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";let e=[];for(let[t,r]of this.nodeMapByKey)r.isRemoved()||e.push('"'.concat(e4(t),'":"').concat(e4(r.getValue()),'"'));return"{".concat(e.join(","),"}")}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){let e={};for(let[t,r]of this.nodeMapByKey)r.isRemoved()||(e[t]=r.getValue());return e}*[Symbol.iterator](){for(let[,e]of this.nodeMapByKey)yield e}purge(e){let t=this.nodeMapByKey.get(e.getKey());void 0!=t&&t.toIDString()==e.toIDString()&&(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}constructor(){this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}}function ty(e){return e instanceof Map?new Map(JSON.parse(JSON.stringify(Array.from(e)))):JSON.parse(JSON.stringify(e))}let tv=e=>!e||0===Object.entries(e).length,tC=e=>{let t={};for(let[r,n]of Object.entries(e))t[r]=JSON.stringify(n);return t},tw=e=>{let t={};for(let[r,n]of Object.entries(e))t[r]=JSON.parse(n);return t};function tA(e){return e.data+e.meta}function tS(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(let t of r)e.data+=t.data,e.meta+=t.meta}function tT(e,t){e.data-=t.data,e.meta-=t.meta}var tx=function(e){return e.Content="content",e.Style="style",e}(tx||{});class tI{static create(e){return new tI(e)}get length(){return this.content.length}substring(e,t){let r=new tI(this.content.substring(e,t));return r.attributes=this.attributes.deepcopy(),r}setAttr(e,t,r){return this.attributes.set(e,t,r)}getAttrs(){return this.attributes}toString(){return this.content}getDataSize(){let e={data:0,meta:0};for(let t of(e.data+=2*this.content.length,this.attributes)){let r=t.getDataSize();e.meta+=r.meta,e.data+=r.data}return e}toJSON(){let e=e4(this.content),t=this.attributes.toObject(),r=[];for(let[e,n]of Object.entries(t)){let t=JSON.parse(n),i="string"==typeof t?'"'.concat(e4(e),'":"').concat(e4(t),'"'):'"'.concat(e4(e),'":').concat(String(t));r.push(i)}return(r.sort(),0===r.length)?'{"val":"'.concat(e,'"}'):'{"attrs":{'.concat(r.join(","),'},"val":"').concat(e,'"}')}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof tm&&this.attributes.purge(e)}getGCPairs(){let e=[];for(let t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}constructor(e){this.attributes=tp.create(),this.content=e}}class tb extends e5{static create(e,t){return new tb(e,t)}edit(e,t,r,n,i){let s=t?tI.create(t):void 0;if(s&&n)for(let[e,t]of Object.entries(n))s.setAttr(e,t,r);let[a,o,c,l]=this.rgaTreeSplit.edit(e,r,s,i);return[l.map(e=>({...e,value:e.value?{attributes:tw(e.value.getAttributes()),content:e.value.getContent()}:{attributes:void 0,content:""},type:"content"})),o,c,[a,a]]}setStyle(e,t,r,n){let i={data:0,meta:0},[,s,a]=this.rgaTreeSplit.findNodeWithSplit(e[1],r),[,o,c]=this.rgaTreeSplit.findNodeWithSplit(e[0],r);tS(i,s,o);let l=[],h=this.rgaTreeSplit.findBetween(c,a),d=[];for(let e of h){let t=e.getCreatedAt().getActorID(),i=0x7fffffffffffffffn;void 0!=n&&(i=n.get(t)?n.get(t):0n),e.canStyle(r,i)&&d.push(e)}let u=[];for(let e of d){if(e.isRemoved())continue;let[n,s]=this.rgaTreeSplit.findIndexesFromRange(e.createPosRange());for(let[a,o]of(l.push({type:"style",actor:r.getActorID(),from:n,to:s,value:{attributes:tw(t)}}),Object.entries(t))){let[t]=e.getValue().setAttr(a,o,r);void 0!==t&&u.push({parent:e.getValue(),child:t});let n=e.getValue().getAttrs().getNodeMapByKey().get(a);void 0!==n&&tS(i,n.getDataSize())}}return[u,i,l]}indexRangeToPosRange(e,t){let r=this.rgaTreeSplit.indexToPos(e);return e===t?[r,r]:[r,this.rgaTreeSplit.indexToPos(t)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}getDataSize(){let e={data:0,meta:0};for(let t of this.rgaTreeSplit){if(t.isRemoved())continue;let r=t.getDataSize();e.data+=r.data,e.meta+=r.meta}return{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){let e=[];for(let t of this.rgaTreeSplit)t.isRemoved()||e.push(t.getValue().toJSON());return"[".concat(e.join(","),"]")}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){let e=[];for(let t of this.rgaTreeSplit)if(!t.isRemoved()){let r=t.getValue();e.push({attributes:tw(r.getAttributes()),content:r.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){let e=new tb(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){let e=[];for(let t of this.rgaTreeSplit)for(let r of(t.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:t}),t.getValue().getGCPairs()))e.push(r);return e}constructor(e,t){super(t),this.rgaTreeSplit=e}}class tk extends tr{static create(e,t,r,n,i,s){return new tk(e,t,r,n,i,s)}execute(e,t,r){let n=e.findByCreatedAt(this.getParentCreatedAt());if(!n)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(n instanceof tb))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only Text can execute edit");let[i,s,a]=n.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),r);for(let t of(e.acc(a),s))e.registerGCPair(t);return{opInfos:i.map(t=>{let{from:r,to:n,value:i}=t;return{type:"edit",from:r,to:n,value:i,path:e.createPath(this.getParentCreatedAt())}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),n=this.content;return"".concat(e,".EDIT(").concat(t,",").concat(r,",").concat(n,")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}constructor(e,t,r,n,i,s){super(e,s),this.fromPos=t,this.toPos=r,this.content=n,this.attributes=i}}class tP extends tr{static create(e,t,r,n,i){return new tP(e,t,r,n,i)}execute(e,t,r){let n=e.findByCreatedAt(this.getParentCreatedAt());if(!n)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(n instanceof tb))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only Text can execute edit");let[i,s,a]=n.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),r);for(let t of(e.acc(s),i))e.registerGCPair(t);return{opInfos:a.map(t=>{let{from:r,to:n,value:i}=t;return{type:"style",from:r,to:n,value:i,path:e.createPath(this.getParentCreatedAt())}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),n=this.attributes;return"".concat(e,".STYL(").concat(t,",").concat(r,",").concat(JSON.stringify(n),")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}constructor(e,t,r,n,i){super(e,i),this.fromPos=t,this.toPos=r,this.attributes=n}}let tE="text";function tD(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=0,i=r?e.allChildren:e.children;for(let e=0;e<t;e++){let t=i[e];t&&(r||!t.isRemoved)&&(n+=t.paddedSize(r))}return n}class tR{updateAncestorsSize(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.parent;for(;r;){if(t)r.totalSize+=e;else if(r.visibleSize+=e,r.isRemoved)break;r=r.parent}}updateDescendantsSize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;for(let r of this._children){let n=r.updateDescendantsSize(e);(e||!r.isRemoved)&&(t+=n)}return e?this.totalSize+=t:this.visibleSize+=t,this.paddedSize(e)}get isText(){return this.type===tE}paddedSize(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.visibleSize;return e&&(t=this.totalSize),this.isText||(t+=2),t}isAncestorOf(e){return function(e,t){if(e===t)return!1;for(;t.parent;){if(t.parent===e)return!0;t=t.parent}return!1}(this,e)}get nextSibling(){let e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){let e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){let r={data:0,meta:0};if(0===e||e===this.visibleSize)return[void 0,r];let n=this.value.slice(0,e),i=this.value.slice(e);if(!i.length)return[void 0,r];let s=this.getDataSize();this.value=n;let a=this.cloneText(e+t);return a.value=i,this.parent.insertAfterInternal(a,this),tS(r,this.getDataSize(),a.getDataSize()),tT(r,s),[a,r]}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}getChildrenText(){return this.isText?this.value:this.hasTextChild()?this.children.map(e=>e.value).join(""):""}append(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");for(let e of(this._children.push(...t),t))e.parent=this,e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}prepend(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");for(let e of(this._children.unshift(...t),t))e.parent=this}insertBefore(e,t){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");let r=this._children.indexOf(t);if(-1===r)throw new e0(eZ.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}insertAfter(e,t){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");let r=this._children.indexOf(t);if(-1===r)throw new e0(eZ.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}insertAt(e,t){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}removeChild(e){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");let t=this._children.indexOf(e);if(-1===t)throw new e0(eZ.ErrInvalidArgument,"child not found");this._children.splice(t,1),e.updateAncestorsSize(-e.paddedSize(!0),!0),e.parent=void 0}splitElement(e,t){let r={data:0,meta:0},n=this.getDataSize(),i=this.cloneElement(t);this.parent.insertAfterInternal(i,this),i.updateAncestorsSize(i.paddedSize()),i.updateAncestorsSize(i.paddedSize(!0),!0);let s=this.children.slice(0,e),a=this.children.slice(e);for(let e of(this._children=s,i._children=a,this.visibleSize=this._children.reduce((e,t)=>e+t.paddedSize(),0),this.totalSize=this._children.reduce((e,t)=>e+t.paddedSize(!0),0),i.visibleSize=i._children.reduce((e,t)=>e+t.paddedSize(!0),0),i.totalSize=i._children.reduce((e,t)=>e+t.paddedSize(!0),0),i._children))e.parent=i;return tS(r,this.getDataSize(),i.getDataSize()),tT(r,n),[i,r]}insertAfterInternal(e,t){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");let r=this._children.indexOf(t);if(-1===r)throw new e0(eZ.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1)}insertAtInternal(e,t){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");if(t)return this._children.indexOf(e);if(e.isRemoved){let t=this._children.indexOf(e);return this.allChildren.splice(0,t).filter(e=>!e.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new e0(eZ.ErrRefused,"Text node cannot have children");let t=e;for(;t;){let e=this._children.indexOf(t);if(-1!==e)return e;t=t.parent}return -1}constructor(e,t=[]){if(this.type=e,this.visibleSize=0,this.totalSize=0,this._children=t,this.isText&&this._children.length>0)throw new e0(eZ.ErrRefused,"Text node cannot have children")}}var tN=function(e){return e.Start="Start",e.End="End",e.Text="Text",e}({});function tB(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let n of e._children)tB(n,t,r+1);t(e,r)}class tJ{tokensBetween(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];!function e(t,r,n,i){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(r>n)throw new e0(eZ.ErrInvalidArgument,"from is greater than to: ".concat(r," > ").concat(n));let a=s?t.totalSize:t.visibleSize;if(r>a)throw new e0(eZ.ErrInvalidArgument,"from is out of range: ".concat(r," > ").concat(a));if(n>a)throw new e0(eZ.ErrInvalidArgument,"to is out of range: ".concat(n," > ").concat(a));if(r===n)return;let o=0;for(let a of s?t._children:t.children){if(r-a.paddedSize(s)<o&&o<n){let t=a.isText?r-o:r-o-1,c=a.isText?n-o:n-o-1,l=s?a.totalSize:a.visibleSize,h=!a.isText&&t<0,d=!a.isText&&c>l;(a.isText||h)&&i([a,a.isText?"Text":"Start"],d),e(a,Math.max(0,t),Math.min(c,l),i,s),d&&i([a,"End"],d)}o+=a.paddedSize(s)}}(this.root,e,t,r,n)}traverse(e){!function e(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let i of t.children)e(i,r,n+1);r(t,n)}(this.root,e,0)}traverseAll(e){tB(this.root,e,0)}findTreePos(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return function e(t,r){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r>t.visibleSize)throw new e0(eZ.ErrInvalidArgument,"index is out of range: ".concat(r," > ").concat(t.visibleSize));if(t.isText)return{node:t,offset:r};let i=0,s=0;for(let a of t.children){if(n&&a.isText&&a.visibleSize>=r-s)return e(a,r-s,n);if(r===s)break;if(!n&&a.paddedSize()===r-s)return{node:t,offset:i+1};if(a.paddedSize()>r-s)return e(a,r-s-1,n);s+=a.paddedSize(),i+=1}return{node:t,offset:i}}(this.root,e,t)}treePosToPath(e){let t=[],r=e.node;if(r.isText){let n=r.parent.findOffset(r);if(-1===n)throw new e0(eZ.ErrInvalidArgument,"invalid treePos");let i=tD(r.parent,n);t.push(i+e.offset),r=r.parent}else if(r.hasTextChild()){let n=tD(r,e.offset);t.push(n)}else t.push(e.offset);for(;r.parent;){let e=r.parent.findOffset(r);if(-1===e)throw new e0(eZ.ErrInvalidArgument,"invalid treePos");t.push(e),r=r.parent}return t.reverse()}pathToIndex(e){let t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new e0(eZ.ErrInvalidArgument,"unacceptable path");let t=this.root;for(let r=0;r<e.length-1;r++){let n=e[r];if(!(t=t.children[n]))throw new e0(eZ.ErrInvalidArgument,"unacceptable path")}if(t.hasTextChild())return function(e,t){if(e.visibleSize<t)throw new e0(eZ.ErrInvalidArgument,"unacceptable path");for(let r=0;r<e.children.length;r++){let n=e.children[r];if(n.visibleSize<t)t-=n.visibleSize;else{e=n;break}}return{node:e,offset:t}}(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new e0(eZ.ErrInvalidArgument,"unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.visibleSize}findPostorderRight(e){let{node:t,offset:r}=e;if(t.isText){if(t.visibleSize===r){let e=t.nextSibling;return e||t.parent}return t}return t.children.length===r?t:function e(t){return t.isText||0===t.children.length?t:e(t.children[0])}(t.children[r])}indexOf(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{node:r}=e,{offset:n}=e,i=0,s=1;if(r.isText){i+=n;let e=r.parent,s=e.findOffset(r,t);if(-1===s)throw new e0(eZ.ErrInvalidArgument,"invalid pos");i+=tD(e,s,t),r=r.parent}else i+=tD(r,n,t);for(;null==r?void 0:r.parent;){let e=r.parent,n=e.findOffset(r,t);if(-1===n)throw new e0(eZ.ErrInvalidArgument,"invalid pos");i+=tD(e,n,t),s++,r=r.parent}return i+s-1}indexToPath(e){let t=this.findTreePos(e);return this.treePosToPath(t)}constructor(e){this.root=e}}let tO=(e,t)=>e===t?0:e<t?-1:1;class t_{constructor(e,t,r){this.key=e,this.value=t,this.isRed=r}}class tL{traverseInorder(e){e&&(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}constructor(e){this.stack=[],this.traverseInorder(e)}}class tz{put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){let t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new tL(this.root)}values(){let e=[];for(let t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t,r=this.root;for(;r;){let n=this.comparator(e,r.key);if(0===n)return r;n<0?r=r.left:(t=r,r=r.right)}return t}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return 0===this.counter}getInternal(e,t){for(;t;){let r=this.comparator(e,t.key);if(0===r)return t;r<0?t=t.left:r>0&&(t=t.right)}}putInternal(e,t,r){if(!r)return this.counter+=1,new t_(e,t,!0);let n=this.comparator(e,r.key);return n<0?r.left=this.putInternal(e,t,r.left):n>0?r.right=this.putInternal(e,t,r.right):r.value=t,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(e,t){if(0>this.comparator(t,e.key))this.isRed(e.left)||this.isRed(e.left.left)||(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),0===this.comparator(t,e.key)&&!e.right){this.counter-=1;return}if(this.isRed(e.right)||this.isRed(e.right.left)||(e=this.moveRedRight(e)),0===this.comparator(t,e.key)){this.counter-=1;let t=this.min(e.right);e.value=t.value,e.key=t.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(e.left)return this.isRed(e.left)||this.isRed(e.left.left)||(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){let t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){let t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}constructor(e){this.comparator=void 0!==e?e:tO,this.counter=0}}class tq{static of(e,t){return new tq(e,t)}static fromTreePos(e){let t;let{offset:r}=e,{node:n}=e;return n.isText?(t=n.parent.children[0]===n&&0===r?n.parent:n,n=n.parent):t=0===r?n:n.children[r-1],tq.of(n.id,tM.of(t.getCreatedAt(),t.getOffset()+r))}getParentID(){return this.parentID}static fromStruct(e){return tq.of(tM.of(e9.fromStruct(e.parentID.createdAt),e.parentID.offset),tM.of(e9.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){let t=this.getParentID(),r=this.getLeftSiblingID(),n=e.findFloorNode(t),i=e.findFloorNode(r);if(!n||!i)throw new e0(eZ.ErrRefused,"cannot find node of CRDTTreePos(".concat(t.toTestString(),", ").concat(r.toTestString(),")"));return!r.equals(t)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[n,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}constructor(e,t){this.parentID=e,this.leftSiblingID=t}}class tM{static of(e,t){return new tM(e,t)}static fromStruct(e){return tM.of(e9.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{let r=e.getCreatedAt().compare(t.getCreatedAt());return 0!==r?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return 0===this.createdAt.compare(e.createdAt)&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return"".concat(this.createdAt.toIDString(),":").concat(this.offset)}toTestString(){return"".concat(this.createdAt.toTestString(),"/").concat(this.offset)}constructor(e,t){this.createdAt=e,this.offset=t}}class tK extends tR{toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,t,r,n){return new tK(e,t,r,n)}deepcopy(){var e;let t=new tK(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.visibleSize=this.visibleSize,t.totalSize=this.totalSize,t.attrs=null===(e=this.attrs)||void 0===e?void 0:e.deepcopy(),t._children=this._children.map(e=>{let r=e.deepcopy();return r.parent=t,r}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new e0(eZ.ErrInvalidType,"cannot get value of element node: ".concat(this.type));return this._value}set value(e){if(!this.isText)throw new e0(eZ.ErrInvalidType,"cannot set value of element node: ".concat(this.type));this._value=e,this.visibleSize=e.length,this.totalSize=e.length}get isRemoved(){return!!this.removedAt}remove(e){return this.removedAt?(e.after(this.removedAt)&&(this.removedAt=e),!1):(this.removedAt=e,this.updateAncestorsSize(-this.paddedSize()),!0)}cloneText(e){return new tK(tM.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new tK(tM.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,t,r){let[n,i]=this.isText?this.splitText(t,this.id.getOffset()):this.splitElement(t,r);return n&&(n.insPrevID=this.id,this.insNextID&&(e.findFloorNode(this.insNextID).insPrevID=n.id,n.insNextID=this.insNextID),this.insNextID=n.id,e.registerNode(n)),[n,i]}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,t,r){return!!t&&!!(!this.removedAt||!r&&(null==e?void 0:e.after(this.removedAt)))}canStyle(e,t){return!this.isText&&this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,t){this.attrs||(this.attrs=new tp);let r=[];for(let[n,i]of Object.entries(e))r.push(this.attrs.set(n,i,t));return r}purge(e){this.attrs&&this.attrs.purge(e)}getDataSize(){let e={data:0,meta:0};if(this.isText&&(e.data+=2*this.visibleSize),this.id&&(e.meta+=24),this.removedAt&&(e.meta+=24),this.attrs)for(let t of this.attrs){if(t.getRemovedAt())continue;let r=t.getDataSize();e.meta+=r.meta,e.data+=r.data}return e}getGCPairs(){let e=[];if(!this.attrs)return e;for(let t of this.attrs)t.getRemovedAt()&&e.push({parent:this,child:t});return e}constructor(e,t,r,n,i){super(t),this._value="",this.id=e,this.removedAt=i,n&&(this.attrs=n),"string"==typeof r?this.value=r:Array.isArray(r)&&(this._children=r)}}function tF(e){if(e.isText)return{type:e.type,value:e.value};let t={type:e.type,children:e.children.map(tF)};if(e.attrs){var r;t.attributes=tw(null===(r=e.attrs)||void 0===r?void 0:r.toObject())}return t}function tU(e){if(e.isText)return e.value;let t="";return e.attrs&&e.attrs.size()&&(t=" "+Array.from(e.attrs).filter(e=>!e.isRemoved()).sort((e,t)=>e.getKey().localeCompare(t.getKey())).map(e=>{let t=JSON.parse(e.getValue());return"string"==typeof t?"".concat(e.getKey(),'="').concat(t,'"'):"".concat(e.getKey(),'="').concat(e4(e.getValue()),'"')}).join(" ")),"<".concat(e.type).concat(t,">").concat(e.children.map(e=>tU(e)).join(""),"</").concat(e.type,">")}class tV extends e5{static create(e,t){return new tV(e,t)}findFloorNode(e){let t=this.nodeMapByID.floorEntry(e);if(t&&t.key.getCreatedAt().equals(e.getCreatedAt()))return t.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,t){let r={data:0,meta:0},[n,i]=e.toTreeNodePair(this),s=i,a=n===s,o=s.parent&&!a?s.parent:n;if(s.isText){let[,t]=s.split(this,e.getLeftSiblingID().getOffset()-s.id.getOffset());r=t}if(t){let e=o.allChildren,r=a?0:e.indexOf(s)+1;for(let n=r;n<e.length;n++){let r=e[n];if(!r.id.getCreatedAt().after(t))break;s=r}}return[[o,s],r]}style(e,t,r,n){let i={data:0,meta:0},[[s,a],o]=this.findNodesAndSplitText(e[0],r),[[c,l],h]=this.findNodesAndSplitText(e[1],r);tS(i,h,o);let d=[],u=t?tw(t):{},f=[];return this.traverseInPosRange(s,a,c,l,e=>{let[s,a]=e,o=s.getCreatedAt().getActorID(),c=0x7fffffffffffffffn;if(void 0!=n&&(c=n.get(o)?n.get(o):0n),s.canStyle(r,c)&&t){let e=s.setAttrs(t,r),n=e.reduce((e,t)=>{let[,r]=t;return r&&(e[r.getKey()]=u[r.getKey()]),e},{}),o=s.parent,c=s.prevSibling||s.parent;for(let[t]of(Object.keys(n).length>0&&d.push({type:"style",from:this.toIndex(o,c),to:this.toIndex(s,s),fromPath:this.toPath(o,c),toPath:this.toPath(s,s),actor:r.getActorID(),value:n}),e))t&&f.push({parent:s,child:t});for(let[e]of Object.entries(u)){var l;let t=null===(l=s.attrs)||void 0===l?void 0:l.getNodeMapByKey().get(e);void 0!==t&&a!==tN.End&&tS(i,t.getDataSize())}}}),[f,d,i]}removeStyle(e,t,r,n){let i={data:0,meta:0},[[s,a],o]=this.findNodesAndSplitText(e[0],r),[[c,l],h]=this.findNodesAndSplitText(e[1],r);tS(i,h,o);let d=[],u=[];return this.traverseInPosRange(s,a,c,l,e=>{let[i]=e,s=i.getCreatedAt().getActorID(),a=0x7fffffffffffffffn;if(void 0!=n&&(a=n.get(s)?n.get(s):0n),i.canStyle(r,a)&&t){for(let e of(i.attrs||(i.attrs=new tp),t))for(let t of i.attrs.remove(e,r))u.push({parent:i,child:t});let e=i.parent,n=i.prevSibling||i.parent;d.push({actor:r.getActorID(),type:"removeStyle",from:this.toIndex(e,n),to:this.toIndex(i,i),fromPath:this.toPath(e,n),toPath:this.toPath(i,i),value:t})}}),[u,d,i]}edit(e,t,r,n,i,s){let a={data:0,meta:0},[[o,c],l]=this.findNodesAndSplitText(e[0],n),[[h,d],u]=this.findNodesAndSplitText(e[1],n);tS(a,u,l);let f=this.toIndex(o,c),g=this.toPath(o,c),m=[],p=[],y=[];this.traverseInPosRange(o,c,h,d,(e,t)=>{let[r,i]=e;if(i===tN.Start&&!t)for(let e of r.children)y.push(e);let a=void 0===s,o=!1,c=null==s?void 0:s.get(r.id.getCreatedAt().getActorID());o=a||void 0!==c&&c>=r.id.getCreatedAt().getLamport();let l=!1;if(r.removedAt){let e=null==s?void 0:s.get(r.removedAt.getActorID());l=a||void 0!==e&&e>=r.removedAt.getLamport()}(r.canDelete(n,o,l)||m.includes(r.parent))&&((i===tN.Text||i===tN.Start)&&m.push(r),p.push([r,i]))},!0);let v=this.makeDeletionChanges(p,n),C=[];for(let e of m)e.remove(n),e.isRemoved&&C.push({parent:this,child:e});for(let e of y)e.removedAt||o.append(e);if(r>0){let e=0,t=o,s=c;for(;e<r;)t.split(this,t.findOffset(s)+1,i),s=t,t=t.parent,e++;v.push({type:"content",from:f,to:f,fromPath:g,toPath:g,actor:n.getActorID()})}if(null==t?void 0:t.length){let e=[],r=c;for(let i of t)r===o?o.insertAt(i,0):o.insertAfter(i,r),r=i,tB(i,e=>{o.isRemoved?(e.remove(n),C.push({parent:this,child:e})):tS(a,e.getDataSize()),this.nodeMapByID.put(e.id,e)}),i.isRemoved||e.push(i);if(e.length){let t=e.map(e=>tF(e));v.length&&v[v.length-1].from===f?v[v.length-1].value=t:v.push({type:"content",from:f,to:f,fromPath:g,toPath:g,actor:n.getActorID(),value:t})}}return[v,C,a]}editT(e,t,r,n,i){let s=this.findPos(e[0]),a=this.findPos(e[1]);return this.edit([s,a],t,r,n,i)}move(e,t,r){throw new e0(eZ.ErrUnimplemented,"not implemented: ".concat(e,", ").concat(t,", ").concat(r))}pathToTreePos(e){return this.indexTree.pathToTreePos(e)}purge(e){var t;null===(t=e.parent)||void 0===t||t.removeChild(e),this.nodeMapByID.remove(e.id);let r=e.insPrevID,n=e.insNextID;r&&(this.findFloorNode(r).insNextID=n),n&&(this.findFloorNode(n).insPrevID=r),e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){let e=[];return this.indexTree.traverse(t=>{for(let r of(t.getRemovedAt()&&e.push({parent:this,child:t}),t.getGCPairs()))e.push(r)}),e}findPos(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=this.indexTree.findTreePos(e,t);return tq.fromTreePos(r)}pathToPosRange(e){let t=this.pathToIndex(e);return[this.findPos(t),this.findPos(t+1)]}pathToPos(e){let t=this.indexTree.pathToIndex(e);return this.findPos(t)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return tU(this.indexTree.getRoot())}getDataSize(){let e={data:0,meta:0};return this.indexTree.traverse(t=>{if(t.getRemovedAt())return;let r=t.getDataSize();e.data+=r.data,e.meta+=r.meta}),{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){var e=this;let t=this.indexTree.getRoot(),r=function(t){var n,i,s,a;let o,c,l,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=t.isText?{node:t,offset:0}:h&&d?e.toTreePos(h,d):null;f&&(o=e.indexTree.indexOf(f),c=e.indexTree.treePosToPath(f),l=tq.fromTreePos(f).toStruct());let g={type:t.type,parent:null==h?void 0:h.id.toTestString(),size:t.visibleSize,id:t.id.toTestString(),removedAt:null===(n=t.removedAt)||void 0===n?void 0:n.toTestString(),insPrev:null===(i=t.insPrevID)||void 0===i?void 0:i.toTestString(),insNext:null===(s=t.insNextID)||void 0===s?void 0:s.toTestString(),value:t.isText?t.value:void 0,isRemoved:t.isRemoved,children:[],depth:u,attributes:t.attrs?tw(null===(a=t.attrs)||void 0===a?void 0:a.toObject()):void 0,index:o,path:c,pos:l};for(let e=0;e<t.allChildren.length;e++){let n=0===e?t:t.allChildren[e-1];g.children.push(r(t.allChildren[e],t,n,u+1))}return g};return r(t)}getRootTreeNode(){return tF(this.indexTree.getRoot())}toTestTreeNode(){return function e(t){return t.isText?{type:t.type,value:t.value,visibleSize:t.visibleSize,isRemoved:t.isRemoved}:{type:t.type,children:t.children.map(e),visibleSize:t.visibleSize,isRemoved:t.isRemoved}}(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){let e=new tV(this.getRoot().deepcopy(),this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}toPath(e,t){let r=this.toTreePos(e,t);return r?this.indexTree.treePosToPath(r):[]}toIndex(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.toTreePos(e,t,r);return n?this.indexTree.indexOf(n,r):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){let t=this.findPos(e[0]);return e[0]===e[1]?[t,t]:[t,this.findPos(e[1])]}indexRangeToPosStructRange(e){let[t,r]=e,n=this.findPos(t);return t===r?[n.toStruct(),n.toStruct()]:[n.toStruct(),this.findPos(r).toStruct()]}posRangeToPathRange(e){let[[t,r]]=this.findNodesAndSplitText(e[0]),[[n,i]]=this.findNodesAndSplitText(e[1]);return[this.toPath(t,r),this.toPath(n,i)]}posRangeToIndexRange(e){let[[t,r]]=this.findNodesAndSplitText(e[0]),[[n,i]]=this.findNodesAndSplitText(e[1]);return[this.toIndex(t,r),this.toIndex(n,i)]}traverseInPosRange(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=this.toIndex(e,t,s),o=this.toIndex(r,n,s);this.indexTree.tokensBetween(a,o,i,s)}toTreePos(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||!t)return;if(!r&&e.isRemoved){let t;for(;e.isRemoved;)e=(t=e).parent;let n=e.findOffset(t,r);return{node:e,offset:n}}if(e===t)return{node:e,offset:0};let n=e.findOffset(t,r);if(r||!t.isRemoved){if(t.isText)return{node:t,offset:t.paddedSize(r)};n++}return{node:e,offset:n}}makeDeletionChanges(e,t){let r=[],n=[],i=null,s=null;for(let t=0;t<e.length;t++){let r=e[t],a=e[t+1];i||(i=r),s=r;let o=this.findRightToken(r);o&&a&&o[0]===a[0]&&o[1]===a[1]||(n.push([i,s]),i=null,s=null)}for(let e of n){let[n,i]=e,[s,a]=this.findLeftToken(n),[o,c]=i,l=a===tN.Start?s:s.parent,h=c===tN.Start?o:o.parent,d=this.toIndex(l,s),u=this.toIndex(h,o);d<u&&(r.length>0&&d===r[r.length-1].to?(r[r.length-1].to=u,r[r.length-1].toPath=this.toPath(h,o)):r.push({type:"content",from:d,to:u,fromPath:this.toPath(l,s),toPath:this.toPath(h,o),actor:t.getActorID()}))}return r.reverse()}findRightToken(e){let[t,r]=e;if(r===tN.Start){let e=t.allChildren;return e.length>0?[e[0],e[0].isText?tN.Text:tN.Start]:[t,tN.End]}let n=t.parent,i=n.allChildren,s=i.indexOf(t);if(n&&s===i.length-1)return[n,tN.End];let a=i[s+1];return[a,a.isText?tN.Text:tN.Start]}findLeftToken(e){let[t,r]=e;if(r===tN.End){let e=t.allChildren;if(e.length>0){let t=e[e.length-1];return[t,t.isText?tN.Text:tN.End]}return[t,tN.Start]}let n=t.parent,i=n.allChildren,s=i.indexOf(t);if(n&&0===s)return[n,tN.Start];let a=i[s-1];return[a,a.isText?tN.Text:tN.End]}constructor(e,t){super(t),this.indexTree=new tJ(e),this.nodeMapByID=new tz(tM.createComparator()),this.indexTree.traverseAll(e=>{this.nodeMapByID.put(e.id,e)})}}class tj extends tr{static create(e,t,r,n,i,s){return new tj(e,t,r,n,i,s)}execute(e,t,r){var n;let i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(i instanceof tV))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only Tree can execute edit");let s=this.getExecutedAt(),[a,o,c]=i.edit([this.fromPos,this.toPos],null===(n=this.contents)||void 0===n?void 0:n.map(e=>e.deepcopy()),this.splitLevel,s,(()=>{let e=s.getDelimiter();return void 0!==this.contents&&(e+=this.contents.length),()=>e9.of(s.getLamport(),++e,s.getActorID())})(),r);for(let t of(e.acc(c),o))e.registerGCPair(t);return{opInfos:a.map(t=>{let{from:r,to:n,value:i,splitLevel:s,fromPath:a,toPath:o}=t;return{type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:r,to:n,value:i,splitLevel:s,fromPath:a,toPath:o}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t="".concat(this.fromPos.getLeftSiblingID().getCreatedAt().toTestString(),"/").concat(this.fromPos.getLeftSiblingID().getOffset()),r="".concat(this.toPos.getLeftSiblingID().getCreatedAt().toTestString(),"/").concat(this.toPos.getLeftSiblingID().getOffset()),n=this.contents||[];return"".concat(e,".EDIT(").concat(t,",").concat(r,",").concat(n.map(e=>tU(e)).join(""),")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}constructor(e,t,r,n,i,s){super(e,s),this.fromPos=t,this.toPos=r,this.contents=n,this.splitLevel=i}}class tW{set(e,t){this.vector.set(e,t)}unset(e){this.vector.delete(e)}get(e){return this.vector.get(e)}has(e){return this.vector.has(e)}maxLamport(){let e=BigInt(0);for(let[,t]of this)t>e&&(e=t);return e}max(e){let t=new Map;for(let[r,n]of e){let e=this.vector.get(r),i=e&&e>n?e:n;t.set(r,i)}for(let[r,n]of this){let i=e.get(r),s=i&&i>n?i:n;t.set(r,s)}return new tW(t)}afterOrEqual(e){let t=this.vector.get(e.getActorID());return void 0!==t&&t>=e.getLamport()}deepcopy(){let e=new Map;for(let[t,r]of this.vector)e.set(t,r);return new tW(e)}filter(e){let t=new Map;for(let[r]of e){let e=this.vector.get(r);void 0!==e&&t.set(r,e)}return new tW(t)}size(){return this.vector.size}*[Symbol.iterator](){for(let[e,t]of this.vector)yield[e,t]}constructor(e){this.vector=e||new Map}}let tQ=new tW(new Map);class tG{hasClocks(){return this.versionVector.size()>0&&0n!=this.lamport}static of(e,t,r,n,i){return new tG(e,t,r,n,i)}next(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(e)return new tG(this.clientSeq+1,this.lamport,this.actor,tQ,0n);let t=this.versionVector.deepcopy();return t.set(this.actor,this.lamport+1n),new tG(this.clientSeq+1,this.lamport+1n,this.actor,t)}syncClocks(e){if(!e.hasClocks())return this;let t=e.lamport>this.lamport?e.lamport+1n:this.lamport+1n,r=this.versionVector.max(e.versionVector),n=new tG(this.clientSeq,t,this.actor,r);return n.versionVector.set(this.actor,t),n}setClocks(e,t){let r=e>this.lamport?e+1n:this.lamport+1n,n=this.versionVector.max(t);return n.set(this.actor,r),tG.of(this.clientSeq,r,this.actor,n)}createTimeTicket(e){return e9.of(this.lamport,e,this.actor)}setActor(e){return new tG(this.clientSeq,this.lamport,e,this.versionVector,this.serverSeq)}setLamport(e){return new tG(this.clientSeq,e,this.actor,this.versionVector,this.serverSeq)}setVersionVector(e){return new tG(this.clientSeq,this.lamport,this.actor,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}getVersionVector(){return this.versionVector}toTestString(){return"".concat(this.lamport.toString(),":").concat(this.actor.slice(-2),":").concat(this.clientSeq)}constructor(e,t,r,n,i){this.clientSeq=e,this.serverSeq=i,this.lamport=t,this.versionVector=n,this.actor=r}}let tH=new tG(0,0n,e2,tQ);class tY{static create(e){let{id:t,operations:r,presenceChange:n,message:i}=e;return new tY({id:t,operations:r,presenceChange:n,message:i})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(let t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return void 0!==this.presenceChange}getPresenceChange(){return this.presenceChange}execute(e,t,r){let n=[],i=[];for(let t of this.operations){let s=t.execute(e,r,this.id.getVersionVector());if(!s)continue;let{opInfos:a,reverseOp:o}=s;n.push(...a),o&&i.unshift(o)}return this.presenceChange&&(this.presenceChange.type===e1.Put?t.set(this.id.getActorID(),ty(this.presenceChange.presence)):t.delete(this.id.getActorID())),{opInfos:n,reverseOps:i}}toTestString(){return"".concat(this.operations.map(e=>e.toTestString()).join(","))}toStruct(){return{changeID:rL.bytesToHex(rL.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(e=>rL.bytesToHex(rL.toOperation(e).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(e){let{changeID:t,operations:r,presenceChange:n,message:i}=e;return tY.create({id:rL.bytesToChangeID(rL.hexToBytes(t)),operations:null==r?void 0:r.map(e=>rL.bytesToOperation(rL.hexToBytes(e))),presenceChange:n,message:i})}constructor({id:e,operations:t,presenceChange:r,message:n}){this.id=e,this.operations=t||[],this.presenceChange=r,this.message=n}}class tX{static create(e,t,r,n,i,s){return new tX(e,t,r,n,i,s)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getVersionVector(){return this.versionVector}constructor(e,t,r,n,i,s){this.documentKey=e,this.checkpoint=t,this.isRemoved=r,this.changes=n,this.snapshot=s,this.versionVector=i}}class t${static of(e,t){return new t$(e,t)}increaseClientSeq(e){return 0===e?this:new t$(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;let t=this.serverSeq>e.serverSeq?this.serverSeq:e.serverSeq,r=Math.max(this.clientSeq,e.clientSeq);return t$.of(t,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq==e.serverSeq}toTestString(){return"serverSeq=".concat(this.serverSeq,", clientSeq=").concat(this.clientSeq)}constructor(e,t){this.serverSeq=e,this.clientSeq=t}}let tZ=new t$(0n,0);class t0{static of(e,t){return new t0(e,t)}static fromStruct(e){return t0.of(e9.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return 0===this.createdAt.compare(e.createdAt)&&this.offset===e.offset}hasSameCreatedAt(e){return 0===this.createdAt.compare(e.createdAt)}split(e){return new t0(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return"".concat(this.createdAt.toTestString(),":").concat(this.offset)}toIDString(){return"".concat(this.createdAt.toIDString(),":").concat(this.offset)}constructor(e,t){this.createdAt=e,this.offset=t}}let t1=t0.of(e3,0);class t2{static of(e,t){return new t2(e,t)}static fromStruct(e){let t=t0.fromStruct(e.id);return t2.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return t0.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return"".concat(this.id.toTestString(),":").concat(this.relativeOffset)}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return!!this.id.equals(e.id)&&this.relativeOffset===e.relativeOffset}constructor(e,t){this.id=e,this.relativeOffset=t}}class t9 extends tn{static create(e,t){return new t9(e,t)}static createComparator(){return(e,t)=>{let r=e.getCreatedAt().compare(t.getCreatedAt());return 0!==r?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new t9(this.id.split(e),this.splitValue(e),this.removedAt)}canRemove(e,t,r){return!!t&&!!(!this.removedAt||!r&&(null==e?void 0:e.after(this.removedAt)))}canStyle(e,t){return this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}setRemovedAt(e){this.removedAt=e}remove(e){if(!this.removedAt){this.removedAt=e;return}e.after(this.removedAt)&&(this.removedAt=e)}createPosRange(){return[t2.of(this.id,0),t2.of(this.id,this.getLength())]}getDataSize(){let e=this.value.getDataSize();return this.id&&(e.meta+=24),this.removedAt&&(e.meta+=24),e}deepcopy(){return new t9(this.id,this.value,this.removedAt)}toTestString(){return"".concat(this.id.toTestString()," ").concat(this.value?this.value:"")}splitValue(e){let t=this.value;return this.value=t.substring(0,e),t.substring(e,t.length)}toIDString(){return this.id.toIDString()}constructor(e,t,r){super(t),this.id=e,this.removedAt=r}}class t3{static create(){return new t3}edit(e,t,r,n){let i={data:0,meta:0},[s,a,o]=this.findNodeWithSplit(e[1],t),[c,l,h]=this.findNodeWithSplit(e[0],t);tS(i,a,l);let d=this.findBetween(h,o),[u,f]=this.deleteNodes(d,t,n),g=o?o.getID():s.getID(),m=t2.of(g,0);if(r){let e=this.posToIndex(c.createPosRange()[1],!0),n=this.insertAfter(c,t9.create(t0.of(t,0),r));tS(i,n.getDataSize()),u.length&&u[u.length-1].from===e?u[u.length-1].value=r:u.push({actor:t.getActorID(),from:e,to:e,value:r}),m=t2.of(n.getID(),n.getContentLength())}let p=[];for(let[,e]of f)p.push({parent:this,child:e});return[m,p,i,u]}indexToPos(e){let[t,r]=this.treeByIndex.find(e);return t2.of(t.getID(),r)}findIndexesFromRange(e){let[t,r]=e;return[this.posToIndex(t,!1),this.posToIndex(r,!0)]}posToIndex(e,t){let r=e.getAbsoluteID(),n=t?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!n)throw new e0(eZ.ErrInvalidArgument,"the node of the given id should be found: ".concat(r.toTestString()));return this.treeByIndex.indexOf(n)+(n.isRemoved()?0:r.getOffset()-n.getID().getOffset())}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){let e=[];for(let t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){let e;let t=new t3,r=this.head.getNext(),n=t.head;for(;r;){if(e=t.insertAfter(n,r.deepcopy()),r.hasInsPrev()){let n=t.findNode(r.getInsPrevID());e.setInsPrev(n)}n=e,r=r.getNext()}return t}toTestString(){let e=[],t=this.head;for(;t;)t.isRemoved()?e.push("{".concat(t.toTestString(),"}")):e.push("[".concat(t.toTestString(),"]")),t=t.getNext();return e.join("")}insertAfter(e,t){let r=e.getNext();return t.setPrev(e),r&&r.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){let r=e.getAbsoluteID(),n=this.findFloorNodePreferToLeft(r),i=r.getOffset()-n.getID().getOffset(),[,s]=this.splitNode(n,i);for(;n.hasNext()&&n.getNext().getCreatedAt().after(t);)n=n.getNext();return[n,s,n.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(!t)throw new e0(eZ.ErrInvalidArgument,"the node of the given id should be found: ".concat(e.toTestString()));if(e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){let t=this.treeByID.floorEntry(e);if(t&&(t.key.equals(e)||t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){let r=[],n=e;for(;n&&n!==t;)r.push(n),n=n.getNext();return r}splitNode(e,t){let r={data:0,meta:0};if(t>e.getContentLength())throw new e0(eZ.ErrInvalidArgument,"offset should be less than or equal to length");if(0===t)return[e,r];if(t===e.getContentLength())return[e.getNext(),r];let n=e.getDataSize(),i=e.split(t);this.treeByIndex.updateWeight(i),this.insertAfter(e,i);let s=e.getInsNext();return s&&s.setInsPrev(i),i.setInsPrev(e),tS(r,e.getDataSize(),i.getDataSize()),tT(r,n),[i,r]}deleteNodes(e,t,r){if(!e.length)return[[],new Map];let n=void 0===r||0===r.size(),i=[],s=[],[a,o]=this.findEdgesOfCandidates(e);for(let o of(s.push(a),e)){let e=!1;if(n)e=!0;else{let t=null==r?void 0:r.get(o.getCreatedAt().getActorID());t&&t>=o.getCreatedAt().getLamport()&&(e=!0)}let a=!1;if(o.getRemovedAt()){let e=null==r?void 0:r.get(o.getRemovedAt().getActorID());n?a=!0:e&&e>=o.getRemovedAt().getLamport()&&(a=!0)}o.canRemove(t,e,a)?i.push(o):s.push(o)}s.push(o);let c=this.makeChanges(s,t),l=new Map;for(let e of i)l.set(e.getID().toIDString(),e),e.remove(t);return this.deleteIndexNodes(s),[c,l]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){let r,n;let i=[];for(let s=0;s<e.length-1;s++){let a=e[s],o=e[s+1];a.getNext()!=o&&([r]=this.findIndexesFromRange(a.getNext().createPosRange()),o?[,n]=this.findIndexesFromRange(o.getPrev().createPosRange()):n=this.treeByIndex.length,r<n&&i.push({actor:t.getActorID(),from:r,to:n}))}return i.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){let r=e[t],n=e[t+1];r.getNext()!=n&&this.treeByIndex.deleteRange(r,n)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());let t=e.getPrev(),r=e.getNext(),n=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(r),r&&r.setPrev(t),e.setPrev(void 0),e.setNext(void 0),n&&n.setInsNext(i),i&&i.setInsPrev(n),e.setInsPrev(void 0),e.setInsNext(void 0)}constructor(){this.head=t9.create(t1),this.treeByIndex=new ti,this.treeByID=new tz(t9.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}}let t4=e=>e<0?Math.ceil(e):Math.floor(e);var t5=function(e){return e[e.Int=0]="Int",e[e.Long=1]="Long",e}({});class t8 extends e5{static create(e,t,r){return new t8(e,t,r)}static valueFromBytes(e,t){switch(e){case 0:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 1:return ts.A.fromBytesLE(Array.from(t));default:throw new e0(eZ.ErrUnimplemented,"unimplemented type: ".concat(e))}}getDataSize(){return{data:0===this.valueType?4:8,meta:this.getMetaUsage()}}toJSON(){return"".concat(this.value)}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){let e=t8.create(this.valueType,this.value,this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":if(e instanceof ts.A)return 1;return;case"number":if(e>0x7fffffff||e<-0x80000000)return 1;return 0;default:return}}static isSupport(e){return!!t8.getCounterType(e)}static isInteger(e){return e%1==0}isNumericType(){let e=this.valueType;return 0===e||1===e}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{let e=this.value;return new Uint8Array([255&e,e>>8&255,e>>16&255,e>>24&255])}case 1:{let e=this.value.toBytesLE();return Uint8Array.from(e)}default:throw new e0(eZ.ErrUnimplemented,"unimplemented type: ".concat(this.valueType))}}increase(e){function t(e){if(!e.isNumericType())throw TypeError("Unsupported type of value: ".concat(typeof e.getValue()))}return t(this),t(e),1===this.valueType?this.value=this.value.add(e.getValue()):e.getType()===ta.Long?this.value=this.value+e.getValue().toInt():this.value=ts.A.fromNumber(this.value+t4(e.getValue())).toInt(),this}constructor(e,t,r){switch(super(r),this.valueType=e,e){case 0:"number"==typeof t?t>0x7fffffff||t<-0x80000000?this.value=ts.A.fromNumber(t).toInt():this.value=t4(t):this.value=t.toInt();break;case 1:"number"==typeof t?this.value=ts.A.fromNumber(t):this.value=t;break;default:throw new e0(eZ.ErrUnimplemented,"unimplemented type: ".concat(e))}}}class t6 extends tr{static create(e,t,r){return new t6(e,t,r)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof t8))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only Counter can execute increase");let r=this.value.deepcopy();return t.increase(r),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:r.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){let e=this.value.deepcopy(),t=e.getType()===ta.Long?e.getValue().multiply(-1):-1*e.getValue();return t6.create(this.getParentCreatedAt(),to.of(t,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".INCREASE.").concat(this.value.toJSON())}getValue(){return this.value}constructor(e,t,r){super(e,r),this.value=t}}class t7 extends tr{static create(e,t,r,n,i){return new t7(e,t,r,n,[],i)}static createTreeRemoveStyleOperation(e,t,r,n,i){return new t7(e,t,r,new Map,n,i)}execute(e,t,r){let n,i;let s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(s instanceof tV))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only Tree can execute edit");let a={data:0,meta:0};if(this.attributes.size){let e={};[...this.attributes].forEach(t=>{let[r,n]=t;return e[r]=n}),[i,n,a]=s.style([this.fromPos,this.toPos],e,this.getExecutedAt(),r)}else{let e=this.attributesToRemove;[i,n,a]=s.removeStyle([this.fromPos,this.toPos],e,this.getExecutedAt(),r)}for(let t of(e.acc(a),i))e.registerGCPair(t);return{opInfos:n.map(t=>{let{from:r,to:n,value:i,fromPath:s,toPath:a}=t;return{type:"tree-style",from:r,to:n,value:this.attributes.size?{attributes:i}:{attributesToRemove:i},fromPath:s,toPath:a,path:e.createPath(this.getParentCreatedAt())}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t="".concat(this.fromPos.getLeftSiblingID().getCreatedAt().toTestString(),":").concat(this.fromPos.getLeftSiblingID().getOffset()),r="".concat(this.toPos.getLeftSiblingID().getCreatedAt().toTestString(),":").concat(this.toPos.getLeftSiblingID().getOffset());return"".concat(e,".STYLE(").concat(t,",").concat(r,",").concat(Object.entries(this.attributes||{}).map(e=>{let[t,r]=e;return"".concat(t,':"').concat(r,'"')}).join(" "),")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}constructor(e,t,r,n,i,s){super(e,s),this.fromPos=t,this.toPos=r,this.attributes=n,this.attributesToRemove=i}}class re extends tr{static create(e,t,r,n){return new re(e,t,r,n)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e0(eZ.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof th))throw new e0(eZ.ErrInvalidArgument,"fail to execute, only array can execute set");let r=t.getByID(this.createdAt).deepcopy(),n=this.toReverseOperation(this.value,r),i=this.value.deepcopy();return t.insertAfter(this.createdAt,i,this.getExecutedAt()),t.delete(this.createdAt,this.getExecutedAt()),e.registerElement(i),{opInfos:[{type:"array-set",path:e.createPath(this.getParentCreatedAt())}],reverseOp:n}}toReverseOperation(e,t){return re.create(this.getParentCreatedAt(),e.getCreatedAt(),t)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".ARRAY_SET.").concat(this.createdAt.toTestString(),"=").concat(this.value.toSortedJSON())}getCreatedAt(){return this.createdAt}getValue(){return this.value}setCreatedAt(e){this.createdAt=e}constructor(e,t,r,n){super(e,n),this.createdAt=t,this.value=r}}function rt(e){return new v({clientSeq:e.getClientSeq(),lamport:e.getLamport(),actorId:r_(e.getActorID()),versionVector:rn(e.getVersionVector())})}function rr(e){if(e)return new ec({lamport:e.getLamport(),delimiter:e.getDelimiter(),actorId:r_(e.getActorID())})}function rn(e){if(!e)return;let t=new C;for(let[r,n]of e){let e=function(e){if("function"==typeof window.btoa){let t="";for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return window.btoa(t)}if("undefined"!=typeof globalThis&&void 0!==globalThis.Buffer)return globalThis.Buffer.from(e).toString("base64");throw Error("No base64 encoder available")}(r_(r));t.vector[e]=BigInt(n.toString())}return t}function ri(e){switch(e){case ta.Null:return f.NULL;case ta.Boolean:return f.BOOLEAN;case ta.Integer:return f.INTEGER;case ta.Long:return f.LONG;case ta.Double:return f.DOUBLE;case ta.String:return f.STRING;case ta.Bytes:return f.BYTES;case ta.Date:return f.DATE;default:throw new e0(eZ.ErrInvalidType,"unsupported type: ".concat(e))}}function rs(e){switch(e){case t5.Int:return f.INTEGER_CNT;case t5.Long:return f.LONG_CNT;default:throw new e0(eZ.ErrInvalidType,"unsupported type: ".concat(e))}}function ra(e){if(e instanceof te)return new R({type:f.JSON_OBJECT,createdAt:rr(e.getCreatedAt()),value:function(e){return rg(e).toBinary()}(e)});if(e instanceof th)return new R({type:f.JSON_ARRAY,createdAt:rr(e.getCreatedAt()),value:ru(e).toBinary()});if(e instanceof tb)return new R({type:f.TEXT,createdAt:rr(e.getCreatedAt())});if(e instanceof to)return new R({type:ri(e.getType()),createdAt:rr(e.getCreatedAt()),value:e.toBytes()});if(e instanceof t8)return new R({type:rs(e.getType()),createdAt:rr(e.getCreatedAt()),value:e.toBytes()});if(e instanceof tV)return new R({type:f.TREE,createdAt:rr(e.getCreatedAt()),value:rf(e).toBinary()});throw new e0(eZ.ErrUnimplemented,"unimplemented element")}function ro(e){return new eo({createdAt:rr(e.getID().getCreatedAt()),offset:e.getID().getOffset(),relativeOffset:e.getRelativeOffset()})}function rc(e){return new Q({parentId:rl(e.getParentID()),leftSiblingId:rl(e.getLeftSiblingID())})}function rl(e){return new W({createdAt:rr(e.getCreatedAt()),offset:e.getOffset()})}function rh(e){let t=new w;if(e instanceof tf){let r=new A;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.key=e.getKey(),r.value=ra(e.getValue()),r.executedAt=rr(e.getExecutedAt()),t.body.case="set",t.body.value=r}else if(e instanceof td){let r=new S;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.prevCreatedAt=rr(e.getPrevCreatedAt()),r.value=ra(e.getValue()),r.executedAt=rr(e.getExecutedAt()),t.body.case="add",t.body.value=r}else if(e instanceof tg){let r=new T;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.prevCreatedAt=rr(e.getPrevCreatedAt()),r.createdAt=rr(e.getCreatedAt()),r.executedAt=rr(e.getExecutedAt()),t.body.case="move",t.body.value=r}else if(e instanceof tu){let r=new x;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.createdAt=rr(e.getCreatedAt()),r.executedAt=rr(e.getExecutedAt()),t.body.case="remove",t.body.value=r}else if(e instanceof tk){let r=new I;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.from=ro(e.getFromPos()),r.to=ro(e.getToPos()),r.content=e.getContent();let n=r.attributes;for(let[t,r]of e.getAttributes())n[t]=r;r.executedAt=rr(e.getExecutedAt()),t.body.case="edit",t.body.value=r}else if(e instanceof tP){let r=new b;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.from=ro(e.getFromPos()),r.to=ro(e.getToPos());let n=r.attributes;for(let[t,r]of e.getAttributes())n[t]=r;r.executedAt=rr(e.getExecutedAt()),t.body.case="style",t.body.value=r}else if(e instanceof t6){let r=new k;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.value=ra(e.getValue()),r.executedAt=rr(e.getExecutedAt()),t.body.case="increase",t.body.value=r}else if(e instanceof tj){let r=new P;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.from=rc(e.getFromPos()),r.to=rc(e.getToPos()),r.contents=function(e){let t=[];if(!e||!e.length)return t;for(let r of e)t.push(new j({content:rd(r)}));return t}(e.getContents()),r.splitLevel=e.getSplitLevel(),r.executedAt=rr(e.getExecutedAt()),t.body.case="treeEdit",t.body.value=r}else if(e instanceof t7){let r=new E;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.from=rc(e.getFromPos()),r.to=rc(e.getToPos());let n=e.getAttributesToRemove();if(n.length>0)r.attributesToRemove=n;else{let t=r.attributes;for(let[r,n]of e.getAttributes())t[r]=n}r.executedAt=rr(e.getExecutedAt()),t.body.case="treeStyle",t.body.value=r}else if(e instanceof re){let r=new D;r.parentCreatedAt=rr(e.getParentCreatedAt()),r.createdAt=rr(e.getCreatedAt()),r.value=ra(e.getValue()),r.executedAt=rr(e.getExecutedAt()),t.body.case="arraySet",t.body.value=r}else throw new e0(eZ.ErrUnimplemented,"unimplemented operation");return t}function rd(e){if(!e)return[];let t=[];return tB(e,(e,r)=>{let n=new V({id:rl(e.id),type:e.type,removedAt:rr(e.removedAt),depth:r});e.isText&&(n.value=e.value),e.insPrevID&&(n.insPrevId=rl(e.insPrevID)),e.insNextID&&(n.insNextId=rl(e.insNextID)),e.attrs&&(n.attributes=function(e){let t={};for(let r of e)t[r.getKey()]=new K({value:r.getValue(),updatedAt:rr(r.getUpdatedAt()),isRemoved:r.isRemoved()});return t}(e.attrs)),t.push(n)}),t}function ru(e){let t=new N;return t.body.case="jsonArray",t.body.value=new J({nodes:function(e){let t=[];for(let r of e)t.push(new M({element:rg(r.getValue())}));return t}(e.getElements()),createdAt:rr(e.getCreatedAt()),movedAt:rr(e.getMovedAt()),removedAt:rr(e.getRemovedAt())}),t}function rf(e){let t=new N;return t.body.case="tree",t.body.value=new z({nodes:rd(e.getRoot()),createdAt:rr(e.getCreatedAt()),movedAt:rr(e.getMovedAt()),removedAt:rr(e.getRemovedAt())}),t}function rg(e){if(e instanceof te)return function(e){let t=new N;return t.body.case="jsonObject",t.body.value=new B({nodes:function(e){let t=[];for(let r of e)t.push(new q({key:r.getStrKey(),element:rg(r.getValue())}));return t}(e.getRHT()),createdAt:rr(e.getCreatedAt()),movedAt:rr(e.getMovedAt()),removedAt:rr(e.getRemovedAt())}),t}(e);if(e instanceof th)return ru(e);if(e instanceof to)return function(e){let t=new N;return t.body.case="primitive",t.body.value=new O({type:ri(e.getType()),value:e.toBytes(),createdAt:rr(e.getCreatedAt()),movedAt:rr(e.getMovedAt()),removedAt:rr(e.getRemovedAt())}),t}(e);if(e instanceof tb)return function(e){let t=new N;return t.body.case="text",t.body.value=new _({nodes:function(e){let t=[];for(let n of e){var r;let e=new F;e.id=new U({createdAt:rr((r=n.getID()).getCreatedAt()),offset:r.getOffset()}),e.value=n.getValue().getContent(),e.removedAt=rr(n.getRemovedAt());let i=e.attributes;for(let e of n.getValue().getAttrs()){let t=new K;t.value=e.getValue(),t.updatedAt=rr(e.getUpdatedAt()),i[e.getKey()]=t}t.push(e)}return t}(e.getRGATreeSplit()),createdAt:rr(e.getCreatedAt()),movedAt:rr(e.getMovedAt()),removedAt:rr(e.getRemovedAt())}),t}(e);if(e instanceof t8)return function(e){let t=new N;return t.body.case="counter",t.body.value=new L({type:rs(e.getType()),value:e.toBytes(),createdAt:rr(e.getCreatedAt()),movedAt:rr(e.getMovedAt()),removedAt:rr(e.getRemovedAt())}),t}(e);if(e instanceof tV)return rf(e);throw new e0(eZ.ErrUnimplemented,"unimplemented element")}function rm(e){if(!(e instanceof i.T))return{};for(let t of e.findDetails(e$.bx))return t.metadata;return{}}function rp(e){var t;return null!==(t=rm(e).code)&&void 0!==t?t:""}function ry(e,t){return e instanceof i.T&&rp(e)===t}function rv(e){return tG.of(e.clientSeq,BigInt(e.lamport),rO(e.actorId),rC(e.versionVector),BigInt(e.serverSeq))}function rC(e){if(!e)return;let t=new tW;return Object.entries(e.vector).forEach(e=>{let[r,n]=e,i=rO(function(e){if("function"==typeof window.atob){let t=window.atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return n}if("undefined"!=typeof globalThis&&void 0!==globalThis.Buffer)return new Uint8Array(globalThis.Buffer.from(e,"base64"));throw Error("No base64 decoder available")}(r));t.set(i,BigInt(n.toString()))}),t}function rw(e){if(e)return e9.of(BigInt(e.lamport),e.delimiter,rO(e.actorId))}function rA(e){let t={};return Object.entries(e.data).forEach(e=>{let[r,n]=e;t[r]=JSON.parse(n)}),t}function rS(e){switch(e){case f.NULL:return ta.Null;case f.BOOLEAN:return ta.Boolean;case f.INTEGER:return ta.Integer;case f.LONG:return ta.Long;case f.DOUBLE:return ta.Double;case f.STRING:return ta.String;case f.BYTES:return ta.Bytes;case f.DATE:return ta.Date}throw new e0(eZ.ErrUnimplemented,"unimplemented value type: ".concat(e))}function rT(e){switch(e){case f.INTEGER_CNT:return t5.Int;case f.LONG_CNT:return t5.Long}throw new e0(eZ.ErrUnimplemented,"unimplemented value type: ".concat(e))}function rx(e){switch(e.type){case f.JSON_OBJECT:if(!e.value)return te.create(rw(e.createdAt));return function(e){if(!e)throw new e0(eZ.ErrInvalidArgument,"bytes is empty");return rR(N.fromBinary(e).body.value)}(e.value);case f.JSON_ARRAY:if(!e.value)return th.create(rw(e.createdAt));return function(e){if(!e)throw new e0(eZ.ErrInvalidArgument,"bytes is empty");return rN(N.fromBinary(e).body.value)}(e.value);case f.TEXT:return tb.create(t3.create(),rw(e.createdAt));case f.TREE:return function(e){if(!e)throw new e0(eZ.ErrInvalidArgument,"bytes is empty");return rB(N.fromBinary(e).body.value)}(e.value);case f.NULL:case f.BOOLEAN:case f.INTEGER:case f.LONG:case f.DOUBLE:case f.STRING:case f.BYTES:case f.DATE:return to.of(to.valueFromBytes(rS(e.type),e.value),rw(e.createdAt));case f.INTEGER_CNT:case f.LONG_CNT:return t8.create(rT(e.type),t8.valueFromBytes(rT(e.type),e.value),rw(e.createdAt))}}function rI(e){return t2.of(t0.of(rw(e.createdAt),e.offset),e.relativeOffset)}function rb(e){return t0.of(rw(e.createdAt),e.offset)}function rk(e){return tq.of(rP(e.parentId),rP(e.leftSiblingId))}function rP(e){return tM.of(rw(e.createdAt),e.offset)}function rE(e){if(0===e.length)return;let t=[];for(let r of e)t.push(function(e){let t=rP(e.id),r=tK.create(t,e.type),n=Object.entries(e.attributes);return r.isText?r.value=e.value:n.length&&(r.attrs=function(e){let t=tp.create();for(let[r,n]of Object.entries(e))t.setInternal(r,n.value,rw(n.updatedAt),n.isRemoved);return t}(e.attributes)),e.insPrevId&&(r.insPrevID=rP(e.insPrevId)),e.insNextId&&(r.insNextID=rP(e.insNextId)),r.removedAt=rw(e.removedAt),r}(r));let r=t[t.length-1],n=new Map;n.set(e[t.length-1].depth,t[t.length-1]);for(let r=t.length-2;r>=0;r--)n.get(e[r].depth-1).prepend(t[r]),n.set(e[r].depth,t[r]);return r.updateDescendantsSize(),r.updateDescendantsSize(!0),tV.create(r,e3).getRoot()}function rD(e){if("set"===e.body.case){let t=e.body.value;return tf.create(t.key,rx(t.value),rw(t.parentCreatedAt),rw(t.executedAt))}if("add"===e.body.case){let t=e.body.value;return td.create(rw(t.parentCreatedAt),rw(t.prevCreatedAt),rx(t.value),rw(t.executedAt))}if("move"===e.body.case){let t=e.body.value;return tg.create(rw(t.parentCreatedAt),rw(t.prevCreatedAt),rw(t.createdAt),rw(t.executedAt))}if("remove"===e.body.case){let t=e.body.value;return tu.create(rw(t.parentCreatedAt),rw(t.createdAt),rw(t.executedAt))}if("edit"===e.body.case){let t=e.body.value,r=new Map;return Object.entries(t.attributes).forEach(e=>{let[t,n]=e;r.set(t,n)}),tk.create(rw(t.parentCreatedAt),rI(t.from),rI(t.to),t.content,r,rw(t.executedAt))}else if("style"===e.body.case){let t=e.body.value,r=new Map;return Object.entries(t.attributes).forEach(e=>{let[t,n]=e;r.set(t,n)}),tP.create(rw(t.parentCreatedAt),rI(t.from),rI(t.to),r,rw(t.executedAt))}else if("increase"===e.body.case){let t=e.body.value;return t6.create(rw(t.parentCreatedAt),rx(t.value),rw(t.executedAt))}else if("treeEdit"===e.body.case){let t=e.body.value;return tj.create(rw(t.parentCreatedAt),rk(t.from),rk(t.to),function(e){if(!e.length)return;let t=[];return e.forEach(e=>{let r=rE(e.content);t.push(r)}),t}(t.contents),t.splitLevel,rw(t.executedAt))}else if("treeStyle"===e.body.case){let t=e.body.value,r=new Map,n=t.attributesToRemove;return(null==n?void 0:n.length)>0?t7.createTreeRemoveStyleOperation(rw(t.parentCreatedAt),rk(t.from),rk(t.to),n,rw(t.executedAt)):(Object.entries(t.attributes).forEach(e=>{let[t,n]=e;r.set(t,n)}),t7.create(rw(t.parentCreatedAt),rk(t.from),rk(t.to),r,rw(t.executedAt)))}else if("arraySet"===e.body.case){let t=e.body.value;return re.create(rw(t.parentCreatedAt),rw(t.createdAt),rx(t.value),rw(t.executedAt))}else throw new e0(eZ.ErrUnimplemented,"unimplemented operation")}function rR(e){let t=new e7;for(let r of e.nodes){let e=rJ(r.element);t.set(r.key,e,e.getPositionedAt())}let r=new te(rw(e.createdAt),t);return r.setMovedAt(rw(e.movedAt)),r.setRemovedAt(rw(e.removedAt)),r}function rN(e){let t=new tl;for(let r of e.nodes)t.insert(rJ(r.element));let r=new th(rw(e.createdAt),t);return r.setMovedAt(rw(e.movedAt)),r.setRemovedAt(rw(e.removedAt)),r}function rB(e){let t=rE(e.nodes);return tV.create(t,rw(e.createdAt))}function rJ(e){if("jsonObject"===e.body.case)return rR(e.body.value);if("jsonArray"===e.body.case)return rN(e.body.value);if("primitive"===e.body.case)return function(e){let t=to.of(to.valueFromBytes(rS(e.type),e.value),rw(e.createdAt));return t.setMovedAt(rw(e.movedAt)),t.setRemovedAt(rw(e.removedAt)),t}(e.body.value);if("text"===e.body.case)return function(e){let t=new t3,r=t.getHead();for(let n of e.nodes){let e=t.insertAfter(r,function(e){let t=tI.create(e.value);Object.entries(e.attributes).forEach(e=>{let[r,n]=e;t.setAttr(r,n.value,rw(n.updatedAt))});let r=t9.create(rb(e.id),t);return r.setRemovedAt(rw(e.removedAt)),r}(n));n.insPrevId&&e.setInsPrev(t.findNode(rb(n.insPrevId))),r=e}let n=new tb(t,rw(e.createdAt));return n.setMovedAt(rw(e.movedAt)),n.setRemovedAt(rw(e.removedAt)),n}(e.body.value);if("counter"===e.body.case)return function(e){let t=t8.create(rT(e.type),t8.valueFromBytes(rT(e.type),e.value),rw(e.createdAt));return t.setMovedAt(rw(e.movedAt)),t.setRemovedAt(rw(e.removedAt)),t}(e.body.value);else if("tree"===e.body.case)return rB(e.body.value);else throw new e0(eZ.ErrUnimplemented,"unimplemented element")}function rO(e){return e?Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function r_(e){return new Uint8Array(e.match(/.{1,2}/g).map(e=>parseInt(e,16)))}let rL={toChangePack:function(e){var t;return new p({documentKey:e.getDocumentKey(),checkpoint:new ea({serverSeq:(t=e.getCheckpoint()).getServerSeq(),clientSeq:t.getClientSeq()}),isRemoved:e.getIsRemoved(),changes:function(e){let t=[];for(let r of e)t.push(function(e){let t=new y({id:rt(e.getID()),message:e.getMessage()});return e.hasOperations()&&(t.operations=function(e){let t=[];for(let r of e)t.push(rh(r));return t}(e.getOperations())),e.hasPresenceChange()&&(t.presenceChange=function(e){if(e.type===e1.Put)return new er({type:en.PUT,presence:function(e){let t=new ei,r=t.data;for(let[t,n]of Object.entries(e))r[t]=JSON.stringify(n);return t}(e.presence)});if(e.type===e1.Clear)return new er({type:en.CLEAR});throw new e0(eZ.ErrUnimplemented,"unimplemented type")}(e.getPresenceChange())),t}(r));return t}(e.getChanges()),snapshot:e.getSnapshot(),versionVector:rn(e.getVersionVector())})},fromChangePack:function(e){var t;return tX.create(e.documentKey,(t=e.checkpoint,t$.of(BigInt(t.serverSeq),t.clientSeq)),e.isRemoved,function(e){let t=[];for(let r of e)t.push(tY.create({id:rv(r.id),operations:function(e){let t=[];for(let r of e){let e=rD(r);e&&t.push(e)}return t}(r.operations),presenceChange:r.presenceChange?function(e){let t=e.type;if(t===en.PUT){let t=rA(e.presence);return{type:e1.Put,presence:t}}if(t===en.CLEAR)return{type:e1.Clear};throw new e0(eZ.ErrInvalidType,"unsupported type: ".concat(t))}(r.presenceChange):void 0,message:r.message}));return t}(e.changes),rC(e.versionVector),e.snapshot)},bytesToSnapshot:function(e){if(!e)return{root:te.create(e3),presences:new Map};let t=m.fromBinary(e);return{root:rJ(t.root),presences:function(e){let t=new Map;return Object.entries(e).forEach(e=>{let[r,n]=e;t.set(r,rA(n))}),t}(t.presences)}},bytesToHex:rO,hexToBytes:r_,toOperation:rh,toChangeID:rt,bytesToChangeID:function(e){return rv(v.fromBinary(e))},bytesToOperation:function(e){return rD(w.fromBinary(e))},versionVectorToHex:function(e){return rO(rn(e).toBinary())},hexToVersionVector:function(e){let t=r_(e);return rC(C.fromBinary(t))},fromSchemaRules:function(e){return e.map(e=>({path:e.path,type:e.type}))},toRevisionSummary:function(e){var t;return{id:e.id,label:e.label,description:e.description,snapshot:e.snapshot,createdAt:(null===(t=e.createdAt)||void 0===t?void 0:t.toDate())||new Date}}};var rz=function(e){return e[e.Trivial=0]="Trivial",e[e.Debug=1]="Debug",e[e.Info=2]="Info",e[e.Warn=3]="Warn",e[e.Error=4]="Error",e[e.Fatal=5]="Fatal",e}({});let rq=3,rM={trivial:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];!(rq>0)&&"undefined"!=typeof console&&console.log("YORKIE T:",...t)},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];!(rq>1)&&"undefined"!=typeof console&&console.log("YORKIE D:",...t)},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];!(rq>2)&&"undefined"!=typeof console&&console.log("YORKIE I:",...t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];!(rq>3)&&"undefined"!=typeof console&&(void 0!==console.warn?console.warn("YORKIE W:",...t):console.log("YORKIE W:",...t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];!(rq>4)&&"undefined"!=typeof console&&(void 0!==console.error?console.error("YORKIE E:",...t):console.log("YORKIE E:",...t))},isEnabled:e=>rq<=e};function rK(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}let rF=()=>{};class rU{next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(!e)throw new e0(eZ.ErrInvalidArgument,"missing observer");if(this.finalized)throw new e0(eZ.ErrRefused,"observable is finalized due to previous error");void 0===(n="object"==typeof e?e:{next:e,error:t,complete:r}).next&&(n.next=rF),void 0===n.error&&(n.error=rF),void 0===n.complete&&(n.complete=rF);let i=rK(),s=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:n}),this.finalized)try{this.finalError?n.error(this.finalError):n.complete()}catch(e){rM.warn(e)}return s}unsubscribeOne(e){var t;this.observers=null===(t=this.observers)||void 0===t?void 0:t.filter(t=>t.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e].observer)}catch(e){rM.error(e)}}close(e){!this.finalized&&(this.finalized=!0,void 0!==e&&(this.finalError=e),this.observers=void 0)}constructor(e){this.finalized=!1,this.observers=[];try{e(this)}catch(e){this.error(e)}}}function rV(e){let t=new rU(e);return{subscribe:t.subscribe.bind(t),getProxy:()=>t}}class rj{static create(e,t,r,n){return new rj(e,t,r,n)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getNextID(){return this.isPresenceOnlyChange()?this.prevID.next(!0).setLamport(this.prevID.getLamport()).setVersionVector(this.prevID.getVersionVector()):this.nextID}toChange(){let e=this.isPresenceOnlyChange()?this.prevID.next(!0):this.nextID;return tY.create({id:e,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}isPresenceOnlyChange(){return 0===this.operations.length}hasChange(){return this.operations.length>0||void 0!==this.presenceChange}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(let r of Object.keys(e))(null==t?void 0:t.addToHistory)?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(0===this.reversePresenceKeys.size)return;let e={};for(let t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.nextID.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.nextID.createTimeTicket(this.delimiter)}acc(e){this.root.acc(e)}constructor(e,t,r,n){this.prevID=e,this.nextID=e.next(),this.delimiter=0,this.root=t,this.operations=[],this.previousPresence=ty(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=n}}function rW(e,t){return new Proxy(t,new rQ(e).getHandlers())}class rQ{static setInternal(e,t,r,n){if(r.includes("."))throw new e0(eZ.ErrInvalidObjectKey,"key must not contain the '.'.");let i=e.issueTimeTicket(),s=r4(e,n,i),a=t.set(r,s,i);e.registerElement(s,t),a&&e.registerRemovedElement(a),e.push(tf.create(r,s.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){let r={};for(let[n,i]of Object.entries(t)){if(n.includes("."))throw new e0(eZ.ErrInvalidObjectKey,"key must not contain the '.'.");let t=e.issueTimeTicket(),s=r4(e,i,t);r[n]=s}return r}static deleteInternal(e,t,r){let n=e.issueTimeTicket(),i=t.deleteByKey(r,n);i&&(e.push(tu.create(t.getCreatedAt(),i.getCreatedAt(),n)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}constructor(e){this.context=e,this.handlers={set:(t,r,n)=>(rM.isEnabled(rz.Trivial)&&rM.trivial("obj[".concat(r,"]=").concat(JSON.stringify(n))),rQ.setInternal(e,t,r,n),!0),get:(t,r)=>(rM.isEnabled(rz.Trivial)&&rM.trivial("obj[".concat(r,"]")),"getID"===r)?()=>t.getCreatedAt():"toJSON"===r||"toString"===r?()=>t.toJSON():"toJS"===r?()=>t.toJS():"toJSForTest"===r?()=>t.toJSForTest():r3(e,t.get(r)),ownKeys:e=>e.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,r)=>(rM.isEnabled(rz.Trivial)&&rM.trivial("obj[".concat(r,"]")),rQ.deleteInternal(e,t,r),!0)}}}function rG(e){return("string"==typeof e||e instanceof String)&&!isNaN(e)}class rH{static*iteratorInternal(e,t){for(let r of t)yield r9(e,r)}static buildArrayElements(e,t){let r=[];for(let n of t){let t=e.issueTimeTicket(),i=r4(e,n,t);r.push(i)}return r}static pushInternal(e,t,r){return rH.insertAfterInternal(e,t,t.getLastCreatedAt(),r),t.length}static moveBeforeInternal(e,t,r,n){let i=e.issueTimeTicket(),s=t.getPrevCreatedAt(r);t.moveAfter(s,n,i),e.push(tg.create(t.getCreatedAt(),s,n,i))}static moveAfterInternal(e,t,r,n){let i=e.issueTimeTicket();e.push(tg.create(t.getCreatedAt(),r,n,i)),t.moveAfter(r,n,i)}static moveAfterByIndexInternal(e,t,r,n){let i=t.get(r);if(!i)throw new e0(eZ.ErrInvalidArgument,"index out of bounds: ".concat(r));let s=t.get(n);if(!s)throw new e0(eZ.ErrInvalidArgument,"index out of bounds: ".concat(n));rH.moveAfterInternal(e,t,i.getCreatedAt(),s.getCreatedAt())}static moveFrontInternal(e,t,r){let n=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),r,n),e.push(tg.create(t.getCreatedAt(),i.getCreatedAt(),r,n))}static moveLastInternal(e,t,r){let n=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,r,n),e.push(tg.create(t.getCreatedAt(),i,r,n))}static insertAfterInternal(e,t,r,n){let i=e.issueTimeTicket(),s=r4(e,n,i);return t.insertAfter(r,s),e.registerElement(s,t),e.push(td.create(t.getCreatedAt(),r,s.deepcopy(),i)),s}static insertIntegerAfterInternal(e,t,r,n){let i=t.get(r);if(!i)throw new e0(eZ.ErrInvalidArgument,"index out of bounds: ".concat(r));return rH.insertAfterInternal(e,t,i.getCreatedAt(),n),t}static insertBeforeInternal(e,t,r,n){return rH.insertAfterInternal(e,t,t.getPrevCreatedAt(r),n)}static setValueInternal(e,t,r,n){let i=t.get(r);if(!i)throw new e0(eZ.ErrInvalidArgument,"index out of bounds: ".concat(r));return rH.setByIndexInternal(e,t,i.getCreatedAt(),n),t}static setByIndexInternal(e,t,r,n){let i=e.issueTimeTicket(),s=r4(e,n,i),a=s.deepcopy();return e.push(re.create(t.getCreatedAt(),r,a,i)),t.set(r,s,i),e.registerElement(s,t),s}static deleteInternalByIndex(e,t,r){let n=e.issueTimeTicket(),i=t.deleteByIndex(r,n);if(i)return e.push(tu.create(t.getCreatedAt(),i.getCreatedAt(),n)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,r){let n=e.issueTimeTicket(),i=t.delete(r,n);return e.push(tu.create(t.getCreatedAt(),i.getCreatedAt(),n)),e.registerRemovedElement(i),i}static splice(e,t,r,n){for(var i=arguments.length,s=Array(i>4?i-4:0),a=4;a<i;a++)s[a-4]=arguments[a];let o=t.length,c=r>=0?Math.min(r,o):Math.max(o+r,0),l=void 0===n?o:n<0?c:Math.min(c+n,o),h=[];for(let r=c;r<l;r++){let r=rH.deleteInternalByIndex(e,t,c);if(r){let t=r.deepcopy();t.setRemovedAt(),h.push(r3(e,t))}}if(s){let r=0===c?t.getHead().getID():t.get(c-1).getID();for(let n of s)r=rH.insertAfterInternal(e,t,r,n).getID()}return h}static includes(e,t,r,n){let i=t.length,s=void 0===n?0:n<0?Math.max(n+i,0):n;if(s>=i)return!1;if(to.isSupport(r))return Array.from(t).map(t=>r3(e,t)).includes(r,s);for(let e=s;e<i;e++){var a;if((null===(a=t.get(e))||void 0===a?void 0:a.getID())===r.getID())return!0}return!1}static indexOf(e,t,r,n){let i=t.length,s=void 0===n?0:n<0?Math.max(n+i,0):n;if(s>=i)return -1;if(to.isSupport(r))return Array.from(t).map(t=>r3(e,t)).indexOf(r,s);for(let e=s;e<i;e++){var a;if((null===(a=t.get(e))||void 0===a?void 0:a.getID())===r.getID())return e}return -1}static lastIndexOf(e,t,r,n){let i=t.length,s=void 0===n||n>=i?i-1:n<0?n+i:n;if(s<0)return -1;if(to.isSupport(r))return Array.from(t).map(t=>r3(e,t)).lastIndexOf(r,s);for(let e=s;e>0;e--){var a;if((null===(a=t.get(e))||void 0===a?void 0:a.getID())===r.getID())return e}return -1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}constructor(e,t){this.context=e,this.array=t,this.handlers={get:(t,r,n)=>{if("getID"===r)return()=>t.getCreatedAt();if("getElementByID"===r)return r=>{let n=t.getByID(r);if(!(!n||n.isRemoved()))return r9(e,n)};if("getElementByIndex"===r)return r=>r9(e,t.get(r));if("getLast"===r)return()=>r9(e,t.getLast());if("delete"===r)return r=>{let n=rH.deleteInternalByIndex(e,t,r);return r9(e,n)};if("deleteByID"===r)return r=>{let n=rH.deleteInternalByID(e,t,r);return r9(e,n)};if("insertAfter"===r)return(r,n)=>{let i=rH.insertAfterInternal(e,t,r,n);return r9(e,i)};if("insertIntegerAfter"===r)return(r,n)=>{let i=rH.insertIntegerAfterInternal(e,t,r,n);return r9(e,i)};if("insertBefore"===r)return(r,n)=>{let i=rH.insertBeforeInternal(e,t,r,n);return r9(e,i)};if("setValue"===r)return(r,n)=>{let i=rH.setValueInternal(e,t,r,n);return r9(e,i)};if("moveBefore"===r)return(r,n)=>{rH.moveBeforeInternal(e,t,r,n)};if("moveAfter"===r)return(r,n)=>{rH.moveAfterInternal(e,t,r,n)};if("moveAfterByIndex"===r)return(r,n)=>{rH.moveAfterByIndexInternal(e,t,r,n)};if("moveFront"===r)return r=>{rH.moveFrontInternal(e,t,r)};if("moveLast"===r)return r=>{rH.moveLastInternal(e,t,r)};if(rG(r))return r3(e,t.get(Number(r)));if("push"===r)return r=>rH.pushInternal(e,t,r);if("splice"===r)return function(r,n){for(var i=arguments.length,s=Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];return rH.splice(e,t,r,n,...s)};if("length"===r)return t.length;if("symbol"==typeof r&&r===Symbol.iterator)return rH.iteratorInternal.bind(this,e,t);if("includes"===r)return(r,n)=>rH.includes(e,t,r,n);if("indexOf"===r)return(r,n)=>rH.indexOf(e,t,r,n);if("lastIndexOf"===r)return(r,n)=>rH.lastIndexOf(e,t,r,n);if("toJSForTest"===r)return()=>t.toJSForTest();if("toTestString"===r)return()=>rH.toTestString(t);if("string"==typeof r&&["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(r))return function(){for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];let a=Array.from(t).map(t=>r3(e,t));return Array.prototype[r].apply(a,i)};return Reflect.get(t,r,n)},set:(t,r,n)=>{if(rG(r)){let i=Number(r);return rH.setValueInternal(e,t,i,n),!0}return Reflect.set(t,r,n)},deleteProperty:(t,r)=>(rM.isEnabled(rz.Trivial)&&rM.trivial("array[".concat(r,"]")),rH.deleteInternalByIndex(e,t,Number.parseInt(r)),!0)}}}class rY{initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,r,n){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new e0(eZ.ErrInvalidArgument,"from should be less than or equal to to");let i=this.text.indexRangeToPosRange(e,t);rM.isEnabled(rz.Debug)&&rM.debug("EDIT: f:".concat(e,"->").concat(i[0].toTestString(),", t:").concat(t,"->").concat(i[1].toTestString()," c:").concat(r));let s=n?tC(n):void 0,a=this.context.issueTimeTicket(),[,o,c,l]=this.text.edit(i,r,a,s);for(let e of(this.context.acc(c),o))this.context.registerGCPair(e);return this.context.push(new tk(this.text.getCreatedAt(),i[0],i[1],r,s?new Map(Object.entries(s)):new Map,a)),this.text.findIndexesFromRange(l)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,r){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new e0(eZ.ErrInvalidArgument,"from should be less than or equal to to");let n=this.text.indexRangeToPosRange(e,t);rM.isEnabled(rz.Debug)&&rM.debug("STYL: f:".concat(e,"->").concat(n[0].toTestString(),", t:").concat(t,"->").concat(n[1].toTestString()," a:").concat(JSON.stringify(r)));let i=tC(r),s=this.context.issueTimeTicket(),[a,o]=this.text.setStyle(n,i,s);for(let e of(this.context.acc(o),a))this.context.registerGCPair(e);return this.context.push(new tP(this.text.getCreatedAt(),n[0],n[1],new Map(Object.entries(i)),s)),!0}indexRangeToPosRange(e){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");let t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");let t=this.text.findIndexesFromRange([t2.fromStruct(e[0]),t2.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text)throw new e0(eZ.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(e,t)}constructor(e,t){this.context=e,this.text=t}}class rX{initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter)throw new e0(eZ.ErrNotInitialized,"Counter is not initialized yet");let t=this.context.issueTimeTicket(),r=to.of(e,t);if(!r.isNumericType())throw TypeError("Unsupported type of value: ".concat(typeof r.getValue()));return this.counter.increase(r),this.context.push(t6.create(this.counter.getCreatedAt(),r,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new e0(eZ.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}constructor(e,t){this.valueType=e,this.value=t}}function r$(e){if(e.isText)return{type:e.type,value:e.value};let t={type:e.type,children:e.children.map(e=>r$(e))};return e.attrs&&(t.attributes=tw(e.attrs.toObject())),t}function rZ(e,t,r){let{type:n}=e,i=r.issueTimeTicket();if(n===tE){r0(e);let{value:r}=e,s=tK.create(tM.of(i,0),n,r);t.append(s)}else{let s;let{children:a=[]}=e,{attributes:o}=e;if("object"==typeof o&&!tv(o)){let e=tC(o);for(let[t,r]of(s=new tp,Object.entries(e)))s.set(t,r,i)}let c=tK.create(tM.of(i,0),n,void 0,s);for(let e of(t.append(c),a))rZ(e,c,r)}}function r0(e){if(!e.value.length)throw new e0(eZ.ErrInvalidArgument,"text node cannot have empty value");return!0}function r1(e){if(!e.length)return!0;if(e[0].type===tE)for(let t of e){let{type:e}=t;if(e!==tE)throw new e0(eZ.ErrInvalidArgument,"element node and text node cannot be passed together");r0(t)}else for(let t of e){let{type:e}=t;if(e===tE)throw new e0(eZ.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class r2{initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return tK.create(tM.of(e.issueTimeTicket(),0),"root");let t=tK.create(tM.of(e.issueTimeTicket(),0),this.initialRoot.type);for(let r of this.initialRoot.children)rZ(r,t,e);return t}getSize(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}splitByPath(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new e0(eZ.ErrInvalidArgument,"path should not be empty");for(let t of function(e,t){let{node:r}=e,n=[...t].slice(0,-1),i=[...n,r.isText?r.parent.getChildrenText().length:r.children.length],s=[...n],a=[];s[s.length-1]+=1,t.every((e,t)=>e===i[t])||a.push({fromPath:[...t],toPath:i});let o=function(e,t){let r={type:e.isText?e.parent.type:e.type,children:e.isText?e.parent.getChildrenText().length===t?[]:[{type:tE,value:e.parent.getChildrenText().slice(t)}]:e.children.slice(t).map(e=>r$(e))};return e.attrs?r.attributes=tw(e.attrs.toObject()):e.isText&&e.parent.attrs&&(r.attributes=tw(e.parent.attrs.toObject())),r}(r,t[t.length-1]);return o&&a.push({fromPath:s,toPath:s,content:o}),a}(this.tree.pathToTreePos(e),e)){let{fromPath:e,toPath:r,content:n}=t,i=this.tree.pathToPos(e),s=this.tree.pathToPos(r);this.editInternal(i,s,n?[n]:[],0)}}mergeByPath(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new e0(eZ.ErrInvalidArgument,"path should not be empty");let t=this.tree.pathToTreePos(e);if(t.node.isText)throw new e0(eZ.ErrInvalidArgument,"text node cannot be merged");for(let r of function(e,t){let{node:r,offset:n}=e,i=r.children[n],s=r.children[n-1],{children:a}=i,o=[...t].slice(0,-1),c=[{fromPath:[...t],toPath:[...o,n+1]}];if(!i.children.length)return c;let l=[...o,n-1,s.hasTextChild()?s.getChildrenText().length:s.children.length];return c.push({fromPath:l,toPath:l,content:a.map(e=>r$(e))}),c}(t,e)){let{fromPath:e,toPath:t,content:n}=r,i=this.tree.pathToPos(e),s=this.tree.pathToPos(t);this.editInternal(i,s,null!=n?n:[],0)}}styleByPath(e,t){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new e0(eZ.ErrInvalidArgument,"path should not be empty");let[r,n]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),s=t?tC(t):void 0,[a,,o]=this.tree.style([r,n],s,i);for(let e of(this.context.acc(o),a))this.context.registerGCPair(e);this.context.push(t7.create(this.tree.getCreatedAt(),r,n,s?new Map(Object.entries(s)):new Map,i))}style(e,t,r){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e0(eZ.ErrInvalidArgument,"from should be less than or equal to to");let n=this.tree.findPos(e),i=this.tree.findPos(t),s=this.context.issueTimeTicket(),a=r?tC(r):void 0,[o,,c]=this.tree.style([n,i],a,s);for(let e of(this.context.acc(c),o))this.context.registerGCPair(e);this.context.push(t7.create(this.tree.getCreatedAt(),n,i,a?new Map(Object.entries(a)):new Map,s))}removeStyle(e,t,r){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e0(eZ.ErrInvalidArgument,"from should be less than or equal to to");let n=this.tree.findPos(e),i=this.tree.findPos(t),s=this.context.issueTimeTicket(),[a,,o]=this.tree.removeStyle([n,i],r,s);for(let e of(this.context.acc(o),a))this.context.registerGCPair(e);this.context.push(t7.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),n,i,r,s))}editInternal(e,t,r){var n;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0!==r.length&&r[0]&&(r1(r),r[0].type!==tE))for(let e of r){let{children:t=[]}=e;r1(t)}let s=this.context.getLastTimeTicket(),a=[];if((null===(n=r[0])||void 0===n?void 0:n.type)===tE){let e="";for(let t of r){let{value:r}=t;e+=r}a.push(tK.create(tM.of(this.context.issueTimeTicket(),0),tE,e))}else a=r.map(e=>e&&function(e,t){let r;let{type:n}=t,i=e.issueTimeTicket();if(t.type===tE){let{value:e}=t;r=tK.create(tM.of(i,0),n,e)}else if(t){let s;let{children:a=[]}=t,{attributes:o}=t;if("object"==typeof o&&!tv(o)){let e=tC(o);for(let[t,r]of(s=new tp,Object.entries(e)))s.set(t,r,i)}for(let t of(r=tK.create(tM.of(e.issueTimeTicket(),0),n,void 0,s),a))rZ(t,r,e)}return r}(this.context,e)).filter(e=>e);let[,o,c]=this.tree.edit([e,t],a.length?a.map(e=>null==e?void 0:e.deepcopy()):void 0,i,s,()=>this.context.issueTimeTicket());for(let e of(this.context.acc(c),o))this.context.registerGCPair(e);return this.context.push(tj.create(this.tree.getCreatedAt(),e,t,a.length?a:void 0,i,s)),!0}editByPath(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new e0(eZ.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new e0(eZ.ErrInvalidArgument,"path should not be empty");let i=this.tree.pathToPos(e),s=this.tree.pathToPos(t);return this.editInternal(i,s,r?[r]:[],n)}editBulkByPath(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new e0(eZ.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new e0(eZ.ErrInvalidArgument,"path should not be empty");let i=this.tree.pathToPos(e),s=this.tree.pathToPos(t);return this.editInternal(i,s,r,n)}edit(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e0(eZ.ErrInvalidArgument,"from should be less than or equal to to");let i=this.tree.findPos(e),s=this.tree.findPos(t);return this.editInternal(i,s,r?[r]:[],n)}editBulk(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e0(eZ.ErrInvalidArgument,"from should be less than or equal to to");let i=this.tree.findPos(e),s=this.tree.findPos(t);return this.editInternal(i,s,r,n)}toXML(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");let t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],r=this.tree.indexRangeToPosRange(t);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");let t=[tq.fromStruct(e[0]),tq.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree)throw new e0(eZ.ErrNotInitialized,"Tree is not initialized yet");let t=[tq.fromStruct(e[0]),tq.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}constructor(e){this.initialRoot=e}}function r9(e,t){if(t){if(t instanceof to)return t;if(t instanceof te)return rW(e,t);if(t instanceof th)return function(e,t){let r=new rH(e,t);return new Proxy(t,r.getHandlers())}(e,t);else if(t instanceof tb)return new rY(e,t);else if(t instanceof t8){let r=new rX(t5.Int,0);return r.initialize(e,t),r}else if(t instanceof tV){let r=new r2;return r.initialize(e,t),r}throw TypeError("Unsupported type of element: ".concat(typeof t))}}function r3(e,t){let r=r9(e,t);return r instanceof to?r.getValue():r}function r4(e,t,r){let n;if(to.isSupport(t))n=to.of(t,r);else if(Array.isArray(t))n=th.create(r,rH.buildArrayElements(e,t));else if("object"==typeof t)t instanceof rY?(n=tb.create(t3.create(),r),t.initialize(e,n)):t instanceof rX?(n=t8.create(t.getValueType(),t.getValue(),r),t.initialize(e,n)):t instanceof r2?(n=tV.create(t.buildRoot(e),r),t.initialize(e,n)):n=te.create(r,rQ.buildObjectMembers(e,t));else throw TypeError("Unsupported type of value: ".concat(typeof t));return n}class r5{static create(){return new r5(te.create(e3))}findByCreatedAt(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];let r=[];for(;t.parent;){let e=t.element.getCreatedAt(),n=t.parent.subPathOf(e);if(void 0===n)throw new e0(eZ.ErrInvalidArgument,"cant find the given element: ".concat(e.toIDString()));r.unshift(n),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),tS(this.docSize.live,e.getDataSize()),e instanceof e8&&e.getDescendants((e,t)=>(this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),tS(this.docSize.live,e.getDataSize()),!1))}deregisterElement(e){let t=0,r=e=>{let r=e.getCreatedAt().toIDString();tT(this.docSize.gc,e.getDataSize()),this.elementPairMapByCreatedAt.delete(r),this.gcElementSetByCreatedAt.delete(r),t++};return r(e),e instanceof e8&&e.getDescendants(e=>(r(e),!1)),t}registerRemovedElement(e){tS(this.docSize.gc,e.getDataSize()),tT(this.docSize.live,e.getDataSize()),this.docSize.live.meta+=24,this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e);let t=this.gcPairMap.get(e.child.toIDString()).child.getDataSize();tS(this.docSize.gc,t),tT(this.docSize.live,t),e.child instanceof tm||(this.docSize.live.meta+=24)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){let e=new Set;for(let t of this.gcElementSetByCreatedAt){e.add(t);let r=this.elementPairMapByCreatedAt.get(t);r.element instanceof e8&&r.element.getDescendants(t=>(e.add(t.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}getDocSize(){return this.docSize}deepcopy(){return new r5(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(let r of this.gcElementSetByCreatedAt){let n=this.elementPairMapByCreatedAt.get(r),i=n.element.getRemovedAt();i&&(null==e?void 0:e.afterOrEqual(i))&&(n.parent.purge(n.element),t+=this.deregisterElement(n.element))}for(let[,r]of this.gcPairMap){let n=r.child.getRemovedAt();n&&(null==e?void 0:e.afterOrEqual(n))&&(r.parent.purge(r.child),tT(this.docSize.gc,r.child.getDataSize()),this.gcPairMap.delete(r.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}getStats(){return{elements:this.getElementMapSize(),gcPairs:this.gcPairMap.size,gcElements:this.getGarbageElementSetSize()}}acc(e){tS(this.docSize.live,e)}*getGCElementPairs(){for(let e of this.gcElementSetByCreatedAt){let t=this.elementPairMapByCreatedAt.get(e);t&&(yield t)}}constructor(e){this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.docSize={live:{data:0,meta:0},gc:{data:0,meta:0}},this.registerElement(e,void 0),e.getDescendants(e=>{if(e.getRemovedAt()&&this.registerRemovedElement(e),e instanceof tb||e instanceof tV)for(let t of e.getGCPairs())this.registerGCPair(t);return!1})}}class r8{set(e,t){for(let t of Object.keys(e))this.presence[t]=e[t];this.context.setPresenceChange({type:e1.Put,presence:ty(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:e1.Clear})}constructor(e,t){this.context=e,this.presence=t}}class r6{hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=50&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=50&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}reconcileCreatedAt(e,t){let r=r=>{for(let n of r)for(let r of n)(r instanceof re||r instanceof tu||r instanceof tg)&&r.getCreatedAt()===e&&r.setCreatedAt(t),(r instanceof td||r instanceof tg)&&r.getPrevCreatedAt()===e&&r.setPrevCreatedAt(t)};r(this.undoStack),r(this.redoStack)}constructor(){this.undoStack=[],this.redoStack=[]}}function r7(e){return[ns.StatusChanged,ns.Snapshot,ns.LocalChange,ns.RemoteChange,ns.Initialized,ns.Watched,ns.Unwatched,ns.PresenceChanged].includes(e.type)}let ne="disconnected",nt=new Map,nr=new Map;function nn(e,t){((null==t?void 0:t.force)||"disconnected"!==ne)&&window.postMessage({source:"yorkie-devtools-sdk",...e},"*")}window.docEventsForReplayByDocKey=nr;var ni=function(e){return e.Detached="detached",e.Attached="attached",e.Removed="removed",e}({}),ns=function(e){return e.StatusChanged="status-changed",e.ConnectionChanged="connection-changed",e.SyncStatusChanged="sync-status-changed",e.Snapshot="snapshot",e.LocalChange="local-change",e.RemoteChange="remote-change",e.Initialized="initialized",e.Watched="watched",e.Unwatched="unwatched",e.PresenceChanged="presence-changed",e.AuthError="auth-error",e}({}),na=function(e){return e.Connected="connected",e.Disconnected="disconnected",e}({}),no=function(e){return e.Synced="synced",e.SyncFailed="sync-failed",e}({});class nc{update(e,t){var r,n,i,s,a;if("removed"===this.getStatus())throw new e0(eZ.ErrDocumentRemoved,"".concat(this.key," is removed"));this.ensureClone();let o=this.changeID.getActorID(),c=rj.create(this.changeID,this.clone.root,this.clone.presences.get(o)||{},t);try{let t=(s=this.clone.root.getObject(),rW(c,s));this.presences.has(o)||this.clone.presences.set(o,{}),this.isUpdating=!0,e(t,new r8(c,this.clone.presences.get(o)))}catch(e){throw this.clone=void 0,e}finally{this.isUpdating=!1}let l=this.getSchemaRules();if(!c.isPresenceOnlyChange()&&l.length){let e=function(e,t){let r=[];for(let n of t){let t=function(e,t){switch(t.type){case"string":case"boolean":case"integer":case"double":case"long":case"date":case"bytes":case"null":var r,n;return r=e,n=t,r instanceof to&&r.getType()===function(e){switch(e){case"null":return ta.Null;case"boolean":return ta.Boolean;case"integer":return ta.Integer;case"long":return ta.Long;case"double":return ta.Double;case"string":return ta.String;case"bytes":return ta.Bytes;case"date":return ta.Date;default:throw Error("Unknown primitive type: ".concat(e))}}(n.type)?{valid:!0}:{valid:!1,errors:[{path:n.path,message:"expected ".concat(n.type," at path ").concat(n.path)}]};case"object":if(!(e instanceof te))return{valid:!1,errors:[{path:t.path,message:"expected object at path ".concat(t.path)}]};break;case"array":if(!(e instanceof th))return{valid:!1,errors:[{path:t.path,message:"expected array at path ".concat(t.path)}]};break;case"yorkie.Text":if(!(e instanceof tb))return{valid:!1,errors:[{path:t.path,message:"expected yorkie.Text at path ".concat(t.path)}]};break;case"yorkie.Tree":if(!(e instanceof tV))return{valid:!1,errors:[{path:t.path,message:"expected yorkie.Tree at path ".concat(t.path)}]};break;case"yorkie.Counter":if(!(e instanceof t8))return{valid:!1,errors:[{path:t.path,message:"expected yorkie.Counter at path ".concat(t.path)}]};break;default:throw Error("Unknown rule type: ".concat(t.type))}return{valid:!0}}(function(e,t){if(!t.startsWith("$"))throw Error("Path must start with $, got ".concat(t));let r=t.split("."),n=e;for(let e=1;e<r.length;e++){let t=r[e];if(!(n instanceof te))return;n=n.get(t)}return n}(e,n.path),n);if(!t.valid)for(let e of t.errors||[])r.push(e)}return{valid:0===r.length,errors:r}}(null===(n=this.clone)||void 0===n?void 0:n.root.getObject(),l);if(!e.valid)throw this.clone=void 0,new e0(eZ.ErrDocumentSchemaValidationFailed,"schema validation failed: ".concat(null===(i=e.errors)||void 0===i?void 0:i.map(e=>e.message).join(", ")))}let h=(a=null===(r=this.clone)||void 0===r?void 0:r.root.getDocSize())?tA(a.live)+tA(a.gc):0;if(!c.isPresenceOnlyChange()&&this.maxSizeLimit>0&&this.maxSizeLimit<h)throw this.clone=void 0,new e0(eZ.ErrDocumentSizeExceedsLimit,"document size exceeded: ".concat(h," > ").concat(this.maxSizeLimit));if(c.hasChange()){rM.isEnabled(rz.Trivial)&&rM.trivial("trying to update a local change: ".concat(this.toJSON()));let e=c.toChange(),{opInfos:t,reverseOps:r}=e.execute(this.root,this.presences,tt.Local);for(let t of e.getOperations())t instanceof re&&this.internalHistory.reconcileCreatedAt(t.getCreatedAt(),t.getValue().getCreatedAt());let n=c.getReversePresence();n&&r.push({type:"presence",value:n}),this.localChanges.push(e),r.length&&this.internalHistory.pushUndo(r),t.length&&this.internalHistory.clearRedo(),this.changeID=c.getNextID();let i=[];t.length&&i.push({type:"local-change",source:tt.Local,value:{message:e.getMessage()||"",operations:t,actor:o,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq()},rawChange:this.isEnableDevtools()?e.toStruct():void 0}),e.hasPresenceChange()&&i.push({type:"presence-changed",source:tt.Local,value:{clientID:o,presence:this.getPresence(o)}}),this.publish(i),rM.isEnabled(rz.Trivial)&&rM.trivial("after update a local change: ".concat(this.toJSON()))}}subscribe(e,t,r,n){if("string"==typeof e){if("function"!=typeof t)throw new e0(eZ.ErrInvalidArgument,"Second argument must be a callback function");return"presence"===e?this.eventStream.subscribe(e=>{for(let r of e)("initialized"===r.type||"watched"===r.type||"unwatched"===r.type||"presence-changed"===r.type)&&t(r)},r,n):"my-presence"===e?this.eventStream.subscribe(e=>{for(let r of e)("initialized"===r.type||"presence-changed"===r.type)&&("presence-changed"!==r.type||r.value.clientID===this.changeID.getActorID())&&t(r)},r,n):"others"===e?this.eventStream.subscribe(e=>{for(let r of e)("watched"===r.type||"unwatched"===r.type||"presence-changed"===r.type)&&r.value.clientID!==this.changeID.getActorID()&&t(r)},r,n):"connection"===e?this.eventStream.subscribe(e=>{for(let r of e)"connection-changed"===r.type&&t(r)},r,n):"status"===e?this.eventStream.subscribe(e=>{for(let r of e)"status-changed"===r.type&&t(r)},r,n):"sync"===e?this.eventStream.subscribe(e=>{for(let r of e)"sync-status-changed"===r.type&&t(r)},r,n):"auth-error"===e?this.eventStream.subscribe(e=>{for(let r of e)"auth-error"===r.type&&t(r)},r):"all"===e?this.eventStream.subscribe(t,r,n):this.eventStream.subscribe(r=>{for(let n of r){if("local-change"!==n.type&&"remote-change"!==n.type)continue;let r=[];for(let t of n.value.operations)this.isSameElementOrChildOf(t.path,e)&&r.push(t);r.length&&t({...n,value:{...n.value,operations:r}})}},r,n)}if("function"==typeof e)return this.eventStream.subscribe(t=>{for(let r of t)("snapshot"===r.type||"local-change"===r.type||"remote-change"===r.type)&&e(r)},t,r);throw new e0(eZ.ErrInvalidArgument,'"'.concat(e,'" is not a valid'))}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}applyChangePack(e){e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getVersionVector(),e.getSnapshot(),e.getCheckpoint().getClientSeq()):(this.applyChanges(e.getChanges(),tt.Remote),this.removePushedLocalChanges(e.getCheckpoint().getClientSeq())),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),e.hasSnapshot()||this.garbageCollect(e.getVersionVector()),e.getIsRemoved()&&this.applyStatus("removed"),rM.isEnabled(rz.Trivial)&&rM.trivial("".concat(this.root.toJSON()))}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){!this.clone&&(this.clone={root:this.root.deepcopy(),presences:ty(this.presences)})}createChangePack(){let e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return tX.create(this.key,t,!1,e,this.getVersionVector())}setActor(e){for(let t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getClone(){return this.clone}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){return this.ensureClone(),rW(rj.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{}),this.clone.root.getObject())}getDocSize(){return this.root.getDocSize()}getMaxSizePerDocument(){return this.maxSizeLimit}setMaxSizePerDocument(e){this.maxSizeLimit=e}getSchemaRules(){return this.schemaRules}setSchemaRules(e){this.schemaRules=e}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getRootCRDT(){return this.root}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}getStats(){return this.root.getStats()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,{root:i,presences:s}=rL.bytesToSnapshot(r);this.root=new r5(i),this.presences=s,this.changeID=this.changeID.setClocks(t.maxLamport(),t),this.clone=void 0,this.removePushedLocalChanges(n),this.applyChanges(this.localChanges,tt.Local),this.publish([{type:"snapshot",source:tt.Remote,value:{serverSeq:e.toString(),snapshot:this.isEnableDevtools()?rL.bytesToHex(r):void 0,snapshotVector:rL.versionVectorToHex(t)}}])}applyChanges(e,t){for(let r of(rM.isEnabled(rz.Debug)&&rM.debug("trying to apply ".concat(e.length," remote changes.")+"elements:".concat(this.root.getElementMapSize(),", ")+"removeds:".concat(this.root.getGarbageElementSetSize())),rM.isEnabled(rz.Trivial)&&rM.trivial(e.map(e=>"".concat(e.getID().toTestString(),"	").concat(e.toTestString())).join("\n")),e))this.applyChange(r,t);rM.isEnabled(rz.Debug)&&rM.debug("after appling ".concat(e.length," remote changes.")+"elements:".concat(this.root.getElementMapSize(),", ")+" removeds:".concat(this.root.getGarbageElementSetSize()))}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);let r=[],n=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(n)){let i=e.getPresenceChange();switch(i.type){case e1.Put:r.push(this.presences.has(n)?{type:"presence-changed",source:t,value:{clientID:n,presence:i.presence}}:{type:"watched",source:tt.Remote,value:{clientID:n,presence:i.presence}});break;case e1.Clear:r.push({type:"unwatched",source:tt.Remote,value:{clientID:n,presence:this.getPresence(n)}}),this.removeOnlineClient(n)}}let{opInfos:i}=e.execute(this.root,this.presences,t);if(this.changeID=this.changeID.syncClocks(e.getID()),i.length){let s=this.isEnableDevtools()?e.toStruct():void 0;r.push(t===tt.Remote?{type:"remote-change",source:t,value:{actor:n,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:s}:{type:"local-change",source:t,value:{actor:n,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:s})}r.length&&this.publish(r)}applyWatchStream(e){if("initialization"===e.body.case){let t=e.body.value.clientIds,r=new Set;for(let e of t)e!==this.changeID.getActorID()&&r.add(e);this.setOnlineClients(r),this.publish([{type:"initialized",source:tt.Local,value:this.getPresences()}]);return}if("event"===e.body.case){let{type:t,publisher:r}=e.body.value,n=[];if(t===g.DOCUMENT_WATCHED){if(this.onlineClients.has(r)&&this.hasPresence(r))return;this.addOnlineClient(r),this.hasPresence(r)&&n.push({type:"watched",source:tt.Remote,value:{clientID:r,presence:this.getPresence(r)}})}else if(t===g.DOCUMENT_UNWATCHED){let e=this.getPresence(r);this.removeOnlineClient(r),e&&n.push({type:"unwatched",source:tt.Remote,value:{clientID:r,presence:e}})}n.length&&this.publish(n)}}applyStatus(e){this.status=e,"detached"===e&&this.setActor(e2),this.publish([{source:"removed"===e?tt.Remote:tt.Local,type:"status-changed",value:"attached"===e?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEventsForReplay(e){for(let t of e){if("status-changed"===t.type){this.applyStatus(t.value.status),"attached"===t.value.status&&this.setActor(t.value.actorID);continue}if("snapshot"===t.type){let{snapshot:e,serverSeq:r,snapshotVector:n}=t.value;if(!e)continue;this.applySnapshot(BigInt(r),rL.hexToVersionVector(n),rL.hexToBytes(e));continue}if("local-change"===t.type||"remote-change"===t.type){if(!t.rawChange)continue;let e=tY.fromStruct(t.rawChange);this.applyChange(e,t.source)}if("initialized"===t.type){let e=new Set;for(let{clientID:r,presence:n}of t.value)e.add(r),this.presences.set(r,n);this.setOnlineClients(e)}else if("watched"===t.type){let{clientID:e,presence:r}=t.value;this.addOnlineClient(e),this.presences.set(e,r)}else if("unwatched"===t.type){let{clientID:e}=t.value;this.removeOnlineClient(e),this.presences.delete(e)}else if("presence-changed"===t.type){let{clientID:e,presence:r}=t.value;this.presences.set(e,r)}}}getValueByPath(e){if(!e.startsWith("$"))throw new e0(eZ.ErrInvalidArgument,'path must start with "$"');let t=e.split(".");t.shift();let r=this.getRoot();for(let e of t)if(!(r=r[e]))return;return r}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if("attached"!==this.status)return{};let e=this.presences.get(this.changeID.getActorID());return e?ty(e):{}}getOthersPresences(){let e=[],t=this.changeID.getActorID();for(let r of this.onlineClients)r!==t&&this.presences.has(r)&&e.push({clientID:r,presence:ty(this.presences.get(r))});return e}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;let t=this.presences.get(e);return t?ty(t):void 0}getPresences(){let e=[];for(let t of(e.push({clientID:this.changeID.getActorID(),presence:ty(this.getMyPresence())}),this.onlineClients))this.presences.has(t)&&e.push({clientID:t,presence:ty(this.presences.get(t))});return e}getPresenceForTest(e){let t=this.presences.get(e);return t?ty(t):void 0}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){let e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((e,t)=>e.clientID>t.clientID?1:-1)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}getVersionVector(){return this.changeID.getVersionVector()}isSameElementOrChildOf(e,t){if(t===e)return!0;let r=e.split(".");return t.split(".").every((e,t)=>e===r[t])}removePushedLocalChanges(e){for(;this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e);)this.localChanges.shift()}executeUndoRedo(e){if(this.isUpdating)throw new e0(eZ.ErrRefused,"".concat(e?"Undo":"Redo"," is not allowed during an update"));let t=e?this.internalHistory.popUndo():this.internalHistory.popRedo();if(!t)throw new e0(eZ.ErrRefused,"There is no operation to be ".concat(e?"undone":"redone"));this.ensureClone();let r=rj.create(this.changeID,this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(let e of t){if(!(e instanceof tr)){new r8(r,ty(this.clone.presences.get(this.changeID.getActorID()))).set(e.value,{addToHistory:!0});continue}let t=r.issueTimeTicket();if(e.setExecutedAt(t),e instanceof re){let r=e.getCreatedAt();e.getValue().setCreatedAt(t),this.internalHistory.reconcileCreatedAt(r,t)}else if(e instanceof td){let r=e.getValue().getCreatedAt();e.getValue().setCreatedAt(t),this.internalHistory.reconcileCreatedAt(r,t)}r.push(e)}let n=r.toChange();n.execute(this.clone.root,this.clone.presences,tt.UndoRedo);let{opInfos:i,reverseOps:s}=n.execute(this.root,this.presences,tt.UndoRedo),a=r.getReversePresence();if(a&&s.push({type:"presence",value:a}),s.length&&(e?this.internalHistory.pushRedo(s):this.internalHistory.pushUndo(s)),!n.hasPresenceChange()&&!i.length)return;this.localChanges.push(n),this.changeID=r.getNextID();let o=this.changeID.getActorID(),c=[];i.length&&c.push({type:"local-change",source:tt.UndoRedo,value:{message:n.getMessage()||"",operations:i,actor:o,clientSeq:n.getID().getClientSeq(),serverSeq:n.getID().getServerSeq()},rawChange:this.isEnableDevtools()?n.toStruct():void 0}),n.hasPresenceChange()&&c.push({type:"presence-changed",source:tt.UndoRedo,value:{clientID:o,presence:this.getPresence(o)}}),this.publish(c)}constructor(e,t){this.key=e,this.status="detached",this.opts=t||{},this.maxSizeLimit=0,this.schemaRules=[],this.changeID=tH,this.checkpoint=tZ,this.localChanges=[],this.root=r5.create(),this.presences=new Map,this.onlineClients=new Set,this.internalHistory=new r6,this.isUpdating=!1,this.eventStream=rV(e=>this.eventStreamObserver=e),this.history={canUndo:()=>this.internalHistory.hasUndo()&&!this.isUpdating,canRedo:()=>this.internalHistory.hasRedo()&&!this.isUpdating,undo:()=>this.executeUndoRedo(!0),redo:()=>this.executeUndoRedo(!1)},function(e){if(!e.isEnableDevtools()||nt.has(e.getKey()))return;nr.set(e.getKey(),[]);let t=e.subscribe("all",t=>{t.every(r7)&&(nr.get(e.getKey()).push(t),"synced"===ne&&nn({msg:"doc::sync::partial",docKey:e.getKey(),event:t}))});nt.set(e.getKey(),[t]),nn({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var r;if((null===(r=t.data)||void 0===r?void 0:r.source)==="yorkie-devtools-panel")switch(t.data.msg){case"devtools::connect":if("disconnected"!==ne)break;ne="connected",nn({msg:"doc::available",docKey:e.getKey()}),rM.info("[YD] Devtools connected. Doc: ".concat(e.getKey()));break;case"devtools::disconnect":ne="disconnected",rM.info("[YD] Devtools disconnected. Doc: ".concat(e.getKey()));break;case"devtools::subscribe":ne="synced",nn({msg:"doc::sync::full",docKey:e.getKey(),events:nr.get(e.getKey())}),rM.info("[YD] Devtools subscribed. Doc: ".concat(e.getKey()))}})}(this)}}class nl{changeSyncMode(e){this.syncMode=e}needRealtimeSync(){var e;return this.syncMode!==nm.RealtimeSyncOff&&(this.syncMode===nm.RealtimePushOnly?this.resource.hasLocalChanges():this.syncMode!==nm.Manual&&(this.resource.hasLocalChanges()||null!==(e=this.changeEventReceived)&&void 0!==e&&e))}needSync(e){return this.resource instanceof nc?this.needRealtimeSync():this.syncMode!==nm.Manual&&Date.now()-this.lastHeartbeatTime>=e}updateHeartbeatTime(){this.lastHeartbeatTime=Date.now()}async runWatchLoop(e){let t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.cancelled||(this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay))})}catch(e){}};await t()}cancelWatchStream(){this.cancelled=!0,this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}constructor(e,t,r,n){this.reconnectStreamDelay=e,this.resource=t,this.resourceID=r,this.syncMode=n,this.changeEventReceived=void 0===n&&void 0,this.lastHeartbeatTime=Date.now(),this.cancelled=!1}}let nh=JSON.parse('{"UU":"@yorkie-js/sdk","rE":"0.6.40"}'),nd=e=>{try{let t=JSON.stringify(e);if(void 0===t)return!1}catch(e){return!1}return!0};var nu=function(e){return e.Detached="detached",e.Attached="attached",e.Removed="removed",e}({}),nf=function(e){return e.PresenceChanged="presence-changed",e.Initialized="initialized",e.Broadcast="broadcast",e.LocalBroadcast="local-broadcast",e.AuthError="auth-error",e}({});class ng{getKey(){return this.key}getFirstKeyPath(){return this.key.split(".")[0]}getStatus(){return this.status}applyStatus(e){this.status=e}isAttached(){return"attached"===this.status}getActorID(){return this.actorID}setActor(e){this.actorID=e}getSessionID(){return this.sessionID}setSessionID(e){this.sessionID=e}getPresenceCount(){return this.count}updateCount(e,t){return(0===t||t>this.seq)&&(this.count=e,this.seq=t,!0)}hasLocalChanges(){return!1}subscribe(e,t){if("function"==typeof e)return this.eventStream.subscribe(e);if(!t)throw Error("callback is required when subscribing to specific event type or topic");return"broadcast"===e?this.eventStream.subscribe(e=>{"broadcast"===e.type&&t(e)}):"local-broadcast"===e?this.eventStream.subscribe(e=>{"local-broadcast"===e.type&&t(e)}):"auth-error"===e?this.eventStream.subscribe(e=>{"auth-error"===e.type&&t(e)}):"presence"===e?this.eventStream.subscribe(e=>{("presence-changed"===e.type||"initialized"===e.type)&&t(e)}):"all"===e?this.eventStream.subscribe(t):this.eventStream.subscribe(r=>{"broadcast"===r.type&&r.topic===e&&t(r)})}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}broadcast(e,t,r){if("attached"!==this.status)throw Error("channel is not attached: ".concat(this.status));if(!this.actorID)throw Error("actorID is not set");this.publish({type:"local-broadcast",clientID:this.actorID,topic:e,payload:t,options:r})}validateChannelKey(e){if(""===e)throw Error("channel key must not be empty");if(e.includes(" "))throw Error("channel key must not contain a whitespace");if(e.startsWith("."))throw Error("channel key must not start with a period");if(e.endsWith("."))throw Error("channel key must not end with a period");if(e.includes("".concat(".").concat(".")))throw Error("channel key path must not empty")}constructor(e){this.validateChannelKey(e),this.key=e,this.status="detached",this.count=0,this.seq=0,this.eventStream=rV(e=>this.eventStreamObserver=e)}}var nm=function(e){return e.Manual="manual",e.Realtime="realtime",e.RealtimePushOnly="realtime-pushonly",e.RealtimeSyncOff="realtime-syncoff",e}({});let np={rpcAddr:"https://api.yorkie.dev",syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3,channelHeartbeatInterval:3e4},ny={maxRetries:1/0,initialRetryInterval:1e3,maxBackoff:2e4};class nv{async activate(){if(this.isActive())return Promise.resolve();if(this.authTokenInjector){let e=await this.authTokenInjector();this.setAuthToken(e)}return this.enqueueTask(async()=>{try{let e=await this.rpcClient.activateClient({clientKey:this.key,metadata:this.metadata},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(this.key)}});this.id=e.clientId,this.status="activated",this.runSyncLoop(),rM.info('[AC] c:"'.concat(this.getKey(),'" activated, id:"').concat(this.id,'"')),window.addEventListener("beforeunload",async()=>{await this.deactivate({keepalive:!0})})}catch(e){throw rM.error('[AC] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}})}deactivate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{keepalive:!1,synchronous:!1};if("deactivated"===this.status)return Promise.resolve();let t=async()=>{try{await this.rpcClient.deactivateClient({clientId:this.id,synchronous:e.synchronous},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(this.key)}}),this.deactivateInternal(),rM.info('[DC] c"'.concat(this.getKey(),'" deactivated'))}catch(e){throw rM.error('[DC] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};if(e.keepalive){this.keepalive=!0;let e=t();return this.keepalive=!1,e}return this.enqueueTask(t)}has(e){return this.attachmentMap.has(e)}attach(e,t){return e instanceof ng?this.attachChannel(e,t):this.attachDocument(e,t)}attachDocument(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));if(e.getStatus()!==ni.Detached)throw new e0(eZ.ErrNotDetached,"".concat(e.getKey()," is not detached"));e.setActor(this.id),e.update((e,t)=>t.set(r.initialPresence||{}));let n=null!==(t=r.syncMode)&&void 0!==t?t:"realtime";return this.enqueueTask(async()=>{try{var t;let i=await this.rpcClient.attachDocument({clientId:this.id,changePack:rL.toChangePack(e.createChangePack()),schemaKey:r.schema},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}});(null!==(t=i.maxSizePerDocument)&&void 0!==t?t:0)>0&&e.setMaxSizePerDocument(i.maxSizePerDocument),i.schemaRules.length>0&&e.setSchemaRules(rL.fromSchemaRules(i.schemaRules));let s=rL.fromChangePack(i.changePack);if(e.applyChangePack(s),e.getStatus()===ni.Removed)return e;e.applyStatus(ni.Attached),this.attachmentMap.set(e.getKey(),new nl(this.reconnectStreamDelay,e,i.documentId,n)),"manual"!==n&&await this.runWatchLoop(e.getKey()),rM.info('[AD] c:"'.concat(this.getKey(),'" attaches d:"').concat(e.getKey(),'"'));let a=e.getRootObject();if(r.initialRoot){let t=r.initialRoot;e.update(e=>{for(let[r,n]of Object.entries(t))a.has(r)||(e[r]=n)})}return e}catch(e){throw rM.error('[AD] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}})}detach(e,t){return e instanceof ng?this.detachChannel(e):this.detachDocument(e,t)}detachDocument(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{keepalive:!1};if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));let r=this.attachmentMap.get(e.getKey());if(!r)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));e.update((e,t)=>t.clear());let n=async()=>{try{var n;let i=await this.rpcClient.detachDocument({clientId:this.id,documentId:r.resourceID,changePack:rL.toChangePack(e.createChangePack()),removeIfNotAttached:null!==(n=t.removeIfNotAttached)&&void 0!==n&&n},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}}),s=rL.fromChangePack(i.changePack);return e.applyChangePack(s),e.getStatus()!==ni.Removed&&e.applyStatus(ni.Detached),this.detachInternal(e.getKey()),rM.info('[DD] c:"'.concat(this.getKey(),'" detaches d:"').concat(e.getKey(),'"')),e}catch(e){throw rM.error('[DD] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};if(t.keepalive){this.keepalive=!0;let e=n();return this.keepalive=!1,e}return this.enqueueTask(n)}async attachChannel(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));if(e.getStatus()!==nu.Detached)throw new e0(eZ.ErrNotDetached,"".concat(e.getKey()," is not detached"));e.setActor(this.id);let r=async()=>{try{let r=await this.rpcClient.attachChannel({clientId:this.id,channelKey:e.getKey()},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getFirstKeyPath())}});e.setSessionID(r.sessionId),e.updateCount(Number(r.count),0),e.applyStatus(nu.Attached);let n=!1!==t.isRealtime?"realtime":"manual",i=new nl(this.reconnectStreamDelay,e,r.sessionId,n);return e.subscribe("local-broadcast",t=>{let{topic:r,payload:n,options:i}=t;this.broadcast(e.getKey(),r,n,i).catch(e=>{(null==i?void 0:i.error)&&i.error(e),rM.error('[BC] c:"'.concat(this.getKey(),'" failed: ').concat(e))})}),this.attachmentMap.set(e.getKey(),i),"realtime"===n&&await this.runWatchLoop(e.getKey()),rM.info('[AP] c:"'.concat(this.getKey(),'" attaches p:"').concat(e.getKey(),'" mode:').concat(n," count:").concat(e.getPresenceCount())),e}catch(e){throw rM.error('[AP] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};return this.enqueueTask(r)}async detachChannel(e){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));if(!this.attachmentMap.has(e.getKey()))throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));let t=async()=>{try{let t=await this.rpcClient.detachChannel({clientId:this.id,channelKey:e.getKey(),sessionId:e.getSessionID()},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getFirstKeyPath())}});return e.updateCount(Number(t.count),0),e.applyStatus(nu.Detached),this.detachInternal(e.getKey()),rM.info('[DP] c:"'.concat(this.getKey(),'" detaches p:"').concat(e.getKey(),'" count:').concat(e.getPresenceCount())),e}catch(e){throw rM.error('[DP] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};return this.enqueueTask(t)}async changeSyncMode(e,t){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));let r=this.attachmentMap.get(e.getKey());if(!r)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));let n=r.syncMode;return n===t||((r.changeSyncMode(t),"manual"===t)?r.cancelWatchStream():("realtime"===t&&(r.changeEventReceived=!0),"manual"===n&&await this.runWatchLoop(e.getKey()))),e}sync(e){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));if(e instanceof ng){let t=this.attachmentMap.get(e.getKey());if(!t)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));return this.enqueueTask(async()=>this.syncInternal(t).catch(async e=>{throw rM.error('[SY] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}))}if(e instanceof nc){let t=this.attachmentMap.get(e.getKey());if(!t)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(async e=>{throw rM.error('[SY] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}))}return this.enqueueTask(async()=>{let e=[];for(let[,t]of this.attachmentMap)void 0!==t.syncMode&&t.resource instanceof nc&&e.push(this.syncInternal(t,t.syncMode));return Promise.all(e).catch(async e=>{throw rM.error('[SY] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e})})}remove(e){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));let t=this.attachmentMap.get(e.getKey());if(!t)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));e.setActor(this.id);let r=rL.toChangePack(e.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>{try{let n=await this.rpcClient.removeDocument({clientId:this.id,documentId:t.resourceID,changePack:r},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}}),i=rL.fromChangePack(n.changePack);e.applyChangePack(i),this.detachInternal(e.getKey()),rM.info('[RD] c:"'.concat(this.getKey(),'" removes d:"').concat(e.getKey(),'"'))}catch(e){throw rM.error('[RD] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}})}getID(){return this.id}getKey(){return this.key}isActive(){return"activated"===this.status}getStatus(){return this.status}getCondition(e){return this.conditions[e]}async createRevision(e,t,r){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));let n=this.attachmentMap.get(e.getKey());if(!n)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));let i=async()=>{try{let i=await this.rpcClient.createRevision({clientId:this.id,documentId:n.resourceID,label:t,description:r||""},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}});if(!i.revision)throw new e0(eZ.ErrInvalidArgument,"revision is not returned");return rM.info('[CR] c:"'.concat(this.getKey(),'" creates revision d:"').concat(e.getKey(),'" l:"').concat(t,'"')),rL.toRevisionSummary(i.revision)}catch(e){throw rM.error('[CR] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};return this.enqueueTask(i)}async listRevisions(e,t){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));let r=this.attachmentMap.get(e.getKey());if(!r)throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));let n=async()=>{try{var n;let i=await this.rpcClient.listRevisions({projectId:"",documentId:r.resourceID,pageSize:(null==t?void 0:t.pageSize)||10,offset:(null==t?void 0:t.offset)||0,isForward:null!==(n=null==t?void 0:t.isForward)&&void 0!==n&&n},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}});return rM.info('[LR] c:"'.concat(this.getKey(),'" lists revisions d:"').concat(e.getKey(),'" count:').concat(i.revisions.length)),i.revisions.map(rL.toRevisionSummary)}catch(e){throw rM.error('[LR] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};return this.enqueueTask(n)}async restoreRevision(e,t){if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));if(!this.attachmentMap.get(e.getKey()))throw new e0(eZ.ErrNotAttached,"".concat(e.getKey()," is not attached"));let r=async()=>{try{await this.rpcClient.restoreRevision({clientId:this.id,revisionId:t},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}}),rM.info('[RR] c:"'.concat(this.getKey(),'" restores revision d:"').concat(e.getKey(),'" r:"').concat(t,'"'))}catch(e){throw rM.error('[RR] c:"'.concat(this.getKey(),'" err :'),e),await this.handleConnectError(e),e}};return this.enqueueTask(r)}async broadcast(e,t,r,n){var i;if(!this.isActive())throw new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active"));let s=this.attachmentMap.get(e);if(!s)throw new e0(eZ.ErrNotAttached,"".concat(e," is not attached"));if(!nd(r))throw new e0(eZ.ErrInvalidArgument,"payload is not serializable");let a=s.resource,o=null!==(i=null==n?void 0:n.maxRetries)&&void 0!==i?i:ny.maxRetries,c=ny.maxBackoff,l=0,h=e=>Math.min(ny.initialRetryInterval*2**e,c),d=async()=>this.enqueueTask(async()=>{try{await this.rpcClient.broadcast({clientId:this.id,channelKey:e,topic:t,payload:new TextEncoder().encode(JSON.stringify(r))},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(a.getFirstKeyPath())}}),rM.info('[BC] c:"'.concat(this.getKey(),'" broadcasts p:"').concat(e,'" t:"').concat(t,'"'))}catch(e){if(rM.error('[BC] c:"'.concat(this.getKey(),'" err:'),e),await this.handleConnectError(e)){if(ry(e,eZ.ErrUnauthenticated)&&s.resource instanceof ng&&s.resource.publish({type:nf.AuthError,reason:rm(e).reason||"unauthenticated",method:"Broadcast"}),l<o)setTimeout(()=>d(),h(++l-1)),rM.info('[BC] c:"'.concat(this.getKey(),'" retry attempt ').concat(l,"/").concat(o));else throw rM.error('[BC] c:"'.concat(this.getKey(),'" exceeded maximum retry attempts')),e}}});return d()}runSyncLoop(){let e=async()=>{if(!this.isActive()){rM.debug('[SL] c:"'.concat(this.getKey(),'" exit sync loop')),this.conditions.SyncLoop=!1;return}try{await this.enqueueTask(async()=>{let t=[];for(let[,e]of this.attachmentMap)e.needSync(this.channelHeartbeatInterval)&&(void 0!==e.changeEventReceived&&(e.changeEventReceived=!1),t.push(this.syncInternal(e,e.syncMode).catch(t=>{throw ry(t,eZ.ErrUnauthenticated)&&e.resource.publish([{type:ns.AuthError,value:{reason:rm(t).reason,method:"PushPull"}}]),t})));await Promise.all(t),setTimeout(e,this.syncLoopDuration)})}catch(t){rM.error('[SL] c:"'.concat(this.getKey(),'" sync failed:'),t),await this.handleConnectError(t)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1}};rM.debug('[SL] c:"'.concat(this.getKey(),'" run sync loop')),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){let t=this.attachmentMap.get(e);if(!t)throw new e0(eZ.ErrNotAttached,"".concat(e," is not attached"));return this.conditions.WatchLoop=!0,t.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new e0(eZ.ErrClientNotActivated,"".concat(this.key," is not active")));if(!this.attachmentMap.has(e))return this.conditions.WatchLoop=!1,Promise.reject(new e0(eZ.ErrNotAttached,"".concat(e," is not attached")));let n=new AbortController;return t.resource instanceof nc?this.createDocumentWatchStream(t,e,n,r):t.resource instanceof ng?this.createChannelWatchStream(t,e,n,r):Promise.reject(new e0(eZ.ErrClientNotActivated,"Unknown resource type for ".concat(e)))})}createDocumentWatchStream(e,t,r,n){let i=this.rpcClient.watchDocument({clientId:this.id,documentId:e.resourceID},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(t)},signal:r.signal});return e.resource.publish([{type:ns.ConnectionChanged,value:na.Connected}]),rM.info('[WD] c:"'.concat(this.getKey(),'" watches d:"').concat(t,'"')),void 0!==e.changeEventReceived&&(e.changeEventReceived=!0),new Promise((t,s)=>{(async()=>{try{for await(let n of i)this.handleWatchDocumentResponse(e,n),"initialization"===n.body.case&&t([i,r]);e.resource.resetOnlineClients(),e.resource.publish([{type:ns.Initialized,source:tt.Local,value:e.resource.getPresences()}]),e.resource.publish([{type:ns.ConnectionChanged,value:na.Disconnected}]),rM.debug('[WD] c:"'.concat(this.getKey(),'" unwatches (stream ended)')),n()}catch(t){e.resource.resetOnlineClients(),e.resource.publish([{type:ns.Initialized,source:tt.Local,value:e.resource.getPresences()}]),e.resource.publish([{type:ns.ConnectionChanged,value:na.Disconnected}]),rM.debug('[WD] c:"'.concat(this.getKey(),'" unwatches')),await this.handleConnectError(t)?(ry(t,eZ.ErrUnauthenticated)&&e.resource.publish([{type:ns.AuthError,value:{reason:rm(t).reason,method:"WatchDocument"}}]),n()):this.conditions.WatchLoop=!1,s(t)}})()})}createChannelWatchStream(e,t,r,n){let i=this.rpcClient.watchChannel({clientId:this.id,channelKey:t},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.resource.getFirstKeyPath())},signal:r.signal});return rM.info('[WP] c:"'.concat(this.getKey(),'" watches p:"').concat(t,'"')),new Promise((s,a)=>{(async()=>{try{let a=!0;for await(let t of i)this.handleWatchChannelResponse(e,t),a&&(a=!1,s([i,r]));rM.debug('[WP] c:"'.concat(this.getKey(),'" p:"').concat(t,'" stream ended')),n()}catch(e){if(e instanceof Error&&"AbortError"===e.name){rM.debug('[WP] c:"'.concat(this.getKey(),'" p:"').concat(t,'" stream aborted'));return}rM.debug('[WP] c:"'.concat(this.getKey(),'" p:"').concat(t,'" err:'),e),await this.handleConnectError(e)?n():this.conditions.WatchLoop=!1,a(e)}})()})}handleWatchChannelResponse(e,t){let r=e.resource;if("initialized"===t.body.case){let{count:e,seq:n}=t.body.value;r.updateCount(Number(e),Number(n))&&r.publish({type:nf.Initialized,count:Number(e)})}else if("event"===t.body.case){let e=t.body.value;if(e.type===eu.BROADCAST){let t=new TextDecoder;try{let n=JSON.parse(t.decode(e.payload));r.publish({type:nf.Broadcast,clientID:e.publisher,topic:e.topic,payload:n})}catch(e){rM.error('[WP] c:"'.concat(this.getKey(),'" failed to parse broadcast payload:'),e)}return}r.updateCount(Number(e.count),Number(e.seq))&&r.publish({type:nf.PresenceChanged,count:Number(e.count)})}}handleWatchDocumentResponse(e,t){if("event"===t.body.case&&t.body.value.type===g.DOCUMENT_CHANGED){void 0!==e.changeEventReceived&&(e.changeEventReceived=!0);return}e.resource.applyWatchStream(t)}deactivateInternal(){for(let[e,t]of(this.status="deactivated",this.attachmentMap))this.detachInternal(e),t.resource instanceof nc?t.resource.applyStatus(ni.Detached):t.resource instanceof ng&&t.resource.applyStatus(nu.Detached)}detachInternal(e){let t=this.attachmentMap.get(e);t&&(t.cancelWatchStream(),t.resource instanceof nc&&t.resource.resetOnlineClients(),this.attachmentMap.delete(e))}async syncInternal(e,t){let{resource:r}=e;if(r instanceof ng){try{let t=await this.rpcClient.refreshChannel({clientId:this.id,channelKey:r.getKey(),sessionId:r.getSessionID()},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(r.getFirstKeyPath())}});r.updateCount(Number(t.count),0),e.updateHeartbeatTime(),rM.debug('[RP] c:"'.concat(this.getKey(),'" refreshes p:"').concat(r.getKey(),'" mode:').concat(e.syncMode))}catch(e){throw rM.error('[RP] c:"'.concat(this.getKey(),'" err :'),e),e}return r}let{resourceID:n}=e,i=r.createChangePack();try{let s=await this.rpcClient.pushPullChanges({clientId:this.id,documentId:n,changePack:rL.toChangePack(i),pushOnly:"realtime-pushonly"===t},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(r.getKey())}}),a=rL.fromChangePack(s.changePack);if(a.hasChanges()&&("realtime-pushonly"===e.syncMode||"realtime-syncoff"===e.syncMode))return r;r.applyChangePack(a),e.resource.publish([{type:ns.SyncStatusChanged,value:no.Synced}]),r.getStatus()===ni.Removed&&this.detachInternal(r.getKey());let o=r.getKey(),c=a.getChangeSize();return rM.info('[PP] c:"'.concat(this.getKey(),'" sync d:"').concat(o,'", push:').concat(i.getChangeSize()," pull:").concat(c," cp:").concat(a.getCheckpoint().toTestString())),r}catch(e){throw r.publish([{type:ns.SyncStatusChanged,value:no.SyncFailed}]),rM.error('[PP] c:"'.concat(this.getKey(),'" err :'),e),e}}async handleConnectError(e){if(!(e instanceof i.T))return!1;if(e.code===s.C.Canceled||e.code===s.C.Unknown||e.code===s.C.ResourceExhausted||e.code===s.C.Unavailable)return!0;if(rp(e)===eZ.ErrUnauthenticated){if(this.authTokenInjector){let t=await this.authTokenInjector(rm(e).reason);this.setAuthToken(t)}return!0}return rp(e)===eZ.ErrTooManySubscribers?(rM.error('[WD] c:"'.concat(this.getKey(),'" err :'),e.rawMessage),!0):rp(e)!==eZ.ErrTooManyAttachments&&((rp(e)===eZ.ErrClientNotActivated||rp(e)===eZ.ErrClientNotFound)&&this.deactivateInternal(),!1)}enqueueTask(e){return new Promise((t,r)=>{this.taskQueue.push(()=>e().then(t).catch(r)),this.processing||this.processNext()})}async processNext(){if(0===this.taskQueue.length){this.processing=!1;return}try{this.processing=!0;let e=this.taskQueue.shift();await e()}catch(e){rM.error('[TQ] c:"'.concat(this.getKey(),'" process failed, id:"').concat(this.id,'"'))}this.processNext()}constructor(e){var t,r,n,i;this.processing=!1,this.keepalive=!1;let s=(e=e||np).rpcAddr||np.rpcAddr;this.key=e.key||rK(),this.metadata=e.metadata||{},this.status="deactivated",this.attachmentMap=new Map,this.apiKey=e.apiKey||"",this.authTokenInjector=e.authTokenInjector,this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=null!==(t=e.syncLoopDuration)&&void 0!==t?t:np.syncLoopDuration,this.reconnectStreamDelay=null!==(r=e.reconnectStreamDelay)&&void 0!==r?r:np.reconnectStreamDelay,this.retrySyncLoopDelay=null!==(n=e.retrySyncLoopDelay)&&void 0!==n?n:np.retrySyncLoopDelay,this.channelHeartbeatInterval=null!==(i=e.channelHeartbeatInterval)&&void 0!==i?i:np.channelHeartbeatInterval;let{authInterceptor:c,setToken:l}=function(e,t){let r;return{authInterceptor:t=>async n=>(e&&n.header.set("x-api-key",e),r&&n.header.set("authorization",r),await t(n)),setToken:e=>{r=e}}}(this.apiKey);this.setAuthToken=l,this.rpcClient=(0,a.UU)(eX,(0,o.o)({baseUrl:s,interceptors:[c,function(e){return t=>async r=>(e?r.header.set("x-yorkie-user-agent",e):r.header.set("x-yorkie-user-agent",nh.UU+"/"+nh.rE),await t(r))}(null==e?void 0:e.userAgent)],fetch:(e,t)=>fetch(e,{...t,keepalive:this.keepalive})})),this.taskQueue=[]}}t5.Int,t5.Long,"undefined"!=typeof globalThis&&(globalThis.yorkie={Client:nv,Document:nc,Primitive:to,Text:rY,Counter:rX,Tree:r2,Channel:ng,ChannelEventType:nf,LogLevel:rz,setLogLevel:function(e){rq=e},IntType:t5.Int,LongType:t5.Long});let nC=JSON.parse('{"UU":"@yorkie-js/react","rE":"0.6.40"}');var nw=r(7121);let nA=(0,nw.createContext)({client:void 0,loading:!0,error:void 0}),nS=e=>{let{children:t,...r}=e,{client:i,loading:s,error:a}=function(e){let[t,r]=(0,nw.useState)(void 0),[n,i]=(0,nw.useState)(!0),[s,a]=(0,nw.useState)(void 0),[o,c]=(0,nw.useState)(!1);return(0,nw.useEffect)(()=>{c(!0)},[]),(0,nw.useEffect)(()=>(i(!0),a(void 0),async function(){if(o)try{let t=new nv(e);await t.activate(),r(t)}catch(e){a(e instanceof Error?e:Error("Failed to activate client"))}finally{i(!1)}}(),()=>{(null==t?void 0:t.isActive())&&t.deactivate({keepalive:!0})}),[e.apiKey,e.rpcAddr,o]),{client:t,loading:n,error:s}}((0,nw.useMemo)(()=>({userAgent:nC.UU+"/"+nC.rE,...r}),[r.apiKey,r.rpcAddr]));return(0,n.jsx)(nA.Provider,{value:{client:i,loading:s,error:a},children:t})},nT=()=>{let e=(0,nw.useContext)(nA);if(!e)throw Error("useYorkie must be used under YorkieProvider");return{client:e.client,loading:e.loading,error:e.error}},nx=e=>(function(e){let t=new Set,r=e,n=()=>{t.forEach(e=>e(r))};return{subscribe:e=>(t.add(e),()=>t.delete(e)),getSnapshot:()=>r,setState:e=>{let t=r;r="function"==typeof e?e(t):e,t!==r&&n()},destroy:()=>{t.clear()}}})(e),nI=(0,nw.createContext)(void 0),nb=e=>{let{docKey:t,initialRoot:r={},initialPresence:i={},enableDevtools:s=!1,children:a}=e,{client:o,loading:c,error:l}=nT(),h=(0,nw.useRef)(void 0);h.current||(h.current=nx({doc:void 0,root:r,presences:[],connection:na.Disconnected,update:()=>{},loading:!0,error:void 0}));let d=h.current;return!function(e,t,r,n,i,s,a,o){let c=(0,nw.useRef)(i),l=(0,nw.useRef)(s),[h,d]=(0,nw.useState)(!1);(0,nw.useEffect)(()=>{d(!0)},[]),(0,nw.useEffect)(()=>{if(r){o.setState(e=>({...e,loading:!1,error:r}));return}if(!e||t||!h){o.setState(e=>({...e,loading:!0}));return}o.setState(e=>({...e,loading:!0,error:void 0}));let i=new nc(n,{enableDevtools:a}),s=[];return s.push(i.subscribe(()=>{o.setState(e=>({...e,root:i.getRoot()}))})),s.push(i.subscribe("presence",()=>{o.setState(e=>({...e,presences:i.getPresences()}))})),s.push(i.subscribe("connection",e=>{o.setState(t=>({...t,connection:e.value}))})),async function(){try{await (null==e?void 0:e.attach(i,{initialRoot:c.current,initialPresence:l.current}));let t=e=>{try{i.update(e)}catch(e){o.setState(t=>({...t,error:e instanceof Error?e:Error("Failed to update document")}))}};o.setState(e=>({...e,doc:i,root:i.getRoot(),presences:i.getPresences(),update:t}))}catch(e){o.setState(t=>({...t,error:e instanceof Error?e:Error("Failed to attach document")}))}finally{o.setState(e=>({...e,loading:!1}))}}(),()=>{for(let t of(e&&e.has(n)&&e.detach(i),s))t()}},[e,t,r,n,o,h])}(o,c,l,t,r,i,s,d),(0,n.jsx)(nI.Provider,{value:d,children:a})};var nk=r(4103),nP=r(566);let nE=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,nP.QP)((0,nk.$)(t))};function nD(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card",className:nE("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...r})}function nR(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-header",className:nE("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...r})}function nN(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-title",className:nE("leading-none font-semibold",t),...r})}function nB(e){let{className:t,...r}=e;return(0,n.jsx)("div",{"data-slot":"card-content",className:nE("px-6",t),...r})}function nJ(e){let{className:t,type:r,...i}=e;return(0,n.jsx)("input",{type:r,"data-slot":"input",className:nE("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...i})}var nO=r(5451);let n_=(0,r(981).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function nL(e){let{className:t,variant:r,size:i,asChild:s=!1,...a}=e,o=s?nO.DX:"button";return(0,n.jsx)(o,{"data-slot":"button",className:nE(n_({variant:r,size:i,className:t})),...a})}var nz=r(6390),nq=r(4830),nM=r(2495);let nK=()=>{let[e,t]=(0,nw.useState)(""),{root:r,presences:i,update:s,loading:a,error:o}=function(){let e=(0,nw.useContext)(nI);if(!e)throw Error("useDocument must be used within a DocumentProvider");return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is,n=(0,nw.useRef)(t),i=(0,nw.useRef)(r),s=(0,nw.useRef)(void 0);n.current=t,i.current=r;let a=()=>{let t=e.getSnapshot(),r=n.current?n.current(t):t;return void 0!==s.current&&i.current(s.current,r)?s.current:(s.current=r,r)};return(0,nw.useSyncExternalStore)(e.subscribe,a,a)}(e)}(),c=(0,nw.useMemo)(()=>null==i?void 0:i.length,[i]),l=()=>{""!==e.trim()&&(s(t=>{t.todos.push({id:String(Date.now()),text:e,completed:!1})}),t(""))},h=e=>{s(t=>{for(let r of t.todos)if(r.id===e){r.completed=!r.completed;break}})},d=e=>{s(t=>{let r=t.todos.findIndex(t=>t.id===e);if(-1!==r){var n,i;null===(n=(i=t.todos).delete)||void 0===n||n.call(i,r)}})};return a?(0,n.jsx)("p",{children:"Loading..."}):o?(0,n.jsxs)("p",{children:["Error: ",o.message]}):(0,n.jsxs)(nD,{className:"w-full max-w-md mx-auto",children:[(0,n.jsxs)(nR,{children:[(0,n.jsx)(nN,{className:"text-center",children:"Todo List"}),(0,n.jsx)("div",{className:"text-center text-sm text-gray-500",children:c>0?(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,n.jsx)("div",{className:"flex -space-x-2",children:[...Array(Math.min(c,3))].map((e,t)=>(0,n.jsx)("div",{className:"h-8 w-8 rounded-full bg-gradient-to-r from-blue-200 to-blue-300 border-2 border-white flex items-center justify-center text-white text-xs",children:"\uD83D\uDC64"},t))}),(0,n.jsx)("span",{children:1===c?"Working solo":"".concat(c," people in this space")})]}):(0,n.jsx)("span",{className:"text-gray-400",children:"No participants"})})]}),(0,n.jsxs)(nB,{children:[(0,n.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,n.jsx)(nJ,{type:"text",value:e,onChange:e=>t(e.target.value),onKeyUp:e=>{"Enter"===e.key&&l()},placeholder:"Enter a new todo",className:"flex-1"}),(0,n.jsx)(nL,{onClick:l,className:"px-4",children:(0,n.jsx)(nz.A,{className:"h-4 w-4"})})]}),(0,n.jsx)("div",{className:"space-y-2",children:r.todos.map(e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(nL,{variant:e.completed?"default":"outline",size:"sm",onClick:()=>h(e.id),children:(0,n.jsx)(nq.A,{className:"h-4 w-4"})}),(0,n.jsx)("span",{className:"".concat(e.completed?"line-through text-gray-500":""),children:e.text})]}),(0,n.jsx)(nL,{variant:"ghost",size:"sm",onClick:()=>d(e.id),className:"text-red-500 hover:text-red-700",children:(0,n.jsx)(nM.A,{className:"h-4 w-4"})})]},e.id))})]})]})};function nF(){return(0,n.jsx)(nS,{apiKey:"D6sd9E5ehtXBssmeRZ4QQP",rpcAddr:"https://api.yorkie.dev",children:(0,n.jsx)(nb,{docKey:"nextjs-todolist",initialRoot:{todos:[]},children:(0,n.jsx)("main",{className:"container mx-auto p-4",children:(0,n.jsx)(nK,{})})})})}},9236:(e,t,r)=>{Promise.resolve().then(r.bind(r,5149))}},e=>{var t=t=>e(e.s=t);e.O(0,[65,508,590,358],()=>t(9236)),_N_E=e.O()}]);