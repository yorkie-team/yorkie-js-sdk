var yc=Object.defineProperty;var vc=(n,t,e)=>t in n?yc(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>vc(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=e(i);fetch(i.href,s)}})();var D;(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(D||(D={}));function io(n){const t=D[n];return typeof t!="string"?n.toString():t[0].toLowerCase()+t.substring(1).replace(/[A-Z]/g,e=>"_"+e.toLowerCase())}class $ extends Error{constructor(t,e=D.Unknown,r,i,s){super(wc(t,e)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=t,this.code=e,this.metadata=new Headers(r??{}),this.details=i??[],this.cause=s}static from(t,e=D.Unknown){return t instanceof $?t:t instanceof Error?t.name=="AbortError"?new $(t.message,D.Canceled):new $(t.message,e,void 0,void 0,t):new $(String(t),e,void 0,void 0,t)}static[Symbol.hasInstance](t){return t instanceof Error?Object.getPrototypeOf(t)===$.prototype?!0:t.name==="ConnectError"&&"code"in t&&typeof t.code=="number"&&"metadata"in t&&"details"in t&&Array.isArray(t.details)&&"rawMessage"in t&&typeof t.rawMessage=="string"&&"cause"in t:!1}findDetails(t){const e="typeName"in t?{findMessage:i=>i===t.typeName?t:void 0}:t,r=[];for(const i of this.details){if("getType"in i){e.findMessage(i.getType().typeName)&&r.push(i);continue}const s=e.findMessage(i.type);if(s)try{r.push(s.fromBinary(i.value))}catch{}}return r}}function wc(n,t){return n.length?`[${io(t)}] ${n}`:`[${io(t)}]`}function W(n,t){if(!n)throw new Error(t)}const Tc=34028234663852886e22,Sc=-34028234663852886e22,bc=4294967295,Ic=2147483647,Ac=-2147483648;function Yn(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>Ic||n<Ac)throw new Error("invalid int 32: "+n)}function Yi(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>bc||n<0)throw new Error("invalid uint 32: "+n)}function sa(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Tc||n<Sc))throw new Error("invalid float 32: "+n)}const oa=Symbol("@bufbuild/protobuf/enum-type");function kc(n){const t=n[oa];return W(t,"missing enum type on enum object"),t}function aa(n,t,e,r){n[oa]=ca(t,e.map(i=>({no:i.no,name:i.name,localName:n[i.no]})))}function ca(n,t,e){const r=Object.create(null),i=Object.create(null),s=[];for(const a of t){const c=ua(a);s.push(c),r[a.name]=c,i[a.no]=c}return{typeName:n,values:s,findName(a){return r[a]},findNumber(a){return i[a]}}}function Ec(n,t,e){const r={};for(const i of t){const s=ua(i);r[s.localName]=s.no,r[s.no]=s.localName}return aa(r,n,t),r}function ua(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class T{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,e){const r=this.getType(),i=r.runtime.bin,s=i.makeReadOptions(e);return i.readMessage(this,s.readerFactory(t),t.byteLength,s),this}fromJson(t,e){const r=this.getType(),i=r.runtime.json,s=i.makeReadOptions(e);return i.readMessage(r,t,s,this),this}fromJsonString(t,e){let r;try{r=JSON.parse(t)}catch(i){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${i instanceof Error?i.message:String(i)}`)}return this.fromJson(r,e)}toBinary(t){const e=this.getType(),r=e.runtime.bin,i=r.makeWriteOptions(t),s=i.writerFactory();return r.writeMessage(this,s,i),s.finish()}toJson(t){const e=this.getType(),r=e.runtime.json,i=r.makeWriteOptions(t);return r.writeMessage(this,i)}toJsonString(t){var e;const r=this.toJson(t);return JSON.stringify(r,null,(e=t==null?void 0:t.prettySpaces)!==null&&e!==void 0?e:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function xc(n,t,e,r){var i;const s=(i=r==null?void 0:r.localName)!==null&&i!==void 0?i:t.substring(t.lastIndexOf(".")+1),a={[s]:function(c){n.util.initFields(this),n.util.initPartial(c,this)}}[s];return Object.setPrototypeOf(a.prototype,new T),Object.assign(a,{runtime:n,typeName:t,fields:n.util.newFieldList(e),fromBinary(c,l){return new a().fromBinary(c,l)},fromJson(c,l){return new a().fromJson(c,l)},fromJsonString(c,l){return new a().fromJsonString(c,l)},equals(c,l){return n.util.equals(a,c,l)}}),a}function Nc(){let n=0,t=0;for(let r=0;r<28;r+=7){let i=this.buf[this.pos++];if(n|=(i&127)<<r,!(i&128))return this.assertBounds(),[n,t]}let e=this.buf[this.pos++];if(n|=(e&15)<<28,t=(e&112)>>4,!(e&128))return this.assertBounds(),[n,t];for(let r=3;r<=31;r+=7){let i=this.buf[this.pos++];if(t|=(i&127)<<r,!(i&128))return this.assertBounds(),[n,t]}throw new Error("invalid varint")}function Ui(n,t,e){for(let s=0;s<28;s=s+7){const a=n>>>s,c=!(!(a>>>7)&&t==0),l=(c?a|128:a)&255;if(e.push(l),!c)return}const r=n>>>28&15|(t&7)<<4,i=!!(t>>3);if(e.push((i?r|128:r)&255),!!i){for(let s=3;s<31;s=s+7){const a=t>>>s,c=!!(a>>>7),l=(c?a|128:a)&255;if(e.push(l),!c)return}e.push(t>>>31&1)}}const Xn=4294967296;function so(n){const t=n[0]==="-";t&&(n=n.slice(1));const e=1e6;let r=0,i=0;function s(a,c){const l=Number(n.slice(a,c));i*=e,r=r*e+l,r>=Xn&&(i=i+(r/Xn|0),r=r%Xn)}return s(-24,-18),s(-18,-12),s(-12,-6),s(-6),t?ha(r,i):$s(r,i)}function Pc(n,t){let e=$s(n,t);const r=e.hi&2147483648;r&&(e=ha(e.lo,e.hi));const i=la(e.lo,e.hi);return r?"-"+i:i}function la(n,t){if({lo:n,hi:t}=Cc(n,t),t<=2097151)return String(Xn*t+n);const e=n&16777215,r=(n>>>24|t<<8)&16777215,i=t>>16&65535;let s=e+r*6777216+i*6710656,a=r+i*8147497,c=i*2;const l=1e7;return s>=l&&(a+=Math.floor(s/l),s%=l),a>=l&&(c+=Math.floor(a/l),a%=l),c.toString()+oo(a)+oo(s)}function Cc(n,t){return{lo:n>>>0,hi:t>>>0}}function $s(n,t){return{lo:n|0,hi:t|0}}function ha(n,t){return t=~t,n?n=~n+1:t+=1,$s(n,t)}const oo=n=>{const t=String(n);return"0000000".slice(t.length)+t};function ao(n,t){if(n>=0){for(;n>127;)t.push(n&127|128),n=n>>>7;t.push(n)}else{for(let e=0;e<9;e++)t.push(n&127|128),n=n>>7;t.push(1)}}function Dc(){let n=this.buf[this.pos++],t=n&127;if(!(n&128))return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<7,!(n&128))return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<14,!(n&128))return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<21,!(n&128))return this.assertBounds(),t;n=this.buf[this.pos++],t|=(n&15)<<28;for(let e=5;n&128&&e<10;e++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var co={};function Bc(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof co!="object"||co.BUF_BIGINT_DISABLE!=="1")){const i=BigInt("-9223372036854775808"),s=BigInt("9223372036854775807"),a=BigInt("0"),c=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const h=typeof l=="bigint"?l:BigInt(l);if(h>s||h<i)throw new Error(`int64 invalid: ${l}`);return h},uParse(l){const h=typeof l=="bigint"?l:BigInt(l);if(h>c||h<a)throw new Error(`uint64 invalid: ${l}`);return h},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,h){return n.setInt32(0,l,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(l,h){return n.setInt32(0,l,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const e=i=>W(/^-?[0-9]+$/.test(i),`int64 invalid: ${i}`),r=i=>W(/^[0-9]+$/.test(i),`uint64 invalid: ${i}`);return{zero:"0",supported:!1,parse(i){return typeof i!="string"&&(i=i.toString()),e(i),i},uParse(i){return typeof i!="string"&&(i=i.toString()),r(i),i},enc(i){return typeof i!="string"&&(i=i.toString()),e(i),so(i)},uEnc(i){return typeof i!="string"&&(i=i.toString()),r(i),so(i)},dec(i,s){return Pc(i,s)},uDec(i,s){return la(i,s)}}}const O=Bc();var v;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(v||(v={}));var Or;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(Or||(Or={}));function xr(n,t,e){if(t===e)return!0;if(n==v.BYTES){if(!(t instanceof Uint8Array)||!(e instanceof Uint8Array)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}switch(n){case v.UINT64:case v.FIXED64:case v.INT64:case v.SFIXED64:case v.SINT64:return t==e}return!1}function rn(n,t){switch(n){case v.BOOL:return!1;case v.UINT64:case v.FIXED64:case v.INT64:case v.SFIXED64:case v.SINT64:return t==0?O.zero:"0";case v.DOUBLE:case v.FLOAT:return 0;case v.BYTES:return new Uint8Array(0);case v.STRING:return"";default:return 0}}function fa(n,t){switch(n){case v.BOOL:return t===!1;case v.STRING:return t==="";case v.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var H;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(H||(H={}));class Oc{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let i=0;i<this.chunks.length;i++)t+=this.chunks[i].length;let e=new Uint8Array(t),r=0;for(let i=0;i<this.chunks.length;i++)e.set(this.chunks[i],r),r+=this.chunks[i].length;return this.chunks=[],e}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,e){return this.uint32((t<<3|e)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(Yi(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return Yn(t),ao(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let e=this.textEncoder.encode(t);return this.uint32(e.byteLength),this.raw(e)}float(t){sa(t);let e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,t,!0),this.raw(e)}double(t){let e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t,!0),this.raw(e)}fixed32(t){Yi(t);let e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t,!0),this.raw(e)}sfixed32(t){Yn(t);let e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,t,!0),this.raw(e)}sint32(t){return Yn(t),t=(t<<1^t>>31)>>>0,ao(t,this.buf),this}sfixed64(t){let e=new Uint8Array(8),r=new DataView(e.buffer),i=O.enc(t);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(e)}fixed64(t){let e=new Uint8Array(8),r=new DataView(e.buffer),i=O.uEnc(t);return r.setInt32(0,i.lo,!0),r.setInt32(4,i.hi,!0),this.raw(e)}int64(t){let e=O.enc(t);return Ui(e.lo,e.hi,this.buf),this}sint64(t){let e=O.enc(t),r=e.hi>>31,i=e.lo<<1^r,s=(e.hi<<1|e.lo>>>31)^r;return Ui(i,s,this.buf),this}uint64(t){let e=O.uEnc(t);return Ui(e.lo,e.hi,this.buf),this}}class Lc{constructor(t,e){this.varint64=Nc,this.uint32=Dc,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=e??new TextDecoder}tag(){let t=this.uint32(),e=t>>>3,r=t&7;if(e<=0||r<0||r>5)throw new Error("illegal tag: field no "+e+" wire type "+r);return[e,r]}skip(t,e){let r=this.pos;switch(t){case H.Varint:for(;this.buf[this.pos++]&128;);break;case H.Bit64:this.pos+=4;case H.Bit32:this.pos+=4;break;case H.LengthDelimited:let i=this.uint32();this.pos+=i;break;case H.StartGroup:for(;;){const[s,a]=this.tag();if(a===H.EndGroup){if(e!==void 0&&s!==e)throw new Error("invalid end group tag");break}this.skip(a,s)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return O.dec(...this.varint64())}uint64(){return O.uDec(...this.varint64())}sint64(){let[t,e]=this.varint64(),r=-(t&1);return t=(t>>>1|(e&1)<<31)^r,e=e>>>1^r,O.dec(t,e)}bool(){let[t,e]=this.varint64();return t!==0||e!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return O.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return O.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),e=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(e,e+t)}string(){return this.textDecoder.decode(this.bytes())}}function Jc(n,t,e,r){let i;return{typeName:t,extendee:e,get field(){if(!i){const s=typeof r=="function"?r():r;s.name=t.split(".").pop(),s.jsonName=`[${t}]`,i=n.util.newFieldList([s]).list()[0]}return i},runtime:n}}function da(n){const t=n.field.localName,e=Object.create(null);return e[t]=Rc(n),[e,()=>e[t]]}function Rc(n){const t=n.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return rn(t.T,t.L);case"message":const e=t.T,r=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function $c(n,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let e=n.length-1;e>=0;--e)if(n[e].no==t.no)return[n[e]];return[]}return n.filter(e=>e.no===t.no)}let yr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Li=[];for(let n=0;n<yr.length;n++)Li[yr[n].charCodeAt(0)]=n;Li[45]=yr.indexOf("+");Li[95]=yr.indexOf("/");const Ms={dec(n){let t=n.length*3/4;n[n.length-2]=="="?t-=2:n[n.length-1]=="="&&(t-=1);let e=new Uint8Array(t),r=0,i=0,s,a=0;for(let c=0;c<n.length;c++){if(s=Li[n.charCodeAt(c)],s===void 0)switch(n[c]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(i){case 0:a=s,i=1;break;case 1:e[r++]=a<<2|(s&48)>>4,a=s,i=2;break;case 2:e[r++]=(a&15)<<4|(s&60)>>2,a=s,i=3;break;case 3:e[r++]=(a&3)<<6|s,i=0;break}}if(i==1)throw Error("invalid base64 string.");return e.subarray(0,r)},enc(n){let t="",e=0,r,i=0;for(let s=0;s<n.length;s++)switch(r=n[s],e){case 0:t+=yr[r>>2],i=(r&3)<<4,e=1;break;case 1:t+=yr[i|r>>4],i=(r&15)<<2,e=2;break;case 2:t+=yr[i|r>>6],t+=yr[r&63],e=0;break}return e&&(t+=yr[i],t+="=",e==1&&(t+="=")),t}};function Mc(n,t,e){ma(t,n);const r=t.runtime.bin.makeReadOptions(e),i=$c(n.getType().runtime.bin.listUnknownFields(n),t.field),[s,a]=da(t);for(const c of i)t.runtime.bin.readField(s,r.readerFactory(c.data),t.field,c.wireType,r);return a()}function Fc(n,t,e,r){ma(t,n);const i=t.runtime.bin.makeReadOptions(r),s=t.runtime.bin.makeWriteOptions(r);if(ga(n,t)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(f=>f.no!=t.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const f of h)n.getType().runtime.bin.onUnknownField(n,f.no,f.wireType,f.data)}const a=s.writerFactory();let c=t.field;!c.opt&&!c.repeated&&(c.kind=="enum"||c.kind=="scalar")&&(c=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(c,e,a,s);const l=i.readerFactory(a.finish());for(;l.pos<l.len;){const[h,f]=l.tag(),m=l.skip(f,h);n.getType().runtime.bin.onUnknownField(n,h,f,m)}}function ga(n,t){const e=n.getType();return t.extendee.typeName===e.typeName&&!!e.runtime.bin.listUnknownFields(n).find(r=>r.no==t.field.no)}function ma(n,t){W(n.extendee.typeName==t.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function pa(n,t){const e=n.localName;if(n.repeated)return t[e].length>0;if(n.oneof)return t[n.oneof.localName].case===e;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?t[e]!==void 0:n.kind=="enum"?t[e]!==n.T.values[0].no:!fa(n.T,t[e]);case"message":return t[e]!==void 0;case"map":return Object.keys(t[e]).length>0}}function uo(n,t){const e=n.localName,r=!n.opt&&!n.req;if(n.repeated)t[e]=[];else if(n.oneof)t[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":t[e]={};break;case"enum":t[e]=r?n.T.values[0].no:void 0;break;case"scalar":t[e]=r?rn(n.T,n.L):void 0;break;case"message":t[e]=void 0;break}}function vr(n,t){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(T.prototype).every(r=>r in n&&typeof n[r]=="function"))return!1;const e=n.getType();return e===null||typeof e!="function"||!("typeName"in e)||typeof e.typeName!="string"?!1:t===void 0?!0:e.typeName==t.typeName}function ya(n,t){return vr(t)||!n.fieldWrapper?t:n.fieldWrapper.wrapField(t)}v.DOUBLE,v.FLOAT,v.INT64,v.UINT64,v.INT32,v.UINT32,v.BOOL,v.STRING,v.BYTES;const lo={ignoreUnknownFields:!1},ho={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function zc(n){return n?Object.assign(Object.assign({},lo),n):lo}function qc(n){return n?Object.assign(Object.assign({},ho),n):ho}const si=Symbol(),Zn=Symbol();function Uc(){return{makeReadOptions:zc,makeWriteOptions:qc,readMessage(n,t,e,r){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${Ue(t)}`);r=r??new n;const i=new Map,s=e.typeRegistry;for(const[a,c]of Object.entries(t)){const l=n.fields.findJsonName(a);if(l){if(l.oneof){if(c===null&&l.kind=="scalar")continue;const h=i.get(l.oneof);if(h!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${l.oneof.name}" present: "${h}", "${a}"`);i.set(l.oneof,a)}fo(r,c,l,e,n)}else{let h=!1;if(s!=null&&s.findExtension&&a.startsWith("[")&&a.endsWith("]")){const f=s.findExtension(a.substring(1,a.length-1));if(f&&f.extendee.typeName==n.typeName){h=!0;const[m,y]=da(f);fo(m,c,f.field,e,f),Fc(r,f,y(),e)}}if(!h&&!e.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${a}" is unknown`)}}return r},writeMessage(n,t){const e=n.getType(),r={};let i;try{for(i of e.fields.byNumber()){if(!pa(i,n)){if(i.req)throw"required field not set";if(!t.emitDefaultValues||!Vc(i))continue}const a=i.oneof?n[i.oneof.localName].value:n[i.localName],c=go(i,a,t);c!==void 0&&(r[t.useProtoFieldName?i.name:i.jsonName]=c)}const s=t.typeRegistry;if(s!=null&&s.findExtensionFor)for(const a of e.runtime.bin.listUnknownFields(n)){const c=s.findExtensionFor(e.typeName,a.no);if(c&&ga(n,c)){const l=Mc(n,c,t),h=go(c.field,l,t);h!==void 0&&(r[c.field.jsonName]=h)}}}catch(s){const a=i?`cannot encode field ${e.typeName}.${i.name} to JSON`:`cannot encode message ${e.typeName} to JSON`,c=s instanceof Error?s.message:String(s);throw new Error(a+(c.length>0?`: ${c}`:""))}return r},readScalar(n,t,e){return wn(n,t,e??Or.BIGINT,!0)},writeScalar(n,t,e){if(t!==void 0&&(e||fa(n,t)))return Qn(n,t)},debug:Ue}}function Ue(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function fo(n,t,e,r,i){let s=e.localName;if(e.repeated){if(W(e.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error(`cannot decode field ${i.typeName}.${e.name} from JSON: ${Ue(t)}`);const a=n[s];for(const c of t){if(c===null)throw new Error(`cannot decode field ${i.typeName}.${e.name} from JSON: ${Ue(c)}`);switch(e.kind){case"message":a.push(e.T.fromJson(c,r));break;case"enum":const l=Ki(e.T,c,r.ignoreUnknownFields,!0);l!==Zn&&a.push(l);break;case"scalar":try{a.push(wn(e.T,c,e.L,!0))}catch(h){let f=`cannot decode field ${i.typeName}.${e.name} from JSON: ${Ue(c)}`;throw h instanceof Error&&h.message.length>0&&(f+=`: ${h.message}`),new Error(f)}break}}}else if(e.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error(`cannot decode field ${i.typeName}.${e.name} from JSON: ${Ue(t)}`);const a=n[s];for(const[c,l]of Object.entries(t)){if(l===null)throw new Error(`cannot decode field ${i.typeName}.${e.name} from JSON: map value null`);let h;try{h=Kc(e.K,c)}catch(f){let m=`cannot decode map key for field ${i.typeName}.${e.name} from JSON: ${Ue(t)}`;throw f instanceof Error&&f.message.length>0&&(m+=`: ${f.message}`),new Error(m)}switch(e.V.kind){case"message":a[h]=e.V.T.fromJson(l,r);break;case"enum":const f=Ki(e.V.T,l,r.ignoreUnknownFields,!0);f!==Zn&&(a[h]=f);break;case"scalar":try{a[h]=wn(e.V.T,l,Or.BIGINT,!0)}catch(m){let y=`cannot decode map value for field ${i.typeName}.${e.name} from JSON: ${Ue(t)}`;throw m instanceof Error&&m.message.length>0&&(y+=`: ${m.message}`),new Error(y)}break}}}else switch(e.oneof&&(n=n[e.oneof.localName]={case:s},s="value"),e.kind){case"message":const a=e.T;if(t===null&&a.typeName!="google.protobuf.Value")return;let c=n[s];vr(c)?c.fromJson(t,r):(n[s]=c=a.fromJson(t,r),a.fieldWrapper&&!e.oneof&&(n[s]=a.fieldWrapper.unwrapField(c)));break;case"enum":const l=Ki(e.T,t,r.ignoreUnknownFields,!1);switch(l){case si:uo(e,n);break;case Zn:break;default:n[s]=l;break}break;case"scalar":try{const h=wn(e.T,t,e.L,!1);switch(h){case si:uo(e,n);break;default:n[s]=h;break}}catch(h){let f=`cannot decode field ${i.typeName}.${e.name} from JSON: ${Ue(t)}`;throw h instanceof Error&&h.message.length>0&&(f+=`: ${h.message}`),new Error(f)}break}}function Kc(n,t){if(n===v.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return wn(n,t,Or.BIGINT,!0).toString()}function wn(n,t,e,r){if(t===null)return r?rn(n,e):si;switch(n){case v.DOUBLE:case v.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const i=Number(t);if(Number.isNaN(i)||!Number.isFinite(i))break;return n==v.FLOAT&&sa(i),i;case v.INT32:case v.FIXED32:case v.SFIXED32:case v.SINT32:case v.UINT32:let s;if(typeof t=="number"?s=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(s=Number(t)),s===void 0)break;return n==v.UINT32||n==v.FIXED32?Yi(s):Yn(s),s;case v.INT64:case v.SFIXED64:case v.SINT64:if(typeof t!="number"&&typeof t!="string")break;const a=O.parse(t);return e?a.toString():a;case v.FIXED64:case v.UINT64:if(typeof t!="number"&&typeof t!="string")break;const c=O.uParse(t);return e?c.toString():c;case v.BOOL:if(typeof t!="boolean")break;return t;case v.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case v.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return Ms.dec(t)}throw new Error}function Ki(n,t,e,r){if(t===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].no:si;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const i=n.findName(t);if(i!==void 0)return i.no;if(e)return Zn;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${Ue(t)}`)}function Vc(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function go(n,t,e){if(n.kind=="map"){W(typeof t=="object"&&t!=null);const r={},i=Object.entries(t);switch(n.V.kind){case"scalar":for(const[a,c]of i)r[a.toString()]=Qn(n.V.T,c);break;case"message":for(const[a,c]of i)r[a.toString()]=c.toJson(e);break;case"enum":const s=n.V.T;for(const[a,c]of i)r[a.toString()]=Vi(s,c,e.enumAsInteger);break}return e.emitDefaultValues||i.length>0?r:void 0}if(n.repeated){W(Array.isArray(t));const r=[];switch(n.kind){case"scalar":for(let i=0;i<t.length;i++)r.push(Qn(n.T,t[i]));break;case"enum":for(let i=0;i<t.length;i++)r.push(Vi(n.T,t[i],e.enumAsInteger));break;case"message":for(let i=0;i<t.length;i++)r.push(t[i].toJson(e));break}return e.emitDefaultValues||r.length>0?r:void 0}switch(n.kind){case"scalar":return Qn(n.T,t);case"enum":return Vi(n.T,t,e.enumAsInteger);case"message":return ya(n.T,t).toJson(e)}}function Vi(n,t,e){var r;if(W(typeof t=="number"),n.typeName=="google.protobuf.NullValue")return null;if(e)return t;const i=n.findNumber(t);return(r=i==null?void 0:i.name)!==null&&r!==void 0?r:t}function Qn(n,t){switch(n){case v.INT32:case v.SFIXED32:case v.SINT32:case v.FIXED32:case v.UINT32:return W(typeof t=="number"),t;case v.FLOAT:case v.DOUBLE:return W(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case v.STRING:return W(typeof t=="string"),t;case v.BOOL:return W(typeof t=="boolean"),t;case v.UINT64:case v.FIXED64:case v.INT64:case v.SFIXED64:case v.SINT64:return W(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case v.BYTES:return W(t instanceof Uint8Array),Ms.enc(t)}}const Gr=Symbol("@bufbuild/protobuf/unknown-fields"),mo={readUnknownFields:!0,readerFactory:n=>new Lc(n)},po={writeUnknownFields:!0,writerFactory:()=>new Oc};function jc(n){return n?Object.assign(Object.assign({},mo),n):mo}function Wc(n){return n?Object.assign(Object.assign({},po),n):po}function Gc(){return{makeReadOptions:jc,makeWriteOptions:Wc,listUnknownFields(n){var t;return(t=n[Gr])!==null&&t!==void 0?t:[]},discardUnknownFields(n){delete n[Gr]},writeUnknownFields(n,t){const r=n[Gr];if(r)for(const i of r)t.tag(i.no,i.wireType).raw(i.data)},onUnknownField(n,t,e,r){const i=n;Array.isArray(i[Gr])||(i[Gr]=[]),i[Gr].push({no:t,wireType:e,data:r})},readMessage(n,t,e,r,i){const s=n.getType(),a=i?t.len:t.pos+e;let c,l;for(;t.pos<a&&([c,l]=t.tag(),!(i===!0&&l==H.EndGroup));){const h=s.fields.find(c);if(!h){const f=t.skip(l,c);r.readUnknownFields&&this.onUnknownField(n,c,l,f);continue}yo(n,t,h,l,r)}if(i&&(l!=H.EndGroup||c!==e))throw new Error("invalid end group tag")},readField:yo,writeMessage(n,t,e){const r=n.getType();for(const i of r.fields.byNumber()){if(!pa(i,n)){if(i.req)throw new Error(`cannot encode field ${r.typeName}.${i.name} to binary: required field not set`);continue}const s=i.oneof?n[i.oneof.localName].value:n[i.localName];vo(i,s,t,e)}return e.writeUnknownFields&&this.writeUnknownFields(n,t),t},writeField(n,t,e,r){t!==void 0&&vo(n,t,e,r)}}}function yo(n,t,e,r,i){let{repeated:s,localName:a}=e;switch(e.oneof&&(n=n[e.oneof.localName],n.case!=a&&delete n.value,n.case=a,a="value"),e.kind){case"scalar":case"enum":const c=e.kind=="enum"?v.INT32:e.T;let l=oi;if(e.kind=="scalar"&&e.L>0&&(l=Yc),s){let y=n[a];if(r==H.LengthDelimited&&c!=v.STRING&&c!=v.BYTES){let S=t.uint32()+t.pos;for(;t.pos<S;)y.push(l(t,c))}else y.push(l(t,c))}else n[a]=l(t,c);break;case"message":const h=e.T;s?n[a].push(_n(t,new h,i,e)):vr(n[a])?_n(t,n[a],i,e):(n[a]=_n(t,new h,i,e),h.fieldWrapper&&!e.oneof&&!e.repeated&&(n[a]=h.fieldWrapper.unwrapField(n[a])));break;case"map":let[f,m]=Hc(e,t,i);n[a][f]=m;break}}function _n(n,t,e,r){const i=t.getType().runtime.bin,s=r==null?void 0:r.delimited;return i.readMessage(t,n,s?r.no:n.uint32(),e,s),t}function Hc(n,t,e){const r=t.uint32(),i=t.pos+r;let s,a;for(;t.pos<i;){const[c]=t.tag();switch(c){case 1:s=oi(t,n.K);break;case 2:switch(n.V.kind){case"scalar":a=oi(t,n.V.T);break;case"enum":a=t.int32();break;case"message":a=_n(t,new n.V.T,e,void 0);break}break}}if(s===void 0&&(s=rn(n.K,Or.BIGINT)),typeof s!="string"&&typeof s!="number"&&(s=s.toString()),a===void 0)switch(n.V.kind){case"scalar":a=rn(n.V.T,Or.BIGINT);break;case"enum":a=n.V.T.values[0].no;break;case"message":a=new n.V.T;break}return[s,a]}function Yc(n,t){const e=oi(n,t);return typeof e=="bigint"?e.toString():e}function oi(n,t){switch(t){case v.STRING:return n.string();case v.BOOL:return n.bool();case v.DOUBLE:return n.double();case v.FLOAT:return n.float();case v.INT32:return n.int32();case v.INT64:return n.int64();case v.UINT64:return n.uint64();case v.FIXED64:return n.fixed64();case v.BYTES:return n.bytes();case v.FIXED32:return n.fixed32();case v.SFIXED32:return n.sfixed32();case v.SFIXED64:return n.sfixed64();case v.SINT64:return n.sint64();case v.UINT32:return n.uint32();case v.SINT32:return n.sint32()}}function vo(n,t,e,r){W(t!==void 0);const i=n.repeated;switch(n.kind){case"scalar":case"enum":let s=n.kind=="enum"?v.INT32:n.T;if(i)if(W(Array.isArray(t)),n.packed)Zc(e,s,n.no,t);else for(const a of t)Tn(e,s,n.no,a);else Tn(e,s,n.no,t);break;case"message":if(i){W(Array.isArray(t));for(const a of t)wo(e,r,n,a)}else wo(e,r,n,t);break;case"map":W(typeof t=="object"&&t!=null);for(const[a,c]of Object.entries(t))Xc(e,r,n,a,c);break}}function Xc(n,t,e,r,i){n.tag(e.no,H.LengthDelimited),n.fork();let s=r;switch(e.K){case v.INT32:case v.FIXED32:case v.UINT32:case v.SFIXED32:case v.SINT32:s=Number.parseInt(r);break;case v.BOOL:W(r=="true"||r=="false"),s=r=="true";break}switch(Tn(n,e.K,1,s),e.V.kind){case"scalar":Tn(n,e.V.T,2,i);break;case"enum":Tn(n,v.INT32,2,i);break;case"message":W(i!==void 0),n.tag(2,H.LengthDelimited).bytes(i.toBinary(t));break}n.join()}function wo(n,t,e,r){const i=ya(e.T,r);e.delimited?n.tag(e.no,H.StartGroup).raw(i.toBinary(t)).tag(e.no,H.EndGroup):n.tag(e.no,H.LengthDelimited).bytes(i.toBinary(t))}function Tn(n,t,e,r){W(r!==void 0);let[i,s]=va(t);n.tag(e,i)[s](r)}function Zc(n,t,e,r){if(!r.length)return;n.tag(e,H.LengthDelimited).fork();let[,i]=va(t);for(let s=0;s<r.length;s++)n[i](r[s]);n.join()}function va(n){let t=H.Varint;switch(n){case v.BYTES:case v.STRING:t=H.LengthDelimited;break;case v.DOUBLE:case v.FIXED64:case v.SFIXED64:t=H.Bit64;break;case v.FIXED32:case v.SFIXED32:case v.FLOAT:t=H.Bit32;break}const e=v[n].toLowerCase();return[t,e]}function Qc(){return{setEnumType:aa,initPartial(n,t){if(n===void 0)return;const e=t.getType();for(const r of e.fields.byMember()){const i=r.localName,s=t,a=n;if(a[i]!=null)switch(r.kind){case"oneof":const c=a[i].case;if(c===void 0)continue;const l=r.findField(c);let h=a[i].value;l&&l.kind=="message"&&!vr(h,l.T)?h=new l.T(h):l&&l.kind==="scalar"&&l.T===v.BYTES&&(h=gn(h)),s[i]={case:c,value:h};break;case"scalar":case"enum":let f=a[i];r.T===v.BYTES&&(f=r.repeated?f.map(gn):gn(f)),s[i]=f;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===v.BYTES)for(const[p,S]of Object.entries(a[i]))s[i][p]=gn(S);else Object.assign(s[i],a[i]);break;case"message":const y=r.V.T;for(const p of Object.keys(a[i])){let S=a[i][p];y.fieldWrapper||(S=new y(S)),s[i][p]=S}break}break;case"message":const m=r.T;if(r.repeated)s[i]=a[i].map(y=>vr(y,m)?y:new m(y));else{const y=a[i];m.fieldWrapper?m.typeName==="google.protobuf.BytesValue"?s[i]=gn(y):s[i]=y:s[i]=vr(y,m)?y:new m(y)}break}}},equals(n,t,e){return t===e?!0:!t||!e?!1:n.fields.byMember().every(r=>{const i=t[r.localName],s=e[r.localName];if(r.repeated){if(i.length!==s.length)return!1;switch(r.kind){case"message":return i.every((a,c)=>r.T.equals(a,s[c]));case"scalar":return i.every((a,c)=>xr(r.T,a,s[c]));case"enum":return i.every((a,c)=>xr(v.INT32,a,s[c]))}throw new Error(`repeated cannot contain ${r.kind}`)}switch(r.kind){case"message":let a=i,c=s;return r.T.fieldWrapper&&(a!==void 0&&!vr(a)&&(a=r.T.fieldWrapper.wrapField(a)),c!==void 0&&!vr(c)&&(c=r.T.fieldWrapper.wrapField(c))),r.T.equals(a,c);case"enum":return xr(v.INT32,i,s);case"scalar":return xr(r.T,i,s);case"oneof":if(i.case!==s.case)return!1;const l=r.findField(i.case);if(l===void 0)return!0;switch(l.kind){case"message":return l.T.equals(i.value,s.value);case"enum":return xr(v.INT32,i.value,s.value);case"scalar":return xr(l.T,i.value,s.value)}throw new Error(`oneof cannot contain ${l.kind}`);case"map":const h=Object.keys(i).concat(Object.keys(s));switch(r.V.kind){case"message":const f=r.V.T;return h.every(y=>f.equals(i[y],s[y]));case"enum":return h.every(y=>xr(v.INT32,i[y],s[y]));case"scalar":const m=r.V.T;return h.every(y=>xr(m,i[y],s[y]))}break}})},clone(n){const t=n.getType(),e=new t,r=e;for(const i of t.fields.byMember()){const s=n[i.localName];let a;if(i.repeated)a=s.map(Un);else if(i.kind=="map"){a=r[i.localName];for(const[c,l]of Object.entries(s))a[c]=Un(l)}else i.kind=="oneof"?a=i.findField(s.case)?{case:s.case,value:Un(s.value)}:{case:void 0}:a=Un(s);r[i.localName]=a}for(const i of t.runtime.bin.listUnknownFields(n))t.runtime.bin.onUnknownField(r,i.no,i.wireType,i.data);return e}}}function Un(n){if(n===void 0)return n;if(vr(n))return n.clone();if(n instanceof Uint8Array){const t=new Uint8Array(n.byteLength);return t.set(n),t}return n}function gn(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function _c(n,t,e){return{syntax:n,json:Uc(),bin:Gc(),util:Object.assign(Object.assign({},Qc()),{newFieldList:t,initFields:e}),makeMessageType(r,i,s){return xc(this,r,i,s)},makeEnum:Ec,makeEnumType:ca,getEnumType:kc,makeExtension(r,i,s){return Jc(this,r,i,s)}}}class eu{constructor(t,e){this._fields=t,this._normalizer=e}findJsonName(t){if(!this.jsonNames){const e={};for(const r of this.list())e[r.jsonName]=e[r.name]=r;this.jsonNames=e}return this.jsonNames[t]}find(t){if(!this.numbers){const e={};for(const r of this.list())e[r.no]=r;this.numbers=e}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,e)=>t.no-e.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let e;for(const r of this.list())r.oneof?r.oneof!==e&&(e=r.oneof,t.push(e)):t.push(r)}return this.members}}function wa(n,t){const e=Ta(n);return t?e:ou(su(e))}function tu(n){return wa(n,!1)}const ru=Ta;function Ta(n){let t=!1;const e=[];for(let r=0;r<n.length;r++){let i=n.charAt(r);switch(i){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":e.push(i),t=!1;break;default:t&&(t=!1,i=i.toUpperCase()),e.push(i);break}}return e.join("")}const nu=new Set(["constructor","toString","toJSON","valueOf"]),iu=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Sa=n=>`${n}$`,su=n=>iu.has(n)?Sa(n):n,ou=n=>nu.has(n)?Sa(n):n;class au{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=tu(t)}addField(t){W(t.oneof===this,`field ${t.name} not one of ${this.name}`),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[t]}}function cu(n,t){var e,r,i,s,a,c;const l=[];let h;for(const f of typeof n=="function"?n():n){const m=f;if(m.localName=wa(f.name,f.oneof!==void 0),m.jsonName=(e=f.jsonName)!==null&&e!==void 0?e:ru(f.name),m.repeated=(r=f.repeated)!==null&&r!==void 0?r:!1,f.kind=="scalar"&&(m.L=(i=f.L)!==null&&i!==void 0?i:Or.BIGINT),m.delimited=(s=f.delimited)!==null&&s!==void 0?s:!1,m.req=(a=f.req)!==null&&a!==void 0?a:!1,m.opt=(c=f.opt)!==null&&c!==void 0?c:!1,f.packed===void 0&&(m.packed=f.kind=="enum"||f.kind=="scalar"&&f.T!=v.BYTES&&f.T!=v.STRING),f.oneof!==void 0){const y=typeof f.oneof=="string"?f.oneof:f.oneof.name;(!h||h.name!=y)&&(h=new au(y)),m.oneof=h,h.addField(m)}l.push(m)}return l}const u=_c("proto3",n=>new eu(n,t=>cu(t)),n=>{for(const t of n.getType().fields.byMember()){if(t.opt)continue;const e=t.localName,r=n;if(t.repeated){r[e]=[];continue}switch(t.kind){case"oneof":r[e]={case:void 0};break;case"enum":r[e]=0;break;case"map":r[e]={};break;case"scalar":r[e]=rn(t.T,t.L);break}}});var Q;(function(n){n[n.Unary=0]="Unary",n[n.ServerStreaming=1]="ServerStreaming",n[n.ClientStreaming=2]="ClientStreaming",n[n.BiDiStreaming=3]="BiDiStreaming"})(Q||(Q={}));var To;(function(n){n[n.NoSideEffects=1]="NoSideEffects",n[n.Idempotent=2]="Idempotent"})(To||(To={}));class ee extends T{constructor(t){super(),this.seconds=O.zero,this.nanos=0,u.util.initPartial(t,this)}fromJson(t,e){if(typeof t!="string")throw new Error(`cannot decode google.protobuf.Timestamp from JSON: ${u.json.debug(t)}`);const r=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const i=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(i))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=O.parse(i/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(t){const e=Number(this.seconds)*1e3;if(e<Date.parse("0001-01-01T00:00:00Z")||e>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const i=(this.nanos+1e9).toString().substring(1);i.substring(3)==="000000"?r="."+i.substring(0,3)+"Z":i.substring(6)==="000"?r="."+i.substring(0,6)+"Z":r="."+i+"Z"}return new Date(e).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return ee.fromDate(new Date)}static fromDate(t){const e=t.getTime();return new ee({seconds:O.parse(Math.floor(e/1e3)),nanos:e%1e3*1e6})}static fromBinary(t,e){return new ee().fromBinary(t,e)}static fromJson(t,e){return new ee().fromJson(t,e)}static fromJsonString(t,e){return new ee().fromJsonString(t,e)}static equals(t,e){return u.util.equals(ee,t,e)}}ee.runtime=u;ee.typeName="google.protobuf.Timestamp";ee.fields=u.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class wr extends T{constructor(t){super(),this.seconds=O.zero,this.nanos=0,u.util.initPartial(t,this)}fromJson(t,e){if(typeof t!="string")throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(t)}`);const r=t.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(r===null)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(t)}`);const i=Number(r[1]);if(i>315576e6||i<-315576e6)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(t)}`);if(this.seconds=O.parse(i),typeof r[2]=="string"){const s=r[2]+"0".repeat(9-r[2].length);this.nanos=parseInt(s),(i<0||Object.is(i,-0))&&(this.nanos=-this.nanos)}return this}toJson(t){if(Number(this.seconds)>315576e6||Number(this.seconds)<-315576e6)throw new Error("cannot encode google.protobuf.Duration to JSON: value out of range");let e=this.seconds.toString();if(this.nanos!==0){let r=Math.abs(this.nanos).toString();r="0".repeat(9-r.length)+r,r.substring(3)==="000000"?r=r.substring(0,3):r.substring(6)==="000"&&(r=r.substring(0,6)),e+="."+r,this.nanos<0&&Number(this.seconds)==0&&(e="-"+e)}return e+"s"}static fromBinary(t,e){return new wr().fromBinary(t,e)}static fromJson(t,e){return new wr().fromJson(t,e)}static fromJsonString(t,e){return new wr().fromJsonString(t,e)}static equals(t,e){return u.util.equals(wr,t,e)}}wr.runtime=u;wr.typeName="google.protobuf.Duration";wr.fields=u.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class Ke extends T{constructor(t){super(),this.typeUrl="",this.value=new Uint8Array(0),u.util.initPartial(t,this)}toJson(t){var e;if(this.typeUrl==="")return{};const r=this.typeUrlToName(this.typeUrl),i=(e=t==null?void 0:t.typeRegistry)===null||e===void 0?void 0:e.findMessage(r);if(!i)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let a=i.fromBinary(this.value).toJson(t);return(r.startsWith("google.protobuf.")||a===null||Array.isArray(a)||typeof a!="object")&&(a={value:a}),a["@type"]=this.typeUrl,a}fromJson(t,e){var r;if(t===null||Array.isArray(t)||typeof t!="object")throw new Error(`cannot decode message google.protobuf.Any from JSON: expected object but got ${t===null?"null":Array.isArray(t)?"array":typeof t}`);if(Object.keys(t).length==0)return this;const i=t["@type"];if(typeof i!="string"||i=="")throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const s=this.typeUrlToName(i),a=(r=e==null?void 0:e.typeRegistry)===null||r===void 0?void 0:r.findMessage(s);if(!a)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${i} is not in the type registry`);let c;if(s.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(t,"value"))c=a.fromJson(t.value,e);else{const l=Object.assign({},t);delete l["@type"],c=a.fromJson(l,e)}return this.packFrom(c),this}packFrom(t){this.value=t.toBinary(),this.typeUrl=this.typeNameToUrl(t.getType().typeName)}unpackTo(t){return this.is(t.getType())?(t.fromBinary(this.value),!0):!1}unpack(t){if(this.typeUrl==="")return;const e=t.findMessage(this.typeUrlToName(this.typeUrl));if(e)return e.fromBinary(this.value)}is(t){if(this.typeUrl==="")return!1;const e=this.typeUrlToName(this.typeUrl);let r="";return typeof t=="string"?r=t:r=t.typeName,e===r}typeNameToUrl(t){return`type.googleapis.com/${t}`}typeUrlToName(t){if(!t.length)throw new Error(`invalid type url: ${t}`);const e=t.lastIndexOf("/"),r=e>=0?t.substring(e+1):t;if(!r.length)throw new Error(`invalid type url: ${t}`);return r}static pack(t){const e=new Ke;return e.packFrom(t),e}static fromBinary(t,e){return new Ke().fromBinary(t,e)}static fromJson(t,e){return new Ke().fromJson(t,e)}static fromJsonString(t,e){return new Ke().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ke,t,e)}}Ke.runtime=u;Ke.typeName="google.protobuf.Any";Ke.fields=u.util.newFieldList(()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]);class Ve extends T{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.DOUBLE,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.DOUBLE,t)}catch(r){let i='cannot decode message google.protobuf.DoubleValue from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new Ve().fromBinary(t,e)}static fromJson(t,e){return new Ve().fromJson(t,e)}static fromJsonString(t,e){return new Ve().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ve,t,e)}}Ve.runtime=u;Ve.typeName="google.protobuf.DoubleValue";Ve.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:1}]);Ve.fieldWrapper={wrapField(n){return new Ve({value:n})},unwrapField(n){return n.value}};class je extends T{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.FLOAT,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.FLOAT,t)}catch(r){let i='cannot decode message google.protobuf.FloatValue from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new je().fromBinary(t,e)}static fromJson(t,e){return new je().fromJson(t,e)}static fromJsonString(t,e){return new je().fromJsonString(t,e)}static equals(t,e){return u.util.equals(je,t,e)}}je.runtime=u;je.typeName="google.protobuf.FloatValue";je.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:2}]);je.fieldWrapper={wrapField(n){return new je({value:n})},unwrapField(n){return n.value}};class ke extends T{constructor(t){super(),this.value=O.zero,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.INT64,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.INT64,t)}catch(r){let i='cannot decode message google.protobuf.Int64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new ke().fromBinary(t,e)}static fromJson(t,e){return new ke().fromJson(t,e)}static fromJsonString(t,e){return new ke().fromJsonString(t,e)}static equals(t,e){return u.util.equals(ke,t,e)}}ke.runtime=u;ke.typeName="google.protobuf.Int64Value";ke.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:3}]);ke.fieldWrapper={wrapField(n){return new ke({value:n})},unwrapField(n){return n.value}};class Ee extends T{constructor(t){super(),this.value=O.zero,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.UINT64,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.UINT64,t)}catch(r){let i='cannot decode message google.protobuf.UInt64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new Ee().fromBinary(t,e)}static fromJson(t,e){return new Ee().fromJson(t,e)}static fromJsonString(t,e){return new Ee().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ee,t,e)}}Ee.runtime=u;Ee.typeName="google.protobuf.UInt64Value";Ee.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:4}]);Ee.fieldWrapper={wrapField(n){return new Ee({value:n})},unwrapField(n){return n.value}};class le extends T{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.INT32,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.INT32,t)}catch(r){let i='cannot decode message google.protobuf.Int32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new le().fromBinary(t,e)}static fromJson(t,e){return new le().fromJson(t,e)}static fromJsonString(t,e){return new le().fromJsonString(t,e)}static equals(t,e){return u.util.equals(le,t,e)}}le.runtime=u;le.typeName="google.protobuf.Int32Value";le.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:5}]);le.fieldWrapper={wrapField(n){return new le({value:n})},unwrapField(n){return n.value}};class We extends T{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.UINT32,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.UINT32,t)}catch(r){let i='cannot decode message google.protobuf.UInt32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new We().fromBinary(t,e)}static fromJson(t,e){return new We().fromJson(t,e)}static fromJsonString(t,e){return new We().fromJsonString(t,e)}static equals(t,e){return u.util.equals(We,t,e)}}We.runtime=u;We.typeName="google.protobuf.UInt32Value";We.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:13}]);We.fieldWrapper={wrapField(n){return new We({value:n})},unwrapField(n){return n.value}};class Je extends T{constructor(t){super(),this.value=!1,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.BOOL,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.BOOL,t)}catch(r){let i='cannot decode message google.protobuf.BoolValue from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new Je().fromBinary(t,e)}static fromJson(t,e){return new Je().fromJson(t,e)}static fromJsonString(t,e){return new Je().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Je,t,e)}}Je.runtime=u;Je.typeName="google.protobuf.BoolValue";Je.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:8}]);Je.fieldWrapper={wrapField(n){return new Je({value:n})},unwrapField(n){return n.value}};class X extends T{constructor(t){super(),this.value="",u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.STRING,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.STRING,t)}catch(r){let i='cannot decode message google.protobuf.StringValue from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new X().fromBinary(t,e)}static fromJson(t,e){return new X().fromJson(t,e)}static fromJsonString(t,e){return new X().fromJsonString(t,e)}static equals(t,e){return u.util.equals(X,t,e)}}X.runtime=u;X.typeName="google.protobuf.StringValue";X.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9}]);X.fieldWrapper={wrapField(n){return new X({value:n})},unwrapField(n){return n.value}};class Ge extends T{constructor(t){super(),this.value=new Uint8Array(0),u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(v.BYTES,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(v.BYTES,t)}catch(r){let i='cannot decode message google.protobuf.BytesValue from JSON"';throw r instanceof Error&&r.message.length>0&&(i+=`: ${r.message}`),new Error(i)}return this}static fromBinary(t,e){return new Ge().fromBinary(t,e)}static fromJson(t,e){return new Ge().fromJson(t,e)}static fromJsonString(t,e){return new Ge().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ge,t,e)}}Ge.runtime=u;Ge.typeName="google.protobuf.BytesValue";Ge.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:12}]);Ge.fieldWrapper={wrapField(n){return new Ge({value:n})},unwrapField(n){return n.value}};function uu(n,t,e){try{const r=Ms.dec(n);return t?t.fromBinary(r,e):r}catch(r){throw $.from(r,D.DataLoss)}}function lu(n,t){const e={};for(const[r,i]of Object.entries(n.methods)){const s=t(Object.assign(Object.assign({},i),{localName:r,service:n}));s!=null&&(e[r]=s)}return e}const So=1;function bo(n){let t,e=new Uint8Array(0);function r(i){const s=new Uint8Array(e.length+i.length);s.set(e),s.set(i,e.length),e=s}return new ReadableStream({start(){t=n.getReader()},async pull(i){let s;for(;;){if(s===void 0&&e.byteLength>=5){let l=0;for(let h=1;h<5;h++)l=(l<<8)+e[h];s={flags:e[0],length:l}}if(s!==void 0&&e.byteLength>=s.length+5)break;const c=await t.read();if(c.done)break;r(c.value)}if(s===void 0){if(e.byteLength==0){i.close();return}i.error(new $("premature end of stream",D.DataLoss));return}const a=e.subarray(5,5+s.length);e=e.subarray(5+s.length),i.enqueue({flags:s.flags,data:a})}})}function Io(n,t){const e=new Uint8Array(t.length+5);e.set(t,5);const r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setUint8(0,n),r.setUint32(1,t.length),e}var hu=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(s){e[s]=n[s]&&function(a){return new Promise(function(c,l){a=n[s](a),i(c,l,a.done,a.value)})}}function i(s,a,c,l){Promise.resolve(l).then(function(h){s({value:h,done:c})},a)}},En=function(n){return this instanceof En?(this.v=n,this):new En(n)},fu=function(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),i,s=[];return i={},c("next"),c("throw"),c("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(p){return function(S){return Promise.resolve(S).then(p,m)}}function c(p,S){r[p]&&(i[p]=function(b){return new Promise(function(A,N){s.push([p,b,A,N])>1||l(p,b)})},S&&(i[p]=S(i[p])))}function l(p,S){try{h(r[p](S))}catch(b){y(s[0][3],b)}}function h(p){p.value instanceof En?Promise.resolve(p.value.v).then(f,m):y(s[0][2],p)}function f(p){l("next",p)}function m(p){l("throw",p)}function y(p,S){p(S),s.shift(),s.length&&l(s[0][0],s[0][1])}},du=function(n){var t,e;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,s){t[i]=n[i]?function(a){return(e=!e)?{value:En(n[i](a)),done:!1}:s?s(a):a}:s}};function gu(n){return fu(this,arguments,function*(){yield En(yield*du(hu(n)))})}var ba=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(s){e[s]=n[s]&&function(a){return new Promise(function(c,l){a=n[s](a),i(c,l,a.done,a.value)})}}function i(s,a,c,l){Promise.resolve(l).then(function(h){s({value:h,done:c})},a)}},nn=function(n){return this instanceof nn?(this.v=n,this):new nn(n)},mu=function(n){var t,e;return t={},r("next"),r("throw",function(i){throw i}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(i,s){t[i]=n[i]?function(a){return(e=!e)?{value:nn(n[i](a)),done:!1}:s?s(a):a}:s}},pu=function(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),i,s=[];return i={},c("next"),c("throw"),c("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(p){return function(S){return Promise.resolve(S).then(p,m)}}function c(p,S){r[p]&&(i[p]=function(b){return new Promise(function(A,N){s.push([p,b,A,N])>1||l(p,b)})},S&&(i[p]=S(i[p])))}function l(p,S){try{h(r[p](S))}catch(b){y(s[0][3],b)}}function h(p){p.value instanceof nn?Promise.resolve(p.value.v).then(f,m):y(s[0][2],p)}function f(p){l("next",p)}function m(p){l("throw",p)}function y(p,S){p(S),s.shift(),s.length&&l(s[0][0],s[0][1])}};function yu(n,t){return lu(n,e=>{switch(e.kind){case Q.Unary:return vu(t,n,e);case Q.ServerStreaming:return wu(t,n,e);case Q.ClientStreaming:return Tu(t,n,e);case Q.BiDiStreaming:return Su(t,n,e);default:return null}})}function vu(n,t,e){return async function(r,i){var s,a;const c=await n.unary(t,e,i==null?void 0:i.signal,i==null?void 0:i.timeoutMs,i==null?void 0:i.headers,r,i==null?void 0:i.contextValues);return(s=i==null?void 0:i.onHeader)===null||s===void 0||s.call(i,c.header),(a=i==null?void 0:i.onTrailer)===null||a===void 0||a.call(i,c.trailer),c.message}}function wu(n,t,e){return function(r,i){return Ia(n.stream(t,e,i==null?void 0:i.signal,i==null?void 0:i.timeoutMs,i==null?void 0:i.headers,gu([r]),i==null?void 0:i.contextValues),i)}}function Tu(n,t,e){return async function(r,i){var s,a,c,l,h,f;const m=await n.stream(t,e,i==null?void 0:i.signal,i==null?void 0:i.timeoutMs,i==null?void 0:i.headers,r,i==null?void 0:i.contextValues);(h=i==null?void 0:i.onHeader)===null||h===void 0||h.call(i,m.header);let y,p=0;try{for(var S=!0,b=ba(m.message),A;A=await b.next(),s=A.done,!s;S=!0)l=A.value,S=!1,y=l,p++}catch(N){a={error:N}}finally{try{!S&&!s&&(c=b.return)&&await c.call(b)}finally{if(a)throw a.error}}if(!y)throw new $("protocol error: missing response message",D.Unimplemented);if(p>1)throw new $("protocol error: received extra messages for client streaming method",D.Unimplemented);return(f=i==null?void 0:i.onTrailer)===null||f===void 0||f.call(i,m.trailer),y}}function Su(n,t,e){return function(r,i){return Ia(n.stream(t,e,i==null?void 0:i.signal,i==null?void 0:i.timeoutMs,i==null?void 0:i.headers,r,i==null?void 0:i.contextValues),i)}}function Ia(n,t){const e=function(){return pu(this,arguments,function*(){var r,i;const s=yield nn(n);(r=t==null?void 0:t.onHeader)===null||r===void 0||r.call(t,s.header),yield nn(yield*mu(ba(s.message))),(i=t==null?void 0:t.onTrailer)===null||i===void 0||i.call(t,s.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>e.next()})}}function bu(...n){const t=new AbortController,e=n.filter(i=>i!==void 0).concat(t.signal);for(const i of e){if(i.aborted){r.apply(i);break}i.addEventListener("abort",r)}function r(){t.signal.aborted||t.abort(Aa(this));for(const i of e)i.removeEventListener("abort",r)}return t}function Iu(n){const t=new AbortController,e=()=>{t.abort(new $("the operation timed out",D.DeadlineExceeded))};let r;return n!==void 0&&(n<=0?e():r=setTimeout(e,n)),{signal:t.signal,cleanup:()=>clearTimeout(r)}}function Aa(n){if(!n.aborted)return;if(n.reason!==void 0)return n.reason;const t=new Error("This operation was aborted");return t.name="AbortError",t}function Ao(){return{get(n){return n.id in this?this[n.id]:n.defaultValue},set(n,t){return this[n.id]=t,this},delete(n){return delete this[n.id],this}}}const ji=128;function ko(n){const t=new Headers,e=new TextDecoder().decode(n).split(`\r
`);for(const r of e){if(r==="")continue;const i=r.indexOf(":");if(i>0){const s=r.substring(0,i).trim(),a=r.substring(i+1).trim();t.append(s,a)}}return t}const Au="Content-Type",ku="Grpc-Timeout",sn="Grpc-Status",ka="Grpc-Message",Eu="Grpc-Status-Details-Bin",xu="X-User-Agent",Nu="X-Grpc-Web",Pu="application/grpc-web+proto",Cu="application/grpc-web+json";class Tr extends T{constructor(t){super(),this.code=0,this.message="",this.details=[],u.util.initPartial(t,this)}static fromBinary(t,e){return new Tr().fromBinary(t,e)}static fromJson(t,e){return new Tr().fromJson(t,e)}static fromJsonString(t,e){return new Tr().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Tr,t,e)}}Tr.runtime=u;Tr.typeName="google.rpc.Status";Tr.fields=u.util.newFieldList(()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:Ke,repeated:!0}]);const Du="0";function Ea(n){var t;const e=n.get(Eu);if(e!=null){const i=uu(e,Tr);if(i.code==0)return;const s=new $(i.message,i.code,n);return s.details=i.details.map(a=>({type:a.typeUrl.substring(a.typeUrl.lastIndexOf("/")+1),value:a.value})),s}const r=n.get(sn);if(r!=null){if(r===Du)return;const i=parseInt(r,10);return i in D?new $(decodeURIComponent((t=n.get(ka))!==null&&t!==void 0?t:""),i,n):new $(`invalid grpc-status: ${r}`,D.Internal,n)}}function Eo(n,t,e){const r=typeof t=="string"?t:t.typeName,i=typeof e=="string"?e:e.name;return n.toString().replace(/\/?$/,`/${r}/${i}`)}function xa(n,t){return t instanceof n?t:new n(t)}function Bu(n,t){function e(r){return r.done===!0?r:{done:r.done,value:xa(n,r.value)}}return{[Symbol.asyncIterator](){const r=t[Symbol.asyncIterator](),i={next:()=>r.next().then(e)};return r.throw!==void 0&&(i.throw=s=>r.throw(s).then(e)),r.return!==void 0&&(i.return=s=>r.return(s).then(e)),i}}}function Na(n,t){var e;return(e=t==null?void 0:t.concat().reverse().reduce((r,i)=>i(r),n))!==null&&e!==void 0?e:n}function Ou(n){var t;const e=Object.assign({},n);return(t=e.ignoreUnknownFields)!==null&&t!==void 0||(e.ignoreUnknownFields=!0),e}function xo(n,t,e,r){const i=t?No(n.I,r):Po(n.I,e);return{parse:(t?No(n.O,r):Po(n.O,e)).parse,serialize:i.serialize}}function No(n,t){return{parse(e){try{return n.fromBinary(e,t)}catch(r){const i=r instanceof Error?r.message:String(r);throw new $(`parse binary: ${i}`,D.Internal)}},serialize(e){try{return e.toBinary(t)}catch(r){const i=r instanceof Error?r.message:String(r);throw new $(`serialize binary: ${i}`,D.Internal)}}}}function Po(n,t){var e,r;const i=(e=t==null?void 0:t.textEncoder)!==null&&e!==void 0?e:new TextEncoder,s=(r=t==null?void 0:t.textDecoder)!==null&&r!==void 0?r:new TextDecoder,a=Ou(t);return{parse(c){try{const l=s.decode(c);return n.fromJsonString(l,a)}catch(l){throw $.from(l,D.InvalidArgument)}},serialize(c){try{const l=c.toJsonString(a);return i.encode(l)}catch(l){throw $.from(l,D.Internal)}}}}function Lu(n){const t=Na(n.next,n.interceptors),[e,r,i]=Pa(n),s=Object.assign(Object.assign({},n.req),{message:xa(n.req.method.I,n.req.message),signal:e});return t(s).then(a=>(i(),a),r)}function Ju(n){const t=Na(n.next,n.interceptors),[e,r,i]=Pa(n),s=Object.assign(Object.assign({},n.req),{message:Bu(n.req.method.I,n.req.message),signal:e});let a=!1;return e.addEventListener("abort",function(){var c,l;const h=n.req.message[Symbol.asyncIterator]();a||(c=h.throw)===null||c===void 0||c.call(h,this.reason).catch(()=>{}),(l=h.return)===null||l===void 0||l.call(h).catch(()=>{})}),t(s).then(c=>Object.assign(Object.assign({},c),{message:{[Symbol.asyncIterator](){const l=c.message[Symbol.asyncIterator]();return{next(){return l.next().then(h=>(h.done==!0&&(a=!0,i()),h),r)}}}}}),r)}function Pa(n){const{signal:t,cleanup:e}=Iu(n.timeoutMs),r=bu(n.signal,t);return[r.signal,function(s){const a=$.from(t.aborted?Aa(t):s);return r.abort(a),e(),Promise.reject(a)},function(){e(),r.abort()}]}function Ru(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function Co(n,t){const e=Ea(n);if(e)throw t.forEach((r,i)=>{e.metadata.append(i,r)}),e;if(!t.has(sn)&&!n.has(sn))throw new $("protocol error: missing status",D.Internal)}function Do(n,t,e,r){const i=new Headers(e??{});return i.set(Au,n?Pu:Cu),i.set(Nu,"1"),i.set(xu,"connect-es/1.6.1"),t!==void 0&&i.set(ku,`${t}m`),i}function $u(n){switch(n){case 400:return D.Internal;case 401:return D.Unauthenticated;case 403:return D.PermissionDenied;case 404:return D.Unimplemented;case 429:return D.Unavailable;case 502:return D.Unavailable;case 503:return D.Unavailable;case 504:return D.Unavailable;default:return D.Unknown}}function Bo(n,t){var e;if(n>=200&&n<300)return{foundStatus:t.has(sn),headerError:Ea(t)};throw new $(decodeURIComponent((e=t.get(ka))!==null&&e!==void 0?e:`HTTP ${n}`),$u(n),t)}var Fr=function(n){return this instanceof Fr?(this.v=n,this):new Fr(n)},Mu=function(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),i,s=[];return i={},c("next"),c("throw"),c("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(p){return function(S){return Promise.resolve(S).then(p,m)}}function c(p,S){r[p]&&(i[p]=function(b){return new Promise(function(A,N){s.push([p,b,A,N])>1||l(p,b)})},S&&(i[p]=S(i[p])))}function l(p,S){try{h(r[p](S))}catch(b){y(s[0][3],b)}}function h(p){p.value instanceof Fr?Promise.resolve(p.value.v).then(f,m):y(s[0][2],p)}function f(p){l("next",p)}function m(p){l("throw",p)}function y(p,S){p(S),s.shift(),s.length&&l(s[0][0],s[0][1])}};function Fu(n){var t;Ru();const e=(t=n.useBinaryFormat)!==null&&t!==void 0?t:!0;return{async unary(r,i,s,a,c,l,h){var f;const{serialize:m,parse:y}=xo(i,e,n.jsonOptions,n.binaryOptions);return a=a===void 0?n.defaultTimeoutMs:a<=0?void 0:a,await Lu({interceptors:n.interceptors,signal:s,timeoutMs:a,req:{stream:!1,service:r,method:i,url:Eo(n.baseUrl,r,i),init:{method:"POST",credentials:(f=n.credentials)!==null&&f!==void 0?f:"same-origin",redirect:"error",mode:"cors"},header:Do(e,a,c),contextValues:h??Ao(),message:l},next:async p=>{var S;const A=await((S=n.fetch)!==null&&S!==void 0?S:globalThis.fetch)(p.url,Object.assign(Object.assign({},p.init),{headers:p.header,signal:p.signal,body:Io(0,m(p.message))})),{headerError:N}=Bo(A.status,A.headers);if(!A.body)throw N!==void 0?N:"missing response body";const L=bo(A.body).getReader();let F,z;for(;;){const Y=await L.read();if(Y.done)break;const{flags:C,data:U}=Y.value;if((C&So)===So)throw new $("protocol error: received unsupported compressed output",D.Internal);if(C===ji){if(F!==void 0)throw"extra trailer";F=ko(U);continue}if(z!==void 0)throw new $("extra message",D.Unimplemented);z=y(U)}if(F===void 0)throw N!==void 0?N:new $("missing trailer",A.headers.has(sn)?D.Unimplemented:D.Unknown);if(Co(F,A.headers),z===void 0)throw new $("missing message",F.has(sn)?D.Unimplemented:D.Unknown);return{stream:!1,service:r,method:i,header:A.headers,message:z,trailer:F}}})},async stream(r,i,s,a,c,l,h){var f;const{serialize:m,parse:y}=xo(i,e,n.jsonOptions,n.binaryOptions);function p(b,A,N,L,F){return Mu(this,arguments,function*(){const Y=bo(b).getReader();if(A){if(!(yield Fr(Y.read())).done)throw"extra data for trailers-only";return yield Fr(void 0)}let C=!1;for(;;){const U=yield Fr(Y.read());if(U.done)break;const{flags:Z,data:V}=U.value;if((Z&ji)===ji){if(C)throw"extra trailer";C=!0;const ge=ko(V);Co(ge,L),ge.forEach((Fn,zn)=>N.set(zn,Fn));continue}if(C)throw"extra message";yield yield Fr(y(V))}if("throwIfAborted"in F&&F.throwIfAborted(),!C)throw"missing trailer"})}async function S(b){if(i.kind!=Q.ServerStreaming)throw"The fetch API does not support streaming request bodies";const A=await b[Symbol.asyncIterator]().next();if(A.done==!0)throw"missing request message";return Io(0,m(A.value))}return a=a===void 0?n.defaultTimeoutMs:a<=0?void 0:a,Ju({interceptors:n.interceptors,signal:s,timeoutMs:a,req:{stream:!0,service:r,method:i,url:Eo(n.baseUrl,r,i),init:{method:"POST",credentials:(f=n.credentials)!==null&&f!==void 0?f:"same-origin",redirect:"error",mode:"cors"},header:Do(e,a,c),contextValues:h??Ao(),message:l},next:async b=>{var A;const L=await((A=n.fetch)!==null&&A!==void 0?A:globalThis.fetch)(b.url,Object.assign(Object.assign({},b.init),{headers:b.header,signal:b.signal,body:await S(b.message)})),{foundStatus:F,headerError:z}=Bo(L.status,L.headers);if(z!=null)throw z;if(!L.body)throw"missing response body";const Y=new Headers;return Object.assign(Object.assign({},b),{header:L.headers,trailer:Y,message:p(L.body,F,Y,L.headers,b.signal)})}})}}}var P=(n=>(n[n.NULL=0]="NULL",n[n.BOOLEAN=1]="BOOLEAN",n[n.INTEGER=2]="INTEGER",n[n.LONG=3]="LONG",n[n.DOUBLE=4]="DOUBLE",n[n.STRING=5]="STRING",n[n.BYTES=6]="BYTES",n[n.DATE=7]="DATE",n[n.JSON_OBJECT=8]="JSON_OBJECT",n[n.JSON_ARRAY=9]="JSON_ARRAY",n[n.TEXT=10]="TEXT",n[n.INTEGER_CNT=11]="INTEGER_CNT",n[n.LONG_CNT=12]="LONG_CNT",n[n.TREE=13]="TREE",n))(P||{});u.util.setEnumType(P,"yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER"},{no:3,name:"VALUE_TYPE_LONG"},{no:4,name:"VALUE_TYPE_DOUBLE"},{no:5,name:"VALUE_TYPE_STRING"},{no:6,name:"VALUE_TYPE_BYTES"},{no:7,name:"VALUE_TYPE_DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE"}]);var qr=(n=>(n[n.DOCUMENT_CHANGED=0]="DOCUMENT_CHANGED",n[n.DOCUMENT_WATCHED=1]="DOCUMENT_WATCHED",n[n.DOCUMENT_UNWATCHED=2]="DOCUMENT_UNWATCHED",n[n.DOCUMENT_BROADCAST=3]="DOCUMENT_BROADCAST",n))(qr||{});u.util.setEnumType(qr,"yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST"}]);const tt=class tt extends T{constructor(e){super();o(this,"root");o(this,"presences",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new tt().fromBinary(e,r)}static fromJson(e,r){return new tt().fromJson(e,r)}static fromJsonString(e,r){return new tt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(tt,e,r)}};o(tt,"runtime",u),o(tt,"typeName","yorkie.v1.Snapshot"),o(tt,"fields",u.util.newFieldList(()=>[{no:1,name:"root",kind:"message",T:ue},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:$i}}]));let Xi=tt;var pe;let Er=(pe=class extends T{constructor(e){super();o(this,"documentKey","");o(this,"checkpoint");o(this,"snapshot",new Uint8Array(0));o(this,"changes",[]);o(this,"minSyncedTicket");o(this,"isRemoved",!1);o(this,"versionVector");u.util.initPartial(e,this)}static fromBinary(e,r){return new pe().fromBinary(e,r)}static fromJson(e,r){return new pe().fromJson(e,r)}static fromJsonString(e,r){return new pe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(pe,e,r)}},o(pe,"runtime",u),o(pe,"typeName","yorkie.v1.ChangePack"),o(pe,"fields",u.util.newFieldList(()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:Ba},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:Ca,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:k},{no:6,name:"is_removed",kind:"scalar",T:8},{no:7,name:"version_vector",kind:"message",T:Ri}])),pe);var ye;let Ca=(ye=class extends T{constructor(e){super();o(this,"id");o(this,"message","");o(this,"operations",[]);o(this,"presenceChange");u.util.initPartial(e,this)}static fromBinary(e,r){return new ye().fromBinary(e,r)}static fromJson(e,r){return new ye().fromJson(e,r)}static fromJsonString(e,r){return new ye().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ye,e,r)}},o(ye,"runtime",u),o(ye,"typeName","yorkie.v1.Change"),o(ye,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:Ji},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:Fs,repeated:!0},{no:4,name:"presence_change",kind:"message",T:Pn}])),ye);var ve;let Ji=(ve=class extends T{constructor(e){super();o(this,"clientSeq",0);o(this,"serverSeq",O.zero);o(this,"lamport",O.zero);o(this,"actorId",new Uint8Array(0));o(this,"versionVector");u.util.initPartial(e,this)}static fromBinary(e,r){return new ve().fromBinary(e,r)}static fromJson(e,r){return new ve().fromJson(e,r)}static fromJsonString(e,r){return new ve().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ve,e,r)}},o(ve,"runtime",u),o(ve,"typeName","yorkie.v1.ChangeID"),o(ve,"fields",u.util.newFieldList(()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3},{no:3,name:"lamport",kind:"scalar",T:3},{no:4,name:"actor_id",kind:"scalar",T:12},{no:5,name:"version_vector",kind:"message",T:Ri}])),ve);var we;let Ri=(we=class extends T{constructor(e){super();o(this,"vector",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new we().fromBinary(e,r)}static fromJson(e,r){return new we().fromJson(e,r)}static fromJsonString(e,r){return new we().fromJsonString(e,r)}static equals(e,r){return u.util.equals(we,e,r)}},o(we,"runtime",u),o(we,"typeName","yorkie.v1.VersionVector"),o(we,"fields",u.util.newFieldList(()=>[{no:1,name:"vector",kind:"map",K:9,V:{kind:"scalar",T:3}}])),we);var Te;let Fs=(Te=class extends T{constructor(e){super();o(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new Te().fromBinary(e,r)}static fromJson(e,r){return new Te().fromJson(e,r)}static fromJsonString(e,r){return new Te().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Te,e,r)}},o(Te,"runtime",u),o(Te,"typeName","yorkie.v1.Operation"),o(Te,"fields",u.util.newFieldList(()=>[{no:1,name:"set",kind:"message",T:ai,oneof:"body"},{no:2,name:"add",kind:"message",T:ci,oneof:"body"},{no:3,name:"move",kind:"message",T:ui,oneof:"body"},{no:4,name:"remove",kind:"message",T:li,oneof:"body"},{no:5,name:"edit",kind:"message",T:hi,oneof:"body"},{no:7,name:"style",kind:"message",T:fi,oneof:"body"},{no:8,name:"increase",kind:"message",T:di,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:gi,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:mi,oneof:"body"},{no:11,name:"array_set",kind:"message",T:pi,oneof:"body"}])),Te);const rt=class rt extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"key","");o(this,"value");o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new rt().fromBinary(e,r)}static fromJson(e,r){return new rt().fromJson(e,r)}static fromJsonString(e,r){return new rt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(rt,e,r)}};o(rt,"runtime",u),o(rt,"typeName","yorkie.v1.Operation.Set"),o(rt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:me},{no:4,name:"executed_at",kind:"message",T:k}]));let ai=rt;const nt=class nt extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"prevCreatedAt");o(this,"value");o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new nt().fromBinary(e,r)}static fromJson(e,r){return new nt().fromJson(e,r)}static fromJsonString(e,r){return new nt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(nt,e,r)}};o(nt,"runtime",u),o(nt,"typeName","yorkie.v1.Operation.Add"),o(nt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"prev_created_at",kind:"message",T:k},{no:3,name:"value",kind:"message",T:me},{no:4,name:"executed_at",kind:"message",T:k}]));let ci=nt;const it=class it extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"prevCreatedAt");o(this,"createdAt");o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new it().fromBinary(e,r)}static fromJson(e,r){return new it().fromJson(e,r)}static fromJsonString(e,r){return new it().fromJsonString(e,r)}static equals(e,r){return u.util.equals(it,e,r)}};o(it,"runtime",u),o(it,"typeName","yorkie.v1.Operation.Move"),o(it,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"prev_created_at",kind:"message",T:k},{no:3,name:"created_at",kind:"message",T:k},{no:4,name:"executed_at",kind:"message",T:k}]));let ui=it;const st=class st extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"createdAt");o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new st().fromBinary(e,r)}static fromJson(e,r){return new st().fromJson(e,r)}static fromJsonString(e,r){return new st().fromJsonString(e,r)}static equals(e,r){return u.util.equals(st,e,r)}};o(st,"runtime",u),o(st,"typeName","yorkie.v1.Operation.Remove"),o(st,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"created_at",kind:"message",T:k},{no:3,name:"executed_at",kind:"message",T:k}]));let li=st;const ot=class ot extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"from");o(this,"to");o(this,"createdAtMapByActor",{});o(this,"content","");o(this,"executedAt");o(this,"attributes",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new ot().fromBinary(e,r)}static fromJson(e,r){return new ot().fromJson(e,r)}static fromJsonString(e,r){return new ot().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ot,e,r)}};o(ot,"runtime",u),o(ot,"typeName","yorkie.v1.Operation.Edit"),o(ot,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"from",kind:"message",T:Vr},{no:3,name:"to",kind:"message",T:Vr},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:k}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:k},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]));let hi=ot;const at=class at extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"from");o(this,"to");o(this,"attributes",{});o(this,"executedAt");o(this,"createdAtMapByActor",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new at().fromBinary(e,r)}static fromJson(e,r){return new at().fromJson(e,r)}static fromJsonString(e,r){return new at().fromJsonString(e,r)}static equals(e,r){return u.util.equals(at,e,r)}};o(at,"runtime",u),o(at,"typeName","yorkie.v1.Operation.Style"),o(at,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"from",kind:"message",T:Vr},{no:3,name:"to",kind:"message",T:Vr},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:k},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:k}}]));let fi=at;const ct=class ct extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"value");o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ct().fromBinary(e,r)}static fromJson(e,r){return new ct().fromJson(e,r)}static fromJsonString(e,r){return new ct().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ct,e,r)}};o(ct,"runtime",u),o(ct,"typeName","yorkie.v1.Operation.Increase"),o(ct,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"value",kind:"message",T:me},{no:3,name:"executed_at",kind:"message",T:k}]));let di=ct;const ut=class ut extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"from");o(this,"to");o(this,"createdAtMapByActor",{});o(this,"contents",[]);o(this,"splitLevel",0);o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ut().fromBinary(e,r)}static fromJson(e,r){return new ut().fromJson(e,r)}static fromJsonString(e,r){return new ut().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ut,e,r)}};o(ut,"runtime",u),o(ut,"typeName","yorkie.v1.Operation.TreeEdit"),o(ut,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"from",kind:"message",T:Ur},{no:3,name:"to",kind:"message",T:Ur},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:k}},{no:5,name:"contents",kind:"message",T:ki,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:k}]));let gi=ut;const lt=class lt extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"from");o(this,"to");o(this,"attributes",{});o(this,"executedAt");o(this,"attributesToRemove",[]);o(this,"createdAtMapByActor",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new lt().fromBinary(e,r)}static fromJson(e,r){return new lt().fromJson(e,r)}static fromJsonString(e,r){return new lt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(lt,e,r)}};o(lt,"runtime",u),o(lt,"typeName","yorkie.v1.Operation.TreeStyle"),o(lt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"from",kind:"message",T:Ur},{no:3,name:"to",kind:"message",T:Ur},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:k},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:k}}]));let mi=lt;const ht=class ht extends T{constructor(e){super();o(this,"parentCreatedAt");o(this,"createdAt");o(this,"value");o(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ht().fromBinary(e,r)}static fromJson(e,r){return new ht().fromJson(e,r)}static fromJsonString(e,r){return new ht().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ht,e,r)}};o(ht,"runtime",u),o(ht,"typeName","yorkie.v1.Operation.ArraySet"),o(ht,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:k},{no:2,name:"created_at",kind:"message",T:k},{no:3,name:"value",kind:"message",T:me},{no:4,name:"executed_at",kind:"message",T:k}]));let pi=ht;const ft=class ft extends T{constructor(e){super();o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");o(this,"type",0);o(this,"value",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new ft().fromBinary(e,r)}static fromJson(e,r){return new ft().fromJson(e,r)}static fromJsonString(e,r){return new ft().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ft,e,r)}};o(ft,"runtime",u),o(ft,"typeName","yorkie.v1.JSONElementSimple"),o(ft,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:k},{no:2,name:"moved_at",kind:"message",T:k},{no:3,name:"removed_at",kind:"message",T:k},{no:4,name:"type",kind:"enum",T:u.getEnumType(P)},{no:5,name:"value",kind:"scalar",T:12}]));let me=ft;const dt=class dt extends T{constructor(e){super();o(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new dt().fromBinary(e,r)}static fromJson(e,r){return new dt().fromJson(e,r)}static fromJsonString(e,r){return new dt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(dt,e,r)}};o(dt,"runtime",u),o(dt,"typeName","yorkie.v1.JSONElement"),o(dt,"fields",u.util.newFieldList(()=>[{no:1,name:"json_object",kind:"message",T:yi,oneof:"body"},{no:2,name:"json_array",kind:"message",T:vi,oneof:"body"},{no:3,name:"primitive",kind:"message",T:wi,oneof:"body"},{no:5,name:"text",kind:"message",T:Ti,oneof:"body"},{no:6,name:"counter",kind:"message",T:Si,oneof:"body"},{no:7,name:"tree",kind:"message",T:bi,oneof:"body"}]));let ue=dt;const gt=class gt extends T{constructor(e){super();o(this,"nodes",[]);o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new gt().fromBinary(e,r)}static fromJson(e,r){return new gt().fromJson(e,r)}static fromJsonString(e,r){return new gt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(gt,e,r)}};o(gt,"runtime",u),o(gt,"typeName","yorkie.v1.JSONElement.JSONObject"),o(gt,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Da,repeated:!0},{no:2,name:"created_at",kind:"message",T:k},{no:3,name:"moved_at",kind:"message",T:k},{no:4,name:"removed_at",kind:"message",T:k}]));let yi=gt;const mt=class mt extends T{constructor(e){super();o(this,"nodes",[]);o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new mt().fromBinary(e,r)}static fromJson(e,r){return new mt().fromJson(e,r)}static fromJsonString(e,r){return new mt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(mt,e,r)}};o(mt,"runtime",u),o(mt,"typeName","yorkie.v1.JSONElement.JSONArray"),o(mt,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Ii,repeated:!0},{no:2,name:"created_at",kind:"message",T:k},{no:3,name:"moved_at",kind:"message",T:k},{no:4,name:"removed_at",kind:"message",T:k}]));let vi=mt;const pt=class pt extends T{constructor(e){super();o(this,"type",0);o(this,"value",new Uint8Array(0));o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new pt().fromBinary(e,r)}static fromJson(e,r){return new pt().fromJson(e,r)}static fromJsonString(e,r){return new pt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(pt,e,r)}};o(pt,"runtime",u),o(pt,"typeName","yorkie.v1.JSONElement.Primitive"),o(pt,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(P)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:k},{no:4,name:"moved_at",kind:"message",T:k},{no:5,name:"removed_at",kind:"message",T:k}]));let wi=pt;const yt=class yt extends T{constructor(e){super();o(this,"nodes",[]);o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new yt().fromBinary(e,r)}static fromJson(e,r){return new yt().fromJson(e,r)}static fromJsonString(e,r){return new yt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(yt,e,r)}};o(yt,"runtime",u),o(yt,"typeName","yorkie.v1.JSONElement.Text"),o(yt,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Ai,repeated:!0},{no:2,name:"created_at",kind:"message",T:k},{no:3,name:"moved_at",kind:"message",T:k},{no:4,name:"removed_at",kind:"message",T:k}]));let Ti=yt;const vt=class vt extends T{constructor(e){super();o(this,"type",0);o(this,"value",new Uint8Array(0));o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new vt().fromBinary(e,r)}static fromJson(e,r){return new vt().fromJson(e,r)}static fromJsonString(e,r){return new vt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(vt,e,r)}};o(vt,"runtime",u),o(vt,"typeName","yorkie.v1.JSONElement.Counter"),o(vt,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(P)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:k},{no:4,name:"moved_at",kind:"message",T:k},{no:5,name:"removed_at",kind:"message",T:k}]));let Si=vt;const wt=class wt extends T{constructor(e){super();o(this,"nodes",[]);o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new wt().fromBinary(e,r)}static fromJson(e,r){return new wt().fromJson(e,r)}static fromJsonString(e,r){return new wt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(wt,e,r)}};o(wt,"runtime",u),o(wt,"typeName","yorkie.v1.JSONElement.Tree"),o(wt,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Nn,repeated:!0},{no:2,name:"created_at",kind:"message",T:k},{no:3,name:"moved_at",kind:"message",T:k},{no:4,name:"removed_at",kind:"message",T:k}]));let bi=wt;var Se;let Da=(Se=class extends T{constructor(e){super();o(this,"key","");o(this,"element");u.util.initPartial(e,this)}static fromBinary(e,r){return new Se().fromBinary(e,r)}static fromJson(e,r){return new Se().fromJson(e,r)}static fromJsonString(e,r){return new Se().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Se,e,r)}},o(Se,"runtime",u),o(Se,"typeName","yorkie.v1.RHTNode"),o(Se,"fields",u.util.newFieldList(()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:ue}])),Se);const qe=class qe extends T{constructor(e){super();o(this,"next");o(this,"element");u.util.initPartial(e,this)}static fromBinary(e,r){return new qe().fromBinary(e,r)}static fromJson(e,r){return new qe().fromJson(e,r)}static fromJsonString(e,r){return new qe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(qe,e,r)}};o(qe,"runtime",u),o(qe,"typeName","yorkie.v1.RGANode"),o(qe,"fields",u.util.newFieldList(()=>[{no:1,name:"next",kind:"message",T:qe},{no:2,name:"element",kind:"message",T:ue}]));let Ii=qe;const Tt=class Tt extends T{constructor(e){super();o(this,"value","");o(this,"updatedAt");o(this,"isRemoved",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new Tt().fromBinary(e,r)}static fromJson(e,r){return new Tt().fromJson(e,r)}static fromJsonString(e,r){return new Tt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Tt,e,r)}};o(Tt,"runtime",u),o(Tt,"typeName","yorkie.v1.NodeAttr"),o(Tt,"fields",u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:k},{no:3,name:"is_removed",kind:"scalar",T:8}]));let on=Tt;const St=class St extends T{constructor(e){super();o(this,"id");o(this,"value","");o(this,"removedAt");o(this,"insPrevId");o(this,"attributes",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new St().fromBinary(e,r)}static fromJson(e,r){return new St().fromJson(e,r)}static fromJsonString(e,r){return new St().fromJsonString(e,r)}static equals(e,r){return u.util.equals(St,e,r)}};o(St,"runtime",u),o(St,"typeName","yorkie.v1.TextNode"),o(St,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:xn},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:k},{no:4,name:"ins_prev_id",kind:"message",T:xn},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:on}}]));let Ai=St;const bt=class bt extends T{constructor(e){super();o(this,"createdAt");o(this,"offset",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new bt().fromBinary(e,r)}static fromJson(e,r){return new bt().fromJson(e,r)}static fromJsonString(e,r){return new bt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(bt,e,r)}};o(bt,"runtime",u),o(bt,"typeName","yorkie.v1.TextNodeID"),o(bt,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:k},{no:2,name:"offset",kind:"scalar",T:5}]));let xn=bt;const It=class It extends T{constructor(e){super();o(this,"id");o(this,"type","");o(this,"value","");o(this,"removedAt");o(this,"insPrevId");o(this,"insNextId");o(this,"depth",0);o(this,"attributes",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new It().fromBinary(e,r)}static fromJson(e,r){return new It().fromJson(e,r)}static fromJsonString(e,r){return new It().fromJsonString(e,r)}static equals(e,r){return u.util.equals(It,e,r)}};o(It,"runtime",u),o(It,"typeName","yorkie.v1.TreeNode"),o(It,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:Cr},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:k},{no:5,name:"ins_prev_id",kind:"message",T:Cr},{no:6,name:"ins_next_id",kind:"message",T:Cr},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:on}}]));let Nn=It;const At=class At extends T{constructor(e){super();o(this,"content",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new At().fromBinary(e,r)}static fromJson(e,r){return new At().fromJson(e,r)}static fromJsonString(e,r){return new At().fromJsonString(e,r)}static equals(e,r){return u.util.equals(At,e,r)}};o(At,"runtime",u),o(At,"typeName","yorkie.v1.TreeNodes"),o(At,"fields",u.util.newFieldList(()=>[{no:1,name:"content",kind:"message",T:Nn,repeated:!0}]));let ki=At;const kt=class kt extends T{constructor(e){super();o(this,"createdAt");o(this,"offset",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new kt().fromBinary(e,r)}static fromJson(e,r){return new kt().fromJson(e,r)}static fromJsonString(e,r){return new kt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(kt,e,r)}};o(kt,"runtime",u),o(kt,"typeName","yorkie.v1.TreeNodeID"),o(kt,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:k},{no:2,name:"offset",kind:"scalar",T:5}]));let Cr=kt;const Et=class Et extends T{constructor(e){super();o(this,"parentId");o(this,"leftSiblingId");u.util.initPartial(e,this)}static fromBinary(e,r){return new Et().fromBinary(e,r)}static fromJson(e,r){return new Et().fromJson(e,r)}static fromJsonString(e,r){return new Et().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Et,e,r)}};o(Et,"runtime",u),o(Et,"typeName","yorkie.v1.TreePos"),o(Et,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_id",kind:"message",T:Cr},{no:2,name:"left_sibling_id",kind:"message",T:Cr}]));let Ur=Et;const xt=class xt extends T{constructor(e){super();o(this,"id","");o(this,"authProvider","");o(this,"username","");o(this,"createdAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new xt().fromBinary(e,r)}static fromJson(e,r){return new xt().fromJson(e,r)}static fromJsonString(e,r){return new xt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(xt,e,r)}};o(xt,"runtime",u),o(xt,"typeName","yorkie.v1.User"),o(xt,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"auth_provider",kind:"scalar",T:9},{no:3,name:"username",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:ee}]));let Oo=xt;const Nt=class Nt extends T{constructor(e){super();o(this,"id","");o(this,"name","");o(this,"publicKey","");o(this,"secretKey","");o(this,"authWebhookUrl","");o(this,"authWebhookMethods",[]);o(this,"authWebhookMaxRetries",O.zero);o(this,"authWebhookMinWaitInterval","");o(this,"authWebhookMaxWaitInterval","");o(this,"authWebhookRequestTimeout","");o(this,"eventWebhookUrl","");o(this,"eventWebhookEvents",[]);o(this,"eventWebhookMaxRetries",O.zero);o(this,"eventWebhookMinWaitInterval","");o(this,"eventWebhookMaxWaitInterval","");o(this,"eventWebhookRequestTimeout","");o(this,"clientDeactivateThreshold","");o(this,"snapshotThreshold",O.zero);o(this,"snapshotInterval",O.zero);o(this,"maxSubscribersPerDocument",0);o(this,"maxAttachmentsPerDocument",0);o(this,"maxSizePerDocument",0);o(this,"removeOnDetach",!1);o(this,"allowedOrigins",[]);o(this,"createdAt");o(this,"updatedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Nt().fromBinary(e,r)}static fromJson(e,r){return new Nt().fromJson(e,r)}static fromJsonString(e,r){return new Nt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Nt,e,r)}};o(Nt,"runtime",u),o(Nt,"typeName","yorkie.v1.Project"),o(Nt,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:17,name:"auth_webhook_max_retries",kind:"scalar",T:4},{no:18,name:"auth_webhook_min_wait_interval",kind:"scalar",T:9},{no:19,name:"auth_webhook_max_wait_interval",kind:"scalar",T:9},{no:20,name:"auth_webhook_request_timeout",kind:"scalar",T:9},{no:7,name:"event_webhook_url",kind:"scalar",T:9},{no:8,name:"event_webhook_events",kind:"scalar",T:9,repeated:!0},{no:21,name:"event_webhook_max_retries",kind:"scalar",T:4},{no:22,name:"event_webhook_min_wait_interval",kind:"scalar",T:9},{no:23,name:"event_webhook_max_wait_interval",kind:"scalar",T:9},{no:24,name:"event_webhook_request_timeout",kind:"scalar",T:9},{no:9,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:25,name:"snapshot_threshold",kind:"scalar",T:3},{no:26,name:"snapshot_interval",kind:"scalar",T:3},{no:10,name:"max_subscribers_per_document",kind:"scalar",T:5},{no:11,name:"max_attachments_per_document",kind:"scalar",T:5},{no:15,name:"max_size_per_document",kind:"scalar",T:5},{no:16,name:"remove_on_detach",kind:"scalar",T:8},{no:14,name:"allowed_origins",kind:"scalar",T:9,repeated:!0},{no:12,name:"created_at",kind:"message",T:ee},{no:13,name:"updated_at",kind:"message",T:ee}]));let Lo=Nt;const Pt=class Pt extends T{constructor(e){super();o(this,"timestamp",O.zero);o(this,"value",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new Pt().fromBinary(e,r)}static fromJson(e,r){return new Pt().fromJson(e,r)}static fromJsonString(e,r){return new Pt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Pt,e,r)}};o(Pt,"runtime",u),o(Pt,"typeName","yorkie.v1.MetricPoint"),o(Pt,"fields",u.util.newFieldList(()=>[{no:1,name:"timestamp",kind:"scalar",T:3},{no:2,name:"value",kind:"scalar",T:5}]));let Jo=Pt;const Ct=class Ct extends T{constructor(e){super();o(this,"name");o(this,"authWebhookUrl");o(this,"authWebhookMethods");o(this,"authWebhookMaxRetries");o(this,"authWebhookMinWaitInterval");o(this,"authWebhookMaxWaitInterval");o(this,"authWebhookRequestTimeout");o(this,"eventWebhookUrl");o(this,"eventWebhookEvents");o(this,"eventWebhookMaxRetries");o(this,"eventWebhookMinWaitInterval");o(this,"eventWebhookMaxWaitInterval");o(this,"eventWebhookRequestTimeout");o(this,"snapshotThreshold");o(this,"snapshotInterval");o(this,"clientDeactivateThreshold");o(this,"maxSubscribersPerDocument");o(this,"maxAttachmentsPerDocument");o(this,"maxSizePerDocument");o(this,"removeOnDetach");o(this,"allowedOrigins");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ct().fromBinary(e,r)}static fromJson(e,r){return new Ct().fromJson(e,r)}static fromJsonString(e,r){return new Ct().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ct,e,r)}};o(Ct,"runtime",u),o(Ct,"typeName","yorkie.v1.UpdatableProjectFields"),o(Ct,"fields",u.util.newFieldList(()=>[{no:1,name:"name",kind:"message",T:X},{no:2,name:"auth_webhook_url",kind:"message",T:X},{no:3,name:"auth_webhook_methods",kind:"message",T:Zi},{no:12,name:"auth_webhook_max_retries",kind:"message",T:Ee},{no:13,name:"auth_webhook_min_wait_interval",kind:"message",T:X},{no:14,name:"auth_webhook_max_wait_interval",kind:"message",T:X},{no:15,name:"auth_webhook_request_timeout",kind:"message",T:X},{no:4,name:"event_webhook_url",kind:"message",T:X},{no:5,name:"event_webhook_events",kind:"message",T:Qi},{no:16,name:"event_webhook_max_retries",kind:"message",T:Ee},{no:17,name:"event_webhook_min_wait_interval",kind:"message",T:X},{no:18,name:"event_webhook_max_wait_interval",kind:"message",T:X},{no:19,name:"event_webhook_request_timeout",kind:"message",T:X},{no:20,name:"snapshot_threshold",kind:"message",T:ke},{no:21,name:"snapshot_interval",kind:"message",T:ke},{no:6,name:"client_deactivate_threshold",kind:"message",T:X},{no:7,name:"max_subscribers_per_document",kind:"message",T:le},{no:8,name:"max_attachments_per_document",kind:"message",T:le},{no:10,name:"max_size_per_document",kind:"message",T:le},{no:11,name:"remove_on_detach",kind:"message",T:Je},{no:9,name:"allowed_origins",kind:"message",T:_i}]));let Ro=Ct;const Dt=class Dt extends T{constructor(e){super();o(this,"methods",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new Dt().fromBinary(e,r)}static fromJson(e,r){return new Dt().fromJson(e,r)}static fromJsonString(e,r){return new Dt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Dt,e,r)}};o(Dt,"runtime",u),o(Dt,"typeName","yorkie.v1.UpdatableProjectFields.AuthWebhookMethods"),o(Dt,"fields",u.util.newFieldList(()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}]));let Zi=Dt;const Bt=class Bt extends T{constructor(e){super();o(this,"events",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new Bt().fromBinary(e,r)}static fromJson(e,r){return new Bt().fromJson(e,r)}static fromJsonString(e,r){return new Bt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Bt,e,r)}};o(Bt,"runtime",u),o(Bt,"typeName","yorkie.v1.UpdatableProjectFields.EventWebhookEvents"),o(Bt,"fields",u.util.newFieldList(()=>[{no:1,name:"events",kind:"scalar",T:9,repeated:!0}]));let Qi=Bt;const Ot=class Ot extends T{constructor(e){super();o(this,"origins",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new Ot().fromBinary(e,r)}static fromJson(e,r){return new Ot().fromJson(e,r)}static fromJsonString(e,r){return new Ot().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ot,e,r)}};o(Ot,"runtime",u),o(Ot,"typeName","yorkie.v1.UpdatableProjectFields.AllowedOrigins"),o(Ot,"fields",u.util.newFieldList(()=>[{no:1,name:"origins",kind:"scalar",T:9,repeated:!0}]));let _i=Ot;const Lt=class Lt extends T{constructor(e){super();o(this,"id","");o(this,"key","");o(this,"root","");o(this,"attachedClients",0);o(this,"documentSize");o(this,"schemaKey","");o(this,"presences",{});o(this,"createdAt");o(this,"accessedAt");o(this,"updatedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Lt().fromBinary(e,r)}static fromJson(e,r){return new Lt().fromJson(e,r)}static fromJsonString(e,r){return new Lt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Lt,e,r)}};o(Lt,"runtime",u),o(Lt,"typeName","yorkie.v1.DocumentSummary"),o(Lt,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"root",kind:"scalar",T:9},{no:7,name:"attached_clients",kind:"scalar",T:5},{no:8,name:"document_size",kind:"message",T:ns},{no:9,name:"schema_key",kind:"scalar",T:9},{no:10,name:"presences",kind:"map",K:9,V:{kind:"message",T:$i}},{no:4,name:"created_at",kind:"message",T:ee},{no:5,name:"accessed_at",kind:"message",T:ee},{no:6,name:"updated_at",kind:"message",T:ee}]));let $o=Lt;const Jt=class Jt extends T{constructor(e){super();o(this,"type",0);o(this,"presence");u.util.initPartial(e,this)}static fromBinary(e,r){return new Jt().fromBinary(e,r)}static fromJson(e,r){return new Jt().fromJson(e,r)}static fromJsonString(e,r){return new Jt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Jt,e,r)}};o(Jt,"runtime",u),o(Jt,"typeName","yorkie.v1.PresenceChange"),o(Jt,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(Kr)},{no:2,name:"presence",kind:"message",T:$i}]));let Pn=Jt;var Kr=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.PUT=1]="PUT",n[n.DELETE=2]="DELETE",n[n.CLEAR=3]="CLEAR",n))(Kr||{});u.util.setEnumType(Kr,"yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT"},{no:2,name:"CHANGE_TYPE_DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR"}]);var be;let $i=(be=class extends T{constructor(e){super();o(this,"data",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new be().fromBinary(e,r)}static fromJson(e,r){return new be().fromJson(e,r)}static fromJsonString(e,r){return new be().fromJsonString(e,r)}static equals(e,r){return u.util.equals(be,e,r)}},o(be,"runtime",u),o(be,"typeName","yorkie.v1.Presence"),o(be,"fields",u.util.newFieldList(()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}])),be);var Ie;let Ba=(Ie=class extends T{constructor(e){super();o(this,"serverSeq",O.zero);o(this,"clientSeq",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new Ie().fromBinary(e,r)}static fromJson(e,r){return new Ie().fromJson(e,r)}static fromJsonString(e,r){return new Ie().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ie,e,r)}},o(Ie,"runtime",u),o(Ie,"typeName","yorkie.v1.Checkpoint"),o(Ie,"fields",u.util.newFieldList(()=>[{no:1,name:"server_seq",kind:"scalar",T:3},{no:2,name:"client_seq",kind:"scalar",T:13}])),Ie);const Rt=class Rt extends T{constructor(e){super();o(this,"createdAt");o(this,"offset",0);o(this,"relativeOffset",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new Rt().fromBinary(e,r)}static fromJson(e,r){return new Rt().fromJson(e,r)}static fromJsonString(e,r){return new Rt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Rt,e,r)}};o(Rt,"runtime",u),o(Rt,"typeName","yorkie.v1.TextNodePos"),o(Rt,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:k},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]));let Vr=Rt;var Ae;let k=(Ae=class extends T{constructor(e){super();o(this,"lamport",O.zero);o(this,"delimiter",0);o(this,"actorId",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new Ae().fromBinary(e,r)}static fromJson(e,r){return new Ae().fromJson(e,r)}static fromJsonString(e,r){return new Ae().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ae,e,r)}},o(Ae,"runtime",u),o(Ae,"typeName","yorkie.v1.TimeTicket"),o(Ae,"fields",u.util.newFieldList(()=>[{no:1,name:"lamport",kind:"scalar",T:3},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}])),Ae);const $t=class $t extends T{constructor(e){super();o(this,"topic","");o(this,"payload",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new $t().fromBinary(e,r)}static fromJson(e,r){return new $t().fromJson(e,r)}static fromJsonString(e,r){return new $t().fromJsonString(e,r)}static equals(e,r){return u.util.equals($t,e,r)}};o($t,"runtime",u),o($t,"typeName","yorkie.v1.DocEventBody"),o($t,"fields",u.util.newFieldList(()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]));let es=$t;const Mt=class Mt extends T{constructor(e){super();o(this,"type",0);o(this,"publisher","");o(this,"body");u.util.initPartial(e,this)}static fromBinary(e,r){return new Mt().fromBinary(e,r)}static fromJson(e,r){return new Mt().fromJson(e,r)}static fromJsonString(e,r){return new Mt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Mt,e,r)}};o(Mt,"runtime",u),o(Mt,"typeName","yorkie.v1.DocEvent"),o(Mt,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(qr)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:es}]));let ts=Mt;const Ft=class Ft extends T{constructor(e){super();o(this,"type",0);o(this,"count",O.zero);o(this,"seq",O.zero);u.util.initPartial(e,this)}static fromBinary(e,r){return new Ft().fromBinary(e,r)}static fromJson(e,r){return new Ft().fromJson(e,r)}static fromJsonString(e,r){return new Ft().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ft,e,r)}};o(Ft,"runtime",u),o(Ft,"typeName","yorkie.v1.PresenceEvent"),o(Ft,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(zs)},{no:2,name:"count",kind:"scalar",T:3},{no:3,name:"seq",kind:"scalar",T:3}]));let rs=Ft;var zs=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.COUNT_CHANGED=1]="COUNT_CHANGED",n))(zs||{});u.util.setEnumType(zs,"yorkie.v1.PresenceEvent.Type",[{no:0,name:"TYPE_UNSPECIFIED"},{no:1,name:"TYPE_COUNT_CHANGED"}]);const zt=class zt extends T{constructor(e){super();o(this,"data",0);o(this,"meta",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new zt().fromBinary(e,r)}static fromJson(e,r){return new zt().fromJson(e,r)}static fromJsonString(e,r){return new zt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(zt,e,r)}};o(zt,"runtime",u),o(zt,"typeName","yorkie.v1.DataSize"),o(zt,"fields",u.util.newFieldList(()=>[{no:1,name:"data",kind:"scalar",T:5},{no:2,name:"meta",kind:"scalar",T:5}]));let Ei=zt;const qt=class qt extends T{constructor(e){super();o(this,"live");o(this,"gc");u.util.initPartial(e,this)}static fromBinary(e,r){return new qt().fromBinary(e,r)}static fromJson(e,r){return new qt().fromJson(e,r)}static fromJsonString(e,r){return new qt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(qt,e,r)}};o(qt,"runtime",u),o(qt,"typeName","yorkie.v1.DocSize"),o(qt,"fields",u.util.newFieldList(()=>[{no:1,name:"live",kind:"message",T:Ei},{no:2,name:"gc",kind:"message",T:Ei}]));let ns=qt;const Ut=class Ut extends T{constructor(e){super();o(this,"id","");o(this,"name","");o(this,"version",0);o(this,"body","");o(this,"rules",[]);o(this,"createdAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ut().fromBinary(e,r)}static fromJson(e,r){return new Ut().fromJson(e,r)}static fromJsonString(e,r){return new Ut().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ut,e,r)}};o(Ut,"runtime",u),o(Ut,"typeName","yorkie.v1.Schema"),o(Ut,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"version",kind:"scalar",T:5},{no:4,name:"body",kind:"scalar",T:9},{no:5,name:"rules",kind:"message",T:xi,repeated:!0},{no:6,name:"created_at",kind:"message",T:ee}]));let Mo=Ut;const Kt=class Kt extends T{constructor(e){super();o(this,"path","");o(this,"type","");u.util.initPartial(e,this)}static fromBinary(e,r){return new Kt().fromBinary(e,r)}static fromJson(e,r){return new Kt().fromJson(e,r)}static fromJsonString(e,r){return new Kt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Kt,e,r)}};o(Kt,"runtime",u),o(Kt,"typeName","yorkie.v1.Rule"),o(Kt,"fields",u.util.newFieldList(()=>[{no:1,name:"path",kind:"scalar",T:9},{no:2,name:"type",kind:"scalar",T:9}]));let xi=Kt;const Vt=class Vt extends T{constructor(e){super();o(this,"clientKey","");o(this,"metadata",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new Vt().fromBinary(e,r)}static fromJson(e,r){return new Vt().fromJson(e,r)}static fromJsonString(e,r){return new Vt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Vt,e,r)}};o(Vt,"runtime",u),o(Vt,"typeName","yorkie.v1.ActivateClientRequest"),o(Vt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_key",kind:"scalar",T:9},{no:2,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]));let is=Vt;const jt=class jt extends T{constructor(e){super();o(this,"clientId","");u.util.initPartial(e,this)}static fromBinary(e,r){return new jt().fromBinary(e,r)}static fromJson(e,r){return new jt().fromJson(e,r)}static fromJsonString(e,r){return new jt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(jt,e,r)}};o(jt,"runtime",u),o(jt,"typeName","yorkie.v1.ActivateClientResponse"),o(jt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9}]));let ss=jt;const Wt=class Wt extends T{constructor(e){super();o(this,"clientId","");o(this,"synchronous",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new Wt().fromBinary(e,r)}static fromJson(e,r){return new Wt().fromJson(e,r)}static fromJsonString(e,r){return new Wt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Wt,e,r)}};o(Wt,"runtime",u),o(Wt,"typeName","yorkie.v1.DeactivateClientRequest"),o(Wt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"synchronous",kind:"scalar",T:8}]));let os=Wt;const Gt=class Gt extends T{constructor(t){super(),u.util.initPartial(t,this)}static fromBinary(t,e){return new Gt().fromBinary(t,e)}static fromJson(t,e){return new Gt().fromJson(t,e)}static fromJsonString(t,e){return new Gt().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Gt,t,e)}};o(Gt,"runtime",u),o(Gt,"typeName","yorkie.v1.DeactivateClientResponse"),o(Gt,"fields",u.util.newFieldList(()=>[]));let as=Gt;const Ht=class Ht extends T{constructor(e){super();o(this,"clientId","");o(this,"changePack");o(this,"schemaKey","");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ht().fromBinary(e,r)}static fromJson(e,r){return new Ht().fromJson(e,r)}static fromJsonString(e,r){return new Ht().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ht,e,r)}};o(Ht,"runtime",u),o(Ht,"typeName","yorkie.v1.AttachDocumentRequest"),o(Ht,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:Er},{no:3,name:"schema_key",kind:"scalar",T:9}]));let cs=Ht;const Yt=class Yt extends T{constructor(e){super();o(this,"documentId","");o(this,"changePack");o(this,"maxSizePerDocument",0);o(this,"schemaRules",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new Yt().fromBinary(e,r)}static fromJson(e,r){return new Yt().fromJson(e,r)}static fromJsonString(e,r){return new Yt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Yt,e,r)}};o(Yt,"runtime",u),o(Yt,"typeName","yorkie.v1.AttachDocumentResponse"),o(Yt,"fields",u.util.newFieldList(()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:Er},{no:3,name:"max_size_per_document",kind:"scalar",T:5},{no:4,name:"schema_rules",kind:"message",T:xi,repeated:!0}]));let us=Yt;const Xt=class Xt extends T{constructor(e){super();o(this,"clientId","");o(this,"documentId","");o(this,"changePack");o(this,"removeIfNotAttached",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new Xt().fromBinary(e,r)}static fromJson(e,r){return new Xt().fromJson(e,r)}static fromJsonString(e,r){return new Xt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Xt,e,r)}};o(Xt,"runtime",u),o(Xt,"typeName","yorkie.v1.DetachDocumentRequest"),o(Xt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Er},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]));let ls=Xt;const Zt=class Zt extends T{constructor(e){super();o(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new Zt().fromBinary(e,r)}static fromJson(e,r){return new Zt().fromJson(e,r)}static fromJsonString(e,r){return new Zt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Zt,e,r)}};o(Zt,"runtime",u),o(Zt,"typeName","yorkie.v1.DetachDocumentResponse"),o(Zt,"fields",u.util.newFieldList(()=>[{no:2,name:"change_pack",kind:"message",T:Er}]));let hs=Zt;const Qt=class Qt extends T{constructor(e){super();o(this,"clientId","");o(this,"documentId","");u.util.initPartial(e,this)}static fromBinary(e,r){return new Qt().fromBinary(e,r)}static fromJson(e,r){return new Qt().fromJson(e,r)}static fromJsonString(e,r){return new Qt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Qt,e,r)}};o(Qt,"runtime",u),o(Qt,"typeName","yorkie.v1.WatchDocumentRequest"),o(Qt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]));let fs=Qt;const _t=class _t extends T{constructor(e){super();o(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new _t().fromBinary(e,r)}static fromJson(e,r){return new _t().fromJson(e,r)}static fromJsonString(e,r){return new _t().fromJsonString(e,r)}static equals(e,r){return u.util.equals(_t,e,r)}};o(_t,"runtime",u),o(_t,"typeName","yorkie.v1.WatchDocumentResponse"),o(_t,"fields",u.util.newFieldList(()=>[{no:1,name:"initialization",kind:"message",T:gs,oneof:"body"},{no:2,name:"event",kind:"message",T:ts,oneof:"body"}]));let ds=_t;const er=class er extends T{constructor(e){super();o(this,"clientIds",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new er().fromBinary(e,r)}static fromJson(e,r){return new er().fromJson(e,r)}static fromJsonString(e,r){return new er().fromJsonString(e,r)}static equals(e,r){return u.util.equals(er,e,r)}};o(er,"runtime",u),o(er,"typeName","yorkie.v1.WatchDocumentResponse.Initialization"),o(er,"fields",u.util.newFieldList(()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}]));let gs=er;const tr=class tr extends T{constructor(e){super();o(this,"clientId","");o(this,"documentId","");o(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new tr().fromBinary(e,r)}static fromJson(e,r){return new tr().fromJson(e,r)}static fromJsonString(e,r){return new tr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(tr,e,r)}};o(tr,"runtime",u),o(tr,"typeName","yorkie.v1.RemoveDocumentRequest"),o(tr,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Er}]));let ms=tr;const rr=class rr extends T{constructor(e){super();o(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new rr().fromBinary(e,r)}static fromJson(e,r){return new rr().fromJson(e,r)}static fromJsonString(e,r){return new rr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(rr,e,r)}};o(rr,"runtime",u),o(rr,"typeName","yorkie.v1.RemoveDocumentResponse"),o(rr,"fields",u.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:Er}]));let ps=rr;const nr=class nr extends T{constructor(e){super();o(this,"clientId","");o(this,"documentId","");o(this,"changePack");o(this,"pushOnly",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new nr().fromBinary(e,r)}static fromJson(e,r){return new nr().fromJson(e,r)}static fromJsonString(e,r){return new nr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(nr,e,r)}};o(nr,"runtime",u),o(nr,"typeName","yorkie.v1.PushPullChangesRequest"),o(nr,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Er},{no:4,name:"push_only",kind:"scalar",T:8}]));let ys=nr;const ir=class ir extends T{constructor(e){super();o(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new ir().fromBinary(e,r)}static fromJson(e,r){return new ir().fromJson(e,r)}static fromJsonString(e,r){return new ir().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ir,e,r)}};o(ir,"runtime",u),o(ir,"typeName","yorkie.v1.PushPullChangesResponse"),o(ir,"fields",u.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:Er}]));let vs=ir;const sr=class sr extends T{constructor(e){super();o(this,"clientId","");o(this,"documentId","");o(this,"topic","");o(this,"payload",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new sr().fromBinary(e,r)}static fromJson(e,r){return new sr().fromJson(e,r)}static fromJsonString(e,r){return new sr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(sr,e,r)}};o(sr,"runtime",u),o(sr,"typeName","yorkie.v1.BroadcastRequest"),o(sr,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]));let ws=sr;const or=class or extends T{constructor(t){super(),u.util.initPartial(t,this)}static fromBinary(t,e){return new or().fromBinary(t,e)}static fromJson(t,e){return new or().fromJson(t,e)}static fromJsonString(t,e){return new or().fromJsonString(t,e)}static equals(t,e){return u.util.equals(or,t,e)}};o(or,"runtime",u),o(or,"typeName","yorkie.v1.BroadcastResponse"),o(or,"fields",u.util.newFieldList(()=>[]));let Ts=or;const ar=class ar extends T{constructor(e){super();o(this,"clientId","");o(this,"presenceKey","");u.util.initPartial(e,this)}static fromBinary(e,r){return new ar().fromBinary(e,r)}static fromJson(e,r){return new ar().fromJson(e,r)}static fromJsonString(e,r){return new ar().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ar,e,r)}};o(ar,"runtime",u),o(ar,"typeName","yorkie.v1.AttachPresenceRequest"),o(ar,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"presence_key",kind:"scalar",T:9}]));let Ss=ar;const cr=class cr extends T{constructor(e){super();o(this,"presenceId","");o(this,"count",O.zero);u.util.initPartial(e,this)}static fromBinary(e,r){return new cr().fromBinary(e,r)}static fromJson(e,r){return new cr().fromJson(e,r)}static fromJsonString(e,r){return new cr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(cr,e,r)}};o(cr,"runtime",u),o(cr,"typeName","yorkie.v1.AttachPresenceResponse"),o(cr,"fields",u.util.newFieldList(()=>[{no:1,name:"presence_id",kind:"scalar",T:9},{no:2,name:"count",kind:"scalar",T:3}]));let bs=cr;const ur=class ur extends T{constructor(e){super();o(this,"clientId","");o(this,"presenceId","");o(this,"presenceKey","");u.util.initPartial(e,this)}static fromBinary(e,r){return new ur().fromBinary(e,r)}static fromJson(e,r){return new ur().fromJson(e,r)}static fromJsonString(e,r){return new ur().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ur,e,r)}};o(ur,"runtime",u),o(ur,"typeName","yorkie.v1.DetachPresenceRequest"),o(ur,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"presence_id",kind:"scalar",T:9},{no:3,name:"presence_key",kind:"scalar",T:9}]));let Is=ur;const lr=class lr extends T{constructor(e){super();o(this,"count",O.zero);u.util.initPartial(e,this)}static fromBinary(e,r){return new lr().fromBinary(e,r)}static fromJson(e,r){return new lr().fromJson(e,r)}static fromJsonString(e,r){return new lr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(lr,e,r)}};o(lr,"runtime",u),o(lr,"typeName","yorkie.v1.DetachPresenceResponse"),o(lr,"fields",u.util.newFieldList(()=>[{no:1,name:"count",kind:"scalar",T:3}]));let As=lr;const hr=class hr extends T{constructor(e){super();o(this,"clientId","");o(this,"presenceId","");o(this,"presenceKey","");u.util.initPartial(e,this)}static fromBinary(e,r){return new hr().fromBinary(e,r)}static fromJson(e,r){return new hr().fromJson(e,r)}static fromJsonString(e,r){return new hr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(hr,e,r)}};o(hr,"runtime",u),o(hr,"typeName","yorkie.v1.RefreshPresenceRequest"),o(hr,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"presence_id",kind:"scalar",T:9},{no:3,name:"presence_key",kind:"scalar",T:9}]));let ks=hr;const fr=class fr extends T{constructor(e){super();o(this,"count",O.zero);u.util.initPartial(e,this)}static fromBinary(e,r){return new fr().fromBinary(e,r)}static fromJson(e,r){return new fr().fromJson(e,r)}static fromJsonString(e,r){return new fr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(fr,e,r)}};o(fr,"runtime",u),o(fr,"typeName","yorkie.v1.RefreshPresenceResponse"),o(fr,"fields",u.util.newFieldList(()=>[{no:1,name:"count",kind:"scalar",T:3}]));let Es=fr;const dr=class dr extends T{constructor(e){super();o(this,"clientId","");o(this,"presenceKey","");u.util.initPartial(e,this)}static fromBinary(e,r){return new dr().fromBinary(e,r)}static fromJson(e,r){return new dr().fromJson(e,r)}static fromJsonString(e,r){return new dr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(dr,e,r)}};o(dr,"runtime",u),o(dr,"typeName","yorkie.v1.WatchPresenceRequest"),o(dr,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"presence_key",kind:"scalar",T:9}]));let xs=dr;const gr=class gr extends T{constructor(e){super();o(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new gr().fromBinary(e,r)}static fromJson(e,r){return new gr().fromJson(e,r)}static fromJsonString(e,r){return new gr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(gr,e,r)}};o(gr,"runtime",u),o(gr,"typeName","yorkie.v1.WatchPresenceResponse"),o(gr,"fields",u.util.newFieldList(()=>[{no:1,name:"initialized",kind:"message",T:Ps,oneof:"body"},{no:2,name:"event",kind:"message",T:rs,oneof:"body"}]));let Ns=gr;const mr=class mr extends T{constructor(e){super();o(this,"count",O.zero);o(this,"seq",O.zero);u.util.initPartial(e,this)}static fromBinary(e,r){return new mr().fromBinary(e,r)}static fromJson(e,r){return new mr().fromJson(e,r)}static fromJsonString(e,r){return new mr().fromJsonString(e,r)}static equals(e,r){return u.util.equals(mr,e,r)}};o(mr,"runtime",u),o(mr,"typeName","yorkie.v1.WatchPresenceInitialized"),o(mr,"fields",u.util.newFieldList(()=>[{no:1,name:"count",kind:"scalar",T:3},{no:2,name:"seq",kind:"scalar",T:3}]));let Ps=mr;const zu={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:is,O:ss,kind:Q.Unary},deactivateClient:{name:"DeactivateClient",I:os,O:as,kind:Q.Unary},attachDocument:{name:"AttachDocument",I:cs,O:us,kind:Q.Unary},detachDocument:{name:"DetachDocument",I:ls,O:hs,kind:Q.Unary},removeDocument:{name:"RemoveDocument",I:ms,O:ps,kind:Q.Unary},pushPullChanges:{name:"PushPullChanges",I:ys,O:vs,kind:Q.Unary},watchDocument:{name:"WatchDocument",I:fs,O:ds,kind:Q.ServerStreaming},broadcast:{name:"Broadcast",I:ws,O:Ts,kind:Q.Unary},attachPresence:{name:"AttachPresence",I:Ss,O:bs,kind:Q.Unary},detachPresence:{name:"DetachPresence",I:Is,O:As,kind:Q.Unary},refreshPresence:{name:"RefreshPresence",I:ks,O:Es,kind:Q.Unary},watchPresence:{name:"WatchPresence",I:xs,O:Ns,kind:Q.ServerStreaming}}},qu=u.makeMessageType("google.rpc.ErrorInfo",()=>[{no:1,name:"reason",kind:"scalar",T:9},{no:2,name:"domain",kind:"scalar",T:9},{no:3,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]);u.makeMessageType("google.rpc.RetryInfo",()=>[{no:1,name:"retry_delay",kind:"message",T:wr}]);u.makeMessageType("google.rpc.DebugInfo",()=>[{no:1,name:"stack_entries",kind:"scalar",T:9,repeated:!0},{no:2,name:"detail",kind:"scalar",T:9}]);u.makeMessageType("google.rpc.QuotaFailure",()=>[{no:1,name:"violations",kind:"message",T:Uu,repeated:!0}]);const Uu=u.makeMessageType("google.rpc.QuotaFailure.Violation",()=>[{no:1,name:"subject",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9},{no:3,name:"api_service",kind:"scalar",T:9},{no:4,name:"quota_metric",kind:"scalar",T:9},{no:5,name:"quota_id",kind:"scalar",T:9},{no:6,name:"quota_dimensions",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:7,name:"quota_value",kind:"scalar",T:3},{no:8,name:"future_quota_value",kind:"scalar",T:3,opt:!0}],{localName:"QuotaFailure_Violation"});u.makeMessageType("google.rpc.PreconditionFailure",()=>[{no:1,name:"violations",kind:"message",T:Ku,repeated:!0}]);const Ku=u.makeMessageType("google.rpc.PreconditionFailure.Violation",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"subject",kind:"scalar",T:9},{no:3,name:"description",kind:"scalar",T:9}],{localName:"PreconditionFailure_Violation"});u.makeMessageType("google.rpc.BadRequest",()=>[{no:1,name:"field_violations",kind:"message",T:Vu,repeated:!0}]);const Vu=u.makeMessageType("google.rpc.BadRequest.FieldViolation",()=>[{no:1,name:"field",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9},{no:3,name:"reason",kind:"scalar",T:9},{no:4,name:"localized_message",kind:"message",T:Wu}],{localName:"BadRequest_FieldViolation"});u.makeMessageType("google.rpc.RequestInfo",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"serving_data",kind:"scalar",T:9}]);u.makeMessageType("google.rpc.ResourceInfo",()=>[{no:1,name:"resource_type",kind:"scalar",T:9},{no:2,name:"resource_name",kind:"scalar",T:9},{no:3,name:"owner",kind:"scalar",T:9},{no:4,name:"description",kind:"scalar",T:9}]);u.makeMessageType("google.rpc.Help",()=>[{no:1,name:"links",kind:"message",T:ju,repeated:!0}]);const ju=u.makeMessageType("google.rpc.Help.Link",()=>[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9}],{localName:"Help_Link"}),Wu=u.makeMessageType("google.rpc.LocalizedMessage",()=>[{no:1,name:"locale",kind:"scalar",T:9},{no:2,name:"message",kind:"scalar",T:9}]);var d=(n=>(n.Ok="ok",n.ErrClientNotActivated="ErrClientNotActivated",n.ErrClientNotFound="ErrClientNotFound",n.ErrUnimplemented="ErrUnimplemented",n.ErrInvalidType="ErrInvalidType",n.ErrDummy="ErrDummy",n.ErrDocumentNotAttached="ErrDocumentNotAttached",n.ErrDocumentNotDetached="ErrDocumentNotDetached",n.ErrDocumentRemoved="ErrDocumentRemoved",n.ErrDocumentSizeExceedsLimit="ErrDocumentSizeExceedsLimit",n.ErrDocumentSchemaValidationFailed="ErrDocumentSchemaValidationFailed",n.ErrInvalidObjectKey="ErrInvalidObjectKey",n.ErrInvalidArgument="ErrInvalidArgument",n.ErrNotInitialized="ErrNotInitialized",n.ErrNotReady="ErrNotReady",n.ErrRefused="ErrRefused",n.ErrContextNotProvided="ErrContextNotProvided",n.ErrPermissionDenied="ErrPermissionDenied",n.ErrUnauthenticated="ErrUnauthenticated",n.ErrTooManySubscribers="ErrTooManySubscribers",n.ErrTooManyAttachments="ErrTooManyAttachments",n))(d||{});class g extends Error{constructor(e,r){super(r);o(this,"name","YorkieError");o(this,"stack");this.code=e,this.message=r,this.toString=()=>`[code=${this.code}]: ${this.message}`}}var Qe=(n=>(n.Put="put",n.Clear="clear",n))(Qe||{});const qs="000000000000000000000000",Ye=24;class Pe{constructor(t,e,r){o(this,"lamport");o(this,"delimiter");o(this,"actorID");this.lamport=t,this.delimiter=e,this.actorID=r}static of(t,e,r){return new Pe(t,e,r)}static fromStruct(t){return Pe.of(BigInt(t.lamport),t.delimiter,t.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(t){return new Pe(this.lamport,this.delimiter,t)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(t){return this.compare(t)>0}equals(t){return this.compare(t)===0}compare(t){if(this.lamport>t.lamport)return 1;if(t.lamport>this.lamport)return-1;const e=this.actorID.localeCompare(t.actorID);return e!==0?e:this.delimiter>t.delimiter?1:t.delimiter>this.delimiter?-1:0}}const Cs=0n,Oa=0,Ds=9223372036854775807n,an=new Pe(Cs,Oa,qs);function He(n){return n.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(t){switch(t){case'"':case"\\":return"\\"+t;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t}})}class Jn{constructor(t){o(this,"createdAt");o(this,"movedAt");o(this,"removedAt");this.createdAt=t}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setCreatedAt(t){this.createdAt=t}setMovedAt(t){return!this.movedAt||t&&t.after(this.movedAt)?(this.movedAt=t,!0):!1}setRemovedAt(t){this.removedAt=t}remove(t){return t&&t.after(this.createdAt)&&(!this.removedAt||t.after(this.removedAt))?(this.removedAt=t,!0):!1}isRemoved(){return!!this.removedAt}getMetaUsage(){let t=0;return this.getCreatedAt()&&(t+=Ye),this.getMovedAt()&&(t+=Ye),this.getRemovedAt()&&(t+=Ye),t}}class Dr extends Jn{constructor(t){super(t)}}class Ni{constructor(t,e){o(this,"strKey");o(this,"value");this.strKey=t,this.value=e}static of(t,e){return new Ni(t,e)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(t){return this.value.remove(t)}}class cn{constructor(){o(this,"nodeMapByKey");o(this,"nodeMapByCreatedAt");this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new cn}set(t,e,r){let i;const s=this.nodeMapByKey.get(t);s&&!s.isRemoved()&&s.remove(r)&&(i=s.getValue());const a=Ni.of(t,e);return this.nodeMapByCreatedAt.set(e.getCreatedAt().toIDString(),a),(!s||r.after(s.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(t,a),e.setMovedAt(r)),i}delete(t,e){if(!this.nodeMapByCreatedAt.has(t.toIDString()))throw new g(d.ErrInvalidArgument,`fail to find ${t.toIDString()}`);const r=this.nodeMapByCreatedAt.get(t.toIDString());return r.remove(e),r.getValue()}subPathOf(t){const e=this.nodeMapByCreatedAt.get(t.toIDString());if(e)return e.getStrKey()}purge(t){const e=this.nodeMapByCreatedAt.get(t.getCreatedAt().toIDString());if(!e)throw new g(d.ErrInvalidArgument,`fail to find ${t.getCreatedAt().toIDString()}`);const r=this.nodeMapByKey.get(e.getStrKey());e===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}deleteByKey(t,e){const r=this.nodeMapByKey.get(t);if(r&&r.remove(e))return r.getValue()}has(t){const e=this.nodeMapByKey.get(t);return e?!e.isRemoved():!1}getByID(t){return this.nodeMapByCreatedAt.get(t.toIDString())}get(t){const e=this.nodeMapByKey.get(t);if(!(!e||e.isRemoved()))return e}deepcopy(){const t=cn.create();for(const[,e]of this.nodeMapByCreatedAt)t.nodeMapByCreatedAt.set(e.getValue().getCreatedAt().toIDString(),Ni.of(e.getStrKey(),e.getValue().deepcopy()));for(const[e,r]of this.nodeMapByKey)t.nodeMapByKey.set(e,t.nodeMapByCreatedAt.get(r.getValue().getCreatedAt().toIDString()));return t}*[Symbol.iterator](){for(const[,t]of this.nodeMapByCreatedAt)yield t}}class ne extends Dr{constructor(e,r){super(e);o(this,"memberNodes");this.memberNodes=r}static create(e,r){if(!r)return new ne(e,cn.create());const i=cn.create();for(const[s,a]of Object.entries(r))i.set(s,a.deepcopy(),a.getCreatedAt());return new ne(e,i)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,r,i){return this.memberNodes.set(e,r,i)}delete(e,r){return this.memberNodes.delete(e,r)}deleteByKey(e,r){return this.memberNodes.deleteByKey(e,r)}get(e){const r=this.memberNodes.get(e);return r==null?void 0:r.getValue()}getByID(e){const r=this.memberNodes.getByID(e);return r==null?void 0:r.getValue()}has(e){return this.memberNodes.has(e)}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const e=[];for(const[r,i]of this)e.push(`"${He(r)}":${i.toJSON()}`);return`{${e.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(const[r,i]of this){const{createdAt:s,value:a,type:c}=i.toJSForTest();e[r]={key:r,createdAt:s,value:a,type:c}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){const e=Array();for(const[r]of this)e.push(r);return e}toSortedJSON(){var i;const e=new Set;for(const[s]of this)e.add(s);const r=[];for(const s of Array.from(e).sort()){const a=(i=this.memberNodes.get(s))==null?void 0:i.getValue();r.push(`"${He(s)}":${a.toSortedJSON()}`)}return`{${r.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const e=ne.create(this.getCreatedAt());return e.memberNodes=this.memberNodes.deepcopy(),e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}getDescendants(e){for(const r of this.memberNodes){const i=r.getValue();if(e(i,this))return;i instanceof Dr&&i.getDescendants(e)}}*[Symbol.iterator](){for(const e of this.memberNodes)e.isRemoved()||(yield[e.getStrKey(),e.getValue()])}}var q=(n=>(n.Local="local",n.Remote="remote",n.UndoRedo="undoredo",n))(q||{});class ze{constructor(t,e){o(this,"parentCreatedAt");o(this,"executedAt");this.parentCreatedAt=t,this.executedAt=e}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new g(d.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(t){this.executedAt&&(this.executedAt=this.executedAt.setActor(t))}setExecutedAt(t){this.executedAt=t}}class La{constructor(t){o(this,"value");o(this,"left");o(this,"right");o(this,"parent");o(this,"weight");this.value=t,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(t){this.left=t}setRight(t){this.right=t}setParent(t){this.parent=t}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(t){this.weight+=t}initWeight(){this.weight=this.getLength()}}class Cn{constructor(t){o(this,"root");this.root=t}get length(){return this.root?this.root.getWeight():0}find(t){if(!this.root||t<0)return[void 0,0];let e=this.root;for(;;)if(e.hasLeft()&&t<=e.getLeftWeight())e=e.getLeft();else if(e.hasRight()&&e.getLeftWeight()+e.getLength()<t)t-=e.getLeftWeight()+e.getLength(),e=e.getRight();else{t-=e.getLeftWeight();break}if(t>e.getLength())throw new g(d.ErrInvalidArgument,`out of index range: pos: ${t} > node.length: ${e.getLength()}`);return this.splayNode(e),[e,t]}indexOf(t){return!t||t!==this.root&&!t.hasLinks()?-1:(this.splayNode(t),this.root.getLeftWeight())}getRoot(){return this.root}insert(t){return this.insertAfter(this.root,t)}insertAfter(t,e){return t?(this.splayNode(t),this.root=e,e.setRight(t.getRight()),t.hasRight()&&t.getRight().setParent(e),e.setLeft(t),t.setParent(e),t.setRight(),this.updateWeight(t),this.updateWeight(e),e):(this.root=e,e)}updateWeight(t){t.initWeight(),t.hasLeft()&&t.increaseWeight(t.getLeftWeight()),t.hasRight()&&t.increaseWeight(t.getRightWeight())}updateTreeWeight(t){for(;t;)this.updateWeight(t),t=t.getParent()}splayNode(t){if(t)for(;;)if(this.isLeftChild(t.getParent())&&this.isRightChild(t))this.rotateLeft(t),this.rotateRight(t);else if(this.isRightChild(t.getParent())&&this.isLeftChild(t))this.rotateRight(t),this.rotateLeft(t);else if(this.isLeftChild(t.getParent())&&this.isLeftChild(t))this.rotateRight(t.getParent()),this.rotateRight(t);else if(this.isRightChild(t.getParent())&&this.isRightChild(t))this.rotateLeft(t.getParent()),this.rotateLeft(t);else{this.isLeftChild(t)?this.rotateRight(t):this.isRightChild(t)&&this.rotateLeft(t),this.updateWeight(t);return}}delete(t){this.splayNode(t);const e=new Cn(t.getLeft());e.root&&e.root.setParent();const r=new Cn(t.getRight());if(r.root&&r.root.setParent(),e.root){const i=e.getRightmost();e.splayNode(i),e.root.setRight(r.root),r.root&&r.root.setParent(e.root),this.root=e.root}else this.root=r.root;t.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(t,e){if(!e){this.splayNode(t),this.cutOffRight(t);return}this.splayNode(t),this.splayNode(e),e.getLeft()!=t&&this.rotateRight(t),this.cutOffRight(t)}cutOffRight(t){const e=[];this.traversePostorder(t.getRight(),e);for(const r of e)r.initWeight();this.updateTreeWeight(t)}toTestString(){const t=[];return this.traverseInorder(this.root,t),t.map(e=>`[${e.getWeight()},${e.getLength()}]${e.getValue()||""}`).join("")}checkWeight(){const t=[];this.traverseInorder(this.root,t);for(const e of t)if(e.getWeight()!=e.getLength()+e.getLeftWeight()+e.getRightWeight())return!1;return!0}getRightmost(){let t=this.root;for(;t.hasRight();)t=t.getRight();return t}traverseInorder(t,e){t&&(this.traverseInorder(t.getLeft(),e),e.push(t),this.traverseInorder(t.getRight(),e))}traversePostorder(t,e){t&&(this.traversePostorder(t.getLeft(),e),this.traversePostorder(t.getRight(),e),e.push(t))}rotateLeft(t){const e=t.getParent();e.hasParent()?e===e.getParent().getLeft()?e.getParent().setLeft(t):e.getParent().setRight(t):this.root=t,t.setParent(e.getParent()),e.setRight(t.getLeft()),e.hasRight()&&e.getRight().setParent(e),t.setLeft(e),t.getLeft().setParent(t),this.updateWeight(e),this.updateWeight(t)}rotateRight(t){const e=t.getParent();e.hasParent()?e===e.getParent().getLeft()?e.getParent().setLeft(t):e.getParent().setRight(t):this.root=t,t.setParent(e.getParent()),e.setLeft(t.getRight()),e.hasLeft()&&e.getLeft().setParent(e),t.setRight(e),t.getRight().setParent(t),this.updateWeight(e),this.updateWeight(t)}isLeftChild(t){return t&&t.hasParent()?t.getParent().getLeft()===t:!1}isRightChild(t){return t&&t.hasParent()?t.getParent().getRight()===t:!1}}/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var xe=null;try{xe=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function B(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}B.prototype.__isLong__;Object.defineProperty(B.prototype,"__isLong__",{value:!0});function se(n){return(n&&n.__isLong__)===!0}function Fo(n){var t=Math.clz32(n&-n);return n?31-t:t}B.isLong=se;var zo={},qo={};function Wr(n,t){var e,r,i;return t?(n>>>=0,(i=0<=n&&n<256)&&(r=qo[n],r)?r:(e=J(n,0,!0),i&&(qo[n]=e),e)):(n|=0,(i=-128<=n&&n<128)&&(r=zo[n],r)?r:(e=J(n,n<0?-1:0,!1),i&&(zo[n]=e),e))}B.fromInt=Wr;function Ne(n,t){if(isNaN(n))return t?Sr:Re;if(t){if(n<0)return Sr;if(n>=Ja)return Ma}else{if(n<=-Ko)return ae;if(n+1>=Ko)return $a}return n<0?Ne(-n,t).neg():J(n%un|0,n/un|0,t)}B.fromNumber=Ne;function J(n,t,e){return new B(n,t,e)}B.fromBits=J;var Pi=Math.pow;function Us(n,t,e){if(n.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return t?Sr:Re;if(e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Us(n.substring(1),t,e).neg();for(var i=Ne(Pi(e,8)),s=Re,a=0;a<n.length;a+=8){var c=Math.min(8,n.length-a),l=parseInt(n.substring(a,a+c),e);if(c<8){var h=Ne(Pi(e,c));s=s.mul(h).add(Ne(l))}else s=s.mul(i),s=s.add(Ne(l))}return s.unsigned=t,s}B.fromString=Us;function Ce(n,t){return typeof n=="number"?Ne(n,t):typeof n=="string"?Us(n,t):J(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}B.fromValue=Ce;var Uo=65536,Gu=1<<24,un=Uo*Uo,Ja=un*un,Ko=Ja/2,Vo=Wr(Gu),Re=Wr(0);B.ZERO=Re;var Sr=Wr(0,!0);B.UZERO=Sr;var Qr=Wr(1);B.ONE=Qr;var Ra=Wr(1,!0);B.UONE=Ra;var Bs=Wr(-1);B.NEG_ONE=Bs;var $a=J(-1,2147483647,!1);B.MAX_VALUE=$a;var Ma=J(-1,-1,!0);B.MAX_UNSIGNED_VALUE=Ma;var ae=J(0,-2147483648,!1);B.MIN_VALUE=ae;var w=B.prototype;w.toInt=function(){return this.unsigned?this.low>>>0:this.low};w.toNumber=function(){return this.unsigned?(this.high>>>0)*un+(this.low>>>0):this.high*un+(this.low>>>0)};w.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ae)){var e=Ne(t),r=this.div(e),i=r.mul(e).sub(this);return r.toString(t)+i.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var s=Ne(Pi(t,6),this.unsigned),a=this,c="";;){var l=a.div(s),h=a.sub(l.mul(s)).toInt()>>>0,f=h.toString(t);if(a=l,a.isZero())return f+c;for(;f.length<6;)f="0"+f;c=""+f+c}};w.getHighBits=function(){return this.high};w.getHighBitsUnsigned=function(){return this.high>>>0};w.getLowBits=function(){return this.low};w.getLowBitsUnsigned=function(){return this.low>>>0};w.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ae)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&!(t&1<<e);e--);return this.high!=0?e+33:e+1};w.isSafeInteger=function(){var t=this.high>>21;return t?this.unsigned?!1:t===-1&&!(this.low===0&&this.high===-2097152):!0};w.isZero=function(){return this.high===0&&this.low===0};w.eqz=w.isZero;w.isNegative=function(){return!this.unsigned&&this.high<0};w.isPositive=function(){return this.unsigned||this.high>=0};w.isOdd=function(){return(this.low&1)===1};w.isEven=function(){return(this.low&1)===0};w.equals=function(t){return se(t)||(t=Ce(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};w.eq=w.equals;w.notEquals=function(t){return!this.eq(t)};w.neq=w.notEquals;w.ne=w.notEquals;w.lessThan=function(t){return this.comp(t)<0};w.lt=w.lessThan;w.lessThanOrEqual=function(t){return this.comp(t)<=0};w.lte=w.lessThanOrEqual;w.le=w.lessThanOrEqual;w.greaterThan=function(t){return this.comp(t)>0};w.gt=w.greaterThan;w.greaterThanOrEqual=function(t){return this.comp(t)>=0};w.gte=w.greaterThanOrEqual;w.ge=w.greaterThanOrEqual;w.compare=function(t){if(se(t)||(t=Ce(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};w.comp=w.compare;w.negate=function(){return!this.unsigned&&this.eq(ae)?ae:this.not().add(Qr)};w.neg=w.negate;w.add=function(t){se(t)||(t=Ce(t));var e=this.high>>>16,r=this.high&65535,i=this.low>>>16,s=this.low&65535,a=t.high>>>16,c=t.high&65535,l=t.low>>>16,h=t.low&65535,f=0,m=0,y=0,p=0;return p+=s+h,y+=p>>>16,p&=65535,y+=i+l,m+=y>>>16,y&=65535,m+=r+c,f+=m>>>16,m&=65535,f+=e+a,f&=65535,J(y<<16|p,f<<16|m,this.unsigned)};w.subtract=function(t){return se(t)||(t=Ce(t)),this.add(t.neg())};w.sub=w.subtract;w.multiply=function(t){if(this.isZero())return this;if(se(t)||(t=Ce(t)),xe){var e=xe.mul(this.low,this.high,t.low,t.high);return J(e,xe.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Sr:Re;if(this.eq(ae))return t.isOdd()?ae:Re;if(t.eq(ae))return this.isOdd()?ae:Re;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Vo)&&t.lt(Vo))return Ne(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,i=this.high&65535,s=this.low>>>16,a=this.low&65535,c=t.high>>>16,l=t.high&65535,h=t.low>>>16,f=t.low&65535,m=0,y=0,p=0,S=0;return S+=a*f,p+=S>>>16,S&=65535,p+=s*f,y+=p>>>16,p&=65535,p+=a*h,y+=p>>>16,p&=65535,y+=i*f,m+=y>>>16,y&=65535,y+=s*h,m+=y>>>16,y&=65535,y+=a*l,m+=y>>>16,y&=65535,m+=r*f+i*h+s*l+a*c,m&=65535,J(p<<16|S,m<<16|y,this.unsigned)};w.mul=w.multiply;w.divide=function(t){if(se(t)||(t=Ce(t)),t.isZero())throw Error("division by zero");if(xe){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?xe.div_u:xe.div_s)(this.low,this.high,t.low,t.high);return J(e,xe.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Sr:Re;var r,i,s;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Sr;if(t.gt(this.shru(1)))return Ra;s=Sr}else{if(this.eq(ae)){if(t.eq(Qr)||t.eq(Bs))return ae;if(t.eq(ae))return Qr;var a=this.shr(1);return r=a.div(t).shl(1),r.eq(Re)?t.isNegative()?Qr:Bs:(i=this.sub(t.mul(r)),s=r.add(i.div(t)),s)}else if(t.eq(ae))return this.unsigned?Sr:Re;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=Re}for(i=this;i.gte(t);){r=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(r)/Math.LN2),l=c<=48?1:Pi(2,c-48),h=Ne(r),f=h.mul(t);f.isNegative()||f.gt(i);)r-=l,h=Ne(r,this.unsigned),f=h.mul(t);h.isZero()&&(h=Qr),s=s.add(h),i=i.sub(f)}return s};w.div=w.divide;w.modulo=function(t){if(se(t)||(t=Ce(t)),xe){var e=(this.unsigned?xe.rem_u:xe.rem_s)(this.low,this.high,t.low,t.high);return J(e,xe.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};w.mod=w.modulo;w.rem=w.modulo;w.not=function(){return J(~this.low,~this.high,this.unsigned)};w.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};w.clz=w.countLeadingZeros;w.countTrailingZeros=function(){return this.low?Fo(this.low):Fo(this.high)+32};w.ctz=w.countTrailingZeros;w.and=function(t){return se(t)||(t=Ce(t)),J(this.low&t.low,this.high&t.high,this.unsigned)};w.or=function(t){return se(t)||(t=Ce(t)),J(this.low|t.low,this.high|t.high,this.unsigned)};w.xor=function(t){return se(t)||(t=Ce(t)),J(this.low^t.low,this.high^t.high,this.unsigned)};w.shiftLeft=function(t){return se(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?J(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):J(0,this.low<<t-32,this.unsigned)};w.shl=w.shiftLeft;w.shiftRight=function(t){return se(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?J(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):J(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};w.shr=w.shiftRight;w.shiftRightUnsigned=function(t){return se(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?J(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?J(this.high,0,this.unsigned):J(this.high>>>t-32,0,this.unsigned)};w.shru=w.shiftRightUnsigned;w.shr_u=w.shiftRightUnsigned;w.rotateLeft=function(t){var e;return se(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?J(this.high,this.low,this.unsigned):t<32?(e=32-t,J(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,J(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))};w.rotl=w.rotateLeft;w.rotateRight=function(t){var e;return se(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?J(this.high,this.low,this.unsigned):t<32?(e=32-t,J(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,J(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))};w.rotr=w.rotateRight;w.toSigned=function(){return this.unsigned?J(this.low,this.high,!1):this};w.toUnsigned=function(){return this.unsigned?this:J(this.low,this.high,!0)};w.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};w.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};w.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};B.fromBytes=function(t,e,r){return r?B.fromBytesLE(t,e):B.fromBytesBE(t,e)};B.fromBytesLE=function(t,e){return new B(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};B.fromBytesBE=function(t,e){return new B(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};typeof BigInt=="function"&&(B.fromBigInt=function(t,e){var r=Number(BigInt.asIntN(32,t)),i=Number(BigInt.asIntN(32,t>>BigInt(32)));return J(r,i,e)},B.fromValue=function(t,e){return typeof t=="bigint"?B.fromBigInt(t,e):Ce(t,e)},w.toBigInt=function(){var t=BigInt(this.low>>>0),e=BigInt(this.unsigned?this.high>>>0:this.high);return e<<BigInt(32)|t});var M=(n=>(n[n.Null=0]="Null",n[n.Boolean=1]="Boolean",n[n.Integer=2]="Integer",n[n.Long=3]="Long",n[n.Double=4]="Double",n[n.String=5]="String",n[n.Bytes=6]="Bytes",n[n.Date=7]="Date",n))(M||{});class K extends Jn{constructor(e,r){super(r);o(this,"valueType");o(this,"value");this.valueType=K.getPrimitiveType(e),this.value=e===void 0?null:e}static of(e,r){return new K(e,r)}static valueFromBytes(e,r){switch(e){case 0:return null;case 1:return!!r[0];case 2:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 4:{const i=new DataView(r.buffer);return r.forEach(function(s,a){i.setUint8(a,s)}),i.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(r);case 3:return B.fromBytesLE(Array.from(r));case 6:return r;case 7:return new Date(B.fromBytesLE(Array.from(r),!0).toNumber());default:throw new g(d.ErrUnimplemented,`unimplemented type: ${e}`)}}getValueSize(){switch(this.valueType){case 0:return 8;case 1:return 4;case 2:return 4;case 3:return 8;case 4:return 8;case 5:return this.value.length*2;case 6:return this.value.length;case 7:return 8;default:throw new g(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}getDataSize(){return{data:this.getValueSize(),meta:this.getMetaUsage()}}toJSON(){return this.valueType===5?`"${He(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const e=K.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(e)?2:4;case"string":return 5;case"object":if(e===null)return 0;if(e instanceof B)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return K.getPrimitiveType(e)!==void 0}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===2||e===3||e===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 4:{const e=this.value,r=new Uint8Array(8);return new DataView(r.buffer).setFloat64(0,e,!0),r}case 5:return new TextEncoder().encode(this.value);case 3:{const r=this.value.toBytesLE();return Uint8Array.from(r)}case 6:return this.value;case 7:{const e=this.value,r=B.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(r)}default:throw new g(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class Ci extends La{constructor(e){super(e);o(this,"prev");o(this,"next");o(this,"movedFrom");this.value=e}static createAfter(e,r){const i=new Ci(r),s=e.next;return e.next=i,i.prev=e,i.next=s,s&&(s.prev=i),i}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getMovedFrom(){return this.movedFrom}setMovedFrom(e){this.movedFrom=e}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class Dn{constructor(){o(this,"dummyHead");o(this,"last");o(this,"nodeMapByIndex");o(this,"nodeMapByCreatedAt");const t=K.of(0,an);t.setRemovedAt(an),this.dummyHead=new Ci(t),this.last=this.dummyHead,this.nodeMapByIndex=new Cn,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new Dn}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(t,e){let r=this.nodeMapByCreatedAt.get(t.toIDString());if(!r)throw new g(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);for(;r.getValue().getMovedAt()&&r.getValue().getMovedAt().after(e)&&r.getMovedFrom();)r=r.getMovedFrom();for(;r.getNext()&&r.getNext().getPositionedAt().after(e);)r=r.getNext();return r}release(t){this.last===t&&(this.last=t.getPrev()),t.release(),this.nodeMapByIndex.delete(t),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}insertAfter(t,e,r=e.getCreatedAt()){const i=this.findNextBeforeExecutedAt(t,r),s=Ci.createAfter(i,e);return i===this.last&&(this.last=s),this.nodeMapByIndex.insertAfter(i,s),this.nodeMapByCreatedAt.set(s.getCreatedAt().toIDString(),s),s}moveAfter(t,e,r){let i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new g(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);let s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new g(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);if(i!==s&&r.after(s.getPositionedAt())){const a=s.getPrev();let c=s.getNext();for(this.release(s),s=this.insertAfter(i.getCreatedAt(),s.getValue(),r),s.getValue().setMovedAt(r),s.setMovedFrom(a);c&&c.getPositionedAt().after(r);)i=s,s=c,c=s.getNext(),this.release(s),s=this.insertAfter(i.getCreatedAt(),s.getValue(),r),s.getValue().setMovedAt(r),s.setMovedFrom(a)}}insert(t){this.insertAfter(this.last.getCreatedAt(),t)}getByID(t){return this.nodeMapByCreatedAt.get(t.toIDString())}subPathOf(t){const e=this.nodeMapByCreatedAt.get(t.toIDString());if(e)return String(this.nodeMapByIndex.indexOf(e))}purge(t){const e=this.nodeMapByCreatedAt.get(t.getCreatedAt().toIDString());if(!e)throw new g(d.ErrInvalidArgument,`fail to find the given createdAt: ${t.getCreatedAt().toIDString()}`);this.release(e)}getByIndex(t){if(t>=this.length)return;const[e,r]=this.nodeMapByIndex.find(t);let i=e;if(t===0&&e===this.dummyHead||r>0)do i&&(i=i.getNext());while(i&&i.isRemoved());return i}getPrevCreatedAt(t){let e=this.nodeMapByCreatedAt.get(t.toIDString());do e=e.getPrev();while(this.dummyHead!==e&&e.isRemoved());return e.getValue().getCreatedAt()}delete(t,e){const r=this.nodeMapByCreatedAt.get(t.toIDString()),i=r.isRemoved();return r.remove(e)&&!i&&this.nodeMapByIndex.splayNode(r),r.getValue()}set(t,e,r){const i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new g(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);return this.insertAfter(i.getCreatedAt(),e,r),this.delete(t,r)}deleteByIndex(t,e){const r=this.getByIndex(t);if(r)return r.remove(e)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const t=[];for(const e of this){const r=`${e.getCreatedAt().toIDString()}:${e.getValue().toJSON()}`;e.isRemoved()?t.push(`{${r}}`):t.push(`[${r}]`)}return t.join("")}*[Symbol.iterator](){let t=this.dummyHead.getNext();for(;t;)yield t,t=t.getNext()}}class ie extends Dr{constructor(e,r){super(e);o(this,"elements");this.elements=r}static create(e,r){if(!r)return new ie(e,Dn.create());const i=Dn.create();for(const s of r)i.insertAfter(i.getLastCreatedAt(),s.deepcopy());return new ie(e,i)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,r,i){this.elements.insertAfter(e,r,i)}moveAfter(e,r,i){this.elements.moveAfter(e,r,i)}get(e){const r=this.elements.getByIndex(e);return r==null?void 0:r.getValue()}getByID(e){const r=this.elements.getByID(e);return r==null?void 0:r.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,r){return this.elements.delete(e,r)}deleteByIndex(e,r){return this.elements.deleteByIndex(e,r)}set(e,r,i){return this.elements.set(e,r,i)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(const r of this.elements){const i=r.getValue();if(e(i,this))return;i instanceof Dr&&i.getDescendants(e)}}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const e=[];for(const r of this)e.push(r.toJSON());return`[${e.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(let r=0;r<this.length;r++){const{createdAt:i,value:s,type:a}=this.get(r).toJSForTest();e[r]={key:String(r),createdAt:i,value:s,type:a}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const e=ie.create(this.getCreatedAt());for(const r of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),r.getValue().deepcopy());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}}class Lr extends ze{constructor(e,r,i,s){super(e,s);o(this,"prevCreatedAt");o(this,"value");this.prevCreatedAt=r,this.value=i}static create(e,r,i,s){return new Lr(e,r,i,s)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ie))throw new g(d.ErrInvalidArgument,"fail to execute, only array can execute add");const i=r,s=this.value.deepcopy();return i.insertAfter(this.prevCreatedAt,s,this.getExecutedAt()),e.registerElement(s,i),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(i.subPathOf(this.getEffectedCreatedAt()))}],reverseOp:this.toReverseOperation()}}toReverseOperation(){return _e.create(this.getParentCreatedAt(),this.value.getCreatedAt())}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}setPrevCreatedAt(e){this.prevCreatedAt=e}}class _e extends ze{constructor(e,r,i){super(e,i);o(this,"createdAt");this.createdAt=r}static create(e,r,i){return new _e(e,r,i)}execute(e,r){var h;const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof Dr))throw new g(d.ErrInvalidArgument,`only object and array can execute remove: ${i}`);if(r===q.UndoRedo){let f=i.getByID(this.createdAt);for(;f;){if(f.getRemovedAt())return;f=(h=e.findElementPairByCreatedAt(f.getCreatedAt()))==null?void 0:h.parent}}const s=i.subPathOf(this.createdAt),a=this.toReverseOperation(i),c=i.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(c),{opInfos:i instanceof ie?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(s)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:s}],reverseOp:a}}toReverseOperation(e){if(e instanceof ie){const r=e.getByID(this.createdAt);if(r!==void 0){const i=e.getPrevCreatedAt(this.createdAt);return Lr.create(this.getParentCreatedAt(),i,r.deepcopy())}}if(e instanceof ne){const r=e.subPathOf(this.createdAt);if(r!==void 0){const i=e.get(r);if(i!==void 0)return jr.create(r,i.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}setCreatedAt(e){this.createdAt=e}}class jr extends ze{constructor(e,r,i,s){super(i,s);o(this,"key");o(this,"value");this.key=e,this.value=r}static create(e,r,i,s){return new jr(e,r,i,s)}execute(e,r){var h;const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof ne))throw new g(d.ErrInvalidArgument,"fail to execute, only object can execute set");if(r===q.UndoRedo){let f=i;for(;f;){if(f.getRemovedAt())return;f=(h=e.findElementPairByCreatedAt(f.getCreatedAt()))==null?void 0:h.parent}}const s=i.get(this.key),a=this.toReverseOperation(s),c=this.value.deepcopy(),l=i.set(this.key,c,this.getExecutedAt());return r===q.UndoRedo&&e.findByCreatedAt(c.getCreatedAt())&&e.deregisterElement(c),e.registerElement(c,i),l&&e.registerRemovedElement(l),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:a}}toReverseOperation(e){let r=_e.create(this.getParentCreatedAt(),this.value.getCreatedAt());return e!==void 0&&!e.isRemoved()&&(r=jr.create(this.key,e.deepcopy(),this.getParentCreatedAt())),r}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class $e extends ze{constructor(e,r,i,s){super(e,s);o(this,"prevCreatedAt");o(this,"createdAt");this.prevCreatedAt=r,this.createdAt=i}static create(e,r,i,s){return new $e(e,r,i,s)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ie))throw new g(d.ErrInvalidArgument,"fail to execute, only array can execute move");const i=r,s=this.toReverseOperation(i),a=Number(i.subPathOf(this.createdAt));i.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const c=Number(i.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:c,previousIndex:a}],reverseOp:s}}toReverseOperation(e){const r=e.getPrevCreatedAt(this.createdAt);return $e.create(this.getParentCreatedAt(),r,this.createdAt)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}setPrevCreatedAt(e){this.prevCreatedAt=e}setCreatedAt(e){this.createdAt=e}}class Pr{constructor(t,e,r,i){o(this,"key");o(this,"value");o(this,"updatedAt");o(this,"_isRemoved");this.key=t,this.value=e,this.updatedAt=r,this._isRemoved=i}static of(t,e,r,i){return new Pr(t,e,r,i)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}getDataSize(){return{data:(this.key.length+this.value.length)*2,meta:Ye}}}class Ar{constructor(){o(this,"nodeMapByKey");o(this,"numberOfRemovedElement");this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new Ar}getNodeMapByKey(){return this.nodeMapByKey}set(t,e,r){const i=this.nodeMapByKey.get(t);if(i&&i.isRemoved()&&r.after(i.getUpdatedAt())&&(this.numberOfRemovedElement-=1),i===void 0||r.after(i.getUpdatedAt())){const s=Pr.of(t,e,r,!1);return this.nodeMapByKey.set(t,s),i!==void 0&&i.isRemoved()?[i,s]:[void 0,s]}return i.isRemoved()?[i,void 0]:[void 0,void 0]}setInternal(t,e,r,i){const s=Pr.of(t,e,r,i);this.nodeMapByKey.set(t,s),i&&this.numberOfRemovedElement++}remove(t,e){const r=this.nodeMapByKey.get(t),i=[];if(r===void 0||e.after(r.getUpdatedAt())){if(r===void 0){this.numberOfRemovedElement+=1;const c=Pr.of(t,"",e,!0);return this.nodeMapByKey.set(t,c),i.push(c),i}const s=r.isRemoved();s||(this.numberOfRemovedElement+=1),s&&i.push(r);const a=Pr.of(t,r.getValue(),e,!0);return this.nodeMapByKey.set(t,a),i.push(a),i}return i}has(t){if(this.nodeMapByKey.has(t)){const e=this.nodeMapByKey.get(t);return e!==void 0&&!e.isRemoved()}return!1}get(t){if(this.nodeMapByKey.has(t))return this.nodeMapByKey.get(t).getValue()}deepcopy(){const t=new Ar;for(const[,e]of this.nodeMapByKey)t.setInternal(e.getKey(),e.getValue(),e.getUpdatedAt(),e.isRemoved());return t}toJSON(){if(!this.size())return"{}";const t=[];for(const[e,r]of this.nodeMapByKey)r.isRemoved()||t.push(`"${He(e)}":"${He(r.getValue())}"`);return`{${t.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const t={};for(const[e,r]of this.nodeMapByKey)r.isRemoved()||(t[e]=r.getValue());return t}*[Symbol.iterator](){for(const[,t]of this.nodeMapByKey)yield t}purge(t){const e=this.nodeMapByKey.get(t.getKey());e==null||e.toIDString()!=t.toIDString()||(this.nodeMapByKey.delete(t.getKey()),this.numberOfRemovedElement--)}}function Be(n){if(n instanceof Map){const t=Array.from(n);return new Map(JSON.parse(JSON.stringify(t)))}return JSON.parse(JSON.stringify(n))}const Fa=n=>n?Object.entries(n).length===0:!0,ln=n=>{const t={};for(const[e,r]of Object.entries(n))t[e]=JSON.stringify(r);return t},br=n=>{const t={};for(const[e,r]of Object.entries(n))t[e]=JSON.parse(r);return t};function Hu(n){return n?jo(n.live)+jo(n.gc):0}function jo(n){return n.data+n.meta}function te(n,...t){for(const e of t)n.data+=e.data,n.meta+=e.meta}function zr(n,t){n.data-=t.data,n.meta-=t.meta}class Bn{constructor(t){o(this,"attributes");o(this,"content");this.attributes=Ar.create(),this.content=t}static create(t){return new Bn(t)}get length(){return this.content.length}substring(t,e){const r=new Bn(this.content.substring(t,e));return r.attributes=this.attributes.deepcopy(),r}setAttr(t,e,r){return this.attributes.set(t,e,r)}getAttrs(){return this.attributes}toString(){return this.content}getDataSize(){const t={data:0,meta:0};t.data+=this.content.length*2;for(const e of this.attributes){const r=e.getDataSize();t.meta+=r.meta,t.data+=r.data}return t}toJSON(){const t=He(this.content),e=this.attributes.toObject(),r=[];for(const[i,s]of Object.entries(e)){const a=JSON.parse(s),c=typeof a=="string"?`"${He(i)}":"${He(a)}"`:`"${He(i)}":${String(a)}`;r.push(c)}return r.sort(),r.length===0?`{"val":"${t}"}`:`{"attrs":{${r.join(",")}},"val":"${t}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(t){this.attributes&&t instanceof Pr&&this.attributes.purge(t)}getGCPairs(){const t=[];for(const e of this.attributes)e.getRemovedAt()&&t.push({parent:this,child:e});return t}}class fe extends Jn{constructor(e,r){super(r);o(this,"rgaTreeSplit");this.rgaTreeSplit=e}static create(e,r){return new fe(e,r)}edit(e,r,i,s,a){const c=r?Bn.create(r):void 0;if(c&&s)for(const[p,S]of Object.entries(s))c.setAttr(p,S,i);const[l,h,f,m]=this.rgaTreeSplit.edit(e,i,c,a);return[m.map(p=>({...p,value:p.value?{attributes:br(p.value.getAttributes()),content:p.value.getContent()}:{attributes:void 0,content:""},type:"content"})),h,f,[l,l]]}setStyle(e,r,i,s){const a={data:0,meta:0},[,c,l]=this.rgaTreeSplit.findNodeWithSplit(e[1],i),[,h,f]=this.rgaTreeSplit.findNodeWithSplit(e[0],i);te(a,c,h);const m=[],y=this.rgaTreeSplit.findBetween(f,l),p=[];for(const b of y){const A=b.getCreatedAt().getActorID();let N=Ds;s!=null&&(N=s.get(A)?s.get(A):0n),b.canStyle(i,N)&&p.push(b)}const S=[];for(const b of p){if(b.isRemoved())continue;const[A,N]=this.rgaTreeSplit.findIndexesFromRange(b.createPosRange());m.push({type:"style",actor:i.getActorID(),from:A,to:N,value:{attributes:br(r)}});for(const[L,F]of Object.entries(r)){const[z]=b.getValue().setAttr(L,F,i);z!==void 0&&S.push({parent:b.getValue(),child:z});const Y=b.getValue().getAttrs().getNodeMapByKey().get(L);Y!==void 0&&te(a,Y.getDataSize())}}return[S,a,m]}indexRangeToPosRange(e,r){const i=this.rgaTreeSplit.indexToPos(e);return e===r?[i,i]:[i,this.rgaTreeSplit.indexToPos(r)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}getDataSize(){const e={data:0,meta:0};for(const r of this.rgaTreeSplit){if(r.isRemoved())continue;const i=r.getDataSize();e.data+=i.data,e.meta+=i.meta}return{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){const e=[];for(const r of this.rgaTreeSplit)r.isRemoved()||e.push(r.getValue().toJSON());return`[${e.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const e=[];for(const r of this.rgaTreeSplit)if(!r.isRemoved()){const i=r.getValue();e.push({attributes:br(i.getAttributes()),content:i.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const e=new fe(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){const e=[];for(const r of this.rgaTreeSplit){r.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:r});for(const i of r.getValue().getGCPairs())e.push(i)}return e}}class Rn extends ze{constructor(e,r,i,s,a,c){super(e,c);o(this,"fromPos");o(this,"toPos");o(this,"content");o(this,"attributes");this.fromPos=r,this.toPos=i,this.content=s,this.attributes=a}static create(e,r,i,s,a,c){return new Rn(e,r,i,s,a,c)}execute(e,r,i){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof fe))throw new g(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const a=s,[c,l,h]=a.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),i);e.acc(h);for(const f of l)e.registerGCPair(f);return{opInfos:c.map(({from:f,to:m,value:y})=>({type:"edit",from:f,to:m,value:y,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),i=this.toPos.toTestString(),s=this.content;return`${e}.EDIT(${r},${i},${s})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}}class $n extends ze{constructor(e,r,i,s,a){super(e,a);o(this,"fromPos");o(this,"toPos");o(this,"attributes");this.fromPos=r,this.toPos=i,this.attributes=s}static create(e,r,i,s,a){return new $n(e,r,i,s,a)}execute(e,r,i){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof fe))throw new g(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const a=s,[c,l,h]=a.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),i);e.acc(l);for(const f of c)e.registerGCPair(f);return{opInfos:h.map(({from:f,to:m,value:y})=>({type:"style",from:f,to:m,value:y,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),i=this.toPos.toTestString(),s=this.attributes;return`${e}.STYL(${r},${i},${JSON.stringify(s)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}}const Yu=2,Xu="root",Xe="text";function mn(n,t,e=!1){let r=0;const i=e?n.allChildren:n.children;for(let s=0;s<t;s++){const a=i[s];!a||!e&&a.isRemoved||(r+=a.paddedSize(e))}return r}class Zu{constructor(t,e=[]){o(this,"type");o(this,"parent");o(this,"_children");o(this,"visibleSize");o(this,"totalSize");if(this.type=t,this.visibleSize=0,this.totalSize=0,this._children=e,this.isText&&this._children.length>0)throw new g(d.ErrRefused,"Text node cannot have children")}updateAncestorsSize(t,e=!1){let r=this.parent;for(;r;){if(e)r.totalSize+=t;else if(r.visibleSize+=t,r.isRemoved)break;r=r.parent}}updateDescendantsSize(t=!1){let e=0;for(const r of this._children){const i=r.updateDescendantsSize(t);!t&&r.isRemoved||(e+=i)}return t?this.totalSize+=e:this.visibleSize+=e,this.paddedSize(t)}get isText(){return this.type===Xe}paddedSize(t=!1){let e=this.visibleSize;return t&&(e=this.totalSize),this.isText||(e+=Yu),e}isAncestorOf(t){return Qu(this,t)}get nextSibling(){const t=this.parent.findOffset(this),e=this.parent.children[t+1];if(e)return e}get prevSibling(){const t=this.parent.findOffset(this),e=this.parent.children[t-1];if(e)return e}splitText(t,e){const r={data:0,meta:0};if(t===0||t===this.visibleSize)return[void 0,r];const i=this.value.slice(0,t),s=this.value.slice(t);if(!s.length)return[void 0,r];const a=this.getDataSize();this.value=i;const c=this.cloneText(t+e);return c.value=s,this.parent.insertAfterInternal(c,this),te(r,this.getDataSize(),c.getDataSize()),zr(r,a),[c,r]}get children(){return this._children.filter(t=>!t.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(t=>t.isText)}getChildrenText(){return this.isText?this.value:this.hasTextChild()?this.children.map(t=>t.value).join(""):""}append(...t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this._children.push(...t);for(const e of t)e.parent=this,e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}prepend(...t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this._children.unshift(...t);for(const e of t)e.parent=this}insertBefore(t,e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(e);if(r===-1)throw new g(d.ErrInvalidArgument,"child not found");this.insertAtInternal(t,r),t.updateAncestorsSize(t.paddedSize()),t.updateAncestorsSize(t.paddedSize(!0),!0)}insertAfter(t,e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(e);if(r===-1)throw new g(d.ErrInvalidArgument,"child not found");this.insertAtInternal(t,r+1),t.updateAncestorsSize(t.paddedSize()),t.updateAncestorsSize(t.paddedSize(!0),!0)}insertAt(t,e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this.insertAtInternal(t,e),t.updateAncestorsSize(t.paddedSize()),t.updateAncestorsSize(t.paddedSize(!0),!0)}removeChild(t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const e=this._children.indexOf(t);if(e===-1)throw new g(d.ErrInvalidArgument,"child not found");this._children.splice(e,1),t.updateAncestorsSize(-t.paddedSize(!0),!0),t.parent=void 0}splitElement(t,e){const r={data:0,meta:0},i=this.getDataSize(),s=this.cloneElement(e);this.parent.insertAfterInternal(s,this),s.updateAncestorsSize(s.paddedSize()),s.updateAncestorsSize(s.paddedSize(!0),!0);const a=this.children.slice(0,t),c=this.children.slice(t);this._children=a,s._children=c,this.visibleSize=this._children.reduce((l,h)=>l+h.paddedSize(),0),this.totalSize=this._children.reduce((l,h)=>l+h.paddedSize(!0),0),s.visibleSize=s._children.reduce((l,h)=>l+h.paddedSize(!0),0),s.totalSize=s._children.reduce((l,h)=>l+h.paddedSize(!0),0);for(const l of s._children)l.parent=s;return te(r,this.getDataSize(),s.getDataSize()),zr(r,i),[s,r]}insertAfterInternal(t,e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(e);if(r===-1)throw new g(d.ErrInvalidArgument,"child not found");this.insertAtInternal(t,r+1)}insertAtInternal(t,e){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");this._children.splice(e,0,t),t.parent=this}findOffset(t,e=!1){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");if(e)return this._children.indexOf(t);if(t.isRemoved){const r=this._children.indexOf(t);return this.allChildren.splice(0,r).filter(s=>!s.isRemoved).length}return this.children.indexOf(t)}findBranchOffset(t){if(this.isText)throw new g(d.ErrRefused,"Text node cannot have children");let e=t;for(;e;){const r=this._children.indexOf(e);if(r!==-1)return r;e=e.parent}return-1}}function Qu(n,t){if(n===t)return!1;for(;t.parent;){if(t.parent===n)return!0;t=t.parent}return!1}var G=(n=>(n.Start="Start",n.End="End",n.Text="Text",n))(G||{});function za(n,t,e,r,i=!1){if(t>e)throw new g(d.ErrInvalidArgument,`from is greater than to: ${t} > ${e}`);const s=i?n.totalSize:n.visibleSize;if(t>s)throw new g(d.ErrInvalidArgument,`from is out of range: ${t} > ${s}`);if(e>s)throw new g(d.ErrInvalidArgument,`to is out of range: ${e} > ${s}`);if(t===e)return;let a=0;const c=i?n._children:n.children;for(const l of c){if(t-l.paddedSize(i)<a&&a<e){const h=l.isText?t-a:t-a-1,f=l.isText?e-a:e-a-1,m=i?l.totalSize:l.visibleSize,y=!l.isText&&h<0,p=!l.isText&&f>m;(l.isText||y)&&r([l,l.isText?"Text":"Start"],p),za(l,Math.max(0,h),Math.min(f,m),r,i),p&&r([l,"End"],p)}a+=l.paddedSize(i)}}function qa(n,t,e=0){for(const r of n.children)qa(r,t,e+1);t(n,e)}function Mi(n,t,e=0){for(const r of n._children)Mi(r,t,e+1);t(n,e)}function Os(n,t,e=!0){if(t>n.visibleSize)throw new g(d.ErrInvalidArgument,`index is out of range: ${t} > ${n.visibleSize}`);if(n.isText)return{node:n,offset:t};let r=0,i=0;for(const s of n.children){if(e&&s.isText&&s.visibleSize>=t-i)return Os(s,t-i,e);if(t===i)return{node:n,offset:r};if(!e&&s.paddedSize()===t-i)return{node:n,offset:r+1};if(s.paddedSize()>t-i)return Os(s,t-i-1,e);i+=s.paddedSize(),r+=1}return{node:n,offset:r}}function Ua(n){return n.isText||n.children.length===0?n:Ua(n.children[0])}function _u(n,t){if(n.visibleSize<t)throw new g(d.ErrInvalidArgument,"unacceptable path");for(let e=0;e<n.children.length;e++){const r=n.children[e];if(r.visibleSize<t)t-=r.visibleSize;else{n=r;break}}return{node:n,offset:t}}class el{constructor(t){o(this,"root");this.root=t}tokensBetween(t,e,r,i=!1){za(this.root,t,e,r,i)}traverse(t){qa(this.root,t,0)}traverseAll(t){Mi(this.root,t,0)}findTreePos(t,e=!0){return Os(this.root,t,e)}treePosToPath(t){const e=[];let r=t.node;if(r.isText){const i=r.parent.findOffset(r);if(i===-1)throw new g(d.ErrInvalidArgument,"invalid treePos");const s=mn(r.parent,i);e.push(s+t.offset),r=r.parent}else if(r.hasTextChild()){const i=mn(r,t.offset);e.push(i)}else e.push(t.offset);for(;r.parent;){const i=r.parent.findOffset(r);if(i===-1)throw new g(d.ErrInvalidArgument,"invalid treePos");e.push(i),r=r.parent}return e.reverse()}pathToIndex(t){const e=this.pathToTreePos(t);return this.indexOf(e)}pathToTreePos(t){if(!t.length)throw new g(d.ErrInvalidArgument,"unacceptable path");let e=this.root;for(let r=0;r<t.length-1;r++){const i=t[r];if(e=e.children[i],!e)throw new g(d.ErrInvalidArgument,"unacceptable path")}if(e.hasTextChild())return _u(e,t[t.length-1]);if(e.children.length<t[t.length-1])throw new g(d.ErrInvalidArgument,"unacceptable path");return{node:e,offset:t[t.length-1]}}getRoot(){return this.root}get size(){return this.root.visibleSize}findPostorderRight(t){const{node:e,offset:r}=t;if(e.isText){if(e.visibleSize===r){const i=e.nextSibling;return i||e.parent}return e}return e.children.length===r?e:Ua(e.children[r])}indexOf(t,e=!1){let{node:r}=t;const{offset:i}=t;let s=0,a=1;if(r.isText){s+=i;const c=r.parent,l=c.findOffset(r,e);if(l===-1)throw new g(d.ErrInvalidArgument,"invalid pos");s+=mn(c,l,e),r=r.parent}else s+=mn(r,i,e);for(;r!=null&&r.parent;){const c=r.parent,l=c.findOffset(r,e);if(l===-1)throw new g(d.ErrInvalidArgument,"invalid pos");s+=mn(c,l,e),a++,r=r.parent}return s+a-1}indexToPath(t){const e=this.findTreePos(t);return this.treePosToPath(e)}}const tl=(n,t)=>n===t?0:n<t?-1:1;class rl{constructor(t,e,r){o(this,"key");o(this,"value");o(this,"parent");o(this,"left");o(this,"right");o(this,"isRed");this.key=t,this.value=e,this.isRed=r}}class nl{constructor(t){o(this,"stack");this.stack=[],this.traverseInorder(t)}traverseInorder(t){t&&(this.traverseInorder(t.left),this.stack.push({key:t.key,value:t.value}),this.traverseInorder(t.right))}}class Ka{constructor(t){o(this,"root");o(this,"comparator");o(this,"counter");this.comparator=typeof t<"u"?t:tl,this.counter=0}put(t,e){return this.root=this.putInternal(t,e,this.root),this.root.isRed=!1,e}get(t){const e=this.getInternal(t,this.root);return e?e.value:void 0}remove(t){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,t),this.root&&(this.root.isRed=!1)}getIterator(){return new nl(this.root)}values(){const t=[];for(const e of this.getIterator().stack)t.push(e.value);return t}floorEntry(t){let e=this.root;for(;e;){const r=this.comparator(t,e.key);if(r>0)if(e.right)e.right.parent=e,e=e.right;else return e;else if(r<0)if(e.left)e.left.parent=e,e=e.left;else{let i=e.parent,s=e;for(;i&&s===i.left;)s=i,i=i.parent;return i}else return e}}lastEntry(){if(!this.root)return this.root;let t=this.root;for(;t.right;)t=t.right;return t}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(t,e){for(;e;){const r=this.comparator(t,e.key);if(r===0)return e;r<0?e=e.left:r>0&&(e=e.right)}}putInternal(t,e,r){if(!r)return this.counter+=1,new rl(t,e,!0);const i=this.comparator(t,r.key);return i<0?r.left=this.putInternal(t,e,r.left):i>0?r.right=this.putInternal(t,e,r.right):r.value=e,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(t,e){if(this.comparator(e,t.key)<0)!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.removeInternal(t.left,e);else{if(this.isRed(t.left)&&(t=this.rotateRight(t)),this.comparator(e,t.key)===0&&!t.right){this.counter-=1;return}if(!this.isRed(t.right)&&!this.isRed(t.right.left)&&(t=this.moveRedRight(t)),this.comparator(e,t.key)===0){this.counter-=1;const r=this.min(t.right);t.value=r.value,t.key=r.key,t.right=this.removeMin(t.right)}else t.right=this.removeInternal(t.right,e)}return this.fixUp(t)}min(t){return t.left?this.min(t.left):t}removeMin(t){if(t.left)return!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.removeMin(t.left),this.fixUp(t)}fixUp(t){return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t}moveRedLeft(t){return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(t){return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}isRed(t){return t&&t.isRed}rotateLeft(t){const e=t.right;return t.right=e.left,e.left=t,e.isRed=e.left.isRed,e.left.isRed=!0,e}rotateRight(t){const e=t.left;return t.left=e.right,e.right=t,e.isRed=e.right.isRed,e.right.isRed=!0,e}flipColors(t){t.isRed=!t.isRed,t.left.isRed=!t.left.isRed,t.right.isRed=!t.right.isRed}}class Me{constructor(t,e){o(this,"parentID");o(this,"leftSiblingID");this.parentID=t,this.leftSiblingID=e}static of(t,e){return new Me(t,e)}static fromTreePos(t){const{offset:e}=t;let{node:r}=t,i;return r.isText?(r.parent.children[0]===r&&e===0?i=r.parent:i=r,r=r.parent):e===0?i=r:i=r.children[e-1],Me.of(r.id,re.of(i.getCreatedAt(),i.getOffset()+e))}getParentID(){return this.parentID}static fromStruct(t){return Me.of(re.of(Pe.fromStruct(t.parentID.createdAt),t.parentID.offset),re.of(Pe.fromStruct(t.leftSiblingID.createdAt),t.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(t){const e=this.getParentID(),r=this.getLeftSiblingID(),i=t.findFloorNode(e);let s=t.findFloorNode(r);if(!i||!s)throw new g(d.ErrRefused,`cannot find node of CRDTTreePos(${e.toTestString()}, ${r.toTestString()})`);return!r.equals(e)&&r.getOffset()>0&&r.getOffset()===s.id.getOffset()&&s.insPrevID&&(s=t.findFloorNode(s.insPrevID)),[i,s]}getLeftSiblingID(){return this.leftSiblingID}equals(t){return this.getParentID().getCreatedAt().equals(t.getParentID().getCreatedAt())&&this.getParentID().getOffset()===t.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(t.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===t.getLeftSiblingID().getOffset()}}class re{constructor(t,e){o(this,"createdAt");o(this,"offset");this.createdAt=t,this.offset=e}static of(t,e){return new re(t,e)}static fromStruct(t){return re.of(Pe.fromStruct(t.createdAt),t.offset)}static createComparator(){return(t,e)=>{const r=t.getCreatedAt().compare(e.getCreatedAt());return r!==0?r:t.getOffset()>e.getOffset()?1:t.getOffset()<e.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(t){return this.createdAt.compare(t.createdAt)===0&&this.offset===t.offset}getOffset(){return this.offset}setOffset(t){this.offset=t}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class he extends Zu{constructor(e,r,i,s,a){super(r);o(this,"id");o(this,"removedAt");o(this,"attrs");o(this,"insPrevID");o(this,"insNextID");o(this,"_value","");this.id=e,this.removedAt=a,s&&(this.attrs=s),typeof i=="string"?this.value=i:Array.isArray(i)&&(this._children=i)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,r,i,s){return new he(e,r,i,s)}deepcopy(){var r;const e=new he(this.id,this.type);return e.removedAt=this.removedAt,e._value=this._value,e.visibleSize=this.visibleSize,e.totalSize=this.totalSize,e.attrs=(r=this.attrs)==null?void 0:r.deepcopy(),e._children=this._children.map(i=>{const s=i.deepcopy();return s.parent=e,s}),e.insPrevID=this.insPrevID,e.insNextID=this.insNextID,e}get value(){if(!this.isText)throw new g(d.ErrInvalidType,`cannot get value of element node: ${this.type}`);return this._value}set value(e){if(!this.isText)throw new g(d.ErrInvalidType,`cannot set value of element node: ${this.type}`);this._value=e,this.visibleSize=e.length,this.totalSize=e.length}get isRemoved(){return!!this.removedAt}remove(e){return this.removedAt?(e.after(this.removedAt)&&(this.removedAt=e),!1):(this.removedAt=e,this.updateAncestorsSize(-this.paddedSize()),!0)}cloneText(e){return new he(re.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new he(re.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,r,i){const[s,a]=this.isText?this.splitText(r,this.id.getOffset()):this.splitElement(r,i);if(s){if(s.insPrevID=this.id,this.insNextID){const c=e.findFloorNode(this.insNextID);c.insPrevID=s.id,s.insNextID=this.insNextID}this.insNextID=s.id,e.registerNode(s)}return[s,a]}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,r,i){return r?!!(!this.removedAt||!i&&(e!=null&&e.after(this.removedAt))):!1}canStyle(e,r){return this.isText?!1:this.getCreatedAt().getLamport()<=r&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,r){this.attrs||(this.attrs=new Ar);const i=[];for(const[s,a]of Object.entries(e))i.push(this.attrs.set(s,a,r));return i}purge(e){this.attrs&&this.attrs.purge(e)}getDataSize(){const e={data:0,meta:0};if(this.isText&&(e.data+=this.visibleSize*2),this.id&&(e.meta+=Ye),this.removedAt&&(e.meta+=Ye),this.attrs)for(const r of this.attrs){if(r.getRemovedAt())continue;const i=r.getDataSize();e.meta+=i.meta,e.data+=i.data}return e}getGCPairs(){const e=[];if(!this.attrs)return e;for(const r of this.attrs)r.getRemovedAt()&&e.push({parent:this,child:r});return e}}function Ls(n){var e;if(n.isText){const r=n;return{type:r.type,value:r.value}}const t={type:n.type,children:n.children.map(Ls)};return n.attrs&&(t.attributes=br((e=n.attrs)==null?void 0:e.toObject())),t}function Ks(n){if(n.isText)return n.value;let t="";return n.attrs&&n.attrs.size()&&(t=" "+Array.from(n.attrs).filter(e=>!e.isRemoved()).sort((e,r)=>e.getKey().localeCompare(r.getKey())).map(e=>{const r=JSON.parse(e.getValue());return typeof r=="string"?`${e.getKey()}="${r}"`:`${e.getKey()}="${He(e.getValue())}"`}).join(" ")),`<${n.type}${t}>${n.children.map(e=>Ks(e)).join("")}</${n.type}>`}function Va(n){if(n.isText){const t=n;return{type:t.type,value:t.value,visibleSize:t.visibleSize,isRemoved:t.isRemoved}}return{type:n.type,children:n.children.map(Va),visibleSize:n.visibleSize,isRemoved:n.isRemoved}}class de extends Jn{constructor(e,r){super(r);o(this,"indexTree");o(this,"nodeMapByID");this.indexTree=new el(e),this.nodeMapByID=new Ka(re.createComparator()),this.indexTree.traverseAll(i=>{this.nodeMapByID.put(i.id,i)})}static create(e,r){return new de(e,r)}findFloorNode(e){const r=this.nodeMapByID.floorEntry(e);if(!(!r||!r.key.getCreatedAt().equals(e.getCreatedAt())))return r.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,r){let i={data:0,meta:0};const[s,a]=e.toTreeNodePair(this);let c=a;const l=s===c,h=c.parent&&!l?c.parent:s;if(c.isText){const[,f]=c.split(this,e.getLeftSiblingID().getOffset()-c.id.getOffset());i=f}if(r){const f=h.allChildren,m=l?0:f.indexOf(c)+1;for(let y=m;y<f.length;y++){const p=f[y];if(!p.id.getCreatedAt().after(r))break;c=p}}return[[h,c],i]}style(e,r,i,s){const a={data:0,meta:0},[[c,l],h]=this.findNodesAndSplitText(e[0],i),[[f,m],y]=this.findNodesAndSplitText(e[1],i);te(a,y,h);const p=[],S=r?br(r):{},b=[];return this.traverseInPosRange(c,l,f,m,([A,N])=>{var z;const L=A.getCreatedAt().getActorID();let F=Ds;if(s!=null&&(F=s.get(L)?s.get(L):0n),A.canStyle(i,F)&&r){const Y=A.setAttrs(r,i),C=Y.reduce((V,[,ge])=>(ge&&(V[ge.getKey()]=S[ge.getKey()]),V),{}),U=A.parent,Z=A.prevSibling||A.parent;Object.keys(C).length>0&&p.push({type:"style",from:this.toIndex(U,Z),to:this.toIndex(A,A),fromPath:this.toPath(U,Z),toPath:this.toPath(A,A),actor:i.getActorID(),value:C});for(const[V]of Y)V&&b.push({parent:A,child:V});for(const[V]of Object.entries(S)){const ge=(z=A.attrs)==null?void 0:z.getNodeMapByKey().get(V);ge!==void 0&&N!==G.End&&te(a,ge.getDataSize())}}}),[b,p,a]}removeStyle(e,r,i,s){const a={data:0,meta:0},[[c,l],h]=this.findNodesAndSplitText(e[0],i),[[f,m],y]=this.findNodesAndSplitText(e[1],i);te(a,y,h);const p=[],S=[];return this.traverseInPosRange(c,l,f,m,([b])=>{const A=b.getCreatedAt().getActorID();let N=Ds;if(s!=null&&(N=s.get(A)?s.get(A):0n),b.canStyle(i,N)&&r){b.attrs||(b.attrs=new Ar);for(const z of r){const Y=b.attrs.remove(z,i);for(const C of Y)S.push({parent:b,child:C})}const L=b.parent,F=b.prevSibling||b.parent;p.push({actor:i.getActorID(),type:"removeStyle",from:this.toIndex(L,F),to:this.toIndex(b,b),fromPath:this.toPath(L,F),toPath:this.toPath(b,b),value:r})}}),[S,p,a]}edit(e,r,i,s,a,c){const l={data:0,meta:0},[[h,f],m]=this.findNodesAndSplitText(e[0],s),[[y,p],S]=this.findNodesAndSplitText(e[1],s);te(l,S,m);const b=this.toIndex(h,f),A=this.toPath(h,f),N=[],L=[],F=[];this.traverseInPosRange(h,f,y,p,([C,U],Z)=>{if(U===G.Start&&!Z)for(const qn of C.children)F.push(qn);const V=c===void 0;let ge=!1;const Fn=c==null?void 0:c.get(C.id.getCreatedAt().getActorID());ge=V||Fn!==void 0&&Fn>=C.id.getCreatedAt().getLamport();let zn=!1;if(C.removedAt){const qn=c==null?void 0:c.get(C.removedAt.getActorID());zn=V||qn!==void 0&&qn>=C.removedAt.getLamport()}(C.canDelete(s,ge,zn)||N.includes(C.parent))&&((U===G.Text||U===G.Start)&&N.push(C),L.push([C,U]))},!0);const z=this.makeDeletionChanges(L,s),Y=[];for(const C of N)C.remove(s),C.isRemoved&&Y.push({parent:this,child:C});for(const C of F)C.removedAt||h.append(C);if(i>0){let C=0,U=h,Z=f;for(;C<i;)U.split(this,U.findOffset(Z)+1,a),Z=U,U=U.parent,C++;z.push({type:"content",from:b,to:b,fromPath:A,toPath:A,actor:s.getActorID()})}if(r!=null&&r.length){const C=[];let U=f;for(const Z of r)U===h?h.insertAt(Z,0):h.insertAfter(Z,U),U=Z,Mi(Z,V=>{h.isRemoved?(V.remove(s),Y.push({parent:this,child:V})):te(l,V.getDataSize()),this.nodeMapByID.put(V.id,V)}),Z.isRemoved||C.push(Z);if(C.length){const Z=C.map(V=>Ls(V));z.length&&z[z.length-1].from===b?z[z.length-1].value=Z:z.push({type:"content",from:b,to:b,fromPath:A,toPath:A,actor:s.getActorID(),value:Z})}}return[z,Y,l]}editT(e,r,i,s,a){const c=this.findPos(e[0]),l=this.findPos(e[1]);return this.edit([c,l],r,i,s,a)}move(e,r,i){throw new g(d.ErrUnimplemented,`not implemented: ${e}, ${r}, ${i}`)}pathToTreePos(e){return this.indexTree.pathToTreePos(e)}purge(e){var s;(s=e.parent)==null||s.removeChild(e),this.nodeMapByID.remove(e.id);const r=e.insPrevID,i=e.insNextID;if(r){const a=this.findFloorNode(r);a.insNextID=i}if(i){const a=this.findFloorNode(i);a.insPrevID=r}e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){const e=[];return this.indexTree.traverse(r=>{r.getRemovedAt()&&e.push({parent:this,child:r});for(const i of r.getGCPairs())e.push(i)}),e}findPos(e,r=!0){const i=this.indexTree.findTreePos(e,r);return Me.fromTreePos(i)}pathToPosRange(e){const r=this.pathToIndex(e);return[this.findPos(r),this.findPos(r+1)]}pathToPos(e){const r=this.indexTree.pathToIndex(e);return this.findPos(r)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return Ks(this.indexTree.getRoot())}getDataSize(){const e={data:0,meta:0};return this.indexTree.traverse(r=>{if(r.getRemovedAt())return;const i=r.getDataSize();e.data+=i.data,e.meta+=i.meta}),{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const e=this.indexTree.getRoot(),r=(i,s=void 0,a=void 0,c=0)=>{var p,S,b,A;let l,h,f;const m=i.isText?{node:i,offset:0}:s&&a?this.toTreePos(s,a):null;m&&(l=this.indexTree.indexOf(m),h=this.indexTree.treePosToPath(m),f=Me.fromTreePos(m).toStruct());const y={type:i.type,parent:s==null?void 0:s.id.toTestString(),size:i.visibleSize,id:i.id.toTestString(),removedAt:(p=i.removedAt)==null?void 0:p.toTestString(),insPrev:(S=i.insPrevID)==null?void 0:S.toTestString(),insNext:(b=i.insNextID)==null?void 0:b.toTestString(),value:i.isText?i.value:void 0,isRemoved:i.isRemoved,children:[],depth:c,attributes:i.attrs?br((A=i.attrs)==null?void 0:A.toObject()):void 0,index:l,path:h,pos:f};for(let N=0;N<i.allChildren.length;N++){const L=N===0?i:i.allChildren[N-1];y.children.push(r(i.allChildren[N],i,L,c+1))}return y};return r(e)}getRootTreeNode(){return Ls(this.indexTree.getRoot())}toTestTreeNode(){return Va(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const e=this.getRoot(),r=new de(e.deepcopy(),this.getCreatedAt());return r.setRemovedAt(this.getRemovedAt()),r.setMovedAt(this.getMovedAt()),r}toPath(e,r){const i=this.toTreePos(e,r);return i?this.indexTree.treePosToPath(i):[]}toIndex(e,r,i=!1){const s=this.toTreePos(e,r,i);return s?this.indexTree.indexOf(s,i):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){const r=this.findPos(e[0]);return e[0]===e[1]?[r,r]:[r,this.findPos(e[1])]}indexRangeToPosStructRange(e){const[r,i]=e,s=this.findPos(r);return r===i?[s.toStruct(),s.toStruct()]:[s.toStruct(),this.findPos(i).toStruct()]}posRangeToPathRange(e){const[[r,i]]=this.findNodesAndSplitText(e[0]),[[s,a]]=this.findNodesAndSplitText(e[1]);return[this.toPath(r,i),this.toPath(s,a)]}posRangeToIndexRange(e){const[[r,i]]=this.findNodesAndSplitText(e[0]),[[s,a]]=this.findNodesAndSplitText(e[1]);return[this.toIndex(r,i),this.toIndex(s,a)]}traverseInPosRange(e,r,i,s,a,c=!1){const l=this.toIndex(e,r,c),h=this.toIndex(i,s,c);this.indexTree.tokensBetween(l,h,a,c)}toTreePos(e,r,i=!1){if(!e||!r)return;if(!i&&e.isRemoved){let a;for(;e.isRemoved;)a=e,e=a.parent;const c=e.findOffset(a,i);return{node:e,offset:c}}if(e===r)return{node:e,offset:0};let s=e.findOffset(r,i);if(i||!r.isRemoved){if(r.isText)return{node:r,offset:r.paddedSize(i)};s++}return{node:e,offset:s}}makeDeletionChanges(e,r){const i=[],s=[];let a=null,c=null;for(let l=0;l<e.length;l++){const h=e[l],f=e[l+1];a||(a=h),c=h;const m=this.findRightToken(h);(!m||!f||m[0]!==f[0]||m[1]!==f[1])&&(s.push([a,c]),a=null,c=null)}for(const l of s){const[h,f]=l,[m,y]=this.findLeftToken(h),[p,S]=f,b=y===G.Start?m:m.parent,A=S===G.Start?p:p.parent,N=this.toIndex(b,m),L=this.toIndex(A,p);N<L&&(i.length>0&&N===i[i.length-1].to?(i[i.length-1].to=L,i[i.length-1].toPath=this.toPath(A,p)):i.push({type:"content",from:N,to:L,fromPath:this.toPath(b,m),toPath:this.toPath(A,p),actor:r.getActorID()}))}return i.reverse()}findRightToken([e,r]){if(r===G.Start){const l=e.allChildren;return l.length>0?[l[0],l[0].isText?G.Text:G.Start]:[e,G.End]}const i=e.parent,s=i.allChildren,a=s.indexOf(e);if(i&&a===s.length-1)return[i,G.End];const c=s[a+1];return[c,c.isText?G.Text:G.Start]}findLeftToken([e,r]){if(r===G.End){const l=e.allChildren;if(l.length>0){const h=l[l.length-1];return[h,h.isText?G.Text:G.End]}return[e,G.Start]}const i=e.parent,s=i.allChildren,a=s.indexOf(e);if(i&&a===0)return[i,G.Start];const c=s[a-1];return[c,c.isText?G.Text:G.End]}}class Mn extends ze{constructor(e,r,i,s,a,c){super(e,c);o(this,"fromPos");o(this,"toPos");o(this,"contents");o(this,"splitLevel");this.fromPos=r,this.toPos=i,this.contents=s,this.splitLevel=a}static create(e,r,i,s,a,c){return new Mn(e,r,i,s,a,c)}execute(e,r,i){var m;const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof de))throw new g(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const a=this.getExecutedAt(),c=s,[l,h,f]=c.edit([this.fromPos,this.toPos],(m=this.contents)==null?void 0:m.map(y=>y.deepcopy()),this.splitLevel,a,(()=>{let y=a.getDelimiter();return this.contents!==void 0&&(y+=this.contents.length),()=>Pe.of(a.getLamport(),++y,a.getActorID())})(),i);e.acc(f);for(const y of h)e.registerGCPair(y);return{opInfos:l.map(({from:y,to:p,value:S,splitLevel:b,fromPath:A,toPath:N})=>({type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:y,to:p,value:S,splitLevel:b,fromPath:A,toPath:N}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,i=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,s=this.contents||[];return`${e}.EDIT(${r},${i},${s.map(a=>Ks(a)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}}class _r{constructor(t){o(this,"vector");this.vector=t||new Map}set(t,e){this.vector.set(t,e)}unset(t){this.vector.delete(t)}get(t){return this.vector.get(t)}has(t){return this.vector.has(t)}maxLamport(){let t=BigInt(0);for(const[,e]of this)e>t&&(t=e);return t}max(t){const e=new Map;for(const[r,i]of t){const s=this.vector.get(r),a=s&&s>i?s:i;e.set(r,a)}for(const[r,i]of this){const s=t.get(r),a=s&&s>i?s:i;e.set(r,a)}return new _r(e)}afterOrEqual(t){const e=this.vector.get(t.getActorID());return e===void 0?!1:e>=t.getLamport()}deepcopy(){const t=new Map;for(const[e,r]of this.vector)t.set(e,r);return new _r(t)}filter(t){const e=new Map;for(const[r]of t){const i=this.vector.get(r);i!==void 0&&e.set(r,i)}return new _r(e)}size(){return this.vector.size}*[Symbol.iterator](){for(const[t,e]of this.vector)yield[t,e]}}const ja=new _r(new Map);class Oe{constructor(t,e,r,i,s){o(this,"clientSeq");o(this,"serverSeq");o(this,"actor");o(this,"lamport");o(this,"versionVector");this.clientSeq=t,this.serverSeq=s,this.lamport=e,this.versionVector=i,this.actor=r}hasClocks(){return this.versionVector.size()>0&&this.lamport!=Cs}static of(t,e,r,i,s){return new Oe(t,e,r,i,s)}next(t=!1){if(t)return new Oe(this.clientSeq+1,this.lamport,this.actor,ja,Cs);const e=this.versionVector.deepcopy();return e.set(this.actor,this.lamport+1n),new Oe(this.clientSeq+1,this.lamport+1n,this.actor,e)}syncClocks(t){if(!t.hasClocks())return this;const e=t.lamport>this.lamport?t.lamport+1n:this.lamport+1n,r=this.versionVector.max(t.versionVector),i=new Oe(this.clientSeq,e,this.actor,r);return i.versionVector.set(this.actor,e),i}setClocks(t,e){const r=t>this.lamport?t+1n:this.lamport+1n,i=this.versionVector.max(e);return i.set(this.actor,r),Oe.of(this.clientSeq,r,this.actor,i)}createTimeTicket(t){return Pe.of(this.lamport,t,this.actor)}setActor(t){return new Oe(this.clientSeq,this.lamport,t,this.versionVector,this.serverSeq)}setLamport(t){return new Oe(this.clientSeq,t,this.actor,this.versionVector,this.serverSeq)}setVersionVector(t){return new Oe(this.clientSeq,this.lamport,this.actor,t,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}getVersionVector(){return this.versionVector}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const il=new Oe(0,0n,qs,ja);class hn{constructor({id:t,operations:e,presenceChange:r,message:i}){o(this,"id");o(this,"operations");o(this,"presenceChange");o(this,"message");this.id=t,this.operations=e||[],this.presenceChange=r,this.message=i}static create({id:t,operations:e,presenceChange:r,message:i}){return new hn({id:t,operations:e,presenceChange:r,message:i})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(t){for(const e of this.operations)e.setActor(t);this.id=this.id.setActor(t)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(t,e,r){const i=[],s=[];for(const a of this.operations){const c=a.execute(t,r,this.id.getVersionVector());if(!c)continue;const{opInfos:l,reverseOp:h}=c;i.push(...l),h&&s.unshift(h)}return this.presenceChange&&(this.presenceChange.type===Qe.Put?e.set(this.id.getActorID(),Be(this.presenceChange.presence)):e.delete(this.id.getActorID())),{opInfos:i,reverseOps:s}}toTestString(){return`${this.operations.map(t=>t.toTestString()).join(",")}`}toStruct(){return{changeID:j.bytesToHex(j.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(t=>j.bytesToHex(j.toOperation(t).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(t){const{changeID:e,operations:r,presenceChange:i,message:s}=t;return hn.create({id:j.bytesToChangeID(j.hexToBytes(e)),operations:r==null?void 0:r.map(a=>j.bytesToOperation(j.hexToBytes(a))),presenceChange:i,message:s})}}class Fi{constructor(t,e,r,i,s,a){o(this,"documentKey");o(this,"checkpoint");o(this,"isRemoved");o(this,"changes");o(this,"snapshot");o(this,"versionVector");this.documentKey=t,this.checkpoint=e,this.isRemoved=r,this.changes=i,this.snapshot=a,this.versionVector=s}static create(t,e,r,i,s,a){return new Fi(t,e,r,i,s,a)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getVersionVector(){return this.versionVector}}class en{constructor(t,e){o(this,"serverSeq");o(this,"clientSeq");this.serverSeq=t,this.clientSeq=e}static of(t,e){return new en(t,e)}increaseClientSeq(t){return t===0?this:new en(this.serverSeq,this.clientSeq+t)}forward(t){if(this.equals(t))return this;const e=this.serverSeq>t.serverSeq?this.serverSeq:t.serverSeq,r=Math.max(this.clientSeq,t.clientSeq);return en.of(e,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(t){return this.clientSeq===t.clientSeq&&this.serverSeq==t.serverSeq}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const sl=new en(0n,0);class Ze{constructor(t,e){o(this,"createdAt");o(this,"offset");this.createdAt=t,this.offset=e}static of(t,e){return new Ze(t,e)}static fromStruct(t){return Ze.of(Pe.fromStruct(t.createdAt),t.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(t){return this.createdAt.compare(t.createdAt)===0&&this.offset===t.offset}hasSameCreatedAt(t){return this.createdAt.compare(t.createdAt)===0}split(t){return new Ze(this.createdAt,this.offset+t)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const ol=Ze.of(an,0);class Fe{constructor(t,e){o(this,"id");o(this,"relativeOffset");this.id=t,this.relativeOffset=e}static of(t,e){return new Fe(t,e)}static fromStruct(t){const e=Ze.fromStruct(t.id);return Fe.of(e,t.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return Ze.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(t){return this.id.equals(t.id)?this.relativeOffset===t.relativeOffset:!1}}class Br extends La{constructor(e,r,i){super(r);o(this,"id");o(this,"removedAt");o(this,"prev");o(this,"next");o(this,"insPrev");o(this,"insNext");this.id=e,this.removedAt=i}static create(e,r){return new Br(e,r)}static createComparator(){return(e,r)=>{const i=e.getCreatedAt().compare(r.getCreatedAt());return i!==0?i:e.getOffset()>r.getOffset()?1:e.getOffset()<r.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new Br(this.id.split(e),this.splitValue(e),this.removedAt)}canRemove(e,r,i){return r?!!(!this.removedAt||!i&&(e!=null&&e.after(this.removedAt))):!1}canStyle(e,r){return this.getCreatedAt().getLamport()<=r&&(!this.removedAt||e.after(this.removedAt))}setRemovedAt(e){this.removedAt=e}remove(e){if(!this.removedAt){this.removedAt=e;return}e.after(this.removedAt)&&(this.removedAt=e)}createPosRange(){return[Fe.of(this.id,0),Fe.of(this.id,this.getLength())]}getDataSize(){const e=this.value.getDataSize();return this.id&&(e.meta+=Ye),this.removedAt&&(e.meta+=Ye),e}deepcopy(){return new Br(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(e){const r=this.value;return this.value=r.substring(0,e),r.substring(e,r.length)}toIDString(){return this.id.toIDString()}}class fn{constructor(){o(this,"head");o(this,"treeByIndex");o(this,"treeByID");this.head=Br.create(ol),this.treeByIndex=new Cn,this.treeByID=new Ka(Br.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new fn}edit(t,e,r,i){const s={data:0,meta:0},[a,c,l]=this.findNodeWithSplit(t[1],e),[h,f,m]=this.findNodeWithSplit(t[0],e);te(s,c,f);const y=this.findBetween(m,l),[p,S]=this.deleteNodes(y,e,i),b=l?l.getID():a.getID();let A=Fe.of(b,0);if(r){const L=this.posToIndex(h.createPosRange()[1],!0),F=this.insertAfter(h,Br.create(Ze.of(e,0),r));te(s,F.getDataSize()),p.length&&p[p.length-1].from===L?p[p.length-1].value=r:p.push({actor:e.getActorID(),from:L,to:L,value:r}),A=Fe.of(F.getID(),F.getContentLength())}const N=[];for(const[,L]of S)N.push({parent:this,child:L});return[A,N,s,p]}indexToPos(t){const[e,r]=this.treeByIndex.find(t),i=e;return Fe.of(i.getID(),r)}findIndexesFromRange(t){const[e,r]=t;return[this.posToIndex(e,!1),this.posToIndex(r,!0)]}posToIndex(t,e){const r=t.getAbsoluteID(),i=e?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!i)throw new g(d.ErrInvalidArgument,`the node of the given id should be found: ${r.toTestString()}`);const s=this.treeByIndex.indexOf(i),a=i.isRemoved()?0:r.getOffset()-i.getID().getOffset();return s+a}findNode(t){return this.findFloorNode(t)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const t=[];for(const e of this)e.isRemoved()||t.push(e.getValue());return t.join("")}*[Symbol.iterator](){let t=this.head.getNext();for(;t;)yield t,t=t.getNext()}getHead(){return this.head}deepcopy(){const t=new fn;let e=this.head.getNext(),r=t.head,i;for(;e;){if(i=t.insertAfter(r,e.deepcopy()),e.hasInsPrev()){const s=t.findNode(e.getInsPrevID());i.setInsPrev(s)}r=i,e=e.getNext()}return t}toTestString(){const t=[];let e=this.head;for(;e;)e.isRemoved()?t.push(`{${e.toTestString()}}`):t.push(`[${e.toTestString()}]`),e=e.getNext();return t.join("")}insertAfter(t,e){const r=t.getNext();return e.setPrev(t),r&&r.setPrev(e),this.treeByID.put(e.getID(),e),this.treeByIndex.insertAfter(t,e),e}findNodeWithSplit(t,e){const r=t.getAbsoluteID();let i=this.findFloorNodePreferToLeft(r);const s=r.getOffset()-i.getID().getOffset(),[,a]=this.splitNode(i,s);for(;i.hasNext()&&i.getNext().getCreatedAt().after(e);)i=i.getNext();return[i,a,i.getNext()]}findFloorNodePreferToLeft(t){let e=this.findFloorNode(t);if(!e)throw new g(d.ErrInvalidArgument,`the node of the given id should be found: ${t.toTestString()}`);if(t.getOffset()>0&&e.getID().getOffset()==t.getOffset()){if(!e.hasInsPrev())return e;e=e.getInsPrev()}return e}findFloorNode(t){const e=this.treeByID.floorEntry(t);if(e&&!(!e.key.equals(t)&&!e.key.hasSameCreatedAt(t)))return e.value}findBetween(t,e){const r=[];let i=t;for(;i&&i!==e;)r.push(i),i=i.getNext();return r}splitNode(t,e){const r={data:0,meta:0};if(e>t.getContentLength())throw new g(d.ErrInvalidArgument,"offset should be less than or equal to length");if(e===0)return[t,r];if(e===t.getContentLength())return[t.getNext(),r];const i=t.getDataSize(),s=t.split(e);this.treeByIndex.updateWeight(s),this.insertAfter(t,s);const a=t.getInsNext();return a&&a.setInsPrev(s),s.setInsPrev(t),te(r,t.getDataSize(),s.getDataSize()),zr(r,i),[s,r]}deleteNodes(t,e,r){if(!t.length)return[[],new Map];const i=r===void 0||r.size()===0,s=[],a=[],[c,l]=this.findEdgesOfCandidates(t);a.push(c);for(const m of t){let y=!1;if(i)y=!0;else{const S=r==null?void 0:r.get(m.getCreatedAt().getActorID());S&&S>=m.getCreatedAt().getLamport()&&(y=!0)}let p=!1;if(m.getRemovedAt()){const S=r==null?void 0:r.get(m.getRemovedAt().getActorID());(i||S&&S>=m.getRemovedAt().getLamport())&&(p=!0)}m.canRemove(e,y,p)?s.push(m):a.push(m)}a.push(l);const h=this.makeChanges(a,e),f=new Map;for(const m of s)f.set(m.getID().toIDString(),m),m.remove(e);return this.deleteIndexNodes(a),[h,f]}findEdgesOfCandidates(t){return[t[0].getPrev(),t[t.length-1].getNext()]}makeChanges(t,e){const r=[];let i,s;for(let a=0;a<t.length-1;a++){const c=t[a],l=t[a+1];c.getNext()!=l&&([i]=this.findIndexesFromRange(c.getNext().createPosRange()),l?[,s]=this.findIndexesFromRange(l.getPrev().createPosRange()):s=this.treeByIndex.length,i<s&&r.push({actor:e.getActorID(),from:i,to:s}))}return r.reverse()}deleteIndexNodes(t){for(let e=0;e<t.length-1;e++){const r=t[e],i=t[e+1];r.getNext()!=i&&this.treeByIndex.deleteRange(r,i)}}purge(t){this.treeByIndex.delete(t),this.treeByID.remove(t.getID());const e=t.getPrev(),r=t.getNext(),i=t.getInsPrev(),s=t.getInsNext();e&&e.setNext(r),r&&r.setPrev(e),t.setPrev(void 0),t.setNext(void 0),i&&i.setInsNext(s),s&&s.setInsPrev(i),t.setInsPrev(void 0),t.setInsNext(void 0)}}const Wo=n=>n<0?Math.ceil(n):Math.floor(n);var et=(n=>(n[n.Int=0]="Int",n[n.Long=1]="Long",n))(et||{});class ce extends Jn{constructor(e,r,i){super(i);o(this,"valueType");o(this,"value");switch(this.valueType=e,e){case 0:typeof r=="number"?r>Math.pow(2,31)-1||r<-Math.pow(2,31)?this.value=B.fromNumber(r).toInt():this.value=Wo(r):this.value=r.toInt();break;case 1:typeof r=="number"?this.value=B.fromNumber(r):this.value=r;break;default:throw new g(d.ErrUnimplemented,`unimplemented type: ${e}`)}}static create(e,r,i){return new ce(e,r,i)}static valueFromBytes(e,r){switch(e){case 0:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 1:return B.fromBytesLE(Array.from(r));default:throw new g(d.ErrUnimplemented,`unimplemented type: ${e}`)}}getDataSize(){return{data:this.valueType===0?4:8,meta:this.getMetaUsage()}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const e=ce.create(this.valueType,this.value,this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":return e instanceof B?1:void 0;case"number":return e>Math.pow(2,31)-1||e<-Math.pow(2,31)?1:0;default:return}}static isSupport(e){return!!ce.getCounterType(e)}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===0||e===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 1:{const r=this.value.toBytesLE();return Uint8Array.from(r)}default:throw new g(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(e){function r(i){if(!i.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof i.getValue()}`)}return r(this),r(e),this.valueType===1?this.value=this.value.add(e.getValue()):e.getType()===M.Long?this.value=this.value+e.getValue().toInt():this.value=B.fromNumber(this.value+Wo(e.getValue())).toInt(),this}}class dn extends ze{constructor(e,r,i){super(e,i);o(this,"value");this.value=r}static create(e,r,i){return new dn(e,r,i)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ce))throw new g(d.ErrInvalidArgument,"fail to execute, only Counter can execute increase");const i=r,s=this.value.deepcopy();return i.increase(s),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:s.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const e=this.value.deepcopy(),i=e.getType()===M.Long?e.getValue().multiply(-1):e.getValue()*-1;return dn.create(this.getParentCreatedAt(),K.of(i,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class Ir extends ze{constructor(e,r,i,s,a,c){super(e,c);o(this,"fromPos");o(this,"toPos");o(this,"attributes");o(this,"attributesToRemove");this.fromPos=r,this.toPos=i,this.attributes=s,this.attributesToRemove=a}static create(e,r,i,s,a){return new Ir(e,r,i,s,[],a)}static createTreeRemoveStyleOperation(e,r,i,s,a){return new Ir(e,r,i,new Map,s,a)}execute(e,r,i){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof de))throw new g(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const a=s;let c,l,h={data:0,meta:0};if(this.attributes.size){const f={};[...this.attributes].forEach(([m,y])=>f[m]=y),[l,c,h]=a.style([this.fromPos,this.toPos],f,this.getExecutedAt(),i)}else{const f=this.attributesToRemove;[l,c,h]=a.removeStyle([this.fromPos,this.toPos],f,this.getExecutedAt(),i)}e.acc(h);for(const f of l)e.registerGCPair(f);return{opInfos:c.map(({from:f,to:m,value:y,fromPath:p,toPath:S})=>({type:"tree-style",from:f,to:m,value:this.attributes.size?{attributes:y}:{attributesToRemove:y},fromPath:p,toPath:S,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,i=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${e}.STYLE(${r},${i},${Object.entries(this.attributes||{}).map(([s,a])=>`${s}:"${a}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}}class kr extends ze{constructor(e,r,i,s){super(e,s);o(this,"createdAt");o(this,"value");this.createdAt=r,this.value=i}static create(e,r,i,s){return new kr(e,r,i,s)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new g(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ie))throw new g(d.ErrInvalidArgument,"fail to execute, only array can execute set");const i=r.getByID(this.createdAt).deepcopy(),s=this.toReverseOperation(this.value,i),a=this.value.deepcopy();return r.insertAfter(this.createdAt,a,this.getExecutedAt()),r.delete(this.createdAt,this.getExecutedAt()),e.registerElement(a),{opInfos:[{type:"array-set",path:e.createPath(this.getParentCreatedAt())}],reverseOp:s}}toReverseOperation(e,r){return kr.create(this.getParentCreatedAt(),e.getCreatedAt(),r)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ARRAY_SET.${this.createdAt.toTestString()}=${this.value.toSortedJSON()}`}getCreatedAt(){return this.createdAt}getValue(){return this.value}setCreatedAt(e){this.createdAt=e}}function al(n){const t=new $i,e=t.data;for(const[r,i]of Object.entries(n))e[r]=JSON.stringify(i);return t}function cl(n){if(n.type===Qe.Put)return new Pn({type:Kr.PUT,presence:al(n.presence)});if(n.type===Qe.Clear)return new Pn({type:Kr.CLEAR});throw new g(d.ErrUnimplemented,"unimplemented type")}function ul(n){return new Ba({serverSeq:n.getServerSeq(),clientSeq:n.getClientSeq()})}function Wa(n){return new Ji({clientSeq:n.getClientSeq(),lamport:n.getLamport(),actorId:qi(n.getActorID()),versionVector:Vs(n.getVersionVector())})}function E(n){if(n)return new k({lamport:n.getLamport(),delimiter:n.getDelimiter(),actorId:qi(n.getActorID())})}function Vs(n){if(!n)return;const t=new Ri;for(const[e,r]of n){const i=jl(qi(e));t.vector[i]=BigInt(r.toString())}return t}function Ga(n){switch(n){case M.Null:return P.NULL;case M.Boolean:return P.BOOLEAN;case M.Integer:return P.INTEGER;case M.Long:return P.LONG;case M.Double:return P.DOUBLE;case M.String:return P.STRING;case M.Bytes:return P.BYTES;case M.Date:return P.DATE;default:throw new g(d.ErrInvalidType,`unsupported type: ${n}`)}}function Ha(n){switch(n){case et.Int:return P.INTEGER_CNT;case et.Long:return P.LONG_CNT;default:throw new g(d.ErrInvalidType,`unsupported type: ${n}`)}}function Kn(n){if(n instanceof ne)return new me({type:P.JSON_OBJECT,createdAt:E(n.getCreatedAt()),value:ac(n)});if(n instanceof ie)return new me({type:P.JSON_ARRAY,createdAt:E(n.getCreatedAt()),value:ql(n)});if(n instanceof fe)return new me({type:P.TEXT,createdAt:E(n.getCreatedAt())});if(n instanceof K)return new me({type:Ga(n.getType()),createdAt:E(n.getCreatedAt()),value:n.toBytes()});if(n instanceof ce)return new me({type:Ha(n.getType()),createdAt:E(n.getCreatedAt()),value:n.toBytes()});if(n instanceof de)return new me({type:P.TREE,createdAt:E(n.getCreatedAt()),value:Kl(n)});throw new g(d.ErrUnimplemented,"unimplemented element")}function ll(n){return new xn({createdAt:E(n.getCreatedAt()),offset:n.getOffset()})}function Vn(n){return new Vr({createdAt:E(n.getID().getCreatedAt()),offset:n.getID().getOffset(),relativeOffset:n.getRelativeOffset()})}function jn(n){return new Ur({parentId:Sn(n.getParentID()),leftSiblingId:Sn(n.getLeftSiblingID())})}function Sn(n){return new Cr({createdAt:E(n.getCreatedAt()),offset:n.getOffset()})}function Ya(n){const t=new Fs;if(n instanceof jr){const e=n,r=new ai;r.parentCreatedAt=E(e.getParentCreatedAt()),r.key=e.getKey(),r.value=Kn(e.getValue()),r.executedAt=E(e.getExecutedAt()),t.body.case="set",t.body.value=r}else if(n instanceof Lr){const e=n,r=new ci;r.parentCreatedAt=E(e.getParentCreatedAt()),r.prevCreatedAt=E(e.getPrevCreatedAt()),r.value=Kn(e.getValue()),r.executedAt=E(e.getExecutedAt()),t.body.case="add",t.body.value=r}else if(n instanceof $e){const e=n,r=new ui;r.parentCreatedAt=E(e.getParentCreatedAt()),r.prevCreatedAt=E(e.getPrevCreatedAt()),r.createdAt=E(e.getCreatedAt()),r.executedAt=E(e.getExecutedAt()),t.body.case="move",t.body.value=r}else if(n instanceof _e){const e=n,r=new li;r.parentCreatedAt=E(e.getParentCreatedAt()),r.createdAt=E(e.getCreatedAt()),r.executedAt=E(e.getExecutedAt()),t.body.case="remove",t.body.value=r}else if(n instanceof Rn){const e=n,r=new hi;r.parentCreatedAt=E(e.getParentCreatedAt()),r.from=Vn(e.getFromPos()),r.to=Vn(e.getToPos()),r.content=e.getContent();const i=r.attributes;for(const[s,a]of e.getAttributes())i[s]=a;r.executedAt=E(e.getExecutedAt()),t.body.case="edit",t.body.value=r}else if(n instanceof $n){const e=n,r=new fi;r.parentCreatedAt=E(e.getParentCreatedAt()),r.from=Vn(e.getFromPos()),r.to=Vn(e.getToPos());const i=r.attributes;for(const[s,a]of e.getAttributes())i[s]=a;r.executedAt=E(e.getExecutedAt()),t.body.case="style",t.body.value=r}else if(n instanceof dn){const e=n,r=new di;r.parentCreatedAt=E(e.getParentCreatedAt()),r.value=Kn(e.getValue()),r.executedAt=E(e.getExecutedAt()),t.body.case="increase",t.body.value=r}else if(n instanceof Mn){const e=n,r=new gi;r.parentCreatedAt=E(e.getParentCreatedAt()),r.from=jn(e.getFromPos()),r.to=jn(e.getToPos()),r.contents=yl(e.getContents()),r.splitLevel=e.getSplitLevel(),r.executedAt=E(e.getExecutedAt()),t.body.case="treeEdit",t.body.value=r}else if(n instanceof Ir){const e=n,r=new mi;r.parentCreatedAt=E(e.getParentCreatedAt()),r.from=jn(e.getFromPos()),r.to=jn(e.getToPos());const i=e.getAttributesToRemove();if(i.length>0)r.attributesToRemove=i;else{const s=r.attributes;for(const[a,c]of e.getAttributes())s[a]=c}r.executedAt=E(e.getExecutedAt()),t.body.case="treeStyle",t.body.value=r}else if(n instanceof kr){const e=n,r=new pi;r.parentCreatedAt=E(e.getParentCreatedAt()),r.createdAt=E(e.getCreatedAt()),r.value=Kn(e.getValue()),r.executedAt=E(e.getExecutedAt()),t.body.case="arraySet",t.body.value=r}else throw new g(d.ErrUnimplemented,"unimplemented operation");return t}function hl(n){const t=[];for(const e of n)t.push(Ya(e));return t}function fl(n){const t=new Ca({id:Wa(n.getID()),message:n.getMessage()});return n.hasOperations()&&(t.operations=hl(n.getOperations())),n.hasPresenceChange()&&(t.presenceChange=cl(n.getPresenceChange())),t}function dl(n){const t=[];for(const e of n)t.push(fl(e));return t}function gl(n){const t=[];for(const e of n)t.push(new Da({key:e.getStrKey(),element:Ws(e.getValue())}));return t}function ml(n){const t=[];for(const e of n)t.push(new Ii({element:Ws(e.getValue())}));return t}function pl(n){const t=[];for(const e of n){const r=new Ai;r.id=ll(e.getID()),r.value=e.getValue().getContent(),r.removedAt=E(e.getRemovedAt());const i=r.attributes,s=e.getValue().getAttrs();for(const a of s){const c=new on;c.value=a.getValue(),c.updatedAt=E(a.getUpdatedAt()),i[a.getKey()]=c}t.push(r)}return t}function yl(n){const t=[];if(!n||!n.length)return t;for(const e of n)t.push(new ki({content:js(e)}));return t}function vl(n){const t={};for(const e of n)t[e.getKey()]=new on({value:e.getValue(),updatedAt:E(e.getUpdatedAt()),isRemoved:e.isRemoved()});return t}function js(n){if(!n)return[];const t=[];return Mi(n,(e,r)=>{const i=new Nn({id:Sn(e.id),type:e.type,removedAt:E(e.removedAt),depth:r});e.isText&&(i.value=e.value),e.insPrevID&&(i.insPrevId=Sn(e.insPrevID)),e.insNextID&&(i.insNextId=Sn(e.insNextID)),e.attrs&&(i.attributes=vl(e.attrs)),t.push(i)}),t}function wl(n){const t=new ue;return t.body.case="jsonObject",t.body.value=new yi({nodes:gl(n.getRHT()),createdAt:E(n.getCreatedAt()),movedAt:E(n.getMovedAt()),removedAt:E(n.getRemovedAt())}),t}function Xa(n){const t=new ue;return t.body.case="jsonArray",t.body.value=new vi({nodes:ml(n.getElements()),createdAt:E(n.getCreatedAt()),movedAt:E(n.getMovedAt()),removedAt:E(n.getRemovedAt())}),t}function Tl(n){const t=new ue;return t.body.case="primitive",t.body.value=new wi({type:Ga(n.getType()),value:n.toBytes(),createdAt:E(n.getCreatedAt()),movedAt:E(n.getMovedAt()),removedAt:E(n.getRemovedAt())}),t}function Sl(n){const t=new ue;return t.body.case="text",t.body.value=new Ti({nodes:pl(n.getRGATreeSplit()),createdAt:E(n.getCreatedAt()),movedAt:E(n.getMovedAt()),removedAt:E(n.getRemovedAt())}),t}function bl(n){const t=new ue;return t.body.case="counter",t.body.value=new Si({type:Ha(n.getType()),value:n.toBytes(),createdAt:E(n.getCreatedAt()),movedAt:E(n.getMovedAt()),removedAt:E(n.getRemovedAt())}),t}function Za(n){const t=new ue;return t.body.case="tree",t.body.value=new bi({nodes:js(n.getRoot()),createdAt:E(n.getCreatedAt()),movedAt:E(n.getMovedAt()),removedAt:E(n.getRemovedAt())}),t}function Ws(n){if(n instanceof ne)return wl(n);if(n instanceof ie)return Xa(n);if(n instanceof K)return Tl(n);if(n instanceof fe)return Sl(n);if(n instanceof ce)return bl(n);if(n instanceof de)return Za(n);throw new g(d.ErrUnimplemented,"unimplemented element")}function Il(n){return new Er({documentKey:n.getDocumentKey(),checkpoint:ul(n.getCheckpoint()),isRemoved:n.getIsRemoved(),changes:dl(n.getChanges()),snapshot:n.getSnapshot(),versionVector:Vs(n.getVersionVector())})}function pn(n){if(!(n instanceof $))return{};const t=n.findDetails(qu);for(const e of t)return e.metadata;return{}}function Xr(n){return pn(n).code??""}function Wi(n,t){return n instanceof $&&Xr(n)===t}function Qa(n){return Oe.of(n.clientSeq,BigInt(n.lamport),Zs(n.actorId),Gs(n.versionVector),BigInt(n.serverSeq))}function Gs(n){if(!n)return;const t=new _r;return Object.entries(n.vector).forEach(([e,r])=>{const i=zi(Vl(e));t.set(i,BigInt(r.toString()))}),t}function x(n){if(n)return Pe.of(BigInt(n.lamport),n.delimiter,Zs(n.actorId))}function Hs(n){const t={};return Object.entries(n.data).forEach(([e,r])=>{t[e]=JSON.parse(r)}),t}function Al(n){const t=n.type;if(t===Kr.PUT){const e=Hs(n.presence);return{type:Qe.Put,presence:e}}if(t===Kr.CLEAR)return{type:Qe.Clear};throw new g(d.ErrInvalidType,`unsupported type: ${t}`)}function kl(n){const t=new Map;return Object.entries(n).forEach(([e,r])=>{t.set(e,Hs(r))}),t}function _a(n){switch(n){case P.NULL:return M.Null;case P.BOOLEAN:return M.Boolean;case P.INTEGER:return M.Integer;case P.LONG:return M.Long;case P.DOUBLE:return M.Double;case P.STRING:return M.String;case P.BYTES:return M.Bytes;case P.DATE:return M.Date}throw new g(d.ErrUnimplemented,`unimplemented value type: ${n}`)}function Di(n){switch(n){case P.INTEGER_CNT:return et.Int;case P.LONG_CNT:return et.Long}throw new g(d.ErrUnimplemented,`unimplemented value type: ${n}`)}function Wn(n){switch(n.type){case P.JSON_OBJECT:return n.value?oc(n.value):ne.create(x(n.createdAt));case P.JSON_ARRAY:return n.value?zl(n.value):ie.create(x(n.createdAt));case P.TEXT:return fe.create(fn.create(),x(n.createdAt));case P.TREE:return Ul(n.value);case P.NULL:case P.BOOLEAN:case P.INTEGER:case P.LONG:case P.DOUBLE:case P.STRING:case P.BYTES:case P.DATE:return K.of(K.valueFromBytes(_a(n.type),n.value),x(n.createdAt));case P.INTEGER_CNT:case P.LONG_CNT:return ce.create(Di(n.type),ce.valueFromBytes(Di(n.type),n.value),x(n.createdAt))}}function Gn(n){return Fe.of(Ze.of(x(n.createdAt),n.offset),n.relativeOffset)}function ec(n){return Ze.of(x(n.createdAt),n.offset)}function El(n){const t=Bn.create(n.value);Object.entries(n.attributes).forEach(([r,i])=>{t.setAttr(r,i.value,x(i.updatedAt))});const e=Br.create(ec(n.id),t);return e.setRemovedAt(x(n.removedAt)),e}function Hr(n){return Me.of(bn(n.parentId),bn(n.leftSiblingId))}function bn(n){return re.of(x(n.createdAt),n.offset)}function xl(n){if(!n.length)return;const t=[];return n.forEach(e=>{const r=Ys(e.content);t.push(r)}),t}function Ys(n){if(n.length===0)return;const t=[];for(const i of n)t.push(Pl(i));const e=t[t.length-1],r=new Map;r.set(n[t.length-1].depth,t[t.length-1]);for(let i=t.length-2;i>=0;i--)r.get(n[i].depth-1).prepend(t[i]),r.set(n[i].depth,t[i]);return e.updateDescendantsSize(),e.updateDescendantsSize(!0),de.create(e,an).getRoot()}function Nl(n){const t=Ar.create();for(const[e,r]of Object.entries(n))t.setInternal(e,r.value,x(r.updatedAt),r.isRemoved);return t}function Pl(n){const t=bn(n.id),e=he.create(t,n.type),r=Object.entries(n.attributes);return e.isText?e.value=n.value:r.length&&(e.attrs=Nl(n.attributes)),n.insPrevId&&(e.insPrevID=bn(n.insPrevId)),n.insNextId&&(e.insNextID=bn(n.insNextId)),e.removedAt=x(n.removedAt),e}function tc(n){if(n.body.case==="set"){const t=n.body.value;return jr.create(t.key,Wn(t.value),x(t.parentCreatedAt),x(t.executedAt))}else if(n.body.case==="add"){const t=n.body.value;return Lr.create(x(t.parentCreatedAt),x(t.prevCreatedAt),Wn(t.value),x(t.executedAt))}else if(n.body.case==="move"){const t=n.body.value;return $e.create(x(t.parentCreatedAt),x(t.prevCreatedAt),x(t.createdAt),x(t.executedAt))}else if(n.body.case==="remove"){const t=n.body.value;return _e.create(x(t.parentCreatedAt),x(t.createdAt),x(t.executedAt))}else if(n.body.case==="edit"){const t=n.body.value,e=new Map;return Object.entries(t.attributes).forEach(([r,i])=>{e.set(r,i)}),Rn.create(x(t.parentCreatedAt),Gn(t.from),Gn(t.to),t.content,e,x(t.executedAt))}else if(n.body.case==="style"){const t=n.body.value,e=new Map;return Object.entries(t.attributes).forEach(([r,i])=>{e.set(r,i)}),$n.create(x(t.parentCreatedAt),Gn(t.from),Gn(t.to),e,x(t.executedAt))}else if(n.body.case==="increase"){const t=n.body.value;return dn.create(x(t.parentCreatedAt),Wn(t.value),x(t.executedAt))}else if(n.body.case==="treeEdit"){const t=n.body.value;return Mn.create(x(t.parentCreatedAt),Hr(t.from),Hr(t.to),xl(t.contents),t.splitLevel,x(t.executedAt))}else if(n.body.case==="treeStyle"){const t=n.body.value,e=new Map,r=t.attributesToRemove;return(r==null?void 0:r.length)>0?Ir.createTreeRemoveStyleOperation(x(t.parentCreatedAt),Hr(t.from),Hr(t.to),r,x(t.executedAt)):(Object.entries(t.attributes).forEach(([i,s])=>{e.set(i,s)}),Ir.create(x(t.parentCreatedAt),Hr(t.from),Hr(t.to),e,x(t.executedAt)))}else if(n.body.case==="arraySet"){const t=n.body.value;return kr.create(x(t.parentCreatedAt),x(t.createdAt),Wn(t.value),x(t.executedAt))}else throw new g(d.ErrUnimplemented,"unimplemented operation")}function Cl(n){const t=[];for(const e of n){const r=tc(e);r&&t.push(r)}return t}function rc(n){const t=[];for(const e of n)t.push(hn.create({id:Qa(e.id),operations:Cl(e.operations),presenceChange:e.presenceChange?Al(e.presenceChange):void 0,message:e.message}));return t}function Dl(n){return en.of(BigInt(n.serverSeq),n.clientSeq)}function Bl(n){return Fi.create(n.documentKey,Dl(n.checkpoint),n.isRemoved,rc(n.changes),Gs(n.versionVector),n.snapshot)}function nc(n){const t=new cn;for(const r of n.nodes){const i=Xs(r.element);t.set(r.key,i,i.getPositionedAt())}const e=new ne(x(n.createdAt),t);return e.setMovedAt(x(n.movedAt)),e.setRemovedAt(x(n.removedAt)),e}function ic(n){const t=new Dn;for(const r of n.nodes)t.insert(Xs(r.element));const e=new ie(x(n.createdAt),t);return e.setMovedAt(x(n.movedAt)),e.setRemovedAt(x(n.removedAt)),e}function Ol(n){const t=K.of(K.valueFromBytes(_a(n.type),n.value),x(n.createdAt));return t.setMovedAt(x(n.movedAt)),t.setRemovedAt(x(n.removedAt)),t}function Ll(n){const t=new fn;let e=t.getHead();for(const i of n.nodes){const s=t.insertAfter(e,El(i));i.insPrevId&&s.setInsPrev(t.findNode(ec(i.insPrevId))),e=s}const r=new fe(t,x(n.createdAt));return r.setMovedAt(x(n.movedAt)),r.setRemovedAt(x(n.removedAt)),r}function Jl(n){const t=ce.create(Di(n.type),ce.valueFromBytes(Di(n.type),n.value),x(n.createdAt));return t.setMovedAt(x(n.movedAt)),t.setRemovedAt(x(n.removedAt)),t}function sc(n){const t=Ys(n.nodes);return de.create(t,x(n.createdAt))}function Xs(n){if(n.body.case==="jsonObject")return nc(n.body.value);if(n.body.case==="jsonArray")return ic(n.body.value);if(n.body.case==="primitive")return Ol(n.body.value);if(n.body.case==="text")return Ll(n.body.value);if(n.body.case==="counter")return Jl(n.body.value);if(n.body.case==="tree")return sc(n.body.value);throw new g(d.ErrUnimplemented,"unimplemented element")}function Rl(n){return n.map(t=>({path:t.path,type:t.type}))}function $l(n){if(!n)return{root:ne.create(an),presences:new Map};const t=Xi.fromBinary(n);return{root:Xs(t.root),presences:kl(t.presences)}}function Ml(n){const t=Vs(n);return zi(t.toBinary())}function Fl(n){const t=Qs(n),e=Ri.fromBinary(t);return Gs(e)}function oc(n){if(!n)throw new g(d.ErrInvalidArgument,"bytes is empty");const t=ue.fromBinary(n);return nc(t.body.value)}function ac(n){return Ws(n).toBinary()}function zl(n){if(!n)throw new g(d.ErrInvalidArgument,"bytes is empty");const t=ue.fromBinary(n);return ic(t.body.value)}function ql(n){return Xa(n).toBinary()}function Ul(n){if(!n)throw new g(d.ErrInvalidArgument,"bytes is empty");const t=ue.fromBinary(n);return sc(t.body.value)}function Kl(n){return Za(n).toBinary()}function zi(n){return n?Array.from(n).map(t=>t.toString(16).padStart(2,"0")).join(""):""}function Zs(n){return zi(n)}function Qs(n){return new Uint8Array(n.match(/.{1,2}/g).map(t=>parseInt(t,16)))}function Vl(n){if(typeof window<"u"&&typeof window.atob=="function"){const t=window.atob(n),e=t.length,r=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t.charCodeAt(i);return r}else if(typeof globalThis<"u"&&typeof globalThis.Buffer<"u"){const t=globalThis.Buffer;return new Uint8Array(t.from(n,"base64"))}else throw new Error("No base64 decoder available")}function qi(n){return Qs(n)}function jl(n){if(typeof window<"u"&&typeof window.btoa=="function"){let t="";for(let e=0;e<n.byteLength;e++)t+=String.fromCharCode(n[e]);return window.btoa(t)}else{if(typeof globalThis<"u"&&typeof globalThis.Buffer<"u")return globalThis.Buffer.from(n).toString("base64");throw new Error("No base64 encoder available")}}function Wl(n){const t=Ji.fromBinary(n);return Qa(t)}function Gl(n){const t=Fs.fromBinary(n);return tc(t)}const j={fromPresence:Hs,toChangePack:Il,fromChangePack:Bl,fromChanges:rc,toTreeNodes:js,fromTreeNodes:Ys,objectToBytes:ac,bytesToObject:oc,bytesToSnapshot:$l,bytesToHex:zi,hexToBytes:Qs,toHexString:Zs,toUint8Array:qi,toOperation:Ya,toChangeID:Wa,PbChangeID:Ji,bytesToChangeID:Wl,bytesToOperation:Gl,versionVectorToHex:Ml,hexToVersionVector:Fl,fromSchemaRules:Rl};var oe=(n=>(n[n.Trivial=0]="Trivial",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warn=3]="Warn",n[n.Error=4]="Error",n[n.Fatal=5]="Fatal",n))(oe||{});let Jr=3;function Hl(n){Jr=n}const I={trivial:(...n)=>{Jr>0||typeof console<"u"&&console.log("YORKIE T:",...n)},debug:(...n)=>{Jr>1||typeof console<"u"&&console.log("YORKIE D:",...n)},info:(...n)=>{Jr>2||typeof console<"u"&&console.log("YORKIE I:",...n)},warn:(...n)=>{Jr>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...n):console.log("YORKIE W:",...n))},error:(...n)=>{Jr>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...n):console.log("YORKIE E:",...n))},fatal:(...n)=>{typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...n):console.log("YORKIE F:",...n))},isEnabled:n=>Jr<=n};function cc(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,n=>{const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)})}const Gi=()=>{};class Yl{constructor(t){o(this,"finalized",!1);o(this,"observers",[]);o(this,"finalError");try{t(this)}catch(e){this.error(e)}}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let i;if(!t)throw new g(d.ErrInvalidArgument,"missing observer");if(this.finalized)throw new g(d.ErrRefused,"observable is finalized due to previous error");typeof t=="object"?i=t:i={next:t,error:e,complete:r},i.next===void 0&&(i.next=Gi),i.error===void 0&&(i.error=Gi),i.complete===void 0&&(i.complete=Gi);const s=cc(),a=this.unsubscribeOne.bind(this,s);if(this.observers.push({subscriptionID:s,observer:i}),this.finalized)try{this.finalError?i.error(this.finalError):i.complete()}catch(c){I.warn(c)}return a}unsubscribeOne(t){var e;this.observers=(e=this.observers)==null?void 0:e.filter(r=>r.subscriptionID!==t)}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t].observer)}catch(r){I.error(r)}}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.observers=void 0)}}function uc(n){const t=new Yl(n);return{subscribe:t.subscribe.bind(t),getProxy:()=>t}}class In{constructor(t,e,r,i){o(this,"prevID");o(this,"nextID");o(this,"delimiter");o(this,"message");o(this,"root");o(this,"operations");o(this,"presenceChange");o(this,"previousPresence");o(this,"reversePresenceKeys");this.prevID=t,this.nextID=t.next(),this.delimiter=Oa,this.root=e,this.operations=[],this.previousPresence=Be(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=i}static create(t,e,r,i){return new In(t,e,r,i)}push(t){this.operations.push(t)}registerElement(t,e){this.root.registerElement(t,e)}registerRemovedElement(t){this.root.registerRemovedElement(t)}registerGCPair(t){this.root.registerGCPair(t)}getNextID(){return this.isPresenceOnlyChange()?this.prevID.next(!0).setLamport(this.prevID.getLamport()).setVersionVector(this.prevID.getVersionVector()):this.nextID}toChange(){const t=this.isPresenceOnlyChange()?this.prevID.next(!0):this.nextID;return hn.create({id:t,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}isPresenceOnlyChange(){return this.operations.length===0}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(t){this.presenceChange=t}setReversePresence(t,e){for(const r of Object.keys(t))e!=null&&e.addToHistory?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const t={};for(const e of this.reversePresenceKeys)t[e]=this.previousPresence[e];return t}issueTimeTicket(){return this.delimiter+=1,this.nextID.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.nextID.createTimeTicket(this.delimiter)}acc(t){this.root.acc(t)}}function lc(n,t){const e=new On(n);return new Proxy(t,e.getHandlers())}class On{constructor(t){o(this,"context");o(this,"handlers");this.context=t,this.handlers={set:(e,r,i)=>(I.isEnabled(oe.Trivial)&&I.trivial(`obj[${r}]=${JSON.stringify(i)}`),On.setInternal(t,e,r,i),!0),get:(e,r)=>(I.isEnabled(oe.Trivial)&&I.trivial(`obj[${r}]`),r==="getID"?()=>e.getCreatedAt():r==="toJSON"||r==="toString"?()=>e.toJSON():r==="toJS"?()=>e.toJS():r==="toJSForTest"?()=>e.toJSForTest():Rr(t,e.get(r))),ownKeys:e=>e.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(e,r)=>(I.isEnabled(oe.Trivial)&&I.trivial(`obj[${r}]`),On.deleteInternal(t,e,r),!0)}}static setInternal(t,e,r,i){if(r.includes("."))throw new g(d.ErrInvalidObjectKey,"key must not contain the '.'.");const s=t.issueTimeTicket(),a=An(t,i,s),c=e.set(r,a,s);t.registerElement(a,e),c&&t.registerRemovedElement(c),t.push(jr.create(r,a.deepcopy(),e.getCreatedAt(),s))}static buildObjectMembers(t,e){const r={};for(const[i,s]of Object.entries(e)){if(i.includes("."))throw new g(d.ErrInvalidObjectKey,"key must not contain the '.'.");const a=t.issueTimeTicket(),c=An(t,s,a);r[i]=c}return r}static deleteInternal(t,e,r){const i=t.issueTimeTicket(),s=e.deleteByKey(r,i);s&&(t.push(_e.create(e.getCreatedAt(),s.getCreatedAt(),i)),t.registerRemovedElement(s))}getHandlers(){return this.handlers}}function Xl(n,t){const e=new R(n,t);return new Proxy(t,e.getHandlers())}function Go(n){return typeof n=="string"||n instanceof String?!isNaN(n):!1}function Zl(n){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(n)}class R{constructor(t,e){o(this,"context");o(this,"handlers");o(this,"array");this.context=t,this.array=e,this.handlers={get:(r,i,s)=>i==="getID"?()=>r.getCreatedAt():i==="getElementByID"?a=>{const c=r.getByID(a);if(!(!c||c.isRemoved()))return De(t,c)}:i==="getElementByIndex"?a=>{const c=r.get(a);return De(t,c)}:i==="getLast"?()=>De(t,r.getLast()):i==="delete"?a=>{const c=R.deleteInternalByIndex(t,r,a);return De(t,c)}:i==="deleteByID"?a=>{const c=R.deleteInternalByID(t,r,a);return De(t,c)}:i==="insertAfter"?(a,c)=>{const l=R.insertAfterInternal(t,r,a,c);return De(t,l)}:i==="insertIntegerAfter"?(a,c)=>{const l=R.insertIntegerAfterInternal(t,r,a,c);return De(t,l)}:i==="insertBefore"?(a,c)=>{const l=R.insertBeforeInternal(t,r,a,c);return De(t,l)}:i==="setValue"?(a,c)=>{const l=R.setValueInternal(t,r,a,c);return De(t,l)}:i==="moveBefore"?(a,c)=>{R.moveBeforeInternal(t,r,a,c)}:i==="moveAfter"?(a,c)=>{R.moveAfterInternal(t,r,a,c)}:i==="moveAfterByIndex"?(a,c)=>{R.moveAfterByIndexInternal(t,r,a,c)}:i==="moveFront"?a=>{R.moveFrontInternal(t,r,a)}:i==="moveLast"?a=>{R.moveLastInternal(t,r,a)}:Go(i)?Rr(t,r.get(Number(i))):i==="push"?a=>R.pushInternal(t,r,a):i==="splice"?(a,c,...l)=>R.splice(t,r,a,c,...l):i==="length"?r.length:typeof i=="symbol"&&i===Symbol.iterator?R.iteratorInternal.bind(this,t,r):i==="includes"?(a,c)=>R.includes(t,r,a,c):i==="indexOf"?(a,c)=>R.indexOf(t,r,a,c):i==="lastIndexOf"?(a,c)=>R.lastIndexOf(t,r,a,c):i==="toJSForTest"?()=>r.toJSForTest():i==="toTestString"?()=>R.toTestString(r):typeof i=="string"&&Zl(i)?(...a)=>{const c=Array.from(r).map(l=>Rr(t,l));return Array.prototype[i].apply(c,a)}:Reflect.get(r,i,s),set:(r,i,s)=>{if(Go(i)){const a=Number(i);return R.setValueInternal(t,r,a,s),!0}return Reflect.set(r,i,s)},deleteProperty:(r,i)=>(I.isEnabled(oe.Trivial)&&I.trivial(`array[${i}]`),R.deleteInternalByIndex(t,r,Number.parseInt(i)),!0)}}static*iteratorInternal(t,e){for(const r of e)yield De(t,r)}static buildArrayElements(t,e){const r=[];for(const i of e){const s=t.issueTimeTicket(),a=An(t,i,s);r.push(a)}return r}static pushInternal(t,e,r){return R.insertAfterInternal(t,e,e.getLastCreatedAt(),r),e.length}static moveBeforeInternal(t,e,r,i){const s=t.issueTimeTicket(),a=e.getPrevCreatedAt(r);e.moveAfter(a,i,s),t.push($e.create(e.getCreatedAt(),a,i,s))}static moveAfterInternal(t,e,r,i){const s=t.issueTimeTicket();t.push($e.create(e.getCreatedAt(),r,i,s)),e.moveAfter(r,i,s)}static moveAfterByIndexInternal(t,e,r,i){const s=e.get(r);if(!s)throw new g(d.ErrInvalidArgument,`index out of bounds: ${r}`);const a=e.get(i);if(!a)throw new g(d.ErrInvalidArgument,`index out of bounds: ${i}`);R.moveAfterInternal(t,e,s.getCreatedAt(),a.getCreatedAt())}static moveFrontInternal(t,e,r){const i=t.issueTimeTicket(),s=e.getHead();e.moveAfter(s.getCreatedAt(),r,i),t.push($e.create(e.getCreatedAt(),s.getCreatedAt(),r,i))}static moveLastInternal(t,e,r){const i=t.issueTimeTicket(),s=e.getLastCreatedAt();e.moveAfter(s,r,i),t.push($e.create(e.getCreatedAt(),s,r,i))}static insertAfterInternal(t,e,r,i){const s=t.issueTimeTicket(),a=An(t,i,s);return e.insertAfter(r,a),t.registerElement(a,e),t.push(Lr.create(e.getCreatedAt(),r,a.deepcopy(),s)),a}static insertIntegerAfterInternal(t,e,r,i){const s=e.get(r);if(!s)throw new g(d.ErrInvalidArgument,`index out of bounds: ${r}`);return R.insertAfterInternal(t,e,s.getCreatedAt(),i),e}static insertBeforeInternal(t,e,r,i){return R.insertAfterInternal(t,e,e.getPrevCreatedAt(r),i)}static setValueInternal(t,e,r,i){const s=e.get(r);if(!s)throw new g(d.ErrInvalidArgument,`index out of bounds: ${r}`);return R.setByIndexInternal(t,e,s.getCreatedAt(),i),e}static setByIndexInternal(t,e,r,i){const s=t.issueTimeTicket(),a=An(t,i,s),c=a.deepcopy();return t.push(kr.create(e.getCreatedAt(),r,c,s)),e.set(r,a,s),t.registerElement(a,e),a}static deleteInternalByIndex(t,e,r){const i=t.issueTimeTicket(),s=e.deleteByIndex(r,i);if(s)return t.push(_e.create(e.getCreatedAt(),s.getCreatedAt(),i)),t.registerRemovedElement(s),s}static deleteInternalByID(t,e,r){const i=t.issueTimeTicket(),s=e.delete(r,i);return t.push(_e.create(e.getCreatedAt(),s.getCreatedAt(),i)),t.registerRemovedElement(s),s}static splice(t,e,r,i,...s){const a=e.length,c=r>=0?Math.min(r,a):Math.max(a+r,0),l=i===void 0?a:i<0?c:Math.min(c+i,a),h=[];for(let f=c;f<l;f++){const m=R.deleteInternalByIndex(t,e,c);if(m){const y=m.deepcopy();y.setRemovedAt(),h.push(Rr(t,y))}}if(s){let f=c===0?e.getHead().getID():e.get(c-1).getID();for(const m of s)f=R.insertAfterInternal(t,e,f,m).getID()}return h}static includes(t,e,r,i){var c;const s=e.length,a=i===void 0?0:i<0?Math.max(i+s,0):i;if(a>=s)return!1;if(K.isSupport(r))return Array.from(e).map(h=>Rr(t,h)).includes(r,a);for(let l=a;l<s;l++)if(((c=e.get(l))==null?void 0:c.getID())===r.getID())return!0;return!1}static indexOf(t,e,r,i){var c;const s=e.length,a=i===void 0?0:i<0?Math.max(i+s,0):i;if(a>=s)return-1;if(K.isSupport(r))return Array.from(e).map(h=>Rr(t,h)).indexOf(r,a);for(let l=a;l<s;l++)if(((c=e.get(l))==null?void 0:c.getID())===r.getID())return l;return-1}static lastIndexOf(t,e,r,i){var c;const s=e.length,a=i===void 0||i>=s?s-1:i<0?i+s:i;if(a<0)return-1;if(K.isSupport(r))return Array.from(e).map(h=>Rr(t,h)).lastIndexOf(r,a);for(let l=a;l>0;l--)if(((c=e.get(l))==null?void 0:c.getID())===r.getID())return l;return-1}static toTestString(t){return t.toTestString()}getHandlers(){return this.handlers}}class _s{constructor(t,e){o(this,"context");o(this,"text");this.context=t,this.text=e}initialize(t,e){this.context=t,this.text=e}getID(){return this.text.getID()}edit(t,e,r,i){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");if(t>e)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.text.indexRangeToPosRange(t,e);I.isEnabled(oe.Debug)&&I.debug(`EDIT: f:${t}->${s[0].toTestString()}, t:${e}->${s[1].toTestString()} c:${r}`);const a=i?ln(i):void 0,c=this.context.issueTimeTicket(),[,l,h,f]=this.text.edit(s,r,c,a);this.context.acc(h);for(const m of l)this.context.registerGCPair(m);return this.context.push(new Rn(this.text.getCreatedAt(),s[0],s[1],r,a?new Map(Object.entries(a)):new Map,c)),this.text.findIndexesFromRange(f)}delete(t,e){return this.edit(t,e,"")}empty(){return this.edit(0,this.length,"")}setStyle(t,e,r){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");if(t>e)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.text.indexRangeToPosRange(t,e);I.isEnabled(oe.Debug)&&I.debug(`STYL: f:${t}->${i[0].toTestString()}, t:${e}->${i[1].toTestString()} a:${JSON.stringify(r)}`);const s=ln(r),a=this.context.issueTimeTicket(),[c,l]=this.text.setStyle(i,s,a);this.context.acc(l);for(const h of c)this.context.registerGCPair(h);return this.context.push(new $n(this.text.getCreatedAt(),i[0],i[1],new Map(Object.entries(s)),a)),!0}indexRangeToPosRange(t){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");const e=this.text.indexRangeToPosRange(t[0],t[1]);return[e[0].toStruct(),e[1].toStruct()]}posRangeToIndexRange(t){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");const e=this.text.findIndexesFromRange([Fe.fromStruct(t[0]),Fe.fromStruct(t[1])]);return[e[0],e[1]]}toTestString(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(t,e){if(!this.context||!this.text)throw new g(d.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(t,e)}}class eo{constructor(t,e){o(this,"valueType");o(this,"value");o(this,"context");o(this,"counter");this.valueType=t,this.value=e}initialize(t,e){this.valueType=e.getValueType(),this.context=t,this.counter=e,this.value=e.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(t){if(!this.context||!this.counter)throw new g(d.ErrNotInitialized,"Counter is not initialized yet");const e=this.context.issueTimeTicket(),r=K.of(t,e);if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`);return this.counter.increase(r),this.context.push(dn.create(this.counter.getCreatedAt(),r,e)),this}toJSForTest(){if(!this.context||!this.counter)throw new g(d.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}}function to(n){if(n.isText)return{type:n.type,value:n.value};const t={type:n.type,children:n.children.map(e=>to(e))};return n.attrs&&(t.attributes=br(n.attrs.toObject())),t}function Ql(n,t){const e={type:n.isText?n.parent.type:n.type,children:n.isText?n.parent.getChildrenText().length===t?[]:[{type:Xe,value:n.parent.getChildrenText().slice(t)}]:n.children.slice(t).map(r=>to(r))};return n.attrs?e.attributes=br(n.attrs.toObject()):n.isText&&n.parent.attrs&&(e.attributes=br(n.parent.attrs.toObject())),e}function _l(n,t){const{node:e}=n,r=[...t].slice(0,-1),i=e.isText?e.parent.getChildrenText().length:e.children.length,s=[...r,i],a=[...r],c=[];a[a.length-1]+=1,t.every((h,f)=>h===s[f])||c.push({fromPath:[...t],toPath:s});const l=Ql(e,t[t.length-1]);return l&&c.push({fromPath:a,toPath:a,content:l}),c}function eh(n,t){const{node:e,offset:r}=n,i=e.children[r],s=e.children[r-1],{children:a}=i,c=[...t].slice(0,-1),l=[{fromPath:[...t],toPath:[...c,r+1]}];if(!i.children.length)return l;const h=[...c,r-1,s.hasTextChild()?s.getChildrenText().length:s.children.length],f=a.map(m=>to(m));return l.push({fromPath:h,toPath:h,content:f}),l}function ro(n,t,e){const{type:r}=n,i=e.issueTimeTicket();if(r===Xe){hc(n);const{value:s}=n,a=he.create(re.of(i,0),r,s);t.append(a)}else{const{children:s=[]}=n,{attributes:a}=n;let c;if(typeof a=="object"&&!Fa(a)){const h=ln(a);c=new Ar;for(const[f,m]of Object.entries(h))c.set(f,m,i)}const l=he.create(re.of(i,0),r,void 0,c);t.append(l);for(const h of s)ro(h,l,e)}}function th(n,t){const{type:e}=t,r=n.issueTimeTicket();let i;if(t.type===Xe){const{value:s}=t;i=he.create(re.of(r,0),e,s)}else if(t){const{children:s=[]}=t,{attributes:a}=t;let c;if(typeof a=="object"&&!Fa(a)){const l=ln(a);c=new Ar;for(const[h,f]of Object.entries(l))c.set(h,f,r)}i=he.create(re.of(n.issueTimeTicket(),0),e,void 0,c);for(const l of s)ro(l,i,n)}return i}function hc(n){if(!n.value.length)throw new g(d.ErrInvalidArgument,"text node cannot have empty value");return!0}function Ho(n){if(!n.length)return!0;if(n[0].type===Xe)for(const e of n){const{type:r}=e;if(r!==Xe)throw new g(d.ErrInvalidArgument,"element node and text node cannot be passed together");hc(e)}else for(const e of n){const{type:r}=e;if(r===Xe)throw new g(d.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class no{constructor(t){o(this,"initialRoot");o(this,"context");o(this,"tree");this.initialRoot=t}initialize(t,e){this.context=t,this.tree=e}getID(){return this.tree.getID()}buildRoot(t){if(!this.initialRoot)return he.create(re.of(t.issueTimeTicket(),0),Xu);const e=he.create(re.of(t.issueTimeTicket(),0),this.initialRoot.type);for(const r of this.initialRoot.children)ro(r,e,t);return e}getSize(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}splitByPath(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(!t.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const e=this.tree.pathToTreePos(t),r=_l(e,t);for(const i of r){const{fromPath:s,toPath:a,content:c}=i,l=this.tree.pathToPos(s),h=this.tree.pathToPos(a);this.editInternal(l,h,c?[c]:[],0)}}mergeByPath(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(!t.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const e=this.tree.pathToTreePos(t);if(e.node.isText)throw new g(d.ErrInvalidArgument,"text node cannot be merged");const r=eh(e,t);for(const i of r){const{fromPath:s,toPath:a,content:c}=i,l=this.tree.pathToPos(s),h=this.tree.pathToPos(a);this.editInternal(l,h,c??[],0)}}styleByPath(t,e){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(!t.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const[r,i]=this.tree.pathToPosRange(t),s=this.context.issueTimeTicket(),a=e?ln(e):void 0,[c,,l]=this.tree.style([r,i],a,s);this.context.acc(l);for(const h of c)this.context.registerGCPair(h);this.context.push(Ir.create(this.tree.getCreatedAt(),r,i,a?new Map(Object.entries(a)):new Map,s))}style(t,e,r){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(t),s=this.tree.findPos(e),a=this.context.issueTimeTicket(),c=r?ln(r):void 0,[l,,h]=this.tree.style([i,s],c,a);this.context.acc(h);for(const f of l)this.context.registerGCPair(f);this.context.push(Ir.create(this.tree.getCreatedAt(),i,s,c?new Map(Object.entries(c)):new Map,a))}removeStyle(t,e,r){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(t),s=this.tree.findPos(e),a=this.context.issueTimeTicket(),[c,,l]=this.tree.removeStyle([i,s],r,a);this.context.acc(l);for(const h of c)this.context.registerGCPair(h);this.context.push(Ir.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),i,s,r,a))}editInternal(t,e,r,i=0){var h;if(r.length!==0&&r[0]&&(Ho(r),r[0].type!==Xe))for(const f of r){const{children:m=[]}=f;Ho(m)}const s=this.context.getLastTimeTicket();let a=new Array;if(((h=r[0])==null?void 0:h.type)===Xe){let f="";for(const m of r){const{value:y}=m;f+=y}a.push(he.create(re.of(this.context.issueTimeTicket(),0),Xe,f))}else a=r.map(f=>f&&th(this.context,f)).filter(f=>f);const[,c,l]=this.tree.edit([t,e],a.length?a.map(f=>f==null?void 0:f.deepcopy()):void 0,i,s,()=>this.context.issueTimeTicket());this.context.acc(l);for(const f of c)this.context.registerGCPair(f);return this.context.push(Mn.create(this.tree.getCreatedAt(),t,e,a.length?a:void 0,i,s)),!0}editByPath(t,e,r,i=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(t.length!==e.length)throw new g(d.ErrInvalidArgument,"path length should be equal");if(!t.length||!e.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const s=this.tree.pathToPos(t),a=this.tree.pathToPos(e);return this.editInternal(s,a,r?[r]:[],i)}editBulkByPath(t,e,r,i=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(t.length!==e.length)throw new g(d.ErrInvalidArgument,"path length should be equal");if(!t.length||!e.length)throw new g(d.ErrInvalidArgument,"path should not be empty");const s=this.tree.pathToPos(t),a=this.tree.pathToPos(e);return this.editInternal(s,a,r,i)}edit(t,e,r,i=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(t),a=this.tree.findPos(e);return this.editInternal(s,a,r?[r]:[],i)}editBulk(t,e,r,i=0){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new g(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(t),a=this.tree.findPos(e);return this.editInternal(s,a,r,i)}toXML(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(t)}pathToIndex(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(t)}pathRangeToPosRange(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");const e=[this.tree.pathToIndex(t[0]),this.tree.pathToIndex(t[1])],r=this.tree.indexRangeToPosRange(e);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(t)}posRangeToIndexRange(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");const e=[Me.fromStruct(t[0]),Me.fromStruct(t[1])];return this.tree.posRangeToIndexRange(e)}posRangeToPathRange(t){if(!this.context||!this.tree)throw new g(d.ErrNotInitialized,"Tree is not initialized yet");const e=[Me.fromStruct(t[0]),Me.fromStruct(t[1])];return this.tree.posRangeToPathRange(e)}}function Yo(n,t){return lc(n,t)}function De(n,t){if(t){if(t instanceof K)return t;if(t instanceof ne)return lc(n,t);if(t instanceof ie)return Xl(n,t);if(t instanceof fe)return new _s(n,t);if(t instanceof ce){const e=new eo(et.Int,0);return e.initialize(n,t),e}else if(t instanceof de){const e=new no;return e.initialize(n,t),e}}else return;throw new TypeError(`Unsupported type of element: ${typeof t}`)}function Rr(n,t){const e=De(n,t);return e instanceof K?e.getValue():e}function An(n,t,e){let r;if(K.isSupport(t))r=K.of(t,e);else if(Array.isArray(t))r=ie.create(e,R.buildArrayElements(n,t));else if(typeof t=="object")t instanceof _s?(r=fe.create(fn.create(),e),t.initialize(n,r)):t instanceof eo?(r=ce.create(t.getValueType(),t.getValue(),e),t.initialize(n,r)):t instanceof no?(r=de.create(t.buildRoot(n),e),t.initialize(n,r)):r=ne.create(e,On.buildObjectMembers(n,t));else throw new TypeError(`Unsupported type of value: ${typeof t}`);return r}class Ln{constructor(t){o(this,"rootObject");o(this,"elementPairMapByCreatedAt");o(this,"gcElementSetByCreatedAt");o(this,"gcPairMap");o(this,"docSize");this.rootObject=t,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.docSize={live:{data:0,meta:0},gc:{data:0,meta:0}},this.registerElement(t,void 0),t.getDescendants(e=>{if(e.getRemovedAt()&&this.registerRemovedElement(e),e instanceof fe||e instanceof de)for(const r of e.getGCPairs())this.registerGCPair(r);return!1})}static create(){return new Ln(ne.create(an))}findByCreatedAt(t){const e=this.elementPairMapByCreatedAt.get(t.toIDString());if(e)return e.element}findElementPairByCreatedAt(t){return this.elementPairMapByCreatedAt.get(t.toIDString())}createSubPaths(t){let e=this.elementPairMapByCreatedAt.get(t.toIDString());if(!e)return[];const r=[];for(;e.parent;){const i=e.element.getCreatedAt(),s=e.parent.subPathOf(i);if(s===void 0)throw new g(d.ErrInvalidArgument,`cant find the given element: ${i.toIDString()}`);r.unshift(s),e=this.elementPairMapByCreatedAt.get(e.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(t){return this.createSubPaths(t).join(".")}registerElement(t,e){this.elementPairMapByCreatedAt.set(t.getCreatedAt().toIDString(),{parent:e,element:t}),te(this.docSize.live,t.getDataSize()),t instanceof Dr&&t.getDescendants((r,i)=>(this.elementPairMapByCreatedAt.set(r.getCreatedAt().toIDString(),{parent:i,element:r}),te(this.docSize.live,r.getDataSize()),!1))}deregisterElement(t){let e=0;const r=i=>{const s=i.getCreatedAt().toIDString();zr(this.docSize.gc,i.getDataSize()),this.elementPairMapByCreatedAt.delete(s),this.gcElementSetByCreatedAt.delete(s),e++};return r(t),t instanceof Dr&&t.getDescendants(i=>(r(i),!1)),e}registerRemovedElement(t){te(this.docSize.gc,t.getDataSize()),zr(this.docSize.live,t.getDataSize()),this.docSize.live.meta+=Ye,this.gcElementSetByCreatedAt.add(t.getCreatedAt().toIDString())}registerGCPair(t){if(this.gcPairMap.get(t.child.toIDString())){this.gcPairMap.delete(t.child.toIDString());return}this.gcPairMap.set(t.child.toIDString(),t);const r=this.gcPairMap.get(t.child.toIDString()).child.getDataSize();te(this.docSize.gc,r),zr(this.docSize.live,r),t.child instanceof Pr||(this.docSize.live.meta+=Ye)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const t=new Set;for(const e of this.gcElementSetByCreatedAt){t.add(e);const r=this.elementPairMapByCreatedAt.get(e);r.element instanceof Dr&&r.element.getDescendants(i=>(t.add(i.getCreatedAt().toIDString()),!1))}return t.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}getDocSize(){return this.docSize}deepcopy(){return new Ln(this.rootObject.deepcopy())}garbageCollect(t){let e=0;for(const r of this.gcElementSetByCreatedAt){const i=this.elementPairMapByCreatedAt.get(r),s=i.element.getRemovedAt();s&&(t!=null&&t.afterOrEqual(s))&&(i.parent.purge(i.element),e+=this.deregisterElement(i.element))}for(const[,r]of this.gcPairMap){const i=r.child.getRemovedAt();i&&(t!=null&&t.afterOrEqual(i))&&(r.parent.purge(r.child),zr(this.docSize.gc,r.child.getDataSize()),this.gcPairMap.delete(r.child.toIDString()),e+=1)}return e}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}getStats(){return{elements:this.getElementMapSize(),gcPairs:this.gcPairMap.size,gcElements:this.getGarbageElementSetSize()}}acc(t){te(this.docSize.live,t)}*getGCElementPairs(){for(const t of this.gcElementSetByCreatedAt){const e=this.elementPairMapByCreatedAt.get(t);e&&(yield e)}}}class Xo{constructor(t,e){o(this,"context");o(this,"presence");this.context=t,this.presence=e}set(t,e){for(const r of Object.keys(t))this.presence[r]=t[r];this.context.setPresenceChange({type:Qe.Put,presence:Be(this.presence)}),this.context.setReversePresence(t,e)}get(t){return this.presence[t]}clear(){this.presence={},this.context.setPresenceChange({type:Qe.Clear})}}const Zo=50;class rh{constructor(){o(this,"undoStack",[]);o(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(t){this.undoStack.length>=Zo&&this.undoStack.shift(),this.undoStack.push(t)}popUndo(){return this.undoStack.pop()}pushRedo(t){this.redoStack.length>=Zo&&this.redoStack.shift(),this.redoStack.push(t)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}reconcileCreatedAt(t,e){const r=i=>{for(const s of i)for(const a of s)(a instanceof kr||a instanceof _e||a instanceof $e)&&a.getCreatedAt()===t&&a.setCreatedAt(e),(a instanceof Lr||a instanceof $e)&&a.getPrevCreatedAt()===t&&a.setPrevCreatedAt(e)};r(this.undoStack),r(this.redoStack)}}function nh(n,t){const e=[];for(const r of t){const i=ih(n,r.path),s=sh(i,r);if(!s.valid)for(const a of s.errors||[])e.push(a)}return{valid:e.length===0,errors:e}}function ih(n,t){if(!t.startsWith("$"))throw new Error(`Path must start with $, got ${t}`);const e=t.split(".");let r=n;for(let i=1;i<e.length;i++){const s=e[i];if(!(r instanceof ne))return;r=r.get(s)}return r}function sh(n,t){switch(t.type){case"string":case"boolean":case"integer":case"double":case"long":case"date":case"bytes":case"null":return ah(n,t);case"object":if(!(n instanceof ne))return{valid:!1,errors:[{path:t.path,message:`expected object at path ${t.path}`}]};break;case"array":if(!(n instanceof ie))return{valid:!1,errors:[{path:t.path,message:`expected array at path ${t.path}`}]};break;case"yorkie.Text":if(!(n instanceof fe))return{valid:!1,errors:[{path:t.path,message:`expected yorkie.Text at path ${t.path}`}]};break;case"yorkie.Tree":if(!(n instanceof de))return{valid:!1,errors:[{path:t.path,message:`expected yorkie.Tree at path ${t.path}`}]};break;case"yorkie.Counter":if(!(n instanceof ce))return{valid:!1,errors:[{path:t.path,message:`expected yorkie.Counter at path ${t.path}`}]};break;default:throw new Error(`Unknown rule type: ${t.type}`)}return{valid:!0}}function oh(n){switch(n){case"null":return M.Null;case"boolean":return M.Boolean;case"integer":return M.Integer;case"long":return M.Long;case"double":return M.Double;case"string":return M.String;case"bytes":return M.Bytes;case"date":return M.Date;default:throw new Error(`Unknown primitive type: ${n}`)}}function ah(n,t){return n instanceof K&&n.getType()===oh(t.type)?{valid:!0}:{valid:!1,errors:[{path:t.path,message:`expected ${t.type} at path ${t.path}`}]}}const ch="yorkie-devtools-panel",uh="yorkie-devtools-sdk";function lh(n){return[_.StatusChanged,_.Snapshot,_.LocalChange,_.RemoteChange,_.Initialized,_.Watched,_.Unwatched,_.PresenceChanged].includes(n.type)}function hh(n){return n.every(lh)}let Zr="disconnected";const Qo=new Map,ei=new Map;typeof window<"u"&&(window.docEventsForReplayByDocKey=ei);function Hn(n,t){(t!=null&&t.force||Zr!=="disconnected")&&window.postMessage({source:uh,...n},"*")}function fh(n){if(!n.isEnableDevtools()||typeof window>"u"||Qo.has(n.getKey()))return;ei.set(n.getKey(),[]);const t=n.subscribe("all",e=>{hh(e)&&(ei.get(n.getKey()).push(e),Zr==="synced"&&Hn({msg:"doc::sync::partial",docKey:n.getKey(),event:e}))});Qo.set(n.getKey(),[t]),Hn({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",e=>{var i;if(((i=e.data)==null?void 0:i.source)!==ch)return;switch(e.data.msg){case"devtools::connect":if(Zr!=="disconnected")break;Zr="connected",Hn({msg:"doc::available",docKey:n.getKey()}),I.info(`[YD] Devtools connected. Doc: ${n.getKey()}`);break;case"devtools::disconnect":Zr="disconnected",I.info(`[YD] Devtools disconnected. Doc: ${n.getKey()}`);break;case"devtools::subscribe":Zr="synced",Hn({msg:"doc::sync::full",docKey:n.getKey(),events:ei.get(n.getKey())}),I.info(`[YD] Devtools subscribed. Doc: ${n.getKey()}`);break}})}var Nr=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(Nr||{}),_=(n=>(n.StatusChanged="status-changed",n.ConnectionChanged="connection-changed",n.SyncStatusChanged="sync-status-changed",n.Snapshot="snapshot",n.LocalChange="local-change",n.RemoteChange="remote-change",n.Initialized="initialized",n.Watched="watched",n.Unwatched="unwatched",n.PresenceChanged="presence-changed",n.Broadcast="broadcast",n.LocalBroadcast="local-broadcast",n.AuthError="auth-error",n))(_||{}),ti=(n=>(n.Connected="connected",n.Disconnected="disconnected",n))(ti||{}),Js=(n=>(n.Synced="synced",n.SyncFailed="sync-failed",n))(Js||{});class pr{constructor(t,e){o(this,"key");o(this,"status");o(this,"opts");o(this,"maxSizeLimit");o(this,"schemaRules");o(this,"changeID");o(this,"checkpoint");o(this,"localChanges");o(this,"root");o(this,"presences");o(this,"clone");o(this,"internalHistory");o(this,"isUpdating");o(this,"onlineClients");o(this,"eventStream");o(this,"eventStreamObserver");o(this,"history");this.key=t,this.status="detached",this.opts=e||{},this.maxSizeLimit=0,this.schemaRules=[],this.changeID=il,this.checkpoint=sl,this.localChanges=[],this.root=Ln.create(),this.presences=new Map,this.onlineClients=new Set,this.internalHistory=new rh,this.isUpdating=!1,this.eventStream=uc(r=>this.eventStreamObserver=r),this.history={canUndo:()=>this.internalHistory.hasUndo()&&!this.isUpdating,canRedo:()=>this.internalHistory.hasRedo()&&!this.isUpdating,undo:()=>this.executeUndoRedo(!0),redo:()=>this.executeUndoRedo(!1)},fh(this)}update(t,e){var c,l,h;if(this.getStatus()==="removed")throw new g(d.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const r=this.changeID.getActorID(),i=In.create(this.changeID,this.clone.root,this.clone.presences.get(r)||{},e);try{const f=Yo(i,this.clone.root.getObject());this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,t(f,new Xo(i,this.clone.presences.get(r)))}catch(f){throw this.clone=void 0,f}finally{this.isUpdating=!1}const s=this.getSchemaRules();if(!i.isPresenceOnlyChange()&&s.length){const f=nh((c=this.clone)==null?void 0:c.root.getObject(),s);if(!f.valid)throw this.clone=void 0,new g(d.ErrDocumentSchemaValidationFailed,`schema validation failed: ${(l=f.errors)==null?void 0:l.map(m=>m.message).join(", ")}`)}const a=Hu((h=this.clone)==null?void 0:h.root.getDocSize());if(!i.isPresenceOnlyChange()&&this.maxSizeLimit>0&&this.maxSizeLimit<a)throw this.clone=void 0,new g(d.ErrDocumentSizeExceedsLimit,`document size exceeded: ${a} > ${this.maxSizeLimit}`);if(i.hasChange()){I.isEnabled(oe.Trivial)&&I.trivial(`trying to update a local change: ${this.toJSON()}`);const f=i.toChange(),{opInfos:m,reverseOps:y}=f.execute(this.root,this.presences,q.Local);for(const b of f.getOperations())b instanceof kr&&this.internalHistory.reconcileCreatedAt(b.getCreatedAt(),b.getValue().getCreatedAt());const p=i.getReversePresence();p&&y.push({type:"presence",value:p}),this.localChanges.push(f),y.length&&this.internalHistory.pushUndo(y),m.length&&this.internalHistory.clearRedo(),this.changeID=i.getNextID();const S=[];m.length&&S.push({type:"local-change",source:q.Local,value:{message:f.getMessage()||"",operations:m,actor:r,clientSeq:f.getID().getClientSeq(),serverSeq:f.getID().getServerSeq()},rawChange:this.isEnableDevtools()?f.toStruct():void 0}),f.hasPresenceChange()&&S.push({type:"presence-changed",source:q.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(S),I.isEnabled(oe.Trivial)&&I.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(t,e,r,i){if(typeof t=="string"){if(typeof e!="function")throw new g(d.ErrInvalidArgument,"Second argument must be a callback function");if(t==="presence"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="initialized"&&h.type!=="watched"&&h.type!=="unwatched"&&h.type!=="presence-changed"||c(h)},r,i)}if(t==="my-presence"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="initialized"&&h.type!=="presence-changed"||h.type==="presence-changed"&&h.value.clientID!==this.changeID.getActorID()||c(h)},r,i)}if(t==="others"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="watched"&&h.type!=="unwatched"&&h.type!=="presence-changed"||h.value.clientID!==this.changeID.getActorID()&&c(h)},r,i)}if(t==="connection"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="connection-changed"&&c(h)},r,i)}if(t==="status"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="status-changed"&&c(h)},r,i)}if(t==="sync"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="sync-status-changed"&&c(h)},r,i)}if(t==="local-broadcast"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="local-broadcast"&&c(h)},r)}if(t==="broadcast"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="broadcast"&&c(h)},r)}if(t==="auth-error"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="auth-error"&&c(h)},r)}if(t==="all"){const c=e;return this.eventStream.subscribe(c,r,i)}const s=t,a=e;return this.eventStream.subscribe(c=>{for(const l of c){if(l.type!=="local-change"&&l.type!=="remote-change")continue;const h=[];for(const f of l.value.operations)this.isSameElementOrChildOf(f.path,s)&&h.push(f);h.length&&a({...l,value:{...l.value,operations:h}})}},r,i)}if(typeof t=="function"){const s=t,a=e,c=r;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="snapshot"&&h.type!=="local-change"&&h.type!=="remote-change"||s(h)},a,c)}throw new g(d.ErrInvalidArgument,`"${t}" is not a valid`)}publish(t){this.eventStreamObserver&&this.eventStreamObserver.next(t)}applyChangePack(t){t.hasSnapshot()?this.applySnapshot(t.getCheckpoint().getServerSeq(),t.getVersionVector(),t.getSnapshot(),t.getCheckpoint().getClientSeq()):(this.applyChanges(t.getChanges(),q.Remote),this.removePushedLocalChanges(t.getCheckpoint().getClientSeq())),this.checkpoint=this.checkpoint.forward(t.getCheckpoint()),t.hasSnapshot()||this.garbageCollect(t.getVersionVector()),t.getIsRemoved()&&this.applyStatus("removed"),I.isEnabled(oe.Trivial)&&I.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:Be(this.presences)})}createChangePack(){const t=Array.from(this.localChanges),e=this.checkpoint.increaseClientSeq(t.length);return Fi.create(this.key,e,!1,t,this.getVersionVector())}setActor(t){for(const e of this.localChanges)e.setActor(t);this.changeID=this.changeID.setActor(t)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getClone(){return this.clone}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const t=In.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return Yo(t,this.clone.root.getObject())}getDocSize(){return this.root.getDocSize()}getMaxSizePerDocument(){return this.maxSizeLimit}setMaxSizePerDocument(t){this.maxSizeLimit=t}getSchemaRules(){return this.schemaRules}setSchemaRules(t){this.schemaRules=t}garbageCollect(t){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(t),this.root.garbageCollect(t))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getRootCRDT(){return this.root}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}getStats(){return this.root.getStats()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(t,e,r,i=-1){const{root:s,presences:a}=j.bytesToSnapshot(r);this.root=new Ln(s),this.presences=a,this.changeID=this.changeID.setClocks(e.maxLamport(),e),this.clone=void 0,this.removePushedLocalChanges(i),this.applyChanges(this.localChanges,q.Local),this.publish([{type:"snapshot",source:q.Remote,value:{serverSeq:t.toString(),snapshot:this.isEnableDevtools()?j.bytesToHex(r):void 0,snapshotVector:j.versionVectorToHex(e)}}])}applyChanges(t,e){I.isEnabled(oe.Debug)&&I.debug(`trying to apply ${t.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),I.isEnabled(oe.Trivial)&&I.trivial(t.map(r=>`${r.getID().toTestString()}	${r.toTestString()}`).join(`
`));for(const r of t)this.applyChange(r,e);I.isEnabled(oe.Debug)&&I.debug(`after appling ${t.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(t,e){this.ensureClone(),t.execute(this.clone.root,this.clone.presences,e);const r=[],i=t.getID().getActorID();if(t.hasPresenceChange()&&this.onlineClients.has(i)){const a=t.getPresenceChange();switch(a.type){case Qe.Put:r.push(this.presences.has(i)?{type:"presence-changed",source:e,value:{clientID:i,presence:a.presence}}:{type:"watched",source:q.Remote,value:{clientID:i,presence:a.presence}});break;case Qe.Clear:r.push({type:"unwatched",source:q.Remote,value:{clientID:i,presence:this.getPresence(i)}}),this.removeOnlineClient(i);break}}const{opInfos:s}=t.execute(this.root,this.presences,e);if(this.changeID=this.changeID.syncClocks(t.getID()),s.length){const a=this.isEnableDevtools()?t.toStruct():void 0;r.push(e===q.Remote?{type:"remote-change",source:e,value:{actor:i,clientSeq:t.getID().getClientSeq(),serverSeq:t.getID().getServerSeq(),message:t.getMessage()||"",operations:s},rawChange:a}:{type:"local-change",source:e,value:{actor:i,clientSeq:t.getID().getClientSeq(),serverSeq:t.getID().getServerSeq(),message:t.getMessage()||"",operations:s},rawChange:a})}r.length&&this.publish(r)}applyWatchStream(t){if(t.body.case==="initialization"){const e=t.body.value.clientIds,r=new Set;for(const i of e)i!==this.changeID.getActorID()&&r.add(i);this.setOnlineClients(r),this.publish([{type:"initialized",source:q.Local,value:this.getPresences()}]);return}if(t.body.case==="event"){const{type:e,publisher:r}=t.body.value,i=[];if(e===qr.DOCUMENT_WATCHED){if(this.onlineClients.has(r)&&this.hasPresence(r))return;this.addOnlineClient(r),this.hasPresence(r)&&i.push({type:"watched",source:q.Remote,value:{clientID:r,presence:this.getPresence(r)}})}else if(e===qr.DOCUMENT_UNWATCHED){const s=this.getPresence(r);this.removeOnlineClient(r),s&&i.push({type:"unwatched",source:q.Remote,value:{clientID:r,presence:s}})}else if(e===qr.DOCUMENT_BROADCAST&&t.body.value.body){const{topic:s,payload:a}=t.body.value.body,c=new TextDecoder;i.push({type:"broadcast",value:{clientID:r,topic:s,payload:JSON.parse(c.decode(a))}})}i.length&&this.publish(i)}}applyStatus(t){this.status=t,t==="detached"&&this.setActor(qs),this.publish([{source:t==="removed"?q.Remote:q.Local,type:"status-changed",value:t==="attached"?{status:t,actorID:this.changeID.getActorID()}:{status:t}}])}applyDocEventsForReplay(t){for(const e of t){if(e.type==="status-changed"){this.applyStatus(e.value.status),e.value.status==="attached"&&this.setActor(e.value.actorID);continue}if(e.type==="snapshot"){const{snapshot:r,serverSeq:i,snapshotVector:s}=e.value;if(!r)continue;this.applySnapshot(BigInt(i),j.hexToVersionVector(s),j.hexToBytes(r));continue}if(e.type==="local-change"||e.type==="remote-change"){if(!e.rawChange)continue;const r=hn.fromStruct(e.rawChange);this.applyChange(r,e.source)}if(e.type==="initialized"){const r=new Set;for(const{clientID:i,presence:s}of e.value)r.add(i),this.presences.set(i,s);this.setOnlineClients(r)}else if(e.type==="watched"){const{clientID:r,presence:i}=e.value;this.addOnlineClient(r),this.presences.set(r,i)}else if(e.type==="unwatched"){const{clientID:r}=e.value;this.removeOnlineClient(r),this.presences.delete(r)}else if(e.type==="presence-changed"){const{clientID:r,presence:i}=e.value;this.presences.set(r,i)}}}getValueByPath(t){if(!t.startsWith("$"))throw new g(d.ErrInvalidArgument,'path must start with "$"');const e=t.split(".");e.shift();let r=this.getRoot();for(const i of e)if(r=r[i],!r)return;return r}setOnlineClients(t){this.onlineClients=t}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(t){this.onlineClients.add(t)}removeOnlineClient(t){this.onlineClients.delete(t)}hasPresence(t){return this.presences.has(t)}getMyPresence(){if(this.status!=="attached")return{};const t=this.presences.get(this.changeID.getActorID());return t?Be(t):{}}getOthersPresences(){const t=[],e=this.changeID.getActorID();for(const r of this.onlineClients)r!==e&&this.presences.has(r)&&t.push({clientID:r,presence:Be(this.presences.get(r))});return t}getPresence(t){if(t===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(t))return;const e=this.presences.get(t);return e?Be(e):void 0}getPresences(){const t=[];t.push({clientID:this.changeID.getActorID(),presence:Be(this.getMyPresence())});for(const e of this.onlineClients)this.presences.has(e)&&t.push({clientID:e,presence:Be(this.presences.get(e))});return t}getPresenceForTest(t){const e=this.presences.get(t);return e?Be(e):void 0}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const t=this.getChangeID().getActorID();return this.getPresences().filter(e=>e.clientID!==t).sort((e,r)=>e.clientID>r.clientID?1:-1)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}broadcast(t,e,r){this.publish([{type:"local-broadcast",value:{topic:t,payload:e},options:r}])}getVersionVector(){return this.changeID.getVersionVector()}isSameElementOrChildOf(t,e){if(e===t)return!0;const r=t.split(".");return e.split(".").every((i,s)=>i===r[s])}removePushedLocalChanges(t){for(;this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>t);)this.localChanges.shift()}executeUndoRedo(t){if(this.isUpdating)throw new g(d.ErrRefused,`${t?"Undo":"Redo"} is not allowed during an update`);const e=t?this.internalHistory.popUndo():this.internalHistory.popRedo();if(!e)throw new g(d.ErrRefused,`There is no operation to be ${t?"undone":"redone"}`);this.ensureClone();const r=In.create(this.changeID,this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const f of e){if(!(f instanceof ze)){new Xo(r,Be(this.clone.presences.get(this.changeID.getActorID()))).set(f.value,{addToHistory:!0});continue}const m=r.issueTimeTicket();if(f.setExecutedAt(m),f instanceof kr){const y=f.getCreatedAt();f.getValue().setCreatedAt(m),this.internalHistory.reconcileCreatedAt(y,m)}else if(f instanceof Lr){const y=f.getValue().getCreatedAt();f.getValue().setCreatedAt(m),this.internalHistory.reconcileCreatedAt(y,m)}r.push(f)}const i=r.toChange();i.execute(this.clone.root,this.clone.presences,q.UndoRedo);const{opInfos:s,reverseOps:a}=i.execute(this.root,this.presences,q.UndoRedo),c=r.getReversePresence();if(c&&a.push({type:"presence",value:c}),a.length&&(t?this.internalHistory.pushRedo(a):this.internalHistory.pushUndo(a)),!i.hasPresenceChange()&&!s.length)return;this.localChanges.push(i),this.changeID=r.getNextID();const l=this.changeID.getActorID(),h=[];s.length&&h.push({type:"local-change",source:q.UndoRedo,value:{message:i.getMessage()||"",operations:s,actor:l,clientSeq:i.getID().getClientSeq(),serverSeq:i.getID().getServerSeq()},rawChange:this.isEnableDevtools()?i.toStruct():void 0}),i.hasPresenceChange()&&h.push({type:"presence-changed",source:q.UndoRedo,value:{clientID:l,presence:this.getPresence(l)}}),this.publish(h)}}class _o{constructor(t,e,r,i,s){o(this,"resource");o(this,"resourceID");o(this,"syncMode");o(this,"changeEventReceived");o(this,"lastHeartbeatTime");o(this,"reconnectStreamDelay");o(this,"cancelled");o(this,"watchStream");o(this,"watchLoopTimerID");o(this,"watchAbortController");o(this,"unsubscribeBroadcastEvent");this.reconnectStreamDelay=t,this.resource=e,this.resourceID=r,this.syncMode=i,this.changeEventReceived=i!==void 0?!1:void 0,this.lastHeartbeatTime=Date.now(),this.cancelled=!1,this.unsubscribeBroadcastEvent=s}changeSyncMode(t){this.syncMode=t}needRealtimeSync(){return this.syncMode===vn.RealtimeSyncOff?!1:this.syncMode===vn.RealtimePushOnly?this.resource.hasLocalChanges():this.syncMode!==vn.Manual&&(this.resource.hasLocalChanges()||(this.changeEventReceived??!1))}needSync(t){return this.resource instanceof pr?this.needRealtimeSync():this.syncMode===vn.Manual?!1:Date.now()-this.lastHeartbeatTime>=t}updateHeartbeatTime(){this.lastHeartbeatTime=Date.now()}async runWatchLoop(t){const e=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await t(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.cancelled||(this.watchLoopTimerID=setTimeout(e,this.reconnectStreamDelay))})}catch{}};await e()}cancelWatchStream(){this.cancelled=!0,this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}function dh(n,t){let e=t;return{authInterceptor:s=>async a=>(n&&a.header.set("x-api-key",n),e&&a.header.set("authorization",e),await s(a)),setToken:s=>{e=s}}}const gh="@yorkie-js/sdk",mh="0.6.35",ea={name:gh,version:mh};function ph(n){return t=>async e=>(n?e.header.set("x-yorkie-user-agent",n):e.header.set("x-yorkie-user-agent",ea.name+"/"+ea.version),await t(e))}const yh=n=>{try{if(JSON.stringify(n)===void 0)return!1}catch{return!1}return!0};var yn=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(yn||{}),Bi=(n=>(n.Changed="changed",n.Initialized="initialized",n))(Bi||{});class $r{constructor(t){o(this,"key");o(this,"status");o(this,"actorID");o(this,"presenceID");o(this,"count");o(this,"seq");o(this,"eventStream");o(this,"eventStreamObserver");this.key=t,this.status="detached",this.count=0,this.seq=0,this.eventStream=uc(e=>this.eventStreamObserver=e)}getKey(){return this.key}getStatus(){return this.status}applyStatus(t){this.status=t}isAttached(){return this.status==="attached"}getActorID(){return this.actorID}setActor(t){this.actorID=t}getPresenceID(){return this.presenceID}setPresenceID(t){this.presenceID=t}getCount(){return this.count}updateCount(t,e){return e===0||e>this.seq?(this.count=t,this.seq=e,!0):!1}hasLocalChanges(){return!1}subscribe(t){return this.eventStream.subscribe(t)}publish(t){this.eventStreamObserver&&this.eventStreamObserver.next(t)}}var vn=(n=>(n.Manual="manual",n.Realtime="realtime",n.RealtimePushOnly="realtime-pushonly",n.RealtimeSyncOff="realtime-syncoff",n))(vn||{});const Yr={rpcAddr:"https://api.yorkie.dev",syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3,presenceHeartbeatInterval:3e4},Hi={maxRetries:1/0,initialRetryInterval:1e3,maxBackoff:2e4};class fc{constructor(t){o(this,"id");o(this,"key");o(this,"metadata");o(this,"status");o(this,"attachmentMap");o(this,"apiKey");o(this,"authTokenInjector");o(this,"conditions");o(this,"syncLoopDuration");o(this,"reconnectStreamDelay");o(this,"retrySyncLoopDelay");o(this,"presenceHeartbeatInterval");o(this,"rpcClient");o(this,"setAuthToken");o(this,"taskQueue");o(this,"processing",!1);o(this,"keepalive",!1);t=t||Yr;const e=t.rpcAddr||Yr.rpcAddr;this.key=t.key||cc(),this.metadata=t.metadata||{},this.status="deactivated",this.attachmentMap=new Map,this.apiKey=t.apiKey||"",this.authTokenInjector=t.authTokenInjector,this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=t.syncLoopDuration??Yr.syncLoopDuration,this.reconnectStreamDelay=t.reconnectStreamDelay??Yr.reconnectStreamDelay,this.retrySyncLoopDelay=t.retrySyncLoopDelay??Yr.retrySyncLoopDelay,this.presenceHeartbeatInterval=t.presenceHeartbeatInterval??Yr.presenceHeartbeatInterval;const{authInterceptor:r,setToken:i}=dh(this.apiKey);this.setAuthToken=i,this.rpcClient=yu(zu,Fu({baseUrl:e,interceptors:[r,ph(t==null?void 0:t.userAgent)],fetch:(s,a)=>fetch(s,{...a,keepalive:this.keepalive})})),this.taskQueue=[]}async activate(){if(this.isActive())return Promise.resolve();if(this.authTokenInjector){const t=await this.authTokenInjector();this.setAuthToken(t)}return this.enqueueTask(async()=>{try{const t=await this.rpcClient.activateClient({clientKey:this.key,metadata:this.metadata},{headers:{"x-shard-key":`${this.apiKey}/${this.key}`}});this.id=t.clientId,this.status="activated",this.runSyncLoop(),I.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`),typeof window<"u"&&window.addEventListener("beforeunload",async()=>{await this.deactivate({keepalive:!0})})}catch(t){throw I.error(`[AC] c:"${this.getKey()}" err :`,t),await this.handleConnectError(t),t}})}deactivate(t={keepalive:!1,synchronous:!1}){if(this.status==="deactivated")return Promise.resolve();const e=async()=>{try{await this.rpcClient.deactivateClient({clientId:this.id,synchronous:t.synchronous},{headers:{"x-shard-key":`${this.apiKey}/${this.key}`}}),this.deactivateInternal(),I.info(`[DC] c"${this.getKey()}" deactivated`)}catch(r){throw I.error(`[DC] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};if(t.keepalive){this.keepalive=!0;const r=e();return this.keepalive=!1,r}return this.enqueueTask(e)}has(t){return this.attachmentMap.has(t)}attach(t,e){return t instanceof $r?this.attachPresence(t,e):this.attachDocument(t,e)}attachDocument(t,e={}){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);if(t.getStatus()!==Nr.Detached)throw new g(d.ErrDocumentNotDetached,`${t.getKey()} is not detached`);t.setActor(this.id),t.update((s,a)=>a.set(e.initialPresence||{}));const r=t.subscribe("local-broadcast",async s=>{var f;const{topic:a,payload:c}=s.value,l=(f=s.options)==null?void 0:f.error,h=s.options;try{await this.broadcast(t.getKey(),a,c,h)}catch(m){m instanceof Error&&(l==null||l(m))}}),i=e.syncMode??"realtime";return this.enqueueTask(async()=>{try{const s=await this.rpcClient.attachDocument({clientId:this.id,changePack:j.toChangePack(t.createChangePack()),schemaKey:e.schema},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}});(s.maxSizePerDocument??0)>0&&t.setMaxSizePerDocument(s.maxSizePerDocument),s.schemaRules.length>0&&t.setSchemaRules(j.fromSchemaRules(s.schemaRules));const c=j.fromChangePack(s.changePack);if(t.applyChangePack(c),t.getStatus()===Nr.Removed)return t;t.applyStatus(Nr.Attached),this.attachmentMap.set(t.getKey(),new _o(this.reconnectStreamDelay,t,s.documentId,i,r)),i!=="manual"&&await this.runWatchLoop(t.getKey()),I.info(`[AD] c:"${this.getKey()}" attaches d:"${t.getKey()}"`);const l=t.getRootObject();if(e.initialRoot){const h=e.initialRoot;t.update(f=>{for(const[m,y]of Object.entries(h))if(!l.has(m)){const p=m;f[p]=y}})}return t}catch(s){throw I.error(`[AD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}})}detach(t,e){return t instanceof $r?this.detachPresence(t):this.detachDocument(t,e)}detachDocument(t,e={keepalive:!1}){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(t.getKey());if(!r)throw new g(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);t.update((s,a)=>a.clear());const i=async()=>{try{const s=await this.rpcClient.detachDocument({clientId:this.id,documentId:r.resourceID,changePack:j.toChangePack(t.createChangePack()),removeIfNotAttached:e.removeIfNotAttached??!1},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}}),a=j.fromChangePack(s.changePack);return t.applyChangePack(a),t.getStatus()!==Nr.Removed&&t.applyStatus(Nr.Detached),this.detachInternal(t.getKey()),I.info(`[DD] c:"${this.getKey()}" detaches d:"${t.getKey()}"`),t}catch(s){throw I.error(`[DD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}};if(e.keepalive){this.keepalive=!0;const s=i();return this.keepalive=!1,s}return this.enqueueTask(i)}async attachPresence(t,e={}){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);if(t.getStatus()!==yn.Detached)throw new g(d.ErrDocumentNotDetached,`${t.getKey()} is not detached`);t.setActor(this.id);const r=async()=>{try{const i=await this.rpcClient.attachPresence({clientId:this.id,presenceKey:t.getKey()},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}});t.setPresenceID(i.presenceId),t.updateCount(Number(i.count),0),t.applyStatus(yn.Attached);const s=e.isRealtime!==!1?"realtime":"manual",a=new _o(this.reconnectStreamDelay,t,i.presenceId,s);return this.attachmentMap.set(t.getKey(),a),s==="realtime"&&await this.runWatchLoop(t.getKey()),I.info(`[AP] c:"${this.getKey()}" attaches p:"${t.getKey()}" mode:${s} count:${t.getCount()}`),t}catch(i){throw I.error(`[AP] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(r)}async detachPresence(t){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);if(!this.attachmentMap.has(t.getKey()))throw new g(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);const e=async()=>{try{const r=await this.rpcClient.detachPresence({clientId:this.id,presenceId:t.getPresenceID(),presenceKey:t.getKey()},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}});return t.updateCount(Number(r.count),0),t.applyStatus(yn.Detached),this.detachInternal(t.getKey()),I.info(`[DP] c:"${this.getKey()}" detaches p:"${t.getKey()}" count:${t.getCount()}`),t}catch(r){throw I.error(`[DP] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};return this.enqueueTask(e)}async changeSyncMode(t,e){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(t.getKey());if(!r)throw new g(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);const i=r.syncMode;return i===e?t:(r.changeSyncMode(e),e==="manual"?(r.cancelWatchStream(),t):(e==="realtime"&&(r.changeEventReceived=!0),i==="manual"&&await this.runWatchLoop(t.getKey()),t))}sync(t){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);if(t instanceof $r){const e=this.attachmentMap.get(t.getKey());if(!e)throw new g(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(e).catch(async r=>{throw I.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}if(t instanceof pr){const e=this.attachmentMap.get(t.getKey());if(!e)throw new g(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(e,"realtime").catch(async r=>{throw I.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}return this.enqueueTask(async()=>{const e=[];for(const[,r]of this.attachmentMap)r.syncMode!==void 0&&r.resource instanceof pr&&e.push(this.syncInternal(r,r.syncMode));return Promise.all(e).catch(async r=>{throw I.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r})})}remove(t){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const e=this.attachmentMap.get(t.getKey());if(!e)throw new g(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);t.setActor(this.id);const r=j.toChangePack(t.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>{try{const i=await this.rpcClient.removeDocument({clientId:this.id,documentId:e.resourceID,changePack:r},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}}),s=j.fromChangePack(i.changePack);t.applyChangePack(s),this.detachInternal(t.getKey()),I.info(`[RD] c:"${this.getKey()}" removes d:"${t.getKey()}"`)}catch(i){throw I.error(`[RD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}})}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(t){return this.conditions[t]}broadcast(t,e,r,i){if(!this.isActive())throw new g(d.ErrClientNotActivated,`${this.key} is not active`);const s=this.attachmentMap.get(t);if(!s)throw new g(d.ErrDocumentNotAttached,`${t} is not attached`);if(!yh(r))throw new g(d.ErrInvalidArgument,"payload is not serializable");const a=(i==null?void 0:i.maxRetries)??Hi.maxRetries,c=Hi.maxBackoff;let l=0;const h=m=>Math.min(Hi.initialRetryInterval*2**m,c),f=async()=>this.enqueueTask(async()=>{try{await this.rpcClient.broadcast({clientId:this.id,documentId:s.resourceID,topic:e,payload:new TextEncoder().encode(JSON.stringify(r))},{headers:{"x-shard-key":`${this.apiKey}/${t}`}}),I.info(`[BC] c:"${this.getKey()}" broadcasts d:"${t}" t:"${e}"`)}catch(m){if(I.error(`[BC] c:"${this.getKey()}" err:`,m),await this.handleConnectError(m))if(Wi(m,d.ErrUnauthenticated)&&s.resource instanceof pr&&s.resource.publish([{type:_.AuthError,value:{reason:pn(m).reason,method:"Broadcast"}}]),l<a)l++,setTimeout(()=>f(),h(l-1)),I.info(`[BC] c:"${this.getKey()}" retry attempt ${l}/${a}`);else throw I.error(`[BC] c:"${this.getKey()}" exceeded maximum retry attempts`),m;else throw m}});return f()}runSyncLoop(){const t=async()=>{if(!this.isActive()){I.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}try{await this.enqueueTask(async()=>{const e=[];for(const[,r]of this.attachmentMap)r.needSync(this.presenceHeartbeatInterval)&&(r.changeEventReceived!==void 0&&(r.changeEventReceived=!1),e.push(this.syncInternal(r,r.syncMode).catch(i=>{throw Wi(i,d.ErrUnauthenticated)&&r.resource.publish([{type:_.AuthError,value:{reason:pn(i).reason,method:"PushPull"}}]),i})));await Promise.all(e),setTimeout(t,this.syncLoopDuration)})}catch(e){I.error(`[SL] c:"${this.getKey()}" sync failed:`,e),await this.handleConnectError(e)?setTimeout(t,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1}};I.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,t()}async runWatchLoop(t){const e=this.attachmentMap.get(t);if(!e)throw new g(d.ErrDocumentNotAttached,`${t} is not attached`);return this.conditions.WatchLoop=!0,e.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new g(d.ErrClientNotActivated,`${this.key} is not active`));if(!this.attachmentMap.has(t))return this.conditions.WatchLoop=!1,Promise.reject(new g(d.ErrDocumentNotAttached,`${t} is not attached`));const i=new AbortController;return e.resource instanceof pr?this.createDocumentWatchStream(e,t,i,r):e.resource instanceof $r?this.createPresenceWatchStream(e,t,i,r):Promise.reject(new g(d.ErrClientNotActivated,`Unknown resource type for ${t}`))})}createDocumentWatchStream(t,e,r,i){const s=this.rpcClient.watchDocument({clientId:this.id,documentId:t.resourceID},{headers:{"x-shard-key":`${this.apiKey}/${e}`},signal:r.signal});return t.resource.publish([{type:_.ConnectionChanged,value:ti.Connected}]),I.info(`[WD] c:"${this.getKey()}" watches d:"${e}"`),t.changeEventReceived!==void 0&&(t.changeEventReceived=!0),new Promise((a,c)=>{(async()=>{try{for await(const h of s)this.handleWatchDocumentResponse(t,h),h.body.case==="initialization"&&a([s,r]);t.resource.resetOnlineClients(),t.resource.publish([{type:_.Initialized,source:q.Local,value:t.resource.getPresences()}]),t.resource.publish([{type:_.ConnectionChanged,value:ti.Disconnected}]),I.debug(`[WD] c:"${this.getKey()}" unwatches (stream ended)`),i()}catch(h){t.resource.resetOnlineClients(),t.resource.publish([{type:_.Initialized,source:q.Local,value:t.resource.getPresences()}]),t.resource.publish([{type:_.ConnectionChanged,value:ti.Disconnected}]),I.debug(`[WD] c:"${this.getKey()}" unwatches`),await this.handleConnectError(h)?(Wi(h,d.ErrUnauthenticated)&&t.resource.publish([{type:_.AuthError,value:{reason:pn(h).reason,method:"WatchDocument"}}]),i()):this.conditions.WatchLoop=!1,c(h)}})()})}createPresenceWatchStream(t,e,r,i){const s=this.rpcClient.watchPresence({clientId:this.id,presenceKey:e},{headers:{"x-shard-key":`${this.apiKey}/${e}`},signal:r.signal});return I.info(`[WP] c:"${this.getKey()}" watches p:"${e}"`),new Promise((a,c)=>{(async()=>{try{let h=!0;for await(const f of s)this.handleWatchPresenceResponse(t,f),h&&(h=!1,a([s,r]));I.debug(`[WP] c:"${this.getKey()}" p:"${e}" stream ended`),i()}catch(h){if(h instanceof Error&&h.name==="AbortError"){I.debug(`[WP] c:"${this.getKey()}" p:"${e}" stream aborted`);return}I.debug(`[WP] c:"${this.getKey()}" p:"${e}" err:`,h),await this.handleConnectError(h)?i():this.conditions.WatchLoop=!1,c(h)}})()})}handleWatchPresenceResponse(t,e){if(e.body.case==="initialized"){const{count:r,seq:i}=e.body.value;t.resource.updateCount(Number(r),Number(i))&&t.resource.publish({type:Bi.Initialized,count:Number(r)})}else if(e.body.case==="event"){const{count:r,seq:i}=e.body.value;t.resource.updateCount(Number(r),Number(i))&&t.resource.publish({type:Bi.Changed,count:Number(r)})}}handleWatchDocumentResponse(t,e){if(e.body.case==="event"&&e.body.value.type===qr.DOCUMENT_CHANGED){t.changeEventReceived!==void 0&&(t.changeEventReceived=!0);return}t.resource.applyWatchStream(e)}deactivateInternal(){this.status="deactivated";for(const[t,e]of this.attachmentMap)this.detachInternal(t),e.resource instanceof pr?e.resource.applyStatus(Nr.Detached):e.resource instanceof $r&&e.resource.applyStatus(yn.Detached)}detachInternal(t){var r;const e=this.attachmentMap.get(t);e&&(e.cancelWatchStream(),e.resource instanceof pr&&e.resource.resetOnlineClients(),(r=e.unsubscribeBroadcastEvent)==null||r.call(e),this.attachmentMap.delete(t))}async syncInternal(t,e){const{resource:r}=t;if(r instanceof $r){try{const c=await this.rpcClient.refreshPresence({clientId:this.id,presenceId:r.getPresenceID(),presenceKey:r.getKey()},{headers:{"x-shard-key":`${this.apiKey}/${r.getKey()}`}});r.updateCount(Number(c.count),0),t.updateHeartbeatTime(),I.debug(`[RP] c:"${this.getKey()}" refreshes p:"${r.getKey()}" mode:${t.syncMode}`)}catch(c){throw I.error(`[RP] c:"${this.getKey()}" err :`,c),c}return r}const i=r,{resourceID:s}=t,a=i.createChangePack();try{const c=await this.rpcClient.pushPullChanges({clientId:this.id,documentId:s,changePack:j.toChangePack(a),pushOnly:e==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${i.getKey()}`}}),l=j.fromChangePack(c.changePack);if(l.hasChanges()&&(t.syncMode==="realtime-pushonly"||t.syncMode==="realtime-syncoff"))return i;i.applyChangePack(l),t.resource.publish([{type:_.SyncStatusChanged,value:Js.Synced}]),i.getStatus()===Nr.Removed&&this.detachInternal(i.getKey());const h=i.getKey(),f=l.getChangeSize();return I.info(`[PP] c:"${this.getKey()}" sync d:"${h}", push:${a.getChangeSize()} pull:${f} cp:${l.getCheckpoint().toTestString()}`),i}catch(c){throw i.publish([{type:_.SyncStatusChanged,value:Js.SyncFailed}]),I.error(`[PP] c:"${this.getKey()}" err :`,c),c}}async handleConnectError(t){if(!(t instanceof $))return!1;if(t.code===D.Canceled||t.code===D.Unknown||t.code===D.ResourceExhausted||t.code===D.Unavailable)return!0;if(Xr(t)===d.ErrUnauthenticated){if(this.authTokenInjector){const e=await this.authTokenInjector(pn(t).reason);this.setAuthToken(e)}return!0}return Xr(t)===d.ErrTooManySubscribers?(I.error(`[WD] c:"${this.getKey()}" err :`,t.rawMessage),!0):(Xr(t)===d.ErrTooManyAttachments||(Xr(t)===d.ErrClientNotActivated||Xr(t)===d.ErrClientNotFound)&&this.deactivateInternal(),!1)}enqueueTask(t){return new Promise((e,r)=>{this.taskQueue.push(()=>t().then(e).catch(r)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{I.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}const dc={Client:fc,Document:pr,IntType:et.Int,LongType:et.Long};typeof globalThis<"u"&&(globalThis.yorkie={Client:fc,Document:pr,Primitive:K,Text:_s,Counter:eo,Tree:no,Presence:$r,PresenceEventType:Bi,LogLevel:oe,setLogLevel:Hl,IntType:et.Int,LongType:et.Long});const ta=["Ali","Beatriz","Charles","Diya","Eric","Fatima","Gabriel","Hanna","Johnson","Perry","Parker","Kelly"],vh=()=>{const n=Math.floor(Math.random()*ta.length);return ta[n]},ra=["red","yellow","orange","green","blue","purple"],wh=()=>{const n=Math.floor(Math.random()*ra.length);return ra[n]},Oi=new dc.Client({rpcAddr:"https://api.yorkie.dev",apiKey:"D6sd9E5ehtXBssmeRZ4QQP"}),ri=new dc.Document("profile-stack",{enableDevtools:!0}),na={name:vh(),color:wh()},ni=3,kn={me:0,peer:n=>n+1,more:4};let Mr=null,Le=null,tn=[];async function Th(){await Oi.activate(),ri.subscribe("presence",n=>{Sh(ri.getPresences()),Ah(),Eh(),ii(Mr)}),await Oi.attach(ri,{initialPresence:{name:na.name,color:na.color}}),bh()}const Sh=n=>{var t;tn=n.filter(({clientID:e})=>e!==Oi.getID()),Le=(t=n.find(({clientID:e})=>e===Oi.getID()))==null?void 0:t.presence},bh=()=>{window.addEventListener("click",n=>{const t=n.target,e=t.closest(".profile"),r=t.closest(".speech-bubble"),i=t.closest(".modal");e||r||i||mc()})},Rs=n=>{const t=document.createElement("div");return t.className="peer",t.innerHTML=`
    <div class="profile">
      <img src="./images/profile-${n}.svg" alt="profile" class="profile-img"/>
    </div>
  `,t},Ih=(n,t)=>{const e=document.createElement("div");e.className="small-peer";const r=Rs(n);return r.className="user-icon",e.appendChild(r),e.appendChild(document.createElement("span")),e.querySelector("span").className="name",e.querySelector("span").innerHTML=t,e},Ah=()=>{const n=document.getElementById("peerList");n.innerHTML="";const t=Rs(Le.color);if(t.querySelector(".profile").addEventListener("click",()=>{Mr=kn.me,ii(Mr)}),t.classList.add("me"),n.appendChild(t),tn.forEach((i,s)=>{const{color:a}=i.presence;if(s<ni){const c=Rs(a);c.querySelector(".profile").addEventListener("click",()=>{Mr=kn.peer(s),ii(Mr)}),n.appendChild(c);return}}),tn.length>ni){const i=document.createElement("div");i.className="peer more",i.innerHTML=`
      <div class="profile">
      +${tn.length-ni}
      </div>
    `,n.appendChild(i),i.querySelector(".profile").addEventListener("click",()=>{Mr=kn.more,ii(Mr)})}},gc=()=>{const n=document.createElement("div");return n.className="speech-bubble",n},ia=(n,t)=>{const e=gc(),r=document.createElement("button");return r.className="edit-profile-btn",r.innerHTML="Edit Profile",r.addEventListener("click",xh),e.innerHTML=`<span class="name">${n}${t?" (me)":""}</span>`,t&&(e.classList.add("me"),e.appendChild(r)),e},kh=n=>{const t=gc();return n.forEach(e=>{t.appendChild(Ih(e.color,e.name))}),t},mc=()=>{document.querySelectorAll(".speech-bubble").forEach(t=>{t.remove()})},ii=n=>{mc();let t;if(n===null)return;if(n===kn.me)t=ia(Le==null?void 0:Le.name,!0);else if(n===kn.more){const r=tn.filter((i,s)=>s>=ni).map(({presence:i})=>({color:i.color,name:i.name}));t=kh(r),t.classList.add("peer-more-list")}else{const r=tn[n-1].presence.name;t=ia(r,!1)}document.querySelectorAll("#peerList .peer")[n].appendChild(t)},Eh=()=>{const n=document.getElementById("editProfileModal");n.querySelector(".close").addEventListener("click",pc);const e=n.querySelector("input");e.defaultValue=Le==null?void 0:Le.name,n.querySelector(".save").addEventListener("click",Nh);const i=n.querySelector(".profile-img");i.src=`./images/profile-${Le==null?void 0:Le.color}.svg`},xh=()=>{const n=document.getElementById("editProfileModal");n.style.display="block"},pc=()=>{const n=document.getElementById("editProfileModal");n.style.display="none"},Nh=async()=>{const e=document.getElementById("editProfileModal").querySelector("input").value;ri.update((r,i)=>{i.set({name:e})}),pc()};Th();
