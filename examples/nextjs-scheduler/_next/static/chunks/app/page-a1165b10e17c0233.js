(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4629:function(e,t,r){Promise.resolve().then(r.bind(r,6055))},6055:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return nr}});var n,i,s,a,o,h,c,l,d,u,g,f,m,p,v,y,A,T,S,I,C,w,x,k,E,P,b,D,R,N,O,M,_=r(3165),L=r(7397),B=r.n(L),z=r(6189);let K=["Alice","Bob","Carol","Chuck","Dave","Erin","Frank","Grace","Ivan","Justin","Matilda","Oscar","Steve","Victor","Zoe"];function U(e){let[t,r,n]=e.toLocaleDateString("en").split("/");return t=Number(t)>9?t:"0"+t,r=Number(r)>9?r:"0"+r,n=n.slice(2),"".concat(r,"-").concat(t,"-").concat(n)}var J=r(8358),j=r(6390),q=r(4715),F=r(1582),V=r(601),W=r(6731),G=r(9782);let H=V.w.makeEnum("yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL",localName:"NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN",localName:"BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER",localName:"INTEGER"},{no:3,name:"VALUE_TYPE_LONG",localName:"LONG"},{no:4,name:"VALUE_TYPE_DOUBLE",localName:"DOUBLE"},{no:5,name:"VALUE_TYPE_STRING",localName:"STRING"},{no:6,name:"VALUE_TYPE_BYTES",localName:"BYTES"},{no:7,name:"VALUE_TYPE_DATE",localName:"DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT",localName:"JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY",localName:"JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT",localName:"TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT",localName:"INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT",localName:"LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE",localName:"TREE"}]),Y=V.w.makeEnum("yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED",localName:"DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED",localName:"DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED",localName:"DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST",localName:"DOCUMENT_BROADCAST"}]),Z=V.w.makeMessageType("yorkie.v1.Snapshot",()=>[{no:1,name:"root",kind:"message",T:eu},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:eR}}]),X=V.w.makeMessageType("yorkie.v1.ChangePack",()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:eN},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:Q,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:eM},{no:6,name:"is_removed",kind:"scalar",T:8}]),Q=V.w.makeMessageType("yorkie.v1.Change",()=>[{no:1,name:"id",kind:"message",T:$},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:ee,repeated:!0},{no:4,name:"presence_change",kind:"message",T:eb}]),$=V.w.makeMessageType("yorkie.v1.ChangeID",()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3,L:1},{no:3,name:"lamport",kind:"scalar",T:3,L:1},{no:4,name:"actor_id",kind:"scalar",T:12}]),ee=V.w.makeMessageType("yorkie.v1.Operation",()=>[{no:1,name:"set",kind:"message",T:et,oneof:"body"},{no:2,name:"add",kind:"message",T:er,oneof:"body"},{no:3,name:"move",kind:"message",T:en,oneof:"body"},{no:4,name:"remove",kind:"message",T:ei,oneof:"body"},{no:5,name:"edit",kind:"message",T:es,oneof:"body"},{no:6,name:"select",kind:"message",T:ea,oneof:"body"},{no:7,name:"style",kind:"message",T:eo,oneof:"body"},{no:8,name:"increase",kind:"message",T:eh,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:ec,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:el,oneof:"body"}]),et=V.w.makeMessageType("yorkie.v1.Operation.Set",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:ed},{no:4,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_Set"}),er=V.w.makeMessageType("yorkie.v1.Operation.Add",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"prev_created_at",kind:"message",T:eM},{no:3,name:"value",kind:"message",T:ed},{no:4,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_Add"}),en=V.w.makeMessageType("yorkie.v1.Operation.Move",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"prev_created_at",kind:"message",T:eM},{no:3,name:"created_at",kind:"message",T:eM},{no:4,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_Move"}),ei=V.w.makeMessageType("yorkie.v1.Operation.Remove",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"created_at",kind:"message",T:eM},{no:3,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_Remove"}),es=V.w.makeMessageType("yorkie.v1.Operation.Edit",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"from",kind:"message",T:eO},{no:3,name:"to",kind:"message",T:eO},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:eM}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:eM},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"Operation_Edit"}),ea=V.w.makeMessageType("yorkie.v1.Operation.Select",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"from",kind:"message",T:eO},{no:3,name:"to",kind:"message",T:eO},{no:4,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_Select"}),eo=V.w.makeMessageType("yorkie.v1.Operation.Style",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"from",kind:"message",T:eO},{no:3,name:"to",kind:"message",T:eO},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:eM},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:eM}}],{localName:"Operation_Style"}),eh=V.w.makeMessageType("yorkie.v1.Operation.Increase",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"value",kind:"message",T:ed},{no:3,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_Increase"}),ec=V.w.makeMessageType("yorkie.v1.Operation.TreeEdit",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"from",kind:"message",T:eE},{no:3,name:"to",kind:"message",T:eE},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:eM}},{no:5,name:"contents",kind:"message",T:ex,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:eM}],{localName:"Operation_TreeEdit"}),el=V.w.makeMessageType("yorkie.v1.Operation.TreeStyle",()=>[{no:1,name:"parent_created_at",kind:"message",T:eM},{no:2,name:"from",kind:"message",T:eE},{no:3,name:"to",kind:"message",T:eE},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:eM},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:eM}}],{localName:"Operation_TreeStyle"}),ed=V.w.makeMessageType("yorkie.v1.JSONElementSimple",()=>[{no:1,name:"created_at",kind:"message",T:eM},{no:2,name:"moved_at",kind:"message",T:eM},{no:3,name:"removed_at",kind:"message",T:eM},{no:4,name:"type",kind:"enum",T:V.w.getEnumType(H)},{no:5,name:"value",kind:"scalar",T:12}]),eu=V.w.makeMessageType("yorkie.v1.JSONElement",()=>[{no:1,name:"json_object",kind:"message",T:eg,oneof:"body"},{no:2,name:"json_array",kind:"message",T:ef,oneof:"body"},{no:3,name:"primitive",kind:"message",T:em,oneof:"body"},{no:5,name:"text",kind:"message",T:ep,oneof:"body"},{no:6,name:"counter",kind:"message",T:ev,oneof:"body"},{no:7,name:"tree",kind:"message",T:ey,oneof:"body"}]),eg=V.w.makeMessageType("yorkie.v1.JSONElement.JSONObject",()=>[{no:1,name:"nodes",kind:"message",T:eA,repeated:!0},{no:2,name:"created_at",kind:"message",T:eM},{no:3,name:"moved_at",kind:"message",T:eM},{no:4,name:"removed_at",kind:"message",T:eM}],{localName:"JSONElement_JSONObject"}),ef=V.w.makeMessageType("yorkie.v1.JSONElement.JSONArray",()=>[{no:1,name:"nodes",kind:"message",T:eT,repeated:!0},{no:2,name:"created_at",kind:"message",T:eM},{no:3,name:"moved_at",kind:"message",T:eM},{no:4,name:"removed_at",kind:"message",T:eM}],{localName:"JSONElement_JSONArray"}),em=V.w.makeMessageType("yorkie.v1.JSONElement.Primitive",()=>[{no:1,name:"type",kind:"enum",T:V.w.getEnumType(H)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:eM},{no:4,name:"moved_at",kind:"message",T:eM},{no:5,name:"removed_at",kind:"message",T:eM}],{localName:"JSONElement_Primitive"}),ep=V.w.makeMessageType("yorkie.v1.JSONElement.Text",()=>[{no:1,name:"nodes",kind:"message",T:eI,repeated:!0},{no:2,name:"created_at",kind:"message",T:eM},{no:3,name:"moved_at",kind:"message",T:eM},{no:4,name:"removed_at",kind:"message",T:eM}],{localName:"JSONElement_Text"}),ev=V.w.makeMessageType("yorkie.v1.JSONElement.Counter",()=>[{no:1,name:"type",kind:"enum",T:V.w.getEnumType(H)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:eM},{no:4,name:"moved_at",kind:"message",T:eM},{no:5,name:"removed_at",kind:"message",T:eM}],{localName:"JSONElement_Counter"}),ey=V.w.makeMessageType("yorkie.v1.JSONElement.Tree",()=>[{no:1,name:"nodes",kind:"message",T:ew,repeated:!0},{no:2,name:"created_at",kind:"message",T:eM},{no:3,name:"moved_at",kind:"message",T:eM},{no:4,name:"removed_at",kind:"message",T:eM}],{localName:"JSONElement_Tree"}),eA=V.w.makeMessageType("yorkie.v1.RHTNode",()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:eu}]),eT=V.w.makeMessageType("yorkie.v1.RGANode",()=>[{no:1,name:"next",kind:"message",T:eT},{no:2,name:"element",kind:"message",T:eu}]),eS=V.w.makeMessageType("yorkie.v1.NodeAttr",()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:eM},{no:3,name:"is_removed",kind:"scalar",T:8}]),eI=V.w.makeMessageType("yorkie.v1.TextNode",()=>[{no:1,name:"id",kind:"message",T:eC},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:eM},{no:4,name:"ins_prev_id",kind:"message",T:eC},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:eS}}]),eC=V.w.makeMessageType("yorkie.v1.TextNodeID",()=>[{no:1,name:"created_at",kind:"message",T:eM},{no:2,name:"offset",kind:"scalar",T:5}]),ew=V.w.makeMessageType("yorkie.v1.TreeNode",()=>[{no:1,name:"id",kind:"message",T:ek},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:eM},{no:5,name:"ins_prev_id",kind:"message",T:ek},{no:6,name:"ins_next_id",kind:"message",T:ek},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:eS}}]),ex=V.w.makeMessageType("yorkie.v1.TreeNodes",()=>[{no:1,name:"content",kind:"message",T:ew,repeated:!0}]),ek=V.w.makeMessageType("yorkie.v1.TreeNodeID",()=>[{no:1,name:"created_at",kind:"message",T:eM},{no:2,name:"offset",kind:"scalar",T:5}]),eE=V.w.makeMessageType("yorkie.v1.TreePos",()=>[{no:1,name:"parent_id",kind:"message",T:ek},{no:2,name:"left_sibling_id",kind:"message",T:ek}]);V.w.makeMessageType("yorkie.v1.User",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"created_at",kind:"message",T:W.E}]),V.w.makeMessageType("yorkie.v1.Project",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:7,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:8,name:"created_at",kind:"message",T:W.E},{no:9,name:"updated_at",kind:"message",T:W.E}]),V.w.makeMessageType("yorkie.v1.UpdatableProjectFields",()=>[{no:1,name:"name",kind:"message",T:G.Gm},{no:2,name:"auth_webhook_url",kind:"message",T:G.Gm},{no:3,name:"auth_webhook_methods",kind:"message",T:eP},{no:4,name:"client_deactivate_threshold",kind:"message",T:G.Gm}]);let eP=V.w.makeMessageType("yorkie.v1.UpdatableProjectFields.AuthWebhookMethods",()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}],{localName:"UpdatableProjectFields_AuthWebhookMethods"});V.w.makeMessageType("yorkie.v1.DocumentSummary",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"snapshot",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:W.E},{no:5,name:"accessed_at",kind:"message",T:W.E},{no:6,name:"updated_at",kind:"message",T:W.E}]);let eb=V.w.makeMessageType("yorkie.v1.PresenceChange",()=>[{no:1,name:"type",kind:"enum",T:V.w.getEnumType(eD)},{no:2,name:"presence",kind:"message",T:eR}]),eD=V.w.makeEnum("yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED",localName:"UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT",localName:"PUT"},{no:2,name:"CHANGE_TYPE_DELETE",localName:"DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR",localName:"CLEAR"}]),eR=V.w.makeMessageType("yorkie.v1.Presence",()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}]),eN=V.w.makeMessageType("yorkie.v1.Checkpoint",()=>[{no:1,name:"server_seq",kind:"scalar",T:3,L:1},{no:2,name:"client_seq",kind:"scalar",T:13}]),eO=V.w.makeMessageType("yorkie.v1.TextNodePos",()=>[{no:1,name:"created_at",kind:"message",T:eM},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]),eM=V.w.makeMessageType("yorkie.v1.TimeTicket",()=>[{no:1,name:"lamport",kind:"scalar",T:3,L:1},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}]),e_=V.w.makeMessageType("yorkie.v1.DocEventBody",()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]),eL=V.w.makeMessageType("yorkie.v1.DocEvent",()=>[{no:1,name:"type",kind:"enum",T:V.w.getEnumType(Y)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:e_}]),eB=V.w.makeMessageType("yorkie.v1.ActivateClientRequest",()=>[{no:1,name:"client_key",kind:"scalar",T:9}]),ez=V.w.makeMessageType("yorkie.v1.ActivateClientResponse",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),eK=V.w.makeMessageType("yorkie.v1.DeactivateClientRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),eU=V.w.makeMessageType("yorkie.v1.DeactivateClientResponse",[]),eJ=V.w.makeMessageType("yorkie.v1.AttachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:X}]),ej=V.w.makeMessageType("yorkie.v1.AttachDocumentResponse",()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:X}]),eq=V.w.makeMessageType("yorkie.v1.DetachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:X},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]),eF=V.w.makeMessageType("yorkie.v1.DetachDocumentResponse",()=>[{no:2,name:"change_pack",kind:"message",T:X}]),eV=V.w.makeMessageType("yorkie.v1.WatchDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]),eW=V.w.makeMessageType("yorkie.v1.WatchDocumentResponse",()=>[{no:1,name:"initialization",kind:"message",T:eG,oneof:"body"},{no:2,name:"event",kind:"message",T:eL,oneof:"body"}]),eG=V.w.makeMessageType("yorkie.v1.WatchDocumentResponse.Initialization",()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}],{localName:"WatchDocumentResponse_Initialization"}),eH=V.w.makeMessageType("yorkie.v1.RemoveDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:X}]),eY=V.w.makeMessageType("yorkie.v1.RemoveDocumentResponse",()=>[{no:1,name:"change_pack",kind:"message",T:X}]),eZ=V.w.makeMessageType("yorkie.v1.PushPullChangesRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:X},{no:4,name:"push_only",kind:"scalar",T:8}]),eX=V.w.makeMessageType("yorkie.v1.PushPullChangesResponse",()=>[{no:1,name:"change_pack",kind:"message",T:X}]),eQ=V.w.makeMessageType("yorkie.v1.BroadcastRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]),e$=V.w.makeMessageType("yorkie.v1.BroadcastResponse",[]);var e0=r(6438);let e1={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:eB,O:ez,kind:e0.t.Unary},deactivateClient:{name:"DeactivateClient",I:eK,O:eU,kind:e0.t.Unary},attachDocument:{name:"AttachDocument",I:eJ,O:ej,kind:e0.t.Unary},detachDocument:{name:"DetachDocument",I:eq,O:eF,kind:e0.t.Unary},removeDocument:{name:"RemoveDocument",I:eH,O:eY,kind:e0.t.Unary},pushPullChanges:{name:"PushPullChanges",I:eZ,O:eX,kind:e0.t.Unary},watchDocument:{name:"WatchDocument",I:eV,O:eW,kind:e0.t.ServerStreaming},broadcast:{name:"Broadcast",I:eQ,O:e$,kind:e0.t.Unary}}};var e2=r(7319),e3=r(624);(n=A||(A={})).Ok="ok",n.ErrClientNotActivated="ErrClientNotActivated",n.ErrClientNotFound="ErrClientNotFound",n.ErrUnimplemented="ErrUnimplemented",n.ErrInvalidType="ErrInvalidType",n.ErrDummy="ErrDummy",n.ErrDocumentNotAttached="ErrDocumentNotAttached",n.ErrDocumentNotDetached="ErrDocumentNotDetached",n.ErrDocumentRemoved="ErrDocumentRemoved",n.ErrInvalidObjectKey="ErrInvalidObjectKey",n.ErrInvalidArgument="ErrInvalidArgument",n.ErrNotInitialized="ErrNotInitialized",n.ErrNotReady="ErrNotReady",n.ErrRefused="ErrRefused",n.ErrContextNotProvided="ErrContextNotProvided";class e9 extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.name="YorkieError",this.toString=()=>"[code=".concat(this.code,"]: ").concat(this.message)}}function e4(e){if(e instanceof Map){let t=Array.from(e);return new Map(JSON.parse(JSON.stringify(t)))}return JSON.parse(JSON.stringify(e))}let e5=e=>!e||0===Object.entries(e).length,e8=e=>{let t={};for(let[r,n]of Object.entries(e))t[r]=JSON.stringify(n);return t},e6=e=>{let t={};for(let[r,n]of Object.entries(e))t[r]=JSON.parse(n);return t};(i=T||(T={})).Put="put",i.Clear="clear";class e7{set(e,t){for(let t of Object.keys(e))this.presence[t]=e[t];this.context.setPresenceChange({type:"put",presence:e4(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:"clear"})}constructor(e,t){this.context=e,this.presence=t}}let te="000000000000000000000000";class tt{static of(e,t,r){return new tt(e,t,r)}static fromStruct(e){return tt.of(e2.Z.fromString(e.lamport,!0),e.delimiter,e.actorID)}toIDString(){return"".concat(this.lamport.toString(),":").concat(this.actorID,":").concat(this.delimiter)}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return"".concat(this.lamport.toString(),":").concat(this.actorID.slice(-2),":").concat(this.delimiter)}setActor(e){return new tt(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return 0===this.compare(e)}compare(e){if(this.lamport.greaterThan(e.lamport))return 1;if(e.lamport.greaterThan(this.lamport))return -1;let t=this.actorID.localeCompare(e.actorID);return 0!==t?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}constructor(e,t,r){this.lamport=e,this.delimiter=t,this.actorID=r}}let tr=e2.Z.MAX_VALUE,tn=new tt(e2.Z.fromNumber(0),0,te);new tt(e2.Z.fromNumber(1),1,te);let ti=new tt(tr,4294967295,"FFFFFFFFFFFFFFFFFFFFFFFF");function ts(e){return e.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case"\n":return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class ta{getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setMovedAt(e){return!!(!this.movedAt||e&&e.after(this.movedAt))&&(this.movedAt=e,!0)}setRemovedAt(e){this.removedAt=e}remove(e){return!!(e&&e.after(this.getPositionedAt())&&(!this.removedAt||e.after(this.removedAt)))&&(this.removedAt=e,!0)}isRemoved(){return!!this.removedAt}constructor(e){this.createdAt=e}}class to extends ta{constructor(e){super(e)}}class th{static of(e,t){return new th(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}constructor(e,t){this.strKey=e,this.value=t}}class tc{static create(){return new tc}set(e,t,r){let n;let i=this.nodeMapByKey.get(e);null!=i&&!i.isRemoved()&&i.remove(r)&&(n=i.getValue());let s=th.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),s),(null==i||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,s),t.setMovedAt(r)),n}delete(e,t){if(!this.nodeMapByCreatedAt.has(e.toIDString()))throw new e9(A.ErrInvalidArgument,"fail to find ".concat(e.toIDString()));let r=this.nodeMapByCreatedAt.get(e.toIDString());return r.remove(t),r.getValue()}subPathOf(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return t.getStrKey()}purge(e){let t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(e.getCreatedAt().toIDString()));let r=this.nodeMapByKey.get(t.getStrKey());t===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){let r=this.nodeMapByKey.get(e);if(null!=r&&r.remove(t))return r.getValue()}has(e){let t=this.nodeMapByKey.get(e);return null!=t&&!t.isRemoved()}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){let t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}*[Symbol.iterator](){for(let[,e]of this.nodeMapByKey)yield e}constructor(){this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}}class tl extends to{static create(e,t){if(!t)return new tl(e,tc.create());let r=tc.create();for(let[e,n]of Object.entries(t))r.set(e,n.deepcopy(),n.getCreatedAt());return new tl(e,r)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,t,r){return this.memberNodes.set(e,t,r)}delete(e,t){return this.memberNodes.delete(e,t)}deleteByKey(e,t){return this.memberNodes.deleteByKey(e,t)}get(e){let t=this.memberNodes.get(e);return null==t?void 0:t.getValue()}getByID(e){let t=this.memberNodes.getByID(e);return null==t?void 0:t.getValue()}has(e){return this.memberNodes.has(e)}toJSON(){let e=[];for(let[t,r]of this)e.push('"'.concat(ts(t),'":').concat(r.toJSON()));return"{".concat(e.join(","),"}")}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){let e={};for(let[t,r]of this){let{createdAt:n,value:i,type:s}=r.toJSForTest();e[t]={key:t,createdAt:n,value:i,type:s}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){let e=[];for(let[t]of this)e.push(t);return e}toSortedJSON(){let e=[];for(let[t]of this)e.push(t);let t=[];for(let n of e.sort()){var r;let e=null===(r=this.memberNodes.get(n))||void 0===r?void 0:r.getValue();t.push('"'.concat(ts(n),'":').concat(e.toSortedJSON()))}return"{".concat(t.join(","),"}")}getRHT(){return this.memberNodes}deepcopy(){let e=tl.create(this.getCreatedAt());for(let t of this.memberNodes)e.memberNodes.set(t.getStrKey(),t.getValue().deepcopy(),this.getPositionedAt());return e.remove(this.getRemovedAt()),e}getDescendants(e){for(let t of this.memberNodes){let r=t.getValue();if(e(r,this))return;r instanceof to&&r.getDescendants(e)}}*[Symbol.iterator](){let e=new Set;for(let t of this.memberNodes)e.has(t.getStrKey())||(e.add(t.getStrKey()),t.isRemoved()||(yield[t.getStrKey(),t.getValue()]))}constructor(e,t){super(e),this.memberNodes=t}}(s=S||(S={})).Local="local",s.Remote="remote",s.UndoRedo="undoredo";class td{getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new e9(A.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}constructor(e,t){this.parentCreatedAt=e,this.executedAt=t}}class tu{getNodeString(){return"".concat(this.weight).concat(this.value)}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}constructor(e){this.value=e,this.initWeight()}}class tg{get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}if(e>t.getLength())throw new e9(A.ErrInvalidArgument,"out of index range: pos: ".concat(e," > node.length: ").concat(t.getLength()));return[t,e]}indexOf(e){let t;if(!e||e!==this.root&&!e.hasLinks())return -1;let r=0,n=e;for(;n;)t&&t!==n.getRight()||(r+=n.getLength()+(n.hasLeft()?n.getLeftWeight():0)),t=n,n=n.getParent();return r-e.getLength()}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t)):this.root=t,t}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);let t=new tg(e.getLeft());t.root&&t.root.setParent();let r=new tg(e.getRight());if(r.root&&r.root.setParent(),t.root){let e=t.getRightmost();t.splayNode(e),t.root.setRight(r.root),r.root&&r.root.setParent(t.root),this.root=t.root}else this.root=r.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){let t=[];for(let r of(this.traversePostorder(e.getRight(),t),t))r.initWeight();this.updateTreeWeight(e)}toTestString(){let e=[];return this.traverseInorder(this.root,e),e.map(e=>"[".concat(e.getWeight(),",").concat(e.getLength(),"]").concat(e.getValue()||"")).join("")}checkWeight(){let e=[];for(let t of(this.traverseInorder(this.root,e),e))if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){e&&(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){e&&(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){let t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){let t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return!!(e&&e.hasParent())&&e.getParent().getLeft()===e}isRightChild(e){return!!(e&&e.hasParent())&&e.getParent().getRight()===e}constructor(e){this.root=e}}(a=I||(I={}))[a.Null=0]="Null",a[a.Boolean=1]="Boolean",a[a.Integer=2]="Integer",a[a.Long=3]="Long",a[a.Double=4]="Double",a[a.String=5]="String",a[a.Bytes=6]="Bytes",a[a.Date=7]="Date";class tf extends ta{static of(e,t){return new tf(e,t)}static valueFromBytes(e,t){switch(e){case 0:return null;case 1:return!!t[0];case 2:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 4:{let e=new DataView(t.buffer);return t.forEach(function(t,r){e.setUint8(r,t)}),e.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(t);case 3:return e2.Z.fromBytesLE(Array.from(t));case 6:return t;case 7:return new Date(e2.Z.fromBytesLE(Array.from(t),!0).toNumber());default:throw new e9(A.ErrUnimplemented,"unimplemented type: ".concat(e))}}toJSON(){return 5===this.valueType?'"'.concat(ts(this.value),'"'):"".concat(this.value)}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){let e=tf.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":if(this.isInteger(e))return 2;return 4;case"string":return 5;case"object":if(null===e)return 0;if(e instanceof e2.Z)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return void 0!==tf.getPrimitiveType(e)}static isInteger(e){return e%1==0}isNumericType(){let e=this.valueType;return 2===e||3===e||4===e}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:{let e=this.value;return new Uint8Array(e?[1]:[0])}case 2:{let e=this.value;return new Uint8Array([255&e,e>>8&255,e>>16&255,e>>24&255])}case 4:{let e=this.value,t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),t}case 5:return new TextEncoder().encode(this.value);case 3:{let e=this.value.toBytesLE();return Uint8Array.from(e)}case 6:return this.value;case 7:{let e=this.value,t=e2.Z.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(t)}default:throw new e9(A.ErrUnimplemented,"unimplemented type: ".concat(this.valueType))}}constructor(e,t){super(t),this.valueType=tf.getPrimitiveType(e),this.value=void 0===e?null:e}}class tm extends tu{static createAfter(e,t){let r=new tm(t),n=e.next;return e.next=r,r.prev=e,r.next=n,n&&(n.prev=r),r}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}constructor(e){super(e),this.value=e}}class tp{static create(){return new tp}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString());if(!r)throw new e9(A.ErrInvalidArgument,"cant find the given node: ".concat(e.toIDString()));for(;r.getNext()&&r.getNext().getPositionedAt().after(t);)r=r.getNext();return r}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.getCreatedAt(),n=this.findNextBeforeExecutedAt(e,r),i=tm.createAfter(n,t);n===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(n,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i)}moveAfter(e,t,r){let n=this.nodeMapByCreatedAt.get(e.toIDString());if(!n)throw new e9(A.ErrInvalidArgument,"cant find the given node: ".concat(e.toIDString()));let i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new e9(A.ErrInvalidArgument,"cant find the given node: ".concat(t.toIDString()));n!==i&&(!i.getValue().getMovedAt()||r.after(i.getValue().getMovedAt()))&&(this.release(i),this.insertAfter(n.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r))}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){let t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find the given createdAt: ".concat(e.getCreatedAt().toIDString()));this.release(t)}getByIndex(e){if(e>=this.length)return;let[t,r]=this.nodeMapByIndex.find(e),n=t;if(0===e&&t===this.dummyHead||r>0)do n&&(n=n.getNext());while(n&&n.isRemoved());return n}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString()),n=r.isRemoved();return r.remove(t)&&!n&&this.nodeMapByIndex.splayNode(r),r.getValue()}deleteByIndex(e,t){let r=this.getByIndex(e);if(r)return r.remove(t)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){let e=[];for(let t of this){let r="".concat(t.getCreatedAt().toIDString(),":").concat(t.getValue().toJSON());t.isRemoved()?e.push("{".concat(r,"}")):e.push("[".concat(r,"]"))}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}constructor(){let e=tf.of(0,tn);e.setRemovedAt(tn),this.dummyHead=new tm(e),this.last=this.dummyHead,this.nodeMapByIndex=new tg,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}}class tv extends to{static create(e,t){if(!t)return new tv(e,tp.create());let r=tp.create();for(let e of t)r.insertAfter(r.getLastCreatedAt(),e.deepcopy());return new tv(e,r)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,t){this.elements.insertAfter(e,t)}moveAfter(e,t,r){this.elements.moveAfter(e,t,r)}get(e){let t=this.elements.getByIndex(e);return null==t?void 0:t.getValue()}getByID(e){let t=this.elements.getByID(e);return null==t?void 0:t.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,t){return this.elements.delete(e,t)}deleteByIndex(e,t){return this.elements.deleteByIndex(e,t)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(let e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(let t of this.elements){let r=t.getValue();if(e(r,this))return;r instanceof to&&r.getDescendants(e)}}toJSON(){let e=[];for(let t of this)e.push(t.toJSON());return"[".concat(e.join(","),"]")}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){let e={};for(let t=0;t<this.length;t++){let{createdAt:r,value:n,type:i}=this.get(t).toJSForTest();e[t]={key:String(t),createdAt:r,value:n,type:i}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){let e=tv.create(this.getCreatedAt());for(let t of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),t.getValue().deepcopy());return e.remove(this.getRemovedAt()),e}constructor(e,t){super(e),this.elements=t}}class ty extends td{static create(e,t,r){return new ty(e,t,r)}execute(e,t){let r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(r instanceof to))throw new e9(A.ErrInvalidArgument,"only object and array can execute remove: ".concat(r));if(t===S.UndoRedo){let t=r.getByID(this.createdAt);for(;t;){var n;if(t.getRemovedAt())return;t=null===(n=e.findElementPairByCreatedAt(t.getCreatedAt()))||void 0===n?void 0:n.parent}}let i=r.subPathOf(this.createdAt),s=this.toReverseOperation(r),a=r.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(a),{opInfos:r instanceof tv?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:i}],reverseOp:s}}toReverseOperation(e){if(e instanceof tl){let t=e.subPathOf(this.createdAt);if(void 0!==t){let r=e.get(t);if(void 0!==r)return tA.create(t,r.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".REMOVE.").concat(this.createdAt.toTestString())}getCreatedAt(){return this.createdAt}constructor(e,t,r){super(e,r),this.createdAt=t}}class tA extends td{static create(e,t,r,n){return new tA(e,t,r,n)}execute(e,t){let r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(r instanceof tl))throw new e9(A.ErrInvalidArgument,"fail to execute, only object can execute set");if(t===S.UndoRedo){let t=r;for(;t;){var n;if(t.getRemovedAt())return;t=null===(n=e.findElementPairByCreatedAt(t.getCreatedAt()))||void 0===n?void 0:n.parent}}let i=r.get(this.key),s=this.toReverseOperation(i),a=this.value.deepcopy(),o=r.set(this.key,a,this.getExecutedAt());return t===S.UndoRedo&&e.findByCreatedAt(a.getCreatedAt())&&e.deregisterElement(a),e.registerElement(a,r),o&&e.registerRemovedElement(o),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:s}}toReverseOperation(e){let t=ty.create(this.getParentCreatedAt(),this.value.getCreatedAt());return void 0===e||e.isRemoved()||(t=tA.create(this.key,e.deepcopy(),this.getParentCreatedAt())),t}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".SET.").concat(this.key,"=").concat(this.value.toSortedJSON())}getKey(){return this.key}getValue(){return this.value}constructor(e,t,r,n){super(r,n),this.key=e,this.value=t}}class tT extends td{static create(e,t,r,n){return new tT(e,t,r,n)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof tv))throw new e9(A.ErrInvalidArgument,"fail to execute, only array can execute add");let r=this.value.deepcopy();return t.insertAfter(this.prevCreatedAt,r),e.registerElement(r,t),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(t.subPathOf(this.getEffectedCreatedAt()))}]}}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".ADD.").concat(this.value.toJSON())}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}constructor(e,t,r,n){super(e,n),this.prevCreatedAt=t,this.value=r}}class tS extends td{static create(e,t,r,n){return new tS(e,t,r,n)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof tv))throw new e9(A.ErrInvalidArgument,"fail to execute, only array can execute move");let r=Number(t.subPathOf(this.createdAt));t.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());let n=Number(t.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:n,previousIndex:r}]}}getEffectedCreatedAt(){return this.createdAt}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".MOVE")}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}constructor(e,t,r,n){super(e,n),this.prevCreatedAt=t,this.createdAt=r}}class tI{static of(e,t,r,n){return new tI(e,t,r,n)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return"".concat(this.updatedAt.toIDString(),":").concat(this.key)}getRemovedAt(){if(this._isRemoved)return this.updatedAt}constructor(e,t,r,n){this.key=e,this.value=t,this.updatedAt=r,this._isRemoved=n}}class tC{static create(){return new tC}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,r){let n=this.nodeMapByKey.get(e);if(n&&n.isRemoved()&&r.after(n.getUpdatedAt())&&(this.numberOfRemovedElement-=1),void 0===n||r.after(n.getUpdatedAt())){let i=tI.of(e,t,r,!1);return(this.nodeMapByKey.set(e,i),void 0!==n&&n.isRemoved())?[n,i]:[void 0,i]}return n.isRemoved()?[n,void 0]:[void 0,void 0]}setInternal(e,t,r,n){let i=tI.of(e,t,r,n);this.nodeMapByKey.set(e,i),n&&this.numberOfRemovedElement++}remove(e,t){let r=this.nodeMapByKey.get(e),n=[];if(void 0===r||t.after(r.getUpdatedAt())){if(void 0===r){this.numberOfRemovedElement+=1;let r=tI.of(e,"",t,!0);return this.nodeMapByKey.set(e,r),n.push(r),n}let i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&n.push(r);let s=tI.of(e,r.getValue(),t,!0);this.nodeMapByKey.set(e,s),n.push(s)}return n}has(e){if(this.nodeMapByKey.has(e)){let t=this.nodeMapByKey.get(e);return void 0!==t&&!t.isRemoved()}return!1}get(e){if(this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){let e=new tC;for(let[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";let e=[];for(let[t,r]of this.nodeMapByKey)r.isRemoved()||e.push('"'.concat(ts(t),'":"').concat(ts(r.getValue()),'"'));return"{".concat(e.join(","),"}")}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){let e={};for(let[t,r]of this.nodeMapByKey)r.isRemoved()||(e[t]=r.getValue());return e}*[Symbol.iterator](){for(let[,e]of this.nodeMapByKey)yield e}purge(e){let t=this.nodeMapByKey.get(e.getKey());void 0!=t&&t.toIDString()==e.toIDString()&&(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}constructor(){this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}}(o=C||(C={})).Content="content",o.Style="style";class tw{static create(e){return new tw(e)}get length(){return this.content.length}substring(e,t){let r=new tw(this.content.substring(e,t));return r.attributes=this.attributes.deepcopy(),r}setAttr(e,t,r){return this.attributes.set(e,t,r)}getAttrs(){return this.attributes}toString(){return this.content}toJSON(){let e=ts(this.content),t=this.attributes.toObject(),r=[];for(let[e,n]of Object.entries(t)){let t=JSON.parse(n),i="string"==typeof t?'"'.concat(ts(e),'":"').concat(ts(t),'"'):'"'.concat(ts(e),'":').concat(String(t));r.push(i)}return(r.sort(),0===r.length)?'{"val":"'.concat(e,'"}'):'{"attrs":{'.concat(r.join(","),'},"val":"').concat(e,'"}')}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof tI&&this.attributes.purge(e)}getGCPairs(){let e=[];for(let t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}constructor(e){this.attributes=tC.create(),this.content=e}}class tx extends ta{static create(e,t){return new tx(e,t)}edit(e,t,r,n,i){let s=t?tw.create(t):void 0;if(s&&n)for(let[e,t]of Object.entries(n))s.setAttr(e,t,r);let[a,o,h,c]=this.rgaTreeSplit.edit(e,r,s,i);return[o,c.map(e=>({...e,value:e.value?{attributes:e6(e.value.getAttributes()),content:e.value.getContent()}:{attributes:void 0,content:""},type:"content"})),h,[a,a]]}setStyle(e,t,r,n){let[,i]=this.rgaTreeSplit.findNodeWithSplit(e[1],r),[,s]=this.rgaTreeSplit.findNodeWithSplit(e[0],r),a=[],o=this.rgaTreeSplit.findBetween(s,i),h=new Map,c=[];for(let e of o){let t=e.getCreatedAt().getActorID(),i=(null==n?void 0:n.size)?n.has(t)?n.get(t):tn:ti;if(e.canStyle(r,i)){let r=h.get(t),n=e.getCreatedAt();(!r||n.after(r))&&h.set(t,n),c.push(e)}}let l=[];for(let e of c){if(e.isRemoved())continue;let[n,i]=this.rgaTreeSplit.findIndexesFromRange(e.createPosRange());for(let[s,o]of(a.push({type:"style",actor:r.getActorID(),from:n,to:i,value:{attributes:e6(t)}}),Object.entries(t))){let[t]=e.getValue().setAttr(s,o,r);void 0!==t&&l.push({parent:e.getValue(),child:t})}}return[h,l,a]}indexRangeToPosRange(e,t){let r=this.rgaTreeSplit.indexToPos(e);return e===t?[r,r]:[r,this.rgaTreeSplit.indexToPos(t)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}toJSON(){let e=[];for(let t of this.rgaTreeSplit)t.isRemoved()||e.push(t.getValue().toJSON());return"[".concat(e.join(","),"]")}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){let e=[];for(let t of this.rgaTreeSplit)if(!t.isRemoved()){let r=t.getValue();e.push({attributes:e6(r.getAttributes()),content:r.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){let e=new tx(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.remove(this.getRemovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){let e=[];for(let t of this.rgaTreeSplit)for(let r of(t.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:t}),t.getValue().getGCPairs()))e.push(r);return e}constructor(e,t){super(t),this.rgaTreeSplit=e}}class tk extends td{static create(e,t,r,n,i,s,a){return new tk(e,t,r,n,i,s,a)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof tx))throw new e9(A.ErrInvalidArgument,"fail to execute, only Text can execute edit");let[,r,n]=t.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),this.maxCreatedAtMapByActor);for(let t of n)e.registerGCPair(t);return{opInfos:r.map(t=>{let{from:r,to:n,value:i}=t;return{type:"edit",from:r,to:n,value:i,path:e.createPath(this.getParentCreatedAt())}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),n=this.content;return"".concat(e,".EDIT(").concat(t,",").concat(r,",").concat(n,")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}constructor(e,t,r,n,i,s,a){super(e,a),this.fromPos=t,this.toPos=r,this.maxCreatedAtMapByActor=n,this.content=i,this.attributes=s}}class tE extends td{static create(e,t,r,n,i,s){return new tE(e,t,r,n,i,s)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof tx))throw new e9(A.ErrInvalidArgument,"fail to execute, only Text can execute edit");let[,r,n]=t.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),this.maxCreatedAtMapByActor);for(let t of r)e.registerGCPair(t);return{opInfos:n.map(t=>{let{from:r,to:n,value:i}=t;return{type:"style",from:r,to:n,value:i,path:e.createPath(this.getParentCreatedAt())}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),n=this.attributes;return"".concat(e,".STYL(").concat(t,",").concat(r,",").concat(JSON.stringify(n),")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}constructor(e,t,r,n,i,s){super(e,s),this.fromPos=t,this.toPos=r,this.maxCreatedAtMapByActor=n,this.attributes=i}}let tP="text";function tb(e,t){let r=0,n=e.children;for(let e=0;e<t;e++){let t=n[e];t&&!t.isRemoved&&(r+=t.paddedSize)}return r}class tD{updateAncestorsSize(){let e=this.parent,t=this.isRemoved?-1:1;for(;e&&(e.size+=this.paddedSize*t,!e.isRemoved);)e=e.parent}updateDescendantsSize(){let e=0;for(let t of this._children){let r=t.updateDescendantsSize();t.isRemoved||(e+=r)}return this.size+=e,this.paddedSize}get isText(){return this.type===tP}get paddedSize(){return this.size+(this.isText?0:2)}isAncestorOf(e){return function(e,t){if(e===t)return!1;for(;t.parent;){if(t.parent===e)return!0;t=t.parent}return!1}(this,e)}get nextSibling(){let e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){let e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){if(0===e||e===this.size)return;let r=this.value.slice(0,e),n=this.value.slice(e);if(!n.length)return;this.value=r;let i=this.cloneText(e+t);return i.value=n,this.parent.insertAfterInternal(i,this),i}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}append(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");for(let e of(this._children.push(...t),t))e.parent=this,e.updateAncestorsSize()}prepend(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");for(let e of(this._children.unshift(...t),t))e.parent=this}insertBefore(e,t){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");let r=this._children.indexOf(t);if(-1===r)throw new e9(A.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r),e.updateAncestorsSize()}insertAfter(e,t){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");let r=this._children.indexOf(t);if(-1===r)throw new e9(A.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1),e.updateAncestorsSize()}insertAt(e,t){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize()}removeChild(e){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");let t=this._children.indexOf(e);if(-1===t)throw new e9(A.ErrInvalidArgument,"child not found");this._children.splice(t,1),e.parent=void 0}splitElement(e,t){let r=this.cloneElement(t);this.parent.insertAfterInternal(r,this),r.updateAncestorsSize();let n=this.children.slice(0,e),i=this.children.slice(e);for(let e of(this._children=n,r._children=i,this.size=this._children.reduce((e,t)=>e+t.paddedSize,0),r.size=r._children.reduce((e,t)=>e+t.paddedSize,0),r._children))e.parent=r;return r}insertAfterInternal(e,t){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");let r=this._children.indexOf(t);if(-1===r)throw new e9(A.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1)}insertAtInternal(e,t){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");if(e.isRemoved){let t=this._children.indexOf(e);return this.allChildren.splice(0,t).filter(e=>!e.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new e9(A.ErrRefused,"Text node cannot have children");let t=e;for(;t;){let e=this._children.indexOf(t);if(-1!==e)return e;t=t.parent}return -1}constructor(e,t=[]){if(this.type=e,this.size=0,this._children=t,this.isText&&this._children.length>0)throw new e9(A.ErrRefused,"Text node cannot have children")}}function tR(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let n of e._children)tR(n,t,r+1);t(e,r)}(h=w||(w={})).Start="Start",h.End="End",h.Text="Text";class tN{tokensBetween(e,t,r){!function e(t,r,n,i){if(r>n)throw new e9(A.ErrInvalidArgument,"from is greater than to: ".concat(r," > ").concat(n));if(r>t.size)throw new e9(A.ErrInvalidArgument,"from is out of range: ".concat(r," > ").concat(t.size));if(n>t.size)throw new e9(A.ErrInvalidArgument,"to is out of range: ".concat(n," > ").concat(t.size));if(r===n)return;let s=0;for(let a of t.children){if(r-a.paddedSize<s&&s<n){let t=a.isText?r-s:r-s-1,o=a.isText?n-s:n-s-1,h=!a.isText&&t<0,c=!a.isText&&o>a.size;(a.isText||h)&&i([a,a.isText?"Text":"Start"],c),e(a,Math.max(0,t),Math.min(o,a.size),i),c&&i([a,"End"],c)}s+=a.paddedSize}}(this.root,e,t,r)}traverse(e){!function e(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let i of t.children)e(i,r,n+1);r(t,n)}(this.root,e,0)}traverseAll(e){tR(this.root,e,0)}findTreePos(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return function e(t,r){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(r>t.size)throw new e9(A.ErrInvalidArgument,"index is out of range: ".concat(r," > ").concat(t.size));if(t.isText)return{node:t,offset:r};let i=0,s=0;for(let a of t.children){if(n&&a.isText&&a.size>=r-s)return e(a,r-s,n);if(r===s)break;if(!n&&a.paddedSize===r-s)return{node:t,offset:i+1};if(a.paddedSize>r-s)return e(a,r-s-1,n);s+=a.paddedSize,i+=1}return{node:t,offset:i}}(this.root,e,t)}treePosToPath(e){let t=[],r=e.node;if(r.isText){let n=r.parent.findOffset(r);if(-1===n)throw new e9(A.ErrInvalidArgument,"invalid treePos");let i=tb(r.parent,n);t.push(i+e.offset),r=r.parent}else if(r.hasTextChild()){let n=tb(r,e.offset);t.push(n)}else t.push(e.offset);for(;r.parent;){let e=r.parent.findOffset(r);if(-1===e)throw new e9(A.ErrInvalidArgument,"invalid treePos");t.push(e),r=r.parent}return t.reverse()}pathToIndex(e){let t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new e9(A.ErrInvalidArgument,"unacceptable path");let t=this.root;for(let r=0;r<e.length-1;r++){let n=e[r];if(!(t=t.children[n]))throw new e9(A.ErrInvalidArgument,"unacceptable path")}if(t.hasTextChild())return function(e,t){if(e.size<t)throw new e9(A.ErrInvalidArgument,"unacceptable path");for(let r=0;r<e.children.length;r++){let n=e.children[r];if(n.size<t)t-=n.size;else{e=n;break}}return{node:e,offset:t}}(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new e9(A.ErrInvalidArgument,"unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.size}findPostorderRight(e){let{node:t,offset:r}=e;if(t.isText)return t.size===r?t.nextSibling||t.parent:t;return t.children.length===r?t:function e(t){return t.isText||0===t.children.length?t:e(t.children[0])}(t.children[r])}indexOf(e){let{node:t}=e,{offset:r}=e,n=0,i=1;if(t.isText){n+=r;let e=t.parent,i=e.findOffset(t);if(-1===i)throw new e9(A.ErrInvalidArgument,"invalid pos");n+=tb(e,i),t=t.parent}else n+=tb(t,r);for(;null==t?void 0:t.parent;){let e=t.parent,r=e.findOffset(t);if(-1===r)throw new e9(A.ErrInvalidArgument,"invalid pos");n+=tb(e,r),i++,t=t.parent}return n+i-1}indexToPath(e){let t=this.findTreePos(e);return this.treePosToPath(t)}constructor(e){this.root=e}}let tO=(e,t)=>e===t?0:e<t?-1:1;class tM{constructor(e,t,r){this.key=e,this.value=t,this.isRed=r}}class t_{traverseInorder(e){e&&(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}constructor(e){this.stack=[],this.traverseInorder(e)}}class tL{put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){let t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){this.isRed(this.root.left)||this.isRed(this.root.right)||(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new t_(this.root)}values(){let e=[];for(let t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root;for(;t;){let r=this.comparator(e,t.key);if(r>0){if(!t.right)return t;t.right.parent=t,t=t.right}else if(!(r<0))return t;else if(t.left)t.left.parent=t,t=t.left;else{let e=t.parent,r=t;for(;e&&r===e.left;)r=e,e=e.parent;return e}}}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return 0===this.counter}getInternal(e,t){for(;t;){let r=this.comparator(e,t.key);if(0===r)return t;r<0?t=t.left:r>0&&(t=t.right)}}putInternal(e,t,r){if(!r)return this.counter+=1,new tM(e,t,!0);let n=this.comparator(e,r.key);return n<0?r.left=this.putInternal(e,t,r.left):n>0?r.right=this.putInternal(e,t,r.right):r.value=t,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(e,t){if(0>this.comparator(t,e.key))this.isRed(e.left)||this.isRed(e.left.left)||(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),0===this.comparator(t,e.key)&&!e.right){this.counter-=1;return}if(this.isRed(e.right)||this.isRed(e.right.left)||(e=this.moveRedRight(e)),0===this.comparator(t,e.key)){this.counter-=1;let t=this.min(e.right);e.value=t.value,e.key=t.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(e.left)return this.isRed(e.left)||this.isRed(e.left.left)||(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){let t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){let t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}constructor(e){this.comparator=void 0!==e?e:tO,this.counter=0}}(c=x||(x={})).Content="content",c.Style="style",c.RemoveStyle="removeStyle";class tB{static of(e,t){return new tB(e,t)}static fromTreePos(e){let t;let{offset:r}=e,{node:n}=e;return n.isText?(t=n.parent.children[0]===n&&0===r?n.parent:n,n=n.parent):t=0===r?n:n.children[r-1],tB.of(n.id,tz.of(t.getCreatedAt(),t.getOffset()+r))}getParentID(){return this.parentID}static fromStruct(e){return tB.of(tz.of(tt.fromStruct(e.parentID.createdAt),e.parentID.offset),tz.of(tt.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){let t=this.getParentID(),r=this.getLeftSiblingID(),n=e.findFloorNode(t),i=e.findFloorNode(r);if(!n||!i)throw new e9(A.ErrRefused,"cannot find node of CRDTTreePos(".concat(t.toTestString(),", ").concat(r.toTestString(),")"));return!r.equals(t)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[n,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}constructor(e,t){this.parentID=e,this.leftSiblingID=t}}class tz{static of(e,t){return new tz(e,t)}static fromStruct(e){return tz.of(tt.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{let r=e.getCreatedAt().compare(t.getCreatedAt());return 0!==r?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return 0===this.createdAt.compare(e.createdAt)&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return"".concat(this.createdAt.toIDString(),":").concat(this.offset)}toTestString(){return"".concat(this.createdAt.toTestString(),"/").concat(this.offset)}constructor(e,t){this.createdAt=e,this.offset=t}}class tK extends tD{toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,t,r,n){return new tK(e,t,r,n)}deepcopy(){var e;let t=new tK(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.size=this.size,t.attrs=null===(e=this.attrs)||void 0===e?void 0:e.deepcopy(),t._children=this._children.map(e=>{let r=e.deepcopy();return r.parent=t,r}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new e9(A.ErrInvalidType,"cannot get value of element node: ".concat(this.type));return this._value}set value(e){if(!this.isText)throw new e9(A.ErrInvalidType,"cannot set value of element node: ".concat(this.type));this._value=e,this.size=e.length}get isRemoved(){return!!this.removedAt}remove(e){let t=!this.removedAt;(!this.removedAt||this.removedAt.compare(e)>0)&&(this.removedAt=e),t&&this.updateAncestorsSize()}cloneText(e){return new tK(tz.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new tK(tz.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,t,r){let n=this.isText?this.splitText(t,this.id.getOffset()):this.splitElement(t,r);return n&&(n.insPrevID=this.id,this.insNextID&&(e.findFloorNode(this.insNextID).insPrevID=n.id,n.insNextID=this.insNextID),this.insNextID=n.id,e.registerNode(n)),n}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,t){return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}canStyle(e,t){return!this.isText&&!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,t){this.attrs||(this.attrs=new tC);let r=[];for(let[n,i]of Object.entries(e))r.push(this.attrs.set(n,i,t));return r}purge(e){this.attrs&&this.attrs.purge(e)}getGCPairs(){let e=[];if(!this.attrs)return e;for(let t of this.attrs)t.getRemovedAt()&&e.push({parent:this,child:t});return e}constructor(e,t,r,n,i){super(t),this._value="",this.id=e,this.removedAt=i,n&&(this.attrs=n),"string"==typeof r?this.value=r:Array.isArray(r)&&(this._children=r)}}function tU(e){if(e.isText)return{type:e.type,value:e.value};let t={type:e.type,children:e.children.map(tU)};if(e.attrs){var r;t.attributes=e6(null===(r=e.attrs)||void 0===r?void 0:r.toObject())}return t}function tJ(e){if(e.isText)return e.value;let t="";return e.attrs&&e.attrs.size()&&(t=" "+Array.from(e.attrs).filter(e=>!e.isRemoved()).sort((e,t)=>e.getKey().localeCompare(t.getKey())).map(e=>{let t=JSON.parse(e.getValue());return"string"==typeof t?"".concat(e.getKey(),'="').concat(t,'"'):"".concat(e.getKey(),'="').concat(ts(e.getValue()),'"')}).join(" ")),"<".concat(e.type).concat(t,">").concat(e.children.map(e=>tJ(e)).join(""),"</").concat(e.type,">")}class tj extends ta{static create(e,t){return new tj(e,t)}findFloorNode(e){let t=this.nodeMapByID.floorEntry(e);if(t&&t.key.getCreatedAt().equals(e.getCreatedAt()))return t.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,t){let[r,n]=e.toTreeNodePair(this),i=n,s=r===i,a=i.parent&&!s?i.parent:r;if(i.isText&&i.split(this,e.getLeftSiblingID().getOffset()-i.id.getOffset()),t){let e=a.allChildren,r=s?0:e.indexOf(i)+1;for(let n=r;n<e.length;n++){let r=e[n];if(!r.id.getCreatedAt().after(t))break;i=r}}return[a,i]}style(e,t,r,n){let[i,s]=this.findNodesAndSplitText(e[0],r),[a,o]=this.findNodesAndSplitText(e[1],r),h=[],c=t?e6(t):{},l=new Map,d=[];return this.traverseInPosRange(i,s,a,o,e=>{let[i]=e,s=i.getCreatedAt().getActorID(),a=n?n.has(s)?n.get(s):tn:ti;if(i.canStyle(r,a)&&t){let e=l.get(s),n=i.getCreatedAt();(!e||n.after(e))&&l.set(s,n);let a=i.setAttrs(t,r),o=a.reduce((e,t)=>{let[,r]=t;return r&&(e[r.getKey()]=c[r.getKey()]),e},{}),u=i.parent,g=i.prevSibling||i.parent;for(let[e]of(Object.keys(o).length>0&&h.push({type:"style",from:this.toIndex(u,g),to:this.toIndex(i,i),fromPath:this.toPath(u,g),toPath:this.toPath(i,i),actor:r.getActorID(),value:o}),a))e&&d.push({parent:i,child:e})}}),[l,d,h]}removeStyle(e,t,r,n){let[i,s]=this.findNodesAndSplitText(e[0],r),[a,o]=this.findNodesAndSplitText(e[1],r),h=[],c=new Map,l=[];return this.traverseInPosRange(i,s,a,o,e=>{let[i]=e,s=i.getCreatedAt().getActorID(),a=n?n.has(s)?n.get(s):tn:ti;if(i.canStyle(r,a)&&t){let e=c.get(s),n=i.getCreatedAt();for(let a of((!e||n.after(e))&&c.set(s,n),i.attrs||(i.attrs=new tC),t))for(let e of i.attrs.remove(a,r))l.push({parent:i,child:e});let a=i.parent,o=i.prevSibling||i.parent;h.push({actor:r.getActorID(),type:"removeStyle",from:this.toIndex(a,o),to:this.toIndex(i,i),fromPath:this.toPath(a,o),toPath:this.toPath(i,i),value:t})}}),[c,l,h]}edit(e,t,r,n,i,s){let[a,o]=this.findNodesAndSplitText(e[0],n),[h,c]=this.findNodesAndSplitText(e[1],n),l=this.toIndex(a,o),d=this.toPath(a,o),u=[],g=[],f=[],m=new Map;this.traverseInPosRange(a,o,h,c,(e,t)=>{let[r,i]=e;if(i===w.Start&&!t)for(let e of r.children)f.push(e);let a=r.getCreatedAt().getActorID(),o=s?s.has(a)?s.get(a):tn:ti;if(r.canDelete(n,o)||u.includes(r.parent)){let e=m.get(a),t=r.getCreatedAt();(!e||t.after(e))&&m.set(a,t),(i===w.Text||i===w.Start)&&u.push(r),g.push([r,i])}});let p=this.makeDeletionChanges(g,n),v=[];for(let e of u)e.remove(n),e.isRemoved&&v.push({parent:this,child:e});for(let e of f)e.removedAt||a.append(e);if(r>0){let e=0,t=a,s=o;for(;e<r;)t.split(this,t.findOffset(s)+1,i),s=t,t=t.parent,e++;p.push({type:"content",from:l,to:l,fromPath:d,toPath:d,actor:n.getActorID()})}if(null==t?void 0:t.length){let e=[],r=o;for(let i of t)r===a?a.insertAt(i,0):a.insertAfter(i,r),r=i,tR(i,e=>{a.isRemoved&&(e.remove(n),v.push({parent:this,child:e})),this.nodeMapByID.put(e.id,e)}),i.isRemoved||e.push(i);if(e.length){let t=e.map(e=>tU(e));p.length&&p[p.length-1].from===l?p[p.length-1].value=t:p.push({type:"content",from:l,to:l,fromPath:d,toPath:d,actor:n.getActorID(),value:t})}}return[p,v,m]}editT(e,t,r,n,i){let s=this.findPos(e[0]),a=this.findPos(e[1]);this.edit([s,a],t,r,n,i)}move(e,t,r){throw new e9(A.ErrUnimplemented,"not implemented: ".concat(e,", ").concat(t,", ").concat(r))}purge(e){var t;null===(t=e.parent)||void 0===t||t.removeChild(e),this.nodeMapByID.remove(e.id);let r=e.insPrevID,n=e.insNextID;r&&(this.findFloorNode(r).insNextID=n),n&&(this.findFloorNode(n).insPrevID=r),e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){let e=[];return this.indexTree.traverse(t=>{for(let r of(t.getRemovedAt()&&e.push({parent:this,child:t}),t.getGCPairs()))e.push(r)}),e}findPos(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=this.indexTree.findTreePos(e,t);return tB.fromTreePos(r)}pathToPosRange(e){let t=this.pathToIndex(e);return[this.findPos(t),this.findPos(t+1)]}pathToPos(e){let t=this.indexTree.pathToIndex(e);return this.findPos(t)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return tJ(this.indexTree.getRoot())}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){var e=this;let t=this.indexTree.getRoot(),r=function(t){var n,i,s,a;let o,h,c,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=t.isText?{node:t,offset:0}:l&&d?e.toTreePos(l,d):null;g&&(o=e.indexTree.indexOf(g),h=e.indexTree.treePosToPath(g),c=tB.fromTreePos(g).toStruct());let f={type:t.type,parent:null==l?void 0:l.id.toTestString(),size:t.size,id:t.id.toTestString(),removedAt:null===(n=t.removedAt)||void 0===n?void 0:n.toTestString(),insPrev:null===(i=t.insPrevID)||void 0===i?void 0:i.toTestString(),insNext:null===(s=t.insNextID)||void 0===s?void 0:s.toTestString(),value:t.isText?t.value:void 0,isRemoved:t.isRemoved,children:[],depth:u,attributes:t.attrs?e6(null===(a=t.attrs)||void 0===a?void 0:a.toObject()):void 0,index:o,path:h,pos:c};for(let e=0;e<t.allChildren.length;e++){let n=0===e?t:t.allChildren[e-1];f.children.push(r(t.allChildren[e],t,n,u+1))}return f};return r(t)}getRootTreeNode(){return tU(this.indexTree.getRoot())}toTestTreeNode(){return function e(t){return t.isText?{type:t.type,value:t.value,size:t.size,isRemoved:t.isRemoved}:{type:t.type,children:t.children.map(e),size:t.size,isRemoved:t.isRemoved}}(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){return new tj(this.getRoot().deepcopy(),this.getCreatedAt())}toPath(e,t){let r=this.toTreePos(e,t);return r?this.indexTree.treePosToPath(r):[]}toIndex(e,t){let r=this.toTreePos(e,t);return r?this.indexTree.indexOf(r):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){let t=this.findPos(e[0]);return e[0]===e[1]?[t,t]:[t,this.findPos(e[1])]}indexRangeToPosStructRange(e){let[t,r]=e,n=this.findPos(t);return t===r?[n.toStruct(),n.toStruct()]:[n.toStruct(),this.findPos(r).toStruct()]}posRangeToPathRange(e){let[t,r]=this.findNodesAndSplitText(e[0]),[n,i]=this.findNodesAndSplitText(e[1]);return[this.toPath(t,r),this.toPath(n,i)]}posRangeToIndexRange(e){let[t,r]=this.findNodesAndSplitText(e[0]),[n,i]=this.findNodesAndSplitText(e[1]);return[this.toIndex(t,r),this.toIndex(n,i)]}traverseInPosRange(e,t,r,n,i){let s=this.toIndex(e,t),a=this.toIndex(r,n);return this.indexTree.tokensBetween(s,a,i)}toTreePos(e,t){if(!e||!t)return;if(e.isRemoved){let t;for(;e.isRemoved;)e=(t=e).parent;let r=e.findOffset(t);return{node:e,offset:r}}if(e===t)return{node:e,offset:0};let r=e.findOffset(t);if(!t.isRemoved){if(t.isText)return{node:t,offset:t.paddedSize};r++}return{node:e,offset:r}}makeDeletionChanges(e,t){let r=[],n=[],i=null,s=null;for(let t=0;t<e.length;t++){let r=e[t],a=e[t+1];i||(i=r),s=r;let o=this.findRightToken(r);o&&a&&o[0]===a[0]&&o[1]===a[1]||(n.push([i,s]),i=null,s=null)}for(let e of n){let[n,i]=e,[s,a]=this.findLeftToken(n),[o,h]=i,c=a===w.Start?s:s.parent,l=h===w.Start?o:o.parent,d=this.toIndex(c,s),u=this.toIndex(l,o);d<u&&(r.length>0&&d===r[r.length-1].to?(r[r.length-1].to=u,r[r.length-1].toPath=this.toPath(l,o)):r.push({type:"content",from:d,to:u,fromPath:this.toPath(c,s),toPath:this.toPath(l,o),actor:t.getActorID()}))}return r.reverse()}findRightToken(e){let[t,r]=e;if(r===w.Start){let e=t.allChildren;return e.length>0?[e[0],e[0].isText?w.Text:w.Start]:[t,w.End]}let n=t.parent,i=n.allChildren,s=i.indexOf(t);if(n&&s===i.length-1)return[n,w.End];let a=i[s+1];return[a,a.isText?w.Text:w.Start]}findLeftToken(e){let[t,r]=e;if(r===w.End){let e=t.allChildren;if(e.length>0){let t=e[e.length-1];return[t,t.isText?w.Text:w.End]}return[t,w.Start]}let n=t.parent,i=n.allChildren,s=i.indexOf(t);if(n&&0===s)return[n,w.Start];let a=i[s-1];return[a,a.isText?w.Text:w.End]}constructor(e,t){super(t),this.indexTree=new tN(e),this.nodeMapByID=new tL(tz.createComparator()),this.indexTree.traverseAll(e=>{this.nodeMapByID.put(e.id,e)})}}class tq extends td{static create(e,t,r,n,i,s,a){return new tq(e,t,r,n,i,s,a)}execute(e){var t;let r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(r instanceof tj))throw new e9(A.ErrInvalidArgument,"fail to execute, only Tree can execute edit");let n=this.getExecutedAt(),[i,s]=r.edit([this.fromPos,this.toPos],null===(t=this.contents)||void 0===t?void 0:t.map(e=>e.deepcopy()),this.splitLevel,n,(()=>{let e=n.getDelimiter();return void 0!==this.contents&&(e+=this.contents.length),()=>tt.of(n.getLamport(),++e,n.getActorID())})(),this.maxCreatedAtMapByActor);for(let t of s)e.registerGCPair(t);return{opInfos:i.map(t=>{let{from:r,to:n,value:i,splitLevel:s,fromPath:a,toPath:o}=t;return{type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:r,to:n,value:i,splitLevel:s,fromPath:a,toPath:o}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t="".concat(this.fromPos.getLeftSiblingID().getCreatedAt().toTestString(),"/").concat(this.fromPos.getLeftSiblingID().getOffset()),r="".concat(this.toPos.getLeftSiblingID().getCreatedAt().toTestString(),"/").concat(this.toPos.getLeftSiblingID().getOffset()),n=this.contents||[];return"".concat(e,".EDIT(").concat(t,",").concat(r,",").concat(n.map(e=>tJ(e)).join(""),")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}constructor(e,t,r,n,i,s,a){super(e,a),this.fromPos=t,this.toPos=r,this.contents=n,this.splitLevel=i,this.maxCreatedAtMapByActor=s}}class tF{static of(e,t,r,n){return new tF(e,t,r,n)}next(){return new tF(this.clientSeq+1,this.lamport.add(1),this.actor)}syncLamport(e){return e.greaterThan(this.lamport)?new tF(this.clientSeq,e,this.actor):new tF(this.clientSeq,this.lamport.add(1),this.actor)}createTimeTicket(e){return tt.of(this.lamport,e,this.actor)}setActor(e){return new tF(this.clientSeq,this.lamport,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}toTestString(){return"".concat(this.lamport.toString(),":").concat(this.actor.slice(-2),":").concat(this.clientSeq)}constructor(e,t,r,n){this.clientSeq=e,this.serverSeq=n,this.lamport=t,this.actor=r}}let tV=new tF(0,e2.Z.fromInt(0,!0),te);class tW{static create(e){let{id:t,operations:r,presenceChange:n,message:i}=e;return new tW({id:t,operations:r,presenceChange:n,message:i})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(let t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return void 0!==this.presenceChange}getPresenceChange(){return this.presenceChange}execute(e,t,r){let n=[],i=[];for(let t of this.operations){let s=t.execute(e,r);if(!s)continue;let{opInfos:a,reverseOp:o}=s;n.push(...a),o&&i.unshift(o)}return this.presenceChange&&(this.presenceChange.type===T.Put?t.set(this.id.getActorID(),e4(this.presenceChange.presence)):t.delete(this.id.getActorID())),{opInfos:n,reverseOps:i}}toTestString(){return"".concat(this.operations.map(e=>e.toTestString()).join(","))}toStruct(){return{changeID:rD.bytesToHex(rD.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(e=>rD.bytesToHex(rD.toOperation(e).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(e){let{changeID:t,operations:r,presenceChange:n,message:i}=e;return tW.create({id:rD.bytesToChangeID(rD.hexToBytes(t)),operations:null==r?void 0:r.map(e=>rD.bytesToOperation(rD.hexToBytes(e))),presenceChange:n,message:i})}constructor({id:e,operations:t,presenceChange:r,message:n}){this.id=e,this.operations=t||[],this.presenceChange=r,this.message=n}}class tG{static create(e,t,r,n,i,s){return new tG(e,t,r,n,i,s)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getMinSyncedTicket(){return this.minSyncedTicket}constructor(e,t,r,n,i,s){this.documentKey=e,this.checkpoint=t,this.isRemoved=r,this.changes=n,this.snapshot=i,this.minSyncedTicket=s}}class tH{static of(e,t){return new tH(e,t)}increaseClientSeq(e){return 0===e?this:new tH(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;let t=this.serverSeq.greaterThan(e.serverSeq)?this.serverSeq:e.serverSeq,r=Math.max(this.clientSeq,e.clientSeq);return tH.of(t,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq.equals(e.serverSeq)}toTestString(){return"serverSeq=".concat(this.serverSeq,", clientSeq=").concat(this.clientSeq)}constructor(e,t){this.serverSeq=e,this.clientSeq=t}}let tY=new tH(e2.Z.fromInt(0,!0),0);class tZ{static of(e,t){return new tZ(e,t)}static fromStruct(e){return tZ.of(tt.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return 0===this.createdAt.compare(e.createdAt)&&this.offset===e.offset}hasSameCreatedAt(e){return 0===this.createdAt.compare(e.createdAt)}split(e){return new tZ(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return"".concat(this.createdAt.toTestString(),":").concat(this.offset)}toIDString(){return"".concat(this.createdAt.toIDString(),":").concat(this.offset)}constructor(e,t){this.createdAt=e,this.offset=t}}let tX=tZ.of(tn,0);class tQ{static of(e,t){return new tQ(e,t)}static fromStruct(e){let t=tZ.fromStruct(e.id);return tQ.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return tZ.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return"".concat(this.id.toTestString(),":").concat(this.relativeOffset)}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return!!this.id.equals(e.id)&&this.relativeOffset===e.relativeOffset}constructor(e,t){this.id=e,this.relativeOffset=t}}class t$ extends tu{static create(e,t){return new t$(e,t)}static createComparator(){return(e,t)=>{let r=e.getCreatedAt().compare(t.getCreatedAt());return 0!==r?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new t$(this.id.split(e),this.splitValue(e),this.removedAt)}canDelete(e,t){let r=!this.removedAt;return!!(!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt)))&&r}canStyle(e,t){return!this.getCreatedAt().after(t)&&(!this.removedAt||e.after(this.removedAt))}remove(e){this.removedAt=e}createPosRange(){return[tQ.of(this.id,0),tQ.of(this.id,this.getLength())]}deepcopy(){return new t$(this.id,this.value,this.removedAt)}toTestString(){return"".concat(this.id.toTestString()," ").concat(this.value?this.value:"")}splitValue(e){let t=this.value;return this.value=t.substring(0,e),t.substring(e,t.length)}toIDString(){return this.id.toIDString()}constructor(e,t,r){super(t),this.id=e,this.removedAt=r}}class t0{static create(){return new t0}edit(e,t,r,n){let[i,s]=this.findNodeWithSplit(e[1],t),[a,o]=this.findNodeWithSplit(e[0],t),h=this.findBetween(o,s),[c,l,d]=this.deleteNodes(h,t,n),u=s?s.getID():i.getID(),g=tQ.of(u,0);if(r){let e=this.posToIndex(a.createPosRange()[1],!0),n=this.insertAfter(a,t$.create(tZ.of(t,0),r));c.length&&c[c.length-1].from===e?c[c.length-1].value=r:c.push({actor:t.getActorID(),from:e,to:e,value:r}),g=tQ.of(n.getID(),n.getContentLength())}let f=[];for(let[,e]of d)f.push({parent:this,child:e});return[g,l,f,c]}indexToPos(e){let[t,r]=this.treeByIndex.find(e);return tQ.of(t.getID(),r)}findIndexesFromRange(e){let[t,r]=e;return[this.posToIndex(t,!1),this.posToIndex(r,!0)]}posToIndex(e,t){let r=e.getAbsoluteID(),n=t?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!n)throw new e9(A.ErrInvalidArgument,"the node of the given id should be found: ".concat(r.toTestString()));return this.treeByIndex.indexOf(n)+(n.isRemoved()?0:r.getOffset()-n.getID().getOffset())}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){let e=[];for(let t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){let e;let t=new t0,r=this.head.getNext(),n=t.head;for(;r;){if(e=t.insertAfter(n,r.deepcopy()),r.hasInsPrev()){let n=t.findNode(r.getInsPrevID());e.setInsPrev(n)}n=e,r=r.getNext()}return t}toTestString(){let e=[],t=this.head;for(;t;)t.isRemoved()?e.push("{".concat(t.toTestString(),"}")):e.push("[".concat(t.toTestString(),"]")),t=t.getNext();return e.join("")}insertAfter(e,t){let r=e.getNext();return t.setPrev(e),r&&r.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){let r=e.getAbsoluteID(),n=this.findFloorNodePreferToLeft(r),i=r.getOffset()-n.getID().getOffset();for(this.splitNode(n,i);n.hasNext()&&n.getNext().getCreatedAt().after(t);)n=n.getNext();return[n,n.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(!t)throw new e9(A.ErrInvalidArgument,"the node of the given id should be found: ".concat(e.toTestString()));if(e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){let t=this.treeByID.floorEntry(e);if(t&&(t.key.equals(e)||t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){let r=[],n=e;for(;n&&n!==t;)r.push(n),n=n.getNext();return r}splitNode(e,t){if(t>e.getContentLength())throw new e9(A.ErrInvalidArgument,"offset should be less than or equal to length");if(0===t)return e;if(t===e.getContentLength())return e.getNext();let r=e.split(t);this.treeByIndex.updateWeight(r),this.insertAfter(e,r);let n=e.getInsNext();return n&&n.setInsPrev(r),r.setInsPrev(e),r}deleteNodes(e,t,r){if(!e.length)return[[],new Map,new Map];let[n,i]=this.filterNodes(e,t,r),s=new Map,a=new Map,o=this.makeChanges(i,t);for(let e of n){let r=e.getCreatedAt().getActorID();(!s.has(r)||e.getID().getCreatedAt().after(s.get(r)))&&s.set(r,e.getID().getCreatedAt()),a.set(e.getID().toIDString(),e),e.remove(t)}return this.deleteIndexNodes(i),[o,s,a]}filterNodes(e,t,r){let n=!!r,i=[],s=[],[a,o]=this.findEdgesOfCandidates(e);for(let o of(s.push(a),e)){let e=o.getCreatedAt().getActorID(),a=n?r.has(e)?r.get(e):tn:ti;o.canDelete(t,a)?i.push(o):s.push(o)}return s.push(o),[i,s]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){let r,n;let i=[];for(let s=0;s<e.length-1;s++){let a=e[s],o=e[s+1];a.getNext()!=o&&([r]=this.findIndexesFromRange(a.getNext().createPosRange()),o?[,n]=this.findIndexesFromRange(o.getPrev().createPosRange()):n=this.treeByIndex.length,r<n&&i.push({actor:t.getActorID(),from:r,to:n}))}return i.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){let r=e[t],n=e[t+1];r.getNext()!=n&&this.treeByIndex.deleteRange(r,n)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());let t=e.getPrev(),r=e.getNext(),n=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(r),r&&r.setPrev(t),e.setPrev(void 0),e.setNext(void 0),n&&n.setInsNext(i),i&&i.setInsPrev(n),e.setInsPrev(void 0),e.setInsNext(void 0)}constructor(){this.head=t$.create(tX),this.treeByIndex=new tg,this.treeByID=new tL(t$.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}}let t1=e=>e<0?Math.ceil(e):Math.floor(e);(l=k||(k={}))[l.IntegerCnt=0]="IntegerCnt",l[l.LongCnt=1]="LongCnt";class t2 extends ta{static create(e,t,r){return new t2(e,t,r)}static valueFromBytes(e,t){switch(e){case 0:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 1:return e2.Z.fromBytesLE(Array.from(t));default:throw new e9(A.ErrUnimplemented,"unimplemented type: ".concat(e))}}toJSON(){return"".concat(this.value)}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){let e=t2.create(this.valueType,this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":if(e instanceof e2.Z)return 1;return;case"number":if(e>2147483647||e<-2147483648)return 1;return 0;default:return}}static isSupport(e){return!!t2.getCounterType(e)}static isInteger(e){return e%1==0}isNumericType(){let e=this.valueType;return 0===e||1===e}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{let e=this.value;return new Uint8Array([255&e,e>>8&255,e>>16&255,e>>24&255])}case 1:{let e=this.value.toBytesLE();return Uint8Array.from(e)}default:throw new e9(A.ErrUnimplemented,"unimplemented type: ".concat(this.valueType))}}increase(e){function t(e){if(!e.isNumericType())throw TypeError("Unsupported type of value: ".concat(typeof e.getValue()))}return t(this),t(e),1===this.valueType?this.value=this.value.add(e.getValue()):e.getType()===I.Long?this.value=this.value+e.getValue().toInt():this.value=e2.Z.fromNumber(this.value+t1(e.getValue())).toInt(),this}constructor(e,t,r){switch(super(r),this.valueType=e,e){case 0:"number"==typeof t?t>2147483647||t<-2147483648?this.value=e2.Z.fromNumber(t).toInt():this.value=t1(t):this.value=t.toInt();break;case 1:"number"==typeof t?this.value=e2.Z.fromNumber(t):this.value=t;break;default:throw new e9(A.ErrUnimplemented,"unimplemented type: ".concat(e))}}}class t3 extends td{static create(e,t,r){return new t3(e,t,r)}execute(e){let t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(t instanceof t2))throw new e9(A.ErrInvalidArgument,"fail to execute, only Counter can execute increase");let r=this.value.deepcopy();return t.increase(r),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:r.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){let e=this.value.deepcopy(),t=e.getType()===I.Long?e.getValue().multiply(-1):-1*e.getValue();return t3.create(this.getParentCreatedAt(),tf.of(t,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return"".concat(this.getParentCreatedAt().toTestString(),".INCREASE.").concat(this.value.toJSON())}getValue(){return this.value}constructor(e,t,r){super(e,r),this.value=t}}class t9 extends td{static create(e,t,r,n,i,s){return new t9(e,t,r,n,i,[],s)}static createTreeRemoveStyleOperation(e,t,r,n,i,s){return new t9(e,t,r,n,new Map,i,s)}execute(e){let t,r;let n=e.findByCreatedAt(this.getParentCreatedAt());if(!n)throw new e9(A.ErrInvalidArgument,"fail to find ".concat(this.getParentCreatedAt()));if(!(n instanceof tj))throw new e9(A.ErrInvalidArgument,"fail to execute, only Tree can execute edit");if(this.attributes.size){let e={};[...this.attributes].forEach(t=>{let[r,n]=t;return e[r]=n}),[,r,t]=n.style([this.fromPos,this.toPos],e,this.getExecutedAt(),this.maxCreatedAtMapByActor)}else{let e=this.attributesToRemove;[,r,t]=n.removeStyle([this.fromPos,this.toPos],e,this.getExecutedAt(),this.maxCreatedAtMapByActor)}for(let t of r)e.registerGCPair(t);return{opInfos:t.map(t=>{let{from:r,to:n,value:i,fromPath:s,toPath:a}=t;return{type:"tree-style",from:r,to:n,value:this.attributes.size?{attributes:i}:{attributesToRemove:i},fromPath:s,toPath:a,path:e.createPath(this.getParentCreatedAt())}})}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){let e=this.getParentCreatedAt().toTestString(),t="".concat(this.fromPos.getLeftSiblingID().getCreatedAt().toTestString(),":").concat(this.fromPos.getLeftSiblingID().getOffset()),r="".concat(this.toPos.getLeftSiblingID().getCreatedAt().toTestString(),":").concat(this.toPos.getLeftSiblingID().getOffset());return"".concat(e,".STYLE(").concat(t,",").concat(r,",").concat(Object.entries(this.attributes||{}).map(e=>{let[t,r]=e;return"".concat(t,':"').concat(r,'"')}).join(" "),")")}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}constructor(e,t,r,n,i,s,a){super(e,a),this.fromPos=t,this.toPos=r,this.maxCreatedAtMapByActor=n,this.attributes=i,this.attributesToRemove=s}}function t4(e){return new $({clientSeq:e.getClientSeq(),lamport:e.getLamportAsString(),actorId:rb(e.getActorID())})}function t5(e){if(e)return new eM({lamport:e.getLamportAsString(),delimiter:e.getDelimiter(),actorId:rb(e.getActorID())})}function t8(e){switch(e){case I.Null:return H.NULL;case I.Boolean:return H.BOOLEAN;case I.Integer:return H.INTEGER;case I.Long:return H.LONG;case I.Double:return H.DOUBLE;case I.String:return H.STRING;case I.Bytes:return H.BYTES;case I.Date:return H.DATE;default:throw new e9(A.ErrInvalidType,"unsupported type: ".concat(e))}}function t6(e){switch(e){case k.IntegerCnt:return H.INTEGER_CNT;case k.LongCnt:return H.LONG_CNT;default:throw new e9(A.ErrInvalidType,"unsupported type: ".concat(e))}}function t7(e){if(e instanceof tl)return new ed({type:H.JSON_OBJECT,createdAt:t5(e.getCreatedAt()),value:rE(e)});if(e instanceof tv)return new ed({type:H.JSON_ARRAY,createdAt:t5(e.getCreatedAt()),value:rs(e).toBinary()});if(e instanceof tx)return new ed({type:H.TEXT,createdAt:t5(e.getCreatedAt())});if(e instanceof tf)return new ed({type:t8(e.getType()),createdAt:t5(e.getCreatedAt()),value:e.toBytes()});if(e instanceof t2)return new ed({type:t6(e.getType()),createdAt:t5(e.getCreatedAt()),value:e.toBytes()});if(e instanceof tj)return new ed({type:H.TREE,createdAt:t5(e.getCreatedAt()),value:ra(e).toBinary()});throw new e9(A.ErrUnimplemented,"unimplemented element")}function re(e){return new eO({createdAt:t5(e.getID().getCreatedAt()),offset:e.getID().getOffset(),relativeOffset:e.getRelativeOffset()})}function rt(e){return new eE({parentId:rr(e.getParentID()),leftSiblingId:rr(e.getLeftSiblingID())})}function rr(e){return new ek({createdAt:t5(e.getCreatedAt()),offset:e.getOffset()})}function rn(e){let t=new ee;if(e instanceof tA){let r=new et;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.key=e.getKey(),r.value=t7(e.getValue()),r.executedAt=t5(e.getExecutedAt()),t.body.case="set",t.body.value=r}else if(e instanceof tT){let r=new er;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.prevCreatedAt=t5(e.getPrevCreatedAt()),r.value=t7(e.getValue()),r.executedAt=t5(e.getExecutedAt()),t.body.case="add",t.body.value=r}else if(e instanceof tS){let r=new en;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.prevCreatedAt=t5(e.getPrevCreatedAt()),r.createdAt=t5(e.getCreatedAt()),r.executedAt=t5(e.getExecutedAt()),t.body.case="move",t.body.value=r}else if(e instanceof ty){let r=new ei;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.createdAt=t5(e.getCreatedAt()),r.executedAt=t5(e.getExecutedAt()),t.body.case="remove",t.body.value=r}else if(e instanceof tk){let r=new es;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.from=re(e.getFromPos()),r.to=re(e.getToPos());let n=r.createdAtMapByActor;for(let[t,r]of e.getMaxCreatedAtMapByActor())n[t]=t5(r);r.content=e.getContent();let i=r.attributes;for(let[t,r]of e.getAttributes())i[t]=r;r.executedAt=t5(e.getExecutedAt()),t.body.case="edit",t.body.value=r}else if(e instanceof tE){let r=new eo;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.from=re(e.getFromPos()),r.to=re(e.getToPos());let n=r.createdAtMapByActor;for(let[t,r]of e.getMaxCreatedAtMapByActor())n[t]=t5(r);let i=r.attributes;for(let[t,r]of e.getAttributes())i[t]=r;r.executedAt=t5(e.getExecutedAt()),t.body.case="style",t.body.value=r}else if(e instanceof t3){let r=new eh;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.value=t7(e.getValue()),r.executedAt=t5(e.getExecutedAt()),t.body.case="increase",t.body.value=r}else if(e instanceof tq){let r=new ec,n=r.createdAtMapByActor;for(let[t,r]of e.getMaxCreatedAtMapByActor())n[t]=t5(r);r.parentCreatedAt=t5(e.getParentCreatedAt()),r.from=rt(e.getFromPos()),r.to=rt(e.getToPos()),r.contents=function(e){let t=[];if(!e||!e.length)return t;for(let r of e)t.push(new ex({content:ri(r)}));return t}(e.getContents()),r.splitLevel=e.getSplitLevel(),r.executedAt=t5(e.getExecutedAt()),t.body.case="treeEdit",t.body.value=r}else if(e instanceof t9){let r=new el;r.parentCreatedAt=t5(e.getParentCreatedAt()),r.from=rt(e.getFromPos()),r.to=rt(e.getToPos());let n=r.createdAtMapByActor;for(let[t,r]of e.getMaxCreatedAtMapByActor())n[t]=t5(r);let i=e.getAttributesToRemove();if(i.length>0)r.attributesToRemove=i;else{let t=r.attributes;for(let[r,n]of e.getAttributes())t[r]=n}r.executedAt=t5(e.getExecutedAt()),t.body.case="treeStyle",t.body.value=r}else throw new e9(A.ErrUnimplemented,"unimplemented operation");return t}function ri(e){if(!e)return[];let t=[];return tR(e,(e,r)=>{let n=new ew({id:rr(e.id),type:e.type,removedAt:t5(e.removedAt),depth:r});e.isText&&(n.value=e.value),e.insPrevID&&(n.insPrevId=rr(e.insPrevID)),e.insNextID&&(n.insNextId=rr(e.insNextID)),e.attrs&&(n.attributes=function(e){let t={};for(let r of e)t[r.getKey()]=new eS({value:r.getValue(),updatedAt:t5(r.getUpdatedAt()),isRemoved:r.isRemoved()});return t}(e.attrs)),t.push(n)}),t}function rs(e){let t=new eu;return t.body.case="jsonArray",t.body.value=new ef({nodes:function(e){let t=[];for(let r of e)t.push(new eT({element:ro(r.getValue())}));return t}(e.getElements()),createdAt:t5(e.getCreatedAt()),movedAt:t5(e.getMovedAt()),removedAt:t5(e.getRemovedAt())}),t}function ra(e){let t=new eu;return t.body.case="tree",t.body.value=new ey({nodes:ri(e.getRoot()),createdAt:t5(e.getCreatedAt()),movedAt:t5(e.getMovedAt()),removedAt:t5(e.getRemovedAt())}),t}function ro(e){if(e instanceof tl)return function(e){let t=new eu;return t.body.case="jsonObject",t.body.value=new eg({nodes:function(e){let t=[];for(let r of e)t.push(new eA({key:r.getStrKey(),element:ro(r.getValue())}));return t}(e.getRHT()),createdAt:t5(e.getCreatedAt()),movedAt:t5(e.getMovedAt()),removedAt:t5(e.getRemovedAt())}),t}(e);if(e instanceof tv)return rs(e);if(e instanceof tf)return function(e){let t=new eu;return t.body.case="primitive",t.body.value=new em({type:t8(e.getType()),value:e.toBytes(),createdAt:t5(e.getCreatedAt()),movedAt:t5(e.getMovedAt()),removedAt:t5(e.getRemovedAt())}),t}(e);if(e instanceof tx)return function(e){let t=new eu;return t.body.case="text",t.body.value=new ep({nodes:function(e){let t=[];for(let n of e){var r;let e=new eI;e.id=new eC({createdAt:t5((r=n.getID()).getCreatedAt()),offset:r.getOffset()}),e.value=n.getValue().getContent(),e.removedAt=t5(n.getRemovedAt());let i=e.attributes;for(let e of n.getValue().getAttrs()){let t=new eS;t.value=e.getValue(),t.updatedAt=t5(e.getUpdatedAt()),i[e.getKey()]=t}t.push(e)}return t}(e.getRGATreeSplit()),createdAt:t5(e.getCreatedAt()),movedAt:t5(e.getMovedAt()),removedAt:t5(e.getRemovedAt())}),t}(e);if(e instanceof t2)return function(e){let t=new eu;return t.body.case="counter",t.body.value=new ev({type:t6(e.getType()),value:e.toBytes(),createdAt:t5(e.getCreatedAt()),movedAt:t5(e.getMovedAt()),removedAt:t5(e.getRemovedAt())}),t}(e);if(e instanceof tj)return ra(e);throw new e9(A.ErrUnimplemented,"unimplemented element")}function rh(e){for(let t of e.findDetails(e3.Qf))if(t.metadata.code)return t.metadata.code;return""}function rc(e){let t;return e.serverSeq&&(t=e2.Z.fromString(e.serverSeq,!0)),tF.of(e.clientSeq,e2.Z.fromString(e.lamport,!0),rP(e.actorId),t)}function rl(e){if(e)return tt.of(e2.Z.fromString(e.lamport,!0),e.delimiter,rP(e.actorId))}function rd(e){let t={};return Object.entries(e.data).forEach(e=>{let[r,n]=e;t[r]=JSON.parse(n)}),t}function ru(e){switch(e){case H.NULL:return I.Null;case H.BOOLEAN:return I.Boolean;case H.INTEGER:return I.Integer;case H.LONG:return I.Long;case H.DOUBLE:return I.Double;case H.STRING:return I.String;case H.BYTES:return I.Bytes;case H.DATE:return I.Date}throw new e9(A.ErrUnimplemented,"unimplemented value type: ".concat(e))}function rg(e){switch(e){case H.INTEGER_CNT:return k.IntegerCnt;case H.LONG_CNT:return k.LongCnt}throw new e9(A.ErrUnimplemented,"unimplemented value type: ".concat(e))}function rf(e){switch(e.type){case H.JSON_OBJECT:if(!e.value)return tl.create(rl(e.createdAt));return rk(e.value);case H.JSON_ARRAY:if(!e.value)return tv.create(rl(e.createdAt));return function(e){if(!e)throw new e9(A.ErrInvalidArgument,"bytes is empty");return rC(eu.fromBinary(e).body.value)}(e.value);case H.TEXT:return tx.create(t0.create(),rl(e.createdAt));case H.TREE:return function(e){if(!e)throw new e9(A.ErrInvalidArgument,"bytes is empty");return rw(eu.fromBinary(e).body.value)}(e.value);case H.NULL:case H.BOOLEAN:case H.INTEGER:case H.LONG:case H.DOUBLE:case H.STRING:case H.BYTES:case H.DATE:return tf.of(tf.valueFromBytes(ru(e.type),e.value),rl(e.createdAt));case H.INTEGER_CNT:case H.LONG_CNT:return t2.create(rg(e.type),t2.valueFromBytes(rg(e.type),e.value),rl(e.createdAt))}}function rm(e){return tQ.of(tZ.of(rl(e.createdAt),e.offset),e.relativeOffset)}function rp(e){return tZ.of(rl(e.createdAt),e.offset)}function rv(e){return tB.of(ry(e.parentId),ry(e.leftSiblingId))}function ry(e){return tz.of(rl(e.createdAt),e.offset)}function rA(e){if(0===e.length)return;let t=[];for(let r of e)t.push(function(e){let t=ry(e.id),r=tK.create(t,e.type),n=Object.entries(e.attributes);return r.isText?r.value=e.value:n.length&&(r.attrs=function(e){let t=tC.create();for(let[r,n]of Object.entries(e))t.setInternal(r,n.value,rl(n.updatedAt),n.isRemoved);return t}(e.attributes)),e.insPrevId&&(r.insPrevID=ry(e.insPrevId)),e.insNextId&&(r.insNextID=ry(e.insNextId)),r.removedAt=rl(e.removedAt),r}(r));let r=t[t.length-1],n=new Map;n.set(e[t.length-1].depth,t[t.length-1]);for(let r=t.length-2;r>=0;r--)n.get(e[r].depth-1).prepend(t[r]),n.set(e[r].depth,t[r]);return r.updateDescendantsSize(),tj.create(r,tn).getRoot()}function rT(e){if("set"===e.body.case){let t=e.body.value;return tA.create(t.key,rf(t.value),rl(t.parentCreatedAt),rl(t.executedAt))}if("add"===e.body.case){let t=e.body.value;return tT.create(rl(t.parentCreatedAt),rl(t.prevCreatedAt),rf(t.value),rl(t.executedAt))}if("move"===e.body.case){let t=e.body.value;return tS.create(rl(t.parentCreatedAt),rl(t.prevCreatedAt),rl(t.createdAt),rl(t.executedAt))}if("remove"===e.body.case){let t=e.body.value;return ty.create(rl(t.parentCreatedAt),rl(t.createdAt),rl(t.executedAt))}if("edit"===e.body.case){let t=e.body.value,r=new Map;Object.entries(t.createdAtMapByActor).forEach(e=>{let[t,n]=e;r.set(t,rl(n))});let n=new Map;return Object.entries(t.attributes).forEach(e=>{let[t,r]=e;n.set(t,r)}),tk.create(rl(t.parentCreatedAt),rm(t.from),rm(t.to),r,t.content,n,rl(t.executedAt))}if("style"===e.body.case){let t=e.body.value,r=new Map;Object.entries(t.createdAtMapByActor).forEach(e=>{let[t,n]=e;r.set(t,rl(n))});let n=new Map;return Object.entries(t.attributes).forEach(e=>{let[t,r]=e;n.set(t,r)}),tE.create(rl(t.parentCreatedAt),rm(t.from),rm(t.to),r,n,rl(t.executedAt))}if("select"===e.body.case)return;else if("increase"===e.body.case){let t=e.body.value;return t3.create(rl(t.parentCreatedAt),rf(t.value),rl(t.executedAt))}else if("treeEdit"===e.body.case){let t=e.body.value,r=new Map;return Object.entries(t.createdAtMapByActor).forEach(e=>{let[t,n]=e;r.set(t,rl(n))}),tq.create(rl(t.parentCreatedAt),rv(t.from),rv(t.to),function(e){if(!e.length)return;let t=[];return e.forEach(e=>{let r=rA(e.content);t.push(r)}),t}(t.contents),t.splitLevel,r,rl(t.executedAt))}else if("treeStyle"===e.body.case){let t=e.body.value,r=new Map,n=t.attributesToRemove,i=new Map;return((null==t?void 0:t.createdAtMapByActor)&&Object.entries(t.createdAtMapByActor).forEach(e=>{let[t,r]=e;i.set(t,rl(r))}),(null==n?void 0:n.length)>0)?t9.createTreeRemoveStyleOperation(rl(t.parentCreatedAt),rv(t.from),rv(t.to),i,n,rl(t.executedAt)):(Object.entries(t.attributes).forEach(e=>{let[t,n]=e;r.set(t,n)}),t9.create(rl(t.parentCreatedAt),rv(t.from),rv(t.to),i,r,rl(t.executedAt)))}else throw new e9(A.ErrUnimplemented,"unimplemented operation")}function rS(e){let t=[];for(let r of e)t.push(tW.create({id:rc(r.id),operations:function(e){let t=[];for(let r of e){let e=rT(r);e&&t.push(e)}return t}(r.operations),presenceChange:r.presenceChange?function(e){let t=e.type;if(t===eD.PUT){let t=rd(e.presence);return{type:T.Put,presence:t}}if(t===eD.CLEAR)return{type:T.Clear};throw new e9(A.ErrInvalidType,"unsupported type: ".concat(t))}(r.presenceChange):void 0,message:r.message}));return t}function rI(e){let t=new tc;for(let r of e.nodes){let e=rx(r.element);t.set(r.key,e,e.getPositionedAt())}let r=new tl(rl(e.createdAt),t);return r.setMovedAt(rl(e.movedAt)),r.setRemovedAt(rl(e.removedAt)),r}function rC(e){let t=new tp;for(let r of e.nodes)t.insert(rx(r.element));let r=new tv(rl(e.createdAt),t);return r.setMovedAt(rl(e.movedAt)),r.setRemovedAt(rl(e.removedAt)),r}function rw(e){let t=rA(e.nodes);return tj.create(t,rl(e.createdAt))}function rx(e){if("jsonObject"===e.body.case)return rI(e.body.value);if("jsonArray"===e.body.case)return rC(e.body.value);if("primitive"===e.body.case)return function(e){let t=tf.of(tf.valueFromBytes(ru(e.type),e.value),rl(e.createdAt));return t.setMovedAt(rl(e.movedAt)),t.setRemovedAt(rl(e.removedAt)),t}(e.body.value);if("text"===e.body.case)return function(e){let t=new t0,r=t.getHead();for(let n of e.nodes){let e=t.insertAfter(r,function(e){let t=tw.create(e.value);Object.entries(e.attributes).forEach(e=>{let[r,n]=e;t.setAttr(r,n.value,rl(n.updatedAt))});let r=t$.create(rp(e.id),t);return r.remove(rl(e.removedAt)),r}(n));n.insPrevId&&e.setInsPrev(t.findNode(rp(n.insPrevId))),r=e}let n=new tx(t,rl(e.createdAt));return n.setMovedAt(rl(e.movedAt)),n.setRemovedAt(rl(e.removedAt)),n}(e.body.value);if("counter"===e.body.case)return function(e){let t=t2.create(rg(e.type),t2.valueFromBytes(rg(e.type),e.value),rl(e.createdAt));return t.setMovedAt(rl(e.movedAt)),t.setRemovedAt(rl(e.removedAt)),t}(e.body.value);if("tree"===e.body.case)return rw(e.body.value);throw new e9(A.ErrUnimplemented,"unimplemented element")}function rk(e){if(!e)throw new e9(A.ErrInvalidArgument,"bytes is empty");return rI(eu.fromBinary(e).body.value)}function rE(e){return ro(e).toBinary()}function rP(e){return e?Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function rb(e){return new Uint8Array(e.match(/.{1,2}/g).map(e=>parseInt(e,16)))}let rD={fromPresence:rd,toChangePack:function(e){var t;return new X({documentKey:e.getDocumentKey(),checkpoint:new eN({serverSeq:(t=e.getCheckpoint()).getServerSeqAsString(),clientSeq:t.getClientSeq()}),isRemoved:e.getIsRemoved(),changes:function(e){let t=[];for(let r of e)t.push(function(e){let t=new Q({id:t4(e.getID()),message:e.getMessage()});return e.hasOperations()&&(t.operations=function(e){let t=[];for(let r of e)t.push(rn(r));return t}(e.getOperations())),e.hasPresenceChange()&&(t.presenceChange=function(e){if(e.type===T.Put)return new eb({type:eD.PUT,presence:function(e){let t=new eR,r=t.data;for(let[t,n]of Object.entries(e))r[t]=JSON.stringify(n);return t}(e.presence)});if(e.type===T.Clear)return new eb({type:eD.CLEAR});throw new e9(A.ErrUnimplemented,"unimplemented type")}(e.getPresenceChange())),t}(r));return t}(e.getChanges()),snapshot:e.getSnapshot(),minSyncedTicket:t5(e.getMinSyncedTicket())})},fromChangePack:function(e){var t;return tG.create(e.documentKey,(t=e.checkpoint,tH.of(e2.Z.fromString(t.serverSeq,!0),t.clientSeq)),e.isRemoved,rS(e.changes),e.snapshot,rl(e.minSyncedTicket))},fromChanges:rS,toTreeNodes:ri,fromTreeNodes:rA,objectToBytes:rE,bytesToObject:rk,bytesToSnapshot:function(e){if(!e)return{root:tl.create(tn),presences:new Map};let t=Z.fromBinary(e);return{root:rx(t.root),presences:function(e){let t=new Map;return Object.entries(e).forEach(e=>{let[r,n]=e;t.set(r,rd(n))}),t}(t.presences)}},bytesToHex:rP,hexToBytes:rb,toHexString:function(e){return rP(e)},toUint8Array:function(e){return rb(e)},toOperation:rn,toChangeID:t4,PbChangeID:$,bytesToChangeID:function(e){return rc($.fromBinary(e))},bytesToOperation:function(e){return rT(ee.fromBinary(e))}};(d=E||(E={}))[d.Trivial=0]="Trivial",d[d.Debug=1]="Debug",d[d.Info=2]="Info",d[d.Warn=3]="Warn",d[d.Error=4]="Error",d[d.Fatal=5]="Fatal";let rR=3;function rN(e){rR=e}let rO={trivial:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];rR>0||"undefined"==typeof console||console.log("YORKIE T:",...t)},debug:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];rR>1||"undefined"==typeof console||console.log("YORKIE D:",...t)},info:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];rR>2||"undefined"==typeof console||console.log("YORKIE I:",...t)},warn:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];rR>3||"undefined"==typeof console||(void 0!==console.warn?console.warn("YORKIE W:",...t):console.log("YORKIE W:",...t))},error:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];rR>4||"undefined"==typeof console||(void 0!==console.error?console.error("YORKIE E:",...t):console.log("YORKIE E:",...t))},fatal:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];"undefined"!=typeof console&&(void 0!==console.error?console.error("YORKIE F:",...t):console.log("YORKIE F:",...t))},isEnabled:e=>rR<=e};function rM(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}class r_{changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode!==N.RealtimeSyncOff&&(this.syncMode===N.RealtimePushOnly?this.doc.hasLocalChanges():this.syncMode!==N.Manual&&(this.doc.hasLocalChanges()||this.remoteChangeEventReceived))}async runWatchLoop(e){let t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay)})}catch(e){}};await t()}cancelWatchStream(){this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}constructor(e,t,r,n){this.reconnectStreamDelay=e,this.doc=t,this.docID=r,this.syncMode=n,this.remoteChangeEventReceived=!1}}let rL=()=>{};class rB{next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(!e)throw new e9(A.ErrInvalidArgument,"missing observer");if(this.finalized)throw new e9(A.ErrRefused,"observable is finalized due to previous error");void 0===(n="object"==typeof e?e:{next:e,error:t,complete:r}).next&&(n.next=rL),void 0===n.error&&(n.error=rL),void 0===n.complete&&(n.complete=rL);let i=rM(),s=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:n}),this.finalized)try{this.finalError?n.error(this.finalError):n.complete()}catch(e){rO.warn(e)}return s}unsubscribeOne(e){var t;this.observers=null===(t=this.observers)||void 0===t?void 0:t.filter(t=>t.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e].observer)}catch(e){rO.error(e)}}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.observers=void 0)}constructor(e){this.finalized=!1,this.observers=[];try{e(this)}catch(e){this.error(e)}}}class rz{static create(e,t,r,n){return new rz(e,t,r,n)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getChange(){return tW.create({id:this.id,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}hasChange(){return this.operations.length>0||void 0!==this.presenceChange}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(let r of Object.keys(e))(null==t?void 0:t.addToHistory)?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(0===this.reversePresenceKeys.size)return;let e={};for(let t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.id.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.id.createTimeTicket(this.delimiter)}constructor(e,t,r,n){this.id=e,this.delimiter=0,this.root=t,this.operations=[],this.previousPresence=e4(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=n}}class rK{static create(){return new rK(tl.create(tn))}findByCreatedAt(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];let r=[];for(;t.parent;){let e=t.element.getCreatedAt(),n=t.parent.subPathOf(e);if(void 0===n)throw new e9(A.ErrInvalidArgument,"cant find the given element: ".concat(e.toIDString()));r.unshift(n),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),e instanceof to&&e.getDescendants((e,t)=>(this.registerElement(e,t),!1))}deregisterElement(e){let t=0,r=e=>{let r=e.getCreatedAt().toIDString();this.elementPairMapByCreatedAt.delete(r),this.gcElementSetByCreatedAt.delete(r),t++};return r(e),e instanceof to&&e.getDescendants(e=>(r(e),!1)),t}registerRemovedElement(e){this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){let e=new Set;for(let t of this.gcElementSetByCreatedAt){e.add(t);let r=this.elementPairMapByCreatedAt.get(t);r.element instanceof to&&r.element.getDescendants(t=>(e.add(t.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}deepcopy(){return new rK(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(let r of this.gcElementSetByCreatedAt){let n=this.elementPairMapByCreatedAt.get(r);n.element.getRemovedAt()&&e.compare(n.element.getRemovedAt())>=0&&(n.parent.purge(n.element),t+=this.deregisterElement(n.element))}for(let[,r]of this.gcPairMap){let n=r.child.getRemovedAt();void 0!==n&&e.compare(n)>=0&&(r.parent.purge(r.child),this.gcPairMap.delete(r.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}constructor(e){this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.registerElement(e,void 0),e.getDescendants(e=>{if(e.getRemovedAt()&&this.registerRemovedElement(e),e instanceof tx||e instanceof tj)for(let t of e.getGCPairs())this.registerGCPair(t);return!1})}}function rU(e,t){let r=new rJ(e);return new Proxy(t,r.getHandlers())}class rJ{static setInternal(e,t,r,n){if(r.includes("."))throw new e9(A.ErrInvalidObjectKey,"key must not contain the '.'.");let i=e.issueTimeTicket(),s=rX(e,n,i),a=t.set(r,s,i);e.registerElement(s,t),a&&e.registerRemovedElement(a),e.push(tA.create(r,s.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){let r={};for(let[n,i]of Object.entries(t)){if(n.includes("."))throw new e9(A.ErrInvalidObjectKey,"key must not contain the '.'.");let t=e.issueTimeTicket(),s=rX(e,i,t);r[n]=s}return r}static deleteInternal(e,t,r){let n=e.issueTimeTicket(),i=t.deleteByKey(r,n);i&&(e.push(ty.create(t.getCreatedAt(),i.getCreatedAt(),n)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}constructor(e){this.context=e,this.handlers={set:(t,r,n)=>(rO.isEnabled(E.Trivial)&&rO.trivial("obj[".concat(r,"]=").concat(JSON.stringify(n))),rJ.setInternal(e,t,r,n),!0),get:(t,r)=>(rO.isEnabled(E.Trivial)&&rO.trivial("obj[".concat(r,"]")),"getID"===r)?()=>t.getCreatedAt():"toJSON"===r||"toString"===r?()=>t.toJSON():"toJS"===r?()=>t.toJS():"toJSForTest"===r?()=>t.toJSForTest():rZ(e,t.get(r)),ownKeys:e=>e.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,r)=>(rO.isEnabled(E.Trivial)&&rO.trivial("obj[".concat(r,"]")),rJ.deleteInternal(e,t,r),!0)}}}class rj{static*iteratorInternal(e,t){for(let r of t)yield rY(e,r)}static buildArrayElements(e,t){let r=[];for(let n of t){let t=e.issueTimeTicket(),i=rX(e,n,t);r.push(i)}return r}static pushInternal(e,t,r){return rj.insertAfterInternal(e,t,t.getLastCreatedAt(),r),t.length}static moveBeforeInternal(e,t,r,n){let i=e.issueTimeTicket(),s=t.getPrevCreatedAt(r);t.moveAfter(s,n,i),e.push(tS.create(t.getCreatedAt(),s,n,i))}static moveAfterInternal(e,t,r,n){let i=e.issueTimeTicket();t.moveAfter(r,n,i),e.push(tS.create(t.getCreatedAt(),r,n,i))}static moveFrontInternal(e,t,r){let n=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),r,n),e.push(tS.create(t.getCreatedAt(),i.getCreatedAt(),r,n))}static moveLastInternal(e,t,r){let n=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,r,n),e.push(tS.create(t.getCreatedAt(),i,r,n))}static insertAfterInternal(e,t,r,n){let i=e.issueTimeTicket(),s=rX(e,n,i);return t.insertAfter(r,s),e.registerElement(s,t),e.push(tT.create(t.getCreatedAt(),r,s.deepcopy(),i)),s}static insertBeforeInternal(e,t,r,n){return rj.insertAfterInternal(e,t,t.getPrevCreatedAt(r),n)}static deleteInternalByIndex(e,t,r){let n=e.issueTimeTicket(),i=t.deleteByIndex(r,n);if(i)return e.push(ty.create(t.getCreatedAt(),i.getCreatedAt(),n)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,r){let n=e.issueTimeTicket(),i=t.delete(r,n);return e.push(ty.create(t.getCreatedAt(),i.getCreatedAt(),n)),e.registerRemovedElement(i),i}static splice(e,t,r,n){for(var i=arguments.length,s=Array(i>4?i-4:0),a=4;a<i;a++)s[a-4]=arguments[a];let o=t.length,h=r>=0?Math.min(r,o):Math.max(o+r,0),c=void 0===n?o:n<0?h:Math.min(h+n,o),l=[];for(let r=h;r<c;r++){let r=rj.deleteInternalByIndex(e,t,h);if(r){let t=r.deepcopy();t.setRemovedAt(),l.push(rZ(e,t))}}if(s){let r=0===h?t.getHead().getID():t.get(h-1).getID();for(let n of s)r=rj.insertAfterInternal(e,t,r,n).getID()}return l}static includes(e,t,r,n){let i=t.length,s=void 0===n?0:n<0?Math.max(n+i,0):n;if(s>=i)return!1;if(tf.isSupport(r))return Array.from(t).map(t=>rZ(e,t)).includes(r,s);for(let e=s;e<i;e++){var a;if((null===(a=t.get(e))||void 0===a?void 0:a.getID())===r.getID())return!0}return!1}static indexOf(e,t,r,n){let i=t.length,s=void 0===n?0:n<0?Math.max(n+i,0):n;if(s>=i)return -1;if(tf.isSupport(r))return Array.from(t).map(t=>rZ(e,t)).indexOf(r,s);for(let e=s;e<i;e++){var a;if((null===(a=t.get(e))||void 0===a?void 0:a.getID())===r.getID())return e}return -1}static lastIndexOf(e,t,r,n){let i=t.length,s=void 0===n||n>=i?i-1:n<0?n+i:n;if(s<0)return -1;if(tf.isSupport(r))return Array.from(t).map(t=>rZ(e,t)).lastIndexOf(r,s);for(let e=s;e>0;e--){var a;if((null===(a=t.get(e))||void 0===a?void 0:a.getID())===r.getID())return e}return -1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}constructor(e,t){this.context=e,this.array=t,this.handlers={get:(t,r,n)=>"getID"===r?()=>t.getCreatedAt():"getElementByID"===r?r=>{let n=t.getByID(r);if(!(!n||n.isRemoved()))return rY(e,n)}:"getElementByIndex"===r?r=>rY(e,t.get(r)):"getLast"===r?()=>rY(e,t.getLast()):"deleteByID"===r?r=>{let n=rj.deleteInternalByID(e,t,r);return rY(e,n)}:"insertAfter"===r?(r,n)=>{let i=rj.insertAfterInternal(e,t,r,n);return rY(e,i)}:"insertBefore"===r?(r,n)=>{let i=rj.insertBeforeInternal(e,t,r,n);return rY(e,i)}:"moveBefore"===r?(r,n)=>{rj.moveBeforeInternal(e,t,r,n)}:"moveAfter"===r?(r,n)=>{rj.moveAfterInternal(e,t,r,n)}:"moveFront"===r?r=>{rj.moveFrontInternal(e,t,r)}:"moveLast"===r?r=>{rj.moveLastInternal(e,t,r)}:("string"==typeof r||r instanceof String)&&!isNaN(r)?rZ(e,t.get(Number(r))):"push"===r?r=>rj.pushInternal(e,t,r):"splice"===r?function(r,n){for(var i=arguments.length,s=Array(i>2?i-2:0),a=2;a<i;a++)s[a-2]=arguments[a];return rj.splice(e,t,r,n,...s)}:"length"===r?t.length:"symbol"==typeof r&&r===Symbol.iterator?rj.iteratorInternal.bind(this,e,t):"includes"===r?(r,n)=>rj.includes(e,t,r,n):"indexOf"===r?(r,n)=>rj.indexOf(e,t,r,n):"lastIndexOf"===r?(r,n)=>rj.lastIndexOf(e,t,r,n):"toJSForTest"===r?()=>t.toJSForTest():"toTestString"===r?()=>rj.toTestString(t):"string"==typeof r&&["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(r)?function(){for(var n=arguments.length,i=Array(n),s=0;s<n;s++)i[s]=arguments[s];let a=Array.from(t).map(t=>rZ(e,t));return Array.prototype[r].apply(a,i)}:Reflect.get(t,r,n),deleteProperty:(t,r)=>(rO.isEnabled(E.Trivial)&&rO.trivial("array[".concat(r,"]")),rj.deleteInternalByIndex(e,t,Number.parseInt(r)),!0)}}}class rq{initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,r,n){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new e9(A.ErrInvalidArgument,"from should be less than or equal to to");let i=this.text.indexRangeToPosRange(e,t);rO.isEnabled(E.Debug)&&rO.debug("EDIT: f:".concat(e,"->").concat(i[0].toTestString(),", t:").concat(t,"->").concat(i[1].toTestString()," c:").concat(r));let s=n?e8(n):void 0,a=this.context.issueTimeTicket(),[o,,h,c]=this.text.edit(i,r,a,s);for(let e of h)this.context.registerGCPair(e);return this.context.push(new tk(this.text.getCreatedAt(),i[0],i[1],o,r,s?new Map(Object.entries(s)):new Map,a)),this.text.findIndexesFromRange(c)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,r){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new e9(A.ErrInvalidArgument,"from should be less than or equal to to");let n=this.text.indexRangeToPosRange(e,t);rO.isEnabled(E.Debug)&&rO.debug("STYL: f:".concat(e,"->").concat(n[0].toTestString(),", t:").concat(t,"->").concat(n[1].toTestString()," a:").concat(JSON.stringify(r)));let i=e8(r),s=this.context.issueTimeTicket(),[a,o]=this.text.setStyle(n,i,s);for(let e of o)this.context.registerGCPair(e);return this.context.push(new tE(this.text.getCreatedAt(),n[0],n[1],a,new Map(Object.entries(i)),s)),!0}indexRangeToPosRange(e){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");let t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");let t=this.text.findIndexesFromRange([tQ.fromStruct(e[0]),tQ.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text)throw new e9(A.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(e,t)}constructor(e,t){this.context=e,this.text=t}}class rF{initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter)throw new e9(A.ErrNotInitialized,"Counter is not initialized yet");let t=this.context.issueTimeTicket(),r=tf.of(e,t);if(!r.isNumericType())throw TypeError("Unsupported type of value: ".concat(typeof r.getValue()));return this.counter.increase(r),this.context.push(t3.create(this.counter.getCreatedAt(),r,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new e9(A.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}constructor(e,t){this.valueType=e,this.value=t}}function rV(e,t,r){let{type:n}=e,i=r.issueTimeTicket();if(n===tP){rW(e);let{value:r}=e,s=tK.create(tz.of(i,0),n,r);t.append(s)}else{let s;let{children:a=[]}=e,{attributes:o}=e;if("object"==typeof o&&!e5(o))for(let[e,t]of(o=e8(o),s=new tC,Object.entries(o)))s.set(e,t,i);let h=tK.create(tz.of(i,0),n,void 0,s);for(let e of(t.append(h),a))rV(e,h,r)}}function rW(e){if(!e.value.length)throw new e9(A.ErrInvalidArgument,"text node cannot have empty value");return!0}function rG(e){if(!e.length)return!0;if(e[0].type===tP)for(let t of e){let{type:e}=t;if(e!==tP)throw new e9(A.ErrInvalidArgument,"element node and text node cannot be passed together");rW(t)}else for(let t of e){let{type:e}=t;if(e===tP)throw new e9(A.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class rH{initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return tK.create(tz.of(e.issueTimeTicket(),0),"root");let t=tK.create(tz.of(e.issueTimeTicket(),0),this.initialRoot.type);for(let r of this.initialRoot.children)rV(r,t,e);return t}getSize(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}styleByPath(e,t){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new e9(A.ErrInvalidArgument,"path should not be empty");let[r,n]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),s=t?e8(t):void 0,[a]=this.tree.style([r,n],s,i);this.context.push(t9.create(this.tree.getCreatedAt(),r,n,a,s?new Map(Object.entries(s)):new Map,i))}style(e,t,r){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e9(A.ErrInvalidArgument,"from should be less than or equal to to");let n=this.tree.findPos(e),i=this.tree.findPos(t),s=this.context.issueTimeTicket(),a=r?e8(r):void 0,[o,h]=this.tree.style([n,i],a,s);for(let e of h)this.context.registerGCPair(e);this.context.push(t9.create(this.tree.getCreatedAt(),n,i,o,a?new Map(Object.entries(a)):new Map,s))}removeStyle(e,t,r){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e9(A.ErrInvalidArgument,"from should be less than or equal to to");let n=this.tree.findPos(e),i=this.tree.findPos(t),s=this.context.issueTimeTicket(),[a,o]=this.tree.removeStyle([n,i],r,s);for(let e of o)this.context.registerGCPair(e);this.context.push(t9.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),n,i,a,r,s))}editInternal(e,t,r){var n;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(0!==r.length&&r[0]&&(rG(r),r[0].type!==tP))for(let e of r){let{children:t=[]}=e;rG(t)}let s=this.context.getLastTimeTicket(),a=[];if((null===(n=r[0])||void 0===n?void 0:n.type)===tP){let e="";for(let t of r){let{value:r}=t;e+=r}a.push(tK.create(tz.of(this.context.issueTimeTicket(),0),tP,e))}else a=r.map(e=>e&&function(e,t){let r;let{type:n}=t,i=e.issueTimeTicket();if(t.type===tP){let{value:e}=t;r=tK.create(tz.of(i,0),n,e)}else if(t){let s;let{children:a=[]}=t,{attributes:o}=t;if("object"==typeof o&&!e5(o))for(let[e,t]of(o=e8(o),s=new tC,Object.entries(o)))s.set(e,t,i);for(let t of(r=tK.create(tz.of(e.issueTimeTicket(),0),n,void 0,s),a))rV(t,r,e)}return r}(this.context,e)).filter(e=>e);let[,o,h]=this.tree.edit([e,t],a.length?a.map(e=>null==e?void 0:e.deepcopy()):void 0,i,s,()=>this.context.issueTimeTicket());for(let e of o)this.context.registerGCPair(e);return this.context.push(tq.create(this.tree.getCreatedAt(),e,t,a.length?a:void 0,i,h,s)),!0}editByPath(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new e9(A.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new e9(A.ErrInvalidArgument,"path should not be empty");let i=this.tree.pathToPos(e),s=this.tree.pathToPos(t);return this.editInternal(i,s,r?[r]:[],n)}editBulkByPath(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new e9(A.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new e9(A.ErrInvalidArgument,"path should not be empty");let i=this.tree.pathToPos(e),s=this.tree.pathToPos(t);return this.editInternal(i,s,r,n)}edit(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e9(A.ErrInvalidArgument,"from should be less than or equal to to");let i=this.tree.findPos(e),s=this.tree.findPos(t);return this.editInternal(i,s,r?[r]:[],n)}editBulk(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new e9(A.ErrInvalidArgument,"from should be less than or equal to to");let i=this.tree.findPos(e),s=this.tree.findPos(t);return this.editInternal(i,s,r,n)}toXML(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");let t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],r=this.tree.indexRangeToPosRange(t);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");let t=[tB.fromStruct(e[0]),tB.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree)throw new e9(A.ErrNotInitialized,"Tree is not initialized yet");let t=[tB.fromStruct(e[0]),tB.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}constructor(e){this.initialRoot=e}}function rY(e,t){if(t){if(t instanceof tf)return t;if(t instanceof tl)return rU(e,t);if(t instanceof tv)return function(e,t){let r=new rj(e,t);return new Proxy(t,r.getHandlers())}(e,t);if(t instanceof tx)return new rq(e,t);else if(t instanceof t2){let r=new rF(k.IntegerCnt,0);return r.initialize(e,t),r}else if(t instanceof tj){let r=new rH;return r.initialize(e,t),r}throw TypeError("Unsupported type of element: ".concat(typeof t))}}function rZ(e,t){let r=rY(e,t);return r instanceof tf?r.getValue():r}function rX(e,t,r){let n;if(tf.isSupport(t))n=tf.of(t,r);else if(Array.isArray(t))n=tv.create(r,rj.buildArrayElements(e,t));else if("object"==typeof t)t instanceof rq?(n=tx.create(t0.create(),r),t.initialize(e,n)):t instanceof rF?(n=t2.create(t.getValueType(),t.getValue(),r),t.initialize(e,n)):t instanceof rH?(n=tj.create(t.buildRoot(e),r),t.initialize(e,n)):n=tl.create(r,rJ.buildObjectMembers(e,t));else throw TypeError("Unsupported type of value: ".concat(typeof t));return n}class rQ{hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=50&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=50&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}constructor(){this.undoStack=[],this.redoStack=[]}}let r$="disconnected",r0=new Map,r1=new Map;function r2(e,t){((null==t?void 0:t.force)||"disconnected"!==r$)&&window.postMessage({source:"yorkie-devtools-sdk",...e},"*")}window.transactionEventsByDocKey=r1,(u=P||(P={})).Detached="detached",u.Attached="attached",u.Removed="removed",(g=b||(b={})).StatusChanged="status-changed",g.ConnectionChanged="connection-changed",g.SyncStatusChanged="sync-status-changed",g.Snapshot="snapshot",g.LocalChange="local-change",g.RemoteChange="remote-change",g.Initialized="initialized",g.Watched="watched",g.Unwatched="unwatched",g.PresenceChanged="presence-changed",(f=D||(D={})).Connected="connected",f.Disconnected="disconnected",(m=R||(R={})).Synced="synced",m.SyncFailed="sync-failed";class r3{update(e,t){if("removed"===this.getStatus())throw new e9(A.ErrDocumentRemoved,"".concat(this.key," is removed"));this.ensureClone();let r=this.changeID.getActorID(),n=rz.create(this.changeID.next(),this.clone.root,this.clone.presences.get(r)||{},t);try{var i;let t=(i=this.clone.root.getObject(),rU(n,i));this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,e(t,new e7(n,this.clone.presences.get(r)))}catch(e){throw this.clone=void 0,e}finally{this.isUpdating=!1}if(n.hasChange()){rO.isEnabled(E.Trivial)&&rO.trivial("trying to update a local change: ".concat(this.toJSON()));let e=n.getChange(),{opInfos:t,reverseOps:i}=e.execute(this.root,this.presences,S.Local),s=n.getReversePresence();s&&i.push({type:"presence",value:s}),this.localChanges.push(e),i.length>0&&this.internalHistory.pushUndo(i),t.length>0&&this.internalHistory.clearRedo(),this.changeID=e.getID();let a=[];t.length>0&&a.push({type:"local-change",source:S.Local,value:{message:e.getMessage()||"",operations:t,actor:r,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq()},rawChange:this.isEnableDevtools()?e.toStruct():void 0}),e.hasPresenceChange()&&a.push({type:"presence-changed",source:S.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(a),rO.isEnabled(E.Trivial)&&rO.trivial("after update a local change: ".concat(this.toJSON()))}}subscribe(e,t,r,n){if("string"==typeof e){if("function"!=typeof t)throw new e9(A.ErrInvalidArgument,"Second argument must be a callback function");return"presence"===e?this.eventStream.subscribe(e=>{for(let r of e)("initialized"===r.type||"watched"===r.type||"unwatched"===r.type||"presence-changed"===r.type)&&t(r)},r,n):"my-presence"===e?this.eventStream.subscribe(e=>{for(let r of e)("initialized"===r.type||"presence-changed"===r.type)&&("presence-changed"!==r.type||r.value.clientID===this.changeID.getActorID())&&t(r)},r,n):"others"===e?this.eventStream.subscribe(e=>{for(let r of e)("watched"===r.type||"unwatched"===r.type||"presence-changed"===r.type)&&r.value.clientID!==this.changeID.getActorID()&&t(r)},r,n):"connection"===e?this.eventStream.subscribe(e=>{for(let r of e)"connection-changed"===r.type&&t(r)},r,n):"status"===e?this.eventStream.subscribe(e=>{for(let r of e)"status-changed"===r.type&&t(r)},r,n):"sync"===e?this.eventStream.subscribe(e=>{for(let r of e)"sync-status-changed"===r.type&&t(r)},r,n):"all"===e?this.eventStream.subscribe(t,r,n):this.eventStream.subscribe(r=>{for(let n of r){if("local-change"!==n.type&&"remote-change"!==n.type)continue;let r=[];for(let t of n.value.operations)this.isSameElementOrChildOf(t.path,e)&&r.push(t);r.length&&t({...n,value:{...n.value,operations:r}})}},r,n)}if("function"==typeof e)return this.eventStream.subscribe(t=>{for(let r of t)("snapshot"===r.type||"local-change"===r.type||"remote-change"===r.type)&&e(r)},t,r);throw new e9(A.ErrInvalidArgument,'"'.concat(e,'" is not a valid'))}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}isSameElementOrChildOf(e,t){if(t===e)return!0;let r=e.split(".");return t.split(".").every((e,t)=>e===r[t])}applyChangePack(e){for(e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getSnapshot()):e.hasChanges()&&this.applyChanges(e.getChanges(),S.Remote);this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e.getCheckpoint().getClientSeq());)this.localChanges.shift();e.hasSnapshot()&&this.applyChanges(this.localChanges,S.Remote),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),this.garbageCollect(e.getMinSyncedTicket()),e.getIsRemoved()&&this.applyStatus("removed"),rO.isEnabled(E.Trivial)&&rO.trivial("".concat(this.root.toJSON()))}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:e4(this.presences)})}createChangePack(){let e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return tG.create(this.key,t,!1,e)}setActor(e){for(let t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){return this.ensureClone(),rU(rz.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{}),this.clone.root.getObject())}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t){let{root:r,presences:n}=rD.bytesToSnapshot(t);this.root=new rK(r),this.presences=n,this.changeID=this.changeID.syncLamport(e),this.clone=void 0,this.publish([{type:"snapshot",source:S.Remote,value:{snapshot:this.isEnableDevtools()?rD.bytesToHex(t):void 0,serverSeq:e.toString()}}])}applyChanges(e,t){for(let r of(rO.isEnabled(E.Debug)&&rO.debug("trying to apply ".concat(e.length," remote changes.")+"elements:".concat(this.root.getElementMapSize(),", ")+"removeds:".concat(this.root.getGarbageElementSetSize())),rO.isEnabled(E.Trivial)&&rO.trivial(e.map(e=>"".concat(e.getID().toTestString(),"	").concat(e.toTestString())).join("\n")),e))this.applyChange(r,t);rO.isEnabled(E.Debug)&&rO.debug("after appling ".concat(e.length," remote changes.")+"elements:".concat(this.root.getElementMapSize(),", ")+" removeds:".concat(this.root.getGarbageElementSetSize()))}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);let r=[],n=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(n)){let i=e.getPresenceChange();switch(i.type){case T.Put:r.push(this.presences.has(n)?{type:"presence-changed",source:t,value:{clientID:n,presence:i.presence}}:{type:"watched",source:S.Remote,value:{clientID:n,presence:i.presence}});break;case T.Clear:r.push({type:"unwatched",source:S.Remote,value:{clientID:n,presence:this.getPresence(n)}}),this.removeOnlineClient(n)}}let{opInfos:i}=e.execute(this.root,this.presences,t);if(this.changeID=this.changeID.syncLamport(e.getID().getLamport()),i.length>0){let s=this.isEnableDevtools()?e.toStruct():void 0;r.push(t===S.Remote?{type:"remote-change",source:t,value:{actor:n,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:s}:{type:"local-change",source:t,value:{actor:n,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:s})}r.length>0&&this.publish(r)}applyWatchStream(e){if("initialization"===e.body.case){let t=e.body.value.clientIds,r=new Set;for(let e of t)e!==this.changeID.getActorID()&&r.add(e);this.setOnlineClients(r),this.publish([{type:"initialized",source:S.Local,value:this.getPresences()}]);return}if("event"===e.body.case){let{type:t,publisher:r}=e.body.value,n=[];if(t===Y.DOCUMENT_WATCHED)this.addOnlineClient(r),this.hasPresence(r)&&n.push({type:"watched",source:S.Remote,value:{clientID:r,presence:this.getPresence(r)}});else if(t===Y.DOCUMENT_UNWATCHED){let e=this.getPresence(r);this.removeOnlineClient(r),e&&n.push({type:"unwatched",source:S.Remote,value:{clientID:r,presence:e}})}n.length>0&&this.publish(n)}}applyStatus(e){this.status=e,"detached"===e&&this.setActor(te),this.publish([{source:"removed"===e?S.Remote:S.Local,type:"status-changed",value:"attached"===e?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEvent(e){if("status-changed"===e.type){this.applyStatus(e.value.status),"attached"===e.value.status&&this.setActor(e.value.actorID);return}if("snapshot"===e.type){let{snapshot:t,serverSeq:r}=e.value;if(!t)return;this.applySnapshot(e2.Z.fromString(r),rD.hexToBytes(t));return}if("local-change"===e.type||"remote-change"===e.type){if(!e.rawChange)return;let t=tW.fromStruct(e.rawChange);this.applyChange(t,e.source)}if("initialized"===e.type){let t=new Set;for(let{clientID:r,presence:n}of e.value)t.add(r),this.presences.set(r,n);this.setOnlineClients(t);return}if("watched"===e.type){let{clientID:t,presence:r}=e.value;this.addOnlineClient(t),this.presences.set(t,r);return}if("unwatched"===e.type){let{clientID:t}=e.value;this.removeOnlineClient(t),this.presences.delete(t)}if("presence-changed"===e.type){let{clientID:t,presence:r}=e.value;this.presences.set(t,r)}}applyTransactionEvent(e){for(let t of e)this.applyDocEvent(t)}getValueByPath(e){if(!e.startsWith("$"))throw new e9(A.ErrInvalidArgument,'path must start with "$"');let t=e.split(".");t.shift();let r=this.getRoot();for(let e of t)if(void 0===(r=r[e]))return;return r}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if("attached"!==this.status)return{};let e=this.presences.get(this.changeID.getActorID());return e?e4(e):{}}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;let t=this.presences.get(e);return t?e4(t):void 0}getPresenceForTest(e){let t=this.presences.get(e);return t?e4(t):void 0}getPresences(){let e=[];for(let t of(e.push({clientID:this.changeID.getActorID(),presence:e4(this.getMyPresence())}),this.onlineClients))this.presences.has(t)&&e.push({clientID:t,presence:e4(this.presences.get(t))});return e}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){let e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((e,t)=>e.clientID>t.clientID?1:-1)}canUndo(){return this.internalHistory.hasUndo()&&!this.isUpdating}canRedo(){return this.internalHistory.hasRedo()&&!this.isUpdating}undo(){if(this.isUpdating)throw new e9(A.ErrRefused,"Undo is not allowed during an update");let e=this.internalHistory.popUndo();if(void 0===e)throw new e9(A.ErrRefused,"There is no operation to be undone");this.ensureClone();let t=rz.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(let r of e){if(!(r instanceof td)){new e7(t,e4(this.clone.presences.get(this.changeID.getActorID()))).set(r.value,{addToHistory:!0});continue}let e=t.issueTimeTicket();r.setExecutedAt(e),t.push(r)}let r=t.getChange();r.execute(this.clone.root,this.clone.presences,S.UndoRedo);let{opInfos:n,reverseOps:i}=r.execute(this.root,this.presences,S.UndoRedo),s=t.getReversePresence();if(s&&i.push({type:"presence",value:s}),i.length>0&&this.internalHistory.pushRedo(i),!r.hasPresenceChange()&&0===n.length)return;this.localChanges.push(r),this.changeID=r.getID();let a=this.changeID.getActorID(),o=[];n.length>0&&o.push({type:"local-change",source:S.UndoRedo,value:{message:r.getMessage()||"",operations:n,actor:a,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&o.push({type:"presence-changed",source:S.UndoRedo,value:{clientID:a,presence:this.getPresence(a)}}),this.publish(o)}redo(){if(this.isUpdating)throw new e9(A.ErrRefused,"Redo is not allowed during an update");let e=this.internalHistory.popRedo();if(void 0===e)throw new e9(A.ErrRefused,"There is no operation to be redone");this.ensureClone();let t=rz.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(let r of e){if(!(r instanceof td)){new e7(t,e4(this.clone.presences.get(this.changeID.getActorID()))).set(r.value,{addToHistory:!0});continue}let e=t.issueTimeTicket();r.setExecutedAt(e),t.push(r)}let r=t.getChange();r.execute(this.clone.root,this.clone.presences,S.UndoRedo);let{opInfos:n,reverseOps:i}=r.execute(this.root,this.presences,S.UndoRedo),s=t.getReversePresence();if(s&&i.push({type:"presence",value:s}),i.length>0&&this.internalHistory.pushUndo(i),!r.hasPresenceChange()&&0===n.length)return;this.localChanges.push(r),this.changeID=r.getID();let a=this.changeID.getActorID(),o=[];n.length>0&&o.push({type:"local-change",source:S.UndoRedo,value:{message:r.getMessage()||"",operations:n,actor:a,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&o.push({type:"presence-changed",source:S.UndoRedo,value:{clientID:a,presence:this.getPresence(a)}}),this.publish(o)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}constructor(e,t){this.opts=t||{},this.key=e,this.status="detached",this.root=rK.create(),this.changeID=tV,this.checkpoint=tY,this.localChanges=[],this.eventStream=function(e){let t=new rB(e);return{subscribe:t.subscribe.bind(t),getProxy:()=>t}}(e=>{this.eventStreamObserver=e}),this.onlineClients=new Set,this.presences=new Map,this.isUpdating=!1,this.internalHistory=new rQ,this.history={canUndo:this.canUndo.bind(this),canRedo:this.canRedo.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},function(e){if(!e.isEnableDevtools()||r0.has(e.getKey()))return;r1.set(e.getKey(),[]);let t=e.subscribe("all",t=>{t.some(e=>e.type!==b.StatusChanged&&e.type!==b.Snapshot&&e.type!==b.LocalChange&&e.type!==b.RemoteChange&&e.type!==b.Initialized&&e.type!==b.Watched&&e.type!==b.Unwatched&&e.type!==b.PresenceChanged)||(r1.get(e.getKey()).push(t),"synced"===r$&&r2({msg:"doc::sync::partial",docKey:e.getKey(),event:t}))});r0.set(e.getKey(),[t]),r2({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var r;if((null===(r=t.data)||void 0===r?void 0:r.source)==="yorkie-devtools-panel")switch(t.data.msg){case"devtools::connect":if("disconnected"!==r$)break;r$="connected",r2({msg:"doc::available",docKey:e.getKey()}),rO.info("[YD] Devtools connected. Doc: ".concat(e.getKey()));break;case"devtools::disconnect":r$="disconnected",rO.info("[YD] Devtools disconnected. Doc: ".concat(e.getKey()));break;case"devtools::subscribe":r$="synced",r2({msg:"doc::sync::full",docKey:e.getKey(),events:r1.get(e.getKey())}),rO.info("[YD] Devtools subscribed. Doc: ".concat(e.getKey()))}})}(this)}}var r9=JSON.parse('{"u2":"yorkie-js-sdk","i8":"0.4.31"}');(p=N||(N={})).Manual="manual",p.Realtime="realtime",p.RealtimePushOnly="realtime-pushonly",p.RealtimeSyncOff="realtime-syncoff",(v=O||(O={})).Deactivated="deactivated",v.Activated="activated",(y=M||(M={})).SyncLoop="SyncLoop",y.WatchLoop="WatchLoop";let r4={syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3};class r5{activate(){return this.isActive()?Promise.resolve():this.enqueueTask(async()=>this.rpcClient.activateClient({clientKey:this.key},{headers:{"x-shard-key":this.apiKey}}).then(e=>{this.id=e.clientId,this.status="activated",this.runSyncLoop(),rO.info('[AC] c:"'.concat(this.getKey(),'" activated, id:"').concat(this.id,'"'))}).catch(e=>{throw rO.error('[AC] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e}))}deactivate(){return"deactivated"===this.status?Promise.resolve():this.enqueueTask(async()=>this.rpcClient.deactivateClient({clientId:this.id},{headers:{"x-shard-key":this.apiKey}}).then(()=>{this.deactivateInternal(),rO.info('[DC] c"'.concat(this.getKey(),'" deactivated'))}).catch(e=>{throw rO.error('[DC] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e}))}attach(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isActive())throw new e9(A.ErrClientNotActivated,"".concat(this.key," is not active"));if(e.getStatus()!==P.Detached)throw new e9(A.ErrDocumentNotDetached,"".concat(e.getKey()," is not detached"));e.setActor(this.id),e.update((e,t)=>t.set(r.initialPresence||{}));let n=null!==(t=r.syncMode)&&void 0!==t?t:"realtime";return this.enqueueTask(async()=>this.rpcClient.attachDocument({clientId:this.id,changePack:rD.toChangePack(e.createChangePack())},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}}).then(async t=>{let r=rD.fromChangePack(t.changePack);return e.applyChangePack(r),e.getStatus()===P.Removed||(e.applyStatus(P.Attached),this.attachmentMap.set(e.getKey(),new r_(this.reconnectStreamDelay,e,t.documentId,n)),"manual"!==n&&await this.runWatchLoop(e.getKey()),rO.info('[AD] c:"'.concat(this.getKey(),'" attaches d:"').concat(e.getKey(),'"'))),e}).catch(e=>{throw rO.error('[AD] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e}))}detach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isActive())throw new e9(A.ErrClientNotActivated,"".concat(this.key," is not active"));let r=this.attachmentMap.get(e.getKey());if(!r)throw new e9(A.ErrDocumentNotAttached,"".concat(e.getKey()," is not attached"));return e.update((e,t)=>t.clear()),this.enqueueTask(async()=>{var n;return this.rpcClient.detachDocument({clientId:this.id,documentId:r.docID,changePack:rD.toChangePack(e.createChangePack()),removeIfNotAttached:null!==(n=t.removeIfNotAttached)&&void 0!==n&&n},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}}).then(t=>{let r=rD.fromChangePack(t.changePack);return e.applyChangePack(r),e.getStatus()!==P.Removed&&e.applyStatus(P.Detached),this.detachInternal(e.getKey()),rO.info('[DD] c:"'.concat(this.getKey(),'" detaches d:"').concat(e.getKey(),'"')),e}).catch(e=>{throw rO.error('[DD] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e})})}async changeSyncMode(e,t){if(!this.isActive())throw new e9(A.ErrClientNotActivated,"".concat(this.key," is not active"));let r=this.attachmentMap.get(e.getKey());if(!r)throw new e9(A.ErrDocumentNotAttached,"".concat(e.getKey()," is not attached"));let n=r.syncMode;return n===t||((r.changeSyncMode(t),"manual"===t)?r.cancelWatchStream():("realtime"===t&&(r.remoteChangeEventReceived=!0),"manual"===n&&await this.runWatchLoop(e.getKey()))),e}sync(e){if(!this.isActive())throw new e9(A.ErrClientNotActivated,"".concat(this.key," is not active"));if(e){let t=this.attachmentMap.get(e.getKey());if(!t)throw new e9(A.ErrDocumentNotAttached,"".concat(e.getKey()," is not attached"));return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(e=>{throw rO.error('[SY] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e}))}return this.enqueueTask(async()=>{let e=[];for(let[,t]of this.attachmentMap)e.push(this.syncInternal(t,t.syncMode));return Promise.all(e).catch(e=>{throw rO.error('[SY] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e})})}remove(e){if(!this.isActive())throw new e9(A.ErrClientNotActivated,"".concat(this.key," is not active"));let t=this.attachmentMap.get(e.getKey());if(!t)throw new e9(A.ErrDocumentNotAttached,"".concat(e.getKey()," is not attached"));e.setActor(this.id);let r=rD.toChangePack(e.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>this.rpcClient.removeDocument({clientId:this.id,documentId:t.docID,changePack:r},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e.getKey())}}).then(t=>{let r=rD.fromChangePack(t.changePack);e.applyChangePack(r),this.detachInternal(e.getKey()),rO.info('[RD] c:"'.concat(this.getKey(),'" removes d:"').concat(e.getKey(),'"'))}).catch(e=>{throw rO.error('[RD] c:"'.concat(this.getKey(),'" err :'),e),this.handleConnectError(e),e}))}getID(){return this.id}getKey(){return this.key}isActive(){return"activated"===this.status}getStatus(){return this.status}getCondition(e){return this.conditions[e]}runSyncLoop(){let e=()=>{if(!this.isActive()){rO.debug('[SL] c:"'.concat(this.getKey(),'" exit sync loop')),this.conditions.SyncLoop=!1;return}let t=[];for(let[,e]of this.attachmentMap)e.needRealtimeSync()&&(e.remoteChangeEventReceived=!1,t.push(this.syncInternal(e,e.syncMode)));Promise.all(t).then(()=>setTimeout(e,this.syncLoopDuration)).catch(t=>{rO.error('[SL] c:"'.concat(this.getKey(),'" sync failed:'),t),this.handleConnectError(t)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1})};rO.debug('[SL] c:"'.concat(this.getKey(),'" run sync loop')),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){let t=this.attachmentMap.get(e);if(!t)throw new e9(A.ErrDocumentNotAttached,"".concat(e," is not attached"));return this.conditions.WatchLoop=!0,t.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new e9(A.ErrClientNotActivated,"".concat(this.key," is not active")));let n=new AbortController,i=this.rpcClient.watchDocument({clientId:this.id,documentId:t.docID},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(e)},signal:n.signal});return t.doc.publish([{type:b.ConnectionChanged,value:D.Connected}]),rO.info('[WD] c:"'.concat(this.getKey(),'" watches d:"').concat(e,'"')),new Promise((e,s)=>{(async()=>{try{for await(let r of i)this.handleWatchDocumentsResponse(t,r),"initialization"===r.body.case&&e([i,n])}catch(e){t.doc.resetOnlineClients(),t.doc.publish([{type:b.Initialized,source:S.Local,value:t.doc.getPresences()}]),t.doc.publish([{type:b.ConnectionChanged,value:D.Disconnected}]),rO.debug('[WD] c:"'.concat(this.getKey(),'" unwatches')),this.handleConnectError(e)?r():this.conditions.WatchLoop=!1,s(e)}})()})})}handleWatchDocumentsResponse(e,t){if("event"===t.body.case&&t.body.value.type===Y.DOCUMENT_CHANGED){e.remoteChangeEventReceived=!0;return}e.doc.applyWatchStream(t)}deactivateInternal(){for(let[e,t]of(this.status="deactivated",this.attachmentMap))this.detachInternal(e),t.doc.applyStatus(P.Detached)}detachInternal(e){let t=this.attachmentMap.get(e);t&&(t.cancelWatchStream(),this.attachmentMap.delete(e))}syncInternal(e,t){let{doc:r,docID:n}=e,i=r.createChangePack();return this.rpcClient.pushPullChanges({clientId:this.id,documentId:n,changePack:rD.toChangePack(i),pushOnly:"realtime-pushonly"===t},{headers:{"x-shard-key":"".concat(this.apiKey,"/").concat(r.getKey())}}).then(t=>{let n=rD.fromChangePack(t.changePack);if(n.hasChanges()&&("realtime-pushonly"===e.syncMode||"realtime-syncoff"===e.syncMode))return r;r.applyChangePack(n),e.doc.publish([{type:b.SyncStatusChanged,value:R.Synced}]),r.getStatus()===P.Removed&&this.detachInternal(r.getKey());let s=r.getKey(),a=n.getChangeSize();return rO.info('[PP] c:"'.concat(this.getKey(),'" sync d:"').concat(s,'", push:').concat(i.getChangeSize()," pull:").concat(a," cp:").concat(n.getCheckpoint().toTestString())),r}).catch(e=>{throw r.publish([{type:b.SyncStatusChanged,value:R.SyncFailed}]),rO.error('[PP] c:"'.concat(this.getKey(),'" err :'),e),e})}handleConnectError(e){return e instanceof J.K&&(e.code===j.E.Canceled||e.code===j.E.Unknown||e.code===j.E.ResourceExhausted||e.code===j.E.Unavailable||((rh(e)===A.ErrClientNotActivated||rh(e)===A.ErrClientNotFound)&&this.deactivateInternal(),!1))}enqueueTask(e){return new Promise((t,r)=>{this.taskQueue.push(()=>e().then(t).catch(r)),this.processing||this.processNext()})}async processNext(){if(0===this.taskQueue.length){this.processing=!1;return}try{this.processing=!0;let e=this.taskQueue.shift();await e()}catch(e){rO.error('[TQ] c:"'.concat(this.getKey(),'" process failed, id:"').concat(this.id,'"'))}this.processNext()}constructor(e,t){var r,n;this.processing=!1,t=t||r4,this.key=t.key?t.key:rM(),this.status="deactivated",this.attachmentMap=new Map,this.apiKey=t.apiKey||"",this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=t.syncLoopDuration||r4.syncLoopDuration,this.reconnectStreamDelay=t.reconnectStreamDelay||r4.reconnectStreamDelay,this.retrySyncLoopDelay=t.retrySyncLoopDelay||r4.retrySyncLoopDelay,this.rpcClient=(0,q.Hb)(e1,(0,F.u)({baseUrl:e,interceptors:[(r=t.apiKey,n=t.token,e=>async t=>(r&&t.header.set("x-api-key",r),n&&t.header.set("authorization",n),await e(t))),e=>async t=>(t.header.set("x-yorkie-user-agent",r9.u2+"/"+r9.i8),await e(t))]})),this.taskQueue=[]}}var r8={Client:r5,Document:r3,Primitive:tf,Text:rq,Counter:rF,Tree:rH,LogLevel:E,setLogLevel:rN,IntType:k.IntegerCnt,LongType:k.LongCnt};"undefined"!=typeof globalThis&&(globalThis.yorkie={Client:r5,Document:r3,Primitive:tf,Text:rq,Counter:rF,Tree:rH,LogLevel:E,setLogLevel:rN,IntType:k.IntegerCnt,LongType:k.LongCnt}),r(109);var r6=r(6182);function r7(e){let{content:t,actions:r}=e,[n,i]=(0,z.useState)(new Date),[s,a]=(0,z.useState)("Enter text here!"),o=n?U(new Date(n.toString())):"",h=e=>{let n=!1;switch(e){case"PUSH":n=!1,t.forEach(e=>{if(e.date===o)return n=!n,0}),n?r.updateContent(o,s):r.addContent(o,s),a("Enter text here!");break;case"DELETE":r.deleteContent(o)}};return(0,_.jsx)("article",{children:(0,_.jsxs)("div",{children:[(0,_.jsx)(r6.ZP,{onChange:i,value:n,locale:"en-EN",showNeighboringMonth:!1,formatDay:(e,t)=>t.toLocaleString("en",{day:"numeric"}),tileClassName:e=>{let{date:r}=e;return t.find(e=>e.date===U(r))?"highlight":""}}),(0,_.jsxs)("p",{children:["selected day : ",o]}),(0,_.jsx)("div",{className:B().memo,children:t.map((e,t)=>{if(e.date===o)return(0,_.jsx)("p",{children:e.text},t)})}),(0,_.jsxs)("div",{className:B().inputForm_editor,children:[(0,_.jsx)("h3",{children:"input form"}),(0,_.jsx)("textarea",{className:B().textArea,value:s,onChange:e=>a(e.target.value)})]}),(0,_.jsx)("button",{className:"button",onClick:()=>h("PUSH"),children:"push"}),(0,_.jsx)("button",{className:"button",onClick:()=>h("DELETE"),children:"pop"})]})})}let ne=[{date:U(new Date).replace(/^\d{2}/,"01"),text:"payday"},{date:U(new Date).replace(/^\d{2}/,"17"),text:"Garry's birthday"}],nt="next.js-Scheduler-".concat(U(new Date));function nr(){let[e,t]=(0,z.useState)([]),[r,n]=(0,z.useState)(ne),[i]=(0,z.useState)(()=>new r8.Document(nt));return(0,z.useEffect)(()=>{let e=new r8.Client("https://api.yorkie.dev",{apiKey:"cedaovjuioqlk4pjqn6g"});i.subscribe("presence",e=>{e.type!==b.PresenceChanged&&t(function(e){let t=[];for(let{presence:r}of e)t.push(r.userName);return t}(i.getPresences()))}),async function(t,r){await e.activate(),await e.attach(t,{initialPresence:{userName:function(){let e=Math.floor(Math.random()*K.length);return K[e]}()}}),t.update(e=>{e.content||(e.content=ne)},"create default content if not exists"),t.subscribe(()=>{r(t.getRoot().content)}),r(t.getRoot().content)}(i,e=>n(e))},[]),(0,_.jsxs)("main",{className:B().main,children:[(0,_.jsxs)("p",{children:["peers : [",e.map((e,t)=>(0,_.jsxs)("span",{children:[" ",e,", "]},t))," ","]"]}),(0,_.jsx)(r7,{content:r,actions:{addContent(e,t){i.update(r=>{r.content.push({date:e,text:t})})},deleteContent(e){i.update(t=>{let r;for(let n of t.content)if(n.date===e){r=n;break}r&&t.content.deleteByID(r.getID())})},updateContent(e,t){i.update(r=>{let n;for(let t of r.content)if(t.date===e){n=t;break}n&&(n.text=t)})}}})]})}},109:function(){},7397:function(e){e.exports={main:"page_main__s_E_L",textArea:"page_textArea__sVKfA",memo:"page_memo__V0Ipn",inputForm_editor:"page_inputForm_editor__Tk7dD"}}},function(e){e.O(0,[662,828,852,744],function(){return e(e.s=4629)}),_N_E=e.O()}]);