"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[607],{6607:(e,t,r)=>{r.r(t),r.d(t,{default:()=>g});var n=r(8112),s=r(5194),o=r(6108),l=r(410);r(5087);var c=r(4316);let i=e=>{var t;let{embed:r,...n}=null!=(t=e.attributes)?t:{};return r?{insert:JSON.parse(r.toString()),attributes:n}:{insert:e.content||"",attributes:e.attributes}},a=e=>{let{doc:t}=e,[r,s]=(0,c.useState)(""),[o,l]=(0,c.useState)("");return(0,c.useEffect)(()=>{if(t){var e;s(t.toJSON()),l((null==(e=t.getRoot().content)?void 0:e.toTestString())||"")}let r=t.subscribe(()=>{var e;s(t.toJSON()),l((null==(e=t.getRoot().content)?void 0:e.toTestString())||"")});return()=>{r()}},[t]),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold mb-2",children:"Document JSON:"}),(0,n.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-sm overflow-auto max-h-40",children:r})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-bold mb-2",children:"Document Text:"}),(0,n.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-sm overflow-auto max-h-40",children:o})]})]})},u=()=>{let e=(0,s.g6)();return(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{children:"Participants:"}),(0,n.jsx)("div",{className:"flex items-center gap-2",children:e&&e.length>0?(0,n.jsx)("span",{className:"text-sm text-gray-600",children:1===e.length?"Just you":"".concat(e.length," users")}):(0,n.jsx)("span",{className:"text-sm text-gray-400",children:"No participants"})})]})},d={modules:{toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]]},theme:"snow"},g=()=>{let e=(0,c.useRef)(null),t=(0,c.useRef)(null),r=(0,c.useRef)(!1),{doc:g,update:p,loading:f,error:b}=(0,s.ZY)(),m=(0,c.useCallback)(e=>{if(!t.current)return;let r=(e=>{let t=[],r=0;for(let n of e)if("edit"===n.type){let e=n.from,s=n.to,o=e-r,l=s-e;if(!n.value){console.error("Operation value is undefined:",n);continue}let{insert:c,attributes:a}=i(n.value);if(console.log("%c remote: ".concat(e,"-").concat(s,": ").concat(c),"color: skyblue"),o&&t.push({retain:o}),l&&t.push({delete:l}),c){let e={insert:c};a&&(e.attributes=a),t.push(e)}r=s}else if("style"===n.type){let e=n.from,s=n.to,o=e-r,l=s-e,{attributes:c}=i(n.value);if(console.log("%c remote: ".concat(e,"-").concat(s,": ").concat(JSON.stringify(c)),"color: skyblue"),o&&t.push({retain:o}),c){let e={attributes:c};l&&(e.retain=l),t.push(e)}r=s}return t})(e);if(r.length){console.log("%c to quill: ".concat(JSON.stringify(r)),"color: green");let e=new l.Ru(r);t.current.updateContents(e,"api")}},[]),h=(0,c.useCallback)(()=>{if(!g||!t.current)return;let e=g.getRoot().content;if(!e)return;let r=new l.Ru(e.values().map(e=>i(e)));t.current.setContents(r,"api")},[g]);return((0,c.useEffect)(()=>{if(!e.current||!g||r.current)return;r.current=!0,p(e=>{e.content||(e.content=new o.EY,e.content.edit(0,0,"\n"))});let n=g.subscribe(e=>{"snapshot"===e.type&&h()}),s=g.subscribe("$.content",e=>{"remote-change"===e.type&&m(e.value.operations)}),c=new l.Ay(e.current,d);return t.current=c,c.on("text-change",(e,t,r)=>{if("api"===r||!e.ops)return;let n=0,s=0;for(let t of(console.log("%c quill: ".concat(JSON.stringify(e.ops)),"color: green"),e.ops))void 0!==t.attributes||void 0!==t.insert?(void 0!==t.retain&&"number"==typeof t.retain&&(s=n+t.retain),console.log("%c local: ".concat(n,"-").concat(s,": ").concat(t.insert," ").concat(t.attributes?JSON.stringify(t.attributes):"{}"),"color: green"),p(e=>{void 0!==t.attributes&&void 0===t.insert?e.content.setStyle(n,s,t.attributes):void 0!==t.insert&&(s<n&&(s=n),"object"==typeof t.insert?e.content.edit(n,s," ",{embed:JSON.stringify(t.insert),...t.attributes}):e.content.edit(n,s,t.insert,t.attributes),n=s+("string"==typeof t.insert?t.insert.length:1))})):void 0!==t.delete?(s=n+t.delete,console.log("%c local: ".concat(n,"-").concat(s,": ''"),"color: green"),p(e=>{e.content.edit(n,s,"")})):void 0!==t.retain&&"number"==typeof t.retain&&(s=n=s+t.retain)}),h(),()=>{n(),s(),t.current&&(t.current=null),r.current=!1}},[g,p,m,h]),f)?(0,n.jsx)("div",{className:"p-4",children:"Loading editor..."}):b?(0,n.jsxs)("div",{className:"p-4 text-red-500",children:["Error: ",b.message]}):(0,n.jsxs)("div",{className:"container mx-auto p-4",children:[(0,n.jsx)("div",{className:"mb-4 flex items-center gap-4",children:(0,n.jsx)(u,{})}),(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)("div",{ref:e,className:"h-96 border border-gray-300 rounded"})}),(0,n.jsx)(a,{doc:g})]})}}}]);