var uu=Object.defineProperty;var fu=(n,e,t)=>e in n?uu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>fu(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();function Ni(n,e){const t=Object.create(null),r=n.split(",");for(let s=0;s<r.length;s++)t[r[s]]=!0;return s=>!!t[s]}const ae={},$n=[],Ct=()=>{},hu=()=>!1,du=/^on[^a-z]/,ks=n=>du.test(n),Ci=n=>n.startsWith("onUpdate:"),Ae=Object.assign,Oi=(n,e)=>{const t=n.indexOf(e);t>-1&&n.splice(t,1)},gu=Object.prototype.hasOwnProperty,X=(n,e)=>gu.call(n,e),j=Array.isArray,Un=n=>Es(n)==="[object Map]",ja=n=>Es(n)==="[object Set]",W=n=>typeof n=="function",we=n=>typeof n=="string",Pi=n=>typeof n=="symbol",le=n=>n!==null&&typeof n=="object",Ka=n=>le(n)&&W(n.then)&&W(n.catch),Va=Object.prototype.toString,Es=n=>Va.call(n),mu=n=>Es(n).slice(8,-1),Wa=n=>Es(n)==="[object Object]",Di=n=>we(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,ts=Ni(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),xs=n=>{const e=Object.create(null);return t=>e[t]||(e[t]=n(t))},pu=/-(\w)/g,Vn=xs(n=>n.replace(pu,(e,t)=>t?t.toUpperCase():"")),yu=/\B([A-Z])/g,Cn=xs(n=>n.replace(yu,"-$1").toLowerCase()),Ha=xs(n=>n.charAt(0).toUpperCase()+n.slice(1)),Ks=xs(n=>n?`on${Ha(n)}`:""),ds=(n,e)=>!Object.is(n,e),ns=(n,e)=>{for(let t=0;t<n.length;t++)n[t](e)},gs=(n,e,t)=>{Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value:t})},oi=n=>{const e=parseFloat(n);return isNaN(e)?n:e};let Io;const ai=()=>Io||(Io=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ri(n){if(j(n)){const e={};for(let t=0;t<n.length;t++){const r=n[t],s=we(r)?bu(r):Ri(r);if(s)for(const i in s)e[i]=s[i]}return e}else{if(we(n))return n;if(le(n))return n}}const vu=/;(?![^(]*\))/g,Tu=/:([^]+)/,wu=/\/\*[^]*?\*\//g;function bu(n){const e={};return n.replace(wu,"").split(vu).forEach(t=>{if(t){const r=t.split(Tu);r.length>1&&(e[r[0].trim()]=r[1].trim())}}),e}function _i(n){let e="";if(we(n))e=n;else if(j(n))for(let t=0;t<n.length;t++){const r=_i(n[t]);r&&(e+=r+" ")}else if(le(n))for(const t in n)n[t]&&(e+=t+" ");return e.trim()}const Au="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Iu=Ni(Au);function Ga(n){return!!n||n===""}const So=n=>we(n)?n:n==null?"":j(n)||le(n)&&(n.toString===Va||!W(n.toString))?JSON.stringify(n,Ya,2):String(n),Ya=(n,e)=>e&&e.__v_isRef?Ya(n,e.value):Un(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[r,s])=>(t[`${r} =>`]=s,t),{})}:ja(e)?{[`Set(${e.size})`]:[...e.values()]}:le(e)&&!j(e)&&!Wa(e)?String(e):e;let tt;class Su{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=tt,!e&&tt&&(this.index=(tt.scopes||(tt.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=tt;try{return tt=this,e()}finally{tt=t}}}on(){tt=this}off(){tt=this.parent}stop(e){if(this._active){let t,r;for(t=0,r=this.effects.length;t<r;t++)this.effects[t].stop();for(t=0,r=this.cleanups.length;t<r;t++)this.cleanups[t]();if(this.scopes)for(t=0,r=this.scopes.length;t<r;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function ku(n,e=tt){e&&e.active&&e.effects.push(n)}function Eu(){return tt}const Fi=n=>{const e=new Set(n);return e.w=0,e.n=0,e},Xa=n=>(n.w&an)>0,Za=n=>(n.n&an)>0,xu=({deps:n})=>{if(n.length)for(let e=0;e<n.length;e++)n[e].w|=an},Nu=n=>{const{deps:e}=n;if(e.length){let t=0;for(let r=0;r<e.length;r++){const s=e[r];Xa(s)&&!Za(s)?s.delete(n):e[t++]=s,s.w&=~an,s.n&=~an}e.length=t}},ci=new WeakMap;let lr=0,an=1;const li=30;let rt;const In=Symbol(""),ui=Symbol("");class Mi{constructor(e,t=null,r){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,ku(this,r)}run(){if(!this.active)return this.fn();let e=rt,t=nn;for(;e;){if(e===this)return;e=e.parent}try{return this.parent=rt,rt=this,nn=!0,an=1<<++lr,lr<=li?xu(this):ko(this),this.fn()}finally{lr<=li&&Nu(this),an=1<<--lr,rt=this.parent,nn=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){rt===this?this.deferStop=!0:this.active&&(ko(this),this.onStop&&this.onStop(),this.active=!1)}}function ko(n){const{deps:e}=n;if(e.length){for(let t=0;t<e.length;t++)e[t].delete(n);e.length=0}}let nn=!0;const Qa=[];function nr(){Qa.push(nn),nn=!1}function rr(){const n=Qa.pop();nn=n===void 0?!0:n}function Ue(n,e,t){if(nn&&rt){let r=ci.get(n);r||ci.set(n,r=new Map);let s=r.get(t);s||r.set(t,s=Fi()),ec(s)}}function ec(n,e){let t=!1;lr<=li?Za(n)||(n.n|=an,t=!Xa(n)):t=!n.has(rt),t&&(n.add(rt),rt.deps.push(n))}function jt(n,e,t,r,s,i){const o=ci.get(n);if(!o)return;let a=[];if(e==="clear")a=[...o.values()];else if(t==="length"&&j(n)){const c=Number(r);o.forEach((l,u)=>{(u==="length"||u>=c)&&a.push(l)})}else switch(t!==void 0&&a.push(o.get(t)),e){case"add":j(n)?Di(t)&&a.push(o.get("length")):(a.push(o.get(In)),Un(n)&&a.push(o.get(ui)));break;case"delete":j(n)||(a.push(o.get(In)),Un(n)&&a.push(o.get(ui)));break;case"set":Un(n)&&a.push(o.get(In));break}if(a.length===1)a[0]&&fi(a[0]);else{const c=[];for(const l of a)l&&c.push(...l);fi(Fi(c))}}function fi(n,e){const t=j(n)?n:[...n];for(const r of t)r.computed&&Eo(r);for(const r of t)r.computed||Eo(r)}function Eo(n,e){(n!==rt||n.allowRecurse)&&(n.scheduler?n.scheduler():n.run())}const Cu=Ni("__proto__,__v_isRef,__isVue"),tc=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Pi)),Ou=Bi(),Pu=Bi(!1,!0),Du=Bi(!0),xo=Ru();function Ru(){const n={};return["includes","indexOf","lastIndexOf"].forEach(e=>{n[e]=function(...t){const r=te(this);for(let i=0,o=this.length;i<o;i++)Ue(r,"get",i+"");const s=r[e](...t);return s===-1||s===!1?r[e](...t.map(te)):s}}),["push","pop","shift","unshift","splice"].forEach(e=>{n[e]=function(...t){nr();const r=te(this)[e].apply(this,t);return rr(),r}}),n}function _u(n){const e=te(this);return Ue(e,"has",n),e.hasOwnProperty(n)}function Bi(n=!1,e=!1){return function(r,s,i){if(s==="__v_isReactive")return!n;if(s==="__v_isReadonly")return n;if(s==="__v_isShallow")return e;if(s==="__v_raw"&&i===(n?e?Yu:oc:e?ic:sc).get(r))return r;const o=j(r);if(!n){if(o&&X(xo,s))return Reflect.get(xo,s,i);if(s==="hasOwnProperty")return _u}const a=Reflect.get(r,s,i);return(Pi(s)?tc.has(s):Cu(s))||(n||Ue(r,"get",s),e)?a:Re(a)?o&&Di(s)?a:a.value:le(a)?n?ac(a):Ui(a):a}}const Fu=nc(),Mu=nc(!0);function nc(n=!1){return function(t,r,s,i){let o=t[r];if(vr(o)&&Re(o)&&!Re(s))return!1;if(!n&&(!hi(s)&&!vr(s)&&(o=te(o),s=te(s)),!j(t)&&Re(o)&&!Re(s)))return o.value=s,!0;const a=j(t)&&Di(r)?Number(r)<t.length:X(t,r),c=Reflect.set(t,r,s,i);return t===te(i)&&(a?ds(s,o)&&jt(t,"set",r,s):jt(t,"add",r,s)),c}}function Bu(n,e){const t=X(n,e);n[e];const r=Reflect.deleteProperty(n,e);return r&&t&&jt(n,"delete",e,void 0),r}function Lu(n,e){const t=Reflect.has(n,e);return(!Pi(e)||!tc.has(e))&&Ue(n,"has",e),t}function $u(n){return Ue(n,"iterate",j(n)?"length":In),Reflect.ownKeys(n)}const rc={get:Ou,set:Fu,deleteProperty:Bu,has:Lu,ownKeys:$u},Uu={get:Du,set(n,e){return!0},deleteProperty(n,e){return!0}},Ju=Ae({},rc,{get:Pu,set:Mu}),Li=n=>n,Ns=n=>Reflect.getPrototypeOf(n);function qr(n,e,t=!1,r=!1){n=n.__v_raw;const s=te(n),i=te(e);t||(e!==i&&Ue(s,"get",e),Ue(s,"get",i));const{has:o}=Ns(s),a=r?Li:t?zi:qi;if(o.call(s,e))return a(n.get(e));if(o.call(s,i))return a(n.get(i));n!==s&&n.get(e)}function zr(n,e=!1){const t=this.__v_raw,r=te(t),s=te(n);return e||(n!==s&&Ue(r,"has",n),Ue(r,"has",s)),n===s?t.has(n):t.has(n)||t.has(s)}function jr(n,e=!1){return n=n.__v_raw,!e&&Ue(te(n),"iterate",In),Reflect.get(n,"size",n)}function No(n){n=te(n);const e=te(this);return Ns(e).has.call(e,n)||(e.add(n),jt(e,"add",n,n)),this}function Co(n,e){e=te(e);const t=te(this),{has:r,get:s}=Ns(t);let i=r.call(t,n);i||(n=te(n),i=r.call(t,n));const o=s.call(t,n);return t.set(n,e),i?ds(e,o)&&jt(t,"set",n,e):jt(t,"add",n,e),this}function Oo(n){const e=te(this),{has:t,get:r}=Ns(e);let s=t.call(e,n);s||(n=te(n),s=t.call(e,n)),r&&r.call(e,n);const i=e.delete(n);return s&&jt(e,"delete",n,void 0),i}function Po(){const n=te(this),e=n.size!==0,t=n.clear();return e&&jt(n,"clear",void 0,void 0),t}function Kr(n,e){return function(r,s){const i=this,o=i.__v_raw,a=te(o),c=e?Li:n?zi:qi;return!n&&Ue(a,"iterate",In),o.forEach((l,u)=>r.call(s,c(l),c(u),i))}}function Vr(n,e,t){return function(...r){const s=this.__v_raw,i=te(s),o=Un(i),a=n==="entries"||n===Symbol.iterator&&o,c=n==="keys"&&o,l=s[n](...r),u=t?Li:e?zi:qi;return!e&&Ue(i,"iterate",c?ui:In),{next(){const{value:g,done:v}=l.next();return v?{value:g,done:v}:{value:a?[u(g[0]),u(g[1])]:u(g),done:v}},[Symbol.iterator](){return this}}}}function Ht(n){return function(...e){return n==="delete"?!1:this}}function qu(){const n={get(i){return qr(this,i)},get size(){return jr(this)},has:zr,add:No,set:Co,delete:Oo,clear:Po,forEach:Kr(!1,!1)},e={get(i){return qr(this,i,!1,!0)},get size(){return jr(this)},has:zr,add:No,set:Co,delete:Oo,clear:Po,forEach:Kr(!1,!0)},t={get(i){return qr(this,i,!0)},get size(){return jr(this,!0)},has(i){return zr.call(this,i,!0)},add:Ht("add"),set:Ht("set"),delete:Ht("delete"),clear:Ht("clear"),forEach:Kr(!0,!1)},r={get(i){return qr(this,i,!0,!0)},get size(){return jr(this,!0)},has(i){return zr.call(this,i,!0)},add:Ht("add"),set:Ht("set"),delete:Ht("delete"),clear:Ht("clear"),forEach:Kr(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(i=>{n[i]=Vr(i,!1,!1),t[i]=Vr(i,!0,!1),e[i]=Vr(i,!1,!0),r[i]=Vr(i,!0,!0)}),[n,t,e,r]}const[zu,ju,Ku,Vu]=qu();function $i(n,e){const t=e?n?Vu:Ku:n?ju:zu;return(r,s,i)=>s==="__v_isReactive"?!n:s==="__v_isReadonly"?n:s==="__v_raw"?r:Reflect.get(X(t,s)&&s in r?t:r,s,i)}const Wu={get:$i(!1,!1)},Hu={get:$i(!1,!0)},Gu={get:$i(!0,!1)},sc=new WeakMap,ic=new WeakMap,oc=new WeakMap,Yu=new WeakMap;function Xu(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Zu(n){return n.__v_skip||!Object.isExtensible(n)?0:Xu(mu(n))}function Ui(n){return vr(n)?n:Ji(n,!1,rc,Wu,sc)}function Qu(n){return Ji(n,!1,Ju,Hu,ic)}function ac(n){return Ji(n,!0,Uu,Gu,oc)}function Ji(n,e,t,r,s){if(!le(n)||n.__v_raw&&!(e&&n.__v_isReactive))return n;const i=s.get(n);if(i)return i;const o=Zu(n);if(o===0)return n;const a=new Proxy(n,o===2?r:t);return s.set(n,a),a}function Jn(n){return vr(n)?Jn(n.__v_raw):!!(n&&n.__v_isReactive)}function vr(n){return!!(n&&n.__v_isReadonly)}function hi(n){return!!(n&&n.__v_isShallow)}function cc(n){return Jn(n)||vr(n)}function te(n){const e=n&&n.__v_raw;return e?te(e):n}function lc(n){return gs(n,"__v_skip",!0),n}const qi=n=>le(n)?Ui(n):n,zi=n=>le(n)?ac(n):n;function ef(n){nn&&rt&&(n=te(n),ec(n.dep||(n.dep=Fi())))}function tf(n,e){n=te(n);const t=n.dep;t&&fi(t)}function Re(n){return!!(n&&n.__v_isRef===!0)}function nf(n){return Re(n)?n.value:n}const rf={get:(n,e,t)=>nf(Reflect.get(n,e,t)),set:(n,e,t,r)=>{const s=n[e];return Re(s)&&!Re(t)?(s.value=t,!0):Reflect.set(n,e,t,r)}};function uc(n){return Jn(n)?n:new Proxy(n,rf)}class sf{constructor(e,t,r,s){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this._dirty=!0,this.effect=new Mi(e,()=>{this._dirty||(this._dirty=!0,tf(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=r}get value(){const e=te(this);return ef(e),(e._dirty||!e._cacheable)&&(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function of(n,e,t=!1){let r,s;const i=W(n);return i?(r=n,s=Ct):(r=n.get,s=n.set),new sf(r,s,i||!s,t)}function rn(n,e,t,r){let s;try{s=r?n(...r):n()}catch(i){Cs(i,e,t)}return s}function ct(n,e,t,r){if(W(n)){const i=rn(n,e,t,r);return i&&Ka(i)&&i.catch(o=>{Cs(o,e,t)}),i}const s=[];for(let i=0;i<n.length;i++)s.push(ct(n[i],e,t,r));return s}function Cs(n,e,t,r=!0){const s=e?e.vnode:null;if(e){let i=e.parent;const o=e.proxy,a=t;for(;i;){const l=i.ec;if(l){for(let u=0;u<l.length;u++)if(l[u](n,o,a)===!1)return}i=i.parent}const c=e.appContext.config.errorHandler;if(c){rn(c,null,10,[n,o,a]);return}}af(n,t,s,r)}function af(n,e,t,r=!0){console.error(n)}let Tr=!1,di=!1;const ke=[];let vt=0;const qn=[];let Mt=null,vn=0;const fc=Promise.resolve();let ji=null;function cf(n){const e=ji||fc;return n?e.then(this?n.bind(this):n):e}function lf(n){let e=vt+1,t=ke.length;for(;e<t;){const r=e+t>>>1;wr(ke[r])<n?e=r+1:t=r}return e}function Ki(n){(!ke.length||!ke.includes(n,Tr&&n.allowRecurse?vt+1:vt))&&(n.id==null?ke.push(n):ke.splice(lf(n.id),0,n),hc())}function hc(){!Tr&&!di&&(di=!0,ji=fc.then(gc))}function uf(n){const e=ke.indexOf(n);e>vt&&ke.splice(e,1)}function ff(n){j(n)?qn.push(...n):(!Mt||!Mt.includes(n,n.allowRecurse?vn+1:vn))&&qn.push(n),hc()}function Do(n,e=Tr?vt+1:0){for(;e<ke.length;e++){const t=ke[e];t&&t.pre&&(ke.splice(e,1),e--,t())}}function dc(n){if(qn.length){const e=[...new Set(qn)];if(qn.length=0,Mt){Mt.push(...e);return}for(Mt=e,Mt.sort((t,r)=>wr(t)-wr(r)),vn=0;vn<Mt.length;vn++)Mt[vn]();Mt=null,vn=0}}const wr=n=>n.id==null?1/0:n.id,hf=(n,e)=>{const t=wr(n)-wr(e);if(t===0){if(n.pre&&!e.pre)return-1;if(e.pre&&!n.pre)return 1}return t};function gc(n){di=!1,Tr=!0,ke.sort(hf);try{for(vt=0;vt<ke.length;vt++){const e=ke[vt];e&&e.active!==!1&&rn(e,null,14)}}finally{vt=0,ke.length=0,dc(),Tr=!1,ji=null,(ke.length||qn.length)&&gc()}}function df(n,e,...t){if(n.isUnmounted)return;const r=n.vnode.props||ae;let s=t;const i=e.startsWith("update:"),o=i&&e.slice(7);if(o&&o in r){const u=`${o==="modelValue"?"model":o}Modifiers`,{number:g,trim:v}=r[u]||ae;v&&(s=t.map(d=>we(d)?d.trim():d)),g&&(s=t.map(oi))}let a,c=r[a=Ks(e)]||r[a=Ks(Vn(e))];!c&&i&&(c=r[a=Ks(Cn(e))]),c&&ct(c,n,6,s);const l=r[a+"Once"];if(l){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,ct(l,n,6,s)}}function mc(n,e,t=!1){const r=e.emitsCache,s=r.get(n);if(s!==void 0)return s;const i=n.emits;let o={},a=!1;if(!W(n)){const c=l=>{const u=mc(l,e,!0);u&&(a=!0,Ae(o,u))};!t&&e.mixins.length&&e.mixins.forEach(c),n.extends&&c(n.extends),n.mixins&&n.mixins.forEach(c)}return!i&&!a?(le(n)&&r.set(n,null),null):(j(i)?i.forEach(c=>o[c]=null):Ae(o,i),le(n)&&r.set(n,o),o)}function Os(n,e){return!n||!ks(e)?!1:(e=e.slice(2).replace(/Once$/,""),X(n,e[0].toLowerCase()+e.slice(1))||X(n,Cn(e))||X(n,e))}let st=null,pc=null;function ms(n){const e=st;return st=n,pc=n&&n.type.__scopeId||null,e}function gf(n,e=st,t){if(!e||n._n)return n;const r=(...s)=>{r._d&&jo(-1);const i=ms(e);let o;try{o=n(...s)}finally{ms(i),r._d&&jo(1)}return o};return r._n=!0,r._c=!0,r._d=!0,r}function Vs(n){const{type:e,vnode:t,proxy:r,withProxy:s,props:i,propsOptions:[o],slots:a,attrs:c,emit:l,render:u,renderCache:g,data:v,setupState:d,ctx:A,inheritAttrs:x}=n;let R,L;const $=ms(n);try{if(t.shapeFlag&4){const P=s||r;R=yt(u.call(P,P,g,i,d,v,A)),L=c}else{const P=e;R=yt(P.length>1?P(i,{attrs:c,slots:a,emit:l}):P(i,null)),L=e.props?c:mf(c)}}catch(P){hr.length=0,Cs(P,n,1),R=Sn(br)}let Y=R;if(L&&x!==!1){const P=Object.keys(L),{shapeFlag:H}=Y;P.length&&H&7&&(o&&P.some(Ci)&&(L=pf(L,o)),Y=Wn(Y,L))}return t.dirs&&(Y=Wn(Y),Y.dirs=Y.dirs?Y.dirs.concat(t.dirs):t.dirs),t.transition&&(Y.transition=t.transition),R=Y,ms($),R}const mf=n=>{let e;for(const t in n)(t==="class"||t==="style"||ks(t))&&((e||(e={}))[t]=n[t]);return e},pf=(n,e)=>{const t={};for(const r in n)(!Ci(r)||!(r.slice(9)in e))&&(t[r]=n[r]);return t};function yf(n,e,t){const{props:r,children:s,component:i}=n,{props:o,children:a,patchFlag:c}=e,l=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&c>=0){if(c&1024)return!0;if(c&16)return r?Ro(r,o,l):!!o;if(c&8){const u=e.dynamicProps;for(let g=0;g<u.length;g++){const v=u[g];if(o[v]!==r[v]&&!Os(l,v))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:r===o?!1:r?o?Ro(r,o,l):!0:!!o;return!1}function Ro(n,e,t){const r=Object.keys(e);if(r.length!==Object.keys(n).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(e[i]!==n[i]&&!Os(t,i))return!0}return!1}function vf({vnode:n,parent:e},t){for(;e&&e.subTree===n;)(n=e.vnode).el=t,e=e.parent}const Tf=n=>n.__isSuspense;function wf(n,e){e&&e.pendingBranch?j(n)?e.effects.push(...n):e.effects.push(n):ff(n)}const Wr={};function Ws(n,e,t){return yc(n,e,t)}function yc(n,e,{immediate:t,deep:r,flush:s,onTrack:i,onTrigger:o}=ae){var a;const c=Eu()===((a=Ee)==null?void 0:a.scope)?Ee:null;let l,u=!1,g=!1;if(Re(n)?(l=()=>n.value,u=hi(n)):Jn(n)?(l=()=>n,r=!0):j(n)?(g=!0,u=n.some(P=>Jn(P)||hi(P)),l=()=>n.map(P=>{if(Re(P))return P.value;if(Jn(P))return wn(P);if(W(P))return rn(P,c,2)})):W(n)?e?l=()=>rn(n,c,2):l=()=>{if(!(c&&c.isUnmounted))return v&&v(),ct(n,c,3,[d])}:l=Ct,e&&r){const P=l;l=()=>wn(P())}let v,d=P=>{v=$.onStop=()=>{rn(P,c,4)}},A;if(Ir)if(d=Ct,e?t&&ct(e,c,3,[l(),g?[]:void 0,d]):l(),s==="sync"){const P=mh();A=P.__watcherHandles||(P.__watcherHandles=[])}else return Ct;let x=g?new Array(n.length).fill(Wr):Wr;const R=()=>{if($.active)if(e){const P=$.run();(r||u||(g?P.some((H,Q)=>ds(H,x[Q])):ds(P,x)))&&(v&&v(),ct(e,c,3,[P,x===Wr?void 0:g&&x[0]===Wr?[]:x,d]),x=P)}else $.run()};R.allowRecurse=!!e;let L;s==="sync"?L=R:s==="post"?L=()=>Fe(R,c&&c.suspense):(R.pre=!0,c&&(R.id=c.uid),L=()=>Ki(R));const $=new Mi(l,L);e?t?R():x=$.run():s==="post"?Fe($.run.bind($),c&&c.suspense):$.run();const Y=()=>{$.stop(),c&&c.scope&&Oi(c.scope.effects,$)};return A&&A.push(Y),Y}function bf(n,e,t){const r=this.proxy,s=we(n)?n.includes(".")?vc(r,n):()=>r[n]:n.bind(r,r);let i;W(e)?i=e:(i=e.handler,t=e);const o=Ee;Hn(this);const a=yc(s,i.bind(r),t);return o?Hn(o):kn(),a}function vc(n,e){const t=e.split(".");return()=>{let r=n;for(let s=0;s<t.length&&r;s++)r=r[t[s]];return r}}function wn(n,e){if(!le(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),Re(n))wn(n.value,e);else if(j(n))for(let t=0;t<n.length;t++)wn(n[t],e);else if(ja(n)||Un(n))n.forEach(t=>{wn(t,e)});else if(Wa(n))for(const t in n)wn(n[t],e);return n}function _o(n,e){const t=st;if(t===null)return n;const r=_s(t)||t.proxy,s=n.dirs||(n.dirs=[]);for(let i=0;i<e.length;i++){let[o,a,c,l=ae]=e[i];o&&(W(o)&&(o={mounted:o,updated:o}),o.deep&&wn(a),s.push({dir:o,instance:r,value:a,oldValue:void 0,arg:c,modifiers:l}))}return n}function gn(n,e,t,r){const s=n.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let c=a.dir[r];c&&(nr(),ct(c,t,8,[n.el,a,n,e]),rr())}}const rs=n=>!!n.type.__asyncLoader,Tc=n=>n.type.__isKeepAlive;function Af(n,e){wc(n,"a",e)}function If(n,e){wc(n,"da",e)}function wc(n,e,t=Ee){const r=n.__wdc||(n.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return n()});if(Ps(e,r,t),t){let s=t.parent;for(;s&&s.parent;)Tc(s.parent.vnode)&&Sf(r,e,t,s),s=s.parent}}function Sf(n,e,t,r){const s=Ps(e,n,r,!0);bc(()=>{Oi(r[e],s)},t)}function Ps(n,e,t=Ee,r=!1){if(t){const s=t[n]||(t[n]=[]),i=e.__weh||(e.__weh=(...o)=>{if(t.isUnmounted)return;nr(),Hn(t);const a=ct(e,t,n,o);return kn(),rr(),a});return r?s.unshift(i):s.push(i),i}}const Vt=n=>(e,t=Ee)=>(!Ir||n==="sp")&&Ps(n,(...r)=>e(...r),t),kf=Vt("bm"),Ef=Vt("m"),xf=Vt("bu"),Nf=Vt("u"),Cf=Vt("bum"),bc=Vt("um"),Of=Vt("sp"),Pf=Vt("rtg"),Df=Vt("rtc");function Rf(n,e=Ee){Ps("ec",n,e)}const _f=Symbol.for("v-ndc");function Fo(n,e,t,r){let s;const i=t;if(j(n)||we(n)){s=new Array(n.length);for(let o=0,a=n.length;o<a;o++)s[o]=e(n[o],o,void 0,i)}else if(typeof n=="number"){s=new Array(n);for(let o=0;o<n;o++)s[o]=e(o+1,o,void 0,i)}else if(le(n))if(n[Symbol.iterator])s=Array.from(n,(o,a)=>e(o,a,void 0,i));else{const o=Object.keys(n);s=new Array(o.length);for(let a=0,c=o.length;a<c;a++){const l=o[a];s[a]=e(n[l],l,a,i)}}else s=[];return s}const gi=n=>n?Dc(n)?_s(n)||n.proxy:gi(n.parent):null,fr=Ae(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>gi(n.parent),$root:n=>gi(n.root),$emit:n=>n.emit,$options:n=>Vi(n),$forceUpdate:n=>n.f||(n.f=()=>Ki(n.update)),$nextTick:n=>n.n||(n.n=cf.bind(n.proxy)),$watch:n=>bf.bind(n)}),Hs=(n,e)=>n!==ae&&!n.__isScriptSetup&&X(n,e),Ff={get({_:n},e){const{ctx:t,setupState:r,data:s,props:i,accessCache:o,type:a,appContext:c}=n;let l;if(e[0]!=="$"){const d=o[e];if(d!==void 0)switch(d){case 1:return r[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(Hs(r,e))return o[e]=1,r[e];if(s!==ae&&X(s,e))return o[e]=2,s[e];if((l=n.propsOptions[0])&&X(l,e))return o[e]=3,i[e];if(t!==ae&&X(t,e))return o[e]=4,t[e];mi&&(o[e]=0)}}const u=fr[e];let g,v;if(u)return e==="$attrs"&&Ue(n,"get",e),u(n);if((g=a.__cssModules)&&(g=g[e]))return g;if(t!==ae&&X(t,e))return o[e]=4,t[e];if(v=c.config.globalProperties,X(v,e))return v[e]},set({_:n},e,t){const{data:r,setupState:s,ctx:i}=n;return Hs(s,e)?(s[e]=t,!0):r!==ae&&X(r,e)?(r[e]=t,!0):X(n.props,e)||e[0]==="$"&&e.slice(1)in n?!1:(i[e]=t,!0)},has({_:{data:n,setupState:e,accessCache:t,ctx:r,appContext:s,propsOptions:i}},o){let a;return!!t[o]||n!==ae&&X(n,o)||Hs(e,o)||(a=i[0])&&X(a,o)||X(r,o)||X(fr,o)||X(s.config.globalProperties,o)},defineProperty(n,e,t){return t.get!=null?n._.accessCache[e]=0:X(t,"value")&&this.set(n,e,t.value,null),Reflect.defineProperty(n,e,t)}};function Mo(n){return j(n)?n.reduce((e,t)=>(e[t]=null,e),{}):n}let mi=!0;function Mf(n){const e=Vi(n),t=n.proxy,r=n.ctx;mi=!1,e.beforeCreate&&Bo(e.beforeCreate,n,"bc");const{data:s,computed:i,methods:o,watch:a,provide:c,inject:l,created:u,beforeMount:g,mounted:v,beforeUpdate:d,updated:A,activated:x,deactivated:R,beforeDestroy:L,beforeUnmount:$,destroyed:Y,unmounted:P,render:H,renderTracked:Q,renderTriggered:oe,errorCaptured:Ie,serverPrefetch:Qe,expose:Ve,inheritAttrs:fn,components:Lr,directives:$r,filters:js}=e;if(l&&Bf(l,r,null),o)for(const ue in o){const se=o[ue];W(se)&&(r[ue]=se.bind(t))}if(s){const ue=s.call(t,t);le(ue)&&(n.data=Ui(ue))}if(mi=!0,i)for(const ue in i){const se=i[ue],hn=W(se)?se.bind(t,t):W(se.get)?se.get.bind(t,t):Ct,Ur=!W(se)&&W(se.set)?se.set.bind(t):Ct,dn=dh({get:hn,set:Ur});Object.defineProperty(r,ue,{enumerable:!0,configurable:!0,get:()=>dn.value,set:dt=>dn.value=dt})}if(a)for(const ue in a)Ac(a[ue],r,t,ue);if(c){const ue=W(c)?c.call(t):c;Reflect.ownKeys(ue).forEach(se=>{zf(se,ue[se])})}u&&Bo(u,n,"c");function Ne(ue,se){j(se)?se.forEach(hn=>ue(hn.bind(t))):se&&ue(se.bind(t))}if(Ne(kf,g),Ne(Ef,v),Ne(xf,d),Ne(Nf,A),Ne(Af,x),Ne(If,R),Ne(Rf,Ie),Ne(Df,Q),Ne(Pf,oe),Ne(Cf,$),Ne(bc,P),Ne(Of,Qe),j(Ve))if(Ve.length){const ue=n.exposed||(n.exposed={});Ve.forEach(se=>{Object.defineProperty(ue,se,{get:()=>t[se],set:hn=>t[se]=hn})})}else n.exposed||(n.exposed={});H&&n.render===Ct&&(n.render=H),fn!=null&&(n.inheritAttrs=fn),Lr&&(n.components=Lr),$r&&(n.directives=$r)}function Bf(n,e,t=Ct){j(n)&&(n=pi(n));for(const r in n){const s=n[r];let i;le(s)?"default"in s?i=ss(s.from||r,s.default,!0):i=ss(s.from||r):i=ss(s),Re(i)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[r]=i}}function Bo(n,e,t){ct(j(n)?n.map(r=>r.bind(e.proxy)):n.bind(e.proxy),e,t)}function Ac(n,e,t,r){const s=r.includes(".")?vc(t,r):()=>t[r];if(we(n)){const i=e[n];W(i)&&Ws(s,i)}else if(W(n))Ws(s,n.bind(t));else if(le(n))if(j(n))n.forEach(i=>Ac(i,e,t,r));else{const i=W(n.handler)?n.handler.bind(t):e[n.handler];W(i)&&Ws(s,i,n)}}function Vi(n){const e=n.type,{mixins:t,extends:r}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=n.appContext,a=i.get(e);let c;return a?c=a:!s.length&&!t&&!r?c=e:(c={},s.length&&s.forEach(l=>ps(c,l,o,!0)),ps(c,e,o)),le(e)&&i.set(e,c),c}function ps(n,e,t,r=!1){const{mixins:s,extends:i}=e;i&&ps(n,i,t,!0),s&&s.forEach(o=>ps(n,o,t,!0));for(const o in e)if(!(r&&o==="expose")){const a=Lf[o]||t&&t[o];n[o]=a?a(n[o],e[o]):e[o]}return n}const Lf={data:Lo,props:$o,emits:$o,methods:ur,computed:ur,beforeCreate:Ce,created:Ce,beforeMount:Ce,mounted:Ce,beforeUpdate:Ce,updated:Ce,beforeDestroy:Ce,beforeUnmount:Ce,destroyed:Ce,unmounted:Ce,activated:Ce,deactivated:Ce,errorCaptured:Ce,serverPrefetch:Ce,components:ur,directives:ur,watch:Uf,provide:Lo,inject:$f};function Lo(n,e){return e?n?function(){return Ae(W(n)?n.call(this,this):n,W(e)?e.call(this,this):e)}:e:n}function $f(n,e){return ur(pi(n),pi(e))}function pi(n){if(j(n)){const e={};for(let t=0;t<n.length;t++)e[n[t]]=n[t];return e}return n}function Ce(n,e){return n?[...new Set([].concat(n,e))]:e}function ur(n,e){return n?Ae(Object.create(null),n,e):e}function $o(n,e){return n?j(n)&&j(e)?[...new Set([...n,...e])]:Ae(Object.create(null),Mo(n),Mo(e??{})):e}function Uf(n,e){if(!n)return e;if(!e)return n;const t=Ae(Object.create(null),n);for(const r in e)t[r]=Ce(n[r],e[r]);return t}function Ic(){return{app:null,config:{isNativeTag:hu,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Jf=0;function qf(n,e){return function(r,s=null){W(r)||(r=Ae({},r)),s!=null&&!le(s)&&(s=null);const i=Ic(),o=new Set;let a=!1;const c=i.app={_uid:Jf++,_component:r,_props:s,_container:null,_context:i,_instance:null,version:ph,get config(){return i.config},set config(l){},use(l,...u){return o.has(l)||(l&&W(l.install)?(o.add(l),l.install(c,...u)):W(l)&&(o.add(l),l(c,...u))),c},mixin(l){return i.mixins.includes(l)||i.mixins.push(l),c},component(l,u){return u?(i.components[l]=u,c):i.components[l]},directive(l,u){return u?(i.directives[l]=u,c):i.directives[l]},mount(l,u,g){if(!a){const v=Sn(r,s);return v.appContext=i,u&&e?e(v,l):n(v,l,g),a=!0,c._container=l,l.__vue_app__=c,_s(v.component)||v.component.proxy}},unmount(){a&&(n(null,c._container),delete c._container.__vue_app__)},provide(l,u){return i.provides[l]=u,c},runWithContext(l){ys=c;try{return l()}finally{ys=null}}};return c}}let ys=null;function zf(n,e){if(Ee){let t=Ee.provides;const r=Ee.parent&&Ee.parent.provides;r===t&&(t=Ee.provides=Object.create(r)),t[n]=e}}function ss(n,e,t=!1){const r=Ee||st;if(r||ys){const s=r?r.parent==null?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides:ys._context.provides;if(s&&n in s)return s[n];if(arguments.length>1)return t&&W(e)?e.call(r&&r.proxy):e}}function jf(n,e,t,r=!1){const s={},i={};gs(i,Rs,1),n.propsDefaults=Object.create(null),Sc(n,e,s,i);for(const o in n.propsOptions[0])o in s||(s[o]=void 0);t?n.props=r?s:Qu(s):n.type.props?n.props=s:n.props=i,n.attrs=i}function Kf(n,e,t,r){const{props:s,attrs:i,vnode:{patchFlag:o}}=n,a=te(s),[c]=n.propsOptions;let l=!1;if((r||o>0)&&!(o&16)){if(o&8){const u=n.vnode.dynamicProps;for(let g=0;g<u.length;g++){let v=u[g];if(Os(n.emitsOptions,v))continue;const d=e[v];if(c)if(X(i,v))d!==i[v]&&(i[v]=d,l=!0);else{const A=Vn(v);s[A]=yi(c,a,A,d,n,!1)}else d!==i[v]&&(i[v]=d,l=!0)}}}else{Sc(n,e,s,i)&&(l=!0);let u;for(const g in a)(!e||!X(e,g)&&((u=Cn(g))===g||!X(e,u)))&&(c?t&&(t[g]!==void 0||t[u]!==void 0)&&(s[g]=yi(c,a,g,void 0,n,!0)):delete s[g]);if(i!==a)for(const g in i)(!e||!X(e,g))&&(delete i[g],l=!0)}l&&jt(n,"set","$attrs")}function Sc(n,e,t,r){const[s,i]=n.propsOptions;let o=!1,a;if(e)for(let c in e){if(ts(c))continue;const l=e[c];let u;s&&X(s,u=Vn(c))?!i||!i.includes(u)?t[u]=l:(a||(a={}))[u]=l:Os(n.emitsOptions,c)||(!(c in r)||l!==r[c])&&(r[c]=l,o=!0)}if(i){const c=te(t),l=a||ae;for(let u=0;u<i.length;u++){const g=i[u];t[g]=yi(s,c,g,l[g],n,!X(l,g))}}return o}function yi(n,e,t,r,s,i){const o=n[t];if(o!=null){const a=X(o,"default");if(a&&r===void 0){const c=o.default;if(o.type!==Function&&!o.skipFactory&&W(c)){const{propsDefaults:l}=s;t in l?r=l[t]:(Hn(s),r=l[t]=c.call(null,e),kn())}else r=c}o[0]&&(i&&!a?r=!1:o[1]&&(r===""||r===Cn(t))&&(r=!0))}return r}function kc(n,e,t=!1){const r=e.propsCache,s=r.get(n);if(s)return s;const i=n.props,o={},a=[];let c=!1;if(!W(n)){const u=g=>{c=!0;const[v,d]=kc(g,e,!0);Ae(o,v),d&&a.push(...d)};!t&&e.mixins.length&&e.mixins.forEach(u),n.extends&&u(n.extends),n.mixins&&n.mixins.forEach(u)}if(!i&&!c)return le(n)&&r.set(n,$n),$n;if(j(i))for(let u=0;u<i.length;u++){const g=Vn(i[u]);Uo(g)&&(o[g]=ae)}else if(i)for(const u in i){const g=Vn(u);if(Uo(g)){const v=i[u],d=o[g]=j(v)||W(v)?{type:v}:Ae({},v);if(d){const A=zo(Boolean,d.type),x=zo(String,d.type);d[0]=A>-1,d[1]=x<0||A<x,(A>-1||X(d,"default"))&&a.push(g)}}}const l=[o,a];return le(n)&&r.set(n,l),l}function Uo(n){return n[0]!=="$"}function Jo(n){const e=n&&n.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:n===null?"null":""}function qo(n,e){return Jo(n)===Jo(e)}function zo(n,e){return j(e)?e.findIndex(t=>qo(t,n)):W(e)&&qo(e,n)?0:-1}const Ec=n=>n[0]==="_"||n==="$stable",Wi=n=>j(n)?n.map(yt):[yt(n)],Vf=(n,e,t)=>{if(e._n)return e;const r=gf((...s)=>Wi(e(...s)),t);return r._c=!1,r},xc=(n,e,t)=>{const r=n._ctx;for(const s in n){if(Ec(s))continue;const i=n[s];if(W(i))e[s]=Vf(s,i,r);else if(i!=null){const o=Wi(i);e[s]=()=>o}}},Nc=(n,e)=>{const t=Wi(e);n.slots.default=()=>t},Wf=(n,e)=>{if(n.vnode.shapeFlag&32){const t=e._;t?(n.slots=te(e),gs(e,"_",t)):xc(e,n.slots={})}else n.slots={},e&&Nc(n,e);gs(n.slots,Rs,1)},Hf=(n,e,t)=>{const{vnode:r,slots:s}=n;let i=!0,o=ae;if(r.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:(Ae(s,e),!t&&a===1&&delete s._):(i=!e.$stable,xc(e,s)),o=e}else e&&(Nc(n,e),o={default:1});if(i)for(const a in s)!Ec(a)&&!(a in o)&&delete s[a]};function vi(n,e,t,r,s=!1){if(j(n)){n.forEach((v,d)=>vi(v,e&&(j(e)?e[d]:e),t,r,s));return}if(rs(r)&&!s)return;const i=r.shapeFlag&4?_s(r.component)||r.component.proxy:r.el,o=s?null:i,{i:a,r:c}=n,l=e&&e.r,u=a.refs===ae?a.refs={}:a.refs,g=a.setupState;if(l!=null&&l!==c&&(we(l)?(u[l]=null,X(g,l)&&(g[l]=null)):Re(l)&&(l.value=null)),W(c))rn(c,a,12,[o,u]);else{const v=we(c),d=Re(c);if(v||d){const A=()=>{if(n.f){const x=v?X(g,c)?g[c]:u[c]:c.value;s?j(x)&&Oi(x,i):j(x)?x.includes(i)||x.push(i):v?(u[c]=[i],X(g,c)&&(g[c]=u[c])):(c.value=[i],n.k&&(u[n.k]=c.value))}else v?(u[c]=o,X(g,c)&&(g[c]=o)):d&&(c.value=o,n.k&&(u[n.k]=o))};o?(A.id=-1,Fe(A,t)):A()}}}const Fe=wf;function Gf(n){return Yf(n)}function Yf(n,e){const t=ai();t.__VUE__=!0;const{insert:r,remove:s,patchProp:i,createElement:o,createText:a,createComment:c,setText:l,setElementText:u,parentNode:g,nextSibling:v,setScopeId:d=Ct,insertStaticContent:A}=n,x=(f,m,b,S=null,I=null,C=null,D=!1,N=null,O=!!m.dynamicChildren)=>{if(f===m)return;f&&!or(f,m)&&(S=Jr(f),dt(f,I,C,!0),f=null),m.patchFlag===-2&&(O=!1,m.dynamicChildren=null);const{type:k,ref:U,shapeFlag:_}=m;switch(k){case Ds:R(f,m,b,S);break;case br:L(f,m,b,S);break;case Gs:f==null&&$(m,b,S,D);break;case We:Lr(f,m,b,S,I,C,D,N,O);break;default:_&1?H(f,m,b,S,I,C,D,N,O):_&6?$r(f,m,b,S,I,C,D,N,O):(_&64||_&128)&&k.process(f,m,b,S,I,C,D,N,O,sr)}U!=null&&I&&vi(U,f&&f.ref,C,m||f,!m)},R=(f,m,b,S)=>{if(f==null)r(m.el=a(m.children),b,S);else{const I=m.el=f.el;m.children!==f.children&&l(I,m.children)}},L=(f,m,b,S)=>{f==null?r(m.el=c(m.children||""),b,S):m.el=f.el},$=(f,m,b,S)=>{[f.el,f.anchor]=A(f.children,m,b,S,f.el,f.anchor)},Y=({el:f,anchor:m},b,S)=>{let I;for(;f&&f!==m;)I=v(f),r(f,b,S),f=I;r(m,b,S)},P=({el:f,anchor:m})=>{let b;for(;f&&f!==m;)b=v(f),s(f),f=b;s(m)},H=(f,m,b,S,I,C,D,N,O)=>{D=D||m.type==="svg",f==null?Q(m,b,S,I,C,D,N,O):Qe(f,m,I,C,D,N,O)},Q=(f,m,b,S,I,C,D,N)=>{let O,k;const{type:U,props:_,shapeFlag:J,transition:K,dirs:G}=f;if(O=f.el=o(f.type,C,_&&_.is,_),J&8?u(O,f.children):J&16&&Ie(f.children,O,null,S,I,C&&U!=="foreignObject",D,N),G&&gn(f,null,S,"created"),oe(O,f,f.scopeId,D,S),_){for(const ne in _)ne!=="value"&&!ts(ne)&&i(O,ne,null,_[ne],C,f.children,S,I,Dt);"value"in _&&i(O,"value",null,_.value),(k=_.onVnodeBeforeMount)&&mt(k,S,f)}G&&gn(f,null,S,"beforeMount");const ie=(!I||I&&!I.pendingBranch)&&K&&!K.persisted;ie&&K.beforeEnter(O),r(O,m,b),((k=_&&_.onVnodeMounted)||ie||G)&&Fe(()=>{k&&mt(k,S,f),ie&&K.enter(O),G&&gn(f,null,S,"mounted")},I)},oe=(f,m,b,S,I)=>{if(b&&d(f,b),S)for(let C=0;C<S.length;C++)d(f,S[C]);if(I){let C=I.subTree;if(m===C){const D=I.vnode;oe(f,D,D.scopeId,D.slotScopeIds,I.parent)}}},Ie=(f,m,b,S,I,C,D,N,O=0)=>{for(let k=O;k<f.length;k++){const U=f[k]=N?Qt(f[k]):yt(f[k]);x(null,U,m,b,S,I,C,D,N)}},Qe=(f,m,b,S,I,C,D)=>{const N=m.el=f.el;let{patchFlag:O,dynamicChildren:k,dirs:U}=m;O|=f.patchFlag&16;const _=f.props||ae,J=m.props||ae;let K;b&&mn(b,!1),(K=J.onVnodeBeforeUpdate)&&mt(K,b,m,f),U&&gn(m,f,b,"beforeUpdate"),b&&mn(b,!0);const G=I&&m.type!=="foreignObject";if(k?Ve(f.dynamicChildren,k,N,b,S,G,C):D||se(f,m,N,null,b,S,G,C,!1),O>0){if(O&16)fn(N,m,_,J,b,S,I);else if(O&2&&_.class!==J.class&&i(N,"class",null,J.class,I),O&4&&i(N,"style",_.style,J.style,I),O&8){const ie=m.dynamicProps;for(let ne=0;ne<ie.length;ne++){const ge=ie[ne],et=_[ge],Pn=J[ge];(Pn!==et||ge==="value")&&i(N,ge,et,Pn,I,f.children,b,S,Dt)}}O&1&&f.children!==m.children&&u(N,m.children)}else!D&&k==null&&fn(N,m,_,J,b,S,I);((K=J.onVnodeUpdated)||U)&&Fe(()=>{K&&mt(K,b,m,f),U&&gn(m,f,b,"updated")},S)},Ve=(f,m,b,S,I,C,D)=>{for(let N=0;N<m.length;N++){const O=f[N],k=m[N],U=O.el&&(O.type===We||!or(O,k)||O.shapeFlag&70)?g(O.el):b;x(O,k,U,null,S,I,C,D,!0)}},fn=(f,m,b,S,I,C,D)=>{if(b!==S){if(b!==ae)for(const N in b)!ts(N)&&!(N in S)&&i(f,N,b[N],null,D,m.children,I,C,Dt);for(const N in S){if(ts(N))continue;const O=S[N],k=b[N];O!==k&&N!=="value"&&i(f,N,k,O,D,m.children,I,C,Dt)}"value"in S&&i(f,"value",b.value,S.value)}},Lr=(f,m,b,S,I,C,D,N,O)=>{const k=m.el=f?f.el:a(""),U=m.anchor=f?f.anchor:a("");let{patchFlag:_,dynamicChildren:J,slotScopeIds:K}=m;K&&(N=N?N.concat(K):K),f==null?(r(k,b,S),r(U,b,S),Ie(m.children,b,U,I,C,D,N,O)):_>0&&_&64&&J&&f.dynamicChildren?(Ve(f.dynamicChildren,J,b,I,C,D,N),(m.key!=null||I&&m===I.subTree)&&Cc(f,m,!0)):se(f,m,b,U,I,C,D,N,O)},$r=(f,m,b,S,I,C,D,N,O)=>{m.slotScopeIds=N,f==null?m.shapeFlag&512?I.ctx.activate(m,b,S,D,O):js(m,b,S,I,C,D,O):mo(f,m,O)},js=(f,m,b,S,I,C,D)=>{const N=f.component=ah(f,S,I);if(Tc(f)&&(N.ctx.renderer=sr),ch(N),N.asyncDep){if(I&&I.registerDep(N,Ne),!f.el){const O=N.subTree=Sn(br);L(null,O,m,b)}return}Ne(N,f,m,b,I,C,D)},mo=(f,m,b)=>{const S=m.component=f.component;if(yf(f,m,b))if(S.asyncDep&&!S.asyncResolved){ue(S,m,b);return}else S.next=m,uf(S.update),S.update();else m.el=f.el,S.vnode=m},Ne=(f,m,b,S,I,C,D)=>{const N=()=>{if(f.isMounted){let{next:U,bu:_,u:J,parent:K,vnode:G}=f,ie=U,ne;mn(f,!1),U?(U.el=G.el,ue(f,U,D)):U=G,_&&ns(_),(ne=U.props&&U.props.onVnodeBeforeUpdate)&&mt(ne,K,U,G),mn(f,!0);const ge=Vs(f),et=f.subTree;f.subTree=ge,x(et,ge,g(et.el),Jr(et),f,I,C),U.el=ge.el,ie===null&&vf(f,ge.el),J&&Fe(J,I),(ne=U.props&&U.props.onVnodeUpdated)&&Fe(()=>mt(ne,K,U,G),I)}else{let U;const{el:_,props:J}=m,{bm:K,m:G,parent:ie}=f,ne=rs(m);if(mn(f,!1),K&&ns(K),!ne&&(U=J&&J.onVnodeBeforeMount)&&mt(U,ie,m),mn(f,!0),_&&To){const ge=()=>{f.subTree=Vs(f),To(_,f.subTree,f,I,null)};ne?m.type.__asyncLoader().then(()=>!f.isUnmounted&&ge()):ge()}else{const ge=f.subTree=Vs(f);x(null,ge,b,S,f,I,C),m.el=ge.el}if(G&&Fe(G,I),!ne&&(U=J&&J.onVnodeMounted)){const ge=m;Fe(()=>mt(U,ie,ge),I)}(m.shapeFlag&256||ie&&rs(ie.vnode)&&ie.vnode.shapeFlag&256)&&f.a&&Fe(f.a,I),f.isMounted=!0,m=b=S=null}},O=f.effect=new Mi(N,()=>Ki(k),f.scope),k=f.update=()=>O.run();k.id=f.uid,mn(f,!0),k()},ue=(f,m,b)=>{m.component=f;const S=f.vnode.props;f.vnode=m,f.next=null,Kf(f,m.props,S,b),Hf(f,m.children,b),nr(),Do(),rr()},se=(f,m,b,S,I,C,D,N,O=!1)=>{const k=f&&f.children,U=f?f.shapeFlag:0,_=m.children,{patchFlag:J,shapeFlag:K}=m;if(J>0){if(J&128){Ur(k,_,b,S,I,C,D,N,O);return}else if(J&256){hn(k,_,b,S,I,C,D,N,O);return}}K&8?(U&16&&Dt(k,I,C),_!==k&&u(b,_)):U&16?K&16?Ur(k,_,b,S,I,C,D,N,O):Dt(k,I,C,!0):(U&8&&u(b,""),K&16&&Ie(_,b,S,I,C,D,N,O))},hn=(f,m,b,S,I,C,D,N,O)=>{f=f||$n,m=m||$n;const k=f.length,U=m.length,_=Math.min(k,U);let J;for(J=0;J<_;J++){const K=m[J]=O?Qt(m[J]):yt(m[J]);x(f[J],K,b,null,I,C,D,N,O)}k>U?Dt(f,I,C,!0,!1,_):Ie(m,b,S,I,C,D,N,O,_)},Ur=(f,m,b,S,I,C,D,N,O)=>{let k=0;const U=m.length;let _=f.length-1,J=U-1;for(;k<=_&&k<=J;){const K=f[k],G=m[k]=O?Qt(m[k]):yt(m[k]);if(or(K,G))x(K,G,b,null,I,C,D,N,O);else break;k++}for(;k<=_&&k<=J;){const K=f[_],G=m[J]=O?Qt(m[J]):yt(m[J]);if(or(K,G))x(K,G,b,null,I,C,D,N,O);else break;_--,J--}if(k>_){if(k<=J){const K=J+1,G=K<U?m[K].el:S;for(;k<=J;)x(null,m[k]=O?Qt(m[k]):yt(m[k]),b,G,I,C,D,N,O),k++}}else if(k>J)for(;k<=_;)dt(f[k],I,C,!0),k++;else{const K=k,G=k,ie=new Map;for(k=G;k<=J;k++){const Je=m[k]=O?Qt(m[k]):yt(m[k]);Je.key!=null&&ie.set(Je.key,k)}let ne,ge=0;const et=J-G+1;let Pn=!1,wo=0;const ir=new Array(et);for(k=0;k<et;k++)ir[k]=0;for(k=K;k<=_;k++){const Je=f[k];if(ge>=et){dt(Je,I,C,!0);continue}let gt;if(Je.key!=null)gt=ie.get(Je.key);else for(ne=G;ne<=J;ne++)if(ir[ne-G]===0&&or(Je,m[ne])){gt=ne;break}gt===void 0?dt(Je,I,C,!0):(ir[gt-G]=k+1,gt>=wo?wo=gt:Pn=!0,x(Je,m[gt],b,null,I,C,D,N,O),ge++)}const bo=Pn?Xf(ir):$n;for(ne=bo.length-1,k=et-1;k>=0;k--){const Je=G+k,gt=m[Je],Ao=Je+1<U?m[Je+1].el:S;ir[k]===0?x(null,gt,b,Ao,I,C,D,N,O):Pn&&(ne<0||k!==bo[ne]?dn(gt,b,Ao,2):ne--)}}},dn=(f,m,b,S,I=null)=>{const{el:C,type:D,transition:N,children:O,shapeFlag:k}=f;if(k&6){dn(f.component.subTree,m,b,S);return}if(k&128){f.suspense.move(m,b,S);return}if(k&64){D.move(f,m,b,sr);return}if(D===We){r(C,m,b);for(let _=0;_<O.length;_++)dn(O[_],m,b,S);r(f.anchor,m,b);return}if(D===Gs){Y(f,m,b);return}if(S!==2&&k&1&&N)if(S===0)N.beforeEnter(C),r(C,m,b),Fe(()=>N.enter(C),I);else{const{leave:_,delayLeave:J,afterLeave:K}=N,G=()=>r(C,m,b),ie=()=>{_(C,()=>{G(),K&&K()})};J?J(C,G,ie):ie()}else r(C,m,b)},dt=(f,m,b,S=!1,I=!1)=>{const{type:C,props:D,ref:N,children:O,dynamicChildren:k,shapeFlag:U,patchFlag:_,dirs:J}=f;if(N!=null&&vi(N,null,b,f,!0),U&256){m.ctx.deactivate(f);return}const K=U&1&&J,G=!rs(f);let ie;if(G&&(ie=D&&D.onVnodeBeforeUnmount)&&mt(ie,m,f),U&6)lu(f.component,b,S);else{if(U&128){f.suspense.unmount(b,S);return}K&&gn(f,null,m,"beforeUnmount"),U&64?f.type.remove(f,m,b,I,sr,S):k&&(C!==We||_>0&&_&64)?Dt(k,m,b,!1,!0):(C===We&&_&384||!I&&U&16)&&Dt(O,m,b),S&&po(f)}(G&&(ie=D&&D.onVnodeUnmounted)||K)&&Fe(()=>{ie&&mt(ie,m,f),K&&gn(f,null,m,"unmounted")},b)},po=f=>{const{type:m,el:b,anchor:S,transition:I}=f;if(m===We){cu(b,S);return}if(m===Gs){P(f);return}const C=()=>{s(b),I&&!I.persisted&&I.afterLeave&&I.afterLeave()};if(f.shapeFlag&1&&I&&!I.persisted){const{leave:D,delayLeave:N}=I,O=()=>D(b,C);N?N(f.el,C,O):O()}else C()},cu=(f,m)=>{let b;for(;f!==m;)b=v(f),s(f),f=b;s(m)},lu=(f,m,b)=>{const{bum:S,scope:I,update:C,subTree:D,um:N}=f;S&&ns(S),I.stop(),C&&(C.active=!1,dt(D,f,m,b)),N&&Fe(N,m),Fe(()=>{f.isUnmounted=!0},m),m&&m.pendingBranch&&!m.isUnmounted&&f.asyncDep&&!f.asyncResolved&&f.suspenseId===m.pendingId&&(m.deps--,m.deps===0&&m.resolve())},Dt=(f,m,b,S=!1,I=!1,C=0)=>{for(let D=C;D<f.length;D++)dt(f[D],m,b,S,I)},Jr=f=>f.shapeFlag&6?Jr(f.component.subTree):f.shapeFlag&128?f.suspense.next():v(f.anchor||f.el),yo=(f,m,b)=>{f==null?m._vnode&&dt(m._vnode,null,null,!0):x(m._vnode||null,f,m,null,null,null,b),Do(),dc(),m._vnode=f},sr={p:x,um:dt,m:dn,r:po,mt:js,mc:Ie,pc:se,pbc:Ve,n:Jr,o:n};let vo,To;return{render:yo,hydrate:vo,createApp:qf(yo,vo)}}function mn({effect:n,update:e},t){n.allowRecurse=e.allowRecurse=t}function Cc(n,e,t=!1){const r=n.children,s=e.children;if(j(r)&&j(s))for(let i=0;i<r.length;i++){const o=r[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=Qt(s[i]),a.el=o.el),t||Cc(o,a)),a.type===Ds&&(a.el=o.el)}}function Xf(n){const e=n.slice(),t=[0];let r,s,i,o,a;const c=n.length;for(r=0;r<c;r++){const l=n[r];if(l!==0){if(s=t[t.length-1],n[s]<l){e[r]=s,t.push(r);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,n[t[a]]<l?i=a+1:o=a;l<n[t[i]]&&(i>0&&(e[r]=t[i-1]),t[i]=r)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}const Zf=n=>n.__isTeleport,We=Symbol.for("v-fgt"),Ds=Symbol.for("v-txt"),br=Symbol.for("v-cmt"),Gs=Symbol.for("v-stc"),hr=[];let it=null;function Rt(n=!1){hr.push(it=n?null:[])}function Qf(){hr.pop(),it=hr[hr.length-1]||null}let Ar=1;function jo(n){Ar+=n}function eh(n){return n.dynamicChildren=Ar>0?it||$n:null,Qf(),Ar>0&&it&&it.push(n),n}function _t(n,e,t,r,s,i){return eh(Oe(n,e,t,r,s,i,!0))}function th(n){return n?n.__v_isVNode===!0:!1}function or(n,e){return n.type===e.type&&n.key===e.key}const Rs="__vInternal",Oc=({key:n})=>n??null,is=({ref:n,ref_key:e,ref_for:t})=>(typeof n=="number"&&(n=""+n),n!=null?we(n)||Re(n)||W(n)?{i:st,r:n,k:e,f:!!t}:n:null);function Oe(n,e=null,t=null,r=0,s=null,i=n===We?0:1,o=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:n,props:e,key:e&&Oc(e),ref:e&&is(e),scopeId:pc,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:st};return a?(Hi(c,t),i&128&&n.normalize(c)):t&&(c.shapeFlag|=we(t)?8:16),Ar>0&&!o&&it&&(c.patchFlag>0||i&6)&&c.patchFlag!==32&&it.push(c),c}const Sn=nh;function nh(n,e=null,t=null,r=0,s=null,i=!1){if((!n||n===_f)&&(n=br),th(n)){const a=Wn(n,e,!0);return t&&Hi(a,t),Ar>0&&!i&&it&&(a.shapeFlag&6?it[it.indexOf(n)]=a:it.push(a)),a.patchFlag|=-2,a}if(hh(n)&&(n=n.__vccOpts),e){e=rh(e);let{class:a,style:c}=e;a&&!we(a)&&(e.class=_i(a)),le(c)&&(cc(c)&&!j(c)&&(c=Ae({},c)),e.style=Ri(c))}const o=we(n)?1:Tf(n)?128:Zf(n)?64:le(n)?4:W(n)?2:0;return Oe(n,e,t,r,s,o,i,!0)}function rh(n){return n?cc(n)||Rs in n?Ae({},n):n:null}function Wn(n,e,t=!1){const{props:r,ref:s,patchFlag:i,children:o}=n,a=e?sh(r||{},e):r;return{__v_isVNode:!0,__v_skip:!0,type:n.type,props:a,key:a&&Oc(a),ref:e&&e.ref?t&&s?j(s)?s.concat(is(e)):[s,is(e)]:is(e):s,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:o,target:n.target,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:e&&n.type!==We?i===-1?16:i|16:i,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:n.transition,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Wn(n.ssContent),ssFallback:n.ssFallback&&Wn(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce}}function Pc(n=" ",e=0){return Sn(Ds,null,n,e)}function yt(n){return n==null||typeof n=="boolean"?Sn(br):j(n)?Sn(We,null,n.slice()):typeof n=="object"?Qt(n):Sn(Ds,null,String(n))}function Qt(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Wn(n)}function Hi(n,e){let t=0;const{shapeFlag:r}=n;if(e==null)e=null;else if(j(e))t=16;else if(typeof e=="object")if(r&65){const s=e.default;s&&(s._c&&(s._d=!1),Hi(n,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!(Rs in e)?e._ctx=st:s===3&&st&&(st.slots._===1?e._=1:(e._=2,n.patchFlag|=1024))}else W(e)?(e={default:e,_ctx:st},t=32):(e=String(e),r&64?(t=16,e=[Pc(e)]):t=8);n.children=e,n.shapeFlag|=t}function sh(...n){const e={};for(let t=0;t<n.length;t++){const r=n[t];for(const s in r)if(s==="class")e.class!==r.class&&(e.class=_i([e.class,r.class]));else if(s==="style")e.style=Ri([e.style,r.style]);else if(ks(s)){const i=e[s],o=r[s];o&&i!==o&&!(j(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=r[s])}return e}function mt(n,e,t,r=null){ct(n,e,7,[t,r])}const ih=Ic();let oh=0;function ah(n,e,t){const r=n.type,s=(e?e.appContext:n.appContext)||ih,i={uid:oh++,vnode:n,type:r,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new Su(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:kc(r,s),emitsOptions:mc(r,s),emit:null,emitted:null,propsDefaults:ae,inheritAttrs:r.inheritAttrs,ctx:ae,data:ae,props:ae,attrs:ae,slots:ae,refs:ae,setupState:ae,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=df.bind(null,i),n.ce&&n.ce(i),i}let Ee=null,Gi,Dn,Ko="__VUE_INSTANCE_SETTERS__";(Dn=ai()[Ko])||(Dn=ai()[Ko]=[]),Dn.push(n=>Ee=n),Gi=n=>{Dn.length>1?Dn.forEach(e=>e(n)):Dn[0](n)};const Hn=n=>{Gi(n),n.scope.on()},kn=()=>{Ee&&Ee.scope.off(),Gi(null)};function Dc(n){return n.vnode.shapeFlag&4}let Ir=!1;function ch(n,e=!1){Ir=e;const{props:t,children:r}=n.vnode,s=Dc(n);jf(n,t,s,e),Wf(n,r);const i=s?lh(n,e):void 0;return Ir=!1,i}function lh(n,e){const t=n.type;n.accessCache=Object.create(null),n.proxy=lc(new Proxy(n.ctx,Ff));const{setup:r}=t;if(r){const s=n.setupContext=r.length>1?fh(n):null;Hn(n),nr();const i=rn(r,n,0,[n.props,s]);if(rr(),kn(),Ka(i)){if(i.then(kn,kn),e)return i.then(o=>{Vo(n,o,e)}).catch(o=>{Cs(o,n,0)});n.asyncDep=i}else Vo(n,i,e)}else Rc(n,e)}function Vo(n,e,t){W(e)?n.type.__ssrInlineRender?n.ssrRender=e:n.render=e:le(e)&&(n.setupState=uc(e)),Rc(n,t)}let Wo;function Rc(n,e,t){const r=n.type;if(!n.render){if(!e&&Wo&&!r.render){const s=r.template||Vi(n).template;if(s){const{isCustomElement:i,compilerOptions:o}=n.appContext.config,{delimiters:a,compilerOptions:c}=r,l=Ae(Ae({isCustomElement:i,delimiters:a},o),c);r.render=Wo(s,l)}}n.render=r.render||Ct}Hn(n),nr(),Mf(n),rr(),kn()}function uh(n){return n.attrsProxy||(n.attrsProxy=new Proxy(n.attrs,{get(e,t){return Ue(n,"get","$attrs"),e[t]}}))}function fh(n){const e=t=>{n.exposed=t||{}};return{get attrs(){return uh(n)},slots:n.slots,emit:n.emit,expose:e}}function _s(n){if(n.exposed)return n.exposeProxy||(n.exposeProxy=new Proxy(uc(lc(n.exposed)),{get(e,t){if(t in e)return e[t];if(t in fr)return fr[t](n)},has(e,t){return t in e||t in fr}}))}function hh(n){return W(n)&&"__vccOpts"in n}const dh=(n,e)=>of(n,e,Ir),gh=Symbol.for("v-scx"),mh=()=>ss(gh),ph="3.3.4",yh="http://www.w3.org/2000/svg",Tn=typeof document<"u"?document:null,Ho=Tn&&Tn.createElement("template"),vh={insert:(n,e,t)=>{e.insertBefore(n,t||null)},remove:n=>{const e=n.parentNode;e&&e.removeChild(n)},createElement:(n,e,t,r)=>{const s=e?Tn.createElementNS(yh,n):Tn.createElement(n,t?{is:t}:void 0);return n==="select"&&r&&r.multiple!=null&&s.setAttribute("multiple",r.multiple),s},createText:n=>Tn.createTextNode(n),createComment:n=>Tn.createComment(n),setText:(n,e)=>{n.nodeValue=e},setElementText:(n,e)=>{n.textContent=e},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>Tn.querySelector(n),setScopeId(n,e){n.setAttribute(e,"")},insertStaticContent(n,e,t,r,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{Ho.innerHTML=r?`<svg>${n}</svg>`:n;const a=Ho.content;if(r){const c=a.firstChild;for(;c.firstChild;)a.appendChild(c.firstChild);a.removeChild(c)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}};function Th(n,e,t){const r=n._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),e==null?n.removeAttribute("class"):t?n.setAttribute("class",e):n.className=e}function wh(n,e,t){const r=n.style,s=we(t);if(t&&!s){if(e&&!we(e))for(const i in e)t[i]==null&&Ti(r,i,"");for(const i in t)Ti(r,i,t[i])}else{const i=r.display;s?e!==t&&(r.cssText=t):e&&n.removeAttribute("style"),"_vod"in n&&(r.display=i)}}const Go=/\s*!important$/;function Ti(n,e,t){if(j(t))t.forEach(r=>Ti(n,e,r));else if(t==null&&(t=""),e.startsWith("--"))n.setProperty(e,t);else{const r=bh(n,e);Go.test(t)?n.setProperty(Cn(r),t.replace(Go,""),"important"):n[r]=t}}const Yo=["Webkit","Moz","ms"],Ys={};function bh(n,e){const t=Ys[e];if(t)return t;let r=Vn(e);if(r!=="filter"&&r in n)return Ys[e]=r;r=Ha(r);for(let s=0;s<Yo.length;s++){const i=Yo[s]+r;if(i in n)return Ys[e]=i}return e}const Xo="http://www.w3.org/1999/xlink";function Ah(n,e,t,r,s){if(r&&e.startsWith("xlink:"))t==null?n.removeAttributeNS(Xo,e.slice(6,e.length)):n.setAttributeNS(Xo,e,t);else{const i=Iu(e);t==null||i&&!Ga(t)?n.removeAttribute(e):n.setAttribute(e,i?"":t)}}function Ih(n,e,t,r,s,i,o){if(e==="innerHTML"||e==="textContent"){r&&o(r,s,i),n[e]=t??"";return}const a=n.tagName;if(e==="value"&&a!=="PROGRESS"&&!a.includes("-")){n._value=t;const l=a==="OPTION"?n.getAttribute("value"):n.value,u=t??"";l!==u&&(n.value=u),t==null&&n.removeAttribute(e);return}let c=!1;if(t===""||t==null){const l=typeof n[e];l==="boolean"?t=Ga(t):t==null&&l==="string"?(t="",c=!0):l==="number"&&(t=0,c=!0)}try{n[e]=t}catch{}c&&n.removeAttribute(e)}function Fn(n,e,t,r){n.addEventListener(e,t,r)}function Sh(n,e,t,r){n.removeEventListener(e,t,r)}function kh(n,e,t,r,s=null){const i=n._vei||(n._vei={}),o=i[e];if(r&&o)o.value=r;else{const[a,c]=Eh(e);if(r){const l=i[e]=Ch(r,s);Fn(n,a,l,c)}else o&&(Sh(n,a,o,c),i[e]=void 0)}}const Zo=/(?:Once|Passive|Capture)$/;function Eh(n){let e;if(Zo.test(n)){e={};let r;for(;r=n.match(Zo);)n=n.slice(0,n.length-r[0].length),e[r[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Cn(n.slice(2)),e]}let Xs=0;const xh=Promise.resolve(),Nh=()=>Xs||(xh.then(()=>Xs=0),Xs=Date.now());function Ch(n,e){const t=r=>{if(!r._vts)r._vts=Date.now();else if(r._vts<=t.attached)return;ct(Oh(r,t.value),e,5,[r])};return t.value=n,t.attached=Nh(),t}function Oh(n,e){if(j(e)){const t=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{t.call(n),n._stopped=!0},e.map(r=>s=>!s._stopped&&r&&r(s))}else return e}const Qo=/^on[a-z]/,Ph=(n,e,t,r,s=!1,i,o,a,c)=>{e==="class"?Th(n,r,s):e==="style"?wh(n,t,r):ks(e)?Ci(e)||kh(n,e,t,r,o):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Dh(n,e,r,s))?Ih(n,e,r,i,o,a,c):(e==="true-value"?n._trueValue=r:e==="false-value"&&(n._falseValue=r),Ah(n,e,r,s))};function Dh(n,e,t,r){return r?!!(e==="innerHTML"||e==="textContent"||e in n&&Qo.test(e)&&W(t)):e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&n.tagName==="INPUT"||e==="type"&&n.tagName==="TEXTAREA"||Qo.test(e)&&we(t)?!1:e in n}const ea=n=>{const e=n.props["onUpdate:modelValue"]||!1;return j(e)?t=>ns(e,t):e};function Rh(n){n.target.composing=!0}function ta(n){const e=n.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const na={created(n,{modifiers:{lazy:e,trim:t,number:r}},s){n._assign=ea(s);const i=r||s.props&&s.props.type==="number";Fn(n,e?"change":"input",o=>{if(o.target.composing)return;let a=n.value;t&&(a=a.trim()),i&&(a=oi(a)),n._assign(a)}),t&&Fn(n,"change",()=>{n.value=n.value.trim()}),e||(Fn(n,"compositionstart",Rh),Fn(n,"compositionend",ta),Fn(n,"change",ta))},mounted(n,{value:e}){n.value=e??""},beforeUpdate(n,{value:e,modifiers:{lazy:t,trim:r,number:s}},i){if(n._assign=ea(i),n.composing||document.activeElement===n&&n.type!=="range"&&(t||r&&n.value.trim()===e||(s||n.type==="number")&&oi(n.value)===e))return;const o=e??"";n.value!==o&&(n.value=o)}},_h={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Hr=(n,e)=>t=>{if(!("key"in t))return;const r=Cn(t.key);if(e.some(s=>s===r||_h[s]===r))return n(t)},Fh=Ae({patchProp:Ph},vh);let ra;function Mh(){return ra||(ra=Gf(Fh))}const Bh=(...n)=>{const e=Mh().createApp(...n),{mount:t}=e;return e.mount=r=>{const s=Lh(r);if(!s)return;const i=e._component;!W(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.innerHTML="";const o=t(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function Lh(n){return we(n)?document.querySelector(n):n}var ee;(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(ee||(ee={}));function sa(n){const e=ee[n];return typeof e!="string"?n.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class pe extends Error{constructor(e,t=ee.Unknown,r,s,i){super($h(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(r??{}),this.details=s??[],this.cause=i}static from(e,t=ee.Unknown){return e instanceof pe?e:e instanceof Error?e.name=="AbortError"?new pe(e.message,ee.Canceled):new pe(e.message,t,void 0,void 0,e):new pe(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error?Object.getPrototypeOf(e)===pe.prototype?!0:e.name==="ConnectError"&&"code"in e&&typeof e.code=="number"&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&typeof e.rawMessage=="string"&&"cause"in e:!1}findDetails(e){const t="typeName"in e?{findMessage:s=>s===e.typeName?e:void 0}:e,r=[];for(const s of this.details){if("getType"in s){t.findMessage(s.getType().typeName)&&r.push(s);continue}const i=t.findMessage(s.type);if(i)try{r.push(i.fromBinary(s.value))}catch{}}return r}}function $h(n,e){return n.length?`[${sa(e)}] ${n}`:`[${sa(e)}]`}function he(n,e){if(!n)throw new Error(e)}const Uh=34028234663852886e22,Jh=-34028234663852886e22,qh=4294967295,zh=2147483647,jh=-2147483648;function os(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>zh||n<jh)throw new Error("invalid int 32: "+n)}function wi(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>qh||n<0)throw new Error("invalid uint 32: "+n)}function _c(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>Uh||n<Jh))throw new Error("invalid float 32: "+n)}const Fc=Symbol("@bufbuild/protobuf/enum-type");function Kh(n){const e=n[Fc];return he(e,"missing enum type on enum object"),e}function Mc(n,e,t,r){n[Fc]=Bc(e,t.map(s=>({no:s.no,name:s.name,localName:n[s.no]})))}function Bc(n,e,t){const r=Object.create(null),s=Object.create(null),i=[];for(const o of e){const a=Lc(o);i.push(a),r[o.name]=a,s[o.no]=a}return{typeName:n,values:i,findName(o){return r[o]},findNumber(o){return s[o]}}}function Vh(n,e,t){const r={};for(const s of e){const i=Lc(s);r[i.localName]=i.no,r[i.no]=i.localName}return Mc(r,n,e),r}function Lc(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class _e{equals(e){return this.getType().runtime.util.equals(this.getType(),this,e)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(e,t){const r=this.getType(),s=r.runtime.bin,i=s.makeReadOptions(t);return s.readMessage(this,i.readerFactory(e),e.byteLength,i),this}fromJson(e,t){const r=this.getType(),s=r.runtime.json,i=s.makeReadOptions(t);return s.readMessage(r,e,i,this),this}fromJsonString(e,t){let r;try{r=JSON.parse(e)}catch(s){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${s instanceof Error?s.message:String(s)}`)}return this.fromJson(r,t)}toBinary(e){const t=this.getType(),r=t.runtime.bin,s=r.makeWriteOptions(e),i=s.writerFactory();return r.writeMessage(this,i,s),i.finish()}toJson(e){const t=this.getType(),r=t.runtime.json,s=r.makeWriteOptions(e);return r.writeMessage(this,s)}toJsonString(e){var t;const r=this.toJson(e);return JSON.stringify(r,null,(t=e==null?void 0:e.prettySpaces)!==null&&t!==void 0?t:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function Wh(n,e,t,r){var s;const i=(s=r==null?void 0:r.localName)!==null&&s!==void 0?s:e.substring(e.lastIndexOf(".")+1),o={[i]:function(a){n.util.initFields(this),n.util.initPartial(a,this)}}[i];return Object.setPrototypeOf(o.prototype,new _e),Object.assign(o,{runtime:n,typeName:e,fields:n.util.newFieldList(t),fromBinary(a,c){return new o().fromBinary(a,c)},fromJson(a,c){return new o().fromJson(a,c)},fromJsonString(a,c){return new o().fromJsonString(a,c)},equals(a,c){return n.util.equals(o,a,c)}}),o}function Hh(){let n=0,e=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<r,!(s&128))return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,!(t&128))return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,!(s&128))return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Zs(n,e,t){for(let i=0;i<28;i=i+7){const o=n>>>i,a=!(!(o>>>7)&&e==0),c=(a?o|128:o)&255;if(t.push(c),!a)return}const r=n>>>28&15|(e&7)<<4,s=!!(e>>3);if(t.push((s?r|128:r)&255),!!s){for(let i=3;i<31;i=i+7){const o=e>>>i,a=!!(o>>>7),c=(a?o|128:o)&255;if(t.push(c),!a)return}t.push(e>>>31&1)}}const as=4294967296;function ia(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let r=0,s=0;function i(o,a){const c=Number(n.slice(o,a));s*=t,r=r*t+c,r>=as&&(s=s+(r/as|0),r=r%as)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?Uc(r,s):Yi(r,s)}function Gh(n,e){let t=Yi(n,e);const r=t.hi&2147483648;r&&(t=Uc(t.lo,t.hi));const s=$c(t.lo,t.hi);return r?"-"+s:s}function $c(n,e){if({lo:n,hi:e}=Yh(n,e),e<=2097151)return String(as*e+n);const t=n&16777215,r=(n>>>24|e<<8)&16777215,s=e>>16&65535;let i=t+r*6777216+s*6710656,o=r+s*8147497,a=s*2;const c=1e7;return i>=c&&(o+=Math.floor(i/c),i%=c),o>=c&&(a+=Math.floor(o/c),o%=c),a.toString()+oa(o)+oa(i)}function Yh(n,e){return{lo:n>>>0,hi:e>>>0}}function Yi(n,e){return{lo:n|0,hi:e|0}}function Uc(n,e){return e=~e,n?n=~n+1:e+=1,Yi(n,e)}const oa=n=>{const e=String(n);return"0000000".slice(e.length)+e};function aa(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function Xh(){let n=this.buf[this.pos++],e=n&127;if(!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,!(n&128))return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,!(n&128))return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;n&128&&t<10;t++)n=this.buf[this.pos++];if(n&128)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var ca={};function Zh(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof ca!="object"||ca.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),o=BigInt("0"),a=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>i||l<s)throw new Error(`int64 invalid: ${c}`);return l},uParse(c){const l=typeof c=="bigint"?c:BigInt(c);if(l>a||l<o)throw new Error(`uint64 invalid: ${c}`);return l},enc(c){return n.setBigInt64(0,this.parse(c),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(c){return n.setBigInt64(0,this.uParse(c),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(c,l){return n.setInt32(0,c,!0),n.setInt32(4,l,!0),n.getBigInt64(0,!0)},uDec(c,l){return n.setInt32(0,c,!0),n.setInt32(4,l,!0),n.getBigUint64(0,!0)}}}const t=s=>he(/^-?[0-9]+$/.test(s),`int64 invalid: ${s}`),r=s=>he(/^[0-9]+$/.test(s),`uint64 invalid: ${s}`);return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),t(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),r(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),t(s),ia(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),r(s),ia(s)},dec(s,i){return Gh(s,i)},uDec(s,i){return $c(s,i)}}}const ye=Zh();var w;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(w||(w={}));var cn;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(cn||(cn={}));function Gt(n,e,t){if(e===t)return!0;if(n==w.BYTES){if(!(e instanceof Uint8Array)||!(t instanceof Uint8Array)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}switch(n){case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:return e==t}return!1}function Gn(n,e){switch(n){case w.BOOL:return!1;case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:return e==0?ye.zero:"0";case w.DOUBLE:case w.FLOAT:return 0;case w.BYTES:return new Uint8Array(0);case w.STRING:return"";default:return 0}}function Jc(n,e){switch(n){case w.BOOL:return e===!1;case w.STRING:return e==="";case w.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}var de;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(de||(de={}));class Qh{constructor(e){this.stack=[],this.textEncoder=e??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),r=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(wi(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return os(e),aa(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.textEncoder.encode(e);return this.uint32(t.byteLength),this.raw(t)}float(e){_c(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){wi(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){os(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return os(e),e=(e<<1^e>>31)>>>0,aa(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=ye.enc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=ye.uEnc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=ye.enc(e);return Zs(t.lo,t.hi,this.buf),this}sint64(e){let t=ye.enc(e),r=t.hi>>31,s=t.lo<<1^r,i=(t.hi<<1|t.lo>>>31)^r;return Zs(s,i,this.buf),this}uint64(e){let t=ye.uEnc(e);return Zs(t.lo,t.hi,this.buf),this}}class ed{constructor(e,t){this.varint64=Hh,this.uint32=Xh,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.textDecoder=t??new TextDecoder}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case de.Varint:for(;this.buf[this.pos++]&128;);break;case de.Bit64:this.pos+=4;case de.Bit32:this.pos+=4;break;case de.LengthDelimited:let s=this.uint32();this.pos+=s;break;case de.StartGroup:for(;;){const[i,o]=this.tag();if(o===de.EndGroup){if(t!==void 0&&i!==t)throw new Error("invalid end group tag");break}this.skip(o,i)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return ye.dec(...this.varint64())}uint64(){return ye.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,ye.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return ye.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return ye.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.textDecoder.decode(this.bytes())}}function td(n,e,t,r){let s;return{typeName:e,extendee:t,get field(){if(!s){const i=typeof r=="function"?r():r;i.name=e.split(".").pop(),i.jsonName=`[${e}]`,s=n.util.newFieldList([i]).list()[0]}return s},runtime:n}}function qc(n){const e=n.field.localName,t=Object.create(null);return t[e]=nd(n),[t,()=>t[e]]}function nd(n){const e=n.field;if(e.repeated)return[];if(e.default!==void 0)return e.default;switch(e.kind){case"enum":return e.T.values[0].no;case"scalar":return Gn(e.T,e.L);case"message":const t=e.T,r=new t;return t.fieldWrapper?t.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function rd(n,e){if(!e.repeated&&(e.kind=="enum"||e.kind=="scalar")){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.no)return[n[t]];return[]}return n.filter(t=>t.no===e.no)}let Lt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Fs=[];for(let n=0;n<Lt.length;n++)Fs[Lt[n].charCodeAt(0)]=n;Fs[45]=Lt.indexOf("+");Fs[95]=Lt.indexOf("/");const Xi={dec(n){let e=n.length*3/4;n[n.length-2]=="="?e-=2:n[n.length-1]=="="&&(e-=1);let t=new Uint8Array(e),r=0,s=0,i,o=0;for(let a=0;a<n.length;a++){if(i=Fs[n.charCodeAt(a)],i===void 0)switch(n[a]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=i,s=1;break;case 1:t[r++]=o<<2|(i&48)>>4,o=i,s=2;break;case 2:t[r++]=(o&15)<<4|(i&60)>>2,o=i,s=3;break;case 3:t[r++]=(o&3)<<6|i,s=0;break}}if(s==1)throw Error("invalid base64 string.");return t.subarray(0,r)},enc(n){let e="",t=0,r,s=0;for(let i=0;i<n.length;i++)switch(r=n[i],t){case 0:e+=Lt[r>>2],s=(r&3)<<4,t=1;break;case 1:e+=Lt[s|r>>4],s=(r&15)<<2,t=2;break;case 2:e+=Lt[s|r>>6],e+=Lt[r&63],t=0;break}return t&&(e+=Lt[s],e+="=",t==1&&(e+="=")),e}};function sd(n,e,t){jc(e,n);const r=e.runtime.bin.makeReadOptions(t),s=rd(n.getType().runtime.bin.listUnknownFields(n),e.field),[i,o]=qc(e);for(const a of s)e.runtime.bin.readField(i,r.readerFactory(a.data),e.field,a.wireType,r);return o()}function id(n,e,t,r){jc(e,n);const s=e.runtime.bin.makeReadOptions(r),i=e.runtime.bin.makeWriteOptions(r);if(zc(n,e)){const l=n.getType().runtime.bin.listUnknownFields(n).filter(u=>u.no!=e.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const u of l)n.getType().runtime.bin.onUnknownField(n,u.no,u.wireType,u.data)}const o=i.writerFactory();let a=e.field;!a.opt&&!a.repeated&&(a.kind=="enum"||a.kind=="scalar")&&(a=Object.assign(Object.assign({},e.field),{opt:!0})),e.runtime.bin.writeField(a,t,o,i);const c=s.readerFactory(o.finish());for(;c.pos<c.len;){const[l,u]=c.tag(),g=c.skip(u,l);n.getType().runtime.bin.onUnknownField(n,l,u,g)}}function zc(n,e){const t=n.getType();return e.extendee.typeName===t.typeName&&!!t.runtime.bin.listUnknownFields(n).find(r=>r.no==e.field.no)}function jc(n,e){he(n.extendee.typeName==e.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function Kc(n,e){const t=n.localName;if(n.repeated)return e[t].length>0;if(n.oneof)return e[n.oneof.localName].case===t;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?e[t]!==void 0:n.kind=="enum"?e[t]!==n.T.values[0].no:!Jc(n.T,e[t]);case"message":return e[t]!==void 0;case"map":return Object.keys(e[t]).length>0}}function la(n,e){const t=n.localName,r=!n.opt&&!n.req;if(n.repeated)e[t]=[];else if(n.oneof)e[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":e[t]={};break;case"enum":e[t]=r?n.T.values[0].no:void 0;break;case"scalar":e[t]=r?Gn(n.T,n.L):void 0;break;case"message":e[t]=void 0;break}}function En(n,e){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(_e.prototype).every(r=>r in n&&typeof n[r]=="function"))return!1;const t=n.getType();return t===null||typeof t!="function"||!("typeName"in t)||typeof t.typeName!="string"?!1:e===void 0?!0:t.typeName==e.typeName}function Vc(n,e){return En(e)||!n.fieldWrapper?e:n.fieldWrapper.wrapField(e)}w.DOUBLE,w.FLOAT,w.INT64,w.UINT64,w.INT32,w.UINT32,w.BOOL,w.STRING,w.BYTES;const ua={ignoreUnknownFields:!1},fa={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function od(n){return n?Object.assign(Object.assign({},ua),n):ua}function ad(n){return n?Object.assign(Object.assign({},fa),n):fa}const vs=Symbol(),cs=Symbol();function cd(){return{makeReadOptions:od,makeWriteOptions:ad,readMessage(n,e,t,r){if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${pt(e)}`);r=r??new n;const s=new Map,i=t.typeRegistry;for(const[o,a]of Object.entries(e)){const c=n.fields.findJsonName(o);if(c){if(c.oneof){if(a===null&&c.kind=="scalar")continue;const l=s.get(c.oneof);if(l!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${c.oneof.name}" present: "${l}", "${o}"`);s.set(c.oneof,o)}ha(r,a,c,t,n)}else{let l=!1;if(i!=null&&i.findExtension&&o.startsWith("[")&&o.endsWith("]")){const u=i.findExtension(o.substring(1,o.length-1));if(u&&u.extendee.typeName==n.typeName){l=!0;const[g,v]=qc(u);ha(g,a,u.field,t,u),id(r,u,v(),t)}}if(!l&&!t.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${o}" is unknown`)}}return r},writeMessage(n,e){const t=n.getType(),r={};let s;try{for(s of t.fields.byNumber()){if(!Kc(s,n)){if(s.req)throw"required field not set";if(!e.emitDefaultValues||!ud(s))continue}const o=s.oneof?n[s.oneof.localName].value:n[s.localName],a=da(s,o,e);a!==void 0&&(r[e.useProtoFieldName?s.name:s.jsonName]=a)}const i=e.typeRegistry;if(i!=null&&i.findExtensionFor)for(const o of t.runtime.bin.listUnknownFields(n)){const a=i.findExtensionFor(t.typeName,o.no);if(a&&zc(n,a)){const c=sd(n,a,e),l=da(a.field,c,e);l!==void 0&&(r[a.field.jsonName]=l)}}}catch(i){const o=s?`cannot encode field ${t.typeName}.${s.name} to JSON`:`cannot encode message ${t.typeName} to JSON`,a=i instanceof Error?i.message:String(i);throw new Error(o+(a.length>0?`: ${a}`:""))}return r},readScalar(n,e,t){return dr(n,e,t??cn.BIGINT,!0)},writeScalar(n,e,t){if(e!==void 0&&(t||Jc(n,e)))return ls(n,e)},debug:pt}}function pt(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function ha(n,e,t,r,s){let i=t.localName;if(t.repeated){if(he(t.kind!="map"),e===null)return;if(!Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${pt(e)}`);const o=n[i];for(const a of e){if(a===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${pt(a)}`);switch(t.kind){case"message":o.push(t.T.fromJson(a,r));break;case"enum":const c=Qs(t.T,a,r.ignoreUnknownFields,!0);c!==cs&&o.push(c);break;case"scalar":try{o.push(dr(t.T,a,t.L,!0))}catch(l){let u=`cannot decode field ${s.typeName}.${t.name} from JSON: ${pt(a)}`;throw l instanceof Error&&l.message.length>0&&(u+=`: ${l.message}`),new Error(u)}break}}}else if(t.kind=="map"){if(e===null)return;if(typeof e!="object"||Array.isArray(e))throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: ${pt(e)}`);const o=n[i];for(const[a,c]of Object.entries(e)){if(c===null)throw new Error(`cannot decode field ${s.typeName}.${t.name} from JSON: map value null`);let l;try{l=ld(t.K,a)}catch(u){let g=`cannot decode map key for field ${s.typeName}.${t.name} from JSON: ${pt(e)}`;throw u instanceof Error&&u.message.length>0&&(g+=`: ${u.message}`),new Error(g)}switch(t.V.kind){case"message":o[l]=t.V.T.fromJson(c,r);break;case"enum":const u=Qs(t.V.T,c,r.ignoreUnknownFields,!0);u!==cs&&(o[l]=u);break;case"scalar":try{o[l]=dr(t.V.T,c,cn.BIGINT,!0)}catch(g){let v=`cannot decode map value for field ${s.typeName}.${t.name} from JSON: ${pt(e)}`;throw g instanceof Error&&g.message.length>0&&(v+=`: ${g.message}`),new Error(v)}break}}}else switch(t.oneof&&(n=n[t.oneof.localName]={case:i},i="value"),t.kind){case"message":const o=t.T;if(e===null&&o.typeName!="google.protobuf.Value")return;let a=n[i];En(a)?a.fromJson(e,r):(n[i]=a=o.fromJson(e,r),o.fieldWrapper&&!t.oneof&&(n[i]=o.fieldWrapper.unwrapField(a)));break;case"enum":const c=Qs(t.T,e,r.ignoreUnknownFields,!1);switch(c){case vs:la(t,n);break;case cs:break;default:n[i]=c;break}break;case"scalar":try{const l=dr(t.T,e,t.L,!1);switch(l){case vs:la(t,n);break;default:n[i]=l;break}}catch(l){let u=`cannot decode field ${s.typeName}.${t.name} from JSON: ${pt(e)}`;throw l instanceof Error&&l.message.length>0&&(u+=`: ${l.message}`),new Error(u)}break}}function ld(n,e){if(n===w.BOOL)switch(e){case"true":e=!0;break;case"false":e=!1;break}return dr(n,e,cn.BIGINT,!0).toString()}function dr(n,e,t,r){if(e===null)return r?Gn(n,t):vs;switch(n){case w.DOUBLE:case w.FLOAT:if(e==="NaN")return Number.NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(e===""||typeof e=="string"&&e.trim().length!==e.length||typeof e!="string"&&typeof e!="number")break;const s=Number(e);if(Number.isNaN(s)||!Number.isFinite(s))break;return n==w.FLOAT&&_c(s),s;case w.INT32:case w.FIXED32:case w.SFIXED32:case w.SINT32:case w.UINT32:let i;if(typeof e=="number"?i=e:typeof e=="string"&&e.length>0&&e.trim().length===e.length&&(i=Number(e)),i===void 0)break;return n==w.UINT32||n==w.FIXED32?wi(i):os(i),i;case w.INT64:case w.SFIXED64:case w.SINT64:if(typeof e!="number"&&typeof e!="string")break;const o=ye.parse(e);return t?o.toString():o;case w.FIXED64:case w.UINT64:if(typeof e!="number"&&typeof e!="string")break;const a=ye.uParse(e);return t?a.toString():a;case w.BOOL:if(typeof e!="boolean")break;return e;case w.STRING:if(typeof e!="string")break;try{encodeURIComponent(e)}catch{throw new Error("invalid UTF8")}return e;case w.BYTES:if(e==="")return new Uint8Array(0);if(typeof e!="string")break;return Xi.dec(e)}throw new Error}function Qs(n,e,t,r){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].no:vs;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=n.findName(e);if(s!==void 0)return s.no;if(t)return cs;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${pt(e)}`)}function ud(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function da(n,e,t){if(n.kind=="map"){he(typeof e=="object"&&e!=null);const r={},s=Object.entries(e);switch(n.V.kind){case"scalar":for(const[o,a]of s)r[o.toString()]=ls(n.V.T,a);break;case"message":for(const[o,a]of s)r[o.toString()]=a.toJson(t);break;case"enum":const i=n.V.T;for(const[o,a]of s)r[o.toString()]=ei(i,a,t.enumAsInteger);break}return t.emitDefaultValues||s.length>0?r:void 0}if(n.repeated){he(Array.isArray(e));const r=[];switch(n.kind){case"scalar":for(let s=0;s<e.length;s++)r.push(ls(n.T,e[s]));break;case"enum":for(let s=0;s<e.length;s++)r.push(ei(n.T,e[s],t.enumAsInteger));break;case"message":for(let s=0;s<e.length;s++)r.push(e[s].toJson(t));break}return t.emitDefaultValues||r.length>0?r:void 0}switch(n.kind){case"scalar":return ls(n.T,e);case"enum":return ei(n.T,e,t.enumAsInteger);case"message":return Vc(n.T,e).toJson(t)}}function ei(n,e,t){var r;if(he(typeof e=="number"),n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=n.findNumber(e);return(r=s==null?void 0:s.name)!==null&&r!==void 0?r:e}function ls(n,e){switch(n){case w.INT32:case w.SFIXED32:case w.SINT32:case w.FIXED32:case w.UINT32:return he(typeof e=="number"),e;case w.FLOAT:case w.DOUBLE:return he(typeof e=="number"),Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case w.STRING:return he(typeof e=="string"),e;case w.BOOL:return he(typeof e=="boolean"),e;case w.UINT64:case w.FIXED64:case w.INT64:case w.SFIXED64:case w.SINT64:return he(typeof e=="bigint"||typeof e=="string"||typeof e=="number"),e.toString();case w.BYTES:return he(e instanceof Uint8Array),Xi.enc(e)}}const Rn=Symbol("@bufbuild/protobuf/unknown-fields"),ga={readUnknownFields:!0,readerFactory:n=>new ed(n)},ma={writeUnknownFields:!0,writerFactory:()=>new Qh};function fd(n){return n?Object.assign(Object.assign({},ga),n):ga}function hd(n){return n?Object.assign(Object.assign({},ma),n):ma}function dd(){return{makeReadOptions:fd,makeWriteOptions:hd,listUnknownFields(n){var e;return(e=n[Rn])!==null&&e!==void 0?e:[]},discardUnknownFields(n){delete n[Rn]},writeUnknownFields(n,e){const r=n[Rn];if(r)for(const s of r)e.tag(s.no,s.wireType).raw(s.data)},onUnknownField(n,e,t,r){const s=n;Array.isArray(s[Rn])||(s[Rn]=[]),s[Rn].push({no:e,wireType:t,data:r})},readMessage(n,e,t,r,s){const i=n.getType(),o=s?e.len:e.pos+t;let a,c;for(;e.pos<o&&([a,c]=e.tag(),!(s===!0&&c==de.EndGroup));){const l=i.fields.find(a);if(!l){const u=e.skip(c,a);r.readUnknownFields&&this.onUnknownField(n,a,c,u);continue}pa(n,e,l,c,r)}if(s&&(c!=de.EndGroup||a!==t))throw new Error("invalid end group tag")},readField:pa,writeMessage(n,e,t){const r=n.getType();for(const s of r.fields.byNumber()){if(!Kc(s,n)){if(s.req)throw new Error(`cannot encode field ${r.typeName}.${s.name} to binary: required field not set`);continue}const i=s.oneof?n[s.oneof.localName].value:n[s.localName];ya(s,i,e,t)}return t.writeUnknownFields&&this.writeUnknownFields(n,e),e},writeField(n,e,t,r){e!==void 0&&ya(n,e,t,r)}}}function pa(n,e,t,r,s){let{repeated:i,localName:o}=t;switch(t.oneof&&(n=n[t.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),t.kind){case"scalar":case"enum":const a=t.kind=="enum"?w.INT32:t.T;let c=Ts;if(t.kind=="scalar"&&t.L>0&&(c=md),i){let v=n[o];if(r==de.LengthDelimited&&a!=w.STRING&&a!=w.BYTES){let A=e.uint32()+e.pos;for(;e.pos<A;)v.push(c(e,a))}else v.push(c(e,a))}else n[o]=c(e,a);break;case"message":const l=t.T;i?n[o].push(us(e,new l,s,t)):En(n[o])?us(e,n[o],s,t):(n[o]=us(e,new l,s,t),l.fieldWrapper&&!t.oneof&&!t.repeated&&(n[o]=l.fieldWrapper.unwrapField(n[o])));break;case"map":let[u,g]=gd(t,e,s);n[o][u]=g;break}}function us(n,e,t,r){const s=e.getType().runtime.bin,i=r==null?void 0:r.delimited;return s.readMessage(e,n,i?r.no:n.uint32(),t,i),e}function gd(n,e,t){const r=e.uint32(),s=e.pos+r;let i,o;for(;e.pos<s;){const[a]=e.tag();switch(a){case 1:i=Ts(e,n.K);break;case 2:switch(n.V.kind){case"scalar":o=Ts(e,n.V.T);break;case"enum":o=e.int32();break;case"message":o=us(e,new n.V.T,t,void 0);break}break}}if(i===void 0&&(i=Gn(n.K,cn.BIGINT)),typeof i!="string"&&typeof i!="number"&&(i=i.toString()),o===void 0)switch(n.V.kind){case"scalar":o=Gn(n.V.T,cn.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[i,o]}function md(n,e){const t=Ts(n,e);return typeof t=="bigint"?t.toString():t}function Ts(n,e){switch(e){case w.STRING:return n.string();case w.BOOL:return n.bool();case w.DOUBLE:return n.double();case w.FLOAT:return n.float();case w.INT32:return n.int32();case w.INT64:return n.int64();case w.UINT64:return n.uint64();case w.FIXED64:return n.fixed64();case w.BYTES:return n.bytes();case w.FIXED32:return n.fixed32();case w.SFIXED32:return n.sfixed32();case w.SFIXED64:return n.sfixed64();case w.SINT64:return n.sint64();case w.UINT32:return n.uint32();case w.SINT32:return n.sint32()}}function ya(n,e,t,r){he(e!==void 0);const s=n.repeated;switch(n.kind){case"scalar":case"enum":let i=n.kind=="enum"?w.INT32:n.T;if(s)if(he(Array.isArray(e)),n.packed)yd(t,i,n.no,e);else for(const o of e)gr(t,i,n.no,o);else gr(t,i,n.no,e);break;case"message":if(s){he(Array.isArray(e));for(const o of e)va(t,r,n,o)}else va(t,r,n,e);break;case"map":he(typeof e=="object"&&e!=null);for(const[o,a]of Object.entries(e))pd(t,r,n,o,a);break}}function pd(n,e,t,r,s){n.tag(t.no,de.LengthDelimited),n.fork();let i=r;switch(t.K){case w.INT32:case w.FIXED32:case w.UINT32:case w.SFIXED32:case w.SINT32:i=Number.parseInt(r);break;case w.BOOL:he(r=="true"||r=="false"),i=r=="true";break}switch(gr(n,t.K,1,i),t.V.kind){case"scalar":gr(n,t.V.T,2,s);break;case"enum":gr(n,w.INT32,2,s);break;case"message":he(s!==void 0),n.tag(2,de.LengthDelimited).bytes(s.toBinary(e));break}n.join()}function va(n,e,t,r){const s=Vc(t.T,r);t.delimited?n.tag(t.no,de.StartGroup).raw(s.toBinary(e)).tag(t.no,de.EndGroup):n.tag(t.no,de.LengthDelimited).bytes(s.toBinary(e))}function gr(n,e,t,r){he(r!==void 0);let[s,i]=Wc(e);n.tag(t,s)[i](r)}function yd(n,e,t,r){if(!r.length)return;n.tag(t,de.LengthDelimited).fork();let[,s]=Wc(e);for(let i=0;i<r.length;i++)n[s](r[i]);n.join()}function Wc(n){let e=de.Varint;switch(n){case w.BYTES:case w.STRING:e=de.LengthDelimited;break;case w.DOUBLE:case w.FIXED64:case w.SFIXED64:e=de.Bit64;break;case w.FIXED32:case w.SFIXED32:case w.FLOAT:e=de.Bit32;break}const t=w[n].toLowerCase();return[e,t]}function vd(){return{setEnumType:Mc,initPartial(n,e){if(n===void 0)return;const t=e.getType();for(const r of t.fields.byMember()){const s=r.localName,i=e,o=n;if(o[s]!=null)switch(r.kind){case"oneof":const a=o[s].case;if(a===void 0)continue;const c=r.findField(a);let l=o[s].value;c&&c.kind=="message"&&!En(l,c.T)?l=new c.T(l):c&&c.kind==="scalar"&&c.T===w.BYTES&&(l=ar(l)),i[s]={case:a,value:l};break;case"scalar":case"enum":let u=o[s];r.T===w.BYTES&&(u=r.repeated?u.map(ar):ar(u)),i[s]=u;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===w.BYTES)for(const[d,A]of Object.entries(o[s]))i[s][d]=ar(A);else Object.assign(i[s],o[s]);break;case"message":const v=r.V.T;for(const d of Object.keys(o[s])){let A=o[s][d];v.fieldWrapper||(A=new v(A)),i[s][d]=A}break}break;case"message":const g=r.T;if(r.repeated)i[s]=o[s].map(v=>En(v,g)?v:new g(v));else{const v=o[s];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?i[s]=ar(v):i[s]=v:i[s]=En(v,g)?v:new g(v)}break}}},equals(n,e,t){return e===t?!0:!e||!t?!1:n.fields.byMember().every(r=>{const s=e[r.localName],i=t[r.localName];if(r.repeated){if(s.length!==i.length)return!1;switch(r.kind){case"message":return s.every((o,a)=>r.T.equals(o,i[a]));case"scalar":return s.every((o,a)=>Gt(r.T,o,i[a]));case"enum":return s.every((o,a)=>Gt(w.INT32,o,i[a]))}throw new Error(`repeated cannot contain ${r.kind}`)}switch(r.kind){case"message":return r.T.equals(s,i);case"enum":return Gt(w.INT32,s,i);case"scalar":return Gt(r.T,s,i);case"oneof":if(s.case!==i.case)return!1;const o=r.findField(s.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(s.value,i.value);case"enum":return Gt(w.INT32,s.value,i.value);case"scalar":return Gt(o.T,s.value,i.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const a=Object.keys(s).concat(Object.keys(i));switch(r.V.kind){case"message":const c=r.V.T;return a.every(u=>c.equals(s[u],i[u]));case"enum":return a.every(u=>Gt(w.INT32,s[u],i[u]));case"scalar":const l=r.V.T;return a.every(u=>Gt(l,s[u],i[u]))}break}})},clone(n){const e=n.getType(),t=new e,r=t;for(const s of e.fields.byMember()){const i=n[s.localName];let o;if(s.repeated)o=i.map(Gr);else if(s.kind=="map"){o=r[s.localName];for(const[a,c]of Object.entries(i))o[a]=Gr(c)}else s.kind=="oneof"?o=s.findField(i.case)?{case:i.case,value:Gr(i.value)}:{case:void 0}:o=Gr(i);r[s.localName]=o}for(const s of e.runtime.bin.listUnknownFields(n))e.runtime.bin.onUnknownField(r,s.no,s.wireType,s.data);return t}}}function Gr(n){if(n===void 0)return n;if(En(n))return n.clone();if(n instanceof Uint8Array){const e=new Uint8Array(n.byteLength);return e.set(n),e}return n}function ar(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function Td(n,e,t){return{syntax:n,json:cd(),bin:dd(),util:Object.assign(Object.assign({},vd()),{newFieldList:e,initFields:t}),makeMessageType(r,s,i){return Wh(this,r,s,i)},makeEnum:Vh,makeEnumType:Bc,getEnumType:Kh,makeExtension(r,s,i){return td(this,r,s,i)}}}class wd{constructor(e,t){this._fields=e,this._normalizer=t}findJsonName(e){if(!this.jsonNames){const t={};for(const r of this.list())t[r.jsonName]=t[r.name]=r;this.jsonNames=t}return this.jsonNames[e]}find(e){if(!this.numbers){const t={};for(const r of this.list())t[r.no]=r;this.numbers=t}return this.numbers[e]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((e,t)=>e.no-t.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const e=this.members;let t;for(const r of this.list())r.oneof?r.oneof!==t&&(t=r.oneof,e.push(t)):e.push(r)}return this.members}}function Hc(n,e){const t=Gc(n);return e?t:Ed(kd(t))}function bd(n){return Hc(n,!1)}const Ad=Gc;function Gc(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let s=n.charAt(r);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const Id=new Set(["constructor","toString","toJSON","valueOf"]),Sd=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),Yc=n=>`${n}$`,kd=n=>Sd.has(n)?Yc(n):n,Ed=n=>Id.has(n)?Yc(n):n;class xd{constructor(e){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=e,this.localName=bd(e)}addField(e){he(e.oneof===this,`field ${e.name} not one of ${this.name}`),this.fields.push(e)}findField(e){if(!this._lookup){this._lookup=Object.create(null);for(let t=0;t<this.fields.length;t++)this._lookup[this.fields[t].localName]=this.fields[t]}return this._lookup[e]}}function Nd(n,e){var t,r,s,i,o,a;const c=[];let l;for(const u of typeof n=="function"?n():n){const g=u;if(g.localName=Hc(u.name,u.oneof!==void 0),g.jsonName=(t=u.jsonName)!==null&&t!==void 0?t:Ad(u.name),g.repeated=(r=u.repeated)!==null&&r!==void 0?r:!1,u.kind=="scalar"&&(g.L=(s=u.L)!==null&&s!==void 0?s:cn.BIGINT),g.delimited=(i=u.delimited)!==null&&i!==void 0?i:!1,g.req=(o=u.req)!==null&&o!==void 0?o:!1,g.opt=(a=u.opt)!==null&&a!==void 0?a:!1,u.packed===void 0&&(g.packed=u.kind=="enum"||u.kind=="scalar"&&u.T!=w.BYTES&&u.T!=w.STRING),u.oneof!==void 0){const v=typeof u.oneof=="string"?u.oneof:u.oneof.name;(!l||l.name!=v)&&(l=new xd(v)),g.oneof=l,l.addField(g)}c.push(g)}return c}const p=Td("proto3",n=>new wd(n,e=>Nd(e)),n=>{for(const e of n.getType().fields.byMember()){if(e.opt)continue;const t=e.localName,r=n;if(e.repeated){r[t]=[];continue}switch(e.kind){case"oneof":r[t]={case:void 0};break;case"enum":r[t]=0;break;case"map":r[t]={};break;case"scalar":r[t]=Gn(e.T,e.L);break}}});var Pe;(function(n){n[n.Unary=0]="Unary",n[n.ServerStreaming=1]="ServerStreaming",n[n.ClientStreaming=2]="ClientStreaming",n[n.BiDiStreaming=3]="BiDiStreaming"})(Pe||(Pe={}));var Ta;(function(n){n[n.NoSideEffects=1]="NoSideEffects",n[n.Idempotent=2]="Idempotent"})(Ta||(Ta={}));class Se extends _e{constructor(e){super(),this.seconds=ye.zero,this.nanos=0,p.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Timestamp from JSON: ${p.json.debug(e)}`);const r=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=ye.parse(s/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(e){const t=Number(this.seconds)*1e3;if(t<Date.parse("0001-01-01T00:00:00Z")||t>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?r="."+s.substring(0,3)+"Z":s.substring(6)==="000"?r="."+s.substring(0,6)+"Z":r="."+s+"Z"}return new Date(t).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Se.fromDate(new Date)}static fromDate(e){const t=e.getTime();return new Se({seconds:ye.parse(Math.floor(t/1e3)),nanos:t%1e3*1e6})}static fromBinary(e,t){return new Se().fromBinary(e,t)}static fromJson(e,t){return new Se().fromJson(e,t)}static fromJsonString(e,t){return new Se().fromJsonString(e,t)}static equals(e,t){return p.util.equals(Se,e,t)}}Se.runtime=p;Se.typeName="google.protobuf.Timestamp";Se.fields=p.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class $t extends _e{constructor(e){super(),this.seconds=ye.zero,this.nanos=0,p.util.initPartial(e,this)}fromJson(e,t){if(typeof e!="string")throw new Error(`cannot decode google.protobuf.Duration from JSON: ${p.json.debug(e)}`);const r=e.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(r===null)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${p.json.debug(e)}`);const s=Number(r[1]);if(s>315576e6||s<-315576e6)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${p.json.debug(e)}`);if(this.seconds=ye.parse(s),typeof r[2]=="string"){const i=r[2]+"0".repeat(9-r[2].length);this.nanos=parseInt(i),(s<0||Object.is(s,-0))&&(this.nanos=-this.nanos)}return this}toJson(e){if(Number(this.seconds)>315576e6||Number(this.seconds)<-315576e6)throw new Error("cannot encode google.protobuf.Duration to JSON: value out of range");let t=this.seconds.toString();if(this.nanos!==0){let r=Math.abs(this.nanos).toString();r="0".repeat(9-r.length)+r,r.substring(3)==="000000"?r=r.substring(0,3):r.substring(6)==="000"&&(r=r.substring(0,6)),t+="."+r,this.nanos<0&&Number(this.seconds)==0&&(t="-"+t)}return t+"s"}static fromBinary(e,t){return new $t().fromBinary(e,t)}static fromJson(e,t){return new $t().fromJson(e,t)}static fromJsonString(e,t){return new $t().fromJsonString(e,t)}static equals(e,t){return p.util.equals($t,e,t)}}$t.runtime=p;$t.typeName="google.protobuf.Duration";$t.fields=p.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class Tt extends _e{constructor(e){super(),this.typeUrl="",this.value=new Uint8Array(0),p.util.initPartial(e,this)}toJson(e){var t;if(this.typeUrl==="")return{};const r=this.typeUrlToName(this.typeUrl),s=(t=e==null?void 0:e.typeRegistry)===null||t===void 0?void 0:t.findMessage(r);if(!s)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let o=s.fromBinary(this.value).toJson(e);return(r.startsWith("google.protobuf.")||o===null||Array.isArray(o)||typeof o!="object")&&(o={value:o}),o["@type"]=this.typeUrl,o}fromJson(e,t){var r;if(e===null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message google.protobuf.Any from JSON: expected object but got ${e===null?"null":Array.isArray(e)?"array":typeof e}`);if(Object.keys(e).length==0)return this;const s=e["@type"];if(typeof s!="string"||s=="")throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const i=this.typeUrlToName(s),o=(r=t==null?void 0:t.typeRegistry)===null||r===void 0?void 0:r.findMessage(i);if(!o)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${s} is not in the type registry`);let a;if(i.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value"))a=o.fromJson(e.value,t);else{const c=Object.assign({},e);delete c["@type"],a=o.fromJson(c,t)}return this.packFrom(a),this}packFrom(e){this.value=e.toBinary(),this.typeUrl=this.typeNameToUrl(e.getType().typeName)}unpackTo(e){return this.is(e.getType())?(e.fromBinary(this.value),!0):!1}unpack(e){if(this.typeUrl==="")return;const t=e.findMessage(this.typeUrlToName(this.typeUrl));if(t)return t.fromBinary(this.value)}is(e){if(this.typeUrl==="")return!1;const t=this.typeUrlToName(this.typeUrl);let r="";return typeof e=="string"?r=e:r=e.typeName,t===r}typeNameToUrl(e){return`type.googleapis.com/${e}`}typeUrlToName(e){if(!e.length)throw new Error(`invalid type url: ${e}`);const t=e.lastIndexOf("/"),r=t>=0?e.substring(t+1):e;if(!r.length)throw new Error(`invalid type url: ${e}`);return r}static pack(e){const t=new Tt;return t.packFrom(e),t}static fromBinary(e,t){return new Tt().fromBinary(e,t)}static fromJson(e,t){return new Tt().fromJson(e,t)}static fromJsonString(e,t){return new Tt().fromJsonString(e,t)}static equals(e,t){return p.util.equals(Tt,e,t)}}Tt.runtime=p;Tt.typeName="google.protobuf.Any";Tt.fields=p.util.newFieldList(()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]);class wt extends _e{constructor(e){super(),this.value=0,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.DOUBLE,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.DOUBLE,e)}catch(r){let s='cannot decode message google.protobuf.DoubleValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new wt().fromBinary(e,t)}static fromJson(e,t){return new wt().fromJson(e,t)}static fromJsonString(e,t){return new wt().fromJsonString(e,t)}static equals(e,t){return p.util.equals(wt,e,t)}}wt.runtime=p;wt.typeName="google.protobuf.DoubleValue";wt.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:1}]);wt.fieldWrapper={wrapField(n){return new wt({value:n})},unwrapField(n){return n.value}};class bt extends _e{constructor(e){super(),this.value=0,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.FLOAT,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.FLOAT,e)}catch(r){let s='cannot decode message google.protobuf.FloatValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new bt().fromBinary(e,t)}static fromJson(e,t){return new bt().fromJson(e,t)}static fromJsonString(e,t){return new bt().fromJsonString(e,t)}static equals(e,t){return p.util.equals(bt,e,t)}}bt.runtime=p;bt.typeName="google.protobuf.FloatValue";bt.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:2}]);bt.fieldWrapper={wrapField(n){return new bt({value:n})},unwrapField(n){return n.value}};class At extends _e{constructor(e){super(),this.value=ye.zero,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.INT64,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.INT64,e)}catch(r){let s='cannot decode message google.protobuf.Int64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new At().fromBinary(e,t)}static fromJson(e,t){return new At().fromJson(e,t)}static fromJsonString(e,t){return new At().fromJsonString(e,t)}static equals(e,t){return p.util.equals(At,e,t)}}At.runtime=p;At.typeName="google.protobuf.Int64Value";At.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:3}]);At.fieldWrapper={wrapField(n){return new At({value:n})},unwrapField(n){return n.value}};class It extends _e{constructor(e){super(),this.value=ye.zero,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.UINT64,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.UINT64,e)}catch(r){let s='cannot decode message google.protobuf.UInt64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new It().fromBinary(e,t)}static fromJson(e,t){return new It().fromJson(e,t)}static fromJsonString(e,t){return new It().fromJsonString(e,t)}static equals(e,t){return p.util.equals(It,e,t)}}It.runtime=p;It.typeName="google.protobuf.UInt64Value";It.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:4}]);It.fieldWrapper={wrapField(n){return new It({value:n})},unwrapField(n){return n.value}};class St extends _e{constructor(e){super(),this.value=0,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.INT32,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.INT32,e)}catch(r){let s='cannot decode message google.protobuf.Int32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new St().fromBinary(e,t)}static fromJson(e,t){return new St().fromJson(e,t)}static fromJsonString(e,t){return new St().fromJsonString(e,t)}static equals(e,t){return p.util.equals(St,e,t)}}St.runtime=p;St.typeName="google.protobuf.Int32Value";St.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:5}]);St.fieldWrapper={wrapField(n){return new St({value:n})},unwrapField(n){return n.value}};class kt extends _e{constructor(e){super(),this.value=0,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.UINT32,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.UINT32,e)}catch(r){let s='cannot decode message google.protobuf.UInt32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new kt().fromBinary(e,t)}static fromJson(e,t){return new kt().fromJson(e,t)}static fromJsonString(e,t){return new kt().fromJsonString(e,t)}static equals(e,t){return p.util.equals(kt,e,t)}}kt.runtime=p;kt.typeName="google.protobuf.UInt32Value";kt.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:13}]);kt.fieldWrapper={wrapField(n){return new kt({value:n})},unwrapField(n){return n.value}};class Et extends _e{constructor(e){super(),this.value=!1,p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.BOOL,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.BOOL,e)}catch(r){let s='cannot decode message google.protobuf.BoolValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new Et().fromBinary(e,t)}static fromJson(e,t){return new Et().fromJson(e,t)}static fromJsonString(e,t){return new Et().fromJsonString(e,t)}static equals(e,t){return p.util.equals(Et,e,t)}}Et.runtime=p;Et.typeName="google.protobuf.BoolValue";Et.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:8}]);Et.fieldWrapper={wrapField(n){return new Et({value:n})},unwrapField(n){return n.value}};class qe extends _e{constructor(e){super(),this.value="",p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.STRING,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.STRING,e)}catch(r){let s='cannot decode message google.protobuf.StringValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new qe().fromBinary(e,t)}static fromJson(e,t){return new qe().fromJson(e,t)}static fromJsonString(e,t){return new qe().fromJsonString(e,t)}static equals(e,t){return p.util.equals(qe,e,t)}}qe.runtime=p;qe.typeName="google.protobuf.StringValue";qe.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9}]);qe.fieldWrapper={wrapField(n){return new qe({value:n})},unwrapField(n){return n.value}};class xt extends _e{constructor(e){super(),this.value=new Uint8Array(0),p.util.initPartial(e,this)}toJson(e){return p.json.writeScalar(w.BYTES,this.value,!0)}fromJson(e,t){try{this.value=p.json.readScalar(w.BYTES,e)}catch(r){let s='cannot decode message google.protobuf.BytesValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(e,t){return new xt().fromBinary(e,t)}static fromJson(e,t){return new xt().fromJson(e,t)}static fromJsonString(e,t){return new xt().fromJsonString(e,t)}static equals(e,t){return p.util.equals(xt,e,t)}}xt.runtime=p;xt.typeName="google.protobuf.BytesValue";xt.fields=p.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:12}]);xt.fieldWrapper={wrapField(n){return new xt({value:n})},unwrapField(n){return n.value}};function Cd(n,e,t){try{const r=Xi.dec(n);return e?e.fromBinary(r,t):r}catch(r){throw pe.from(r,ee.DataLoss)}}function Od(n,e){const t={};for(const[r,s]of Object.entries(n.methods)){const i=e(Object.assign(Object.assign({},s),{localName:r,service:n}));i!=null&&(t[r]=i)}return t}function wa(n){let e,t=new Uint8Array(0);function r(s){const i=new Uint8Array(t.length+s.length);i.set(t),i.set(s,t.length),t=i}return new ReadableStream({start(){e=n.getReader()},async pull(s){let i;for(;;){if(i===void 0&&t.byteLength>=5){let c=0;for(let l=1;l<5;l++)c=(c<<8)+t[l];i={flags:t[0],length:c}}if(i!==void 0&&t.byteLength>=i.length+5)break;const a=await e.read();if(a.done)break;r(a.value)}if(i===void 0){if(t.byteLength==0){s.close();return}s.error(new pe("premature end of stream",ee.DataLoss));return}const o=t.subarray(5,5+i.length);t=t.subarray(5+i.length),s.enqueue({flags:i.flags,data:o})}})}function ba(n,e){const t=new Uint8Array(e.length+5);t.set(e,5);const r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setUint8(0,n),r.setUint32(1,e.length),t}var Pd=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}},Sr=function(n){return this instanceof Sr?(this.v=n,this):new Sr(n)},Dd=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(d){return function(A){return Promise.resolve(A).then(d,g)}}function a(d,A){r[d]&&(s[d]=function(x){return new Promise(function(R,L){i.push([d,x,R,L])>1||c(d,x)})},A&&(s[d]=A(s[d])))}function c(d,A){try{l(r[d](A))}catch(x){v(i[0][3],x)}}function l(d){d.value instanceof Sr?Promise.resolve(d.value.v).then(u,g):v(i[0][2],d)}function u(d){c("next",d)}function g(d){c("throw",d)}function v(d,A){d(A),i.shift(),i.length&&c(i[0][0],i[0][1])}},Rd=function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:Sr(n[s](o)),done:!1}:i?i(o):o}:i}};function _d(n){return Dd(this,arguments,function*(){yield Sr(yield*Rd(Pd(n)))})}var Xc=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,c){o=n[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}},Yn=function(n){return this instanceof Yn?(this.v=n,this):new Yn(n)},Fd=function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:Yn(n[s](o)),done:!1}:i?i(o):o}:i}},Md=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(d){return function(A){return Promise.resolve(A).then(d,g)}}function a(d,A){r[d]&&(s[d]=function(x){return new Promise(function(R,L){i.push([d,x,R,L])>1||c(d,x)})},A&&(s[d]=A(s[d])))}function c(d,A){try{l(r[d](A))}catch(x){v(i[0][3],x)}}function l(d){d.value instanceof Yn?Promise.resolve(d.value.v).then(u,g):v(i[0][2],d)}function u(d){c("next",d)}function g(d){c("throw",d)}function v(d,A){d(A),i.shift(),i.length&&c(i[0][0],i[0][1])}};function Bd(n,e){return Od(n,t=>{switch(t.kind){case Pe.Unary:return Ld(e,n,t);case Pe.ServerStreaming:return $d(e,n,t);case Pe.ClientStreaming:return Ud(e,n,t);case Pe.BiDiStreaming:return Jd(e,n,t);default:return null}})}function Ld(n,e,t){return async function(r,s){var i,o;const a=await n.unary(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues);return(i=s==null?void 0:s.onHeader)===null||i===void 0||i.call(s,a.header),(o=s==null?void 0:s.onTrailer)===null||o===void 0||o.call(s,a.trailer),a.message}}function $d(n,e,t){return function(r,s){return Zc(n.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,_d([r]),s==null?void 0:s.contextValues),s)}}function Ud(n,e,t){return async function(r,s){var i,o,a,c,l,u;const g=await n.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues);(l=s==null?void 0:s.onHeader)===null||l===void 0||l.call(s,g.header);let v;try{for(var d=!0,A=Xc(g.message),x;x=await A.next(),i=x.done,!i;d=!0)c=x.value,d=!1,v=c}catch(R){o={error:R}}finally{try{!d&&!i&&(a=A.return)&&await a.call(A)}finally{if(o)throw o.error}}if(!v)throw new pe("protocol error: missing response message",ee.Internal);return(u=s==null?void 0:s.onTrailer)===null||u===void 0||u.call(s,g.trailer),v}}function Jd(n,e,t){return function(r,s){return Zc(n.stream(e,t,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues),s)}}function Zc(n,e){const t=function(){var r,s;return Md(this,arguments,function*(){const i=yield Yn(n);(r=e==null?void 0:e.onHeader)===null||r===void 0||r.call(e,i.header),yield Yn(yield*Fd(Xc(i.message))),(s=e==null?void 0:e.onTrailer)===null||s===void 0||s.call(e,i.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function qd(...n){const e=new AbortController,t=n.filter(s=>s!==void 0).concat(e.signal);for(const s of t){if(s.aborted){r.apply(s);break}s.addEventListener("abort",r)}function r(){e.signal.aborted||e.abort(Qc(this));for(const s of t)s.removeEventListener("abort",r)}return e}function zd(n){const e=new AbortController,t=()=>{e.abort(new pe("the operation timed out",ee.DeadlineExceeded))};let r;return n!==void 0&&(n<=0?t():r=setTimeout(t,n)),{signal:e.signal,cleanup:()=>clearTimeout(r)}}function Qc(n){if(!n.aborted)return;if(n.reason!==void 0)return n.reason;const e=new Error("This operation was aborted");return e.name="AbortError",e}function Aa(){return{get(n){return n.id in this?this[n.id]:n.defaultValue},set(n,e){return this[n.id]=e,this},delete(n){return delete this[n.id],this}}}const ti=128;function Ia(n){const e=new Headers,t=new TextDecoder().decode(n).split(`\r
`);for(const r of t){if(r==="")continue;const s=r.indexOf(":");if(s>0){const i=r.substring(0,s).trim(),o=r.substring(s+1).trim();e.append(i,o)}}return e}const jd="Content-Type",Kd="Grpc-Timeout",el="Grpc-Status",tl="Grpc-Message",Vd="Grpc-Status-Details-Bin",Wd="X-User-Agent",Hd="X-Grpc-Web",Gd="application/grpc-web+proto",Yd="application/grpc-web+json";class Ut extends _e{constructor(e){super(),this.code=0,this.message="",this.details=[],p.util.initPartial(e,this)}static fromBinary(e,t){return new Ut().fromBinary(e,t)}static fromJson(e,t){return new Ut().fromJson(e,t)}static fromJsonString(e,t){return new Ut().fromJsonString(e,t)}static equals(e,t){return p.util.equals(Ut,e,t)}}Ut.runtime=p;Ut.typeName="google.rpc.Status";Ut.fields=p.util.newFieldList(()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:Tt,repeated:!0}]);const Xd="0";function nl(n){var e;const t=n.get(Vd);if(t!=null){const s=Cd(t,Ut);if(s.code==0)return;const i=new pe(s.message,s.code,n);return i.details=s.details.map(o=>({type:o.typeUrl.substring(o.typeUrl.lastIndexOf("/")+1),value:o.value})),i}const r=n.get(el);if(r!=null){if(r===Xd)return;const s=parseInt(r,10);return s in ee?new pe(decodeURIComponent((e=n.get(tl))!==null&&e!==void 0?e:""),s,n):new pe(`invalid grpc-status: ${r}`,ee.Internal,n)}}function Sa(n,e,t){const r=typeof e=="string"?e:e.typeName,s=typeof t=="string"?t:t.name;return n.toString().replace(/\/?$/,`/${r}/${s}`)}function rl(n,e){return e instanceof n?e:new n(e)}function Zd(n,e){function t(r){return r.done===!0?r:{done:r.done,value:rl(n,r.value)}}return{[Symbol.asyncIterator](){const r=e[Symbol.asyncIterator](),s={next:()=>r.next().then(t)};return r.throw!==void 0&&(s.throw=i=>r.throw(i).then(t)),r.return!==void 0&&(s.return=i=>r.return(i).then(t)),s}}}function sl(n,e){var t;return(t=e==null?void 0:e.concat().reverse().reduce((r,s)=>s(r),n))!==null&&t!==void 0?t:n}function Qd(n){var e;const t=Object.assign({},n);return(e=t.ignoreUnknownFields)!==null&&e!==void 0||(t.ignoreUnknownFields=!0),t}function ka(n,e,t,r){const s=e?Ea(n.I,r):xa(n.I,t);return{parse:(e?Ea(n.O,r):xa(n.O,t)).parse,serialize:s.serialize}}function Ea(n,e){return{parse(t){try{return n.fromBinary(t,e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new pe(`parse binary: ${s}`,ee.InvalidArgument)}},serialize(t){try{return t.toBinary(e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new pe(`serialize binary: ${s}`,ee.Internal)}}}}function xa(n,e){var t,r;const s=(t=e==null?void 0:e.textEncoder)!==null&&t!==void 0?t:new TextEncoder,i=(r=e==null?void 0:e.textDecoder)!==null&&r!==void 0?r:new TextDecoder,o=Qd(e);return{parse(a){try{const c=i.decode(a);return n.fromJsonString(c,o)}catch(c){throw pe.from(c,ee.InvalidArgument)}},serialize(a){try{const c=a.toJsonString(o);return s.encode(c)}catch(c){throw pe.from(c,ee.Internal)}}}}function eg(n){const e=sl(n.next,n.interceptors),[t,r,s]=il(n),i=Object.assign(Object.assign({},n.req),{message:rl(n.req.method.I,n.req.message),signal:t});return e(i).then(o=>(s(),o),r)}function tg(n){const e=sl(n.next,n.interceptors),[t,r,s]=il(n),i=Object.assign(Object.assign({},n.req),{message:Zd(n.req.method.I,n.req.message),signal:t});let o=!1;return t.addEventListener("abort",function(){var a,c;const l=n.req.message[Symbol.asyncIterator]();o||(a=l.throw)===null||a===void 0||a.call(l,this.reason).catch(()=>{}),(c=l.return)===null||c===void 0||c.call(l).catch(()=>{})}),e(i).then(a=>Object.assign(Object.assign({},a),{message:{[Symbol.asyncIterator](){const c=a.message[Symbol.asyncIterator]();return{next(){return c.next().then(l=>(l.done==!0&&(o=!0,s()),l),r)}}}}}),r)}function il(n){const{signal:e,cleanup:t}=zd(n.timeoutMs),r=qd(n.signal,e);return[r.signal,function(i){const o=pe.from(e.aborted?Qc(e):i);return r.abort(o),t(),Promise.reject(o)},function(){t(),r.abort()}]}function ng(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function Na(n,e){const t=nl(n);if(t)throw e.forEach((r,s)=>{t.metadata.append(s,r)}),t}function Ca(n,e,t,r){const s=new Headers(t??{});return s.set(jd,n?Gd:Yd),s.set(Hd,"1"),s.set(Wd,"connect-es/1.4.0"),e!==void 0&&s.set(Kd,`${e}m`),s}function rg(n){switch(n){case 400:return ee.Internal;case 401:return ee.Unauthenticated;case 403:return ee.PermissionDenied;case 404:return ee.Unimplemented;case 429:return ee.Unavailable;case 502:return ee.Unavailable;case 503:return ee.Unavailable;case 504:return ee.Unavailable;default:return ee.Unknown}}function Oa(n,e){var t;if(n>=200&&n<300){const r=nl(e);if(r)throw r;return{foundStatus:e.has(el)}}throw new pe(decodeURIComponent((t=e.get(tl))!==null&&t!==void 0?t:`HTTP ${n}`),rg(n),e)}var bn=function(n){return this instanceof bn?(this.v=n,this):new bn(n)},sg=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s={},a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(d){return function(A){return Promise.resolve(A).then(d,g)}}function a(d,A){r[d]&&(s[d]=function(x){return new Promise(function(R,L){i.push([d,x,R,L])>1||c(d,x)})},A&&(s[d]=A(s[d])))}function c(d,A){try{l(r[d](A))}catch(x){v(i[0][3],x)}}function l(d){d.value instanceof bn?Promise.resolve(d.value.v).then(u,g):v(i[0][2],d)}function u(d){c("next",d)}function g(d){c("throw",d)}function v(d,A){d(A),i.shift(),i.length&&c(i[0][0],i[0][1])}};function ig(n){var e;ng();const t=(e=n.useBinaryFormat)!==null&&e!==void 0?e:!0;return{async unary(r,s,i,o,a,c,l){var u;const{serialize:g,parse:v}=ka(s,t,n.jsonOptions,n.binaryOptions);return o=o===void 0?n.defaultTimeoutMs:o<=0?void 0:o,await eg({interceptors:n.interceptors,signal:i,timeoutMs:o,req:{stream:!1,service:r,method:s,url:Sa(n.baseUrl,r,s),init:{method:"POST",credentials:(u=n.credentials)!==null&&u!==void 0?u:"same-origin",redirect:"error",mode:"cors"},header:Ca(t,o,a),contextValues:l??Aa(),message:c},next:async d=>{var A;const R=await((A=n.fetch)!==null&&A!==void 0?A:globalThis.fetch)(d.url,Object.assign(Object.assign({},d.init),{headers:d.header,signal:d.signal,body:ba(0,g(d.message))}));if(Oa(R.status,R.headers),!R.body)throw"missing response body";const L=wa(R.body).getReader();let $,Y;for(;;){const P=await L.read();if(P.done)break;const{flags:H,data:Q}=P.value;if(H===ti){if($!==void 0)throw"extra trailer";$=Ia(Q);continue}if(Y!==void 0)throw"extra message";Y=v(Q)}if($===void 0)throw"missing trailer";if(Na($,R.headers),Y===void 0)throw"missing message";return{stream:!1,service:r,method:s,header:R.headers,message:Y,trailer:$}}})},async stream(r,s,i,o,a,c,l){var u;const{serialize:g,parse:v}=ka(s,t,n.jsonOptions,n.binaryOptions);function d(x,R,L,$){return sg(this,arguments,function*(){const P=wa(x).getReader();if(R){if(!(yield bn(P.read())).done)throw"extra data for trailers-only";return yield bn(void 0)}let H=!1;for(;;){const Q=yield bn(P.read());if(Q.done)break;const{flags:oe,data:Ie}=Q.value;if((oe&ti)===ti){if(H)throw"extra trailer";H=!0;const Qe=Ia(Ie);Na(Qe,$),Qe.forEach((Ve,fn)=>L.set(fn,Ve));continue}if(H)throw"extra message";yield yield bn(v(Ie))}if(!H)throw"missing trailer"})}async function A(x){if(s.kind!=Pe.ServerStreaming)throw"The fetch API does not support streaming request bodies";const R=await x[Symbol.asyncIterator]().next();if(R.done==!0)throw"missing request message";return ba(0,g(R.value))}return o=o===void 0?n.defaultTimeoutMs:o<=0?void 0:o,tg({interceptors:n.interceptors,signal:i,timeoutMs:o,req:{stream:!0,service:r,method:s,url:Sa(n.baseUrl,r,s),init:{method:"POST",credentials:(u=n.credentials)!==null&&u!==void 0?u:"same-origin",redirect:"error",mode:"cors"},header:Ca(t,o,a),contextValues:l??Aa(),message:c},next:async x=>{var R;const $=await((R=n.fetch)!==null&&R!==void 0?R:globalThis.fetch)(x.url,Object.assign(Object.assign({},x.init),{headers:x.header,signal:x.signal,body:await A(x.message)})),{foundStatus:Y}=Oa($.status,$.headers);if(!$.body)throw"missing response body";const P=new Headers;return Object.assign(Object.assign({},x),{header:$.headers,trailer:P,message:d($.body,Y,P,$.headers)})}})}}}const V=p.makeEnum("yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL",localName:"NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN",localName:"BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER",localName:"INTEGER"},{no:3,name:"VALUE_TYPE_LONG",localName:"LONG"},{no:4,name:"VALUE_TYPE_DOUBLE",localName:"DOUBLE"},{no:5,name:"VALUE_TYPE_STRING",localName:"STRING"},{no:6,name:"VALUE_TYPE_BYTES",localName:"BYTES"},{no:7,name:"VALUE_TYPE_DATE",localName:"DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT",localName:"JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY",localName:"JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT",localName:"TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT",localName:"INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT",localName:"LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE",localName:"TREE"}]),ws=p.makeEnum("yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED",localName:"DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED",localName:"DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED",localName:"DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST",localName:"DOCUMENT_BROADCAST"}]),og=p.makeMessageType("yorkie.v1.Snapshot",()=>[{no:1,name:"root",kind:"message",T:Ze},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:to}}]),Wt=p.makeMessageType("yorkie.v1.ChangePack",()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:kl},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:ol,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:B},{no:6,name:"is_removed",kind:"scalar",T:8}]),ol=p.makeMessageType("yorkie.v1.Change",()=>[{no:1,name:"id",kind:"message",T:Ms},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:Zi,repeated:!0},{no:4,name:"presence_change",kind:"message",T:Ai}]),Ms=p.makeMessageType("yorkie.v1.ChangeID",()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3,L:1},{no:3,name:"lamport",kind:"scalar",T:3,L:1},{no:4,name:"actor_id",kind:"scalar",T:12}]),Zi=p.makeMessageType("yorkie.v1.Operation",()=>[{no:1,name:"set",kind:"message",T:al,oneof:"body"},{no:2,name:"add",kind:"message",T:cl,oneof:"body"},{no:3,name:"move",kind:"message",T:ll,oneof:"body"},{no:4,name:"remove",kind:"message",T:ul,oneof:"body"},{no:5,name:"edit",kind:"message",T:fl,oneof:"body"},{no:6,name:"select",kind:"message",T:ag,oneof:"body"},{no:7,name:"style",kind:"message",T:hl,oneof:"body"},{no:8,name:"increase",kind:"message",T:dl,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:gl,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:ml,oneof:"body"}]),al=p.makeMessageType("yorkie.v1.Operation.Set",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:Bt},{no:4,name:"executed_at",kind:"message",T:B}],{localName:"Operation_Set"}),cl=p.makeMessageType("yorkie.v1.Operation.Add",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"prev_created_at",kind:"message",T:B},{no:3,name:"value",kind:"message",T:Bt},{no:4,name:"executed_at",kind:"message",T:B}],{localName:"Operation_Add"}),ll=p.makeMessageType("yorkie.v1.Operation.Move",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"prev_created_at",kind:"message",T:B},{no:3,name:"created_at",kind:"message",T:B},{no:4,name:"executed_at",kind:"message",T:B}],{localName:"Operation_Move"}),ul=p.makeMessageType("yorkie.v1.Operation.Remove",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"created_at",kind:"message",T:B},{no:3,name:"executed_at",kind:"message",T:B}],{localName:"Operation_Remove"}),fl=p.makeMessageType("yorkie.v1.Operation.Edit",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"from",kind:"message",T:xn},{no:3,name:"to",kind:"message",T:xn},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:B}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:B},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}],{localName:"Operation_Edit"}),ag=p.makeMessageType("yorkie.v1.Operation.Select",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"from",kind:"message",T:xn},{no:3,name:"to",kind:"message",T:xn},{no:4,name:"executed_at",kind:"message",T:B}],{localName:"Operation_Select"}),hl=p.makeMessageType("yorkie.v1.Operation.Style",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"from",kind:"message",T:xn},{no:3,name:"to",kind:"message",T:xn},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:B},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:B}}],{localName:"Operation_Style"}),dl=p.makeMessageType("yorkie.v1.Operation.Increase",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"value",kind:"message",T:Bt},{no:3,name:"executed_at",kind:"message",T:B}],{localName:"Operation_Increase"}),gl=p.makeMessageType("yorkie.v1.Operation.TreeEdit",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"from",kind:"message",T:kr},{no:3,name:"to",kind:"message",T:kr},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:B}},{no:5,name:"contents",kind:"message",T:Sl,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:B}],{localName:"Operation_TreeEdit"}),ml=p.makeMessageType("yorkie.v1.Operation.TreeStyle",()=>[{no:1,name:"parent_created_at",kind:"message",T:B},{no:2,name:"from",kind:"message",T:kr},{no:3,name:"to",kind:"message",T:kr},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:B},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:B}}],{localName:"Operation_TreeStyle"}),Bt=p.makeMessageType("yorkie.v1.JSONElementSimple",()=>[{no:1,name:"created_at",kind:"message",T:B},{no:2,name:"moved_at",kind:"message",T:B},{no:3,name:"removed_at",kind:"message",T:B},{no:4,name:"type",kind:"enum",T:p.getEnumType(V)},{no:5,name:"value",kind:"scalar",T:12}]),Ze=p.makeMessageType("yorkie.v1.JSONElement",()=>[{no:1,name:"json_object",kind:"message",T:pl,oneof:"body"},{no:2,name:"json_array",kind:"message",T:yl,oneof:"body"},{no:3,name:"primitive",kind:"message",T:vl,oneof:"body"},{no:5,name:"text",kind:"message",T:Tl,oneof:"body"},{no:6,name:"counter",kind:"message",T:wl,oneof:"body"},{no:7,name:"tree",kind:"message",T:bl,oneof:"body"}]),pl=p.makeMessageType("yorkie.v1.JSONElement.JSONObject",()=>[{no:1,name:"nodes",kind:"message",T:Al,repeated:!0},{no:2,name:"created_at",kind:"message",T:B},{no:3,name:"moved_at",kind:"message",T:B},{no:4,name:"removed_at",kind:"message",T:B}],{localName:"JSONElement_JSONObject"}),yl=p.makeMessageType("yorkie.v1.JSONElement.JSONArray",()=>[{no:1,name:"nodes",kind:"message",T:Qi,repeated:!0},{no:2,name:"created_at",kind:"message",T:B},{no:3,name:"moved_at",kind:"message",T:B},{no:4,name:"removed_at",kind:"message",T:B}],{localName:"JSONElement_JSONArray"}),vl=p.makeMessageType("yorkie.v1.JSONElement.Primitive",()=>[{no:1,name:"type",kind:"enum",T:p.getEnumType(V)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:B},{no:4,name:"moved_at",kind:"message",T:B},{no:5,name:"removed_at",kind:"message",T:B}],{localName:"JSONElement_Primitive"}),Tl=p.makeMessageType("yorkie.v1.JSONElement.Text",()=>[{no:1,name:"nodes",kind:"message",T:Il,repeated:!0},{no:2,name:"created_at",kind:"message",T:B},{no:3,name:"moved_at",kind:"message",T:B},{no:4,name:"removed_at",kind:"message",T:B}],{localName:"JSONElement_Text"}),wl=p.makeMessageType("yorkie.v1.JSONElement.Counter",()=>[{no:1,name:"type",kind:"enum",T:p.getEnumType(V)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:B},{no:4,name:"moved_at",kind:"message",T:B},{no:5,name:"removed_at",kind:"message",T:B}],{localName:"JSONElement_Counter"}),bl=p.makeMessageType("yorkie.v1.JSONElement.Tree",()=>[{no:1,name:"nodes",kind:"message",T:eo,repeated:!0},{no:2,name:"created_at",kind:"message",T:B},{no:3,name:"moved_at",kind:"message",T:B},{no:4,name:"removed_at",kind:"message",T:B}],{localName:"JSONElement_Tree"}),Al=p.makeMessageType("yorkie.v1.RHTNode",()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:Ze}]),Qi=p.makeMessageType("yorkie.v1.RGANode",()=>[{no:1,name:"next",kind:"message",T:Qi},{no:2,name:"element",kind:"message",T:Ze}]),Bs=p.makeMessageType("yorkie.v1.NodeAttr",()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:B},{no:3,name:"is_removed",kind:"scalar",T:8}]),Il=p.makeMessageType("yorkie.v1.TextNode",()=>[{no:1,name:"id",kind:"message",T:bi},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:B},{no:4,name:"ins_prev_id",kind:"message",T:bi},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Bs}}]),bi=p.makeMessageType("yorkie.v1.TextNodeID",()=>[{no:1,name:"created_at",kind:"message",T:B},{no:2,name:"offset",kind:"scalar",T:5}]),eo=p.makeMessageType("yorkie.v1.TreeNode",()=>[{no:1,name:"id",kind:"message",T:zn},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:B},{no:5,name:"ins_prev_id",kind:"message",T:zn},{no:6,name:"ins_next_id",kind:"message",T:zn},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Bs}}]),Sl=p.makeMessageType("yorkie.v1.TreeNodes",()=>[{no:1,name:"content",kind:"message",T:eo,repeated:!0}]),zn=p.makeMessageType("yorkie.v1.TreeNodeID",()=>[{no:1,name:"created_at",kind:"message",T:B},{no:2,name:"offset",kind:"scalar",T:5}]),kr=p.makeMessageType("yorkie.v1.TreePos",()=>[{no:1,name:"parent_id",kind:"message",T:zn},{no:2,name:"left_sibling_id",kind:"message",T:zn}]);p.makeMessageType("yorkie.v1.User",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"created_at",kind:"message",T:Se}]);p.makeMessageType("yorkie.v1.Project",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:7,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:8,name:"created_at",kind:"message",T:Se},{no:9,name:"updated_at",kind:"message",T:Se}]);p.makeMessageType("yorkie.v1.UpdatableProjectFields",()=>[{no:1,name:"name",kind:"message",T:qe},{no:2,name:"auth_webhook_url",kind:"message",T:qe},{no:3,name:"auth_webhook_methods",kind:"message",T:cg},{no:4,name:"client_deactivate_threshold",kind:"message",T:qe}]);const cg=p.makeMessageType("yorkie.v1.UpdatableProjectFields.AuthWebhookMethods",()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}],{localName:"UpdatableProjectFields_AuthWebhookMethods"});p.makeMessageType("yorkie.v1.DocumentSummary",()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"snapshot",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:Se},{no:5,name:"accessed_at",kind:"message",T:Se},{no:6,name:"updated_at",kind:"message",T:Se}]);const Ai=p.makeMessageType("yorkie.v1.PresenceChange",()=>[{no:1,name:"type",kind:"enum",T:p.getEnumType(Er)},{no:2,name:"presence",kind:"message",T:to}]),Er=p.makeEnum("yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED",localName:"UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT",localName:"PUT"},{no:2,name:"CHANGE_TYPE_DELETE",localName:"DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR",localName:"CLEAR"}]),to=p.makeMessageType("yorkie.v1.Presence",()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}]),kl=p.makeMessageType("yorkie.v1.Checkpoint",()=>[{no:1,name:"server_seq",kind:"scalar",T:3,L:1},{no:2,name:"client_seq",kind:"scalar",T:13}]),xn=p.makeMessageType("yorkie.v1.TextNodePos",()=>[{no:1,name:"created_at",kind:"message",T:B},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]),B=p.makeMessageType("yorkie.v1.TimeTicket",()=>[{no:1,name:"lamport",kind:"scalar",T:3,L:1},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}]),lg=p.makeMessageType("yorkie.v1.DocEventBody",()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]),ug=p.makeMessageType("yorkie.v1.DocEvent",()=>[{no:1,name:"type",kind:"enum",T:p.getEnumType(ws)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:lg}]),fg=p.makeMessageType("yorkie.v1.ActivateClientRequest",()=>[{no:1,name:"client_key",kind:"scalar",T:9}]),hg=p.makeMessageType("yorkie.v1.ActivateClientResponse",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),dg=p.makeMessageType("yorkie.v1.DeactivateClientRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9}]),gg=p.makeMessageType("yorkie.v1.DeactivateClientResponse",[]),mg=p.makeMessageType("yorkie.v1.AttachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:Wt}]),pg=p.makeMessageType("yorkie.v1.AttachDocumentResponse",()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:Wt}]),yg=p.makeMessageType("yorkie.v1.DetachDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Wt},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]),vg=p.makeMessageType("yorkie.v1.DetachDocumentResponse",()=>[{no:2,name:"change_pack",kind:"message",T:Wt}]),Tg=p.makeMessageType("yorkie.v1.WatchDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]),wg=p.makeMessageType("yorkie.v1.WatchDocumentResponse",()=>[{no:1,name:"initialization",kind:"message",T:bg,oneof:"body"},{no:2,name:"event",kind:"message",T:ug,oneof:"body"}]),bg=p.makeMessageType("yorkie.v1.WatchDocumentResponse.Initialization",()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}],{localName:"WatchDocumentResponse_Initialization"}),Ag=p.makeMessageType("yorkie.v1.RemoveDocumentRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Wt}]),Ig=p.makeMessageType("yorkie.v1.RemoveDocumentResponse",()=>[{no:1,name:"change_pack",kind:"message",T:Wt}]),Sg=p.makeMessageType("yorkie.v1.PushPullChangesRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:Wt},{no:4,name:"push_only",kind:"scalar",T:8}]),kg=p.makeMessageType("yorkie.v1.PushPullChangesResponse",()=>[{no:1,name:"change_pack",kind:"message",T:Wt}]),Eg=p.makeMessageType("yorkie.v1.BroadcastRequest",()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]),xg=p.makeMessageType("yorkie.v1.BroadcastResponse",[]),Ng={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:fg,O:hg,kind:Pe.Unary},deactivateClient:{name:"DeactivateClient",I:dg,O:gg,kind:Pe.Unary},attachDocument:{name:"AttachDocument",I:mg,O:pg,kind:Pe.Unary},detachDocument:{name:"DetachDocument",I:yg,O:vg,kind:Pe.Unary},removeDocument:{name:"RemoveDocument",I:Ag,O:Ig,kind:Pe.Unary},pushPullChanges:{name:"PushPullChanges",I:Sg,O:kg,kind:Pe.Unary},watchDocument:{name:"WatchDocument",I:Tg,O:wg,kind:Pe.ServerStreaming},broadcast:{name:"Broadcast",I:Eg,O:xg,kind:Pe.Unary}}};/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var He=null;try{He=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function z(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}z.prototype.__isLong__;Object.defineProperty(z.prototype,"__isLong__",{value:!0});function xe(n){return(n&&n.__isLong__)===!0}function Pa(n){var e=Math.clz32(n&-n);return n?31-e:e}z.isLong=xe;var Da={},Ra={};function On(n,e){var t,r,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(r=Ra[n],r)?r:(t=Z(n,0,!0),s&&(Ra[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(r=Da[n],r)?r:(t=Z(n,n<0?-1:0,!1),s&&(Da[n]=t),t))}z.fromInt=On;function Ge(n,e){if(isNaN(n))return e?Jt:ot;if(e){if(n<0)return Jt;if(n>=El)return Cl}else{if(n<=-Fa)return Be;if(n+1>=Fa)return Nl}return n<0?Ge(-n,e).neg():Z(n%Xn|0,n/Xn|0,e)}z.fromNumber=Ge;function Z(n,e,t){return new z(n,e,t)}z.fromBits=Z;var bs=Math.pow;function no(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?Jt:ot;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return no(n.substring(1),e,t).neg();for(var s=Ge(bs(t,8)),i=ot,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),c=parseInt(n.substring(o,o+a),t);if(a<8){var l=Ge(bs(t,a));i=i.mul(l).add(Ge(c))}else i=i.mul(s),i=i.add(Ge(c))}return i.unsigned=e,i}z.fromString=no;function ht(n,e){return typeof n=="number"?Ge(n,e):typeof n=="string"?no(n,e):Z(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}z.fromValue=ht;var _a=65536,Cg=1<<24,Xn=_a*_a,El=Xn*Xn,Fa=El/2,Ma=On(Cg),ot=On(0);z.ZERO=ot;var Jt=On(0,!0);z.UZERO=Jt;var Bn=On(1);z.ONE=Bn;var xl=On(1,!0);z.UONE=xl;var Ii=On(-1);z.NEG_ONE=Ii;var Nl=Z(-1,2147483647,!1);z.MAX_VALUE=Nl;var Cl=Z(-1,-1,!0);z.MAX_UNSIGNED_VALUE=Cl;var Be=Z(0,-2147483648,!1);z.MIN_VALUE=Be;var E=z.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low};E.toNumber=function(){return this.unsigned?(this.high>>>0)*Xn+(this.low>>>0):this.high*Xn+(this.low>>>0)};E.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Be)){var t=Ge(e),r=this.div(t),s=r.mul(t).sub(this);return r.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ge(bs(e,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=o.sub(c.mul(i)).toInt()>>>0,u=l.toString(e);if(o=c,o.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};E.getHighBits=function(){return this.high};E.getHighBitsUnsigned=function(){return this.high>>>0};E.getLowBits=function(){return this.low};E.getLowBitsUnsigned=function(){return this.low>>>0};E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Be)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return this.high!=0?t+33:t+1};E.isZero=function(){return this.high===0&&this.low===0};E.eqz=E.isZero;E.isNegative=function(){return!this.unsigned&&this.high<0};E.isPositive=function(){return this.unsigned||this.high>=0};E.isOdd=function(){return(this.low&1)===1};E.isEven=function(){return(this.low&1)===0};E.equals=function(e){return xe(e)||(e=ht(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};E.eq=E.equals;E.notEquals=function(e){return!this.eq(e)};E.neq=E.notEquals;E.ne=E.notEquals;E.lessThan=function(e){return this.comp(e)<0};E.lt=E.lessThan;E.lessThanOrEqual=function(e){return this.comp(e)<=0};E.lte=E.lessThanOrEqual;E.le=E.lessThanOrEqual;E.greaterThan=function(e){return this.comp(e)>0};E.gt=E.greaterThan;E.greaterThanOrEqual=function(e){return this.comp(e)>=0};E.gte=E.greaterThanOrEqual;E.ge=E.greaterThanOrEqual;E.compare=function(e){if(xe(e)||(e=ht(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};E.comp=E.compare;E.negate=function(){return!this.unsigned&&this.eq(Be)?Be:this.not().add(Bn)};E.neg=E.negate;E.add=function(e){xe(e)||(e=ht(e));var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,c=e.low>>>16,l=e.low&65535,u=0,g=0,v=0,d=0;return d+=i+l,v+=d>>>16,d&=65535,v+=s+c,g+=v>>>16,v&=65535,g+=r+a,u+=g>>>16,g&=65535,u+=t+o,u&=65535,Z(v<<16|d,u<<16|g,this.unsigned)};E.subtract=function(e){return xe(e)||(e=ht(e)),this.add(e.neg())};E.sub=E.subtract;E.multiply=function(e){if(this.isZero())return this;if(xe(e)||(e=ht(e)),He){var t=He.mul(this.low,this.high,e.low,e.high);return Z(t,He.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Jt:ot;if(this.eq(Be))return e.isOdd()?Be:ot;if(e.eq(Be))return this.isOdd()?Be:ot;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Ma)&&e.lt(Ma))return Ge(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,c=e.high&65535,l=e.low>>>16,u=e.low&65535,g=0,v=0,d=0,A=0;return A+=o*u,d+=A>>>16,A&=65535,d+=i*u,v+=d>>>16,d&=65535,d+=o*l,v+=d>>>16,d&=65535,v+=s*u,g+=v>>>16,v&=65535,v+=i*l,g+=v>>>16,v&=65535,v+=o*c,g+=v>>>16,v&=65535,g+=r*u+s*l+i*c+o*a,g&=65535,Z(d<<16|A,g<<16|v,this.unsigned)};E.mul=E.multiply;E.divide=function(e){if(xe(e)||(e=ht(e)),e.isZero())throw Error("division by zero");if(He){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?He.div_u:He.div_s)(this.low,this.high,e.low,e.high);return Z(t,He.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Jt:ot;var r,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Jt;if(e.gt(this.shru(1)))return xl;i=Jt}else{if(this.eq(Be)){if(e.eq(Bn)||e.eq(Ii))return Be;if(e.eq(Be))return Bn;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(ot)?e.isNegative()?Bn:Ii:(s=this.sub(e.mul(r)),i=r.add(s.div(e)),i)}else if(e.eq(Be))return this.unsigned?Jt:ot;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ot}for(s=this;s.gte(e);){r=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),c=a<=48?1:bs(2,a-48),l=Ge(r),u=l.mul(e);u.isNegative()||u.gt(s);)r-=c,l=Ge(r,this.unsigned),u=l.mul(e);l.isZero()&&(l=Bn),i=i.add(l),s=s.sub(u)}return i};E.div=E.divide;E.modulo=function(e){if(xe(e)||(e=ht(e)),He){var t=(this.unsigned?He.rem_u:He.rem_s)(this.low,this.high,e.low,e.high);return Z(t,He.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};E.mod=E.modulo;E.rem=E.modulo;E.not=function(){return Z(~this.low,~this.high,this.unsigned)};E.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};E.clz=E.countLeadingZeros;E.countTrailingZeros=function(){return this.low?Pa(this.low):Pa(this.high)+32};E.ctz=E.countTrailingZeros;E.and=function(e){return xe(e)||(e=ht(e)),Z(this.low&e.low,this.high&e.high,this.unsigned)};E.or=function(e){return xe(e)||(e=ht(e)),Z(this.low|e.low,this.high|e.high,this.unsigned)};E.xor=function(e){return xe(e)||(e=ht(e)),Z(this.low^e.low,this.high^e.high,this.unsigned)};E.shiftLeft=function(e){return xe(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Z(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Z(0,this.low<<e-32,this.unsigned)};E.shl=E.shiftLeft;E.shiftRight=function(e){return xe(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Z(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Z(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};E.shr=E.shiftRight;E.shiftRightUnsigned=function(e){return xe(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Z(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Z(this.high,0,this.unsigned):Z(this.high>>>e-32,0,this.unsigned)};E.shru=E.shiftRightUnsigned;E.shr_u=E.shiftRightUnsigned;E.rotateLeft=function(e){var t;return xe(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Z(this.high,this.low,this.unsigned):e<32?(t=32-e,Z(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Z(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};E.rotl=E.rotateLeft;E.rotateRight=function(e){var t;return xe(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Z(this.high,this.low,this.unsigned):e<32?(t=32-e,Z(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Z(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};E.rotr=E.rotateRight;E.toSigned=function(){return this.unsigned?Z(this.low,this.high,!1):this};E.toUnsigned=function(){return this.unsigned?this:Z(this.low,this.high,!0)};E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};E.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};z.fromBytes=function(e,t,r){return r?z.fromBytesLE(e,t):z.fromBytesBE(e,t)};z.fromBytesLE=function(e,t){return new z(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};z.fromBytesBE=function(e,t){return new z(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};const Og=p.makeMessageType("google.rpc.ErrorInfo",()=>[{no:1,name:"reason",kind:"scalar",T:9},{no:2,name:"domain",kind:"scalar",T:9},{no:3,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]);p.makeMessageType("google.rpc.RetryInfo",()=>[{no:1,name:"retry_delay",kind:"message",T:$t}]);p.makeMessageType("google.rpc.DebugInfo",()=>[{no:1,name:"stack_entries",kind:"scalar",T:9,repeated:!0},{no:2,name:"detail",kind:"scalar",T:9}]);p.makeMessageType("google.rpc.QuotaFailure",()=>[{no:1,name:"violations",kind:"message",T:Pg,repeated:!0}]);const Pg=p.makeMessageType("google.rpc.QuotaFailure.Violation",()=>[{no:1,name:"subject",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"QuotaFailure_Violation"});p.makeMessageType("google.rpc.PreconditionFailure",()=>[{no:1,name:"violations",kind:"message",T:Dg,repeated:!0}]);const Dg=p.makeMessageType("google.rpc.PreconditionFailure.Violation",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"subject",kind:"scalar",T:9},{no:3,name:"description",kind:"scalar",T:9}],{localName:"PreconditionFailure_Violation"});p.makeMessageType("google.rpc.BadRequest",()=>[{no:1,name:"field_violations",kind:"message",T:Rg,repeated:!0}]);const Rg=p.makeMessageType("google.rpc.BadRequest.FieldViolation",()=>[{no:1,name:"field",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"BadRequest_FieldViolation"});p.makeMessageType("google.rpc.RequestInfo",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"serving_data",kind:"scalar",T:9}]);p.makeMessageType("google.rpc.ResourceInfo",()=>[{no:1,name:"resource_type",kind:"scalar",T:9},{no:2,name:"resource_name",kind:"scalar",T:9},{no:3,name:"owner",kind:"scalar",T:9},{no:4,name:"description",kind:"scalar",T:9}]);p.makeMessageType("google.rpc.Help",()=>[{no:1,name:"links",kind:"message",T:_g,repeated:!0}]);const _g=p.makeMessageType("google.rpc.Help.Link",()=>[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9}],{localName:"Help_Link"});p.makeMessageType("google.rpc.LocalizedMessage",()=>[{no:1,name:"locale",kind:"scalar",T:9},{no:2,name:"message",kind:"scalar",T:9}]);var y=(n=>(n.Ok="ok",n.ErrClientNotActivated="ErrClientNotActivated",n.ErrClientNotFound="ErrClientNotFound",n.ErrUnimplemented="ErrUnimplemented",n.ErrInvalidType="ErrInvalidType",n.ErrDummy="ErrDummy",n.ErrDocumentNotAttached="ErrDocumentNotAttached",n.ErrDocumentNotDetached="ErrDocumentNotDetached",n.ErrDocumentRemoved="ErrDocumentRemoved",n.ErrInvalidObjectKey="ErrInvalidObjectKey",n.ErrInvalidArgument="ErrInvalidArgument",n.ErrNotInitialized="ErrNotInitialized",n.ErrNotReady="ErrNotReady",n.ErrRefused="ErrRefused",n.ErrContextNotProvided="ErrContextNotProvided",n))(y||{});class T extends Error{constructor(t,r){super(r);h(this,"name","YorkieError");h(this,"stack");this.code=t,this.message=r,this.toString=()=>`[code=${this.code}]: ${this.message}`}}function nt(n){if(n instanceof Map){const e=Array.from(n);return new Map(JSON.parse(JSON.stringify(e)))}return JSON.parse(JSON.stringify(n))}const Ol=n=>n?Object.entries(n).length===0:!0,Zn=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.stringify(r);return e},jn=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.parse(r);return e};var ln=(n=>(n.Put="put",n.Clear="clear",n))(ln||{});class ni{constructor(e,t){h(this,"context");h(this,"presence");this.context=e,this.presence=t}set(e,t){for(const r of Object.keys(e))this.presence[r]=e[r];this.context.setPresenceChange({type:"put",presence:nt(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:"clear"})}}const Ls="000000000000000000000000",Fg="FFFFFFFFFFFFFFFFFFFFFFFF";class Le{constructor(e,t,r){h(this,"lamport");h(this,"delimiter");h(this,"actorID");this.lamport=e,this.delimiter=t,this.actorID=r}static of(e,t,r){return new Le(e,t,r)}static fromStruct(e){return Le.of(z.fromString(e.lamport,!0),e.delimiter,e.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(e){return new Le(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return this.compare(e)===0}compare(e){if(this.lamport.greaterThan(e.lamport))return 1;if(e.lamport.greaterThan(this.lamport))return-1;const t=this.actorID.localeCompare(e.actorID);return t!==0?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}}const ro=0,Mg=4294967295,Bg=z.MAX_VALUE,lt=new Le(z.fromNumber(0),ro,Ls);new Le(z.fromNumber(1),ro+1,Ls);const mr=new Le(Bg,Mg,Fg);function Nt(n){return n.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class Rr{constructor(e){h(this,"createdAt");h(this,"movedAt");h(this,"removedAt");this.createdAt=e}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setMovedAt(e){return!this.movedAt||e&&e.after(this.movedAt)?(this.movedAt=e,!0):!1}setRemovedAt(e){this.removedAt=e}remove(e){return e&&e.after(this.getPositionedAt())&&(!this.removedAt||e.after(this.removedAt))?(this.removedAt=e,!0):!1}isRemoved(){return!!this.removedAt}}class sn extends Rr{constructor(e){super(e)}}class so{constructor(e,t){h(this,"strKey");h(this,"value");this.strKey=e,this.value=t}static of(e,t){return new so(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}}class xr{constructor(){h(this,"nodeMapByKey");h(this,"nodeMapByCreatedAt");this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new xr}set(e,t,r){let s;const i=this.nodeMapByKey.get(e);i!=null&&!i.isRemoved()&&i.remove(r)&&(s=i.getValue());const o=so.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),o),(i==null||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,o),t.setMovedAt(r)),s}delete(e,t){if(!this.nodeMapByCreatedAt.has(e.toIDString()))throw new T(y.ErrInvalidArgument,`fail to find ${e.toIDString()}`);const r=this.nodeMapByCreatedAt.get(e.toIDString());return r.remove(t),r.getValue()}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return t.getStrKey()}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new T(y.ErrInvalidArgument,`fail to find ${e.getCreatedAt().toIDString()}`);const r=this.nodeMapByKey.get(t.getStrKey());t===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){const r=this.nodeMapByKey.get(e);if(r!=null&&r.remove(t))return r.getValue()}has(e){const t=this.nodeMapByKey.get(e);return t==null?!1:!t.isRemoved()}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){const t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}}class $e extends sn{constructor(t,r){super(t);h(this,"memberNodes");this.memberNodes=r}static create(t,r){if(!r)return new $e(t,xr.create());const s=xr.create();for(const[i,o]of Object.entries(r))s.set(i,o.deepcopy(),o.getCreatedAt());return new $e(t,s)}subPathOf(t){return this.memberNodes.subPathOf(t)}purge(t){this.memberNodes.purge(t)}set(t,r,s){return this.memberNodes.set(t,r,s)}delete(t,r){return this.memberNodes.delete(t,r)}deleteByKey(t,r){return this.memberNodes.deleteByKey(t,r)}get(t){const r=this.memberNodes.get(t);return r==null?void 0:r.getValue()}getByID(t){const r=this.memberNodes.getByID(t);return r==null?void 0:r.getValue()}has(t){return this.memberNodes.has(t)}toJSON(){const t=[];for(const[r,s]of this)t.push(`"${Nt(r)}":${s.toJSON()}`);return`{${t.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const t={};for(const[r,s]of this){const{createdAt:i,value:o,type:a}=s.toJSForTest();t[r]={key:r,createdAt:i,value:o,type:a}}return{createdAt:this.getCreatedAt().toTestString(),value:t,type:"YORKIE_OBJECT"}}getKeys(){const t=Array();for(const[r]of this)t.push(r);return t}toSortedJSON(){var s;const t=Array();for(const[i]of this)t.push(i);const r=[];for(const i of t.sort()){const o=(s=this.memberNodes.get(i))==null?void 0:s.getValue();r.push(`"${Nt(i)}":${o.toSortedJSON()}`)}return`{${r.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const t=$e.create(this.getCreatedAt());for(const r of this.memberNodes)t.memberNodes.set(r.getStrKey(),r.getValue().deepcopy(),this.getPositionedAt());return t.remove(this.getRemovedAt()),t}getDescendants(t){for(const r of this.memberNodes){const s=r.getValue();if(t(s,this))return;s instanceof sn&&s.getDescendants(t)}}*[Symbol.iterator](){const t=new Set;for(const r of this.memberNodes)t.has(r.getStrKey())||(t.add(r.getStrKey()),r.isRemoved()||(yield[r.getStrKey(),r.getValue()]))}}var re=(n=>(n.Local="local",n.Remote="remote",n.UndoRedo="undoredo",n))(re||{});class ft{constructor(e,t){h(this,"parentCreatedAt");h(this,"executedAt");this.parentCreatedAt=e,this.executedAt=t}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new T(y.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}}class Pl{constructor(e){h(this,"value");h(this,"left");h(this,"right");h(this,"parent");h(this,"weight");this.value=e,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}}class Nr{constructor(e){h(this,"root");this.root=e}get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}if(e>t.getLength())throw new T(y.ErrInvalidArgument,`out of index range: pos: ${e} > node.length: ${t.getLength()}`);return[t,e]}indexOf(e){if(!e||e!==this.root&&!e.hasLinks())return-1;let t=0,r=e,s;for(;r;)(!s||s===r.getRight())&&(t+=r.getLength()+(r.hasLeft()?r.getLeftWeight():0)),s=r,r=r.getParent();return t-e.getLength()}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t),t):(this.root=t,t)}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);const t=new Nr(e.getLeft());t.root&&t.root.setParent();const r=new Nr(e.getRight());if(r.root&&r.root.setParent(),t.root){const s=t.getRightmost();t.splayNode(s),t.root.setRight(r.root),r.root&&r.root.setParent(t.root),this.root=t.root}else this.root=r.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){const t=[];this.traversePostorder(e.getRight(),t);for(const r of t)r.initWeight();this.updateTreeWeight(e)}toTestString(){const e=[];return this.traverseInorder(this.root,e),e.map(t=>`[${t.getWeight()},${t.getLength()}]${t.getValue()||""}`).join("")}checkWeight(){const e=[];this.traverseInorder(this.root,e);for(const t of e)if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){e&&(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){e&&(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return e&&e.hasParent()?e.getParent().getLeft()===e:!1}isRightChild(e){return e&&e.hasParent()?e.getParent().getRight()===e:!1}}var ve=(n=>(n[n.Null=0]="Null",n[n.Boolean=1]="Boolean",n[n.Integer=2]="Integer",n[n.Long=3]="Long",n[n.Double=4]="Double",n[n.String=5]="String",n[n.Bytes=6]="Bytes",n[n.Date=7]="Date",n))(ve||{});class ce extends Rr{constructor(t,r){super(r);h(this,"valueType");h(this,"value");this.valueType=ce.getPrimitiveType(t),this.value=t===void 0?null:t}static of(t,r){return new ce(t,r)}static valueFromBytes(t,r){switch(t){case 0:return null;case 1:return!!r[0];case 2:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 4:{const s=new DataView(r.buffer);return r.forEach(function(i,o){s.setUint8(o,i)}),s.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(r);case 3:return z.fromBytesLE(Array.from(r));case 6:return r;case 7:return new Date(z.fromBytesLE(Array.from(r),!0).toNumber());default:throw new T(y.ErrUnimplemented,`unimplemented type: ${t}`)}}toJSON(){return this.valueType===5?`"${Nt(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const t=ce.of(this.value,this.getCreatedAt());return t.setMovedAt(this.getMovedAt()),t.setRemovedAt(this.getRemovedAt()),t}getType(){return this.valueType}static getPrimitiveType(t){switch(typeof t){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(t)?2:4;case"string":return 5;case"object":if(t===null)return 0;if(t instanceof z)return 3;if(t instanceof Uint8Array)return 6;if(t instanceof Date)return 7}}static isSupport(t){return ce.getPrimitiveType(t)!==void 0}static isInteger(t){return t%1===0}isNumericType(){const t=this.valueType;return t===2||t===3||t===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const t=this.value;return new Uint8Array([t&255,t>>8&255,t>>16&255,t>>24&255])}case 4:{const t=this.value,r=new Uint8Array(8);return new DataView(r.buffer).setFloat64(0,t,!0),r}case 5:return new TextEncoder().encode(this.value);case 3:{const r=this.value.toBytesLE();return Uint8Array.from(r)}case 6:return this.value;case 7:{const t=this.value,r=z.fromNumber(t.getTime(),!0).toBytesLE();return Uint8Array.from(r)}default:throw new T(y.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class As extends Pl{constructor(t){super(t);h(this,"prev");h(this,"next");this.value=t}static createAfter(t,r){const s=new As(r),i=t.next;return t.next=s,s.prev=t,s.next=i,i&&(i.prev=s),s}remove(t){return this.value.remove(t)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class Cr{constructor(){h(this,"dummyHead");h(this,"last");h(this,"nodeMapByIndex");h(this,"nodeMapByCreatedAt");const e=ce.of(0,lt);e.setRemovedAt(lt),this.dummyHead=new As(e),this.last=this.dummyHead,this.nodeMapByIndex=new Nr,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new Cr}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString());if(!r)throw new T(y.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);for(;r.getNext()&&r.getNext().getPositionedAt().after(t);)r=r.getNext();return r}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t,r=t.getCreatedAt()){const s=this.findNextBeforeExecutedAt(e,r),i=As.createAfter(s,t);s===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(s,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i)}moveAfter(e,t,r){const s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new T(y.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);const i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new T(y.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);s!==i&&(!i.getValue().getMovedAt()||r.after(i.getValue().getMovedAt()))&&(this.release(i),this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r))}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new T(y.ErrInvalidArgument,`fail to find the given createdAt: ${e.getCreatedAt().toIDString()}`);this.release(t)}getByIndex(e){if(e>=this.length)return;const[t,r]=this.nodeMapByIndex.find(e);let s=t;if(e===0&&t===this.dummyHead||r>0)do s&&(s=s.getNext());while(s&&s.isRemoved());return s}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){const r=this.nodeMapByCreatedAt.get(e.toIDString()),s=r.isRemoved();return r.remove(t)&&!s&&this.nodeMapByIndex.splayNode(r),r.getValue()}deleteByIndex(e,t){const r=this.getByIndex(e);if(r)return r.remove(t)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const e=[];for(const t of this){const r=`${t.getCreatedAt().toIDString()}:${t.getValue().toJSON()}`;t.isRemoved()?e.push(`{${r}}`):e.push(`[${r}]`)}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}}class je extends sn{constructor(t,r){super(t);h(this,"elements");this.elements=r}static create(t,r){if(!r)return new je(t,Cr.create());const s=Cr.create();for(const i of r)s.insertAfter(s.getLastCreatedAt(),i.deepcopy());return new je(t,s)}subPathOf(t){return this.elements.subPathOf(t)}purge(t){this.elements.purge(t)}insertAfter(t,r){this.elements.insertAfter(t,r)}moveAfter(t,r,s){this.elements.moveAfter(t,r,s)}get(t){const r=this.elements.getByIndex(t);return r==null?void 0:r.getValue()}getByID(t){const r=this.elements.getByID(t);return r==null?void 0:r.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(t){return this.elements.getPrevCreatedAt(t)}delete(t,r){return this.elements.delete(t,r)}deleteByIndex(t,r){return this.elements.deleteByIndex(t,r)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const t of this.elements)t.isRemoved()||(yield t.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(t){for(const r of this.elements){const s=r.getValue();if(t(s,this))return;s instanceof sn&&s.getDescendants(t)}}toJSON(){const t=[];for(const r of this)t.push(r.toJSON());return`[${t.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const t={};for(let r=0;r<this.length;r++){const{createdAt:s,value:i,type:o}=this.get(r).toJSForTest();t[r]={key:String(r),createdAt:s,value:i,type:o}}return{createdAt:this.getCreatedAt().toTestString(),value:t,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const t=je.create(this.getCreatedAt());for(const r of this.elements)t.elements.insertAfter(t.getLastCreatedAt(),r.getValue().deepcopy());return t.remove(this.getRemovedAt()),t}}class un extends ft{constructor(t,r,s){super(t,s);h(this,"createdAt");this.createdAt=r}static create(t,r,s){return new un(t,r,s)}execute(t,r){var l;const s=t.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof sn))throw new T(y.ErrInvalidArgument,`only object and array can execute remove: ${s}`);if(r===re.UndoRedo){let u=s.getByID(this.createdAt);for(;u;){if(u.getRemovedAt())return;u=(l=t.findElementPairByCreatedAt(u.getCreatedAt()))==null?void 0:l.parent}}const i=s.subPathOf(this.createdAt),o=this.toReverseOperation(s),a=s.delete(this.createdAt,this.getExecutedAt());return t.registerRemovedElement(a),{opInfos:s instanceof je?[{type:"remove",path:t.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:t.createPath(this.getParentCreatedAt()),key:i}],reverseOp:o}}toReverseOperation(t){if(t instanceof $e){const r=t.subPathOf(this.createdAt);if(r!==void 0){const s=t.get(r);if(s!==void 0)return Nn.create(r,s.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}}class Nn extends ft{constructor(t,r,s,i){super(s,i);h(this,"key");h(this,"value");this.key=t,this.value=r}static create(t,r,s,i){return new Nn(t,r,s,i)}execute(t,r){var l;const s=t.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof $e))throw new T(y.ErrInvalidArgument,"fail to execute, only object can execute set");if(r===re.UndoRedo){let u=s;for(;u;){if(u.getRemovedAt())return;u=(l=t.findElementPairByCreatedAt(u.getCreatedAt()))==null?void 0:l.parent}}const i=s.get(this.key),o=this.toReverseOperation(i),a=this.value.deepcopy(),c=s.set(this.key,a,this.getExecutedAt());return r===re.UndoRedo&&t.findByCreatedAt(a.getCreatedAt())&&t.deregisterElement(a),t.registerElement(a,s),c&&t.registerRemovedElement(c),{opInfos:[{type:"set",path:t.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:o}}toReverseOperation(t){let r=un.create(this.getParentCreatedAt(),this.value.getCreatedAt());return t!==void 0&&!t.isRemoved()&&(r=Nn.create(this.key,t.deepcopy(),this.getParentCreatedAt())),r}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class _r extends ft{constructor(t,r,s,i){super(t,i);h(this,"prevCreatedAt");h(this,"value");this.prevCreatedAt=r,this.value=s}static create(t,r,s,i){return new _r(t,r,s,i)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof je))throw new T(y.ErrInvalidArgument,"fail to execute, only array can execute add");const s=r,i=this.value.deepcopy();return s.insertAfter(this.prevCreatedAt,i),t.registerElement(i,s),{opInfos:[{type:"add",path:t.createPath(this.getParentCreatedAt()),index:Number(s.subPathOf(this.getEffectedCreatedAt()))}]}}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}}class tn extends ft{constructor(t,r,s,i){super(t,i);h(this,"prevCreatedAt");h(this,"createdAt");this.prevCreatedAt=r,this.createdAt=s}static create(t,r,s,i){return new tn(t,r,s,i)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof je))throw new T(y.ErrInvalidArgument,"fail to execute, only array can execute move");const s=r,i=Number(s.subPathOf(this.createdAt));s.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const o=Number(s.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:t.createPath(this.getParentCreatedAt()),index:o,previousIndex:i}]}}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}}class An{constructor(e,t,r,s){h(this,"key");h(this,"value");h(this,"updatedAt");h(this,"_isRemoved");this.key=e,this.value=t,this.updatedAt=r,this._isRemoved=s}static of(e,t,r,s){return new An(e,t,r,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}}class Kt{constructor(){h(this,"nodeMapByKey");h(this,"numberOfRemovedElement");this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new Kt}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,r){const s=this.nodeMapByKey.get(e);if(s&&s.isRemoved()&&r.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||r.after(s.getUpdatedAt())){const i=An.of(e,t,r,!1);return this.nodeMapByKey.set(e,i),s!==void 0&&s.isRemoved()?[s,i]:[void 0,i]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(e,t,r,s){const i=An.of(e,t,r,s);this.nodeMapByKey.set(e,i),s&&this.numberOfRemovedElement++}remove(e,t){const r=this.nodeMapByKey.get(e),s=[];if(r===void 0||t.after(r.getUpdatedAt())){if(r===void 0){this.numberOfRemovedElement+=1;const a=An.of(e,"",t,!0);return this.nodeMapByKey.set(e,a),s.push(a),s}const i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&s.push(r);const o=An.of(e,r.getValue(),t,!0);return this.nodeMapByKey.set(e,o),s.push(o),s}return s}has(e){if(this.nodeMapByKey.has(e)){const t=this.nodeMapByKey.get(e);return t!==void 0&&!t.isRemoved()}return!1}get(e){if(this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){const e=new Kt;for(const[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";const e=[];for(const[t,r]of this.nodeMapByKey)r.isRemoved()||e.push(`"${Nt(t)}":"${Nt(r.getValue())}"`);return`{${e.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const e={};for(const[t,r]of this.nodeMapByKey)r.isRemoved()||(e[t]=r.getValue());return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}purge(e){const t=this.nodeMapByKey.get(e.getKey());t==null||t.toIDString()!=e.toIDString()||(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}}class Or{constructor(e){h(this,"attributes");h(this,"content");this.attributes=Kt.create(),this.content=e}static create(e){return new Or(e)}get length(){return this.content.length}substring(e,t){const r=new Or(this.content.substring(e,t));return r.attributes=this.attributes.deepcopy(),r}setAttr(e,t,r){return this.attributes.set(e,t,r)}getAttrs(){return this.attributes}toString(){return this.content}toJSON(){const e=Nt(this.content),t=this.attributes.toObject(),r=[];for(const[s,i]of Object.entries(t)){const o=JSON.parse(i),a=typeof o=="string"?`"${Nt(s)}":"${Nt(o)}"`:`"${Nt(s)}":${String(o)}`;r.push(a)}return r.sort(),r.length===0?`{"val":"${e}"}`:`{"attrs":{${r.join(",")}},"val":"${e}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof An&&this.attributes.purge(e)}getGCPairs(){const e=[];for(const t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}class Ye extends Rr{constructor(t,r){super(r);h(this,"rgaTreeSplit");this.rgaTreeSplit=t}static create(t,r){return new Ye(t,r)}edit(t,r,s,i,o){const a=r?Or.create(r):void 0;if(a&&i)for(const[d,A]of Object.entries(i))a.setAttr(d,A,s);const[c,l,u,g]=this.rgaTreeSplit.edit(t,s,a,o),v=g.map(d=>({...d,value:d.value?{attributes:jn(d.value.getAttributes()),content:d.value.getContent()}:{attributes:void 0,content:""},type:"content"}));return[l,v,u,[c,c]]}setStyle(t,r,s,i){const[,o]=this.rgaTreeSplit.findNodeWithSplit(t[1],s),[,a]=this.rgaTreeSplit.findNodeWithSplit(t[0],s),c=[],l=this.rgaTreeSplit.findBetween(a,o),u=new Map,g=[];for(const d of l){const A=d.getCreatedAt().getActorID(),x=i!=null&&i.size?i.has(A)?i.get(A):lt:mr;if(d.canStyle(s,x)){const R=u.get(A),L=d.getCreatedAt();(!R||L.after(R))&&u.set(A,L),g.push(d)}}const v=[];for(const d of g){if(d.isRemoved())continue;const[A,x]=this.rgaTreeSplit.findIndexesFromRange(d.createPosRange());c.push({type:"style",actor:s.getActorID(),from:A,to:x,value:{attributes:jn(r)}});for(const[R,L]of Object.entries(r)){const[$]=d.getValue().setAttr(R,L,s);$!==void 0&&v.push({parent:d.getValue(),child:$})}}return[u,v,c]}indexRangeToPosRange(t,r){const s=this.rgaTreeSplit.indexToPos(t);return t===r?[s,s]:[s,this.rgaTreeSplit.indexToPos(r)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}toJSON(){const t=[];for(const r of this.rgaTreeSplit)r.isRemoved()||t.push(r.getValue().toJSON());return`[${t.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const t=[];for(const r of this.rgaTreeSplit)if(!r.isRemoved()){const s=r.getValue();t.push({attributes:jn(s.getAttributes()),content:s.getContent()})}return t}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const t=new Ye(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return t.remove(this.getRemovedAt()),t}findIndexesFromRange(t){return this.rgaTreeSplit.findIndexesFromRange(t)}getGCPairs(){const t=[];for(const r of this.rgaTreeSplit){r.getRemovedAt()&&t.push({parent:this.rgaTreeSplit,child:r});for(const s of r.getValue().getGCPairs())t.push(s)}return t}}class Fr extends ft{constructor(t,r,s,i,o,a,c){super(t,c);h(this,"fromPos");h(this,"toPos");h(this,"maxCreatedAtMapByActor");h(this,"content");h(this,"attributes");this.fromPos=r,this.toPos=s,this.maxCreatedAtMapByActor=i,this.content=o,this.attributes=a}static create(t,r,s,i,o,a,c){return new Fr(t,r,s,i,o,a,c)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof Ye))throw new T(y.ErrInvalidArgument,"fail to execute, only Text can execute edit");const s=r,[,i,o]=s.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),this.maxCreatedAtMapByActor);for(const a of o)t.registerGCPair(a);return{opInfos:i.map(({from:a,to:c,value:l})=>({type:"edit",from:a,to:c,value:l,path:t.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),s=this.toPos.toTestString(),i=this.content;return`${t}.EDIT(${r},${s},${i})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class Mr extends ft{constructor(t,r,s,i,o,a){super(t,a);h(this,"fromPos");h(this,"toPos");h(this,"maxCreatedAtMapByActor");h(this,"attributes");this.fromPos=r,this.toPos=s,this.maxCreatedAtMapByActor=i,this.attributes=o}static create(t,r,s,i,o,a){return new Mr(t,r,s,i,o,a)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof Ye))throw new T(y.ErrInvalidArgument,"fail to execute, only Text can execute edit");const s=r,[,i,o]=s.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),this.maxCreatedAtMapByActor);for(const a of i)t.registerGCPair(a);return{opInfos:o.map(({from:a,to:c,value:l})=>({type:"style",from:a,to:c,value:l,path:t.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),s=this.toPos.toTestString(),i=this.attributes;return`${t}.STYL(${r},${s},${JSON.stringify(i)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}const Lg=2,$g="root",qt="text";function cr(n,e){let t=0;const r=n.children;for(let s=0;s<e;s++){const i=r[s];!i||i.isRemoved||(t+=i.paddedSize)}return t}class Ug{constructor(e,t=[]){h(this,"type");h(this,"parent");h(this,"_children");h(this,"size");if(this.type=e,this.size=0,this._children=t,this.isText&&this._children.length>0)throw new T(y.ErrRefused,"Text node cannot have children")}updateAncestorsSize(){let e=this.parent;const t=this.isRemoved?-1:1;for(;e&&(e.size+=this.paddedSize*t,!e.isRemoved);)e=e.parent}updateDescendantsSize(){let e=0;for(const t of this._children){const r=t.updateDescendantsSize();t.isRemoved||(e+=r)}return this.size+=e,this.paddedSize}get isText(){return this.type===qt}get paddedSize(){return this.size+(this.isText?0:Lg)}isAncestorOf(e){return Jg(this,e)}get nextSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){if(e===0||e===this.size)return;const r=this.value.slice(0,e),s=this.value.slice(e);if(!s.length)return;this.value=r;const i=this.cloneText(e+t);return i.value=s,this.parent.insertAfterInternal(i,this),i}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}append(...e){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");this._children.push(...e);for(const t of e)t.parent=this,t.updateAncestorsSize()}prepend(...e){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");this._children.unshift(...e);for(const t of e)t.parent=this}insertBefore(e,t){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new T(y.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r),e.updateAncestorsSize()}insertAfter(e,t){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new T(y.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1),e.updateAncestorsSize()}insertAt(e,t){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize()}removeChild(e){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");const t=this._children.indexOf(e);if(t===-1)throw new T(y.ErrInvalidArgument,"child not found");this._children.splice(t,1),e.parent=void 0}splitElement(e,t){const r=this.cloneElement(t);this.parent.insertAfterInternal(r,this),r.updateAncestorsSize();const s=this.children.slice(0,e),i=this.children.slice(e);this._children=s,r._children=i,this.size=this._children.reduce((o,a)=>o+a.paddedSize,0),r.size=r._children.reduce((o,a)=>o+a.paddedSize,0);for(const o of r._children)o.parent=r;return r}insertAfterInternal(e,t){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new T(y.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1)}insertAtInternal(e,t){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");if(e.isRemoved){const t=this._children.indexOf(e);return this.allChildren.splice(0,t).filter(s=>!s.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new T(y.ErrRefused,"Text node cannot have children");let t=e;for(;t;){const r=this._children.indexOf(t);if(r!==-1)return r;t=t.parent}return-1}}function Jg(n,e){if(n===e)return!1;for(;e.parent;){if(e.parent===n)return!0;e=e.parent}return!1}var me=(n=>(n.Start="Start",n.End="End",n.Text="Text",n))(me||{});function Dl(n,e,t,r){if(e>t)throw new T(y.ErrInvalidArgument,`from is greater than to: ${e} > ${t}`);if(e>n.size)throw new T(y.ErrInvalidArgument,`from is out of range: ${e} > ${n.size}`);if(t>n.size)throw new T(y.ErrInvalidArgument,`to is out of range: ${t} > ${n.size}`);if(e===t)return;let s=0;for(const i of n.children){if(e-i.paddedSize<s&&s<t){const o=i.isText?e-s:e-s-1,a=i.isText?t-s:t-s-1,c=!i.isText&&o<0,l=!i.isText&&a>i.size;(i.isText||c)&&r([i,i.isText?"Text":"Start"],l),Dl(i,Math.max(0,o),Math.min(a,i.size),r),l&&r([i,"End"],l)}s+=i.paddedSize}}function Rl(n,e,t=0){for(const r of n.children)Rl(r,e,t+1);e(n,t)}function $s(n,e,t=0){for(const r of n._children)$s(r,e,t+1);e(n,t)}function Si(n,e,t=!0){if(e>n.size)throw new T(y.ErrInvalidArgument,`index is out of range: ${e} > ${n.size}`);if(n.isText)return{node:n,offset:e};let r=0,s=0;for(const i of n.children){if(t&&i.isText&&i.size>=e-s)return Si(i,e-s,t);if(e===s)return{node:n,offset:r};if(!t&&i.paddedSize===e-s)return{node:n,offset:r+1};if(i.paddedSize>e-s)return Si(i,e-s-1,t);s+=i.paddedSize,r+=1}return{node:n,offset:r}}function _l(n){return n.isText||n.children.length===0?n:_l(n.children[0])}function qg(n,e){if(n.size<e)throw new T(y.ErrInvalidArgument,"unacceptable path");for(let t=0;t<n.children.length;t++){const r=n.children[t];if(r.size<e)e-=r.size;else{n=r;break}}return{node:n,offset:e}}class zg{constructor(e){h(this,"root");this.root=e}tokensBetween(e,t,r){Dl(this.root,e,t,r)}traverse(e){Rl(this.root,e,0)}traverseAll(e){$s(this.root,e,0)}findTreePos(e,t=!0){return Si(this.root,e,t)}treePosToPath(e){const t=[];let r=e.node;if(r.isText){const s=r.parent.findOffset(r);if(s===-1)throw new T(y.ErrInvalidArgument,"invalid treePos");const i=cr(r.parent,s);t.push(i+e.offset),r=r.parent}else if(r.hasTextChild()){const s=cr(r,e.offset);t.push(s)}else t.push(e.offset);for(;r.parent;){const s=r.parent.findOffset(r);if(s===-1)throw new T(y.ErrInvalidArgument,"invalid treePos");t.push(s),r=r.parent}return t.reverse()}pathToIndex(e){const t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new T(y.ErrInvalidArgument,"unacceptable path");let t=this.root;for(let r=0;r<e.length-1;r++){const s=e[r];if(t=t.children[s],!t)throw new T(y.ErrInvalidArgument,"unacceptable path")}if(t.hasTextChild())return qg(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new T(y.ErrInvalidArgument,"unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.size}findPostorderRight(e){const{node:t,offset:r}=e;if(t.isText){if(t.size===r){const s=t.nextSibling;return s||t.parent}return t}return t.children.length===r?t:_l(t.children[r])}indexOf(e){let{node:t}=e;const{offset:r}=e;let s=0,i=1;if(t.isText){s+=r;const o=t.parent,a=o.findOffset(t);if(a===-1)throw new T(y.ErrInvalidArgument,"invalid pos");s+=cr(o,a),t=t.parent}else s+=cr(t,r);for(;t!=null&&t.parent;){const o=t.parent,a=o.findOffset(t);if(a===-1)throw new T(y.ErrInvalidArgument,"invalid pos");s+=cr(o,a),i++,t=t.parent}return s+i-1}indexToPath(e){const t=this.findTreePos(e);return this.treePosToPath(t)}}const jg=(n,e)=>n===e?0:n<e?-1:1;class Kg{constructor(e,t,r){h(this,"key");h(this,"value");h(this,"parent");h(this,"left");h(this,"right");h(this,"isRed");this.key=e,this.value=t,this.isRed=r}}class Vg{constructor(e){h(this,"stack");this.stack=[],this.traverseInorder(e)}traverseInorder(e){e&&(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}}class Fl{constructor(e){h(this,"root");h(this,"comparator");h(this,"counter");this.comparator=typeof e<"u"?e:jg,this.counter=0}put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){const t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new Vg(this.root)}values(){const e=[];for(const t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root;for(;t;){const r=this.comparator(e,t.key);if(r>0)if(t.right)t.right.parent=t,t=t.right;else return t;else if(r<0)if(t.left)t.left.parent=t,t=t.left;else{let s=t.parent,i=t;for(;s&&i===s.left;)i=s,s=s.parent;return s}else return t}}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(e,t){for(;t;){const r=this.comparator(e,t.key);if(r===0)return t;r<0?t=t.left:r>0&&(t=t.right)}}putInternal(e,t,r){if(!r)return this.counter+=1,new Kg(e,t,!0);const s=this.comparator(e,r.key);return s<0?r.left=this.putInternal(e,t,r.left):s>0?r.right=this.putInternal(e,t,r.right):r.value=t,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(e,t){if(this.comparator(t,e.key)<0)!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),this.comparator(t,e.key)===0&&!e.right){this.counter-=1;return}if(!this.isRed(e.right)&&!this.isRed(e.right.left)&&(e=this.moveRedRight(e)),this.comparator(t,e.key)===0){this.counter-=1;const r=this.min(e.right);e.value=r.value,e.key=r.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(e.left)return!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}}class at{constructor(e,t){h(this,"parentID");h(this,"leftSiblingID");this.parentID=e,this.leftSiblingID=t}static of(e,t){return new at(e,t)}static fromTreePos(e){const{offset:t}=e;let{node:r}=e,s;return r.isText?(r.parent.children[0]===r&&t===0?s=r.parent:s=r,r=r.parent):t===0?s=r:s=r.children[t-1],at.of(r.id,be.of(s.getCreatedAt(),s.getOffset()+t))}getParentID(){return this.parentID}static fromStruct(e){return at.of(be.of(Le.fromStruct(e.parentID.createdAt),e.parentID.offset),be.of(Le.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){const t=this.getParentID(),r=this.getLeftSiblingID(),s=e.findFloorNode(t);let i=e.findFloorNode(r);if(!s||!i)throw new T(y.ErrRefused,`cannot find node of CRDTTreePos(${t.toTestString()}, ${r.toTestString()})`);return!r.equals(t)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[s,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}}class be{constructor(e,t){h(this,"createdAt");h(this,"offset");this.createdAt=e,this.offset=t}static of(e,t){return new be(e,t)}static fromStruct(e){return be.of(Le.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{const r=e.getCreatedAt().compare(t.getCreatedAt());return r!==0?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class ze extends Ug{constructor(t,r,s,i,o){super(r);h(this,"id");h(this,"removedAt");h(this,"attrs");h(this,"insPrevID");h(this,"insNextID");h(this,"_value","");this.id=t,this.removedAt=o,i&&(this.attrs=i),typeof s=="string"?this.value=s:Array.isArray(s)&&(this._children=s)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(t,r,s,i){return new ze(t,r,s,i)}deepcopy(){var r;const t=new ze(this.id,this.type);return t.removedAt=this.removedAt,t._value=this._value,t.size=this.size,t.attrs=(r=this.attrs)==null?void 0:r.deepcopy(),t._children=this._children.map(s=>{const i=s.deepcopy();return i.parent=t,i}),t.insPrevID=this.insPrevID,t.insNextID=this.insNextID,t}get value(){if(!this.isText)throw new T(y.ErrInvalidType,`cannot get value of element node: ${this.type}`);return this._value}set value(t){if(!this.isText)throw new T(y.ErrInvalidType,`cannot set value of element node: ${this.type}`);this._value=t,this.size=t.length}get isRemoved(){return!!this.removedAt}remove(t){const r=!this.removedAt;(!this.removedAt||this.removedAt.compare(t)>0)&&(this.removedAt=t),r&&this.updateAncestorsSize()}cloneText(t){return new ze(be.of(this.id.getCreatedAt(),t),this.type,void 0,void 0,this.removedAt)}cloneElement(t){return new ze(be.of(t(),0),this.type,void 0,void 0,this.removedAt)}split(t,r,s){const i=this.isText?this.splitText(r,this.id.getOffset()):this.splitElement(r,s);if(i){if(i.insPrevID=this.id,this.insNextID){const o=t.findFloorNode(this.insNextID);o.insPrevID=i.id,i.insNextID=this.insNextID}this.insNextID=i.id,t.registerNode(i)}return i}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(t,r){return!this.getCreatedAt().after(r)&&(!this.removedAt||t.after(this.removedAt))}canStyle(t,r){return this.isText?!1:!this.getCreatedAt().after(r)&&(!this.removedAt||t.after(this.removedAt))}setAttrs(t,r){this.attrs||(this.attrs=new Kt);const s=new Array;for(const[i,o]of Object.entries(t))s.push(this.attrs.set(i,o,r));return s}purge(t){this.attrs&&this.attrs.purge(t)}getGCPairs(){const t=[];if(!this.attrs)return t;for(const r of this.attrs)r.getRemovedAt()&&t.push({parent:this,child:r});return t}}function ki(n){var t;if(n.isText){const r=n;return{type:r.type,value:r.value}}const e={type:n.type,children:n.children.map(ki)};return n.attrs&&(e.attributes=jn((t=n.attrs)==null?void 0:t.toObject())),e}function io(n){if(n.isText)return n.value;let e="";return n.attrs&&n.attrs.size()&&(e=" "+Array.from(n.attrs).filter(t=>!t.isRemoved()).sort((t,r)=>t.getKey().localeCompare(r.getKey())).map(t=>{const r=JSON.parse(t.getValue());return typeof r=="string"?`${t.getKey()}="${r}"`:`${t.getKey()}="${Nt(t.getValue())}"`}).join(" ")),`<${n.type}${e}>${n.children.map(t=>io(t)).join("")}</${n.type}>`}function Ml(n){if(n.isText){const e=n;return{type:e.type,value:e.value,size:e.size,isRemoved:e.isRemoved}}return{type:n.type,children:n.children.map(Ml),size:n.size,isRemoved:n.isRemoved}}class Xe extends Rr{constructor(t,r){super(r);h(this,"indexTree");h(this,"nodeMapByID");this.indexTree=new zg(t),this.nodeMapByID=new Fl(be.createComparator()),this.indexTree.traverseAll(s=>{this.nodeMapByID.put(s.id,s)})}static create(t,r){return new Xe(t,r)}findFloorNode(t){const r=this.nodeMapByID.floorEntry(t);if(!(!r||!r.key.getCreatedAt().equals(t.getCreatedAt())))return r.value}registerNode(t){this.nodeMapByID.put(t.id,t)}findNodesAndSplitText(t,r){const[s,i]=t.toTreeNodePair(this);let o=i;const a=s===o,c=o.parent&&!a?o.parent:s;if(o.isText&&o.split(this,t.getLeftSiblingID().getOffset()-o.id.getOffset()),r){const l=c.allChildren,u=a?0:l.indexOf(o)+1;for(let g=u;g<l.length;g++){const v=l[g];if(!v.id.getCreatedAt().after(r))break;o=v}}return[c,o]}style(t,r,s,i){const[o,a]=this.findNodesAndSplitText(t[0],s),[c,l]=this.findNodesAndSplitText(t[1],s),u=[],g=r?jn(r):{},v=new Map,d=[];return this.traverseInPosRange(o,a,c,l,([A])=>{const x=A.getCreatedAt().getActorID(),R=i?i.has(x)?i.get(x):lt:mr;if(A.canStyle(s,R)&&r){const L=v.get(x),$=A.getCreatedAt();(!L||$.after(L))&&v.set(x,$);const Y=A.setAttrs(r,s),P=Y.reduce((oe,[,Ie])=>(Ie&&(oe[Ie.getKey()]=g[Ie.getKey()]),oe),{}),H=A.parent,Q=A.prevSibling||A.parent;Object.keys(P).length>0&&u.push({type:"style",from:this.toIndex(H,Q),to:this.toIndex(A,A),fromPath:this.toPath(H,Q),toPath:this.toPath(A,A),actor:s.getActorID(),value:P});for(const[oe]of Y)oe&&d.push({parent:A,child:oe})}}),[v,d,u]}removeStyle(t,r,s,i){const[o,a]=this.findNodesAndSplitText(t[0],s),[c,l]=this.findNodesAndSplitText(t[1],s),u=[],g=new Map,v=[];return this.traverseInPosRange(o,a,c,l,([d])=>{const A=d.getCreatedAt().getActorID(),x=i?i.has(A)?i.get(A):lt:mr;if(d.canStyle(s,x)&&r){const R=g.get(A),L=d.getCreatedAt();(!R||L.after(R))&&g.set(A,L),d.attrs||(d.attrs=new Kt);for(const P of r){const H=d.attrs.remove(P,s);for(const Q of H)v.push({parent:d,child:Q})}const $=d.parent,Y=d.prevSibling||d.parent;u.push({actor:s.getActorID(),type:"removeStyle",from:this.toIndex($,Y),to:this.toIndex(d,d),fromPath:this.toPath($,Y),toPath:this.toPath(d,d),value:r})}}),[g,v,u]}edit(t,r,s,i,o,a){const[c,l]=this.findNodesAndSplitText(t[0],i),[u,g]=this.findNodesAndSplitText(t[1],i),v=this.toIndex(c,l),d=this.toPath(c,l),A=[],x=[],R=[],L=new Map;this.traverseInPosRange(c,l,u,g,([P,H],Q)=>{if(H===me.Start&&!Q)for(const Qe of P.children)R.push(Qe);const oe=P.getCreatedAt().getActorID(),Ie=a?a.has(oe)?a.get(oe):lt:mr;if(P.canDelete(i,Ie)||A.includes(P.parent)){const Qe=L.get(oe),Ve=P.getCreatedAt();(!Qe||Ve.after(Qe))&&L.set(oe,Ve),(H===me.Text||H===me.Start)&&A.push(P),x.push([P,H])}});const $=this.makeDeletionChanges(x,i),Y=[];for(const P of A)P.remove(i),P.isRemoved&&Y.push({parent:this,child:P});for(const P of R)P.removedAt||c.append(P);if(s>0){let P=0,H=c,Q=l;for(;P<s;)H.split(this,H.findOffset(Q)+1,o),Q=H,H=H.parent,P++;$.push({type:"content",from:v,to:v,fromPath:d,toPath:d,actor:i.getActorID()})}if(r!=null&&r.length){const P=[];let H=l;for(const Q of r)H===c?c.insertAt(Q,0):c.insertAfter(Q,H),H=Q,$s(Q,oe=>{c.isRemoved&&(oe.remove(i),Y.push({parent:this,child:oe})),this.nodeMapByID.put(oe.id,oe)}),Q.isRemoved||P.push(Q);if(P.length){const Q=P.map(oe=>ki(oe));$.length&&$[$.length-1].from===v?$[$.length-1].value=Q:$.push({type:"content",from:v,to:v,fromPath:d,toPath:d,actor:i.getActorID(),value:Q})}}return[$,Y,L]}editT(t,r,s,i,o){const a=this.findPos(t[0]),c=this.findPos(t[1]);this.edit([a,c],r,s,i,o)}move(t,r,s){throw new T(y.ErrUnimplemented,`not implemented: ${t}, ${r}, ${s}`)}purge(t){var i;(i=t.parent)==null||i.removeChild(t),this.nodeMapByID.remove(t.id);const r=t.insPrevID,s=t.insNextID;if(r){const o=this.findFloorNode(r);o.insNextID=s}if(s){const o=this.findFloorNode(s);o.insPrevID=r}t.insPrevID=void 0,t.insNextID=void 0}getGCPairs(){const t=[];return this.indexTree.traverse(r=>{r.getRemovedAt()&&t.push({parent:this,child:r});for(const s of r.getGCPairs())t.push(s)}),t}findPos(t,r=!0){const s=this.indexTree.findTreePos(t,r);return at.fromTreePos(s)}pathToPosRange(t){const r=this.pathToIndex(t);return[this.findPos(r),this.findPos(r+1)]}pathToPos(t){const r=this.indexTree.pathToIndex(t);return this.findPos(r)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return io(this.indexTree.getRoot())}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const t=this.indexTree.getRoot(),r=(s,i=void 0,o=void 0,a=0)=>{var d,A,x,R;let c,l,u;const g=s.isText?{node:s,offset:0}:i&&o?this.toTreePos(i,o):null;g&&(c=this.indexTree.indexOf(g),l=this.indexTree.treePosToPath(g),u=at.fromTreePos(g).toStruct());const v={type:s.type,parent:i==null?void 0:i.id.toTestString(),size:s.size,id:s.id.toTestString(),removedAt:(d=s.removedAt)==null?void 0:d.toTestString(),insPrev:(A=s.insPrevID)==null?void 0:A.toTestString(),insNext:(x=s.insNextID)==null?void 0:x.toTestString(),value:s.isText?s.value:void 0,isRemoved:s.isRemoved,children:[],depth:a,attributes:s.attrs?jn((R=s.attrs)==null?void 0:R.toObject()):void 0,index:c,path:l,pos:u};for(let L=0;L<s.allChildren.length;L++){const $=L===0?s:s.allChildren[L-1];v.children.push(r(s.allChildren[L],s,$,a+1))}return v};return r(t)}getRootTreeNode(){return ki(this.indexTree.getRoot())}toTestTreeNode(){return Ml(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const t=this.getRoot();return new Xe(t.deepcopy(),this.getCreatedAt())}toPath(t,r){const s=this.toTreePos(t,r);return s?this.indexTree.treePosToPath(s):[]}toIndex(t,r){const s=this.toTreePos(t,r);return s?this.indexTree.indexOf(s):-1}indexToPath(t){return this.indexTree.indexToPath(t)}pathToIndex(t){return this.indexTree.pathToIndex(t)}indexRangeToPosRange(t){const r=this.findPos(t[0]);return t[0]===t[1]?[r,r]:[r,this.findPos(t[1])]}indexRangeToPosStructRange(t){const[r,s]=t,i=this.findPos(r);return r===s?[i.toStruct(),i.toStruct()]:[i.toStruct(),this.findPos(s).toStruct()]}posRangeToPathRange(t){const[r,s]=this.findNodesAndSplitText(t[0]),[i,o]=this.findNodesAndSplitText(t[1]);return[this.toPath(r,s),this.toPath(i,o)]}posRangeToIndexRange(t){const[r,s]=this.findNodesAndSplitText(t[0]),[i,o]=this.findNodesAndSplitText(t[1]);return[this.toIndex(r,s),this.toIndex(i,o)]}traverseInPosRange(t,r,s,i,o){const a=this.toIndex(t,r),c=this.toIndex(s,i);return this.indexTree.tokensBetween(a,c,o)}toTreePos(t,r){if(!t||!r)return;if(t.isRemoved){let i;for(;t.isRemoved;)i=t,t=i.parent;const o=t.findOffset(i);return{node:t,offset:o}}if(t===r)return{node:t,offset:0};let s=t.findOffset(r);if(!r.isRemoved){if(r.isText)return{node:r,offset:r.paddedSize};s++}return{node:t,offset:s}}makeDeletionChanges(t,r){const s=[],i=[];let o=null,a=null;for(let c=0;c<t.length;c++){const l=t[c],u=t[c+1];o||(o=l),a=l;const g=this.findRightToken(l);(!g||!u||g[0]!==u[0]||g[1]!==u[1])&&(i.push([o,a]),o=null,a=null)}for(const c of i){const[l,u]=c,[g,v]=this.findLeftToken(l),[d,A]=u,x=v===me.Start?g:g.parent,R=A===me.Start?d:d.parent,L=this.toIndex(x,g),$=this.toIndex(R,d);L<$&&(s.length>0&&L===s[s.length-1].to?(s[s.length-1].to=$,s[s.length-1].toPath=this.toPath(R,d)):s.push({type:"content",from:L,to:$,fromPath:this.toPath(x,g),toPath:this.toPath(R,d),actor:r.getActorID()}))}return s.reverse()}findRightToken([t,r]){if(r===me.Start){const c=t.allChildren;return c.length>0?[c[0],c[0].isText?me.Text:me.Start]:[t,me.End]}const s=t.parent,i=s.allChildren,o=i.indexOf(t);if(s&&o===i.length-1)return[s,me.End];const a=i[o+1];return[a,a.isText?me.Text:me.Start]}findLeftToken([t,r]){if(r===me.End){const c=t.allChildren;if(c.length>0){const l=c[c.length-1];return[l,l.isText?me.Text:me.End]}return[t,me.Start]}const s=t.parent,i=s.allChildren,o=i.indexOf(t);if(s&&o===0)return[s,me.Start];const a=i[o-1];return[a,a.isText?me.Text:me.End]}}class Br extends ft{constructor(t,r,s,i,o,a,c){super(t,c);h(this,"fromPos");h(this,"toPos");h(this,"contents");h(this,"splitLevel");h(this,"maxCreatedAtMapByActor");this.fromPos=r,this.toPos=s,this.contents=i,this.splitLevel=o,this.maxCreatedAtMapByActor=a}static create(t,r,s,i,o,a,c){return new Br(t,r,s,i,o,a,c)}execute(t){var c;const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof Xe))throw new T(y.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const s=this.getExecutedAt(),i=r,[o,a]=i.edit([this.fromPos,this.toPos],(c=this.contents)==null?void 0:c.map(l=>l.deepcopy()),this.splitLevel,s,(()=>{let l=s.getDelimiter();return this.contents!==void 0&&(l+=this.contents.length),()=>Le.of(s.getLamport(),++l,s.getActorID())})(),this.maxCreatedAtMapByActor);for(const l of a)t.registerGCPair(l);return{opInfos:o.map(({from:l,to:u,value:g,splitLevel:v,fromPath:d,toPath:A})=>({type:"tree-edit",path:t.createPath(this.getParentCreatedAt()),from:l,to:u,value:g,splitLevel:v,fromPath:d,toPath:A}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,s=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,i=this.contents||[];return`${t}.EDIT(${r},${s},${i.map(o=>io(o)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class en{constructor(e,t,r,s){h(this,"clientSeq");h(this,"serverSeq");h(this,"lamport");h(this,"actor");this.clientSeq=e,this.serverSeq=s,this.lamport=t,this.actor=r}static of(e,t,r,s){return new en(e,t,r,s)}next(){return new en(this.clientSeq+1,this.lamport.add(1),this.actor)}syncLamport(e){return e.greaterThan(this.lamport)?new en(this.clientSeq,e,this.actor):new en(this.clientSeq,this.lamport.add(1),this.actor)}createTimeTicket(e){return Le.of(this.lamport,e,this.actor)}setActor(e){return new en(this.clientSeq,this.lamport,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const Wg=new en(0,z.fromInt(0,!0),Ls);class Qn{constructor({id:e,operations:t,presenceChange:r,message:s}){h(this,"id");h(this,"operations");h(this,"presenceChange");h(this,"message");this.id=e,this.operations=t||[],this.presenceChange=r,this.message=s}static create({id:e,operations:t,presenceChange:r,message:s}){return new Qn({id:e,operations:t,presenceChange:r,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(const t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(e,t,r){const s=[],i=[];for(const o of this.operations){const a=o.execute(e,r);if(!a)continue;const{opInfos:c,reverseOp:l}=a;s.push(...c),l&&i.unshift(l)}return this.presenceChange&&(this.presenceChange.type===ln.Put?t.set(this.id.getActorID(),nt(this.presenceChange.presence)):t.delete(this.id.getActorID())),{opInfos:s,reverseOps:i}}toTestString(){return`${this.operations.map(e=>e.toTestString()).join(",")}`}toStruct(){return{changeID:Te.bytesToHex(Te.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(e=>Te.bytesToHex(Te.toOperation(e).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(e){const{changeID:t,operations:r,presenceChange:s,message:i}=e;return Qn.create({id:Te.bytesToChangeID(Te.hexToBytes(t)),operations:r==null?void 0:r.map(o=>Te.bytesToOperation(Te.hexToBytes(o))),presenceChange:s,message:i})}}class Us{constructor(e,t,r,s,i,o){h(this,"documentKey");h(this,"checkpoint");h(this,"isRemoved");h(this,"changes");h(this,"snapshot");h(this,"minSyncedTicket");this.documentKey=e,this.checkpoint=t,this.isRemoved=r,this.changes=s,this.snapshot=i,this.minSyncedTicket=o}static create(e,t,r,s,i,o){return new Us(e,t,r,s,i,o)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getMinSyncedTicket(){return this.minSyncedTicket}}class Kn{constructor(e,t){h(this,"serverSeq");h(this,"clientSeq");this.serverSeq=e,this.clientSeq=t}static of(e,t){return new Kn(e,t)}increaseClientSeq(e){return e===0?this:new Kn(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;const t=this.serverSeq.greaterThan(e.serverSeq)?this.serverSeq:e.serverSeq,r=Math.max(this.clientSeq,e.clientSeq);return Kn.of(t,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq.equals(e.serverSeq)}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const Hg=new Kn(z.fromInt(0,!0),0);class Ot{constructor(e,t){h(this,"createdAt");h(this,"offset");this.createdAt=e,this.offset=t}static of(e,t){return new Ot(e,t)}static fromStruct(e){return Ot.of(Le.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}hasSameCreatedAt(e){return this.createdAt.compare(e.createdAt)===0}split(e){return new Ot(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const Gg=Ot.of(lt,0);class ut{constructor(e,t){h(this,"id");h(this,"relativeOffset");this.id=e,this.relativeOffset=t}static of(e,t){return new ut(e,t)}static fromStruct(e){const t=Ot.fromStruct(e.id);return ut.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return Ot.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return this.id.equals(e.id)?this.relativeOffset===e.relativeOffset:!1}}class on extends Pl{constructor(t,r,s){super(r);h(this,"id");h(this,"removedAt");h(this,"prev");h(this,"next");h(this,"insPrev");h(this,"insNext");this.id=t,this.removedAt=s}static create(t,r){return new on(t,r)}static createComparator(){return(t,r)=>{const s=t.getCreatedAt().compare(r.getCreatedAt());return s!==0?s:t.getOffset()>r.getOffset()?1:t.getOffset()<r.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(t){this.prev=t,t&&(t.next=this)}setNext(t){this.next=t,t&&(t.prev=this)}setInsPrev(t){this.insPrev=t,t&&(t.insNext=this)}setInsNext(t){this.insNext=t,t&&(t.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(t){return new on(this.id.split(t),this.splitValue(t),this.removedAt)}canDelete(t,r){const s=!this.removedAt;return!this.getCreatedAt().after(r)&&(!this.removedAt||t.after(this.removedAt))?s:!1}canStyle(t,r){return!this.getCreatedAt().after(r)&&(!this.removedAt||t.after(this.removedAt))}remove(t){this.removedAt=t}createPosRange(){return[ut.of(this.id,0),ut.of(this.id,this.getLength())]}deepcopy(){return new on(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(t){const r=this.value;return this.value=r.substring(0,t),r.substring(t,r.length)}toIDString(){return this.id.toIDString()}}class er{constructor(){h(this,"head");h(this,"treeByIndex");h(this,"treeByID");this.head=on.create(Gg),this.treeByIndex=new Nr,this.treeByID=new Fl(on.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new er}edit(e,t,r,s){const[i,o]=this.findNodeWithSplit(e[1],t),[a,c]=this.findNodeWithSplit(e[0],t),l=this.findBetween(c,o),[u,g,v]=this.deleteNodes(l,t,s),d=o?o.getID():i.getID();let A=ut.of(d,0);if(r){const R=this.posToIndex(a.createPosRange()[1],!0),L=this.insertAfter(a,on.create(Ot.of(t,0),r));u.length&&u[u.length-1].from===R?u[u.length-1].value=r:u.push({actor:t.getActorID(),from:R,to:R,value:r}),A=ut.of(L.getID(),L.getContentLength())}const x=[];for(const[,R]of v)x.push({parent:this,child:R});return[A,g,x,u]}indexToPos(e){const[t,r]=this.treeByIndex.find(e),s=t;return ut.of(s.getID(),r)}findIndexesFromRange(e){const[t,r]=e;return[this.posToIndex(t,!1),this.posToIndex(r,!0)]}posToIndex(e,t){const r=e.getAbsoluteID(),s=t?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!s)throw new T(y.ErrInvalidArgument,`the node of the given id should be found: ${r.toTestString()}`);const i=this.treeByIndex.indexOf(s),o=s.isRemoved()?0:r.getOffset()-s.getID().getOffset();return i+o}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const e=[];for(const t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){const e=new er;let t=this.head.getNext(),r=e.head,s;for(;t;){if(s=e.insertAfter(r,t.deepcopy()),t.hasInsPrev()){const i=e.findNode(t.getInsPrevID());s.setInsPrev(i)}r=s,t=t.getNext()}return e}toTestString(){const e=[];let t=this.head;for(;t;)t.isRemoved()?e.push(`{${t.toTestString()}}`):e.push(`[${t.toTestString()}]`),t=t.getNext();return e.join("")}insertAfter(e,t){const r=e.getNext();return t.setPrev(e),r&&r.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){const r=e.getAbsoluteID();let s=this.findFloorNodePreferToLeft(r);const i=r.getOffset()-s.getID().getOffset();for(this.splitNode(s,i);s.hasNext()&&s.getNext().getCreatedAt().after(t);)s=s.getNext();return[s,s.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(!t)throw new T(y.ErrInvalidArgument,`the node of the given id should be found: ${e.toTestString()}`);if(e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){const t=this.treeByID.floorEntry(e);if(t&&!(!t.key.equals(e)&&!t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){const r=[];let s=e;for(;s&&s!==t;)r.push(s),s=s.getNext();return r}splitNode(e,t){if(t>e.getContentLength())throw new T(y.ErrInvalidArgument,"offset should be less than or equal to length");if(t===0)return e;if(t===e.getContentLength())return e.getNext();const r=e.split(t);this.treeByIndex.updateWeight(r),this.insertAfter(e,r);const s=e.getInsNext();return s&&s.setInsPrev(r),r.setInsPrev(e),r}deleteNodes(e,t,r){if(!e.length)return[[],new Map,new Map];const[s,i]=this.filterNodes(e,t,r),o=new Map,a=new Map,c=this.makeChanges(i,t);for(const l of s){const u=l.getCreatedAt().getActorID();(!o.has(u)||l.getID().getCreatedAt().after(o.get(u)))&&o.set(u,l.getID().getCreatedAt()),a.set(l.getID().toIDString(),l),l.remove(t)}return this.deleteIndexNodes(i),[c,o,a]}filterNodes(e,t,r){const s=!!r,i=[],o=[],[a,c]=this.findEdgesOfCandidates(e);o.push(a);for(const l of e){const u=l.getCreatedAt().getActorID(),g=s?r.has(u)?r.get(u):lt:mr;l.canDelete(t,g)?i.push(l):o.push(l)}return o.push(c),[i,o]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){const r=[];let s,i;for(let o=0;o<e.length-1;o++){const a=e[o],c=e[o+1];a.getNext()!=c&&([s]=this.findIndexesFromRange(a.getNext().createPosRange()),c?[,i]=this.findIndexesFromRange(c.getPrev().createPosRange()):i=this.treeByIndex.length,s<i&&r.push({actor:t.getActorID(),from:s,to:i}))}return r.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){const r=e[t],s=e[t+1];r.getNext()!=s&&this.treeByIndex.deleteRange(r,s)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());const t=e.getPrev(),r=e.getNext(),s=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(r),r&&r.setPrev(t),e.setPrev(void 0),e.setNext(void 0),s&&s.setInsNext(i),i&&i.setInsPrev(s),e.setInsPrev(void 0),e.setInsNext(void 0)}}const Ba=n=>n<0?Math.ceil(n):Math.floor(n);var Pt=(n=>(n[n.IntegerCnt=0]="IntegerCnt",n[n.LongCnt=1]="LongCnt",n))(Pt||{});class Ke extends Rr{constructor(t,r,s){super(s);h(this,"valueType");h(this,"value");switch(this.valueType=t,t){case 0:typeof r=="number"?r>Math.pow(2,31)-1||r<-Math.pow(2,31)?this.value=z.fromNumber(r).toInt():this.value=Ba(r):this.value=r.toInt();break;case 1:typeof r=="number"?this.value=z.fromNumber(r):this.value=r;break;default:throw new T(y.ErrUnimplemented,`unimplemented type: ${t}`)}}static create(t,r,s){return new Ke(t,r,s)}static valueFromBytes(t,r){switch(t){case 0:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 1:return z.fromBytesLE(Array.from(r));default:throw new T(y.ErrUnimplemented,`unimplemented type: ${t}`)}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const t=Ke.create(this.valueType,this.value,this.getCreatedAt());return t.setMovedAt(this.getMovedAt()),t}getType(){return this.valueType}static getCounterType(t){switch(typeof t){case"object":return t instanceof z?1:void 0;case"number":return t>Math.pow(2,31)-1||t<-Math.pow(2,31)?1:0;default:return}}static isSupport(t){return!!Ke.getCounterType(t)}static isInteger(t){return t%1===0}isNumericType(){const t=this.valueType;return t===0||t===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const t=this.value;return new Uint8Array([t&255,t>>8&255,t>>16&255,t>>24&255])}case 1:{const r=this.value.toBytesLE();return Uint8Array.from(r)}default:throw new T(y.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(t){function r(s){if(!s.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof s.getValue()}`)}return r(this),r(t),this.valueType===1?this.value=this.value.add(t.getValue()):t.getType()===ve.Long?this.value=this.value+t.getValue().toInt():this.value=z.fromNumber(this.value+Ba(t.getValue())).toInt(),this}}class tr extends ft{constructor(t,r,s){super(t,s);h(this,"value");this.value=r}static create(t,r,s){return new tr(t,r,s)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof Ke))throw new T(y.ErrInvalidArgument,"fail to execute, only Counter can execute increase");const s=r,i=this.value.deepcopy();return s.increase(i),{opInfos:[{type:"increase",path:t.createPath(this.getParentCreatedAt()),value:i.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const t=this.value.deepcopy(),s=t.getType()===ve.Long?t.getValue().multiply(-1):t.getValue()*-1;return tr.create(this.getParentCreatedAt(),ce.of(s,t.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class zt extends ft{constructor(t,r,s,i,o,a,c){super(t,c);h(this,"fromPos");h(this,"toPos");h(this,"maxCreatedAtMapByActor");h(this,"attributes");h(this,"attributesToRemove");this.fromPos=r,this.toPos=s,this.maxCreatedAtMapByActor=i,this.attributes=o,this.attributesToRemove=a}static create(t,r,s,i,o,a){return new zt(t,r,s,i,o,new Array,a)}static createTreeRemoveStyleOperation(t,r,s,i,o,a){return new zt(t,r,s,i,new Map,o,a)}execute(t){const r=t.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new T(y.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof Xe))throw new T(y.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const s=r;let i,o;if(this.attributes.size){const a={};[...this.attributes].forEach(([c,l])=>a[c]=l),[,o,i]=s.style([this.fromPos,this.toPos],a,this.getExecutedAt(),this.maxCreatedAtMapByActor)}else{const a=this.attributesToRemove;[,o,i]=s.removeStyle([this.fromPos,this.toPos],a,this.getExecutedAt(),this.maxCreatedAtMapByActor)}for(const a of o)t.registerGCPair(a);return{opInfos:i.map(({from:a,to:c,value:l,fromPath:u,toPath:g})=>({type:"tree-style",from:a,to:c,value:this.attributes.size?{attributes:l}:{attributesToRemove:l},fromPath:u,toPath:g,path:t.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const t=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,s=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${t}.STYLE(${r},${s},${Object.entries(this.attributes||{}).map(([i,o])=>`${i}:"${o}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}function Yg(n){const e=new to,t=e.data;for(const[r,s]of Object.entries(n))t[r]=JSON.stringify(s);return e}function Xg(n){if(n.type===ln.Put)return new Ai({type:Er.PUT,presence:Yg(n.presence)});if(n.type===ln.Clear)return new Ai({type:Er.CLEAR});throw new T(y.ErrUnimplemented,"unimplemented type")}function Zg(n){return new kl({serverSeq:n.getServerSeqAsString(),clientSeq:n.getClientSeq()})}function Bl(n){return new Ms({clientSeq:n.getClientSeq(),lamport:n.getLamportAsString(),actorId:ho(n.getActorID())})}function F(n){if(n)return new B({lamport:n.getLamportAsString(),delimiter:n.getDelimiter(),actorId:ho(n.getActorID())})}function Ll(n){switch(n){case ve.Null:return V.NULL;case ve.Boolean:return V.BOOLEAN;case ve.Integer:return V.INTEGER;case ve.Long:return V.LONG;case ve.Double:return V.DOUBLE;case ve.String:return V.STRING;case ve.Bytes:return V.BYTES;case ve.Date:return V.DATE;default:throw new T(y.ErrInvalidType,`unsupported type: ${n}`)}}function $l(n){switch(n){case Pt.IntegerCnt:return V.INTEGER_CNT;case Pt.LongCnt:return V.LONG_CNT;default:throw new T(y.ErrInvalidType,`unsupported type: ${n}`)}}function ri(n){if(n instanceof $e)return new Bt({type:V.JSON_OBJECT,createdAt:F(n.getCreatedAt()),value:Zl(n)});if(n instanceof je)return new Bt({type:V.JSON_ARRAY,createdAt:F(n.getCreatedAt()),value:xm(n)});if(n instanceof Ye)return new Bt({type:V.TEXT,createdAt:F(n.getCreatedAt())});if(n instanceof ce)return new Bt({type:Ll(n.getType()),createdAt:F(n.getCreatedAt()),value:n.toBytes()});if(n instanceof Ke)return new Bt({type:$l(n.getType()),createdAt:F(n.getCreatedAt()),value:n.toBytes()});if(n instanceof Xe)return new Bt({type:V.TREE,createdAt:F(n.getCreatedAt()),value:Cm(n)});throw new T(y.ErrUnimplemented,"unimplemented element")}function Qg(n){return new bi({createdAt:F(n.getCreatedAt()),offset:n.getOffset()})}function Yr(n){return new xn({createdAt:F(n.getID().getCreatedAt()),offset:n.getID().getOffset(),relativeOffset:n.getRelativeOffset()})}function Xr(n){return new kr({parentId:pr(n.getParentID()),leftSiblingId:pr(n.getLeftSiblingID())})}function pr(n){return new zn({createdAt:F(n.getCreatedAt()),offset:n.getOffset()})}function Ul(n){const e=new Zi;if(n instanceof Nn){const t=n,r=new al;r.parentCreatedAt=F(t.getParentCreatedAt()),r.key=t.getKey(),r.value=ri(t.getValue()),r.executedAt=F(t.getExecutedAt()),e.body.case="set",e.body.value=r}else if(n instanceof _r){const t=n,r=new cl;r.parentCreatedAt=F(t.getParentCreatedAt()),r.prevCreatedAt=F(t.getPrevCreatedAt()),r.value=ri(t.getValue()),r.executedAt=F(t.getExecutedAt()),e.body.case="add",e.body.value=r}else if(n instanceof tn){const t=n,r=new ll;r.parentCreatedAt=F(t.getParentCreatedAt()),r.prevCreatedAt=F(t.getPrevCreatedAt()),r.createdAt=F(t.getCreatedAt()),r.executedAt=F(t.getExecutedAt()),e.body.case="move",e.body.value=r}else if(n instanceof un){const t=n,r=new ul;r.parentCreatedAt=F(t.getParentCreatedAt()),r.createdAt=F(t.getCreatedAt()),r.executedAt=F(t.getExecutedAt()),e.body.case="remove",e.body.value=r}else if(n instanceof Fr){const t=n,r=new fl;r.parentCreatedAt=F(t.getParentCreatedAt()),r.from=Yr(t.getFromPos()),r.to=Yr(t.getToPos());const s=r.createdAtMapByActor;for(const[o,a]of t.getMaxCreatedAtMapByActor())s[o]=F(a);r.content=t.getContent();const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a;r.executedAt=F(t.getExecutedAt()),e.body.case="edit",e.body.value=r}else if(n instanceof Mr){const t=n,r=new hl;r.parentCreatedAt=F(t.getParentCreatedAt()),r.from=Yr(t.getFromPos()),r.to=Yr(t.getToPos());const s=r.createdAtMapByActor;for(const[o,a]of t.getMaxCreatedAtMapByActor())s[o]=F(a);const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a;r.executedAt=F(t.getExecutedAt()),e.body.case="style",e.body.value=r}else if(n instanceof tr){const t=n,r=new dl;r.parentCreatedAt=F(t.getParentCreatedAt()),r.value=ri(t.getValue()),r.executedAt=F(t.getExecutedAt()),e.body.case="increase",e.body.value=r}else if(n instanceof Br){const t=n,r=new gl,s=r.createdAtMapByActor;for(const[i,o]of t.getMaxCreatedAtMapByActor())s[i]=F(o);r.parentCreatedAt=F(t.getParentCreatedAt()),r.from=Xr(t.getFromPos()),r.to=Xr(t.getToPos()),r.contents=om(t.getContents()),r.splitLevel=t.getSplitLevel(),r.executedAt=F(t.getExecutedAt()),e.body.case="treeEdit",e.body.value=r}else if(n instanceof zt){const t=n,r=new ml;r.parentCreatedAt=F(t.getParentCreatedAt()),r.from=Xr(t.getFromPos()),r.to=Xr(t.getToPos());const s=r.createdAtMapByActor;for(const[o,a]of t.getMaxCreatedAtMapByActor())s[o]=F(a);const i=t.getAttributesToRemove();if(i.length>0)r.attributesToRemove=i;else{const o=r.attributes;for(const[a,c]of t.getAttributes())o[a]=c}r.executedAt=F(t.getExecutedAt()),e.body.case="treeStyle",e.body.value=r}else throw new T(y.ErrUnimplemented,"unimplemented operation");return e}function em(n){const e=[];for(const t of n)e.push(Ul(t));return e}function tm(n){const e=new ol({id:Bl(n.getID()),message:n.getMessage()});return n.hasOperations()&&(e.operations=em(n.getOperations())),n.hasPresenceChange()&&(e.presenceChange=Xg(n.getPresenceChange())),e}function nm(n){const e=[];for(const t of n)e.push(tm(t));return e}function rm(n){const e=[];for(const t of n)e.push(new Al({key:t.getStrKey(),element:ao(t.getValue())}));return e}function sm(n){const e=[];for(const t of n)e.push(new Qi({element:ao(t.getValue())}));return e}function im(n){const e=[];for(const t of n){const r=new Il;r.id=Qg(t.getID()),r.value=t.getValue().getContent(),r.removedAt=F(t.getRemovedAt());const s=r.attributes,i=t.getValue().getAttrs();for(const o of i){const a=new Bs;a.value=o.getValue(),a.updatedAt=F(o.getUpdatedAt()),s[o.getKey()]=a}e.push(r)}return e}function om(n){const e=[];if(!n||!n.length)return e;for(const t of n)e.push(new Sl({content:oo(t)}));return e}function am(n){const e={};for(const t of n)e[t.getKey()]=new Bs({value:t.getValue(),updatedAt:F(t.getUpdatedAt()),isRemoved:t.isRemoved()});return e}function oo(n){if(!n)return[];const e=[];return $s(n,(t,r)=>{const s=new eo({id:pr(t.id),type:t.type,removedAt:F(t.removedAt),depth:r});t.isText&&(s.value=t.value),t.insPrevID&&(s.insPrevId=pr(t.insPrevID)),t.insNextID&&(s.insNextId=pr(t.insNextID)),t.attrs&&(s.attributes=am(t.attrs)),e.push(s)}),e}function cm(n){const e=new Ze;return e.body.case="jsonObject",e.body.value=new pl({nodes:rm(n.getRHT()),createdAt:F(n.getCreatedAt()),movedAt:F(n.getMovedAt()),removedAt:F(n.getRemovedAt())}),e}function Jl(n){const e=new Ze;return e.body.case="jsonArray",e.body.value=new yl({nodes:sm(n.getElements()),createdAt:F(n.getCreatedAt()),movedAt:F(n.getMovedAt()),removedAt:F(n.getRemovedAt())}),e}function lm(n){const e=new Ze;return e.body.case="primitive",e.body.value=new vl({type:Ll(n.getType()),value:n.toBytes(),createdAt:F(n.getCreatedAt()),movedAt:F(n.getMovedAt()),removedAt:F(n.getRemovedAt())}),e}function um(n){const e=new Ze;return e.body.case="text",e.body.value=new Tl({nodes:im(n.getRGATreeSplit()),createdAt:F(n.getCreatedAt()),movedAt:F(n.getMovedAt()),removedAt:F(n.getRemovedAt())}),e}function fm(n){const e=new Ze;return e.body.case="counter",e.body.value=new wl({type:$l(n.getType()),value:n.toBytes(),createdAt:F(n.getCreatedAt()),movedAt:F(n.getMovedAt()),removedAt:F(n.getRemovedAt())}),e}function ql(n){const e=new Ze;return e.body.case="tree",e.body.value=new bl({nodes:oo(n.getRoot()),createdAt:F(n.getCreatedAt()),movedAt:F(n.getMovedAt()),removedAt:F(n.getRemovedAt())}),e}function ao(n){if(n instanceof $e)return cm(n);if(n instanceof je)return Jl(n);if(n instanceof ce)return lm(n);if(n instanceof Ye)return um(n);if(n instanceof Ke)return fm(n);if(n instanceof Xe)return ql(n);throw new T(y.ErrUnimplemented,"unimplemented element")}function hm(n){return new Wt({documentKey:n.getDocumentKey(),checkpoint:Zg(n.getCheckpoint()),isRemoved:n.getIsRemoved(),changes:nm(n.getChanges()),snapshot:n.getSnapshot(),minSyncedTicket:F(n.getMinSyncedTicket())})}function La(n){const e=n.findDetails(Og);for(const t of e)if(t.metadata.code)return t.metadata.code;return""}function zl(n){let e;return n.serverSeq&&(e=z.fromString(n.serverSeq,!0)),en.of(n.clientSeq,z.fromString(n.lamport,!0),fo(n.actorId),e)}function M(n){if(n)return Le.of(z.fromString(n.lamport,!0),n.delimiter,fo(n.actorId))}function co(n){const e={};return Object.entries(n.data).forEach(([t,r])=>{e[t]=JSON.parse(r)}),e}function dm(n){const e=n.type;if(e===Er.PUT){const t=co(n.presence);return{type:ln.Put,presence:t}}if(e===Er.CLEAR)return{type:ln.Clear};throw new T(y.ErrInvalidType,`unsupported type: ${e}`)}function gm(n){const e=new Map;return Object.entries(n).forEach(([t,r])=>{e.set(t,co(r))}),e}function jl(n){switch(n){case V.NULL:return ve.Null;case V.BOOLEAN:return ve.Boolean;case V.INTEGER:return ve.Integer;case V.LONG:return ve.Long;case V.DOUBLE:return ve.Double;case V.STRING:return ve.String;case V.BYTES:return ve.Bytes;case V.DATE:return ve.Date}throw new T(y.ErrUnimplemented,`unimplemented value type: ${n}`)}function Is(n){switch(n){case V.INTEGER_CNT:return Pt.IntegerCnt;case V.LONG_CNT:return Pt.LongCnt}throw new T(y.ErrUnimplemented,`unimplemented value type: ${n}`)}function si(n){switch(n.type){case V.JSON_OBJECT:return n.value?Xl(n.value):$e.create(M(n.createdAt));case V.JSON_ARRAY:return n.value?Em(n.value):je.create(M(n.createdAt));case V.TEXT:return Ye.create(er.create(),M(n.createdAt));case V.TREE:return Nm(n.value);case V.NULL:case V.BOOLEAN:case V.INTEGER:case V.LONG:case V.DOUBLE:case V.STRING:case V.BYTES:case V.DATE:return ce.of(ce.valueFromBytes(jl(n.type),n.value),M(n.createdAt));case V.INTEGER_CNT:case V.LONG_CNT:return Ke.create(Is(n.type),Ke.valueFromBytes(Is(n.type),n.value),M(n.createdAt))}}function Zr(n){return ut.of(Ot.of(M(n.createdAt),n.offset),n.relativeOffset)}function Kl(n){return Ot.of(M(n.createdAt),n.offset)}function mm(n){const e=Or.create(n.value);Object.entries(n.attributes).forEach(([r,s])=>{e.setAttr(r,s.value,M(s.updatedAt))});const t=on.create(Kl(n.id),e);return t.remove(M(n.removedAt)),t}function _n(n){return at.of(yr(n.parentId),yr(n.leftSiblingId))}function yr(n){return be.of(M(n.createdAt),n.offset)}function pm(n){if(!n.length)return;const e=[];return n.forEach(t=>{const r=lo(t.content);e.push(r)}),e}function lo(n){if(n.length===0)return;const e=[];for(const s of n)e.push(vm(s));const t=e[e.length-1],r=new Map;r.set(n[e.length-1].depth,e[e.length-1]);for(let s=e.length-2;s>=0;s--)r.get(n[s].depth-1).prepend(e[s]),r.set(n[s].depth,e[s]);return t.updateDescendantsSize(),Xe.create(t,lt).getRoot()}function ym(n){const e=Kt.create();for(const[t,r]of Object.entries(n))e.setInternal(t,r.value,M(r.updatedAt),r.isRemoved);return e}function vm(n){const e=yr(n.id),t=ze.create(e,n.type),r=Object.entries(n.attributes);return t.isText?t.value=n.value:r.length&&(t.attrs=ym(n.attributes)),n.insPrevId&&(t.insPrevID=yr(n.insPrevId)),n.insNextId&&(t.insNextID=yr(n.insNextId)),t.removedAt=M(n.removedAt),t}function Vl(n){if(n.body.case==="set"){const e=n.body.value;return Nn.create(e.key,si(e.value),M(e.parentCreatedAt),M(e.executedAt))}else if(n.body.case==="add"){const e=n.body.value;return _r.create(M(e.parentCreatedAt),M(e.prevCreatedAt),si(e.value),M(e.executedAt))}else if(n.body.case==="move"){const e=n.body.value;return tn.create(M(e.parentCreatedAt),M(e.prevCreatedAt),M(e.createdAt),M(e.executedAt))}else if(n.body.case==="remove"){const e=n.body.value;return un.create(M(e.parentCreatedAt),M(e.createdAt),M(e.executedAt))}else if(n.body.case==="edit"){const e=n.body.value,t=new Map;Object.entries(e.createdAtMapByActor).forEach(([s,i])=>{t.set(s,M(i))});const r=new Map;return Object.entries(e.attributes).forEach(([s,i])=>{r.set(s,i)}),Fr.create(M(e.parentCreatedAt),Zr(e.from),Zr(e.to),t,e.content,r,M(e.executedAt))}else if(n.body.case==="style"){const e=n.body.value,t=new Map;Object.entries(e.createdAtMapByActor).forEach(([s,i])=>{t.set(s,M(i))});const r=new Map;return Object.entries(e.attributes).forEach(([s,i])=>{r.set(s,i)}),Mr.create(M(e.parentCreatedAt),Zr(e.from),Zr(e.to),t,r,M(e.executedAt))}else{if(n.body.case==="select")return;if(n.body.case==="increase"){const e=n.body.value;return tr.create(M(e.parentCreatedAt),si(e.value),M(e.executedAt))}else if(n.body.case==="treeEdit"){const e=n.body.value,t=new Map;return Object.entries(e.createdAtMapByActor).forEach(([r,s])=>{t.set(r,M(s))}),Br.create(M(e.parentCreatedAt),_n(e.from),_n(e.to),pm(e.contents),e.splitLevel,t,M(e.executedAt))}else if(n.body.case==="treeStyle"){const e=n.body.value,t=new Map,r=e.attributesToRemove,s=new Map;return e!=null&&e.createdAtMapByActor&&Object.entries(e.createdAtMapByActor).forEach(([i,o])=>{s.set(i,M(o))}),(r==null?void 0:r.length)>0?zt.createTreeRemoveStyleOperation(M(e.parentCreatedAt),_n(e.from),_n(e.to),s,r,M(e.executedAt)):(Object.entries(e.attributes).forEach(([i,o])=>{t.set(i,o)}),zt.create(M(e.parentCreatedAt),_n(e.from),_n(e.to),s,t,M(e.executedAt)))}else throw new T(y.ErrUnimplemented,"unimplemented operation")}}function Tm(n){const e=[];for(const t of n){const r=Vl(t);r&&e.push(r)}return e}function Wl(n){const e=[];for(const t of n)e.push(Qn.create({id:zl(t.id),operations:Tm(t.operations),presenceChange:t.presenceChange?dm(t.presenceChange):void 0,message:t.message}));return e}function wm(n){return Kn.of(z.fromString(n.serverSeq,!0),n.clientSeq)}function bm(n){return Us.create(n.documentKey,wm(n.checkpoint),n.isRemoved,Wl(n.changes),n.snapshot,M(n.minSyncedTicket))}function Hl(n){const e=new xr;for(const r of n.nodes){const s=uo(r.element);e.set(r.key,s,s.getPositionedAt())}const t=new $e(M(n.createdAt),e);return t.setMovedAt(M(n.movedAt)),t.setRemovedAt(M(n.removedAt)),t}function Gl(n){const e=new Cr;for(const r of n.nodes)e.insert(uo(r.element));const t=new je(M(n.createdAt),e);return t.setMovedAt(M(n.movedAt)),t.setRemovedAt(M(n.removedAt)),t}function Am(n){const e=ce.of(ce.valueFromBytes(jl(n.type),n.value),M(n.createdAt));return e.setMovedAt(M(n.movedAt)),e.setRemovedAt(M(n.removedAt)),e}function Im(n){const e=new er;let t=e.getHead();for(const s of n.nodes){const i=e.insertAfter(t,mm(s));s.insPrevId&&i.setInsPrev(e.findNode(Kl(s.insPrevId))),t=i}const r=new Ye(e,M(n.createdAt));return r.setMovedAt(M(n.movedAt)),r.setRemovedAt(M(n.removedAt)),r}function Sm(n){const e=Ke.create(Is(n.type),Ke.valueFromBytes(Is(n.type),n.value),M(n.createdAt));return e.setMovedAt(M(n.movedAt)),e.setRemovedAt(M(n.removedAt)),e}function Yl(n){const e=lo(n.nodes);return Xe.create(e,M(n.createdAt))}function uo(n){if(n.body.case==="jsonObject")return Hl(n.body.value);if(n.body.case==="jsonArray")return Gl(n.body.value);if(n.body.case==="primitive")return Am(n.body.value);if(n.body.case==="text")return Im(n.body.value);if(n.body.case==="counter")return Sm(n.body.value);if(n.body.case==="tree")return Yl(n.body.value);throw new T(y.ErrUnimplemented,"unimplemented element")}function km(n){if(!n)return{root:$e.create(lt),presences:new Map};const e=og.fromBinary(n);return{root:uo(e.root),presences:gm(e.presences)}}function Xl(n){if(!n)throw new T(y.ErrInvalidArgument,"bytes is empty");const e=Ze.fromBinary(n);return Hl(e.body.value)}function Zl(n){return ao(n).toBinary()}function Em(n){if(!n)throw new T(y.ErrInvalidArgument,"bytes is empty");const e=Ze.fromBinary(n);return Gl(e.body.value)}function xm(n){return Jl(n).toBinary()}function Nm(n){if(!n)throw new T(y.ErrInvalidArgument,"bytes is empty");const e=Ze.fromBinary(n);return Yl(e.body.value)}function Cm(n){return ql(n).toBinary()}function Ql(n){return n?Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function fo(n){return Ql(n)}function eu(n){return new Uint8Array(n.match(/.{1,2}/g).map(e=>parseInt(e,16)))}function ho(n){return eu(n)}function Om(n){const e=Ms.fromBinary(n);return zl(e)}function Pm(n){const e=Zi.fromBinary(n);return Vl(e)}const Te={fromPresence:co,toChangePack:hm,fromChangePack:bm,fromChanges:Wl,toTreeNodes:oo,fromTreeNodes:lo,objectToBytes:Zl,bytesToObject:Xl,bytesToSnapshot:km,bytesToHex:Ql,hexToBytes:eu,toHexString:fo,toUint8Array:ho,toOperation:Ul,toChangeID:Bl,PbChangeID:Ms,bytesToChangeID:Om,bytesToOperation:Pm};var De=(n=>(n[n.Trivial=0]="Trivial",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warn=3]="Warn",n[n.Error=4]="Error",n[n.Fatal=5]="Fatal",n))(De||{});let pn=3;function tu(n){pn=n}const q={trivial:(...n)=>{pn>0||typeof console<"u"&&console.log("YORKIE T:",...n)},debug:(...n)=>{pn>1||typeof console<"u"&&console.log("YORKIE D:",...n)},info:(...n)=>{pn>2||typeof console<"u"&&console.log("YORKIE I:",...n)},warn:(...n)=>{pn>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...n):console.log("YORKIE W:",...n))},error:(...n)=>{pn>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...n):console.log("YORKIE E:",...n))},fatal:(...n)=>{typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...n):console.log("YORKIE F:",...n))},isEnabled:n=>pn<=n};function nu(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}class Dm{constructor(e,t,r,s){h(this,"reconnectStreamDelay");h(this,"doc");h(this,"docID");h(this,"syncMode");h(this,"remoteChangeEventReceived");h(this,"watchStream");h(this,"watchLoopTimerID");h(this,"watchAbortController");this.reconnectStreamDelay=e,this.doc=t,this.docID=r,this.syncMode=s,this.remoteChangeEventReceived=!1}changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode===hs.RealtimeSyncOff?!1:this.syncMode===hs.RealtimePushOnly?this.doc.hasLocalChanges():this.syncMode!==hs.Manual&&(this.doc.hasLocalChanges()||this.remoteChangeEventReceived)}async runWatchLoop(e){const t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay)})}catch{}};await t()}cancelWatchStream(){this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}const ii=()=>{};class Rm{constructor(e){h(this,"finalized",!1);h(this,"observers",[]);h(this,"finalError");try{e(this)}catch(t){this.error(t)}}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(!e)throw new T(y.ErrInvalidArgument,"missing observer");if(this.finalized)throw new T(y.ErrRefused,"observable is finalized due to previous error");typeof e=="object"?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=ii),s.error===void 0&&(s.error=ii),s.complete===void 0&&(s.complete=ii);const i=nu(),o=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(a){q.warn(a)}return o}unsubscribeOne(e){var t;this.observers=(t=this.observers)==null?void 0:t.filter(r=>r.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e].observer)}catch(r){q.error(r)}}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.observers=void 0)}}function _m(n){const e=new Rm(n);return{subscribe:e.subscribe.bind(e),getProxy:()=>e}}class Ln{constructor(e,t,r,s){h(this,"id");h(this,"delimiter");h(this,"message");h(this,"root");h(this,"operations");h(this,"presenceChange");h(this,"previousPresence");h(this,"reversePresenceKeys");this.id=e,this.delimiter=ro,this.root=t,this.operations=[],this.previousPresence=nt(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(e,t,r,s){return new Ln(e,t,r,s)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getChange(){return Qn.create({id:this.id,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(const r of Object.keys(e))t!=null&&t.addToHistory?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const e={};for(const t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.id.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.id.createTimeTicket(this.delimiter)}}class Pr{constructor(e){h(this,"rootObject");h(this,"elementPairMapByCreatedAt");h(this,"gcElementSetByCreatedAt");h(this,"gcPairMap");this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.registerElement(e,void 0),e.getDescendants(t=>{if(t.getRemovedAt()&&this.registerRemovedElement(t),t instanceof Ye||t instanceof Xe)for(const r of t.getGCPairs())this.registerGCPair(r);return!1})}static create(){return new Pr($e.create(lt))}findByCreatedAt(e){const t=this.elementPairMapByCreatedAt.get(e.toIDString());if(t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];const r=[];for(;t.parent;){const s=t.element.getCreatedAt(),i=t.parent.subPathOf(s);if(i===void 0)throw new T(y.ErrInvalidArgument,`cant find the given element: ${s.toIDString()}`);r.unshift(i),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),e instanceof sn&&e.getDescendants((r,s)=>(this.registerElement(r,s),!1))}deregisterElement(e){let t=0;const r=s=>{const i=s.getCreatedAt().toIDString();this.elementPairMapByCreatedAt.delete(i),this.gcElementSetByCreatedAt.delete(i),t++};return r(e),e instanceof sn&&e.getDescendants(s=>(r(s),!1)),t}registerRemovedElement(e){this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const e=new Set;for(const t of this.gcElementSetByCreatedAt){e.add(t);const r=this.elementPairMapByCreatedAt.get(t);r.element instanceof sn&&r.element.getDescendants(s=>(e.add(s.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}deepcopy(){return new Pr(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(const r of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(r);s.element.getRemovedAt()&&e.compare(s.element.getRemovedAt())>=0&&(s.parent.purge(s.element),t+=this.deregisterElement(s.element))}for(const[,r]of this.gcPairMap){const s=r.child.getRemovedAt();s!==void 0&&e.compare(s)>=0&&(r.parent.purge(r.child),this.gcPairMap.delete(r.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}}function ru(n,e){const t=new Dr(n);return new Proxy(e,t.getHandlers())}class Dr{constructor(e){h(this,"context");h(this,"handlers");this.context=e,this.handlers={set:(t,r,s)=>(q.isEnabled(De.Trivial)&&q.trivial(`obj[${r}]=${JSON.stringify(s)}`),Dr.setInternal(e,t,r,s),!0),get:(t,r)=>(q.isEnabled(De.Trivial)&&q.trivial(`obj[${r}]`),r==="getID"?()=>t.getCreatedAt():r==="toJSON"||r==="toString"?()=>t.toJSON():r==="toJS"?()=>t.toJS():r==="toJSForTest"?()=>t.toJSForTest():yn(e,t.get(r))),ownKeys:t=>t.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,r)=>(q.isEnabled(De.Trivial)&&q.trivial(`obj[${r}]`),Dr.deleteInternal(e,t,r),!0)}}static setInternal(e,t,r,s){if(r.includes("."))throw new T(y.ErrInvalidObjectKey,"key must not contain the '.'.");const i=e.issueTimeTicket(),o=Ss(e,s,i),a=t.set(r,o,i);e.registerElement(o,t),a&&e.registerRemovedElement(a),e.push(Nn.create(r,o.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){const r={};for(const[s,i]of Object.entries(t)){if(s.includes("."))throw new T(y.ErrInvalidObjectKey,"key must not contain the '.'.");const o=e.issueTimeTicket(),a=Ss(e,i,o);r[s]=a}return r}static deleteInternal(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByKey(r,s);i&&(e.push(un.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}}function Fm(n,e){const t=new fe(n,e);return new Proxy(e,t.getHandlers())}function Mm(n){return typeof n=="string"||n instanceof String?!isNaN(n):!1}function Bm(n){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(n)}class fe{constructor(e,t){h(this,"context");h(this,"handlers");h(this,"array");this.context=e,this.array=t,this.handlers={get:(r,s,i)=>s==="getID"?()=>r.getCreatedAt():s==="getElementByID"?o=>{const a=r.getByID(o);if(!(!a||a.isRemoved()))return Xt(e,a)}:s==="getElementByIndex"?o=>{const a=r.get(o);return Xt(e,a)}:s==="getLast"?()=>Xt(e,r.getLast()):s==="deleteByID"?o=>{const a=fe.deleteInternalByID(e,r,o);return Xt(e,a)}:s==="insertAfter"?(o,a)=>{const c=fe.insertAfterInternal(e,r,o,a);return Xt(e,c)}:s==="insertBefore"?(o,a)=>{const c=fe.insertBeforeInternal(e,r,o,a);return Xt(e,c)}:s==="moveBefore"?(o,a)=>{fe.moveBeforeInternal(e,r,o,a)}:s==="moveAfter"?(o,a)=>{fe.moveAfterInternal(e,r,o,a)}:s==="moveFront"?o=>{fe.moveFrontInternal(e,r,o)}:s==="moveLast"?o=>{fe.moveLastInternal(e,r,o)}:Mm(s)?yn(e,r.get(Number(s))):s==="push"?o=>fe.pushInternal(e,r,o):s==="splice"?(o,a,...c)=>fe.splice(e,r,o,a,...c):s==="length"?r.length:typeof s=="symbol"&&s===Symbol.iterator?fe.iteratorInternal.bind(this,e,r):s==="includes"?(o,a)=>fe.includes(e,r,o,a):s==="indexOf"?(o,a)=>fe.indexOf(e,r,o,a):s==="lastIndexOf"?(o,a)=>fe.lastIndexOf(e,r,o,a):s==="toJSForTest"?()=>r.toJSForTest():s==="toTestString"?()=>fe.toTestString(r):typeof s=="string"&&Bm(s)?(...o)=>{const a=Array.from(r).map(c=>yn(e,c));return Array.prototype[s].apply(a,o)}:Reflect.get(r,s,i),deleteProperty:(r,s)=>(q.isEnabled(De.Trivial)&&q.trivial(`array[${s}]`),fe.deleteInternalByIndex(e,r,Number.parseInt(s)),!0)}}static*iteratorInternal(e,t){for(const r of t)yield Xt(e,r)}static buildArrayElements(e,t){const r=[];for(const s of t){const i=e.issueTimeTicket(),o=Ss(e,s,i);r.push(o)}return r}static pushInternal(e,t,r){return fe.insertAfterInternal(e,t,t.getLastCreatedAt(),r),t.length}static moveBeforeInternal(e,t,r,s){const i=e.issueTimeTicket(),o=t.getPrevCreatedAt(r);t.moveAfter(o,s,i),e.push(tn.create(t.getCreatedAt(),o,s,i))}static moveAfterInternal(e,t,r,s){const i=e.issueTimeTicket();t.moveAfter(r,s,i),e.push(tn.create(t.getCreatedAt(),r,s,i))}static moveFrontInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),r,s),e.push(tn.create(t.getCreatedAt(),i.getCreatedAt(),r,s))}static moveLastInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,r,s),e.push(tn.create(t.getCreatedAt(),i,r,s))}static insertAfterInternal(e,t,r,s){const i=e.issueTimeTicket(),o=Ss(e,s,i);return t.insertAfter(r,o),e.registerElement(o,t),e.push(_r.create(t.getCreatedAt(),r,o.deepcopy(),i)),o}static insertBeforeInternal(e,t,r,s){return fe.insertAfterInternal(e,t,t.getPrevCreatedAt(r),s)}static deleteInternalByIndex(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByIndex(r,s);if(i)return e.push(un.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,r){const s=e.issueTimeTicket(),i=t.delete(r,s);return e.push(un.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static splice(e,t,r,s,...i){const o=t.length,a=r>=0?Math.min(r,o):Math.max(o+r,0),c=s===void 0?o:s<0?a:Math.min(a+s,o),l=[];for(let u=a;u<c;u++){const g=fe.deleteInternalByIndex(e,t,a);if(g){const v=g.deepcopy();v.setRemovedAt(),l.push(yn(e,v))}}if(i){let u=a===0?t.getHead().getID():t.get(a-1).getID();for(const g of i)u=fe.insertAfterInternal(e,t,u,g).getID()}return l}static includes(e,t,r,s){var a;const i=t.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return!1;if(ce.isSupport(r))return Array.from(t).map(l=>yn(e,l)).includes(r,o);for(let c=o;c<i;c++)if(((a=t.get(c))==null?void 0:a.getID())===r.getID())return!0;return!1}static indexOf(e,t,r,s){var a;const i=t.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return-1;if(ce.isSupport(r))return Array.from(t).map(l=>yn(e,l)).indexOf(r,o);for(let c=o;c<i;c++)if(((a=t.get(c))==null?void 0:a.getID())===r.getID())return c;return-1}static lastIndexOf(e,t,r,s){var a;const i=t.length,o=s===void 0||s>=i?i-1:s<0?s+i:s;if(o<0)return-1;if(ce.isSupport(r))return Array.from(t).map(l=>yn(e,l)).lastIndexOf(r,o);for(let c=o;c>0;c--)if(((a=t.get(c))==null?void 0:a.getID())===r.getID())return c;return-1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}}class Js{constructor(e,t){h(this,"context");h(this,"text");this.context=e,this.text=t}initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,r,s){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new T(y.ErrInvalidArgument,"from should be less than or equal to to");const i=this.text.indexRangeToPosRange(e,t);q.isEnabled(De.Debug)&&q.debug(`EDIT: f:${e}->${i[0].toTestString()}, t:${t}->${i[1].toTestString()} c:${r}`);const o=s?Zn(s):void 0,a=this.context.issueTimeTicket(),[c,,l,u]=this.text.edit(i,r,a,o);for(const g of l)this.context.registerGCPair(g);return this.context.push(new Fr(this.text.getCreatedAt(),i[0],i[1],c,r,o?new Map(Object.entries(o)):new Map,a)),this.text.findIndexesFromRange(u)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,r){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new T(y.ErrInvalidArgument,"from should be less than or equal to to");const s=this.text.indexRangeToPosRange(e,t);q.isEnabled(De.Debug)&&q.debug(`STYL: f:${e}->${s[0].toTestString()}, t:${t}->${s[1].toTestString()} a:${JSON.stringify(r)}`);const i=Zn(r),o=this.context.issueTimeTicket(),[a,c]=this.text.setStyle(s,i,o);for(const l of c)this.context.registerGCPair(l);return this.context.push(new Mr(this.text.getCreatedAt(),s[0],s[1],a,new Map(Object.entries(i)),o)),!0}indexRangeToPosRange(e){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");const t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");const t=this.text.findIndexesFromRange([ut.fromStruct(e[0]),ut.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text)throw new T(y.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(e,t)}}class qs{constructor(e,t){h(this,"valueType");h(this,"value");h(this,"context");h(this,"counter");this.valueType=e,this.value=t}initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter)throw new T(y.ErrNotInitialized,"Counter is not initialized yet");const t=this.context.issueTimeTicket(),r=ce.of(e,t);if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`);return this.counter.increase(r),this.context.push(tr.create(this.counter.getCreatedAt(),r,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new T(y.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}}function go(n,e,t){const{type:r}=n,s=t.issueTimeTicket();if(r===qt){su(n);const{value:i}=n,o=ze.create(be.of(s,0),r,i);e.append(o)}else{const{children:i=[]}=n;let{attributes:o}=n,a;if(typeof o=="object"&&!Ol(o)){o=Zn(o),a=new Kt;for(const[l,u]of Object.entries(o))a.set(l,u,s)}const c=ze.create(be.of(s,0),r,void 0,a);e.append(c);for(const l of i)go(l,c,t)}}function Lm(n,e){const{type:t}=e,r=n.issueTimeTicket();let s;if(e.type===qt){const{value:i}=e;s=ze.create(be.of(r,0),t,i)}else if(e){const{children:i=[]}=e;let{attributes:o}=e,a;if(typeof o=="object"&&!Ol(o)){o=Zn(o),a=new Kt;for(const[c,l]of Object.entries(o))a.set(c,l,r)}s=ze.create(be.of(n.issueTimeTicket(),0),t,void 0,a);for(const c of i)go(c,s,n)}return s}function su(n){if(!n.value.length)throw new T(y.ErrInvalidArgument,"text node cannot have empty value");return!0}function $a(n){if(!n.length)return!0;if(n[0].type===qt)for(const t of n){const{type:r}=t;if(r!==qt)throw new T(y.ErrInvalidArgument,"element node and text node cannot be passed together");su(t)}else for(const t of n){const{type:r}=t;if(r===qt)throw new T(y.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class zs{constructor(e){h(this,"initialRoot");h(this,"context");h(this,"tree");this.initialRoot=e}initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return ze.create(be.of(e.issueTimeTicket(),0),$g);const t=ze.create(be.of(e.issueTimeTicket(),0),this.initialRoot.type);for(const r of this.initialRoot.children)go(r,t,e);return t}getSize(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}styleByPath(e,t){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new T(y.ErrInvalidArgument,"path should not be empty");const[r,s]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),o=t?Zn(t):void 0,[a]=this.tree.style([r,s],o,i);this.context.push(zt.create(this.tree.getCreatedAt(),r,s,a,o?new Map(Object.entries(o)):new Map,i))}style(e,t,r){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new T(y.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),a=r?Zn(r):void 0,[c,l]=this.tree.style([s,i],a,o);for(const u of l)this.context.registerGCPair(u);this.context.push(zt.create(this.tree.getCreatedAt(),s,i,c,a?new Map(Object.entries(a)):new Map,o))}removeStyle(e,t,r){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new T(y.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),[a,c]=this.tree.removeStyle([s,i],r,o);for(const l of c)this.context.registerGCPair(l);this.context.push(zt.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,i,a,r,o))}editInternal(e,t,r,s=0){var l;if(r.length!==0&&r[0]&&($a(r),r[0].type!==qt))for(const u of r){const{children:g=[]}=u;$a(g)}const i=this.context.getLastTimeTicket();let o=new Array;if(((l=r[0])==null?void 0:l.type)===qt){let u="";for(const g of r){const{value:v}=g;u+=v}o.push(ze.create(be.of(this.context.issueTimeTicket(),0),qt,u))}else o=r.map(u=>u&&Lm(this.context,u)).filter(u=>u);const[,a,c]=this.tree.edit([e,t],o.length?o.map(u=>u==null?void 0:u.deepcopy()):void 0,s,i,()=>this.context.issueTimeTicket());for(const u of a)this.context.registerGCPair(u);return this.context.push(Br.create(this.tree.getCreatedAt(),e,t,o.length?o:void 0,s,c,i)),!0}editByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new T(y.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new T(y.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulkByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new T(y.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new T(y.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r,s)}edit(e,t,r,s=0){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new T(y.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulk(e,t,r,s=0){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new T(y.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r,s)}toXML(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");const t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],r=this.tree.indexRangeToPosRange(t);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");const t=[at.fromStruct(e[0]),at.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree)throw new T(y.ErrNotInitialized,"Tree is not initialized yet");const t=[at.fromStruct(e[0]),at.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}}function Ua(n,e){return ru(n,e)}function Xt(n,e){if(e){if(e instanceof ce)return e;if(e instanceof $e)return ru(n,e);if(e instanceof je)return Fm(n,e);if(e instanceof Ye)return new Js(n,e);if(e instanceof Ke){const t=new qs(Pt.IntegerCnt,0);return t.initialize(n,e),t}else if(e instanceof Xe){const t=new zs;return t.initialize(n,e),t}}else return;throw new TypeError(`Unsupported type of element: ${typeof e}`)}function yn(n,e){const t=Xt(n,e);return t instanceof ce?t.getValue():t}function Ss(n,e,t){let r;if(ce.isSupport(e))r=ce.of(e,t);else if(Array.isArray(e))r=je.create(t,fe.buildArrayElements(n,e));else if(typeof e=="object")e instanceof Js?(r=Ye.create(er.create(),t),e.initialize(n,r)):e instanceof qs?(r=Ke.create(e.getValueType(),e.getValue(),t),e.initialize(n,r)):e instanceof zs?(r=Xe.create(e.buildRoot(n),t),e.initialize(n,r)):r=$e.create(t,Dr.buildObjectMembers(n,e));else throw new TypeError(`Unsupported type of value: ${typeof e}`);return r}const Ja=50;class $m{constructor(){h(this,"undoStack",[]);h(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=Ja&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=Ja&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}}const Um="yorkie-devtools-panel",Jm="yorkie-devtools-sdk";let Mn="disconnected";const qa=new Map,fs=new Map;typeof window<"u"&&(window.transactionEventsByDocKey=fs);function Qr(n,e){(e!=null&&e.force||Mn!=="disconnected")&&window.postMessage({source:Jm,...n},"*")}function qm(n){if(!n.isEnableDevtools()||typeof window>"u"||qa.has(n.getKey()))return;fs.set(n.getKey(),[]);const e=n.subscribe("all",t=>{t.some(r=>r.type!==Me.StatusChanged&&r.type!==Me.Snapshot&&r.type!==Me.LocalChange&&r.type!==Me.RemoteChange&&r.type!==Me.Initialized&&r.type!==Me.Watched&&r.type!==Me.Unwatched&&r.type!==Me.PresenceChanged)||(fs.get(n.getKey()).push(t),Mn==="synced"&&Qr({msg:"doc::sync::partial",docKey:n.getKey(),event:t}))});qa.set(n.getKey(),[e]),Qr({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{var s;if(((s=t.data)==null?void 0:s.source)!==Um)return;switch(t.data.msg){case"devtools::connect":if(Mn!=="disconnected")break;Mn="connected",Qr({msg:"doc::available",docKey:n.getKey()}),q.info(`[YD] Devtools connected. Doc: ${n.getKey()}`);break;case"devtools::disconnect":Mn="disconnected",q.info(`[YD] Devtools disconnected. Doc: ${n.getKey()}`);break;case"devtools::subscribe":Mn="synced",Qr({msg:"doc::sync::full",docKey:n.getKey(),events:fs.get(n.getKey())}),q.info(`[YD] Devtools subscribed. Doc: ${n.getKey()}`);break}})}var Zt=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(Zt||{}),Me=(n=>(n.StatusChanged="status-changed",n.ConnectionChanged="connection-changed",n.SyncStatusChanged="sync-status-changed",n.Snapshot="snapshot",n.LocalChange="local-change",n.RemoteChange="remote-change",n.Initialized="initialized",n.Watched="watched",n.Unwatched="unwatched",n.PresenceChanged="presence-changed",n))(Me||{}),Ei=(n=>(n.Connected="connected",n.Disconnected="disconnected",n))(Ei||{}),xi=(n=>(n.Synced="synced",n.SyncFailed="sync-failed",n))(xi||{});class iu{constructor(e,t){h(this,"key");h(this,"status");h(this,"opts");h(this,"changeID");h(this,"checkpoint");h(this,"localChanges");h(this,"root");h(this,"clone");h(this,"eventStream");h(this,"eventStreamObserver");h(this,"onlineClients");h(this,"presences");h(this,"history");h(this,"internalHistory");h(this,"isUpdating");this.opts=t||{},this.key=e,this.status="detached",this.root=Pr.create(),this.changeID=Wg,this.checkpoint=Hg,this.localChanges=[],this.eventStream=_m(r=>{this.eventStreamObserver=r}),this.onlineClients=new Set,this.presences=new Map,this.isUpdating=!1,this.internalHistory=new $m,this.history={canUndo:this.canUndo.bind(this),canRedo:this.canRedo.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},qm(this)}update(e,t){if(this.getStatus()==="removed")throw new T(y.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const r=this.changeID.getActorID(),s=Ln.create(this.changeID.next(),this.clone.root,this.clone.presences.get(r)||{},t);try{const i=Ua(s,this.clone.root.getObject());this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,e(i,new ni(s,this.clone.presences.get(r)))}catch(i){throw this.clone=void 0,i}finally{this.isUpdating=!1}if(s.hasChange()){q.isEnabled(De.Trivial)&&q.trivial(`trying to update a local change: ${this.toJSON()}`);const i=s.getChange(),{opInfos:o,reverseOps:a}=i.execute(this.root,this.presences,re.Local),c=s.getReversePresence();c&&a.push({type:"presence",value:c}),this.localChanges.push(i),a.length>0&&this.internalHistory.pushUndo(a),o.length>0&&this.internalHistory.clearRedo(),this.changeID=i.getID();const l=[];o.length>0&&l.push({type:"local-change",source:re.Local,value:{message:i.getMessage()||"",operations:o,actor:r,clientSeq:i.getID().getClientSeq(),serverSeq:i.getID().getServerSeq()},rawChange:this.isEnableDevtools()?i.toStruct():void 0}),i.hasPresenceChange()&&l.push({type:"presence-changed",source:re.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(l),q.isEnabled(De.Trivial)&&q.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(e,t,r,s){if(typeof e=="string"){if(typeof t!="function")throw new T(y.ErrInvalidArgument,"Second argument must be a callback function");if(e==="presence"){const a=t;return this.eventStream.subscribe(c=>{for(const l of c)l.type!=="initialized"&&l.type!=="watched"&&l.type!=="unwatched"&&l.type!=="presence-changed"||a(l)},r,s)}if(e==="my-presence"){const a=t;return this.eventStream.subscribe(c=>{for(const l of c)l.type!=="initialized"&&l.type!=="presence-changed"||l.type==="presence-changed"&&l.value.clientID!==this.changeID.getActorID()||a(l)},r,s)}if(e==="others"){const a=t;return this.eventStream.subscribe(c=>{for(const l of c)l.type!=="watched"&&l.type!=="unwatched"&&l.type!=="presence-changed"||l.value.clientID!==this.changeID.getActorID()&&a(l)},r,s)}if(e==="connection"){const a=t;return this.eventStream.subscribe(c=>{for(const l of c)l.type==="connection-changed"&&a(l)},r,s)}if(e==="status"){const a=t;return this.eventStream.subscribe(c=>{for(const l of c)l.type==="status-changed"&&a(l)},r,s)}if(e==="sync"){const a=t;return this.eventStream.subscribe(c=>{for(const l of c)l.type==="sync-status-changed"&&a(l)},r,s)}if(e==="all"){const a=t;return this.eventStream.subscribe(a,r,s)}const i=e,o=t;return this.eventStream.subscribe(a=>{for(const c of a){if(c.type!=="local-change"&&c.type!=="remote-change")continue;const l=[];for(const u of c.value.operations)this.isSameElementOrChildOf(u.path,i)&&l.push(u);l.length&&o({...c,value:{...c.value,operations:l}})}},r,s)}if(typeof e=="function"){const i=e,o=t,a=r;return this.eventStream.subscribe(c=>{for(const l of c)l.type!=="snapshot"&&l.type!=="local-change"&&l.type!=="remote-change"||i(l)},o,a)}throw new T(y.ErrInvalidArgument,`"${e}" is not a valid`)}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}isSameElementOrChildOf(e,t){if(t===e)return!0;const r=e.split(".");return t.split(".").every((i,o)=>i===r[o])}applyChangePack(e){for(e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getSnapshot()):e.hasChanges()&&this.applyChanges(e.getChanges(),re.Remote);this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e.getCheckpoint().getClientSeq());)this.localChanges.shift();e.hasSnapshot()&&this.applyChanges(this.localChanges,re.Remote),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),this.garbageCollect(e.getMinSyncedTicket()),e.getIsRemoved()&&this.applyStatus("removed"),q.isEnabled(De.Trivial)&&q.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:nt(this.presences)})}createChangePack(){const e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return Us.create(this.key,t,!1,e)}setActor(e){for(const t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const e=Ln.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return Ua(e,this.clone.root.getObject())}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t){const{root:r,presences:s}=Te.bytesToSnapshot(t);this.root=new Pr(r),this.presences=s,this.changeID=this.changeID.syncLamport(e),this.clone=void 0,this.publish([{type:"snapshot",source:re.Remote,value:{snapshot:this.isEnableDevtools()?Te.bytesToHex(t):void 0,serverSeq:e.toString()}}])}applyChanges(e,t){q.isEnabled(De.Debug)&&q.debug(`trying to apply ${e.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),q.isEnabled(De.Trivial)&&q.trivial(e.map(r=>`${r.getID().toTestString()}	${r.toTestString()}`).join(`
`));for(const r of e)this.applyChange(r,t);q.isEnabled(De.Debug)&&q.debug(`after appling ${e.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);const r=[],s=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(s)){const o=e.getPresenceChange();switch(o.type){case ln.Put:r.push(this.presences.has(s)?{type:"presence-changed",source:t,value:{clientID:s,presence:o.presence}}:{type:"watched",source:re.Remote,value:{clientID:s,presence:o.presence}});break;case ln.Clear:r.push({type:"unwatched",source:re.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:i}=e.execute(this.root,this.presences,t);if(this.changeID=this.changeID.syncLamport(e.getID().getLamport()),i.length>0){const o=this.isEnableDevtools()?e.toStruct():void 0;r.push(t===re.Remote?{type:"remote-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:o}:{type:"local-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:o})}r.length>0&&this.publish(r)}applyWatchStream(e){if(e.body.case==="initialization"){const t=e.body.value.clientIds,r=new Set;for(const s of t)s!==this.changeID.getActorID()&&r.add(s);this.setOnlineClients(r),this.publish([{type:"initialized",source:re.Local,value:this.getPresences()}]);return}if(e.body.case==="event"){const{type:t,publisher:r}=e.body.value,s=[];if(t===ws.DOCUMENT_WATCHED)this.addOnlineClient(r),this.hasPresence(r)&&s.push({type:"watched",source:re.Remote,value:{clientID:r,presence:this.getPresence(r)}});else if(t===ws.DOCUMENT_UNWATCHED){const i=this.getPresence(r);this.removeOnlineClient(r),i&&s.push({type:"unwatched",source:re.Remote,value:{clientID:r,presence:i}})}s.length>0&&this.publish(s)}}applyStatus(e){this.status=e,e==="detached"&&this.setActor(Ls),this.publish([{source:e==="removed"?re.Remote:re.Local,type:"status-changed",value:e==="attached"?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEvent(e){if(e.type==="status-changed"){this.applyStatus(e.value.status),e.value.status==="attached"&&this.setActor(e.value.actorID);return}if(e.type==="snapshot"){const{snapshot:t,serverSeq:r}=e.value;if(!t)return;this.applySnapshot(z.fromString(r),Te.hexToBytes(t));return}if(e.type==="local-change"||e.type==="remote-change"){if(!e.rawChange)return;const t=Qn.fromStruct(e.rawChange);this.applyChange(t,e.source)}if(e.type==="initialized"){const t=new Set;for(const{clientID:r,presence:s}of e.value)t.add(r),this.presences.set(r,s);this.setOnlineClients(t);return}if(e.type==="watched"){const{clientID:t,presence:r}=e.value;this.addOnlineClient(t),this.presences.set(t,r);return}if(e.type==="unwatched"){const{clientID:t}=e.value;this.removeOnlineClient(t),this.presences.delete(t)}if(e.type==="presence-changed"){const{clientID:t,presence:r}=e.value;this.presences.set(t,r)}}applyTransactionEvent(e){for(const t of e)this.applyDocEvent(t)}getValueByPath(e){if(!e.startsWith("$"))throw new T(y.ErrInvalidArgument,'path must start with "$"');const t=e.split(".");t.shift();let r=this.getRoot();for(const s of t)if(r=r[s],r===void 0)return;return r}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if(this.status!=="attached")return{};const e=this.presences.get(this.changeID.getActorID());return e?nt(e):{}}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;const t=this.presences.get(e);return t?nt(t):void 0}getPresenceForTest(e){const t=this.presences.get(e);return t?nt(t):void 0}getPresences(){const e=[];e.push({clientID:this.changeID.getActorID(),presence:nt(this.getMyPresence())});for(const t of this.onlineClients)this.presences.has(t)&&e.push({clientID:t,presence:nt(this.presences.get(t))});return e}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((t,r)=>t.clientID>r.clientID?1:-1)}canUndo(){return this.internalHistory.hasUndo()&&!this.isUpdating}canRedo(){return this.internalHistory.hasRedo()&&!this.isUpdating}undo(){if(this.isUpdating)throw new T(y.ErrRefused,"Undo is not allowed during an update");const e=this.internalHistory.popUndo();if(e===void 0)throw new T(y.ErrRefused,"There is no operation to be undone");this.ensureClone();const t=Ln.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const l of e){if(!(l instanceof ft)){new ni(t,nt(this.clone.presences.get(this.changeID.getActorID()))).set(l.value,{addToHistory:!0});continue}const u=t.issueTimeTicket();l.setExecutedAt(u),t.push(l)}const r=t.getChange();r.execute(this.clone.root,this.clone.presences,re.UndoRedo);const{opInfos:s,reverseOps:i}=r.execute(this.root,this.presences,re.UndoRedo),o=t.getReversePresence();if(o&&i.push({type:"presence",value:o}),i.length>0&&this.internalHistory.pushRedo(i),!r.hasPresenceChange()&&s.length===0)return;this.localChanges.push(r),this.changeID=r.getID();const a=this.changeID.getActorID(),c=[];s.length>0&&c.push({type:"local-change",source:re.UndoRedo,value:{message:r.getMessage()||"",operations:s,actor:a,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&c.push({type:"presence-changed",source:re.UndoRedo,value:{clientID:a,presence:this.getPresence(a)}}),this.publish(c)}redo(){if(this.isUpdating)throw new T(y.ErrRefused,"Redo is not allowed during an update");const e=this.internalHistory.popRedo();if(e===void 0)throw new T(y.ErrRefused,"There is no operation to be redone");this.ensureClone();const t=Ln.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const l of e){if(!(l instanceof ft)){new ni(t,nt(this.clone.presences.get(this.changeID.getActorID()))).set(l.value,{addToHistory:!0});continue}const u=t.issueTimeTicket();l.setExecutedAt(u),t.push(l)}const r=t.getChange();r.execute(this.clone.root,this.clone.presences,re.UndoRedo);const{opInfos:s,reverseOps:i}=r.execute(this.root,this.presences,re.UndoRedo),o=t.getReversePresence();if(o&&i.push({type:"presence",value:o}),i.length>0&&this.internalHistory.pushUndo(i),!r.hasPresenceChange()&&s.length===0)return;this.localChanges.push(r),this.changeID=r.getID();const a=this.changeID.getActorID(),c=[];s.length>0&&c.push({type:"local-change",source:re.UndoRedo,value:{message:r.getMessage()||"",operations:s,actor:a,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&c.push({type:"presence-changed",source:re.UndoRedo,value:{clientID:a,presence:this.getPresence(a)}}),this.publish(c)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}}function zm(n,e){return t=>async r=>(n&&r.header.set("x-api-key",n),e&&r.header.set("authorization",e),await t(r))}const jm="yorkie-js-sdk",Km="0.4.31",Vm="Yorkie JS SDK",Wm="./src/yorkie.ts",Hm={access:"public",main:"./dist/yorkie-js-sdk.js",typings:"./dist/yorkie-js-sdk.d.ts"},Gm=["dist"],Ym={build:"tsc && vite build","build:proto":"npx buf generate","build:docs":"typedoc","build:ghpages":"mkdir -p ghpages/examples && cp -r docs ghpages/api-reference && find ../../examples -name 'dist' -type d -exec sh -c 'cp -r {} ghpages/examples/$(basename $(dirname {}))' \\;",dev:"vite build -c vite.preview.ts && vite preview",test:"vitest run","test:watch":"vitest","test:bench":"vitest bench","test:ci":"vitest run --coverage","test:yorkie.dev":"TEST_RPC_ADDR=https://api.yorkie.dev vitest run --coverage",lint:"eslint . --fix --max-warnings=0 --ext .ts",prepare:"pnpm build"},Xm={node:">=18.0.0",npm:">=7.1.0"},Zm={type:"git",url:"git+https://github.com/yorkie-team/yorkie-js-sdk.git"},Qm={name:"hackerwins",email:"susukang98@gmail.com"},ep="Apache-2.0",tp={url:"https://github.com/yorkie-team/yorkie-js-sdk/issues"},np="https://github.com/yorkie-team/yorkie-js-sdk#readme",rp={"@buf/googleapis_googleapis.bufbuild_es":"^1.4.0-20240524201209-f0e53af8f2fc.3","@bufbuild/buf":"^1.28.1","@bufbuild/protoc-gen-es":"^1.6.0","@connectrpc/protoc-gen-connect-es":"^1.4.0","@types/google-protobuf":"^3.15.5","@types/long":"^4.0.1","@typescript-eslint/eslint-plugin":"^6.21.0","@typescript-eslint/parser":"^6.21.0","@vitest/coverage-istanbul":"^0.34.5","@vitest/coverage-v8":"^0.34.5",eslint:"^8.19.0","eslint-plugin-jsdoc":"^39.3.3","eslint-plugin-prettier":"^4.2.1","eslint-plugin-tsdoc":"^0.2.16",husky:"^8.0.3",prettier:"^2.7.1","ts-node":"^10.9.1",typedoc:"^0.25.13",typescript:"^5.3.3","typescript-transform-paths":"^3.3.1",vite:"^5.0.12","vite-plugin-commonjs":"^0.10.1","vite-plugin-dts":"^3.9.1","vite-tsconfig-paths":"^4.2.1",vitest:"^0.34.5"},sp={"@bufbuild/protobuf":"^1.6.0","@connectrpc/connect":"^1.4.0","@connectrpc/connect-web":"^1.4.0",long:"^5.2.0"},ip={hooks:{"pre-commit":"pnpm lint"}},za={name:jm,version:Km,description:Vm,main:Wm,publishConfig:Hm,files:Gm,scripts:Ym,engines:Xm,repository:Zm,author:Qm,license:ep,bugs:tp,homepage:np,devDependencies:rp,dependencies:sp,husky:ip};function op(){return n=>async e=>(e.header.set("x-yorkie-user-agent",za.name+"/"+za.version),await n(e))}var hs=(n=>(n.Manual="manual",n.Realtime="realtime",n.RealtimePushOnly="realtime-pushonly",n.RealtimeSyncOff="realtime-syncoff",n))(hs||{});const es={syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3};class ou{constructor(e,t){h(this,"id");h(this,"key");h(this,"status");h(this,"attachmentMap");h(this,"apiKey");h(this,"conditions");h(this,"syncLoopDuration");h(this,"reconnectStreamDelay");h(this,"retrySyncLoopDelay");h(this,"rpcClient");h(this,"taskQueue");h(this,"processing",!1);t=t||es,this.key=t.key?t.key:nu(),this.status="deactivated",this.attachmentMap=new Map,this.apiKey=t.apiKey||"",this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=t.syncLoopDuration||es.syncLoopDuration,this.reconnectStreamDelay=t.reconnectStreamDelay||es.reconnectStreamDelay,this.retrySyncLoopDelay=t.retrySyncLoopDelay||es.retrySyncLoopDelay,this.rpcClient=Bd(Ng,ig({baseUrl:e,interceptors:[zm(t.apiKey,t.token),op()]})),this.taskQueue=[]}activate(){return this.isActive()?Promise.resolve():this.enqueueTask(async()=>this.rpcClient.activateClient({clientKey:this.key},{headers:{"x-shard-key":this.apiKey}}).then(e=>{this.id=e.clientId,this.status="activated",this.runSyncLoop(),q.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`)}).catch(e=>{throw q.error(`[AC] c:"${this.getKey()}" err :`,e),this.handleConnectError(e),e}))}deactivate(){return this.status==="deactivated"?Promise.resolve():this.enqueueTask(async()=>this.rpcClient.deactivateClient({clientId:this.id},{headers:{"x-shard-key":this.apiKey}}).then(()=>{this.deactivateInternal(),q.info(`[DC] c"${this.getKey()}" deactivated`)}).catch(e=>{throw q.error(`[DC] c:"${this.getKey()}" err :`,e),this.handleConnectError(e),e}))}attach(e,t={}){if(!this.isActive())throw new T(y.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==Zt.Detached)throw new T(y.ErrDocumentNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id),e.update((s,i)=>i.set(t.initialPresence||{}));const r=t.syncMode??"realtime";return this.enqueueTask(async()=>this.rpcClient.attachDocument({clientId:this.id,changePack:Te.toChangePack(e.createChangePack())},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(async s=>{const i=Te.fromChangePack(s.changePack);return e.applyChangePack(i),e.getStatus()===Zt.Removed||(e.applyStatus(Zt.Attached),this.attachmentMap.set(e.getKey(),new Dm(this.reconnectStreamDelay,e,s.documentId,r)),r!=="manual"&&await this.runWatchLoop(e.getKey()),q.info(`[AD] c:"${this.getKey()}" attaches d:"${e.getKey()}"`)),e}).catch(s=>{throw q.error(`[AD] c:"${this.getKey()}" err :`,s),this.handleConnectError(s),s}))}detach(e,t={}){if(!this.isActive())throw new T(y.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new T(y.ErrDocumentNotAttached,`${e.getKey()} is not attached`);return e.update((s,i)=>i.clear()),this.enqueueTask(async()=>this.rpcClient.detachDocument({clientId:this.id,documentId:r.docID,changePack:Te.toChangePack(e.createChangePack()),removeIfNotAttached:t.removeIfNotAttached??!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(s=>{const i=Te.fromChangePack(s.changePack);return e.applyChangePack(i),e.getStatus()!==Zt.Removed&&e.applyStatus(Zt.Detached),this.detachInternal(e.getKey()),q.info(`[DD] c:"${this.getKey()}" detaches d:"${e.getKey()}"`),e}).catch(s=>{throw q.error(`[DD] c:"${this.getKey()}" err :`,s),this.handleConnectError(s),s}))}async changeSyncMode(e,t){if(!this.isActive())throw new T(y.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new T(y.ErrDocumentNotAttached,`${e.getKey()} is not attached`);const s=r.syncMode;return s===t?e:(r.changeSyncMode(t),t==="manual"?(r.cancelWatchStream(),e):(t==="realtime"&&(r.remoteChangeEventReceived=!0),s==="manual"&&await this.runWatchLoop(e.getKey()),e))}sync(e){if(!this.isActive())throw new T(y.ErrClientNotActivated,`${this.key} is not active`);if(e){const t=this.attachmentMap.get(e.getKey());if(!t)throw new T(y.ErrDocumentNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(r=>{throw q.error(`[SY] c:"${this.getKey()}" err :`,r),this.handleConnectError(r),r}))}return this.enqueueTask(async()=>{const t=[];for(const[,r]of this.attachmentMap)t.push(this.syncInternal(r,r.syncMode));return Promise.all(t).catch(r=>{throw q.error(`[SY] c:"${this.getKey()}" err :`,r),this.handleConnectError(r),r})})}remove(e){if(!this.isActive())throw new T(y.ErrClientNotActivated,`${this.key} is not active`);const t=this.attachmentMap.get(e.getKey());if(!t)throw new T(y.ErrDocumentNotAttached,`${e.getKey()} is not attached`);e.setActor(this.id);const r=Te.toChangePack(e.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>this.rpcClient.removeDocument({clientId:this.id,documentId:t.docID,changePack:r},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}).then(s=>{const i=Te.fromChangePack(s.changePack);e.applyChangePack(i),this.detachInternal(e.getKey()),q.info(`[RD] c:"${this.getKey()}" removes d:"${e.getKey()}"`)}).catch(s=>{throw q.error(`[RD] c:"${this.getKey()}" err :`,s),this.handleConnectError(s),s}))}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(e){return this.conditions[e]}runSyncLoop(){const e=()=>{if(!this.isActive()){q.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}const t=[];for(const[,r]of this.attachmentMap)r.needRealtimeSync()&&(r.remoteChangeEventReceived=!1,t.push(this.syncInternal(r,r.syncMode)));Promise.all(t).then(()=>setTimeout(e,this.syncLoopDuration)).catch(r=>{q.error(`[SL] c:"${this.getKey()}" sync failed:`,r),this.handleConnectError(r)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1})};q.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){const t=this.attachmentMap.get(e);if(!t)throw new T(y.ErrDocumentNotAttached,`${e} is not attached`);return this.conditions.WatchLoop=!0,t.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new T(y.ErrClientNotActivated,`${this.key} is not active`));const s=new AbortController,i=this.rpcClient.watchDocument({clientId:this.id,documentId:t.docID},{headers:{"x-shard-key":`${this.apiKey}/${e}`},signal:s.signal});return t.doc.publish([{type:Me.ConnectionChanged,value:Ei.Connected}]),q.info(`[WD] c:"${this.getKey()}" watches d:"${e}"`),new Promise((o,a)=>{(async()=>{try{for await(const l of i)this.handleWatchDocumentsResponse(t,l),l.body.case==="initialization"&&o([i,s])}catch(l){t.doc.resetOnlineClients(),t.doc.publish([{type:Me.Initialized,source:re.Local,value:t.doc.getPresences()}]),t.doc.publish([{type:Me.ConnectionChanged,value:Ei.Disconnected}]),q.debug(`[WD] c:"${this.getKey()}" unwatches`),this.handleConnectError(l)?r():this.conditions.WatchLoop=!1,a(l)}})()})})}handleWatchDocumentsResponse(e,t){if(t.body.case==="event"&&t.body.value.type===ws.DOCUMENT_CHANGED){e.remoteChangeEventReceived=!0;return}e.doc.applyWatchStream(t)}deactivateInternal(){this.status="deactivated";for(const[e,t]of this.attachmentMap)this.detachInternal(e),t.doc.applyStatus(Zt.Detached)}detachInternal(e){const t=this.attachmentMap.get(e);t&&(t.cancelWatchStream(),this.attachmentMap.delete(e))}syncInternal(e,t){const{doc:r,docID:s}=e,i=r.createChangePack();return this.rpcClient.pushPullChanges({clientId:this.id,documentId:s,changePack:Te.toChangePack(i),pushOnly:t==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${r.getKey()}`}}).then(o=>{const a=Te.fromChangePack(o.changePack);if(a.hasChanges()&&(e.syncMode==="realtime-pushonly"||e.syncMode==="realtime-syncoff"))return r;r.applyChangePack(a),e.doc.publish([{type:Me.SyncStatusChanged,value:xi.Synced}]),r.getStatus()===Zt.Removed&&this.detachInternal(r.getKey());const c=r.getKey(),l=a.getChangeSize();return q.info(`[PP] c:"${this.getKey()}" sync d:"${c}", push:${i.getChangeSize()} pull:${l} cp:${a.getCheckpoint().toTestString()}`),r}).catch(o=>{throw r.publish([{type:Me.SyncStatusChanged,value:xi.SyncFailed}]),q.error(`[PP] c:"${this.getKey()}" err :`,o),o})}handleConnectError(e){return e instanceof pe?e.code===ee.Canceled||e.code===ee.Unknown||e.code===ee.ResourceExhausted||e.code===ee.Unavailable?!0:((La(e)===y.ErrClientNotActivated||La(e)===y.ErrClientNotFound)&&this.deactivateInternal(),!1):!1}enqueueTask(e){return new Promise((t,r)=>{this.taskQueue.push(()=>e().then(t).catch(r)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{q.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}const au={Client:ou,Document:iu,Primitive:ce,Text:Js,Counter:qs,Tree:zs,LogLevel:De,setLogLevel:tu,IntType:Pt.IntegerCnt,LongType:Pt.LongCnt};typeof globalThis<"u"&&(globalThis.yorkie={Client:ou,Document:iu,Primitive:ce,Text:Js,Counter:qs,Tree:zs,LogLevel:De,setLogLevel:tu,IntType:Pt.IntegerCnt,LongType:Pt.LongCnt});const ap=(n,e)=>{const t=n.__vccOpts||n;for(const[r,s]of e)t[r]=s;return t},cp=[{title:"Todo",cards:[{title:"Pruning document"},{title:"Clean up codes"}]},{title:"Doing",cards:[{title:"Array operations"}]},{title:"Done",cards:[{title:"Create a sample page"},{title:"Launch demo site"}]}],Yt=new au.Client("https://api.yorkie.dev",{apiKey:"cedaovjuioqlk4pjqn6g"}),Ft=new au.Document(`vuejs-kanban-${new Date().toISOString().substring(0,10).replace(/-/g,"")}`,{enableDevtools:!0}),lp={data(){return{lists:[],title:"",opened:null}},created(){this.fetchDoc()},beforeUnmount(){this.disconnect()},watch:{opened(n){this.$nextTick(function(){n===0?this.$refs.addListForm.querySelector("input").focus():n&&this.$refs.addCardForm[n-1].querySelector("input").focus(),this.title=""})}},methods:{async fetchDoc(){await Yt.activate(),await Yt.attach(Ft),Ft.update(n=>{n.lists||(n.lists=cp)},"create default list if not exists"),Ft.subscribe(n=>{this.lists=Ft.getRoot().lists}),await Yt.sync(),this.lists=Ft.getRoot().lists},async disconnect(){await Yt.deactivate()},isOpened(n){return this.opened===n},openForm(n){this.opened=n},closeForm(){this.opened=null},addCard(n){this.title!==""&&Ft.update(e=>{e.lists.getElementByID(n.getID()).cards.push({title:this.title}),this.title=""},`add new card by ${Yt.getID()}`)},deleteCard(n,e){Ft.update(t=>{t.lists.getElementByID(n.getID()).cards.deleteByID(e.getID())},`delete a card by ${Yt.getID()}`)},addList(){this.title!==""&&Ft.update(n=>{n.lists.push({title:this.title,cards:[]}),this.title=""},`add new list by ${Yt.getID()}`)},deleteList(n){Ft.update(e=>{e.lists.deleteByID(n.getID())},`delete a list by ${Yt.getID()}`)}}},up={class:"list"},fp=["onClick"],hp={class:"title"},dp={class:"card"},gp=["onClick"],mp={key:0,class:"add-form"},pp=["onKeyup"],yp={class:"buttons"},vp=["onClick"],Tp=["onClick"],wp={class:"add-list",ref:"addListForm"},bp={key:0,class:"add-form"},Ap={class:"buttons"};function Ip(n,e,t,r,s,i){return Rt(),_t(We,null,[(Rt(!0),_t(We,null,Fo(s.lists,(o,a)=>(Rt(),_t("div",up,[Oe("span",{class:"delete",onClick:c=>i.deleteList(o)},"",8,fp),Oe("div",hp,So(o.title),1),(Rt(!0),_t(We,null,Fo(o.cards,c=>(Rt(),_t("div",dp,[Oe("span",{class:"delete",onClick:l=>i.deleteCard(o,c)},"",8,gp),Pc(" "+So(c.title),1)]))),256)),Oe("div",{class:"add-card",ref_for:!0,ref:"addCardForm"},[i.isOpened(a+1)?(Rt(),_t("div",mp,[_o(Oe("input",{type:"text",placeholder:"Enter card title","onUpdate:modelValue":e[0]||(e[0]=c=>s.title=c),onKeyup:[Hr(c=>i.addCard(o),["enter"]),e[1]||(e[1]=Hr(c=>i.closeForm(),["esc"]))]},null,40,pp),[[na,s.title]]),Oe("div",yp,[Oe("input",{type:"button",value:"Add",onClick:c=>i.addCard(o)},null,8,vp),Oe("input",{type:"button",value:"Close",class:"pull-right",onClick:e[2]||(e[2]=c=>i.closeForm())})])])):(Rt(),_t("div",{key:1,class:"add-card-opener",onClick:c=>i.openForm(a+1)}," Add another card ",8,Tp))],512)]))),256)),Oe("div",wp,[i.isOpened(0)?(Rt(),_t("div",bp,[_o(Oe("input",{type:"text",placeholder:"Enter list title","onUpdate:modelValue":e[3]||(e[3]=o=>s.title=o),onKeyup:[e[4]||(e[4]=Hr(o=>i.addList(),["enter"])),e[5]||(e[5]=Hr(o=>i.closeForm(),["esc"]))]},null,544),[[na,s.title]]),Oe("div",Ap,[Oe("input",{type:"button",value:"Add",onClick:e[6]||(e[6]=o=>i.addList())}),Oe("input",{type:"button",value:"Close",class:"pull-right",onClick:e[7]||(e[7]=o=>i.closeForm())})])])):(Rt(),_t("div",{key:1,class:"add-list-opener",onClick:e[8]||(e[8]=o=>i.openForm(0))}," Add another list "))],512)],64)}const Sp=ap(lp,[["render",Ip]]);Bh(Sp).mount("#app");
