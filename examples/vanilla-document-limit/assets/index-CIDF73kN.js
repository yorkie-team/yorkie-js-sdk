var ua=Object.defineProperty;var la=(n,t,e)=>t in n?ua(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>la(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();var R;(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(R||(R={}));function ai(n){const t=R[n];return typeof t!="string"?n.toString():t[0].toLowerCase()+t.substring(1).replace(/[A-Z]/g,e=>"_"+e.toLowerCase())}class M extends Error{constructor(t,e=R.Unknown,r,s,i){super(ha(t,e)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=t,this.code=e,this.metadata=new Headers(r??{}),this.details=s??[],this.cause=i}static from(t,e=R.Unknown){return t instanceof M?t:t instanceof Error?t.name=="AbortError"?new M(t.message,R.Canceled):new M(t.message,e,void 0,void 0,t):new M(String(t),e,void 0,void 0,t)}static[Symbol.hasInstance](t){return t instanceof Error?Object.getPrototypeOf(t)===M.prototype?!0:t.name==="ConnectError"&&"code"in t&&typeof t.code=="number"&&"metadata"in t&&"details"in t&&Array.isArray(t.details)&&"rawMessage"in t&&typeof t.rawMessage=="string"&&"cause"in t:!1}findDetails(t){const e="typeName"in t?{findMessage:s=>s===t.typeName?t:void 0}:t,r=[];for(const s of this.details){if("getType"in s){e.findMessage(s.getType().typeName)&&r.push(s);continue}const i=e.findMessage(s.type);if(i)try{r.push(i.fromBinary(s.value))}catch{}}return r}}function ha(n,t){return n.length?`[${ai(t)}] ${n}`:`[${ai(t)}]`}function q(n,t){if(!n)throw new Error(t)}const fa=34028234663852886e22,da=-34028234663852886e22,ga=4294967295,ma=2147483647,pa=-2147483648;function vn(n){if(typeof n!="number")throw new Error("invalid int 32: "+typeof n);if(!Number.isInteger(n)||n>ma||n<pa)throw new Error("invalid int 32: "+n)}function ls(n){if(typeof n!="number")throw new Error("invalid uint 32: "+typeof n);if(!Number.isInteger(n)||n>ga||n<0)throw new Error("invalid uint 32: "+n)}function eo(n){if(typeof n!="number")throw new Error("invalid float 32: "+typeof n);if(Number.isFinite(n)&&(n>fa||n<da))throw new Error("invalid float 32: "+n)}const to=Symbol("@bufbuild/protobuf/enum-type");function ya(n){const t=n[to];return q(t,"missing enum type on enum object"),t}function ro(n,t,e,r){n[to]=no(t,e.map(s=>({no:s.no,name:s.name,localName:n[s.no]})))}function no(n,t,e){const r=Object.create(null),s=Object.create(null),i=[];for(const o of t){const c=so(o);i.push(c),r[o.name]=c,s[o.no]=c}return{typeName:n,values:i,findName(o){return r[o]},findNumber(o){return s[o]}}}function va(n,t,e){const r={};for(const s of t){const i=so(s);r[i.localName]=i.no,r[i.no]=i.localName}return ro(r,n,t),r}function so(n){return"localName"in n?n:Object.assign(Object.assign({},n),{localName:n.name})}class A{equals(t){return this.getType().runtime.util.equals(this.getType(),this,t)}clone(){return this.getType().runtime.util.clone(this)}fromBinary(t,e){const r=this.getType(),s=r.runtime.bin,i=s.makeReadOptions(e);return s.readMessage(this,i.readerFactory(t),t.byteLength,i),this}fromJson(t,e){const r=this.getType(),s=r.runtime.json,i=s.makeReadOptions(e);return s.readMessage(r,t,i,this),this}fromJsonString(t,e){let r;try{r=JSON.parse(t)}catch(s){throw new Error(`cannot decode ${this.getType().typeName} from JSON: ${s instanceof Error?s.message:String(s)}`)}return this.fromJson(r,e)}toBinary(t){const e=this.getType(),r=e.runtime.bin,s=r.makeWriteOptions(t),i=s.writerFactory();return r.writeMessage(this,i,s),i.finish()}toJson(t){const e=this.getType(),r=e.runtime.json,s=r.makeWriteOptions(t);return r.writeMessage(this,s)}toJsonString(t){var e;const r=this.toJson(t);return JSON.stringify(r,null,(e=t==null?void 0:t.prettySpaces)!==null&&e!==void 0?e:0)}toJSON(){return this.toJson({emitDefaultValues:!0})}getType(){return Object.getPrototypeOf(this).constructor}}function wa(n,t,e,r){var s;const i=(s=r==null?void 0:r.localName)!==null&&s!==void 0?s:t.substring(t.lastIndexOf(".")+1),o={[i]:function(c){n.util.initFields(this),n.util.initPartial(c,this)}}[i];return Object.setPrototypeOf(o.prototype,new A),Object.assign(o,{runtime:n,typeName:t,fields:n.util.newFieldList(e),fromBinary(c,l){return new o().fromBinary(c,l)},fromJson(c,l){return new o().fromJson(c,l)},fromJsonString(c,l){return new o().fromJsonString(c,l)},equals(c,l){return n.util.equals(o,c,l)}}),o}function Ta(){let n=0,t=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,t]}let e=this.buf[this.pos++];if(n|=(e&15)<<28,t=(e&112)>>4,(e&128)==0)return this.assertBounds(),[n,t];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(t|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,t]}throw new Error("invalid varint")}function ts(n,t,e){for(let i=0;i<28;i=i+7){const o=n>>>i,c=!(!(o>>>7)&&t==0),l=(c?o|128:o)&255;if(e.push(l),!c)return}const r=n>>>28&15|(t&7)<<4,s=t>>3!=0;if(e.push((s?r|128:r)&255),!!s){for(let i=3;i<31;i=i+7){const o=t>>>i,c=!!(o>>>7),l=(c?o|128:o)&255;if(e.push(l),!c)return}e.push(t>>>31&1)}}const wn=4294967296;function ci(n){const t=n[0]==="-";t&&(n=n.slice(1));const e=1e6;let r=0,s=0;function i(o,c){const l=Number(n.slice(o,c));s*=e,r=r*e+l,r>=wn&&(s=s+(r/wn|0),r=r%wn)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),t?oo(r,s):Ms(r,s)}function Aa(n,t){let e=Ms(n,t);const r=e.hi&2147483648;r&&(e=oo(e.lo,e.hi));const s=io(e.lo,e.hi);return r?"-"+s:s}function io(n,t){if({lo:n,hi:t}=ba(n,t),t<=2097151)return String(wn*t+n);const e=n&16777215,r=(n>>>24|t<<8)&16777215,s=t>>16&65535;let i=e+r*6777216+s*6710656,o=r+s*8147497,c=s*2;const l=1e7;return i>=l&&(o+=Math.floor(i/l),i%=l),o>=l&&(c+=Math.floor(o/l),o%=l),c.toString()+ui(o)+ui(i)}function ba(n,t){return{lo:n>>>0,hi:t>>>0}}function Ms(n,t){return{lo:n|0,hi:t|0}}function oo(n,t){return t=~t,n?n=~n+1:t+=1,Ms(n,t)}const ui=n=>{const t=String(n);return"0000000".slice(t.length)+t};function li(n,t){if(n>=0){for(;n>127;)t.push(n&127|128),n=n>>>7;t.push(n)}else{for(let e=0;e<9;e++)t.push(n&127|128),n=n>>7;t.push(1)}}function Ia(){let n=this.buf[this.pos++],t=n&127;if((n&128)==0)return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<7,(n&128)==0)return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<14,(n&128)==0)return this.assertBounds(),t;if(n=this.buf[this.pos++],t|=(n&127)<<21,(n&128)==0)return this.assertBounds(),t;n=this.buf[this.pos++],t|=(n&15)<<28;for(let e=5;(n&128)!==0&&e<10;e++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),t>>>0}var hi={};function Sa(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(typeof process!="object"||typeof hi!="object"||hi.BUF_BIGINT_DISABLE!=="1")){const s=BigInt("-9223372036854775808"),i=BigInt("9223372036854775807"),o=BigInt("0"),c=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(l){const h=typeof l=="bigint"?l:BigInt(l);if(h>i||h<s)throw new Error(`int64 invalid: ${l}`);return h},uParse(l){const h=typeof l=="bigint"?l:BigInt(l);if(h>c||h<o)throw new Error(`uint64 invalid: ${l}`);return h},enc(l){return n.setBigInt64(0,this.parse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(l){return n.setBigInt64(0,this.uParse(l),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(l,h){return n.setInt32(0,l,!0),n.setInt32(4,h,!0),n.getBigInt64(0,!0)},uDec(l,h){return n.setInt32(0,l,!0),n.setInt32(4,h,!0),n.getBigUint64(0,!0)}}}const e=s=>q(/^-?[0-9]+$/.test(s),`int64 invalid: ${s}`),r=s=>q(/^[0-9]+$/.test(s),`uint64 invalid: ${s}`);return{zero:"0",supported:!1,parse(s){return typeof s!="string"&&(s=s.toString()),e(s),s},uParse(s){return typeof s!="string"&&(s=s.toString()),r(s),s},enc(s){return typeof s!="string"&&(s=s.toString()),e(s),ci(s)},uEnc(s){return typeof s!="string"&&(s=s.toString()),r(s),ci(s)},dec(s,i){return Aa(s,i)},uDec(s,i){return io(s,i)}}}const $=Sa();var y;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(y||(y={}));var lr;(function(n){n[n.BIGINT=0]="BIGINT",n[n.STRING=1]="STRING"})(lr||(lr={}));function rr(n,t,e){if(t===e)return!0;if(n==y.BYTES){if(!(t instanceof Uint8Array)||!(e instanceof Uint8Array)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}switch(n){case y.UINT64:case y.FIXED64:case y.INT64:case y.SFIXED64:case y.SINT64:return t==e}return!1}function Br(n,t){switch(n){case y.BOOL:return!1;case y.UINT64:case y.FIXED64:case y.INT64:case y.SFIXED64:case y.SINT64:return t==0?$.zero:"0";case y.DOUBLE:case y.FLOAT:return 0;case y.BYTES:return new Uint8Array(0);case y.STRING:return"";default:return 0}}function ao(n,t){switch(n){case y.BOOL:return t===!1;case y.STRING:return t==="";case y.BYTES:return t instanceof Uint8Array&&!t.byteLength;default:return t==0}}var G;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(G||(G={}));class ka{constructor(t){this.stack=[],this.textEncoder=t??new TextEncoder,this.chunks=[],this.buf=[]}finish(){this.chunks.push(new Uint8Array(this.buf));let t=0;for(let s=0;s<this.chunks.length;s++)t+=this.chunks[s].length;let e=new Uint8Array(t),r=0;for(let s=0;s<this.chunks.length;s++)e.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],e}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let t=this.finish(),e=this.stack.pop();if(!e)throw new Error("invalid state, fork stack empty");return this.chunks=e.chunks,this.buf=e.buf,this.uint32(t.byteLength),this.raw(t)}tag(t,e){return this.uint32((t<<3|e)>>>0)}raw(t){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(t),this}uint32(t){for(ls(t);t>127;)this.buf.push(t&127|128),t=t>>>7;return this.buf.push(t),this}int32(t){return vn(t),li(t,this.buf),this}bool(t){return this.buf.push(t?1:0),this}bytes(t){return this.uint32(t.byteLength),this.raw(t)}string(t){let e=this.textEncoder.encode(t);return this.uint32(e.byteLength),this.raw(e)}float(t){eo(t);let e=new Uint8Array(4);return new DataView(e.buffer).setFloat32(0,t,!0),this.raw(e)}double(t){let e=new Uint8Array(8);return new DataView(e.buffer).setFloat64(0,t,!0),this.raw(e)}fixed32(t){ls(t);let e=new Uint8Array(4);return new DataView(e.buffer).setUint32(0,t,!0),this.raw(e)}sfixed32(t){vn(t);let e=new Uint8Array(4);return new DataView(e.buffer).setInt32(0,t,!0),this.raw(e)}sint32(t){return vn(t),t=(t<<1^t>>31)>>>0,li(t,this.buf),this}sfixed64(t){let e=new Uint8Array(8),r=new DataView(e.buffer),s=$.enc(t);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(e)}fixed64(t){let e=new Uint8Array(8),r=new DataView(e.buffer),s=$.uEnc(t);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(e)}int64(t){let e=$.enc(t);return ts(e.lo,e.hi,this.buf),this}sint64(t){let e=$.enc(t),r=e.hi>>31,s=e.lo<<1^r,i=(e.hi<<1|e.lo>>>31)^r;return ts(s,i,this.buf),this}uint64(t){let e=$.uEnc(t);return ts(e.lo,e.hi,this.buf),this}}class Ea{constructor(t,e){this.varint64=Ta,this.uint32=Ia,this.buf=t,this.len=t.length,this.pos=0,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.textDecoder=e??new TextDecoder}tag(){let t=this.uint32(),e=t>>>3,r=t&7;if(e<=0||r<0||r>5)throw new Error("illegal tag: field no "+e+" wire type "+r);return[e,r]}skip(t,e){let r=this.pos;switch(t){case G.Varint:for(;this.buf[this.pos++]&128;);break;case G.Bit64:this.pos+=4;case G.Bit32:this.pos+=4;break;case G.LengthDelimited:let s=this.uint32();this.pos+=s;break;case G.StartGroup:for(;;){const[i,o]=this.tag();if(o===G.EndGroup){if(e!==void 0&&i!==e)throw new Error("invalid end group tag");break}this.skip(o,i)}break;default:throw new Error("cant skip wire type "+t)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let t=this.uint32();return t>>>1^-(t&1)}int64(){return $.dec(...this.varint64())}uint64(){return $.uDec(...this.varint64())}sint64(){let[t,e]=this.varint64(),r=-(t&1);return t=(t>>>1|(e&1)<<31)^r,e=e>>>1^r,$.dec(t,e)}bool(){let[t,e]=this.varint64();return t!==0||e!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return $.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return $.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let t=this.uint32(),e=this.pos;return this.pos+=t,this.assertBounds(),this.buf.subarray(e,e+t)}string(){return this.textDecoder.decode(this.bytes())}}function xa(n,t,e,r){let s;return{typeName:t,extendee:e,get field(){if(!s){const i=typeof r=="function"?r():r;i.name=t.split(".").pop(),i.jsonName=`[${t}]`,s=n.util.newFieldList([i]).list()[0]}return s},runtime:n}}function co(n){const t=n.field.localName,e=Object.create(null);return e[t]=Na(n),[e,()=>e[t]]}function Na(n){const t=n.field;if(t.repeated)return[];if(t.default!==void 0)return t.default;switch(t.kind){case"enum":return t.T.values[0].no;case"scalar":return Br(t.T,t.L);case"message":const e=t.T,r=new e;return e.fieldWrapper?e.fieldWrapper.unwrapField(r):r;case"map":throw"map fields are not allowed to be extensions"}}function Ca(n,t){if(!t.repeated&&(t.kind=="enum"||t.kind=="scalar")){for(let e=n.length-1;e>=0;--e)if(n[e].no==t.no)return[n[e]];return[]}return n.filter(e=>e.no===t.no)}let Wt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),Yn=[];for(let n=0;n<Wt.length;n++)Yn[Wt[n].charCodeAt(0)]=n;Yn[45]=Wt.indexOf("+");Yn[95]=Wt.indexOf("/");const $s={dec(n){let t=n.length*3/4;n[n.length-2]=="="?t-=2:n[n.length-1]=="="&&(t-=1);let e=new Uint8Array(t),r=0,s=0,i,o=0;for(let c=0;c<n.length;c++){if(i=Yn[n.charCodeAt(c)],i===void 0)switch(n[c]){case"=":s=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string.")}switch(s){case 0:o=i,s=1;break;case 1:e[r++]=o<<2|(i&48)>>4,o=i,s=2;break;case 2:e[r++]=(o&15)<<4|(i&60)>>2,o=i,s=3;break;case 3:e[r++]=(o&3)<<6|i,s=0;break}}if(s==1)throw Error("invalid base64 string.");return e.subarray(0,r)},enc(n){let t="",e=0,r,s=0;for(let i=0;i<n.length;i++)switch(r=n[i],e){case 0:t+=Wt[r>>2],s=(r&3)<<4,e=1;break;case 1:t+=Wt[s|r>>4],s=(r&15)<<2,e=2;break;case 2:t+=Wt[s|r>>6],t+=Wt[r&63],e=0;break}return e&&(t+=Wt[s],t+="=",e==1&&(t+="=")),t}};function Pa(n,t,e){lo(t,n);const r=t.runtime.bin.makeReadOptions(e),s=Ca(n.getType().runtime.bin.listUnknownFields(n),t.field),[i,o]=co(t);for(const c of s)t.runtime.bin.readField(i,r.readerFactory(c.data),t.field,c.wireType,r);return o()}function Da(n,t,e,r){lo(t,n);const s=t.runtime.bin.makeReadOptions(r),i=t.runtime.bin.makeWriteOptions(r);if(uo(n,t)){const h=n.getType().runtime.bin.listUnknownFields(n).filter(f=>f.no!=t.field.no);n.getType().runtime.bin.discardUnknownFields(n);for(const f of h)n.getType().runtime.bin.onUnknownField(n,f.no,f.wireType,f.data)}const o=i.writerFactory();let c=t.field;!c.opt&&!c.repeated&&(c.kind=="enum"||c.kind=="scalar")&&(c=Object.assign(Object.assign({},t.field),{opt:!0})),t.runtime.bin.writeField(c,e,o,i);const l=s.readerFactory(o.finish());for(;l.pos<l.len;){const[h,f]=l.tag(),g=l.skip(f,h);n.getType().runtime.bin.onUnknownField(n,h,f,g)}}function uo(n,t){const e=n.getType();return t.extendee.typeName===e.typeName&&!!e.runtime.bin.listUnknownFields(n).find(r=>r.no==t.field.no)}function lo(n,t){q(n.extendee.typeName==t.getType().typeName,`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}function ho(n,t){const e=n.localName;if(n.repeated)return t[e].length>0;if(n.oneof)return t[n.oneof.localName].case===e;switch(n.kind){case"enum":case"scalar":return n.opt||n.req?t[e]!==void 0:n.kind=="enum"?t[e]!==n.T.values[0].no:!ao(n.T,t[e]);case"message":return t[e]!==void 0;case"map":return Object.keys(t[e]).length>0}}function fi(n,t){const e=n.localName,r=!n.opt&&!n.req;if(n.repeated)t[e]=[];else if(n.oneof)t[n.oneof.localName]={case:void 0};else switch(n.kind){case"map":t[e]={};break;case"enum":t[e]=r?n.T.values[0].no:void 0;break;case"scalar":t[e]=r?Br(n.T,n.L):void 0;break;case"message":t[e]=void 0;break}}function vr(n,t){if(n===null||typeof n!="object"||!Object.getOwnPropertyNames(A.prototype).every(r=>r in n&&typeof n[r]=="function"))return!1;const e=n.getType();return e===null||typeof e!="function"||!("typeName"in e)||typeof e.typeName!="string"?!1:t===void 0?!0:e.typeName==t.typeName}function fo(n,t){return vr(t)||!n.fieldWrapper?t:n.fieldWrapper.wrapField(t)}y.DOUBLE,y.FLOAT,y.INT64,y.UINT64,y.INT32,y.UINT32,y.BOOL,y.STRING,y.BYTES;const di={ignoreUnknownFields:!1},gi={emitDefaultValues:!1,enumAsInteger:!1,useProtoFieldName:!1,prettySpaces:0};function Oa(n){return n?Object.assign(Object.assign({},di),n):di}function Ba(n){return n?Object.assign(Object.assign({},gi),n):gi}const kn=Symbol(),Tn=Symbol();function Ra(){return{makeReadOptions:Oa,makeWriteOptions:Ba,readMessage(n,t,e,r){if(t==null||Array.isArray(t)||typeof t!="object")throw new Error(`cannot decode message ${n.typeName} from JSON: ${Be(t)}`);r=r??new n;const s=new Map,i=e.typeRegistry;for(const[o,c]of Object.entries(t)){const l=n.fields.findJsonName(o);if(l){if(l.oneof){if(c===null&&l.kind=="scalar")continue;const h=s.get(l.oneof);if(h!==void 0)throw new Error(`cannot decode message ${n.typeName} from JSON: multiple keys for oneof "${l.oneof.name}" present: "${h}", "${o}"`);s.set(l.oneof,o)}mi(r,c,l,e,n)}else{let h=!1;if(i!=null&&i.findExtension&&o.startsWith("[")&&o.endsWith("]")){const f=i.findExtension(o.substring(1,o.length-1));if(f&&f.extendee.typeName==n.typeName){h=!0;const[g,v]=co(f);mi(g,c,f.field,e,f),Da(r,f,v(),e)}}if(!h&&!e.ignoreUnknownFields)throw new Error(`cannot decode message ${n.typeName} from JSON: key "${o}" is unknown`)}}return r},writeMessage(n,t){const e=n.getType(),r={};let s;try{for(s of e.fields.byNumber()){if(!ho(s,n)){if(s.req)throw"required field not set";if(!t.emitDefaultValues||!Ja(s))continue}const o=s.oneof?n[s.oneof.localName].value:n[s.localName],c=pi(s,o,t);c!==void 0&&(r[t.useProtoFieldName?s.name:s.jsonName]=c)}const i=t.typeRegistry;if(i!=null&&i.findExtensionFor)for(const o of e.runtime.bin.listUnknownFields(n)){const c=i.findExtensionFor(e.typeName,o.no);if(c&&uo(n,c)){const l=Pa(n,c,t),h=pi(c.field,l,t);h!==void 0&&(r[c.field.jsonName]=h)}}}catch(i){const o=s?`cannot encode field ${e.typeName}.${s.name} to JSON`:`cannot encode message ${e.typeName} to JSON`,c=i instanceof Error?i.message:String(i);throw new Error(o+(c.length>0?`: ${c}`:""))}return r},readScalar(n,t,e){return Kr(n,t,e??lr.BIGINT,!0)},writeScalar(n,t,e){if(t!==void 0&&(e||ao(n,t)))return An(n,t)},debug:Be}}function Be(n){if(n===null)return"null";switch(typeof n){case"object":return Array.isArray(n)?"array":"object";case"string":return n.length>100?"string":`"${n.split('"').join('\\"')}"`;default:return String(n)}}function mi(n,t,e,r,s){let i=e.localName;if(e.repeated){if(q(e.kind!="map"),t===null)return;if(!Array.isArray(t))throw new Error(`cannot decode field ${s.typeName}.${e.name} from JSON: ${Be(t)}`);const o=n[i];for(const c of t){if(c===null)throw new Error(`cannot decode field ${s.typeName}.${e.name} from JSON: ${Be(c)}`);switch(e.kind){case"message":o.push(e.T.fromJson(c,r));break;case"enum":const l=rs(e.T,c,r.ignoreUnknownFields,!0);l!==Tn&&o.push(l);break;case"scalar":try{o.push(Kr(e.T,c,e.L,!0))}catch(h){let f=`cannot decode field ${s.typeName}.${e.name} from JSON: ${Be(c)}`;throw h instanceof Error&&h.message.length>0&&(f+=`: ${h.message}`),new Error(f)}break}}}else if(e.kind=="map"){if(t===null)return;if(typeof t!="object"||Array.isArray(t))throw new Error(`cannot decode field ${s.typeName}.${e.name} from JSON: ${Be(t)}`);const o=n[i];for(const[c,l]of Object.entries(t)){if(l===null)throw new Error(`cannot decode field ${s.typeName}.${e.name} from JSON: map value null`);let h;try{h=La(e.K,c)}catch(f){let g=`cannot decode map key for field ${s.typeName}.${e.name} from JSON: ${Be(t)}`;throw f instanceof Error&&f.message.length>0&&(g+=`: ${f.message}`),new Error(g)}switch(e.V.kind){case"message":o[h]=e.V.T.fromJson(l,r);break;case"enum":const f=rs(e.V.T,l,r.ignoreUnknownFields,!0);f!==Tn&&(o[h]=f);break;case"scalar":try{o[h]=Kr(e.V.T,l,lr.BIGINT,!0)}catch(g){let v=`cannot decode map value for field ${s.typeName}.${e.name} from JSON: ${Be(t)}`;throw g instanceof Error&&g.message.length>0&&(v+=`: ${g.message}`),new Error(v)}break}}}else switch(e.oneof&&(n=n[e.oneof.localName]={case:i},i="value"),e.kind){case"message":const o=e.T;if(t===null&&o.typeName!="google.protobuf.Value")return;let c=n[i];vr(c)?c.fromJson(t,r):(n[i]=c=o.fromJson(t,r),o.fieldWrapper&&!e.oneof&&(n[i]=o.fieldWrapper.unwrapField(c)));break;case"enum":const l=rs(e.T,t,r.ignoreUnknownFields,!1);switch(l){case kn:fi(e,n);break;case Tn:break;default:n[i]=l;break}break;case"scalar":try{const h=Kr(e.T,t,e.L,!1);switch(h){case kn:fi(e,n);break;default:n[i]=h;break}}catch(h){let f=`cannot decode field ${s.typeName}.${e.name} from JSON: ${Be(t)}`;throw h instanceof Error&&h.message.length>0&&(f+=`: ${h.message}`),new Error(f)}break}}function La(n,t){if(n===y.BOOL)switch(t){case"true":t=!0;break;case"false":t=!1;break}return Kr(n,t,lr.BIGINT,!0).toString()}function Kr(n,t,e,r){if(t===null)return r?Br(n,e):kn;switch(n){case y.DOUBLE:case y.FLOAT:if(t==="NaN")return Number.NaN;if(t==="Infinity")return Number.POSITIVE_INFINITY;if(t==="-Infinity")return Number.NEGATIVE_INFINITY;if(t===""||typeof t=="string"&&t.trim().length!==t.length||typeof t!="string"&&typeof t!="number")break;const s=Number(t);if(Number.isNaN(s)||!Number.isFinite(s))break;return n==y.FLOAT&&eo(s),s;case y.INT32:case y.FIXED32:case y.SFIXED32:case y.SINT32:case y.UINT32:let i;if(typeof t=="number"?i=t:typeof t=="string"&&t.length>0&&t.trim().length===t.length&&(i=Number(t)),i===void 0)break;return n==y.UINT32||n==y.FIXED32?ls(i):vn(i),i;case y.INT64:case y.SFIXED64:case y.SINT64:if(typeof t!="number"&&typeof t!="string")break;const o=$.parse(t);return e?o.toString():o;case y.FIXED64:case y.UINT64:if(typeof t!="number"&&typeof t!="string")break;const c=$.uParse(t);return e?c.toString():c;case y.BOOL:if(typeof t!="boolean")break;return t;case y.STRING:if(typeof t!="string")break;try{encodeURIComponent(t)}catch{throw new Error("invalid UTF8")}return t;case y.BYTES:if(t==="")return new Uint8Array(0);if(typeof t!="string")break;return $s.dec(t)}throw new Error}function rs(n,t,e,r){if(t===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].no:kn;switch(typeof t){case"number":if(Number.isInteger(t))return t;break;case"string":const s=n.findName(t);if(s!==void 0)return s.no;if(e)return Tn;break}throw new Error(`cannot decode enum ${n.typeName} from JSON: ${Be(t)}`)}function Ja(n){return n.repeated||n.kind=="map"?!0:!(n.oneof||n.kind=="message"||n.opt||n.req)}function pi(n,t,e){if(n.kind=="map"){q(typeof t=="object"&&t!=null);const r={},s=Object.entries(t);switch(n.V.kind){case"scalar":for(const[o,c]of s)r[o.toString()]=An(n.V.T,c);break;case"message":for(const[o,c]of s)r[o.toString()]=c.toJson(e);break;case"enum":const i=n.V.T;for(const[o,c]of s)r[o.toString()]=ns(i,c,e.enumAsInteger);break}return e.emitDefaultValues||s.length>0?r:void 0}if(n.repeated){q(Array.isArray(t));const r=[];switch(n.kind){case"scalar":for(let s=0;s<t.length;s++)r.push(An(n.T,t[s]));break;case"enum":for(let s=0;s<t.length;s++)r.push(ns(n.T,t[s],e.enumAsInteger));break;case"message":for(let s=0;s<t.length;s++)r.push(t[s].toJson(e));break}return e.emitDefaultValues||r.length>0?r:void 0}switch(n.kind){case"scalar":return An(n.T,t);case"enum":return ns(n.T,t,e.enumAsInteger);case"message":return fo(n.T,t).toJson(e)}}function ns(n,t,e){var r;if(q(typeof t=="number"),n.typeName=="google.protobuf.NullValue")return null;if(e)return t;const s=n.findNumber(t);return(r=s==null?void 0:s.name)!==null&&r!==void 0?r:t}function An(n,t){switch(n){case y.INT32:case y.SFIXED32:case y.SINT32:case y.FIXED32:case y.UINT32:return q(typeof t=="number"),t;case y.FLOAT:case y.DOUBLE:return q(typeof t=="number"),Number.isNaN(t)?"NaN":t===Number.POSITIVE_INFINITY?"Infinity":t===Number.NEGATIVE_INFINITY?"-Infinity":t;case y.STRING:return q(typeof t=="string"),t;case y.BOOL:return q(typeof t=="boolean"),t;case y.UINT64:case y.FIXED64:case y.INT64:case y.SFIXED64:case y.SINT64:return q(typeof t=="bigint"||typeof t=="string"||typeof t=="number"),t.toString();case y.BYTES:return q(t instanceof Uint8Array),$s.enc(t)}}const kr=Symbol("@bufbuild/protobuf/unknown-fields"),yi={readUnknownFields:!0,readerFactory:n=>new Ea(n)},vi={writeUnknownFields:!0,writerFactory:()=>new ka};function Fa(n){return n?Object.assign(Object.assign({},yi),n):yi}function Ma(n){return n?Object.assign(Object.assign({},vi),n):vi}function $a(){return{makeReadOptions:Fa,makeWriteOptions:Ma,listUnknownFields(n){var t;return(t=n[kr])!==null&&t!==void 0?t:[]},discardUnknownFields(n){delete n[kr]},writeUnknownFields(n,t){const r=n[kr];if(r)for(const s of r)t.tag(s.no,s.wireType).raw(s.data)},onUnknownField(n,t,e,r){const s=n;Array.isArray(s[kr])||(s[kr]=[]),s[kr].push({no:t,wireType:e,data:r})},readMessage(n,t,e,r,s){const i=n.getType(),o=s?t.len:t.pos+e;let c,l;for(;t.pos<o&&([c,l]=t.tag(),!(s===!0&&l==G.EndGroup));){const h=i.fields.find(c);if(!h){const f=t.skip(l,c);r.readUnknownFields&&this.onUnknownField(n,c,l,f);continue}wi(n,t,h,l,r)}if(s&&(l!=G.EndGroup||c!==e))throw new Error("invalid end group tag")},readField:wi,writeMessage(n,t,e){const r=n.getType();for(const s of r.fields.byNumber()){if(!ho(s,n)){if(s.req)throw new Error(`cannot encode field ${r.typeName}.${s.name} to binary: required field not set`);continue}const i=s.oneof?n[s.oneof.localName].value:n[s.localName];Ti(s,i,t,e)}return e.writeUnknownFields&&this.writeUnknownFields(n,t),t},writeField(n,t,e,r){t!==void 0&&Ti(n,t,e,r)}}}function wi(n,t,e,r,s){let{repeated:i,localName:o}=e;switch(e.oneof&&(n=n[e.oneof.localName],n.case!=o&&delete n.value,n.case=o,o="value"),e.kind){case"scalar":case"enum":const c=e.kind=="enum"?y.INT32:e.T;let l=En;if(e.kind=="scalar"&&e.L>0&&(l=qa),i){let v=n[o];if(r==G.LengthDelimited&&c!=y.STRING&&c!=y.BYTES){let w=t.uint32()+t.pos;for(;t.pos<w;)v.push(l(t,c))}else v.push(l(t,c))}else n[o]=l(t,c);break;case"message":const h=e.T;i?n[o].push(bn(t,new h,s,e)):vr(n[o])?bn(t,n[o],s,e):(n[o]=bn(t,new h,s,e),h.fieldWrapper&&!e.oneof&&!e.repeated&&(n[o]=h.fieldWrapper.unwrapField(n[o])));break;case"map":let[f,g]=Ua(e,t,s);n[o][f]=g;break}}function bn(n,t,e,r){const s=t.getType().runtime.bin,i=r==null?void 0:r.delimited;return s.readMessage(t,n,i?r.no:n.uint32(),e,i),t}function Ua(n,t,e){const r=t.uint32(),s=t.pos+r;let i,o;for(;t.pos<s;){const[c]=t.tag();switch(c){case 1:i=En(t,n.K);break;case 2:switch(n.V.kind){case"scalar":o=En(t,n.V.T);break;case"enum":o=t.int32();break;case"message":o=bn(t,new n.V.T,e,void 0);break}break}}if(i===void 0&&(i=Br(n.K,lr.BIGINT)),typeof i!="string"&&typeof i!="number"&&(i=i.toString()),o===void 0)switch(n.V.kind){case"scalar":o=Br(n.V.T,lr.BIGINT);break;case"enum":o=n.V.T.values[0].no;break;case"message":o=new n.V.T;break}return[i,o]}function qa(n,t){const e=En(n,t);return typeof e=="bigint"?e.toString():e}function En(n,t){switch(t){case y.STRING:return n.string();case y.BOOL:return n.bool();case y.DOUBLE:return n.double();case y.FLOAT:return n.float();case y.INT32:return n.int32();case y.INT64:return n.int64();case y.UINT64:return n.uint64();case y.FIXED64:return n.fixed64();case y.BYTES:return n.bytes();case y.FIXED32:return n.fixed32();case y.SFIXED32:return n.sfixed32();case y.SFIXED64:return n.sfixed64();case y.SINT64:return n.sint64();case y.UINT32:return n.uint32();case y.SINT32:return n.sint32()}}function Ti(n,t,e,r){q(t!==void 0);const s=n.repeated;switch(n.kind){case"scalar":case"enum":let i=n.kind=="enum"?y.INT32:n.T;if(s)if(q(Array.isArray(t)),n.packed)Va(e,i,n.no,t);else for(const o of t)jr(e,i,n.no,o);else jr(e,i,n.no,t);break;case"message":if(s){q(Array.isArray(t));for(const o of t)Ai(e,r,n,o)}else Ai(e,r,n,t);break;case"map":q(typeof t=="object"&&t!=null);for(const[o,c]of Object.entries(t))za(e,r,n,o,c);break}}function za(n,t,e,r,s){n.tag(e.no,G.LengthDelimited),n.fork();let i=r;switch(e.K){case y.INT32:case y.FIXED32:case y.UINT32:case y.SFIXED32:case y.SINT32:i=Number.parseInt(r);break;case y.BOOL:q(r=="true"||r=="false"),i=r=="true";break}switch(jr(n,e.K,1,i),e.V.kind){case"scalar":jr(n,e.V.T,2,s);break;case"enum":jr(n,y.INT32,2,s);break;case"message":q(s!==void 0),n.tag(2,G.LengthDelimited).bytes(s.toBinary(t));break}n.join()}function Ai(n,t,e,r){const s=fo(e.T,r);e.delimited?n.tag(e.no,G.StartGroup).raw(s.toBinary(t)).tag(e.no,G.EndGroup):n.tag(e.no,G.LengthDelimited).bytes(s.toBinary(t))}function jr(n,t,e,r){q(r!==void 0);let[s,i]=go(t);n.tag(e,s)[i](r)}function Va(n,t,e,r){if(!r.length)return;n.tag(e,G.LengthDelimited).fork();let[,s]=go(t);for(let i=0;i<r.length;i++)n[s](r[i]);n.join()}function go(n){let t=G.Varint;switch(n){case y.BYTES:case y.STRING:t=G.LengthDelimited;break;case y.DOUBLE:case y.FIXED64:case y.SFIXED64:t=G.Bit64;break;case y.FIXED32:case y.SFIXED32:case y.FLOAT:t=G.Bit32;break}const e=y[n].toLowerCase();return[t,e]}function Ka(){return{setEnumType:ro,initPartial(n,t){if(n===void 0)return;const e=t.getType();for(const r of e.fields.byMember()){const s=r.localName,i=t,o=n;if(o[s]!=null)switch(r.kind){case"oneof":const c=o[s].case;if(c===void 0)continue;const l=r.findField(c);let h=o[s].value;l&&l.kind=="message"&&!vr(h,l.T)?h=new l.T(h):l&&l.kind==="scalar"&&l.T===y.BYTES&&(h=qr(h)),i[s]={case:c,value:h};break;case"scalar":case"enum":let f=o[s];r.T===y.BYTES&&(f=r.repeated?f.map(qr):qr(f)),i[s]=f;break;case"map":switch(r.V.kind){case"scalar":case"enum":if(r.V.T===y.BYTES)for(const[p,w]of Object.entries(o[s]))i[s][p]=qr(w);else Object.assign(i[s],o[s]);break;case"message":const v=r.V.T;for(const p of Object.keys(o[s])){let w=o[s][p];v.fieldWrapper||(w=new v(w)),i[s][p]=w}break}break;case"message":const g=r.T;if(r.repeated)i[s]=o[s].map(v=>vr(v,g)?v:new g(v));else{const v=o[s];g.fieldWrapper?g.typeName==="google.protobuf.BytesValue"?i[s]=qr(v):i[s]=v:i[s]=vr(v,g)?v:new g(v)}break}}},equals(n,t,e){return t===e?!0:!t||!e?!1:n.fields.byMember().every(r=>{const s=t[r.localName],i=e[r.localName];if(r.repeated){if(s.length!==i.length)return!1;switch(r.kind){case"message":return s.every((o,c)=>r.T.equals(o,i[c]));case"scalar":return s.every((o,c)=>rr(r.T,o,i[c]));case"enum":return s.every((o,c)=>rr(y.INT32,o,i[c]))}throw new Error(`repeated cannot contain ${r.kind}`)}switch(r.kind){case"message":return r.T.equals(s,i);case"enum":return rr(y.INT32,s,i);case"scalar":return rr(r.T,s,i);case"oneof":if(s.case!==i.case)return!1;const o=r.findField(s.case);if(o===void 0)return!0;switch(o.kind){case"message":return o.T.equals(s.value,i.value);case"enum":return rr(y.INT32,s.value,i.value);case"scalar":return rr(o.T,s.value,i.value)}throw new Error(`oneof cannot contain ${o.kind}`);case"map":const c=Object.keys(s).concat(Object.keys(i));switch(r.V.kind){case"message":const l=r.V.T;return c.every(f=>l.equals(s[f],i[f]));case"enum":return c.every(f=>rr(y.INT32,s[f],i[f]));case"scalar":const h=r.V.T;return c.every(f=>rr(h,s[f],i[f]))}break}})},clone(n){const t=n.getType(),e=new t,r=e;for(const s of t.fields.byMember()){const i=n[s.localName];let o;if(s.repeated)o=i.map(fn);else if(s.kind=="map"){o=r[s.localName];for(const[c,l]of Object.entries(i))o[c]=fn(l)}else s.kind=="oneof"?o=s.findField(i.case)?{case:i.case,value:fn(i.value)}:{case:void 0}:o=fn(i);r[s.localName]=o}for(const s of t.runtime.bin.listUnknownFields(n))t.runtime.bin.onUnknownField(r,s.no,s.wireType,s.data);return e}}}function fn(n){if(n===void 0)return n;if(vr(n))return n.clone();if(n instanceof Uint8Array){const t=new Uint8Array(n.byteLength);return t.set(n),t}return n}function qr(n){return n instanceof Uint8Array?n:new Uint8Array(n)}function ja(n,t,e){return{syntax:n,json:Ra(),bin:$a(),util:Object.assign(Object.assign({},Ka()),{newFieldList:t,initFields:e}),makeMessageType(r,s,i){return wa(this,r,s,i)},makeEnum:va,makeEnumType:no,getEnumType:ya,makeExtension(r,s,i){return xa(this,r,s,i)}}}class Ga{constructor(t,e){this._fields=t,this._normalizer=e}findJsonName(t){if(!this.jsonNames){const e={};for(const r of this.list())e[r.jsonName]=e[r.name]=r;this.jsonNames=e}return this.jsonNames[t]}find(t){if(!this.numbers){const e={};for(const r of this.list())e[r.no]=r;this.numbers=e}return this.numbers[t]}list(){return this.all||(this.all=this._normalizer(this._fields)),this.all}byNumber(){return this.numbersAsc||(this.numbersAsc=this.list().concat().sort((t,e)=>t.no-e.no)),this.numbersAsc}byMember(){if(!this.members){this.members=[];const t=this.members;let e;for(const r of this.list())r.oneof?r.oneof!==e&&(e=r.oneof,t.push(e)):t.push(r)}return this.members}}function mo(n,t){const e=po(n);return t?e:Qa(Za(e))}function Wa(n){return mo(n,!1)}const Ha=po;function po(n){let t=!1;const e=[];for(let r=0;r<n.length;r++){let s=n.charAt(r);switch(s){case"_":t=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":e.push(s),t=!1;break;default:t&&(t=!1,s=s.toUpperCase()),e.push(s);break}}return e.join("")}const Ya=new Set(["constructor","toString","toJSON","valueOf"]),Xa=new Set(["getType","clone","equals","fromBinary","fromJson","fromJsonString","toBinary","toJson","toJsonString","toObject"]),yo=n=>`${n}$`,Za=n=>Xa.has(n)?yo(n):n,Qa=n=>Ya.has(n)?yo(n):n;class _a{constructor(t){this.kind="oneof",this.repeated=!1,this.packed=!1,this.opt=!1,this.req=!1,this.default=void 0,this.fields=[],this.name=t,this.localName=Wa(t)}addField(t){q(t.oneof===this,`field ${t.name} not one of ${this.name}`),this.fields.push(t)}findField(t){if(!this._lookup){this._lookup=Object.create(null);for(let e=0;e<this.fields.length;e++)this._lookup[this.fields[e].localName]=this.fields[e]}return this._lookup[t]}}function ec(n,t){var e,r,s,i,o,c;const l=[];let h;for(const f of typeof n=="function"?n():n){const g=f;if(g.localName=mo(f.name,f.oneof!==void 0),g.jsonName=(e=f.jsonName)!==null&&e!==void 0?e:Ha(f.name),g.repeated=(r=f.repeated)!==null&&r!==void 0?r:!1,f.kind=="scalar"&&(g.L=(s=f.L)!==null&&s!==void 0?s:lr.BIGINT),g.delimited=(i=f.delimited)!==null&&i!==void 0?i:!1,g.req=(o=f.req)!==null&&o!==void 0?o:!1,g.opt=(c=f.opt)!==null&&c!==void 0?c:!1,f.packed===void 0&&(g.packed=f.kind=="enum"||f.kind=="scalar"&&f.T!=y.BYTES&&f.T!=y.STRING),f.oneof!==void 0){const v=typeof f.oneof=="string"?f.oneof:f.oneof.name;(!h||h.name!=v)&&(h=new _a(v)),g.oneof=h,h.addField(g)}l.push(g)}return l}const u=ja("proto3",n=>new Ga(n,t=>ec(t)),n=>{for(const t of n.getType().fields.byMember()){if(t.opt)continue;const e=t.localName,r=n;if(t.repeated){r[e]=[];continue}switch(t.kind){case"oneof":r[e]={case:void 0};break;case"enum":r[e]=0;break;case"map":r[e]={};break;case"scalar":r[e]=Br(t.T,t.L);break}}});var ee;(function(n){n[n.Unary=0]="Unary",n[n.ServerStreaming=1]="ServerStreaming",n[n.ClientStreaming=2]="ClientStreaming",n[n.BiDiStreaming=3]="BiDiStreaming"})(ee||(ee={}));var bi;(function(n){n[n.NoSideEffects=1]="NoSideEffects",n[n.Idempotent=2]="Idempotent"})(bi||(bi={}));class Q extends A{constructor(t){super(),this.seconds=$.zero,this.nanos=0,u.util.initPartial(t,this)}fromJson(t,e){if(typeof t!="string")throw new Error(`cannot decode google.protobuf.Timestamp from JSON: ${u.json.debug(t)}`);const r=t.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!r)throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");const s=Date.parse(r[1]+"-"+r[2]+"-"+r[3]+"T"+r[4]+":"+r[5]+":"+r[6]+(r[8]?r[8]:"Z"));if(Number.isNaN(s))throw new Error("cannot decode google.protobuf.Timestamp from JSON: invalid RFC 3339 string");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot decode message google.protobuf.Timestamp from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");return this.seconds=$.parse(s/1e3),this.nanos=0,r[7]&&(this.nanos=parseInt("1"+r[7]+"0".repeat(9-r[7].length))-1e9),this}toJson(t){const e=Number(this.seconds)*1e3;if(e<Date.parse("0001-01-01T00:00:00Z")||e>Date.parse("9999-12-31T23:59:59Z"))throw new Error("cannot encode google.protobuf.Timestamp to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive");if(this.nanos<0)throw new Error("cannot encode google.protobuf.Timestamp to JSON: nanos must not be negative");let r="Z";if(this.nanos>0){const s=(this.nanos+1e9).toString().substring(1);s.substring(3)==="000000"?r="."+s.substring(0,3)+"Z":s.substring(6)==="000"?r="."+s.substring(0,6)+"Z":r="."+s+"Z"}return new Date(e).toISOString().replace(".000Z",r)}toDate(){return new Date(Number(this.seconds)*1e3+Math.ceil(this.nanos/1e6))}static now(){return Q.fromDate(new Date)}static fromDate(t){const e=t.getTime();return new Q({seconds:$.parse(Math.floor(e/1e3)),nanos:e%1e3*1e6})}static fromBinary(t,e){return new Q().fromBinary(t,e)}static fromJson(t,e){return new Q().fromJson(t,e)}static fromJsonString(t,e){return new Q().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Q,t,e)}}Q.runtime=u;Q.typeName="google.protobuf.Timestamp";Q.fields=u.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class Ht extends A{constructor(t){super(),this.seconds=$.zero,this.nanos=0,u.util.initPartial(t,this)}fromJson(t,e){if(typeof t!="string")throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(t)}`);const r=t.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(r===null)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(t)}`);const s=Number(r[1]);if(s>315576e6||s<-315576e6)throw new Error(`cannot decode google.protobuf.Duration from JSON: ${u.json.debug(t)}`);if(this.seconds=$.parse(s),typeof r[2]=="string"){const i=r[2]+"0".repeat(9-r[2].length);this.nanos=parseInt(i),(s<0||Object.is(s,-0))&&(this.nanos=-this.nanos)}return this}toJson(t){if(Number(this.seconds)>315576e6||Number(this.seconds)<-315576e6)throw new Error("cannot encode google.protobuf.Duration to JSON: value out of range");let e=this.seconds.toString();if(this.nanos!==0){let r=Math.abs(this.nanos).toString();r="0".repeat(9-r.length)+r,r.substring(3)==="000000"?r=r.substring(0,3):r.substring(6)==="000"&&(r=r.substring(0,6)),e+="."+r,this.nanos<0&&Number(this.seconds)==0&&(e="-"+e)}return e+"s"}static fromBinary(t,e){return new Ht().fromBinary(t,e)}static fromJson(t,e){return new Ht().fromJson(t,e)}static fromJsonString(t,e){return new Ht().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ht,t,e)}}Ht.runtime=u;Ht.typeName="google.protobuf.Duration";Ht.fields=u.util.newFieldList(()=>[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}]);class Re extends A{constructor(t){super(),this.typeUrl="",this.value=new Uint8Array(0),u.util.initPartial(t,this)}toJson(t){var e;if(this.typeUrl==="")return{};const r=this.typeUrlToName(this.typeUrl),s=(e=t==null?void 0:t.typeRegistry)===null||e===void 0?void 0:e.findMessage(r);if(!s)throw new Error(`cannot encode message google.protobuf.Any to JSON: "${this.typeUrl}" is not in the type registry`);let o=s.fromBinary(this.value).toJson(t);return(r.startsWith("google.protobuf.")||o===null||Array.isArray(o)||typeof o!="object")&&(o={value:o}),o["@type"]=this.typeUrl,o}fromJson(t,e){var r;if(t===null||Array.isArray(t)||typeof t!="object")throw new Error(`cannot decode message google.protobuf.Any from JSON: expected object but got ${t===null?"null":Array.isArray(t)?"array":typeof t}`);if(Object.keys(t).length==0)return this;const s=t["@type"];if(typeof s!="string"||s=="")throw new Error('cannot decode message google.protobuf.Any from JSON: "@type" is empty');const i=this.typeUrlToName(s),o=(r=e==null?void 0:e.typeRegistry)===null||r===void 0?void 0:r.findMessage(i);if(!o)throw new Error(`cannot decode message google.protobuf.Any from JSON: ${s} is not in the type registry`);let c;if(i.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(t,"value"))c=o.fromJson(t.value,e);else{const l=Object.assign({},t);delete l["@type"],c=o.fromJson(l,e)}return this.packFrom(c),this}packFrom(t){this.value=t.toBinary(),this.typeUrl=this.typeNameToUrl(t.getType().typeName)}unpackTo(t){return this.is(t.getType())?(t.fromBinary(this.value),!0):!1}unpack(t){if(this.typeUrl==="")return;const e=t.findMessage(this.typeUrlToName(this.typeUrl));if(e)return e.fromBinary(this.value)}is(t){if(this.typeUrl==="")return!1;const e=this.typeUrlToName(this.typeUrl);let r="";return typeof t=="string"?r=t:r=t.typeName,e===r}typeNameToUrl(t){return`type.googleapis.com/${t}`}typeUrlToName(t){if(!t.length)throw new Error(`invalid type url: ${t}`);const e=t.lastIndexOf("/"),r=e>=0?t.substring(e+1):t;if(!r.length)throw new Error(`invalid type url: ${t}`);return r}static pack(t){const e=new Re;return e.packFrom(t),e}static fromBinary(t,e){return new Re().fromBinary(t,e)}static fromJson(t,e){return new Re().fromJson(t,e)}static fromJsonString(t,e){return new Re().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Re,t,e)}}Re.runtime=u;Re.typeName="google.protobuf.Any";Re.fields=u.util.newFieldList(()=>[{no:1,name:"type_url",kind:"scalar",T:9},{no:2,name:"value",kind:"scalar",T:12}]);class Le extends A{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.DOUBLE,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.DOUBLE,t)}catch(r){let s='cannot decode message google.protobuf.DoubleValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new Le().fromBinary(t,e)}static fromJson(t,e){return new Le().fromJson(t,e)}static fromJsonString(t,e){return new Le().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Le,t,e)}}Le.runtime=u;Le.typeName="google.protobuf.DoubleValue";Le.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:1}]);Le.fieldWrapper={wrapField(n){return new Le({value:n})},unwrapField(n){return n.value}};class Je extends A{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.FLOAT,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.FLOAT,t)}catch(r){let s='cannot decode message google.protobuf.FloatValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new Je().fromBinary(t,e)}static fromJson(t,e){return new Je().fromJson(t,e)}static fromJsonString(t,e){return new Je().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Je,t,e)}}Je.runtime=u;Je.typeName="google.protobuf.FloatValue";Je.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:2}]);Je.fieldWrapper={wrapField(n){return new Je({value:n})},unwrapField(n){return n.value}};class Fe extends A{constructor(t){super(),this.value=$.zero,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.INT64,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.INT64,t)}catch(r){let s='cannot decode message google.protobuf.Int64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new Fe().fromBinary(t,e)}static fromJson(t,e){return new Fe().fromJson(t,e)}static fromJsonString(t,e){return new Fe().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Fe,t,e)}}Fe.runtime=u;Fe.typeName="google.protobuf.Int64Value";Fe.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:3}]);Fe.fieldWrapper={wrapField(n){return new Fe({value:n})},unwrapField(n){return n.value}};class Me extends A{constructor(t){super(),this.value=$.zero,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.UINT64,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.UINT64,t)}catch(r){let s='cannot decode message google.protobuf.UInt64Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new Me().fromBinary(t,e)}static fromJson(t,e){return new Me().fromJson(t,e)}static fromJsonString(t,e){return new Me().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Me,t,e)}}Me.runtime=u;Me.typeName="google.protobuf.UInt64Value";Me.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:4}]);Me.fieldWrapper={wrapField(n){return new Me({value:n})},unwrapField(n){return n.value}};class $e extends A{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.INT32,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.INT32,t)}catch(r){let s='cannot decode message google.protobuf.Int32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new $e().fromBinary(t,e)}static fromJson(t,e){return new $e().fromJson(t,e)}static fromJsonString(t,e){return new $e().fromJsonString(t,e)}static equals(t,e){return u.util.equals($e,t,e)}}$e.runtime=u;$e.typeName="google.protobuf.Int32Value";$e.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:5}]);$e.fieldWrapper={wrapField(n){return new $e({value:n})},unwrapField(n){return n.value}};class Ue extends A{constructor(t){super(),this.value=0,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.UINT32,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.UINT32,t)}catch(r){let s='cannot decode message google.protobuf.UInt32Value from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new Ue().fromBinary(t,e)}static fromJson(t,e){return new Ue().fromJson(t,e)}static fromJsonString(t,e){return new Ue().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ue,t,e)}}Ue.runtime=u;Ue.typeName="google.protobuf.UInt32Value";Ue.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:13}]);Ue.fieldWrapper={wrapField(n){return new Ue({value:n})},unwrapField(n){return n.value}};class qe extends A{constructor(t){super(),this.value=!1,u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.BOOL,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.BOOL,t)}catch(r){let s='cannot decode message google.protobuf.BoolValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new qe().fromBinary(t,e)}static fromJson(t,e){return new qe().fromJson(t,e)}static fromJsonString(t,e){return new qe().fromJsonString(t,e)}static equals(t,e){return u.util.equals(qe,t,e)}}qe.runtime=u;qe.typeName="google.protobuf.BoolValue";qe.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:8}]);qe.fieldWrapper={wrapField(n){return new qe({value:n})},unwrapField(n){return n.value}};class ie extends A{constructor(t){super(),this.value="",u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.STRING,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.STRING,t)}catch(r){let s='cannot decode message google.protobuf.StringValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new ie().fromBinary(t,e)}static fromJson(t,e){return new ie().fromJson(t,e)}static fromJsonString(t,e){return new ie().fromJsonString(t,e)}static equals(t,e){return u.util.equals(ie,t,e)}}ie.runtime=u;ie.typeName="google.protobuf.StringValue";ie.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9}]);ie.fieldWrapper={wrapField(n){return new ie({value:n})},unwrapField(n){return n.value}};class ze extends A{constructor(t){super(),this.value=new Uint8Array(0),u.util.initPartial(t,this)}toJson(t){return u.json.writeScalar(y.BYTES,this.value,!0)}fromJson(t,e){try{this.value=u.json.readScalar(y.BYTES,t)}catch(r){let s='cannot decode message google.protobuf.BytesValue from JSON"';throw r instanceof Error&&r.message.length>0&&(s+=`: ${r.message}`),new Error(s)}return this}static fromBinary(t,e){return new ze().fromBinary(t,e)}static fromJson(t,e){return new ze().fromJson(t,e)}static fromJsonString(t,e){return new ze().fromJsonString(t,e)}static equals(t,e){return u.util.equals(ze,t,e)}}ze.runtime=u;ze.typeName="google.protobuf.BytesValue";ze.fields=u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:12}]);ze.fieldWrapper={wrapField(n){return new ze({value:n})},unwrapField(n){return n.value}};function tc(n,t,e){try{const r=$s.dec(n);return t?t.fromBinary(r,e):r}catch(r){throw M.from(r,R.DataLoss)}}function rc(n,t){const e={};for(const[r,s]of Object.entries(n.methods)){const i=t(Object.assign(Object.assign({},s),{localName:r,service:n}));i!=null&&(e[r]=i)}return e}function Ii(n){let t,e=new Uint8Array(0);function r(s){const i=new Uint8Array(e.length+s.length);i.set(e),i.set(s,e.length),e=i}return new ReadableStream({start(){t=n.getReader()},async pull(s){let i;for(;;){if(i===void 0&&e.byteLength>=5){let l=0;for(let h=1;h<5;h++)l=(l<<8)+e[h];i={flags:e[0],length:l}}if(i!==void 0&&e.byteLength>=i.length+5)break;const c=await t.read();if(c.done)break;r(c.value)}if(i===void 0){if(e.byteLength==0){s.close();return}s.error(new M("premature end of stream",R.DataLoss));return}const o=e.subarray(5,5+i.length);e=e.subarray(5+i.length),s.enqueue({flags:i.flags,data:o})}})}function Si(n,t){const e=new Uint8Array(t.length+5);e.set(t,5);const r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setUint8(0,n),r.setUint32(1,t.length),e}var nc=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=n[i]&&function(o){return new Promise(function(c,l){o=n[i](o),s(c,l,o.done,o.value)})}}function s(i,o,c,l){Promise.resolve(l).then(function(h){i({value:h,done:c})},o)}},Yr=function(n){return this instanceof Yr?(this.v=n,this):new Yr(n)},sc=function(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),s,i=[];return s={},c("next"),c("throw"),c("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(p){return function(w){return Promise.resolve(w).then(p,g)}}function c(p,w){r[p]&&(s[p]=function(b){return new Promise(function(E,C){i.push([p,b,E,C])>1||l(p,b)})},w&&(s[p]=w(s[p])))}function l(p,w){try{h(r[p](w))}catch(b){v(i[0][3],b)}}function h(p){p.value instanceof Yr?Promise.resolve(p.value.v).then(f,g):v(i[0][2],p)}function f(p){l("next",p)}function g(p){l("throw",p)}function v(p,w){p(w),i.shift(),i.length&&l(i[0][0],i[0][1])}},ic=function(n){var t,e;return t={},r("next"),r("throw",function(s){throw s}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(s,i){t[s]=n[s]?function(o){return(e=!e)?{value:Yr(n[s](o)),done:!1}:i?i(o):o}:i}};function oc(n){return sc(this,arguments,function*(){yield Yr(yield*ic(nc(n)))})}var vo=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t=n[Symbol.asyncIterator],e;return t?t.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=n[i]&&function(o){return new Promise(function(c,l){o=n[i](o),s(c,l,o.done,o.value)})}}function s(i,o,c,l){Promise.resolve(l).then(function(h){i({value:h,done:c})},o)}},Rr=function(n){return this instanceof Rr?(this.v=n,this):new Rr(n)},ac=function(n){var t,e;return t={},r("next"),r("throw",function(s){throw s}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(s,i){t[s]=n[s]?function(o){return(e=!e)?{value:Rr(n[s](o)),done:!1}:i?i(o):o}:i}},cc=function(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),s,i=[];return s={},c("next"),c("throw"),c("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(p){return function(w){return Promise.resolve(w).then(p,g)}}function c(p,w){r[p]&&(s[p]=function(b){return new Promise(function(E,C){i.push([p,b,E,C])>1||l(p,b)})},w&&(s[p]=w(s[p])))}function l(p,w){try{h(r[p](w))}catch(b){v(i[0][3],b)}}function h(p){p.value instanceof Rr?Promise.resolve(p.value.v).then(f,g):v(i[0][2],p)}function f(p){l("next",p)}function g(p){l("throw",p)}function v(p,w){p(w),i.shift(),i.length&&l(i[0][0],i[0][1])}};function uc(n,t){return rc(n,e=>{switch(e.kind){case ee.Unary:return lc(t,n,e);case ee.ServerStreaming:return hc(t,n,e);case ee.ClientStreaming:return fc(t,n,e);case ee.BiDiStreaming:return dc(t,n,e);default:return null}})}function lc(n,t,e){return async function(r,s){var i,o;const c=await n.unary(t,e,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues);return(i=s==null?void 0:s.onHeader)===null||i===void 0||i.call(s,c.header),(o=s==null?void 0:s.onTrailer)===null||o===void 0||o.call(s,c.trailer),c.message}}function hc(n,t,e){return function(r,s){return wo(n.stream(t,e,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,oc([r]),s==null?void 0:s.contextValues),s)}}function fc(n,t,e){return async function(r,s){var i,o,c,l,h,f;const g=await n.stream(t,e,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues);(h=s==null?void 0:s.onHeader)===null||h===void 0||h.call(s,g.header);let v;try{for(var p=!0,w=vo(g.message),b;b=await w.next(),i=b.done,!i;p=!0)l=b.value,p=!1,v=l}catch(E){o={error:E}}finally{try{!p&&!i&&(c=w.return)&&await c.call(w)}finally{if(o)throw o.error}}if(!v)throw new M("protocol error: missing response message",R.Internal);return(f=s==null?void 0:s.onTrailer)===null||f===void 0||f.call(s,g.trailer),v}}function dc(n,t,e){return function(r,s){return wo(n.stream(t,e,s==null?void 0:s.signal,s==null?void 0:s.timeoutMs,s==null?void 0:s.headers,r,s==null?void 0:s.contextValues),s)}}function wo(n,t){const e=function(){var r,s;return cc(this,arguments,function*(){const i=yield Rr(n);(r=t==null?void 0:t.onHeader)===null||r===void 0||r.call(t,i.header),yield Rr(yield*ac(vo(i.message))),(s=t==null?void 0:t.onTrailer)===null||s===void 0||s.call(t,i.trailer)})}()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>e.next()})}}function gc(...n){const t=new AbortController,e=n.filter(s=>s!==void 0).concat(t.signal);for(const s of e){if(s.aborted){r.apply(s);break}s.addEventListener("abort",r)}function r(){t.signal.aborted||t.abort(To(this));for(const s of e)s.removeEventListener("abort",r)}return t}function mc(n){const t=new AbortController,e=()=>{t.abort(new M("the operation timed out",R.DeadlineExceeded))};let r;return n!==void 0&&(n<=0?e():r=setTimeout(e,n)),{signal:t.signal,cleanup:()=>clearTimeout(r)}}function To(n){if(!n.aborted)return;if(n.reason!==void 0)return n.reason;const t=new Error("This operation was aborted");return t.name="AbortError",t}function ki(){return{get(n){return n.id in this?this[n.id]:n.defaultValue},set(n,t){return this[n.id]=t,this},delete(n){return delete this[n.id],this}}}const ss=128;function Ei(n){const t=new Headers,e=new TextDecoder().decode(n).split(`\r
`);for(const r of e){if(r==="")continue;const s=r.indexOf(":");if(s>0){const i=r.substring(0,s).trim(),o=r.substring(s+1).trim();t.append(i,o)}}return t}const pc="Content-Type",yc="Grpc-Timeout",Ao="Grpc-Status",bo="Grpc-Message",vc="Grpc-Status-Details-Bin",wc="X-User-Agent",Tc="X-Grpc-Web",Ac="application/grpc-web+proto",bc="application/grpc-web+json";class Yt extends A{constructor(t){super(),this.code=0,this.message="",this.details=[],u.util.initPartial(t,this)}static fromBinary(t,e){return new Yt().fromBinary(t,e)}static fromJson(t,e){return new Yt().fromJson(t,e)}static fromJsonString(t,e){return new Yt().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Yt,t,e)}}Yt.runtime=u;Yt.typeName="google.rpc.Status";Yt.fields=u.util.newFieldList(()=>[{no:1,name:"code",kind:"scalar",T:5},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"details",kind:"message",T:Re,repeated:!0}]);const Ic="0";function Io(n){var t;const e=n.get(vc);if(e!=null){const s=tc(e,Yt);if(s.code==0)return;const i=new M(s.message,s.code,n);return i.details=s.details.map(o=>({type:o.typeUrl.substring(o.typeUrl.lastIndexOf("/")+1),value:o.value})),i}const r=n.get(Ao);if(r!=null){if(r===Ic)return;const s=parseInt(r,10);return s in R?new M(decodeURIComponent((t=n.get(bo))!==null&&t!==void 0?t:""),s,n):new M(`invalid grpc-status: ${r}`,R.Internal,n)}}function xi(n,t,e){const r=typeof t=="string"?t:t.typeName,s=typeof e=="string"?e:e.name;return n.toString().replace(/\/?$/,`/${r}/${s}`)}function So(n,t){return t instanceof n?t:new n(t)}function Sc(n,t){function e(r){return r.done===!0?r:{done:r.done,value:So(n,r.value)}}return{[Symbol.asyncIterator](){const r=t[Symbol.asyncIterator](),s={next:()=>r.next().then(e)};return r.throw!==void 0&&(s.throw=i=>r.throw(i).then(e)),r.return!==void 0&&(s.return=i=>r.return(i).then(e)),s}}}function ko(n,t){var e;return(e=t==null?void 0:t.concat().reverse().reduce((r,s)=>s(r),n))!==null&&e!==void 0?e:n}function kc(n){var t;const e=Object.assign({},n);return(t=e.ignoreUnknownFields)!==null&&t!==void 0||(e.ignoreUnknownFields=!0),e}function Ni(n,t,e,r){const s=t?Ci(n.I,r):Pi(n.I,e);return{parse:(t?Ci(n.O,r):Pi(n.O,e)).parse,serialize:s.serialize}}function Ci(n,t){return{parse(e){try{return n.fromBinary(e,t)}catch(r){const s=r instanceof Error?r.message:String(r);throw new M(`parse binary: ${s}`,R.InvalidArgument)}},serialize(e){try{return e.toBinary(t)}catch(r){const s=r instanceof Error?r.message:String(r);throw new M(`serialize binary: ${s}`,R.Internal)}}}}function Pi(n,t){var e,r;const s=(e=t==null?void 0:t.textEncoder)!==null&&e!==void 0?e:new TextEncoder,i=(r=t==null?void 0:t.textDecoder)!==null&&r!==void 0?r:new TextDecoder,o=kc(t);return{parse(c){try{const l=i.decode(c);return n.fromJsonString(l,o)}catch(l){throw M.from(l,R.InvalidArgument)}},serialize(c){try{const l=c.toJsonString(o);return s.encode(l)}catch(l){throw M.from(l,R.Internal)}}}}function Ec(n){const t=ko(n.next,n.interceptors),[e,r,s]=Eo(n),i=Object.assign(Object.assign({},n.req),{message:So(n.req.method.I,n.req.message),signal:e});return t(i).then(o=>(s(),o),r)}function xc(n){const t=ko(n.next,n.interceptors),[e,r,s]=Eo(n),i=Object.assign(Object.assign({},n.req),{message:Sc(n.req.method.I,n.req.message),signal:e});let o=!1;return e.addEventListener("abort",function(){var c,l;const h=n.req.message[Symbol.asyncIterator]();o||(c=h.throw)===null||c===void 0||c.call(h,this.reason).catch(()=>{}),(l=h.return)===null||l===void 0||l.call(h).catch(()=>{})}),t(i).then(c=>Object.assign(Object.assign({},c),{message:{[Symbol.asyncIterator](){const l=c.message[Symbol.asyncIterator]();return{next(){return l.next().then(h=>(h.done==!0&&(o=!0,s()),h),r)}}}}}),r)}function Eo(n){const{signal:t,cleanup:e}=mc(n.timeoutMs),r=gc(n.signal,t);return[r.signal,function(i){const o=M.from(t.aborted?To(t):i);return r.abort(o),e(),Promise.reject(o)},function(){e(),r.abort()}]}function Nc(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function Di(n,t){const e=Io(n);if(e)throw t.forEach((r,s)=>{e.metadata.append(s,r)}),e}function Oi(n,t,e,r){const s=new Headers(e??{});return s.set(pc,n?Ac:bc),s.set(Tc,"1"),s.set(wc,"connect-es/1.4.0"),t!==void 0&&s.set(yc,`${t}m`),s}function Cc(n){switch(n){case 400:return R.Internal;case 401:return R.Unauthenticated;case 403:return R.PermissionDenied;case 404:return R.Unimplemented;case 429:return R.Unavailable;case 502:return R.Unavailable;case 503:return R.Unavailable;case 504:return R.Unavailable;default:return R.Unknown}}function Bi(n,t){var e;if(n>=200&&n<300){const r=Io(t);if(r)throw r;return{foundStatus:t.has(Ao)}}throw new M(decodeURIComponent((e=t.get(bo))!==null&&e!==void 0?e:`HTTP ${n}`),Cc(n),t)}var pr=function(n){return this instanceof pr?(this.v=n,this):new pr(n)},Pc=function(n,t,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(n,t||[]),s,i=[];return s={},c("next"),c("throw"),c("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(p){return function(w){return Promise.resolve(w).then(p,g)}}function c(p,w){r[p]&&(s[p]=function(b){return new Promise(function(E,C){i.push([p,b,E,C])>1||l(p,b)})},w&&(s[p]=w(s[p])))}function l(p,w){try{h(r[p](w))}catch(b){v(i[0][3],b)}}function h(p){p.value instanceof pr?Promise.resolve(p.value.v).then(f,g):v(i[0][2],p)}function f(p){l("next",p)}function g(p){l("throw",p)}function v(p,w){p(w),i.shift(),i.length&&l(i[0][0],i[0][1])}};function Dc(n){var t;Nc();const e=(t=n.useBinaryFormat)!==null&&t!==void 0?t:!0;return{async unary(r,s,i,o,c,l,h){var f;const{serialize:g,parse:v}=Ni(s,e,n.jsonOptions,n.binaryOptions);return o=o===void 0?n.defaultTimeoutMs:o<=0?void 0:o,await Ec({interceptors:n.interceptors,signal:i,timeoutMs:o,req:{stream:!1,service:r,method:s,url:xi(n.baseUrl,r,s),init:{method:"POST",credentials:(f=n.credentials)!==null&&f!==void 0?f:"same-origin",redirect:"error",mode:"cors"},header:Oi(e,o,c),contextValues:h??ki(),message:l},next:async p=>{var w;const E=await((w=n.fetch)!==null&&w!==void 0?w:globalThis.fetch)(p.url,Object.assign(Object.assign({},p.init),{headers:p.header,signal:p.signal,body:Si(0,g(p.message))}));if(Bi(E.status,E.headers),!E.body)throw"missing response body";const C=Ii(E.body).getReader();let P,L;for(;;){const Y=await C.read();if(Y.done)break;const{flags:D,data:F}=Y.value;if(D===ss){if(P!==void 0)throw"extra trailer";P=Ei(F);continue}if(L!==void 0)throw"extra message";L=v(F)}if(P===void 0)throw"missing trailer";if(Di(P,E.headers),L===void 0)throw"missing message";return{stream:!1,service:r,method:s,header:E.headers,message:L,trailer:P}}})},async stream(r,s,i,o,c,l,h){var f;const{serialize:g,parse:v}=Ni(s,e,n.jsonOptions,n.binaryOptions);function p(b,E,C,P){return Pc(this,arguments,function*(){const Y=Ii(b).getReader();if(E){if(!(yield pr(Y.read())).done)throw"extra data for trailers-only";return yield pr(void 0)}let D=!1;for(;;){const F=yield pr(Y.read());if(F.done)break;const{flags:V,data:K}=F.value;if((V&ss)===ss){if(D)throw"extra trailer";D=!0;const ue=Ei(K);Di(ue,P),ue.forEach((Ge,Sr)=>C.set(Sr,Ge));continue}if(D)throw"extra message";yield yield pr(v(K))}if(!D)throw"missing trailer"})}async function w(b){if(s.kind!=ee.ServerStreaming)throw"The fetch API does not support streaming request bodies";const E=await b[Symbol.asyncIterator]().next();if(E.done==!0)throw"missing request message";return Si(0,g(E.value))}return o=o===void 0?n.defaultTimeoutMs:o<=0?void 0:o,xc({interceptors:n.interceptors,signal:i,timeoutMs:o,req:{stream:!0,service:r,method:s,url:xi(n.baseUrl,r,s),init:{method:"POST",credentials:(f=n.credentials)!==null&&f!==void 0?f:"same-origin",redirect:"error",mode:"cors"},header:Oi(e,o,c),contextValues:h??ki(),message:l},next:async b=>{var E;const P=await((E=n.fetch)!==null&&E!==void 0?E:globalThis.fetch)(b.url,Object.assign(Object.assign({},b.init),{headers:b.header,signal:b.signal,body:await w(b.message)})),{foundStatus:L}=Bi(P.status,P.headers);if(!P.body)throw"missing response body";const Y=new Headers;return Object.assign(Object.assign({},b),{header:P.headers,trailer:Y,message:p(P.body,L,Y,P.headers)})}})}}}var N=(n=>(n[n.NULL=0]="NULL",n[n.BOOLEAN=1]="BOOLEAN",n[n.INTEGER=2]="INTEGER",n[n.LONG=3]="LONG",n[n.DOUBLE=4]="DOUBLE",n[n.STRING=5]="STRING",n[n.BYTES=6]="BYTES",n[n.DATE=7]="DATE",n[n.JSON_OBJECT=8]="JSON_OBJECT",n[n.JSON_ARRAY=9]="JSON_ARRAY",n[n.TEXT=10]="TEXT",n[n.INTEGER_CNT=11]="INTEGER_CNT",n[n.LONG_CNT=12]="LONG_CNT",n[n.TREE=13]="TREE",n))(N||{});u.util.setEnumType(N,"yorkie.v1.ValueType",[{no:0,name:"VALUE_TYPE_NULL"},{no:1,name:"VALUE_TYPE_BOOLEAN"},{no:2,name:"VALUE_TYPE_INTEGER"},{no:3,name:"VALUE_TYPE_LONG"},{no:4,name:"VALUE_TYPE_DOUBLE"},{no:5,name:"VALUE_TYPE_STRING"},{no:6,name:"VALUE_TYPE_BYTES"},{no:7,name:"VALUE_TYPE_DATE"},{no:8,name:"VALUE_TYPE_JSON_OBJECT"},{no:9,name:"VALUE_TYPE_JSON_ARRAY"},{no:10,name:"VALUE_TYPE_TEXT"},{no:11,name:"VALUE_TYPE_INTEGER_CNT"},{no:12,name:"VALUE_TYPE_LONG_CNT"},{no:13,name:"VALUE_TYPE_TREE"}]);var wr=(n=>(n[n.DOCUMENT_CHANGED=0]="DOCUMENT_CHANGED",n[n.DOCUMENT_WATCHED=1]="DOCUMENT_WATCHED",n[n.DOCUMENT_UNWATCHED=2]="DOCUMENT_UNWATCHED",n[n.DOCUMENT_BROADCAST=3]="DOCUMENT_BROADCAST",n))(wr||{});u.util.setEnumType(wr,"yorkie.v1.DocEventType",[{no:0,name:"DOC_EVENT_TYPE_DOCUMENT_CHANGED"},{no:1,name:"DOC_EVENT_TYPE_DOCUMENT_WATCHED"},{no:2,name:"DOC_EVENT_TYPE_DOCUMENT_UNWATCHED"},{no:3,name:"DOC_EVENT_TYPE_DOCUMENT_BROADCAST"}]);const We=class We extends A{constructor(e){super();a(this,"root");a(this,"presences",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new We().fromBinary(e,r)}static fromJson(e,r){return new We().fromJson(e,r)}static fromJsonString(e,r){return new We().fromJsonString(e,r)}static equals(e,r){return u.util.equals(We,e,r)}};a(We,"runtime",u),a(We,"typeName","yorkie.v1.Snapshot"),a(We,"fields",u.util.newFieldList(()=>[{no:1,name:"root",kind:"message",T:se},{no:2,name:"presences",kind:"map",K:9,V:{kind:"message",T:qs}}]));let hs=We;var he;let tr=(he=class extends A{constructor(e){super();a(this,"documentKey","");a(this,"checkpoint");a(this,"snapshot",new Uint8Array(0));a(this,"changes",[]);a(this,"minSyncedTicket");a(this,"isRemoved",!1);a(this,"versionVector");u.util.initPartial(e,this)}static fromBinary(e,r){return new he().fromBinary(e,r)}static fromJson(e,r){return new he().fromJson(e,r)}static fromJsonString(e,r){return new he().fromJsonString(e,r)}static equals(e,r){return u.util.equals(he,e,r)}},a(he,"runtime",u),a(he,"typeName","yorkie.v1.ChangePack"),a(he,"fields",u.util.newFieldList(()=>[{no:1,name:"document_key",kind:"scalar",T:9},{no:2,name:"checkpoint",kind:"message",T:Co},{no:3,name:"snapshot",kind:"scalar",T:12},{no:4,name:"changes",kind:"message",T:xo,repeated:!0},{no:5,name:"min_synced_ticket",kind:"message",T:I},{no:6,name:"is_removed",kind:"scalar",T:8},{no:7,name:"version_vector",kind:"message",T:Zn}])),he);var fe;let xo=(fe=class extends A{constructor(e){super();a(this,"id");a(this,"message","");a(this,"operations",[]);a(this,"presenceChange");u.util.initPartial(e,this)}static fromBinary(e,r){return new fe().fromBinary(e,r)}static fromJson(e,r){return new fe().fromJson(e,r)}static fromJsonString(e,r){return new fe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(fe,e,r)}},a(fe,"runtime",u),a(fe,"typeName","yorkie.v1.Change"),a(fe,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:Xn},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"operations",kind:"message",T:Us,repeated:!0},{no:4,name:"presence_change",kind:"message",T:Qr}])),fe);var de;let Xn=(de=class extends A{constructor(e){super();a(this,"clientSeq",0);a(this,"serverSeq",$.zero);a(this,"lamport",$.zero);a(this,"actorId",new Uint8Array(0));a(this,"versionVector");u.util.initPartial(e,this)}static fromBinary(e,r){return new de().fromBinary(e,r)}static fromJson(e,r){return new de().fromJson(e,r)}static fromJsonString(e,r){return new de().fromJsonString(e,r)}static equals(e,r){return u.util.equals(de,e,r)}},a(de,"runtime",u),a(de,"typeName","yorkie.v1.ChangeID"),a(de,"fields",u.util.newFieldList(()=>[{no:1,name:"client_seq",kind:"scalar",T:13},{no:2,name:"server_seq",kind:"scalar",T:3},{no:3,name:"lamport",kind:"scalar",T:3},{no:4,name:"actor_id",kind:"scalar",T:12},{no:5,name:"version_vector",kind:"message",T:Zn}])),de);var ge;let Zn=(ge=class extends A{constructor(e){super();a(this,"vector",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new ge().fromBinary(e,r)}static fromJson(e,r){return new ge().fromJson(e,r)}static fromJsonString(e,r){return new ge().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ge,e,r)}},a(ge,"runtime",u),a(ge,"typeName","yorkie.v1.VersionVector"),a(ge,"fields",u.util.newFieldList(()=>[{no:1,name:"vector",kind:"map",K:9,V:{kind:"scalar",T:3}}])),ge);var me;let Us=(me=class extends A{constructor(e){super();a(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new me().fromBinary(e,r)}static fromJson(e,r){return new me().fromJson(e,r)}static fromJsonString(e,r){return new me().fromJsonString(e,r)}static equals(e,r){return u.util.equals(me,e,r)}},a(me,"runtime",u),a(me,"typeName","yorkie.v1.Operation"),a(me,"fields",u.util.newFieldList(()=>[{no:1,name:"set",kind:"message",T:xn,oneof:"body"},{no:2,name:"add",kind:"message",T:Nn,oneof:"body"},{no:3,name:"move",kind:"message",T:Cn,oneof:"body"},{no:4,name:"remove",kind:"message",T:Pn,oneof:"body"},{no:5,name:"edit",kind:"message",T:Dn,oneof:"body"},{no:6,name:"select",kind:"message",T:fs,oneof:"body"},{no:7,name:"style",kind:"message",T:On,oneof:"body"},{no:8,name:"increase",kind:"message",T:Bn,oneof:"body"},{no:9,name:"tree_edit",kind:"message",T:Rn,oneof:"body"},{no:10,name:"tree_style",kind:"message",T:Ln,oneof:"body"},{no:11,name:"array_set",kind:"message",T:ds,oneof:"body"}])),me);const He=class He extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"key","");a(this,"value");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new He().fromBinary(e,r)}static fromJson(e,r){return new He().fromJson(e,r)}static fromJsonString(e,r){return new He().fromJsonString(e,r)}static equals(e,r){return u.util.equals(He,e,r)}};a(He,"runtime",u),a(He,"typeName","yorkie.v1.Operation.Set"),a(He,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"value",kind:"message",T:le},{no:4,name:"executed_at",kind:"message",T:I}]));let xn=He;const Ye=class Ye extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"prevCreatedAt");a(this,"value");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ye().fromBinary(e,r)}static fromJson(e,r){return new Ye().fromJson(e,r)}static fromJsonString(e,r){return new Ye().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ye,e,r)}};a(Ye,"runtime",u),a(Ye,"typeName","yorkie.v1.Operation.Add"),a(Ye,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"prev_created_at",kind:"message",T:I},{no:3,name:"value",kind:"message",T:le},{no:4,name:"executed_at",kind:"message",T:I}]));let Nn=Ye;const Xe=class Xe extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"prevCreatedAt");a(this,"createdAt");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Xe().fromBinary(e,r)}static fromJson(e,r){return new Xe().fromJson(e,r)}static fromJsonString(e,r){return new Xe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Xe,e,r)}};a(Xe,"runtime",u),a(Xe,"typeName","yorkie.v1.Operation.Move"),a(Xe,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"prev_created_at",kind:"message",T:I},{no:3,name:"created_at",kind:"message",T:I},{no:4,name:"executed_at",kind:"message",T:I}]));let Cn=Xe;const Ze=class Ze extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"createdAt");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ze().fromBinary(e,r)}static fromJson(e,r){return new Ze().fromJson(e,r)}static fromJsonString(e,r){return new Ze().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ze,e,r)}};a(Ze,"runtime",u),a(Ze,"typeName","yorkie.v1.Operation.Remove"),a(Ze,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"created_at",kind:"message",T:I},{no:3,name:"executed_at",kind:"message",T:I}]));let Pn=Ze;const Qe=class Qe extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"from");a(this,"to");a(this,"createdAtMapByActor",{});a(this,"content","");a(this,"executedAt");a(this,"attributes",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new Qe().fromBinary(e,r)}static fromJson(e,r){return new Qe().fromJson(e,r)}static fromJsonString(e,r){return new Qe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Qe,e,r)}};a(Qe,"runtime",u),a(Qe,"typeName","yorkie.v1.Operation.Edit"),a(Qe,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"from",kind:"message",T:_t},{no:3,name:"to",kind:"message",T:_t},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:I}},{no:5,name:"content",kind:"scalar",T:9},{no:6,name:"executed_at",kind:"message",T:I},{no:7,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}}]));let Dn=Qe;const _e=class _e extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"from");a(this,"to");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new _e().fromBinary(e,r)}static fromJson(e,r){return new _e().fromJson(e,r)}static fromJsonString(e,r){return new _e().fromJsonString(e,r)}static equals(e,r){return u.util.equals(_e,e,r)}};a(_e,"runtime",u),a(_e,"typeName","yorkie.v1.Operation.Select"),a(_e,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"from",kind:"message",T:_t},{no:3,name:"to",kind:"message",T:_t},{no:4,name:"executed_at",kind:"message",T:I}]));let fs=_e;const et=class et extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"from");a(this,"to");a(this,"attributes",{});a(this,"executedAt");a(this,"createdAtMapByActor",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new et().fromBinary(e,r)}static fromJson(e,r){return new et().fromJson(e,r)}static fromJsonString(e,r){return new et().fromJsonString(e,r)}static equals(e,r){return u.util.equals(et,e,r)}};a(et,"runtime",u),a(et,"typeName","yorkie.v1.Operation.Style"),a(et,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"from",kind:"message",T:_t},{no:3,name:"to",kind:"message",T:_t},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:I},{no:6,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:I}}]));let On=et;const tt=class tt extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"value");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new tt().fromBinary(e,r)}static fromJson(e,r){return new tt().fromJson(e,r)}static fromJsonString(e,r){return new tt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(tt,e,r)}};a(tt,"runtime",u),a(tt,"typeName","yorkie.v1.Operation.Increase"),a(tt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"value",kind:"message",T:le},{no:3,name:"executed_at",kind:"message",T:I}]));let Bn=tt;const rt=class rt extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"from");a(this,"to");a(this,"createdAtMapByActor",{});a(this,"contents",[]);a(this,"splitLevel",0);a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new rt().fromBinary(e,r)}static fromJson(e,r){return new rt().fromJson(e,r)}static fromJsonString(e,r){return new rt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(rt,e,r)}};a(rt,"runtime",u),a(rt,"typeName","yorkie.v1.Operation.TreeEdit"),a(rt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"from",kind:"message",T:Tr},{no:3,name:"to",kind:"message",T:Tr},{no:4,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:I}},{no:5,name:"contents",kind:"message",T:Kn,repeated:!0},{no:7,name:"split_level",kind:"scalar",T:5},{no:6,name:"executed_at",kind:"message",T:I}]));let Rn=rt;const nt=class nt extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"from");a(this,"to");a(this,"attributes",{});a(this,"executedAt");a(this,"attributesToRemove",[]);a(this,"createdAtMapByActor",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new nt().fromBinary(e,r)}static fromJson(e,r){return new nt().fromJson(e,r)}static fromJsonString(e,r){return new nt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(nt,e,r)}};a(nt,"runtime",u),a(nt,"typeName","yorkie.v1.Operation.TreeStyle"),a(nt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"from",kind:"message",T:Tr},{no:3,name:"to",kind:"message",T:Tr},{no:4,name:"attributes",kind:"map",K:9,V:{kind:"scalar",T:9}},{no:5,name:"executed_at",kind:"message",T:I},{no:6,name:"attributes_to_remove",kind:"scalar",T:9,repeated:!0},{no:7,name:"created_at_map_by_actor",kind:"map",K:9,V:{kind:"message",T:I}}]));let Ln=nt;const st=class st extends A{constructor(e){super();a(this,"parentCreatedAt");a(this,"createdAt");a(this,"value");a(this,"executedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new st().fromBinary(e,r)}static fromJson(e,r){return new st().fromJson(e,r)}static fromJsonString(e,r){return new st().fromJsonString(e,r)}static equals(e,r){return u.util.equals(st,e,r)}};a(st,"runtime",u),a(st,"typeName","yorkie.v1.Operation.ArraySet"),a(st,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_created_at",kind:"message",T:I},{no:2,name:"created_at",kind:"message",T:I},{no:3,name:"value",kind:"message",T:le},{no:4,name:"executed_at",kind:"message",T:I}]));let ds=st;const it=class it extends A{constructor(e){super();a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");a(this,"type",0);a(this,"value",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new it().fromBinary(e,r)}static fromJson(e,r){return new it().fromJson(e,r)}static fromJsonString(e,r){return new it().fromJsonString(e,r)}static equals(e,r){return u.util.equals(it,e,r)}};a(it,"runtime",u),a(it,"typeName","yorkie.v1.JSONElementSimple"),a(it,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:I},{no:2,name:"moved_at",kind:"message",T:I},{no:3,name:"removed_at",kind:"message",T:I},{no:4,name:"type",kind:"enum",T:u.getEnumType(N)},{no:5,name:"value",kind:"scalar",T:12}]));let le=it;const ot=class ot extends A{constructor(e){super();a(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new ot().fromBinary(e,r)}static fromJson(e,r){return new ot().fromJson(e,r)}static fromJsonString(e,r){return new ot().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ot,e,r)}};a(ot,"runtime",u),a(ot,"typeName","yorkie.v1.JSONElement"),a(ot,"fields",u.util.newFieldList(()=>[{no:1,name:"json_object",kind:"message",T:Jn,oneof:"body"},{no:2,name:"json_array",kind:"message",T:Fn,oneof:"body"},{no:3,name:"primitive",kind:"message",T:Mn,oneof:"body"},{no:5,name:"text",kind:"message",T:$n,oneof:"body"},{no:6,name:"counter",kind:"message",T:Un,oneof:"body"},{no:7,name:"tree",kind:"message",T:qn,oneof:"body"}]));let se=ot;const at=class at extends A{constructor(e){super();a(this,"nodes",[]);a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new at().fromBinary(e,r)}static fromJson(e,r){return new at().fromJson(e,r)}static fromJsonString(e,r){return new at().fromJsonString(e,r)}static equals(e,r){return u.util.equals(at,e,r)}};a(at,"runtime",u),a(at,"typeName","yorkie.v1.JSONElement.JSONObject"),a(at,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:No,repeated:!0},{no:2,name:"created_at",kind:"message",T:I},{no:3,name:"moved_at",kind:"message",T:I},{no:4,name:"removed_at",kind:"message",T:I}]));let Jn=at;const ct=class ct extends A{constructor(e){super();a(this,"nodes",[]);a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ct().fromBinary(e,r)}static fromJson(e,r){return new ct().fromJson(e,r)}static fromJsonString(e,r){return new ct().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ct,e,r)}};a(ct,"runtime",u),a(ct,"typeName","yorkie.v1.JSONElement.JSONArray"),a(ct,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:zn,repeated:!0},{no:2,name:"created_at",kind:"message",T:I},{no:3,name:"moved_at",kind:"message",T:I},{no:4,name:"removed_at",kind:"message",T:I}]));let Fn=ct;const ut=class ut extends A{constructor(e){super();a(this,"type",0);a(this,"value",new Uint8Array(0));a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ut().fromBinary(e,r)}static fromJson(e,r){return new ut().fromJson(e,r)}static fromJsonString(e,r){return new ut().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ut,e,r)}};a(ut,"runtime",u),a(ut,"typeName","yorkie.v1.JSONElement.Primitive"),a(ut,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(N)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:I},{no:4,name:"moved_at",kind:"message",T:I},{no:5,name:"removed_at",kind:"message",T:I}]));let Mn=ut;const lt=class lt extends A{constructor(e){super();a(this,"nodes",[]);a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new lt().fromBinary(e,r)}static fromJson(e,r){return new lt().fromJson(e,r)}static fromJsonString(e,r){return new lt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(lt,e,r)}};a(lt,"runtime",u),a(lt,"typeName","yorkie.v1.JSONElement.Text"),a(lt,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Vn,repeated:!0},{no:2,name:"created_at",kind:"message",T:I},{no:3,name:"moved_at",kind:"message",T:I},{no:4,name:"removed_at",kind:"message",T:I}]));let $n=lt;const ht=class ht extends A{constructor(e){super();a(this,"type",0);a(this,"value",new Uint8Array(0));a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ht().fromBinary(e,r)}static fromJson(e,r){return new ht().fromJson(e,r)}static fromJsonString(e,r){return new ht().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ht,e,r)}};a(ht,"runtime",u),a(ht,"typeName","yorkie.v1.JSONElement.Counter"),a(ht,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(N)},{no:2,name:"value",kind:"scalar",T:12},{no:3,name:"created_at",kind:"message",T:I},{no:4,name:"moved_at",kind:"message",T:I},{no:5,name:"removed_at",kind:"message",T:I}]));let Un=ht;const ft=class ft extends A{constructor(e){super();a(this,"nodes",[]);a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new ft().fromBinary(e,r)}static fromJson(e,r){return new ft().fromJson(e,r)}static fromJsonString(e,r){return new ft().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ft,e,r)}};a(ft,"runtime",u),a(ft,"typeName","yorkie.v1.JSONElement.Tree"),a(ft,"fields",u.util.newFieldList(()=>[{no:1,name:"nodes",kind:"message",T:Zr,repeated:!0},{no:2,name:"created_at",kind:"message",T:I},{no:3,name:"moved_at",kind:"message",T:I},{no:4,name:"removed_at",kind:"message",T:I}]));let qn=ft;var pe;let No=(pe=class extends A{constructor(e){super();a(this,"key","");a(this,"element");u.util.initPartial(e,this)}static fromBinary(e,r){return new pe().fromBinary(e,r)}static fromJson(e,r){return new pe().fromJson(e,r)}static fromJsonString(e,r){return new pe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(pe,e,r)}},a(pe,"runtime",u),a(pe,"typeName","yorkie.v1.RHTNode"),a(pe,"fields",u.util.newFieldList(()=>[{no:1,name:"key",kind:"scalar",T:9},{no:2,name:"element",kind:"message",T:se}])),pe);const Oe=class Oe extends A{constructor(e){super();a(this,"next");a(this,"element");u.util.initPartial(e,this)}static fromBinary(e,r){return new Oe().fromBinary(e,r)}static fromJson(e,r){return new Oe().fromJson(e,r)}static fromJsonString(e,r){return new Oe().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Oe,e,r)}};a(Oe,"runtime",u),a(Oe,"typeName","yorkie.v1.RGANode"),a(Oe,"fields",u.util.newFieldList(()=>[{no:1,name:"next",kind:"message",T:Oe},{no:2,name:"element",kind:"message",T:se}]));let zn=Oe;const dt=class dt extends A{constructor(e){super();a(this,"value","");a(this,"updatedAt");a(this,"isRemoved",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new dt().fromBinary(e,r)}static fromJson(e,r){return new dt().fromJson(e,r)}static fromJsonString(e,r){return new dt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(dt,e,r)}};a(dt,"runtime",u),a(dt,"typeName","yorkie.v1.NodeAttr"),a(dt,"fields",u.util.newFieldList(()=>[{no:1,name:"value",kind:"scalar",T:9},{no:2,name:"updated_at",kind:"message",T:I},{no:3,name:"is_removed",kind:"scalar",T:8}]));let Lr=dt;const gt=class gt extends A{constructor(e){super();a(this,"id");a(this,"value","");a(this,"removedAt");a(this,"insPrevId");a(this,"attributes",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new gt().fromBinary(e,r)}static fromJson(e,r){return new gt().fromJson(e,r)}static fromJsonString(e,r){return new gt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(gt,e,r)}};a(gt,"runtime",u),a(gt,"typeName","yorkie.v1.TextNode"),a(gt,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:Xr},{no:2,name:"value",kind:"scalar",T:9},{no:3,name:"removed_at",kind:"message",T:I},{no:4,name:"ins_prev_id",kind:"message",T:Xr},{no:5,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Lr}}]));let Vn=gt;const mt=class mt extends A{constructor(e){super();a(this,"createdAt");a(this,"offset",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new mt().fromBinary(e,r)}static fromJson(e,r){return new mt().fromJson(e,r)}static fromJsonString(e,r){return new mt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(mt,e,r)}};a(mt,"runtime",u),a(mt,"typeName","yorkie.v1.TextNodeID"),a(mt,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:I},{no:2,name:"offset",kind:"scalar",T:5}]));let Xr=mt;const pt=class pt extends A{constructor(e){super();a(this,"id");a(this,"type","");a(this,"value","");a(this,"removedAt");a(this,"insPrevId");a(this,"insNextId");a(this,"depth",0);a(this,"attributes",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new pt().fromBinary(e,r)}static fromJson(e,r){return new pt().fromJson(e,r)}static fromJsonString(e,r){return new pt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(pt,e,r)}};a(pt,"runtime",u),a(pt,"typeName","yorkie.v1.TreeNode"),a(pt,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"message",T:ar},{no:2,name:"type",kind:"scalar",T:9},{no:3,name:"value",kind:"scalar",T:9},{no:4,name:"removed_at",kind:"message",T:I},{no:5,name:"ins_prev_id",kind:"message",T:ar},{no:6,name:"ins_next_id",kind:"message",T:ar},{no:7,name:"depth",kind:"scalar",T:5},{no:8,name:"attributes",kind:"map",K:9,V:{kind:"message",T:Lr}}]));let Zr=pt;const yt=class yt extends A{constructor(e){super();a(this,"content",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new yt().fromBinary(e,r)}static fromJson(e,r){return new yt().fromJson(e,r)}static fromJsonString(e,r){return new yt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(yt,e,r)}};a(yt,"runtime",u),a(yt,"typeName","yorkie.v1.TreeNodes"),a(yt,"fields",u.util.newFieldList(()=>[{no:1,name:"content",kind:"message",T:Zr,repeated:!0}]));let Kn=yt;const vt=class vt extends A{constructor(e){super();a(this,"createdAt");a(this,"offset",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new vt().fromBinary(e,r)}static fromJson(e,r){return new vt().fromJson(e,r)}static fromJsonString(e,r){return new vt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(vt,e,r)}};a(vt,"runtime",u),a(vt,"typeName","yorkie.v1.TreeNodeID"),a(vt,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:I},{no:2,name:"offset",kind:"scalar",T:5}]));let ar=vt;const wt=class wt extends A{constructor(e){super();a(this,"parentId");a(this,"leftSiblingId");u.util.initPartial(e,this)}static fromBinary(e,r){return new wt().fromBinary(e,r)}static fromJson(e,r){return new wt().fromJson(e,r)}static fromJsonString(e,r){return new wt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(wt,e,r)}};a(wt,"runtime",u),a(wt,"typeName","yorkie.v1.TreePos"),a(wt,"fields",u.util.newFieldList(()=>[{no:1,name:"parent_id",kind:"message",T:ar},{no:2,name:"left_sibling_id",kind:"message",T:ar}]));let Tr=wt;const Tt=class Tt extends A{constructor(e){super();a(this,"id","");a(this,"username","");a(this,"createdAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new Tt().fromBinary(e,r)}static fromJson(e,r){return new Tt().fromJson(e,r)}static fromJsonString(e,r){return new Tt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Tt,e,r)}};a(Tt,"runtime",u),a(Tt,"typeName","yorkie.v1.User"),a(Tt,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"username",kind:"scalar",T:9},{no:3,name:"created_at",kind:"message",T:Q}]));let Ri=Tt;const At=class At extends A{constructor(e){super();a(this,"id","");a(this,"name","");a(this,"publicKey","");a(this,"secretKey","");a(this,"authWebhookUrl","");a(this,"authWebhookMethods",[]);a(this,"clientDeactivateThreshold","");a(this,"createdAt");a(this,"updatedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new At().fromBinary(e,r)}static fromJson(e,r){return new At().fromJson(e,r)}static fromJsonString(e,r){return new At().fromJsonString(e,r)}static equals(e,r){return u.util.equals(At,e,r)}};a(At,"runtime",u),a(At,"typeName","yorkie.v1.Project"),a(At,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"public_key",kind:"scalar",T:9},{no:4,name:"secret_key",kind:"scalar",T:9},{no:5,name:"auth_webhook_url",kind:"scalar",T:9},{no:6,name:"auth_webhook_methods",kind:"scalar",T:9,repeated:!0},{no:7,name:"client_deactivate_threshold",kind:"scalar",T:9},{no:8,name:"created_at",kind:"message",T:Q},{no:9,name:"updated_at",kind:"message",T:Q}]));let Li=At;const bt=class bt extends A{constructor(e){super();a(this,"name");a(this,"authWebhookUrl");a(this,"authWebhookMethods");a(this,"clientDeactivateThreshold");u.util.initPartial(e,this)}static fromBinary(e,r){return new bt().fromBinary(e,r)}static fromJson(e,r){return new bt().fromJson(e,r)}static fromJsonString(e,r){return new bt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(bt,e,r)}};a(bt,"runtime",u),a(bt,"typeName","yorkie.v1.UpdatableProjectFields"),a(bt,"fields",u.util.newFieldList(()=>[{no:1,name:"name",kind:"message",T:ie},{no:2,name:"auth_webhook_url",kind:"message",T:ie},{no:3,name:"auth_webhook_methods",kind:"message",T:gs},{no:4,name:"client_deactivate_threshold",kind:"message",T:ie}]));let Ji=bt;const It=class It extends A{constructor(e){super();a(this,"methods",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new It().fromBinary(e,r)}static fromJson(e,r){return new It().fromJson(e,r)}static fromJsonString(e,r){return new It().fromJsonString(e,r)}static equals(e,r){return u.util.equals(It,e,r)}};a(It,"runtime",u),a(It,"typeName","yorkie.v1.UpdatableProjectFields.AuthWebhookMethods"),a(It,"fields",u.util.newFieldList(()=>[{no:1,name:"methods",kind:"scalar",T:9,repeated:!0}]));let gs=It;const St=class St extends A{constructor(e){super();a(this,"id","");a(this,"key","");a(this,"snapshot","");a(this,"createdAt");a(this,"accessedAt");a(this,"updatedAt");u.util.initPartial(e,this)}static fromBinary(e,r){return new St().fromBinary(e,r)}static fromJson(e,r){return new St().fromJson(e,r)}static fromJsonString(e,r){return new St().fromJsonString(e,r)}static equals(e,r){return u.util.equals(St,e,r)}};a(St,"runtime",u),a(St,"typeName","yorkie.v1.DocumentSummary"),a(St,"fields",u.util.newFieldList(()=>[{no:1,name:"id",kind:"scalar",T:9},{no:2,name:"key",kind:"scalar",T:9},{no:3,name:"snapshot",kind:"scalar",T:9},{no:4,name:"created_at",kind:"message",T:Q},{no:5,name:"accessed_at",kind:"message",T:Q},{no:6,name:"updated_at",kind:"message",T:Q}]));let Fi=St;const kt=class kt extends A{constructor(e){super();a(this,"type",0);a(this,"presence");u.util.initPartial(e,this)}static fromBinary(e,r){return new kt().fromBinary(e,r)}static fromJson(e,r){return new kt().fromJson(e,r)}static fromJsonString(e,r){return new kt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(kt,e,r)}};a(kt,"runtime",u),a(kt,"typeName","yorkie.v1.PresenceChange"),a(kt,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(Ar)},{no:2,name:"presence",kind:"message",T:qs}]));let Qr=kt;var Ar=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.PUT=1]="PUT",n[n.DELETE=2]="DELETE",n[n.CLEAR=3]="CLEAR",n))(Ar||{});u.util.setEnumType(Ar,"yorkie.v1.PresenceChange.ChangeType",[{no:0,name:"CHANGE_TYPE_UNSPECIFIED"},{no:1,name:"CHANGE_TYPE_PUT"},{no:2,name:"CHANGE_TYPE_DELETE"},{no:3,name:"CHANGE_TYPE_CLEAR"}]);var ye;let qs=(ye=class extends A{constructor(e){super();a(this,"data",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new ye().fromBinary(e,r)}static fromJson(e,r){return new ye().fromJson(e,r)}static fromJsonString(e,r){return new ye().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ye,e,r)}},a(ye,"runtime",u),a(ye,"typeName","yorkie.v1.Presence"),a(ye,"fields",u.util.newFieldList(()=>[{no:1,name:"data",kind:"map",K:9,V:{kind:"scalar",T:9}}])),ye);var ve;let Co=(ve=class extends A{constructor(e){super();a(this,"serverSeq",$.zero);a(this,"clientSeq",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new ve().fromBinary(e,r)}static fromJson(e,r){return new ve().fromJson(e,r)}static fromJsonString(e,r){return new ve().fromJsonString(e,r)}static equals(e,r){return u.util.equals(ve,e,r)}},a(ve,"runtime",u),a(ve,"typeName","yorkie.v1.Checkpoint"),a(ve,"fields",u.util.newFieldList(()=>[{no:1,name:"server_seq",kind:"scalar",T:3},{no:2,name:"client_seq",kind:"scalar",T:13}])),ve);const Et=class Et extends A{constructor(e){super();a(this,"createdAt");a(this,"offset",0);a(this,"relativeOffset",0);u.util.initPartial(e,this)}static fromBinary(e,r){return new Et().fromBinary(e,r)}static fromJson(e,r){return new Et().fromJson(e,r)}static fromJsonString(e,r){return new Et().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Et,e,r)}};a(Et,"runtime",u),a(Et,"typeName","yorkie.v1.TextNodePos"),a(Et,"fields",u.util.newFieldList(()=>[{no:1,name:"created_at",kind:"message",T:I},{no:2,name:"offset",kind:"scalar",T:5},{no:3,name:"relative_offset",kind:"scalar",T:5}]));let _t=Et;var we;let I=(we=class extends A{constructor(e){super();a(this,"lamport",$.zero);a(this,"delimiter",0);a(this,"actorId",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new we().fromBinary(e,r)}static fromJson(e,r){return new we().fromJson(e,r)}static fromJsonString(e,r){return new we().fromJsonString(e,r)}static equals(e,r){return u.util.equals(we,e,r)}},a(we,"runtime",u),a(we,"typeName","yorkie.v1.TimeTicket"),a(we,"fields",u.util.newFieldList(()=>[{no:1,name:"lamport",kind:"scalar",T:3},{no:2,name:"delimiter",kind:"scalar",T:13},{no:3,name:"actor_id",kind:"scalar",T:12}])),we);const xt=class xt extends A{constructor(e){super();a(this,"topic","");a(this,"payload",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new xt().fromBinary(e,r)}static fromJson(e,r){return new xt().fromJson(e,r)}static fromJsonString(e,r){return new xt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(xt,e,r)}};a(xt,"runtime",u),a(xt,"typeName","yorkie.v1.DocEventBody"),a(xt,"fields",u.util.newFieldList(()=>[{no:1,name:"topic",kind:"scalar",T:9},{no:2,name:"payload",kind:"scalar",T:12}]));let ms=xt;const Nt=class Nt extends A{constructor(e){super();a(this,"type",0);a(this,"publisher","");a(this,"body");u.util.initPartial(e,this)}static fromBinary(e,r){return new Nt().fromBinary(e,r)}static fromJson(e,r){return new Nt().fromJson(e,r)}static fromJsonString(e,r){return new Nt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Nt,e,r)}};a(Nt,"runtime",u),a(Nt,"typeName","yorkie.v1.DocEvent"),a(Nt,"fields",u.util.newFieldList(()=>[{no:1,name:"type",kind:"enum",T:u.getEnumType(wr)},{no:2,name:"publisher",kind:"scalar",T:9},{no:3,name:"body",kind:"message",T:ms}]));let ps=Nt;const Ct=class Ct extends A{constructor(e){super();a(this,"clientKey","");a(this,"metadata",{});u.util.initPartial(e,this)}static fromBinary(e,r){return new Ct().fromBinary(e,r)}static fromJson(e,r){return new Ct().fromJson(e,r)}static fromJsonString(e,r){return new Ct().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ct,e,r)}};a(Ct,"runtime",u),a(Ct,"typeName","yorkie.v1.ActivateClientRequest"),a(Ct,"fields",u.util.newFieldList(()=>[{no:1,name:"client_key",kind:"scalar",T:9},{no:2,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]));let ys=Ct;const Pt=class Pt extends A{constructor(e){super();a(this,"clientId","");u.util.initPartial(e,this)}static fromBinary(e,r){return new Pt().fromBinary(e,r)}static fromJson(e,r){return new Pt().fromJson(e,r)}static fromJsonString(e,r){return new Pt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Pt,e,r)}};a(Pt,"runtime",u),a(Pt,"typeName","yorkie.v1.ActivateClientResponse"),a(Pt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9}]));let vs=Pt;const Dt=class Dt extends A{constructor(e){super();a(this,"clientId","");u.util.initPartial(e,this)}static fromBinary(e,r){return new Dt().fromBinary(e,r)}static fromJson(e,r){return new Dt().fromJson(e,r)}static fromJsonString(e,r){return new Dt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Dt,e,r)}};a(Dt,"runtime",u),a(Dt,"typeName","yorkie.v1.DeactivateClientRequest"),a(Dt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9}]));let ws=Dt;const Ot=class Ot extends A{constructor(t){super(),u.util.initPartial(t,this)}static fromBinary(t,e){return new Ot().fromBinary(t,e)}static fromJson(t,e){return new Ot().fromJson(t,e)}static fromJsonString(t,e){return new Ot().fromJsonString(t,e)}static equals(t,e){return u.util.equals(Ot,t,e)}};a(Ot,"runtime",u),a(Ot,"typeName","yorkie.v1.DeactivateClientResponse"),a(Ot,"fields",u.util.newFieldList(()=>[]));let Ts=Ot;const Bt=class Bt extends A{constructor(e){super();a(this,"clientId","");a(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new Bt().fromBinary(e,r)}static fromJson(e,r){return new Bt().fromJson(e,r)}static fromJsonString(e,r){return new Bt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Bt,e,r)}};a(Bt,"runtime",u),a(Bt,"typeName","yorkie.v1.AttachDocumentRequest"),a(Bt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:tr}]));let As=Bt;const Rt=class Rt extends A{constructor(e){super();a(this,"documentId","");a(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new Rt().fromBinary(e,r)}static fromJson(e,r){return new Rt().fromJson(e,r)}static fromJsonString(e,r){return new Rt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Rt,e,r)}};a(Rt,"runtime",u),a(Rt,"typeName","yorkie.v1.AttachDocumentResponse"),a(Rt,"fields",u.util.newFieldList(()=>[{no:1,name:"document_id",kind:"scalar",T:9},{no:2,name:"change_pack",kind:"message",T:tr}]));let bs=Rt;const Lt=class Lt extends A{constructor(e){super();a(this,"clientId","");a(this,"documentId","");a(this,"changePack");a(this,"removeIfNotAttached",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new Lt().fromBinary(e,r)}static fromJson(e,r){return new Lt().fromJson(e,r)}static fromJsonString(e,r){return new Lt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Lt,e,r)}};a(Lt,"runtime",u),a(Lt,"typeName","yorkie.v1.DetachDocumentRequest"),a(Lt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:tr},{no:4,name:"remove_if_not_attached",kind:"scalar",T:8}]));let Is=Lt;const Jt=class Jt extends A{constructor(e){super();a(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new Jt().fromBinary(e,r)}static fromJson(e,r){return new Jt().fromJson(e,r)}static fromJsonString(e,r){return new Jt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Jt,e,r)}};a(Jt,"runtime",u),a(Jt,"typeName","yorkie.v1.DetachDocumentResponse"),a(Jt,"fields",u.util.newFieldList(()=>[{no:2,name:"change_pack",kind:"message",T:tr}]));let Ss=Jt;const Ft=class Ft extends A{constructor(e){super();a(this,"clientId","");a(this,"documentId","");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ft().fromBinary(e,r)}static fromJson(e,r){return new Ft().fromJson(e,r)}static fromJsonString(e,r){return new Ft().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ft,e,r)}};a(Ft,"runtime",u),a(Ft,"typeName","yorkie.v1.WatchDocumentRequest"),a(Ft,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9}]));let ks=Ft;const Mt=class Mt extends A{constructor(e){super();a(this,"body",{case:void 0});u.util.initPartial(e,this)}static fromBinary(e,r){return new Mt().fromBinary(e,r)}static fromJson(e,r){return new Mt().fromJson(e,r)}static fromJsonString(e,r){return new Mt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Mt,e,r)}};a(Mt,"runtime",u),a(Mt,"typeName","yorkie.v1.WatchDocumentResponse"),a(Mt,"fields",u.util.newFieldList(()=>[{no:1,name:"initialization",kind:"message",T:xs,oneof:"body"},{no:2,name:"event",kind:"message",T:ps,oneof:"body"}]));let Es=Mt;const $t=class $t extends A{constructor(e){super();a(this,"clientIds",[]);u.util.initPartial(e,this)}static fromBinary(e,r){return new $t().fromBinary(e,r)}static fromJson(e,r){return new $t().fromJson(e,r)}static fromJsonString(e,r){return new $t().fromJsonString(e,r)}static equals(e,r){return u.util.equals($t,e,r)}};a($t,"runtime",u),a($t,"typeName","yorkie.v1.WatchDocumentResponse.Initialization"),a($t,"fields",u.util.newFieldList(()=>[{no:1,name:"client_ids",kind:"scalar",T:9,repeated:!0}]));let xs=$t;const Ut=class Ut extends A{constructor(e){super();a(this,"clientId","");a(this,"documentId","");a(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new Ut().fromBinary(e,r)}static fromJson(e,r){return new Ut().fromJson(e,r)}static fromJsonString(e,r){return new Ut().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Ut,e,r)}};a(Ut,"runtime",u),a(Ut,"typeName","yorkie.v1.RemoveDocumentRequest"),a(Ut,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:tr}]));let Ns=Ut;const qt=class qt extends A{constructor(e){super();a(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new qt().fromBinary(e,r)}static fromJson(e,r){return new qt().fromJson(e,r)}static fromJsonString(e,r){return new qt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(qt,e,r)}};a(qt,"runtime",u),a(qt,"typeName","yorkie.v1.RemoveDocumentResponse"),a(qt,"fields",u.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:tr}]));let Cs=qt;const zt=class zt extends A{constructor(e){super();a(this,"clientId","");a(this,"documentId","");a(this,"changePack");a(this,"pushOnly",!1);u.util.initPartial(e,this)}static fromBinary(e,r){return new zt().fromBinary(e,r)}static fromJson(e,r){return new zt().fromJson(e,r)}static fromJsonString(e,r){return new zt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(zt,e,r)}};a(zt,"runtime",u),a(zt,"typeName","yorkie.v1.PushPullChangesRequest"),a(zt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"change_pack",kind:"message",T:tr},{no:4,name:"push_only",kind:"scalar",T:8}]));let Ps=zt;const Vt=class Vt extends A{constructor(e){super();a(this,"changePack");u.util.initPartial(e,this)}static fromBinary(e,r){return new Vt().fromBinary(e,r)}static fromJson(e,r){return new Vt().fromJson(e,r)}static fromJsonString(e,r){return new Vt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Vt,e,r)}};a(Vt,"runtime",u),a(Vt,"typeName","yorkie.v1.PushPullChangesResponse"),a(Vt,"fields",u.util.newFieldList(()=>[{no:1,name:"change_pack",kind:"message",T:tr}]));let Ds=Vt;const Kt=class Kt extends A{constructor(e){super();a(this,"clientId","");a(this,"documentId","");a(this,"topic","");a(this,"payload",new Uint8Array(0));u.util.initPartial(e,this)}static fromBinary(e,r){return new Kt().fromBinary(e,r)}static fromJson(e,r){return new Kt().fromJson(e,r)}static fromJsonString(e,r){return new Kt().fromJsonString(e,r)}static equals(e,r){return u.util.equals(Kt,e,r)}};a(Kt,"runtime",u),a(Kt,"typeName","yorkie.v1.BroadcastRequest"),a(Kt,"fields",u.util.newFieldList(()=>[{no:1,name:"client_id",kind:"scalar",T:9},{no:2,name:"document_id",kind:"scalar",T:9},{no:3,name:"topic",kind:"scalar",T:9},{no:4,name:"payload",kind:"scalar",T:12}]));let Os=Kt;const jt=class jt extends A{constructor(t){super(),u.util.initPartial(t,this)}static fromBinary(t,e){return new jt().fromBinary(t,e)}static fromJson(t,e){return new jt().fromJson(t,e)}static fromJsonString(t,e){return new jt().fromJsonString(t,e)}static equals(t,e){return u.util.equals(jt,t,e)}};a(jt,"runtime",u),a(jt,"typeName","yorkie.v1.BroadcastResponse"),a(jt,"fields",u.util.newFieldList(()=>[]));let Bs=jt;const Oc={typeName:"yorkie.v1.YorkieService",methods:{activateClient:{name:"ActivateClient",I:ys,O:vs,kind:ee.Unary},deactivateClient:{name:"DeactivateClient",I:ws,O:Ts,kind:ee.Unary},attachDocument:{name:"AttachDocument",I:As,O:bs,kind:ee.Unary},detachDocument:{name:"DetachDocument",I:Is,O:Ss,kind:ee.Unary},removeDocument:{name:"RemoveDocument",I:Ns,O:Cs,kind:ee.Unary},pushPullChanges:{name:"PushPullChanges",I:Ps,O:Ds,kind:ee.Unary},watchDocument:{name:"WatchDocument",I:ks,O:Es,kind:ee.ServerStreaming},broadcast:{name:"Broadcast",I:Os,O:Bs,kind:ee.Unary}}},Bc=u.makeMessageType("google.rpc.ErrorInfo",()=>[{no:1,name:"reason",kind:"scalar",T:9},{no:2,name:"domain",kind:"scalar",T:9},{no:3,name:"metadata",kind:"map",K:9,V:{kind:"scalar",T:9}}]);u.makeMessageType("google.rpc.RetryInfo",()=>[{no:1,name:"retry_delay",kind:"message",T:Ht}]);u.makeMessageType("google.rpc.DebugInfo",()=>[{no:1,name:"stack_entries",kind:"scalar",T:9,repeated:!0},{no:2,name:"detail",kind:"scalar",T:9}]);u.makeMessageType("google.rpc.QuotaFailure",()=>[{no:1,name:"violations",kind:"message",T:Rc,repeated:!0}]);const Rc=u.makeMessageType("google.rpc.QuotaFailure.Violation",()=>[{no:1,name:"subject",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"QuotaFailure_Violation"});u.makeMessageType("google.rpc.PreconditionFailure",()=>[{no:1,name:"violations",kind:"message",T:Lc,repeated:!0}]);const Lc=u.makeMessageType("google.rpc.PreconditionFailure.Violation",()=>[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"subject",kind:"scalar",T:9},{no:3,name:"description",kind:"scalar",T:9}],{localName:"PreconditionFailure_Violation"});u.makeMessageType("google.rpc.BadRequest",()=>[{no:1,name:"field_violations",kind:"message",T:Jc,repeated:!0}]);const Jc=u.makeMessageType("google.rpc.BadRequest.FieldViolation",()=>[{no:1,name:"field",kind:"scalar",T:9},{no:2,name:"description",kind:"scalar",T:9}],{localName:"BadRequest_FieldViolation"});u.makeMessageType("google.rpc.RequestInfo",()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"serving_data",kind:"scalar",T:9}]);u.makeMessageType("google.rpc.ResourceInfo",()=>[{no:1,name:"resource_type",kind:"scalar",T:9},{no:2,name:"resource_name",kind:"scalar",T:9},{no:3,name:"owner",kind:"scalar",T:9},{no:4,name:"description",kind:"scalar",T:9}]);u.makeMessageType("google.rpc.Help",()=>[{no:1,name:"links",kind:"message",T:Fc,repeated:!0}]);const Fc=u.makeMessageType("google.rpc.Help.Link",()=>[{no:1,name:"description",kind:"scalar",T:9},{no:2,name:"url",kind:"scalar",T:9}],{localName:"Help_Link"});u.makeMessageType("google.rpc.LocalizedMessage",()=>[{no:1,name:"locale",kind:"scalar",T:9},{no:2,name:"message",kind:"scalar",T:9}]);var d=(n=>(n.Ok="ok",n.ErrClientNotActivated="ErrClientNotActivated",n.ErrClientNotFound="ErrClientNotFound",n.ErrUnimplemented="ErrUnimplemented",n.ErrInvalidType="ErrInvalidType",n.ErrDummy="ErrDummy",n.ErrDocumentNotAttached="ErrDocumentNotAttached",n.ErrDocumentNotDetached="ErrDocumentNotDetached",n.ErrDocumentRemoved="ErrDocumentRemoved",n.ErrInvalidObjectKey="ErrInvalidObjectKey",n.ErrInvalidArgument="ErrInvalidArgument",n.ErrNotInitialized="ErrNotInitialized",n.ErrNotReady="ErrNotReady",n.ErrRefused="ErrRefused",n.ErrContextNotProvided="ErrContextNotProvided",n.ErrPermissionDenied="ErrPermissionDenied",n.ErrUnauthenticated="ErrUnauthenticated",n.ErrTooManySubscribers="ErrTooManySubscribers",n.ErrTooManyAttachments="ErrTooManyAttachments",n))(d||{});class m extends Error{constructor(e,r){super(r);a(this,"name","YorkieError");a(this,"stack");this.code=e,this.message=r,this.toString=()=>`[code=${this.code}]: ${this.message}`}}function ke(n){if(n instanceof Map){const t=Array.from(n);return new Map(JSON.parse(JSON.stringify(t)))}return JSON.parse(JSON.stringify(n))}const Po=n=>n?Object.entries(n).length===0:!0,Jr=n=>{const t={};for(const[e,r]of Object.entries(n))t[e]=JSON.stringify(r);return t},Pr=n=>{const t={};for(const[e,r]of Object.entries(n))t[e]=JSON.parse(r);return t};var hr=(n=>(n.Put="put",n.Clear="clear",n))(hr||{});class is{constructor(t,e){a(this,"context");a(this,"presence");this.context=t,this.presence=e}set(t,e){for(const r of Object.keys(t))this.presence[r]=t[r];this.context.setPresenceChange({type:"put",presence:ke(this.presence)}),this.context.setReversePresence(t,e)}get(t){return this.presence[t]}clear(){this.presence={},this.context.setPresenceChange({type:"clear"})}}const Qn="000000000000000000000000";class be{constructor(t,e,r){a(this,"lamport");a(this,"delimiter");a(this,"actorID");this.lamport=t,this.delimiter=e,this.actorID=r}static of(t,e,r){return new be(t,e,r)}static fromStruct(t){return be.of(BigInt(t.lamport),t.delimiter,t.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(t){return new be(this.lamport,this.delimiter,t)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(t){return this.compare(t)>0}equals(t){return this.compare(t)===0}compare(t){if(this.lamport>t.lamport)return 1;if(t.lamport>this.lamport)return-1;const e=this.actorID.localeCompare(t.actorID);return e!==0?e:this.delimiter>t.delimiter?1:t.delimiter>this.delimiter?-1:0}}const Do=0,Gr=9223372036854775807n,Ne=new be(0n,Do,Qn);function Ve(n){return n.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(t){switch(t){case'"':case"\\":return"\\"+t;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return t}})}class an{constructor(t){a(this,"createdAt");a(this,"movedAt");a(this,"removedAt");this.createdAt=t}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setMovedAt(t){return!this.movedAt||t&&t.after(this.movedAt)?(this.movedAt=t,!0):!1}setRemovedAt(t){this.removedAt=t}remove(t){return t&&t.after(this.getPositionedAt())&&(!this.removedAt||t.after(this.removedAt))?(this.removedAt=t,!0):!1}isRemoved(){return!!this.removedAt}}class cr extends an{constructor(t){super(t)}}class zs{constructor(t,e){a(this,"strKey");a(this,"value");this.strKey=t,this.value=e}static of(t,e){return new zs(t,e)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(t){return this.value.remove(t)}}class _r{constructor(){a(this,"nodeMapByKey");a(this,"nodeMapByCreatedAt");this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new _r}set(t,e,r){let s;const i=this.nodeMapByKey.get(t);i!=null&&!i.isRemoved()&&i.remove(r)&&(s=i.getValue());const o=zs.of(t,e);return this.nodeMapByCreatedAt.set(e.getCreatedAt().toIDString(),o),(i==null||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(t,o),e.setMovedAt(r)),s}delete(t,e){if(!this.nodeMapByCreatedAt.has(t.toIDString()))throw new m(d.ErrInvalidArgument,`fail to find ${t.toIDString()}`);const r=this.nodeMapByCreatedAt.get(t.toIDString());return r.remove(e),r.getValue()}subPathOf(t){const e=this.nodeMapByCreatedAt.get(t.toIDString());if(e)return e.getStrKey()}purge(t){const e=this.nodeMapByCreatedAt.get(t.getCreatedAt().toIDString());if(!e)throw new m(d.ErrInvalidArgument,`fail to find ${t.getCreatedAt().toIDString()}`);const r=this.nodeMapByKey.get(e.getStrKey());e===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}deleteByKey(t,e){const r=this.nodeMapByKey.get(t);if(r!=null&&r.remove(e))return r.getValue()}has(t){const e=this.nodeMapByKey.get(t);return e==null?!1:!e.isRemoved()}getByID(t){return this.nodeMapByCreatedAt.get(t.toIDString())}get(t){const e=this.nodeMapByKey.get(t);if(!(!e||e.isRemoved()))return e}*[Symbol.iterator](){for(const[,t]of this.nodeMapByKey)yield t}}class ne extends cr{constructor(e,r){super(e);a(this,"memberNodes");this.memberNodes=r}static create(e,r){if(!r)return new ne(e,_r.create());const s=_r.create();for(const[i,o]of Object.entries(r))s.set(i,o.deepcopy(),o.getCreatedAt());return new ne(e,s)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,r,s){return this.memberNodes.set(e,r,s)}delete(e,r){return this.memberNodes.delete(e,r)}deleteByKey(e,r){return this.memberNodes.deleteByKey(e,r)}get(e){const r=this.memberNodes.get(e);return r==null?void 0:r.getValue()}getByID(e){const r=this.memberNodes.getByID(e);return r==null?void 0:r.getValue()}has(e){return this.memberNodes.has(e)}toJSON(){const e=[];for(const[r,s]of this)e.push(`"${Ve(r)}":${s.toJSON()}`);return`{${e.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(const[r,s]of this){const{createdAt:i,value:o,type:c}=s.toJSForTest();e[r]={key:r,createdAt:i,value:o,type:c}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){const e=Array();for(const[r]of this)e.push(r);return e}toSortedJSON(){var s;const e=Array();for(const[i]of this)e.push(i);const r=[];for(const i of e.sort()){const o=(s=this.memberNodes.get(i))==null?void 0:s.getValue();r.push(`"${Ve(i)}":${o.toSortedJSON()}`)}return`{${r.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const e=ne.create(this.getCreatedAt());for(const r of this.memberNodes)e.memberNodes.set(r.getStrKey(),r.getValue().deepcopy(),this.getPositionedAt());return e.remove(this.getRemovedAt()),e}getDescendants(e){for(const r of this.memberNodes){const s=r.getValue();if(e(s,this))return;s instanceof cr&&s.getDescendants(e)}}*[Symbol.iterator](){const e=new Set;for(const r of this.memberNodes)e.has(r.getStrKey())||(e.add(r.getStrKey()),r.isRemoved()||(yield[r.getStrKey(),r.getValue()]))}}var J=(n=>(n.Local="local",n.Remote="remote",n.UndoRedo="undoredo",n))(J||{});class Pe{constructor(t,e){a(this,"parentCreatedAt");a(this,"executedAt");this.parentCreatedAt=t,this.executedAt=e}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new m(d.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(t){this.executedAt&&(this.executedAt=this.executedAt.setActor(t))}setExecutedAt(t){this.executedAt=t}}class Oo{constructor(t){a(this,"value");a(this,"left");a(this,"right");a(this,"parent");a(this,"weight");this.value=t,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(t){this.left=t}setRight(t){this.right=t}setParent(t){this.parent=t}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(t){this.weight+=t}initWeight(){this.weight=this.getLength()}}class en{constructor(t){a(this,"root");this.root=t}get length(){return this.root?this.root.getWeight():0}find(t){if(!this.root||t<0)return[void 0,0];let e=this.root;for(;;)if(e.hasLeft()&&t<=e.getLeftWeight())e=e.getLeft();else if(e.hasRight()&&e.getLeftWeight()+e.getLength()<t)t-=e.getLeftWeight()+e.getLength(),e=e.getRight();else{t-=e.getLeftWeight();break}if(t>e.getLength())throw new m(d.ErrInvalidArgument,`out of index range: pos: ${t} > node.length: ${e.getLength()}`);return this.splayNode(e),[e,t]}indexOf(t){return!t||t!==this.root&&!t.hasLinks()?-1:(this.splayNode(t),this.root.getLeftWeight())}getRoot(){return this.root}insert(t){return this.insertAfter(this.root,t)}insertAfter(t,e){return t?(this.splayNode(t),this.root=e,e.setRight(t.getRight()),t.hasRight()&&t.getRight().setParent(e),e.setLeft(t),t.setParent(e),t.setRight(),this.updateWeight(t),this.updateWeight(e),e):(this.root=e,e)}updateWeight(t){t.initWeight(),t.hasLeft()&&t.increaseWeight(t.getLeftWeight()),t.hasRight()&&t.increaseWeight(t.getRightWeight())}updateTreeWeight(t){for(;t;)this.updateWeight(t),t=t.getParent()}splayNode(t){if(t)for(;;)if(this.isLeftChild(t.getParent())&&this.isRightChild(t))this.rotateLeft(t),this.rotateRight(t);else if(this.isRightChild(t.getParent())&&this.isLeftChild(t))this.rotateRight(t),this.rotateLeft(t);else if(this.isLeftChild(t.getParent())&&this.isLeftChild(t))this.rotateRight(t.getParent()),this.rotateRight(t);else if(this.isRightChild(t.getParent())&&this.isRightChild(t))this.rotateLeft(t.getParent()),this.rotateLeft(t);else{this.isLeftChild(t)?this.rotateRight(t):this.isRightChild(t)&&this.rotateLeft(t),this.updateWeight(t);return}}delete(t){this.splayNode(t);const e=new en(t.getLeft());e.root&&e.root.setParent();const r=new en(t.getRight());if(r.root&&r.root.setParent(),e.root){const s=e.getRightmost();e.splayNode(s),e.root.setRight(r.root),r.root&&r.root.setParent(e.root),this.root=e.root}else this.root=r.root;t.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(t,e){if(!e){this.splayNode(t),this.cutOffRight(t);return}this.splayNode(t),this.splayNode(e),e.getLeft()!=t&&this.rotateRight(t),this.cutOffRight(t)}cutOffRight(t){const e=[];this.traversePostorder(t.getRight(),e);for(const r of e)r.initWeight();this.updateTreeWeight(t)}toTestString(){const t=[];return this.traverseInorder(this.root,t),t.map(e=>`[${e.getWeight()},${e.getLength()}]${e.getValue()||""}`).join("")}checkWeight(){const t=[];this.traverseInorder(this.root,t);for(const e of t)if(e.getWeight()!=e.getLength()+e.getLeftWeight()+e.getRightWeight())return!1;return!0}getRightmost(){let t=this.root;for(;t.hasRight();)t=t.getRight();return t}traverseInorder(t,e){t&&(this.traverseInorder(t.getLeft(),e),e.push(t),this.traverseInorder(t.getRight(),e))}traversePostorder(t,e){t&&(this.traversePostorder(t.getLeft(),e),this.traversePostorder(t.getRight(),e),e.push(t))}rotateLeft(t){const e=t.getParent();e.hasParent()?e===e.getParent().getLeft()?e.getParent().setLeft(t):e.getParent().setRight(t):this.root=t,t.setParent(e.getParent()),e.setRight(t.getLeft()),e.hasRight()&&e.getRight().setParent(e),t.setLeft(e),t.getLeft().setParent(t),this.updateWeight(e),this.updateWeight(t)}rotateRight(t){const e=t.getParent();e.hasParent()?e===e.getParent().getLeft()?e.getParent().setLeft(t):e.getParent().setRight(t):this.root=t,t.setParent(e.getParent()),e.setLeft(t.getRight()),e.hasLeft()&&e.getLeft().setParent(e),t.setRight(e),t.getRight().setParent(t),this.updateWeight(e),this.updateWeight(t)}isLeftChild(t){return t&&t.hasParent()?t.getParent().getLeft()===t:!1}isRightChild(t){return t&&t.hasParent()?t.getParent().getRight()===t:!1}}/**
 * @license
 * Copyright 2009 The Closure Library Authors
 * Copyright 2020 Daniel Wirtz / The long.js Authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 */var Te=null;try{Te=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function O(n,t,e){this.low=n|0,this.high=t|0,this.unsigned=!!e}O.prototype.__isLong__;Object.defineProperty(O.prototype,"__isLong__",{value:!0});function _(n){return(n&&n.__isLong__)===!0}function Mi(n){var t=Math.clz32(n&-n);return n?31-t:t}O.isLong=_;var $i={},Ui={};function Ir(n,t){var e,r,s;return t?(n>>>=0,(s=0<=n&&n<256)&&(r=Ui[n],r)?r:(e=B(n,0,!0),s&&(Ui[n]=e),e)):(n|=0,(s=-128<=n&&n<128)&&(r=$i[n],r)?r:(e=B(n,n<0?-1:0,!1),s&&($i[n]=e),e))}O.fromInt=Ir;function Ae(n,t){if(isNaN(n))return t?Xt:Ee;if(t){if(n<0)return Xt;if(n>=Bo)return Jo}else{if(n<=-9223372036854776e3)return re;if(n+1>=$c)return Lo}return n<0?Ae(-n,t).neg():B(n%Fr|0,n/Fr|0,t)}O.fromNumber=Ae;function B(n,t,e){return new O(n,t,e)}O.fromBits=B;var jn=Math.pow;function Vs(n,t,e){if(n.length===0)throw Error("empty string");if(typeof t=="number"?(e=t,t=!1):t=!!t,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return t?Xt:Ee;if(e=e||10,e<2||36<e)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Vs(n.substring(1),t,e).neg();for(var s=Ae(jn(e,8)),i=Ee,o=0;o<n.length;o+=8){var c=Math.min(8,n.length-o),l=parseInt(n.substring(o,o+c),e);if(c<8){var h=Ae(jn(e,c));i=i.mul(h).add(Ae(l))}else i=i.mul(s),i=i.add(Ae(l))}return i.unsigned=t,i}O.fromString=Vs;function De(n,t){return typeof n=="number"?Ae(n,t):typeof n=="string"?Vs(n,t):B(n.low,n.high,typeof t=="boolean"?t:n.unsigned)}O.fromValue=De;var qi=65536,Mc=1<<24,Fr=qi*qi,Bo=Fr*Fr,$c=Bo/2,zi=Ir(Mc),Ee=Ir(0);O.ZERO=Ee;var Xt=Ir(0,!0);O.UZERO=Xt;var Nr=Ir(1);O.ONE=Nr;var Ro=Ir(1,!0);O.UONE=Ro;var Rs=Ir(-1);O.NEG_ONE=Rs;var Lo=B(-1,2147483647,!1);O.MAX_VALUE=Lo;var Jo=B(-1,-1,!0);O.MAX_UNSIGNED_VALUE=Jo;var re=B(0,-2147483648,!1);O.MIN_VALUE=re;var T=O.prototype;T.toInt=function(){return this.unsigned?this.low>>>0:this.low};T.toNumber=function(){return this.unsigned?(this.high>>>0)*Fr+(this.low>>>0):this.high*Fr+(this.low>>>0)};T.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(re)){var e=Ae(t),r=this.div(e),s=r.mul(e).sub(this);return r.toString(t)+s.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Ae(jn(t,6),this.unsigned),o=this,c="";;){var l=o.div(i),h=o.sub(l.mul(i)).toInt()>>>0,f=h.toString(t);if(o=l,o.isZero())return f+c;for(;f.length<6;)f="0"+f;c=""+f+c}};T.getHighBits=function(){return this.high};T.getHighBitsUnsigned=function(){return this.high>>>0};T.getLowBits=function(){return this.low};T.getLowBitsUnsigned=function(){return this.low>>>0};T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(re)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,e=31;e>0&&(t&1<<e)==0;e--);return this.high!=0?e+33:e+1};T.isZero=function(){return this.high===0&&this.low===0};T.eqz=T.isZero;T.isNegative=function(){return!this.unsigned&&this.high<0};T.isPositive=function(){return this.unsigned||this.high>=0};T.isOdd=function(){return(this.low&1)===1};T.isEven=function(){return(this.low&1)===0};T.equals=function(t){return _(t)||(t=De(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};T.eq=T.equals;T.notEquals=function(t){return!this.eq(t)};T.neq=T.notEquals;T.ne=T.notEquals;T.lessThan=function(t){return this.comp(t)<0};T.lt=T.lessThan;T.lessThanOrEqual=function(t){return this.comp(t)<=0};T.lte=T.lessThanOrEqual;T.le=T.lessThanOrEqual;T.greaterThan=function(t){return this.comp(t)>0};T.gt=T.greaterThan;T.greaterThanOrEqual=function(t){return this.comp(t)>=0};T.gte=T.greaterThanOrEqual;T.ge=T.greaterThanOrEqual;T.compare=function(t){if(_(t)||(t=De(t)),this.eq(t))return 0;var e=this.isNegative(),r=t.isNegative();return e&&!r?-1:!e&&r?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};T.comp=T.compare;T.negate=function(){return!this.unsigned&&this.eq(re)?re:this.not().add(Nr)};T.neg=T.negate;T.add=function(t){_(t)||(t=De(t));var e=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=t.high>>>16,c=t.high&65535,l=t.low>>>16,h=t.low&65535,f=0,g=0,v=0,p=0;return p+=i+h,v+=p>>>16,p&=65535,v+=s+l,g+=v>>>16,v&=65535,g+=r+c,f+=g>>>16,g&=65535,f+=e+o,f&=65535,B(v<<16|p,f<<16|g,this.unsigned)};T.subtract=function(t){return _(t)||(t=De(t)),this.add(t.neg())};T.sub=T.subtract;T.multiply=function(t){if(this.isZero())return this;if(_(t)||(t=De(t)),Te){var e=Te.mul(this.low,this.high,t.low,t.high);return B(e,Te.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?Xt:Ee;if(this.eq(re))return t.isOdd()?re:Ee;if(t.eq(re))return this.isOdd()?re:Ee;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(zi)&&t.lt(zi))return Ae(this.toNumber()*t.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,c=t.high>>>16,l=t.high&65535,h=t.low>>>16,f=t.low&65535,g=0,v=0,p=0,w=0;return w+=o*f,p+=w>>>16,w&=65535,p+=i*f,v+=p>>>16,p&=65535,p+=o*h,v+=p>>>16,p&=65535,v+=s*f,g+=v>>>16,v&=65535,v+=i*h,g+=v>>>16,v&=65535,v+=o*l,g+=v>>>16,v&=65535,g+=r*f+s*h+i*l+o*c,g&=65535,B(p<<16|w,g<<16|v,this.unsigned)};T.mul=T.multiply;T.divide=function(t){if(_(t)||(t=De(t)),t.isZero())throw Error("division by zero");if(Te){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var e=(this.unsigned?Te.div_u:Te.div_s)(this.low,this.high,t.low,t.high);return B(e,Te.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Xt:Ee;var r,s,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Xt;if(t.gt(this.shru(1)))return Ro;i=Xt}else{if(this.eq(re)){if(t.eq(Nr)||t.eq(Rs))return re;if(t.eq(re))return Nr;var o=this.shr(1);return r=o.div(t).shl(1),r.eq(Ee)?t.isNegative()?Nr:Rs:(s=this.sub(t.mul(r)),i=r.add(s.div(t)),i)}else if(t.eq(re))return this.unsigned?Xt:Ee;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=Ee}for(s=this;s.gte(t);){r=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var c=Math.ceil(Math.log(r)/Math.LN2),l=c<=48?1:jn(2,c-48),h=Ae(r),f=h.mul(t);f.isNegative()||f.gt(s);)r-=l,h=Ae(r,this.unsigned),f=h.mul(t);h.isZero()&&(h=Nr),i=i.add(h),s=s.sub(f)}return i};T.div=T.divide;T.modulo=function(t){if(_(t)||(t=De(t)),Te){var e=(this.unsigned?Te.rem_u:Te.rem_s)(this.low,this.high,t.low,t.high);return B(e,Te.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};T.mod=T.modulo;T.rem=T.modulo;T.not=function(){return B(~this.low,~this.high,this.unsigned)};T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};T.clz=T.countLeadingZeros;T.countTrailingZeros=function(){return this.low?Mi(this.low):Mi(this.high)+32};T.ctz=T.countTrailingZeros;T.and=function(t){return _(t)||(t=De(t)),B(this.low&t.low,this.high&t.high,this.unsigned)};T.or=function(t){return _(t)||(t=De(t)),B(this.low|t.low,this.high|t.high,this.unsigned)};T.xor=function(t){return _(t)||(t=De(t)),B(this.low^t.low,this.high^t.high,this.unsigned)};T.shiftLeft=function(t){return _(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?B(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):B(0,this.low<<t-32,this.unsigned)};T.shl=T.shiftLeft;T.shiftRight=function(t){return _(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?B(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):B(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};T.shr=T.shiftRight;T.shiftRightUnsigned=function(t){return _(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?B(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?B(this.high,0,this.unsigned):B(this.high>>>t-32,0,this.unsigned)};T.shru=T.shiftRightUnsigned;T.shr_u=T.shiftRightUnsigned;T.rotateLeft=function(t){var e;return _(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?B(this.high,this.low,this.unsigned):t<32?(e=32-t,B(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)):(t-=32,e=32-t,B(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned))};T.rotl=T.rotateLeft;T.rotateRight=function(t){var e;return _(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?B(this.high,this.low,this.unsigned):t<32?(e=32-t,B(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned)):(t-=32,e=32-t,B(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned))};T.rotr=T.rotateRight;T.toSigned=function(){return this.unsigned?B(this.low,this.high,!1):this};T.toUnsigned=function(){return this.unsigned?this:B(this.low,this.high,!0)};T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};T.toBytesLE=function(){var t=this.high,e=this.low;return[e&255,e>>>8&255,e>>>16&255,e>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};T.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,e>>>24,e>>>16&255,e>>>8&255,e&255]};O.fromBytes=function(t,e,r){return r?O.fromBytesLE(t,e):O.fromBytesBE(t,e)};O.fromBytesLE=function(t,e){return new O(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)};O.fromBytesBE=function(t,e){return new O(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var H=(n=>(n[n.Null=0]="Null",n[n.Boolean=1]="Boolean",n[n.Integer=2]="Integer",n[n.Long=3]="Long",n[n.Double=4]="Double",n[n.String=5]="String",n[n.Bytes=6]="Bytes",n[n.Date=7]="Date",n))(H||{});class z extends an{constructor(e,r){super(r);a(this,"valueType");a(this,"value");this.valueType=z.getPrimitiveType(e),this.value=e===void 0?null:e}static of(e,r){return new z(e,r)}static valueFromBytes(e,r){switch(e){case 0:return null;case 1:return!!r[0];case 2:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 4:{const s=new DataView(r.buffer);return r.forEach(function(i,o){s.setUint8(o,i)}),s.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(r);case 3:return O.fromBytesLE(Array.from(r));case 6:return r;case 7:return new Date(O.fromBytesLE(Array.from(r),!0).toNumber());default:throw new m(d.ErrUnimplemented,`unimplemented type: ${e}`)}}toJSON(){return this.valueType===5?`"${Ve(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const e=z.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(e)?2:4;case"string":return 5;case"object":if(e===null)return 0;if(e instanceof O)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return z.getPrimitiveType(e)!==void 0}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===2||e===3||e===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 4:{const e=this.value,r=new Uint8Array(8);return new DataView(r.buffer).setFloat64(0,e,!0),r}case 5:return new TextEncoder().encode(this.value);case 3:{const r=this.value.toBytesLE();return Uint8Array.from(r)}case 6:return this.value;case 7:{const e=this.value,r=O.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(r)}default:throw new m(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class Gn extends Oo{constructor(e){super(e);a(this,"prev");a(this,"next");this.value=e}static createAfter(e,r){const s=new Gn(r),i=e.next;return e.next=s,s.prev=e,s.next=i,i&&(i.prev=s),s}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class tn{constructor(){a(this,"dummyHead");a(this,"last");a(this,"nodeMapByIndex");a(this,"nodeMapByCreatedAt");const t=z.of(0,Ne);t.setRemovedAt(Ne),this.dummyHead=new Gn(t),this.last=this.dummyHead,this.nodeMapByIndex=new en,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new tn}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(t,e){let r=this.nodeMapByCreatedAt.get(t.toIDString());if(!r)throw new m(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);for(;r.getNext()&&r.getNext().getPositionedAt().after(e);)r=r.getNext();return r}release(t){this.last===t&&(this.last=t.getPrev()),t.release(),this.nodeMapByIndex.delete(t),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}insertAfter(t,e,r=e.getCreatedAt()){const s=this.findNextBeforeExecutedAt(t,r),i=Gn.createAfter(s,e);s===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(s,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i)}moveAfter(t,e,r){const s=this.nodeMapByCreatedAt.get(t.toIDString());if(!s)throw new m(d.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);const i=this.nodeMapByCreatedAt.get(e.toIDString());if(!i)throw new m(d.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);s!==i&&(!i.getValue().getMovedAt()||r.after(i.getValue().getMovedAt()))&&(this.release(i),this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r))}insert(t){this.insertAfter(this.last.getCreatedAt(),t)}getByID(t){return this.nodeMapByCreatedAt.get(t.toIDString())}subPathOf(t){const e=this.nodeMapByCreatedAt.get(t.toIDString());if(e)return String(this.nodeMapByIndex.indexOf(e))}purge(t){const e=this.nodeMapByCreatedAt.get(t.getCreatedAt().toIDString());if(!e)throw new m(d.ErrInvalidArgument,`fail to find the given createdAt: ${t.getCreatedAt().toIDString()}`);this.release(e)}getByIndex(t){if(t>=this.length)return;const[e,r]=this.nodeMapByIndex.find(t);let s=e;if(t===0&&e===this.dummyHead||r>0)do s&&(s=s.getNext());while(s&&s.isRemoved());return s}getPrevCreatedAt(t){let e=this.nodeMapByCreatedAt.get(t.toIDString());do e=e.getPrev();while(this.dummyHead!==e&&e.isRemoved());return e.getValue().getCreatedAt()}delete(t,e){const r=this.nodeMapByCreatedAt.get(t.toIDString()),s=r.isRemoved();return r.remove(e)&&!s&&this.nodeMapByIndex.splayNode(r),r.getValue()}deleteByIndex(t,e){const r=this.getByIndex(t);if(r)return r.remove(e)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const t=[];for(const e of this){const r=`${e.getCreatedAt().toIDString()}:${e.getValue().toJSON()}`;e.isRemoved()?t.push(`{${r}}`):t.push(`[${r}]`)}return t.join("")}*[Symbol.iterator](){let t=this.dummyHead.getNext();for(;t;)yield t,t=t.getNext()}}class ae extends cr{constructor(e,r){super(e);a(this,"elements");this.elements=r}static create(e,r){if(!r)return new ae(e,tn.create());const s=tn.create();for(const i of r)s.insertAfter(s.getLastCreatedAt(),i.deepcopy());return new ae(e,s)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,r){this.elements.insertAfter(e,r)}moveAfter(e,r,s){this.elements.moveAfter(e,r,s)}get(e){const r=this.elements.getByIndex(e);return r==null?void 0:r.getValue()}getByID(e){const r=this.elements.getByID(e);return r==null?void 0:r.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,r){return this.elements.delete(e,r)}deleteByIndex(e,r){return this.elements.deleteByIndex(e,r)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(const r of this.elements){const s=r.getValue();if(e(s,this))return;s instanceof cr&&s.getDescendants(e)}}toJSON(){const e=[];for(const r of this)e.push(r.toJSON());return`[${e.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(let r=0;r<this.length;r++){const{createdAt:s,value:i,type:o}=this.get(r).toJSForTest();e[r]={key:String(r),createdAt:s,value:i,type:o}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const e=ae.create(this.getCreatedAt());for(const r of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),r.getValue().deepcopy());return e.remove(this.getRemovedAt()),e}}class fr extends Pe{constructor(e,r,s){super(e,s);a(this,"createdAt");this.createdAt=r}static create(e,r,s){return new fr(e,r,s)}execute(e,r){var h;const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof cr))throw new m(d.ErrInvalidArgument,`only object and array can execute remove: ${s}`);if(r===J.UndoRedo){let f=s.getByID(this.createdAt);for(;f;){if(f.getRemovedAt())return;f=(h=e.findElementPairByCreatedAt(f.getCreatedAt()))==null?void 0:h.parent}}const i=s.subPathOf(this.createdAt),o=this.toReverseOperation(s),c=s.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(c),{opInfos:s instanceof ae?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(i)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:i}],reverseOp:o}}toReverseOperation(e){if(e instanceof ne){const r=e.subPathOf(this.createdAt);if(r!==void 0){const s=e.get(r);if(s!==void 0)return br.create(r,s.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}}class br extends Pe{constructor(e,r,s,i){super(s,i);a(this,"key");a(this,"value");this.key=e,this.value=r}static create(e,r,s,i){return new br(e,r,s,i)}execute(e,r){var h;const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof ne))throw new m(d.ErrInvalidArgument,"fail to execute, only object can execute set");if(r===J.UndoRedo){let f=s;for(;f;){if(f.getRemovedAt())return;f=(h=e.findElementPairByCreatedAt(f.getCreatedAt()))==null?void 0:h.parent}}const i=s.get(this.key),o=this.toReverseOperation(i),c=this.value.deepcopy(),l=s.set(this.key,c,this.getExecutedAt());return r===J.UndoRedo&&e.findByCreatedAt(c.getCreatedAt())&&e.deregisterElement(c),e.registerElement(c,s),l&&e.registerRemovedElement(l),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:o}}toReverseOperation(e){let r=fr.create(this.getParentCreatedAt(),this.value.getCreatedAt());return e!==void 0&&!e.isRemoved()&&(r=br.create(this.key,e.deepcopy(),this.getParentCreatedAt())),r}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class cn extends Pe{constructor(e,r,s,i){super(e,i);a(this,"prevCreatedAt");a(this,"value");this.prevCreatedAt=r,this.value=s}static create(e,r,s,i){return new cn(e,r,s,i)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ae))throw new m(d.ErrInvalidArgument,"fail to execute, only array can execute add");const s=r,i=this.value.deepcopy();return s.insertAfter(this.prevCreatedAt,i),e.registerElement(i,s),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(s.subPathOf(this.getEffectedCreatedAt()))}]}}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}}class or extends Pe{constructor(e,r,s,i){super(e,i);a(this,"prevCreatedAt");a(this,"createdAt");this.prevCreatedAt=r,this.createdAt=s}static create(e,r,s,i){return new or(e,r,s,i)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ae))throw new m(d.ErrInvalidArgument,"fail to execute, only array can execute move");const s=r,i=Number(s.subPathOf(this.createdAt));s.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const o=Number(s.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:o,previousIndex:i}]}}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}}class yr{constructor(t,e,r,s){a(this,"key");a(this,"value");a(this,"updatedAt");a(this,"_isRemoved");this.key=t,this.value=e,this.updatedAt=r,this._isRemoved=s}static of(t,e,r,s){return new yr(t,e,r,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}}class er{constructor(){a(this,"nodeMapByKey");a(this,"numberOfRemovedElement");this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new er}getNodeMapByKey(){return this.nodeMapByKey}set(t,e,r){const s=this.nodeMapByKey.get(t);if(s&&s.isRemoved()&&r.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||r.after(s.getUpdatedAt())){const i=yr.of(t,e,r,!1);return this.nodeMapByKey.set(t,i),s!==void 0&&s.isRemoved()?[s,i]:[void 0,i]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(t,e,r,s){const i=yr.of(t,e,r,s);this.nodeMapByKey.set(t,i),s&&this.numberOfRemovedElement++}remove(t,e){const r=this.nodeMapByKey.get(t),s=[];if(r===void 0||e.after(r.getUpdatedAt())){if(r===void 0){this.numberOfRemovedElement+=1;const c=yr.of(t,"",e,!0);return this.nodeMapByKey.set(t,c),s.push(c),s}const i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&s.push(r);const o=yr.of(t,r.getValue(),e,!0);return this.nodeMapByKey.set(t,o),s.push(o),s}return s}has(t){if(this.nodeMapByKey.has(t)){const e=this.nodeMapByKey.get(t);return e!==void 0&&!e.isRemoved()}return!1}get(t){if(this.nodeMapByKey.has(t))return this.nodeMapByKey.get(t).getValue()}deepcopy(){const t=new er;for(const[,e]of this.nodeMapByKey)t.setInternal(e.getKey(),e.getValue(),e.getUpdatedAt(),e.isRemoved());return t}toJSON(){if(!this.size())return"{}";const t=[];for(const[e,r]of this.nodeMapByKey)r.isRemoved()||t.push(`"${Ve(e)}":"${Ve(r.getValue())}"`);return`{${t.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const t={};for(const[e,r]of this.nodeMapByKey)r.isRemoved()||(t[e]=r.getValue());return t}*[Symbol.iterator](){for(const[,t]of this.nodeMapByKey)yield t}purge(t){const e=this.nodeMapByKey.get(t.getKey());e==null||e.toIDString()!=t.toIDString()||(this.nodeMapByKey.delete(t.getKey()),this.numberOfRemovedElement--)}}class rn{constructor(t){a(this,"attributes");a(this,"content");this.attributes=er.create(),this.content=t}static create(t){return new rn(t)}get length(){return this.content.length}substring(t,e){const r=new rn(this.content.substring(t,e));return r.attributes=this.attributes.deepcopy(),r}setAttr(t,e,r){return this.attributes.set(t,e,r)}getAttrs(){return this.attributes}toString(){return this.content}toJSON(){const t=Ve(this.content),e=this.attributes.toObject(),r=[];for(const[s,i]of Object.entries(e)){const o=JSON.parse(i),c=typeof o=="string"?`"${Ve(s)}":"${Ve(o)}"`:`"${Ve(s)}":${String(o)}`;r.push(c)}return r.sort(),r.length===0?`{"val":"${t}"}`:`{"attrs":{${r.join(",")}},"val":"${t}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(t){this.attributes&&t instanceof yr&&this.attributes.purge(t)}getGCPairs(){const t=[];for(const e of this.attributes)e.getRemovedAt()&&t.push({parent:this,child:e});return t}}class Ie extends an{constructor(e,r){super(r);a(this,"rgaTreeSplit");this.rgaTreeSplit=e}static create(e,r){return new Ie(e,r)}edit(e,r,s,i,o,c){const l=r?rn.create(r):void 0;if(l&&i)for(const[w,b]of Object.entries(i))l.setAttr(w,b,s);const[h,f,g,v]=this.rgaTreeSplit.edit(e,s,l,o,c),p=v.map(w=>({...w,value:w.value?{attributes:Pr(w.value.getAttributes()),content:w.value.getContent()}:{attributes:void 0,content:""},type:"content"}));return[f,p,g,[h,h]]}setStyle(e,r,s,i,o){const[,c]=this.rgaTreeSplit.findNodeWithSplit(e[1],s),[,l]=this.rgaTreeSplit.findNodeWithSplit(e[0],s),h=[],f=this.rgaTreeSplit.findBetween(l,c),g=new Map,v=[];for(const w of f){const b=w.getCreatedAt().getActorID();let E,C=0n;if(o===void 0&&i===void 0?C=Gr:o.size()>0?C=o.get(b)?o.get(b):0n:E=i.has(b)?i.get(b):Ne,w.canStyle(s,E,C)){const P=g.get(b),L=w.getCreatedAt();(!P||L.after(P))&&g.set(b,L),v.push(w)}}const p=[];for(const w of v){if(w.isRemoved())continue;const[b,E]=this.rgaTreeSplit.findIndexesFromRange(w.createPosRange());h.push({type:"style",actor:s.getActorID(),from:b,to:E,value:{attributes:Pr(r)}});for(const[C,P]of Object.entries(r)){const[L]=w.getValue().setAttr(C,P,s);L!==void 0&&p.push({parent:w.getValue(),child:L})}}return[g,p,h]}indexRangeToPosRange(e,r){const s=this.rgaTreeSplit.indexToPos(e);return e===r?[s,s]:[s,this.rgaTreeSplit.indexToPos(r)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}toJSON(){const e=[];for(const r of this.rgaTreeSplit)r.isRemoved()||e.push(r.getValue().toJSON());return`[${e.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const e=[];for(const r of this.rgaTreeSplit)if(!r.isRemoved()){const s=r.getValue();e.push({attributes:Pr(s.getAttributes()),content:s.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const e=new Ie(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.remove(this.getRemovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}getGCPairs(){const e=[];for(const r of this.rgaTreeSplit){r.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:r});for(const s of r.getValue().getGCPairs())e.push(s)}return e}}class un extends Pe{constructor(e,r,s,i,o,c,l){super(e,l);a(this,"fromPos");a(this,"toPos");a(this,"maxCreatedAtMapByActor");a(this,"content");a(this,"attributes");this.fromPos=r,this.toPos=s,this.maxCreatedAtMapByActor=i,this.content=o,this.attributes=c}static create(e,r,s,i,o,c,l){return new un(e,r,s,i,o,c,l)}execute(e,r,s){const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof Ie))throw new m(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const o=i,[,c,l]=o.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),this.maxCreatedAtMapByActor,s);for(const h of l)e.registerGCPair(h);return{opInfos:c.map(({from:h,to:f,value:g})=>({type:"edit",from:h,to:f,value:g,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),s=this.toPos.toTestString(),i=this.content;return`${e}.EDIT(${r},${s},${i})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class ln extends Pe{constructor(e,r,s,i,o,c){super(e,c);a(this,"fromPos");a(this,"toPos");a(this,"maxCreatedAtMapByActor");a(this,"attributes");this.fromPos=r,this.toPos=s,this.maxCreatedAtMapByActor=i,this.attributes=o}static create(e,r,s,i,o,c){return new ln(e,r,s,i,o,c)}execute(e,r,s){const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof Ie))throw new m(d.ErrInvalidArgument,"fail to execute, only Text can execute edit");const o=i,[,c,l]=o.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),this.maxCreatedAtMapByActor,s);for(const h of c)e.registerGCPair(h);return{opInfos:l.map(({from:h,to:f,value:g})=>({type:"style",from:h,to:f,value:g,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=this.fromPos.toTestString(),s=this.toPos.toTestString(),i=this.attributes;return`${e}.STYL(${r},${s},${JSON.stringify(i)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}const Uc=2,qc="root",Zt="text";function zr(n,t){let e=0;const r=n.children;for(let s=0;s<t;s++){const i=r[s];!i||i.isRemoved||(e+=i.paddedSize)}return e}class zc{constructor(t,e=[]){a(this,"type");a(this,"parent");a(this,"_children");a(this,"size");if(this.type=t,this.size=0,this._children=e,this.isText&&this._children.length>0)throw new m(d.ErrRefused,"Text node cannot have children")}updateAncestorsSize(){let t=this.parent;const e=this.isRemoved?-1:1;for(;t&&(t.size+=this.paddedSize*e,!t.isRemoved);)t=t.parent}updateDescendantsSize(){let t=0;for(const e of this._children){const r=e.updateDescendantsSize();e.isRemoved||(t+=r)}return this.size+=t,this.paddedSize}get isText(){return this.type===Zt}get paddedSize(){return this.size+(this.isText?0:Uc)}isAncestorOf(t){return Vc(this,t)}get nextSibling(){const t=this.parent.findOffset(this),e=this.parent.children[t+1];if(e)return e}get prevSibling(){const t=this.parent.findOffset(this),e=this.parent.children[t-1];if(e)return e}splitText(t,e){if(t===0||t===this.size)return;const r=this.value.slice(0,t),s=this.value.slice(t);if(!s.length)return;this.value=r;const i=this.cloneText(t+e);return i.value=s,this.parent.insertAfterInternal(i,this),i}get children(){return this._children.filter(t=>!t.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(t=>t.isText)}append(...t){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");this._children.push(...t);for(const e of t)e.parent=this,e.updateAncestorsSize()}prepend(...t){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");this._children.unshift(...t);for(const e of t)e.parent=this}insertBefore(t,e){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(e);if(r===-1)throw new m(d.ErrInvalidArgument,"child not found");this.insertAtInternal(t,r),t.updateAncestorsSize()}insertAfter(t,e){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(e);if(r===-1)throw new m(d.ErrInvalidArgument,"child not found");this.insertAtInternal(t,r+1),t.updateAncestorsSize()}insertAt(t,e){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");this.insertAtInternal(t,e),t.updateAncestorsSize()}removeChild(t){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");const e=this._children.indexOf(t);if(e===-1)throw new m(d.ErrInvalidArgument,"child not found");this._children.splice(e,1),t.parent=void 0}splitElement(t,e){const r=this.cloneElement(e);this.parent.insertAfterInternal(r,this),r.updateAncestorsSize();const s=this.children.slice(0,t),i=this.children.slice(t);this._children=s,r._children=i,this.size=this._children.reduce((o,c)=>o+c.paddedSize,0),r.size=r._children.reduce((o,c)=>o+c.paddedSize,0);for(const o of r._children)o.parent=r;return r}insertAfterInternal(t,e){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(e);if(r===-1)throw new m(d.ErrInvalidArgument,"child not found");this.insertAtInternal(t,r+1)}insertAtInternal(t,e){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");this._children.splice(e,0,t),t.parent=this}findOffset(t){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");if(t.isRemoved){const e=this._children.indexOf(t);return this.allChildren.splice(0,e).filter(s=>!s.isRemoved).length}return this.children.indexOf(t)}findBranchOffset(t){if(this.isText)throw new m(d.ErrRefused,"Text node cannot have children");let e=t;for(;e;){const r=this._children.indexOf(e);if(r!==-1)return r;e=e.parent}return-1}}function Vc(n,t){if(n===t)return!1;for(;t.parent;){if(t.parent===n)return!0;t=t.parent}return!1}var W=(n=>(n.Start="Start",n.End="End",n.Text="Text",n))(W||{});function Fo(n,t,e,r){if(t>e)throw new m(d.ErrInvalidArgument,`from is greater than to: ${t} > ${e}`);if(t>n.size)throw new m(d.ErrInvalidArgument,`from is out of range: ${t} > ${n.size}`);if(e>n.size)throw new m(d.ErrInvalidArgument,`to is out of range: ${e} > ${n.size}`);if(t===e)return;let s=0;for(const i of n.children){if(t-i.paddedSize<s&&s<e){const o=i.isText?t-s:t-s-1,c=i.isText?e-s:e-s-1,l=!i.isText&&o<0,h=!i.isText&&c>i.size;(i.isText||l)&&r([i,i.isText?"Text":"Start"],h),Fo(i,Math.max(0,o),Math.min(c,i.size),r),h&&r([i,"End"],h)}s+=i.paddedSize}}function Mo(n,t,e=0){for(const r of n.children)Mo(r,t,e+1);t(n,e)}function _n(n,t,e=0){for(const r of n._children)_n(r,t,e+1);t(n,e)}function Ls(n,t,e=!0){if(t>n.size)throw new m(d.ErrInvalidArgument,`index is out of range: ${t} > ${n.size}`);if(n.isText)return{node:n,offset:t};let r=0,s=0;for(const i of n.children){if(e&&i.isText&&i.size>=t-s)return Ls(i,t-s,e);if(t===s)return{node:n,offset:r};if(!e&&i.paddedSize===t-s)return{node:n,offset:r+1};if(i.paddedSize>t-s)return Ls(i,t-s-1,e);s+=i.paddedSize,r+=1}return{node:n,offset:r}}function $o(n){return n.isText||n.children.length===0?n:$o(n.children[0])}function Kc(n,t){if(n.size<t)throw new m(d.ErrInvalidArgument,"unacceptable path");for(let e=0;e<n.children.length;e++){const r=n.children[e];if(r.size<t)t-=r.size;else{n=r;break}}return{node:n,offset:t}}class jc{constructor(t){a(this,"root");this.root=t}tokensBetween(t,e,r){Fo(this.root,t,e,r)}traverse(t){Mo(this.root,t,0)}traverseAll(t){_n(this.root,t,0)}findTreePos(t,e=!0){return Ls(this.root,t,e)}treePosToPath(t){const e=[];let r=t.node;if(r.isText){const s=r.parent.findOffset(r);if(s===-1)throw new m(d.ErrInvalidArgument,"invalid treePos");const i=zr(r.parent,s);e.push(i+t.offset),r=r.parent}else if(r.hasTextChild()){const s=zr(r,t.offset);e.push(s)}else e.push(t.offset);for(;r.parent;){const s=r.parent.findOffset(r);if(s===-1)throw new m(d.ErrInvalidArgument,"invalid treePos");e.push(s),r=r.parent}return e.reverse()}pathToIndex(t){const e=this.pathToTreePos(t);return this.indexOf(e)}pathToTreePos(t){if(!t.length)throw new m(d.ErrInvalidArgument,"unacceptable path");let e=this.root;for(let r=0;r<t.length-1;r++){const s=t[r];if(e=e.children[s],!e)throw new m(d.ErrInvalidArgument,"unacceptable path")}if(e.hasTextChild())return Kc(e,t[t.length-1]);if(e.children.length<t[t.length-1])throw new m(d.ErrInvalidArgument,"unacceptable path");return{node:e,offset:t[t.length-1]}}getRoot(){return this.root}get size(){return this.root.size}findPostorderRight(t){const{node:e,offset:r}=t;if(e.isText){if(e.size===r){const s=e.nextSibling;return s||e.parent}return e}return e.children.length===r?e:$o(e.children[r])}indexOf(t){let{node:e}=t;const{offset:r}=t;let s=0,i=1;if(e.isText){s+=r;const o=e.parent,c=o.findOffset(e);if(c===-1)throw new m(d.ErrInvalidArgument,"invalid pos");s+=zr(o,c),e=e.parent}else s+=zr(e,r);for(;e!=null&&e.parent;){const o=e.parent,c=o.findOffset(e);if(c===-1)throw new m(d.ErrInvalidArgument,"invalid pos");s+=zr(o,c),i++,e=e.parent}return s+i-1}indexToPath(t){const e=this.findTreePos(t);return this.treePosToPath(e)}}const Gc=(n,t)=>n===t?0:n<t?-1:1;class Wc{constructor(t,e,r){a(this,"key");a(this,"value");a(this,"parent");a(this,"left");a(this,"right");a(this,"isRed");this.key=t,this.value=e,this.isRed=r}}class Hc{constructor(t){a(this,"stack");this.stack=[],this.traverseInorder(t)}traverseInorder(t){t&&(this.traverseInorder(t.left),this.stack.push({key:t.key,value:t.value}),this.traverseInorder(t.right))}}class Uo{constructor(t){a(this,"root");a(this,"comparator");a(this,"counter");this.comparator=typeof t<"u"?t:Gc,this.counter=0}put(t,e){return this.root=this.putInternal(t,e,this.root),this.root.isRed=!1,e}get(t){const e=this.getInternal(t,this.root);return e?e.value:void 0}remove(t){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,t),this.root&&(this.root.isRed=!1)}getIterator(){return new Hc(this.root)}values(){const t=[];for(const e of this.getIterator().stack)t.push(e.value);return t}floorEntry(t){let e=this.root;for(;e;){const r=this.comparator(t,e.key);if(r>0)if(e.right)e.right.parent=e,e=e.right;else return e;else if(r<0)if(e.left)e.left.parent=e,e=e.left;else{let s=e.parent,i=e;for(;s&&i===s.left;)i=s,s=s.parent;return s}else return e}}lastEntry(){if(!this.root)return this.root;let t=this.root;for(;t.right;)t=t.right;return t}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(t,e){for(;e;){const r=this.comparator(t,e.key);if(r===0)return e;r<0?e=e.left:r>0&&(e=e.right)}}putInternal(t,e,r){if(!r)return this.counter+=1,new Wc(t,e,!0);const s=this.comparator(t,r.key);return s<0?r.left=this.putInternal(t,e,r.left):s>0?r.right=this.putInternal(t,e,r.right):r.value=e,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(t,e){if(this.comparator(e,t.key)<0)!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.removeInternal(t.left,e);else{if(this.isRed(t.left)&&(t=this.rotateRight(t)),this.comparator(e,t.key)===0&&!t.right){this.counter-=1;return}if(!this.isRed(t.right)&&!this.isRed(t.right.left)&&(t=this.moveRedRight(t)),this.comparator(e,t.key)===0){this.counter-=1;const r=this.min(t.right);t.value=r.value,t.key=r.key,t.right=this.removeMin(t.right)}else t.right=this.removeInternal(t.right,e)}return this.fixUp(t)}min(t){return t.left?this.min(t.left):t}removeMin(t){if(t.left)return!this.isRed(t.left)&&!this.isRed(t.left.left)&&(t=this.moveRedLeft(t)),t.left=this.removeMin(t.left),this.fixUp(t)}fixUp(t){return this.isRed(t.right)&&(t=this.rotateLeft(t)),this.isRed(t.left)&&this.isRed(t.left.left)&&(t=this.rotateRight(t)),this.isRed(t.left)&&this.isRed(t.right)&&this.flipColors(t),t}moveRedLeft(t){return this.flipColors(t),this.isRed(t.right.left)&&(t.right=this.rotateRight(t.right),t=this.rotateLeft(t),this.flipColors(t)),t}moveRedRight(t){return this.flipColors(t),this.isRed(t.left.left)&&(t=this.rotateRight(t),this.flipColors(t)),t}isRed(t){return t&&t.isRed}rotateLeft(t){const e=t.right;return t.right=e.left,e.left=t,e.isRed=e.left.isRed,e.left.isRed=!0,e}rotateRight(t){const e=t.left;return t.left=e.right,e.right=t,e.isRed=e.right.isRed,e.right.isRed=!0,e}flipColors(t){t.isRed=!t.isRed,t.left.isRed=!t.left.isRed,t.right.isRed=!t.right.isRed}}class xe{constructor(t,e){a(this,"parentID");a(this,"leftSiblingID");this.parentID=t,this.leftSiblingID=e}static of(t,e){return new xe(t,e)}static fromTreePos(t){const{offset:e}=t;let{node:r}=t,s;return r.isText?(r.parent.children[0]===r&&e===0?s=r.parent:s=r,r=r.parent):e===0?s=r:s=r.children[e-1],xe.of(r.id,Z.of(s.getCreatedAt(),s.getOffset()+e))}getParentID(){return this.parentID}static fromStruct(t){return xe.of(Z.of(be.fromStruct(t.parentID.createdAt),t.parentID.offset),Z.of(be.fromStruct(t.leftSiblingID.createdAt),t.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(t){const e=this.getParentID(),r=this.getLeftSiblingID(),s=t.findFloorNode(e);let i=t.findFloorNode(r);if(!s||!i)throw new m(d.ErrRefused,`cannot find node of CRDTTreePos(${e.toTestString()}, ${r.toTestString()})`);return!r.equals(e)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=t.findFloorNode(i.insPrevID)),[s,i]}getLeftSiblingID(){return this.leftSiblingID}equals(t){return this.getParentID().getCreatedAt().equals(t.getParentID().getCreatedAt())&&this.getParentID().getOffset()===t.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(t.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===t.getLeftSiblingID().getOffset()}}class Z{constructor(t,e){a(this,"createdAt");a(this,"offset");this.createdAt=t,this.offset=e}static of(t,e){return new Z(t,e)}static fromStruct(t){return Z.of(be.fromStruct(t.createdAt),t.offset)}static createComparator(){return(t,e)=>{const r=t.getCreatedAt().compare(e.getCreatedAt());return r!==0?r:t.getOffset()>e.getOffset()?1:t.getOffset()<e.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(t){return this.createdAt.compare(t.createdAt)===0&&this.offset===t.offset}getOffset(){return this.offset}setOffset(t){this.offset=t}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class oe extends zc{constructor(e,r,s,i,o){super(r);a(this,"id");a(this,"removedAt");a(this,"attrs");a(this,"insPrevID");a(this,"insNextID");a(this,"_value","");this.id=e,this.removedAt=o,i&&(this.attrs=i),typeof s=="string"?this.value=s:Array.isArray(s)&&(this._children=s)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,r,s,i){return new oe(e,r,s,i)}deepcopy(){var r;const e=new oe(this.id,this.type);return e.removedAt=this.removedAt,e._value=this._value,e.size=this.size,e.attrs=(r=this.attrs)==null?void 0:r.deepcopy(),e._children=this._children.map(s=>{const i=s.deepcopy();return i.parent=e,i}),e.insPrevID=this.insPrevID,e.insNextID=this.insNextID,e}get value(){if(!this.isText)throw new m(d.ErrInvalidType,`cannot get value of element node: ${this.type}`);return this._value}set value(e){if(!this.isText)throw new m(d.ErrInvalidType,`cannot set value of element node: ${this.type}`);this._value=e,this.size=e.length}get isRemoved(){return!!this.removedAt}remove(e){const r=!this.removedAt;(!this.removedAt||this.removedAt.compare(e)>0)&&(this.removedAt=e),r&&this.updateAncestorsSize()}cloneText(e){return new oe(Z.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new oe(Z.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,r,s){const i=this.isText?this.splitText(r,this.id.getOffset()):this.splitElement(r,s);if(i){if(i.insPrevID=this.id,this.insNextID){const o=e.findFloorNode(this.insNextID);o.insPrevID=i.id,i.insNextID=this.insNextID}this.insNextID=i.id,e.registerNode(i)}return i}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,r,s){return(r?!this.getCreatedAt().after(r):this.getCreatedAt().getLamport()<=s)&&(!this.removedAt||e.after(this.removedAt))}canStyle(e,r,s){return this.isText?!1:(r?!this.getCreatedAt().after(r):this.getCreatedAt().getLamport()<=s)&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,r){this.attrs||(this.attrs=new er);const s=[];for(const[i,o]of Object.entries(e))s.push(this.attrs.set(i,o,r));return s}purge(e){this.attrs&&this.attrs.purge(e)}getGCPairs(){const e=[];if(!this.attrs)return e;for(const r of this.attrs)r.getRemovedAt()&&e.push({parent:this,child:r});return e}}function Js(n){var e;if(n.isText){const r=n;return{type:r.type,value:r.value}}const t={type:n.type,children:n.children.map(Js)};return n.attrs&&(t.attributes=Pr((e=n.attrs)==null?void 0:e.toObject())),t}function Ks(n){if(n.isText)return n.value;let t="";return n.attrs&&n.attrs.size()&&(t=" "+Array.from(n.attrs).filter(e=>!e.isRemoved()).sort((e,r)=>e.getKey().localeCompare(r.getKey())).map(e=>{const r=JSON.parse(e.getValue());return typeof r=="string"?`${e.getKey()}="${r}"`:`${e.getKey()}="${Ve(e.getValue())}"`}).join(" ")),`<${n.type}${t}>${n.children.map(e=>Ks(e)).join("")}</${n.type}>`}function qo(n){if(n.isText){const t=n;return{type:t.type,value:t.value,size:t.size,isRemoved:t.isRemoved}}return{type:n.type,children:n.children.map(qo),size:n.size,isRemoved:n.isRemoved}}class Se extends an{constructor(e,r){super(r);a(this,"indexTree");a(this,"nodeMapByID");this.indexTree=new jc(e),this.nodeMapByID=new Uo(Z.createComparator()),this.indexTree.traverseAll(s=>{this.nodeMapByID.put(s.id,s)})}static create(e,r){return new Se(e,r)}findFloorNode(e){const r=this.nodeMapByID.floorEntry(e);if(!(!r||!r.key.getCreatedAt().equals(e.getCreatedAt())))return r.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,r){const[s,i]=e.toTreeNodePair(this);let o=i;const c=s===o,l=o.parent&&!c?o.parent:s;if(o.isText&&o.split(this,e.getLeftSiblingID().getOffset()-o.id.getOffset()),r){const h=l.allChildren,f=c?0:h.indexOf(o)+1;for(let g=f;g<h.length;g++){const v=h[g];if(!v.id.getCreatedAt().after(r))break;o=v}}return[l,o]}style(e,r,s,i,o){const[c,l]=this.findNodesAndSplitText(e[0],s),[h,f]=this.findNodesAndSplitText(e[1],s),g=[],v=r?Pr(r):{},p=new Map,w=[];return this.traverseInPosRange(c,l,h,f,([b])=>{const E=b.getCreatedAt().getActorID();let C,P=0n;if(o===void 0&&i===void 0?P=Gr:o.size()>0?P=o.get(E)?o.get(E):0n:C=i.has(E)?i.get(E):Ne,b.canStyle(s,C,P)&&r){const L=p.get(E),Y=b.getCreatedAt();(!L||Y.after(L))&&p.set(E,Y);const D=b.setAttrs(r,s),F=D.reduce((ue,[,Ge])=>(Ge&&(ue[Ge.getKey()]=v[Ge.getKey()]),ue),{}),V=b.parent,K=b.prevSibling||b.parent;Object.keys(F).length>0&&g.push({type:"style",from:this.toIndex(V,K),to:this.toIndex(b,b),fromPath:this.toPath(V,K),toPath:this.toPath(b,b),actor:s.getActorID(),value:F});for(const[ue]of D)ue&&w.push({parent:b,child:ue})}}),[p,w,g]}removeStyle(e,r,s,i,o){const[c,l]=this.findNodesAndSplitText(e[0],s),[h,f]=this.findNodesAndSplitText(e[1],s),g=[],v=new Map,p=[];return this.traverseInPosRange(c,l,h,f,([w])=>{const b=w.getCreatedAt().getActorID();let E,C=0n;if(o===void 0&&i===void 0?C=Gr:o.size()>0?C=o.get(b)?o.get(b):0n:E=i.has(b)?i.get(b):Ne,w.canStyle(s,E,C)&&r){const P=v.get(b),L=w.getCreatedAt();(!P||L.after(P))&&v.set(b,L),w.attrs||(w.attrs=new er);for(const F of r){const V=w.attrs.remove(F,s);for(const K of V)p.push({parent:w,child:K})}const Y=w.parent,D=w.prevSibling||w.parent;g.push({actor:s.getActorID(),type:"removeStyle",from:this.toIndex(Y,D),to:this.toIndex(w,w),fromPath:this.toPath(Y,D),toPath:this.toPath(w,w),value:r})}}),[v,p,g]}edit(e,r,s,i,o,c,l){const[h,f]=this.findNodesAndSplitText(e[0],i),[g,v]=this.findNodesAndSplitText(e[1],i),p=this.toIndex(h,f),w=this.toPath(h,f),b=[],E=[],C=[],P=new Map;this.traverseInPosRange(h,f,g,v,([D,F],V)=>{if(F===W.Start&&!V)for(const Sr of D.children)C.push(Sr);const K=D.getCreatedAt().getActorID();let ue,Ge=0n;if(l===void 0&&c===void 0?Ge=Gr:l.size()>0?Ge=l.get(K)?l.get(K):0n:ue=c.has(K)?c.get(K):Ne,D.canDelete(i,ue,Ge)||b.includes(D.parent)){const Sr=P.get(K),oi=D.getCreatedAt();(!Sr||oi.after(Sr))&&P.set(K,oi),(F===W.Text||F===W.Start)&&b.push(D),E.push([D,F])}});const L=this.makeDeletionChanges(E,i),Y=[];for(const D of b)D.remove(i),D.isRemoved&&Y.push({parent:this,child:D});for(const D of C)D.removedAt||h.append(D);if(s>0){let D=0,F=h,V=f;for(;D<s;)F.split(this,F.findOffset(V)+1,o),V=F,F=F.parent,D++;L.push({type:"content",from:p,to:p,fromPath:w,toPath:w,actor:i.getActorID()})}if(r!=null&&r.length){const D=[];let F=f;for(const V of r)F===h?h.insertAt(V,0):h.insertAfter(V,F),F=V,_n(V,K=>{h.isRemoved&&(K.remove(i),Y.push({parent:this,child:K})),this.nodeMapByID.put(K.id,K)}),V.isRemoved||D.push(V);if(D.length){const V=D.map(K=>Js(K));L.length&&L[L.length-1].from===p?L[L.length-1].value=V:L.push({type:"content",from:p,to:p,fromPath:w,toPath:w,actor:i.getActorID(),value:V})}}return[L,Y,P]}editT(e,r,s,i,o){const c=this.findPos(e[0]),l=this.findPos(e[1]);this.edit([c,l],r,s,i,o)}move(e,r,s){throw new m(d.ErrUnimplemented,`not implemented: ${e}, ${r}, ${s}`)}purge(e){var i;(i=e.parent)==null||i.removeChild(e),this.nodeMapByID.remove(e.id);const r=e.insPrevID,s=e.insNextID;if(r){const o=this.findFloorNode(r);o.insNextID=s}if(s){const o=this.findFloorNode(s);o.insPrevID=r}e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){const e=[];return this.indexTree.traverse(r=>{r.getRemovedAt()&&e.push({parent:this,child:r});for(const s of r.getGCPairs())e.push(s)}),e}findPos(e,r=!0){const s=this.indexTree.findTreePos(e,r);return xe.fromTreePos(s)}pathToPosRange(e){const r=this.pathToIndex(e);return[this.findPos(r),this.findPos(r+1)]}pathToPos(e){const r=this.indexTree.pathToIndex(e);return this.findPos(r)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return Ks(this.indexTree.getRoot())}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const e=this.indexTree.getRoot(),r=(s,i=void 0,o=void 0,c=0)=>{var p,w,b,E;let l,h,f;const g=s.isText?{node:s,offset:0}:i&&o?this.toTreePos(i,o):null;g&&(l=this.indexTree.indexOf(g),h=this.indexTree.treePosToPath(g),f=xe.fromTreePos(g).toStruct());const v={type:s.type,parent:i==null?void 0:i.id.toTestString(),size:s.size,id:s.id.toTestString(),removedAt:(p=s.removedAt)==null?void 0:p.toTestString(),insPrev:(w=s.insPrevID)==null?void 0:w.toTestString(),insNext:(b=s.insNextID)==null?void 0:b.toTestString(),value:s.isText?s.value:void 0,isRemoved:s.isRemoved,children:[],depth:c,attributes:s.attrs?Pr((E=s.attrs)==null?void 0:E.toObject()):void 0,index:l,path:h,pos:f};for(let C=0;C<s.allChildren.length;C++){const P=C===0?s:s.allChildren[C-1];v.children.push(r(s.allChildren[C],s,P,c+1))}return v};return r(e)}getRootTreeNode(){return Js(this.indexTree.getRoot())}toTestTreeNode(){return qo(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const e=this.getRoot();return new Se(e.deepcopy(),this.getCreatedAt())}toPath(e,r){const s=this.toTreePos(e,r);return s?this.indexTree.treePosToPath(s):[]}toIndex(e,r){const s=this.toTreePos(e,r);return s?this.indexTree.indexOf(s):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){const r=this.findPos(e[0]);return e[0]===e[1]?[r,r]:[r,this.findPos(e[1])]}indexRangeToPosStructRange(e){const[r,s]=e,i=this.findPos(r);return r===s?[i.toStruct(),i.toStruct()]:[i.toStruct(),this.findPos(s).toStruct()]}posRangeToPathRange(e){const[r,s]=this.findNodesAndSplitText(e[0]),[i,o]=this.findNodesAndSplitText(e[1]);return[this.toPath(r,s),this.toPath(i,o)]}posRangeToIndexRange(e){const[r,s]=this.findNodesAndSplitText(e[0]),[i,o]=this.findNodesAndSplitText(e[1]);return[this.toIndex(r,s),this.toIndex(i,o)]}traverseInPosRange(e,r,s,i,o){const c=this.toIndex(e,r),l=this.toIndex(s,i);return this.indexTree.tokensBetween(c,l,o)}toTreePos(e,r){if(!e||!r)return;if(e.isRemoved){let i;for(;e.isRemoved;)i=e,e=i.parent;const o=e.findOffset(i);return{node:e,offset:o}}if(e===r)return{node:e,offset:0};let s=e.findOffset(r);if(!r.isRemoved){if(r.isText)return{node:r,offset:r.paddedSize};s++}return{node:e,offset:s}}makeDeletionChanges(e,r){const s=[],i=[];let o=null,c=null;for(let l=0;l<e.length;l++){const h=e[l],f=e[l+1];o||(o=h),c=h;const g=this.findRightToken(h);(!g||!f||g[0]!==f[0]||g[1]!==f[1])&&(i.push([o,c]),o=null,c=null)}for(const l of i){const[h,f]=l,[g,v]=this.findLeftToken(h),[p,w]=f,b=v===W.Start?g:g.parent,E=w===W.Start?p:p.parent,C=this.toIndex(b,g),P=this.toIndex(E,p);C<P&&(s.length>0&&C===s[s.length-1].to?(s[s.length-1].to=P,s[s.length-1].toPath=this.toPath(E,p)):s.push({type:"content",from:C,to:P,fromPath:this.toPath(b,g),toPath:this.toPath(E,p),actor:r.getActorID()}))}return s.reverse()}findRightToken([e,r]){if(r===W.Start){const l=e.allChildren;return l.length>0?[l[0],l[0].isText?W.Text:W.Start]:[e,W.End]}const s=e.parent,i=s.allChildren,o=i.indexOf(e);if(s&&o===i.length-1)return[s,W.End];const c=i[o+1];return[c,c.isText?W.Text:W.Start]}findLeftToken([e,r]){if(r===W.End){const l=e.allChildren;if(l.length>0){const h=l[l.length-1];return[h,h.isText?W.Text:W.End]}return[e,W.Start]}const s=e.parent,i=s.allChildren,o=i.indexOf(e);if(s&&o===0)return[s,W.Start];const c=i[o-1];return[c,c.isText?W.Text:W.End]}}class hn extends Pe{constructor(e,r,s,i,o,c,l){super(e,l);a(this,"fromPos");a(this,"toPos");a(this,"contents");a(this,"splitLevel");a(this,"maxCreatedAtMapByActor");this.fromPos=r,this.toPos=s,this.contents=i,this.splitLevel=o,this.maxCreatedAtMapByActor=c}static create(e,r,s,i,o,c,l){return new hn(e,r,s,i,o,c,l)}execute(e,r,s){var f;const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof Se))throw new m(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const o=this.getExecutedAt(),c=i,[l,h]=c.edit([this.fromPos,this.toPos],(f=this.contents)==null?void 0:f.map(g=>g.deepcopy()),this.splitLevel,o,(()=>{let g=o.getDelimiter();return this.contents!==void 0&&(g+=this.contents.length),()=>be.of(o.getLamport(),++g,o.getActorID())})(),this.maxCreatedAtMapByActor,s);for(const g of h)e.registerGCPair(g);return{opInfos:l.map(({from:g,to:v,value:p,splitLevel:w,fromPath:b,toPath:E})=>({type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:g,to:v,value:p,splitLevel:w,fromPath:b,toPath:E}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,s=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,i=this.contents||[];return`${e}.EDIT(${r},${s},${i.map(o=>Ks(o)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}class Dr{constructor(t){a(this,"vector");this.vector=t||new Map}set(t,e){this.vector.set(t,e)}unset(t){this.vector.delete(t)}get(t){return this.vector.get(t)}maxLamport(){let t=BigInt(0);for(const[,e]of this)e>t&&(t=e);return t}max(t){const e=new Map;for(const[r,s]of t){const i=this.vector.get(r),o=i&&i>s?i:s;e.set(r,o)}for(const[r,s]of this){const i=t.get(r),o=i&&i>s?i:s;e.set(r,o)}return new Dr(e)}afterOrEqual(t){const e=this.vector.get(t.getActorID());return e===void 0?!1:e>=t.getLamport()}deepcopy(){const t=new Map;for(const[e,r]of this.vector)t.set(e,r);return new Dr(t)}filter(t){const e=new Map;for(const[r]of t){const s=this.vector.get(r);s!==void 0&&e.set(r,s)}return new Dr(e)}size(){return this.vector.size}*[Symbol.iterator](){for(const[t,e]of this.vector)yield[t,e]}}const Yc=new Dr(new Map);class Gt{constructor(t,e,r,s,i){a(this,"clientSeq");a(this,"serverSeq");a(this,"lamport");a(this,"actor");a(this,"versionVector");this.clientSeq=t,this.serverSeq=i,this.lamport=e,this.versionVector=s,this.actor=r}static of(t,e,r,s,i){return new Gt(t,e,r,s,i)}next(){const t=this.versionVector.deepcopy();return t.set(this.actor,this.lamport+1n),new Gt(this.clientSeq+1,this.lamport+1n,this.actor,t)}syncClocks(t){const e=t.lamport>this.lamport?t.lamport+1n:this.lamport+1n;let r=t.versionVector;r.size()===0&&(r=r.deepcopy(),r.set(t.actor,t.lamport));const s=this.versionVector.max(r),i=new Gt(this.clientSeq,e,this.actor,s);return i.versionVector.set(this.actor,e),i}setClocks(t,e){const r=t>this.lamport?t+1n:this.lamport+1n;e.unset(Qn);const s=this.versionVector.max(e);return s.set(this.actor,r),Gt.of(this.clientSeq,r,this.actor,s)}createTimeTicket(t){return be.of(this.lamport,t,this.actor)}setActor(t){return new Gt(this.clientSeq,this.lamport,t,this.versionVector,this.serverSeq)}setVersionVector(t){return new Gt(this.clientSeq,this.lamport,this.actor,t,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}getVersionVector(){return this.versionVector}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const Xc=new Gt(0,0n,Qn,Yc);class Mr{constructor({id:t,operations:e,presenceChange:r,message:s}){a(this,"id");a(this,"operations");a(this,"presenceChange");a(this,"message");this.id=t,this.operations=e||[],this.presenceChange=r,this.message=s}static create({id:t,operations:e,presenceChange:r,message:s}){return new Mr({id:t,operations:e,presenceChange:r,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(t){for(const e of this.operations)e.setActor(t);this.id=this.id.setActor(t)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(t,e,r){const s=[],i=[];for(const o of this.operations){const c=o.execute(t,r,this.id.getVersionVector());if(!c)continue;const{opInfos:l,reverseOp:h}=c;s.push(...l),h&&i.unshift(h)}return this.presenceChange&&(this.presenceChange.type===hr.Put?e.set(this.id.getActorID(),ke(this.presenceChange.presence)):e.delete(this.id.getActorID())),{opInfos:s,reverseOps:i}}toTestString(){return`${this.operations.map(t=>t.toTestString()).join(",")}`}toStruct(){return{changeID:j.bytesToHex(j.toChangeID(this.getID()).toBinary()),message:this.getMessage(),operations:this.getOperations().map(t=>j.bytesToHex(j.toOperation(t).toBinary())),presenceChange:this.getPresenceChange()}}static fromStruct(t){const{changeID:e,operations:r,presenceChange:s,message:i}=t;return Mr.create({id:j.bytesToChangeID(j.hexToBytes(e)),operations:r==null?void 0:r.map(o=>j.bytesToOperation(j.hexToBytes(o))),presenceChange:s,message:i})}}class es{constructor(t,e,r,s,i,o,c){a(this,"documentKey");a(this,"checkpoint");a(this,"isRemoved");a(this,"changes");a(this,"snapshot");a(this,"minSyncedTicket");a(this,"versionVector");this.documentKey=t,this.checkpoint=e,this.isRemoved=r,this.changes=s,this.snapshot=o,this.minSyncedTicket=c,this.versionVector=i}static create(t,e,r,s,i,o,c){return new es(t,e,r,s,i,o,c)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getMinSyncedTicket(){return this.minSyncedTicket}getVersionVector(){return this.versionVector}}class Or{constructor(t,e){a(this,"serverSeq");a(this,"clientSeq");this.serverSeq=t,this.clientSeq=e}static of(t,e){return new Or(t,e)}increaseClientSeq(t){return t===0?this:new Or(this.serverSeq,this.clientSeq+t)}forward(t){if(this.equals(t))return this;const e=this.serverSeq>t.serverSeq?this.serverSeq:t.serverSeq,r=Math.max(this.clientSeq,t.clientSeq);return Or.of(e,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(t){return this.clientSeq===t.clientSeq&&this.serverSeq==t.serverSeq}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const Zc=new Or(0n,0);class Ke{constructor(t,e){a(this,"createdAt");a(this,"offset");this.createdAt=t,this.offset=e}static of(t,e){return new Ke(t,e)}static fromStruct(t){return Ke.of(be.fromStruct(t.createdAt),t.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(t){return this.createdAt.compare(t.createdAt)===0&&this.offset===t.offset}hasSameCreatedAt(t){return this.createdAt.compare(t.createdAt)===0}split(t){return new Ke(this.createdAt,this.offset+t)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const Qc=Ke.of(Ne,0);class Ce{constructor(t,e){a(this,"id");a(this,"relativeOffset");this.id=t,this.relativeOffset=e}static of(t,e){return new Ce(t,e)}static fromStruct(t){const e=Ke.fromStruct(t.id);return Ce.of(e,t.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return Ke.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(t){return this.id.equals(t.id)?this.relativeOffset===t.relativeOffset:!1}}class ur extends Oo{constructor(e,r,s){super(r);a(this,"id");a(this,"removedAt");a(this,"prev");a(this,"next");a(this,"insPrev");a(this,"insNext");this.id=e,this.removedAt=s}static create(e,r){return new ur(e,r)}static createComparator(){return(e,r)=>{const s=e.getCreatedAt().compare(r.getCreatedAt());return s!==0?s:e.getOffset()>r.getOffset()?1:e.getOffset()<r.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new ur(this.id.split(e),this.splitValue(e),this.removedAt)}canDelete(e,r,s){const i=!this.removedAt;return(r?!this.getCreatedAt().after(r):this.getCreatedAt().getLamport()<=s)&&(!this.removedAt||e.after(this.removedAt))?i:!1}canStyle(e,r,s){return(r?!this.getCreatedAt().after(r):this.getCreatedAt().getLamport()<=s)&&(!this.removedAt||e.after(this.removedAt))}remove(e){this.removedAt=e}createPosRange(){return[Ce.of(this.id,0),Ce.of(this.id,this.getLength())]}deepcopy(){return new ur(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(e){const r=this.value;return this.value=r.substring(0,e),r.substring(e,r.length)}toIDString(){return this.id.toIDString()}}class $r{constructor(){a(this,"head");a(this,"treeByIndex");a(this,"treeByID");this.head=ur.create(Qc),this.treeByIndex=new en,this.treeByID=new Uo(ur.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new $r}edit(t,e,r,s,i){const[o,c]=this.findNodeWithSplit(t[1],e),[l,h]=this.findNodeWithSplit(t[0],e),f=this.findBetween(h,c),[g,v,p]=this.deleteNodes(f,e,s,i),w=c?c.getID():o.getID();let b=Ce.of(w,0);if(r){const C=this.posToIndex(l.createPosRange()[1],!0),P=this.insertAfter(l,ur.create(Ke.of(e,0),r));g.length&&g[g.length-1].from===C?g[g.length-1].value=r:g.push({actor:e.getActorID(),from:C,to:C,value:r}),b=Ce.of(P.getID(),P.getContentLength())}const E=[];for(const[,C]of p)E.push({parent:this,child:C});return[b,v,E,g]}indexToPos(t){const[e,r]=this.treeByIndex.find(t),s=e;return Ce.of(s.getID(),r)}findIndexesFromRange(t){const[e,r]=t;return[this.posToIndex(e,!1),this.posToIndex(r,!0)]}posToIndex(t,e){const r=t.getAbsoluteID(),s=e?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!s)throw new m(d.ErrInvalidArgument,`the node of the given id should be found: ${r.toTestString()}`);const i=this.treeByIndex.indexOf(s),o=s.isRemoved()?0:r.getOffset()-s.getID().getOffset();return i+o}findNode(t){return this.findFloorNode(t)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const t=[];for(const e of this)e.isRemoved()||t.push(e.getValue());return t.join("")}*[Symbol.iterator](){let t=this.head.getNext();for(;t;)yield t,t=t.getNext()}getHead(){return this.head}deepcopy(){const t=new $r;let e=this.head.getNext(),r=t.head,s;for(;e;){if(s=t.insertAfter(r,e.deepcopy()),e.hasInsPrev()){const i=t.findNode(e.getInsPrevID());s.setInsPrev(i)}r=s,e=e.getNext()}return t}toTestString(){const t=[];let e=this.head;for(;e;)e.isRemoved()?t.push(`{${e.toTestString()}}`):t.push(`[${e.toTestString()}]`),e=e.getNext();return t.join("")}insertAfter(t,e){const r=t.getNext();return e.setPrev(t),r&&r.setPrev(e),this.treeByID.put(e.getID(),e),this.treeByIndex.insertAfter(t,e),e}findNodeWithSplit(t,e){const r=t.getAbsoluteID();let s=this.findFloorNodePreferToLeft(r);const i=r.getOffset()-s.getID().getOffset();for(this.splitNode(s,i);s.hasNext()&&s.getNext().getCreatedAt().after(e);)s=s.getNext();return[s,s.getNext()]}findFloorNodePreferToLeft(t){let e=this.findFloorNode(t);if(!e)throw new m(d.ErrInvalidArgument,`the node of the given id should be found: ${t.toTestString()}`);if(t.getOffset()>0&&e.getID().getOffset()==t.getOffset()){if(!e.hasInsPrev())return e;e=e.getInsPrev()}return e}findFloorNode(t){const e=this.treeByID.floorEntry(t);if(e&&!(!e.key.equals(t)&&!e.key.hasSameCreatedAt(t)))return e.value}findBetween(t,e){const r=[];let s=t;for(;s&&s!==e;)r.push(s),s=s.getNext();return r}splitNode(t,e){if(e>t.getContentLength())throw new m(d.ErrInvalidArgument,"offset should be less than or equal to length");if(e===0)return t;if(e===t.getContentLength())return t.getNext();const r=t.split(e);this.treeByIndex.updateWeight(r),this.insertAfter(t,r);const s=t.getInsNext();return s&&s.setInsPrev(r),r.setInsPrev(t),r}deleteNodes(t,e,r,s){if(!t.length)return[[],new Map,new Map];const[i,o]=this.filterNodes(t,e,r,s),c=new Map,l=new Map,h=this.makeChanges(o,e);for(const f of i){const g=f.getCreatedAt().getActorID();(!c.has(g)||f.getID().getCreatedAt().after(c.get(g)))&&c.set(g,f.getID().getCreatedAt()),l.set(f.getID().toIDString(),f),f.remove(e)}return this.deleteIndexNodes(o),[h,c,l]}filterNodes(t,e,r,s){const i=[],o=[],[c,l]=this.findEdgesOfCandidates(t);o.push(c);for(const h of t){const f=h.getCreatedAt().getActorID();let g,v=0n;s===void 0&&r===void 0?v=Gr:s.size()>0?v=s.get(f)?s.get(f):0n:g=r.has(f)?r.get(f):Ne,h.canDelete(e,g,v)?i.push(h):o.push(h)}return o.push(l),[i,o]}findEdgesOfCandidates(t){return[t[0].getPrev(),t[t.length-1].getNext()]}makeChanges(t,e){const r=[];let s,i;for(let o=0;o<t.length-1;o++){const c=t[o],l=t[o+1];c.getNext()!=l&&([s]=this.findIndexesFromRange(c.getNext().createPosRange()),l?[,i]=this.findIndexesFromRange(l.getPrev().createPosRange()):i=this.treeByIndex.length,s<i&&r.push({actor:e.getActorID(),from:s,to:i}))}return r.reverse()}deleteIndexNodes(t){for(let e=0;e<t.length-1;e++){const r=t[e],s=t[e+1];r.getNext()!=s&&this.treeByIndex.deleteRange(r,s)}}purge(t){this.treeByIndex.delete(t),this.treeByID.remove(t.getID());const e=t.getPrev(),r=t.getNext(),s=t.getInsPrev(),i=t.getInsNext();e&&e.setNext(r),r&&r.setPrev(e),t.setPrev(void 0),t.setNext(void 0),s&&s.setInsNext(i),i&&i.setInsPrev(s),t.setInsPrev(void 0),t.setInsNext(void 0)}}const Vi=n=>n<0?Math.ceil(n):Math.floor(n);var je=(n=>(n[n.IntegerCnt=0]="IntegerCnt",n[n.LongCnt=1]="LongCnt",n))(je||{});class ce extends an{constructor(e,r,s){super(s);a(this,"valueType");a(this,"value");switch(this.valueType=e,e){case 0:typeof r=="number"?r>Math.pow(2,31)-1||r<-Math.pow(2,31)?this.value=O.fromNumber(r).toInt():this.value=Vi(r):this.value=r.toInt();break;case 1:typeof r=="number"?this.value=O.fromNumber(r):this.value=r;break;default:throw new m(d.ErrUnimplemented,`unimplemented type: ${e}`)}}static create(e,r,s){return new ce(e,r,s)}static valueFromBytes(e,r){switch(e){case 0:return r[0]|r[1]<<8|r[2]<<16|r[3]<<24;case 1:return O.fromBytesLE(Array.from(r));default:throw new m(d.ErrUnimplemented,`unimplemented type: ${e}`)}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const e=ce.create(this.valueType,this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":return e instanceof O?1:void 0;case"number":return e>Math.pow(2,31)-1||e<-Math.pow(2,31)?1:0;default:return}}static isSupport(e){return!!ce.getCounterType(e)}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===0||e===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 1:{const r=this.value.toBytesLE();return Uint8Array.from(r)}default:throw new m(d.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(e){function r(s){if(!s.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof s.getValue()}`)}return r(this),r(e),this.valueType===1?this.value=this.value.add(e.getValue()):e.getType()===H.Long?this.value=this.value+e.getValue().toInt():this.value=O.fromNumber(this.value+Vi(e.getValue())).toInt(),this}}class Ur extends Pe{constructor(e,r,s){super(e,s);a(this,"value");this.value=r}static create(e,r,s){return new Ur(e,r,s)}execute(e){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ce))throw new m(d.ErrInvalidArgument,"fail to execute, only Counter can execute increase");const s=r,i=this.value.deepcopy();return s.increase(i),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:i.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const e=this.value.deepcopy(),s=e.getType()===H.Long?e.getValue().multiply(-1):e.getValue()*-1;return Ur.create(this.getParentCreatedAt(),z.of(s,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class Qt extends Pe{constructor(e,r,s,i,o,c,l){super(e,l);a(this,"fromPos");a(this,"toPos");a(this,"maxCreatedAtMapByActor");a(this,"attributes");a(this,"attributesToRemove");this.fromPos=r,this.toPos=s,this.maxCreatedAtMapByActor=i,this.attributes=o,this.attributesToRemove=c}static create(e,r,s,i,o,c){return new Qt(e,r,s,i,o,[],c)}static createTreeRemoveStyleOperation(e,r,s,i,o,c){return new Qt(e,r,s,i,new Map,o,c)}execute(e,r,s){const i=e.findByCreatedAt(this.getParentCreatedAt());if(!i)throw new m(d.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(i instanceof Se))throw new m(d.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const o=i;let c,l;if(this.attributes.size){const h={};[...this.attributes].forEach(([f,g])=>h[f]=g),[,l,c]=o.style([this.fromPos,this.toPos],h,this.getExecutedAt(),this.maxCreatedAtMapByActor,s)}else{const h=this.attributesToRemove;[,l,c]=o.removeStyle([this.fromPos,this.toPos],h,this.getExecutedAt(),this.maxCreatedAtMapByActor,s)}for(const h of l)e.registerGCPair(h);return{opInfos:c.map(({from:h,to:f,value:g,fromPath:v,toPath:p})=>({type:"tree-style",from:h,to:f,value:this.attributes.size?{attributes:g}:{attributesToRemove:g},fromPath:v,toPath:p,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),r=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,s=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${e}.STYLE(${r},${s},${Object.entries(this.attributes||{}).map(([i,o])=>`${i}:"${o}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}getMaxCreatedAtMapByActor(){return this.maxCreatedAtMapByActor}}function _c(n){const t=new qs,e=t.data;for(const[r,s]of Object.entries(n))e[r]=JSON.stringify(s);return t}function eu(n){if(n.type===hr.Put)return new Qr({type:Ar.PUT,presence:_c(n.presence)});if(n.type===hr.Clear)return new Qr({type:Ar.CLEAR});throw new m(d.ErrUnimplemented,"unimplemented type")}function tu(n){return new Co({serverSeq:n.getServerSeq(),clientSeq:n.getClientSeq()})}function zo(n){return new Xn({clientSeq:n.getClientSeq(),lamport:n.getLamport(),actorId:ti(n.getActorID()),versionVector:js(n.getVersionVector())})}function S(n){if(n)return new I({lamport:n.getLamport(),delimiter:n.getDelimiter(),actorId:ti(n.getActorID())})}function js(n){if(!n)return;const t=new Zn;for(const[e,r]of n)t.vector[e]=BigInt(r.toString());return t}function Vo(n){switch(n){case H.Null:return N.NULL;case H.Boolean:return N.BOOLEAN;case H.Integer:return N.INTEGER;case H.Long:return N.LONG;case H.Double:return N.DOUBLE;case H.String:return N.STRING;case H.Bytes:return N.BYTES;case H.Date:return N.DATE;default:throw new m(d.ErrInvalidType,`unsupported type: ${n}`)}}function Ko(n){switch(n){case je.IntegerCnt:return N.INTEGER_CNT;case je.LongCnt:return N.LONG_CNT;default:throw new m(d.ErrInvalidType,`unsupported type: ${n}`)}}function os(n){if(n instanceof ne)return new le({type:N.JSON_OBJECT,createdAt:S(n.getCreatedAt()),value:na(n)});if(n instanceof ae)return new le({type:N.JSON_ARRAY,createdAt:S(n.getCreatedAt()),value:Ou(n)});if(n instanceof Ie)return new le({type:N.TEXT,createdAt:S(n.getCreatedAt())});if(n instanceof z)return new le({type:Vo(n.getType()),createdAt:S(n.getCreatedAt()),value:n.toBytes()});if(n instanceof ce)return new le({type:Ko(n.getType()),createdAt:S(n.getCreatedAt()),value:n.toBytes()});if(n instanceof Se)return new le({type:N.TREE,createdAt:S(n.getCreatedAt()),value:Ru(n)});throw new m(d.ErrUnimplemented,"unimplemented element")}function ru(n){return new Xr({createdAt:S(n.getCreatedAt()),offset:n.getOffset()})}function dn(n){return new _t({createdAt:S(n.getID().getCreatedAt()),offset:n.getID().getOffset(),relativeOffset:n.getRelativeOffset()})}function gn(n){return new Tr({parentId:Wr(n.getParentID()),leftSiblingId:Wr(n.getLeftSiblingID())})}function Wr(n){return new ar({createdAt:S(n.getCreatedAt()),offset:n.getOffset()})}function jo(n){const t=new Us;if(n instanceof br){const e=n,r=new xn;r.parentCreatedAt=S(e.getParentCreatedAt()),r.key=e.getKey(),r.value=os(e.getValue()),r.executedAt=S(e.getExecutedAt()),t.body.case="set",t.body.value=r}else if(n instanceof cn){const e=n,r=new Nn;r.parentCreatedAt=S(e.getParentCreatedAt()),r.prevCreatedAt=S(e.getPrevCreatedAt()),r.value=os(e.getValue()),r.executedAt=S(e.getExecutedAt()),t.body.case="add",t.body.value=r}else if(n instanceof or){const e=n,r=new Cn;r.parentCreatedAt=S(e.getParentCreatedAt()),r.prevCreatedAt=S(e.getPrevCreatedAt()),r.createdAt=S(e.getCreatedAt()),r.executedAt=S(e.getExecutedAt()),t.body.case="move",t.body.value=r}else if(n instanceof fr){const e=n,r=new Pn;r.parentCreatedAt=S(e.getParentCreatedAt()),r.createdAt=S(e.getCreatedAt()),r.executedAt=S(e.getExecutedAt()),t.body.case="remove",t.body.value=r}else if(n instanceof un){const e=n,r=new Dn;r.parentCreatedAt=S(e.getParentCreatedAt()),r.from=dn(e.getFromPos()),r.to=dn(e.getToPos());const s=r.createdAtMapByActor;for(const[o,c]of e.getMaxCreatedAtMapByActor())s[o]=S(c);r.content=e.getContent();const i=r.attributes;for(const[o,c]of e.getAttributes())i[o]=c;r.executedAt=S(e.getExecutedAt()),t.body.case="edit",t.body.value=r}else if(n instanceof ln){const e=n,r=new On;r.parentCreatedAt=S(e.getParentCreatedAt()),r.from=dn(e.getFromPos()),r.to=dn(e.getToPos());const s=r.createdAtMapByActor;for(const[o,c]of e.getMaxCreatedAtMapByActor())s[o]=S(c);const i=r.attributes;for(const[o,c]of e.getAttributes())i[o]=c;r.executedAt=S(e.getExecutedAt()),t.body.case="style",t.body.value=r}else if(n instanceof Ur){const e=n,r=new Bn;r.parentCreatedAt=S(e.getParentCreatedAt()),r.value=os(e.getValue()),r.executedAt=S(e.getExecutedAt()),t.body.case="increase",t.body.value=r}else if(n instanceof hn){const e=n,r=new Rn,s=r.createdAtMapByActor;for(const[i,o]of e.getMaxCreatedAtMapByActor())s[i]=S(o);r.parentCreatedAt=S(e.getParentCreatedAt()),r.from=gn(e.getFromPos()),r.to=gn(e.getToPos()),r.contents=uu(e.getContents()),r.splitLevel=e.getSplitLevel(),r.executedAt=S(e.getExecutedAt()),t.body.case="treeEdit",t.body.value=r}else if(n instanceof Qt){const e=n,r=new Ln;r.parentCreatedAt=S(e.getParentCreatedAt()),r.from=gn(e.getFromPos()),r.to=gn(e.getToPos());const s=r.createdAtMapByActor;for(const[o,c]of e.getMaxCreatedAtMapByActor())s[o]=S(c);const i=e.getAttributesToRemove();if(i.length>0)r.attributesToRemove=i;else{const o=r.attributes;for(const[c,l]of e.getAttributes())o[c]=l}r.executedAt=S(e.getExecutedAt()),t.body.case="treeStyle",t.body.value=r}else throw new m(d.ErrUnimplemented,"unimplemented operation");return t}function nu(n){const t=[];for(const e of n)t.push(jo(e));return t}function su(n){const t=new xo({id:zo(n.getID()),message:n.getMessage()});return n.hasOperations()&&(t.operations=nu(n.getOperations())),n.hasPresenceChange()&&(t.presenceChange=eu(n.getPresenceChange())),t}function iu(n){const t=[];for(const e of n)t.push(su(e));return t}function ou(n){const t=[];for(const e of n)t.push(new No({key:e.getStrKey(),element:Ws(e.getValue())}));return t}function au(n){const t=[];for(const e of n)t.push(new zn({element:Ws(e.getValue())}));return t}function cu(n){const t=[];for(const e of n){const r=new Vn;r.id=ru(e.getID()),r.value=e.getValue().getContent(),r.removedAt=S(e.getRemovedAt());const s=r.attributes,i=e.getValue().getAttrs();for(const o of i){const c=new Lr;c.value=o.getValue(),c.updatedAt=S(o.getUpdatedAt()),s[o.getKey()]=c}t.push(r)}return t}function uu(n){const t=[];if(!n||!n.length)return t;for(const e of n)t.push(new Kn({content:Gs(e)}));return t}function lu(n){const t={};for(const e of n)t[e.getKey()]=new Lr({value:e.getValue(),updatedAt:S(e.getUpdatedAt()),isRemoved:e.isRemoved()});return t}function Gs(n){if(!n)return[];const t=[];return _n(n,(e,r)=>{const s=new Zr({id:Wr(e.id),type:e.type,removedAt:S(e.removedAt),depth:r});e.isText&&(s.value=e.value),e.insPrevID&&(s.insPrevId=Wr(e.insPrevID)),e.insNextID&&(s.insNextId=Wr(e.insNextID)),e.attrs&&(s.attributes=lu(e.attrs)),t.push(s)}),t}function hu(n){const t=new se;return t.body.case="jsonObject",t.body.value=new Jn({nodes:ou(n.getRHT()),createdAt:S(n.getCreatedAt()),movedAt:S(n.getMovedAt()),removedAt:S(n.getRemovedAt())}),t}function Go(n){const t=new se;return t.body.case="jsonArray",t.body.value=new Fn({nodes:au(n.getElements()),createdAt:S(n.getCreatedAt()),movedAt:S(n.getMovedAt()),removedAt:S(n.getRemovedAt())}),t}function fu(n){const t=new se;return t.body.case="primitive",t.body.value=new Mn({type:Vo(n.getType()),value:n.toBytes(),createdAt:S(n.getCreatedAt()),movedAt:S(n.getMovedAt()),removedAt:S(n.getRemovedAt())}),t}function du(n){const t=new se;return t.body.case="text",t.body.value=new $n({nodes:cu(n.getRGATreeSplit()),createdAt:S(n.getCreatedAt()),movedAt:S(n.getMovedAt()),removedAt:S(n.getRemovedAt())}),t}function gu(n){const t=new se;return t.body.case="counter",t.body.value=new Un({type:Ko(n.getType()),value:n.toBytes(),createdAt:S(n.getCreatedAt()),movedAt:S(n.getMovedAt()),removedAt:S(n.getRemovedAt())}),t}function Wo(n){const t=new se;return t.body.case="tree",t.body.value=new qn({nodes:Gs(n.getRoot()),createdAt:S(n.getCreatedAt()),movedAt:S(n.getMovedAt()),removedAt:S(n.getRemovedAt())}),t}function Ws(n){if(n instanceof ne)return hu(n);if(n instanceof ae)return Go(n);if(n instanceof z)return fu(n);if(n instanceof Ie)return du(n);if(n instanceof ce)return gu(n);if(n instanceof Se)return Wo(n);throw new m(d.ErrUnimplemented,"unimplemented element")}function mu(n){return new tr({documentKey:n.getDocumentKey(),checkpoint:tu(n.getCheckpoint()),isRemoved:n.getIsRemoved(),changes:iu(n.getChanges()),snapshot:n.getSnapshot(),versionVector:js(n.getVersionVector()),minSyncedTicket:S(n.getMinSyncedTicket())})}function Vr(n){if(!(n instanceof M))return{};const t=n.findDetails(Bc);for(const e of t)return e.metadata;return{}}function nr(n){return Vr(n).code??""}function Ho(n){return Gt.of(n.clientSeq,BigInt(n.lamport),_s(n.actorId),Hs(n.versionVector),BigInt(n.serverSeq))}function Hs(n){if(!n)return;const t=new Dr;return Object.entries(n.vector).forEach(([e,r])=>{t.set(e,BigInt(r.toString()))}),t}function k(n){if(n)return be.of(BigInt(n.lamport),n.delimiter,_s(n.actorId))}function Ys(n){const t={};return Object.entries(n.data).forEach(([e,r])=>{t[e]=JSON.parse(r)}),t}function pu(n){const t=n.type;if(t===Ar.PUT){const e=Ys(n.presence);return{type:hr.Put,presence:e}}if(t===Ar.CLEAR)return{type:hr.Clear};throw new m(d.ErrInvalidType,`unsupported type: ${t}`)}function yu(n){const t=new Map;return Object.entries(n).forEach(([e,r])=>{t.set(e,Ys(r))}),t}function Yo(n){switch(n){case N.NULL:return H.Null;case N.BOOLEAN:return H.Boolean;case N.INTEGER:return H.Integer;case N.LONG:return H.Long;case N.DOUBLE:return H.Double;case N.STRING:return H.String;case N.BYTES:return H.Bytes;case N.DATE:return H.Date}throw new m(d.ErrUnimplemented,`unimplemented value type: ${n}`)}function Wn(n){switch(n){case N.INTEGER_CNT:return je.IntegerCnt;case N.LONG_CNT:return je.LongCnt}throw new m(d.ErrUnimplemented,`unimplemented value type: ${n}`)}function as(n){switch(n.type){case N.JSON_OBJECT:return n.value?ra(n.value):ne.create(k(n.createdAt));case N.JSON_ARRAY:return n.value?Du(n.value):ae.create(k(n.createdAt));case N.TEXT:return Ie.create($r.create(),k(n.createdAt));case N.TREE:return Bu(n.value);case N.NULL:case N.BOOLEAN:case N.INTEGER:case N.LONG:case N.DOUBLE:case N.STRING:case N.BYTES:case N.DATE:return z.of(z.valueFromBytes(Yo(n.type),n.value),k(n.createdAt));case N.INTEGER_CNT:case N.LONG_CNT:return ce.create(Wn(n.type),ce.valueFromBytes(Wn(n.type),n.value),k(n.createdAt))}}function mn(n){return Ce.of(Ke.of(k(n.createdAt),n.offset),n.relativeOffset)}function Xo(n){return Ke.of(k(n.createdAt),n.offset)}function vu(n){const t=rn.create(n.value);Object.entries(n.attributes).forEach(([r,s])=>{t.setAttr(r,s.value,k(s.updatedAt))});const e=ur.create(Xo(n.id),t);return e.remove(k(n.removedAt)),e}function Er(n){return xe.of(Hr(n.parentId),Hr(n.leftSiblingId))}function Hr(n){return Z.of(k(n.createdAt),n.offset)}function wu(n){if(!n.length)return;const t=[];return n.forEach(e=>{const r=Xs(e.content);t.push(r)}),t}function Xs(n){if(n.length===0)return;const t=[];for(const s of n)t.push(Au(s));const e=t[t.length-1],r=new Map;r.set(n[t.length-1].depth,t[t.length-1]);for(let s=t.length-2;s>=0;s--)r.get(n[s].depth-1).prepend(t[s]),r.set(n[s].depth,t[s]);return e.updateDescendantsSize(),Se.create(e,Ne).getRoot()}function Tu(n){const t=er.create();for(const[e,r]of Object.entries(n))t.setInternal(e,r.value,k(r.updatedAt),r.isRemoved);return t}function Au(n){const t=Hr(n.id),e=oe.create(t,n.type),r=Object.entries(n.attributes);return e.isText?e.value=n.value:r.length&&(e.attrs=Tu(n.attributes)),n.insPrevId&&(e.insPrevID=Hr(n.insPrevId)),n.insNextId&&(e.insNextID=Hr(n.insNextId)),e.removedAt=k(n.removedAt),e}function Zo(n){if(n.body.case==="set"){const t=n.body.value;return br.create(t.key,as(t.value),k(t.parentCreatedAt),k(t.executedAt))}else if(n.body.case==="add"){const t=n.body.value;return cn.create(k(t.parentCreatedAt),k(t.prevCreatedAt),as(t.value),k(t.executedAt))}else if(n.body.case==="move"){const t=n.body.value;return or.create(k(t.parentCreatedAt),k(t.prevCreatedAt),k(t.createdAt),k(t.executedAt))}else if(n.body.case==="remove"){const t=n.body.value;return fr.create(k(t.parentCreatedAt),k(t.createdAt),k(t.executedAt))}else if(n.body.case==="edit"){const t=n.body.value,e=new Map;Object.entries(t.createdAtMapByActor).forEach(([s,i])=>{e.set(s,k(i))});const r=new Map;return Object.entries(t.attributes).forEach(([s,i])=>{r.set(s,i)}),un.create(k(t.parentCreatedAt),mn(t.from),mn(t.to),e,t.content,r,k(t.executedAt))}else if(n.body.case==="style"){const t=n.body.value,e=new Map;Object.entries(t.createdAtMapByActor).forEach(([s,i])=>{e.set(s,k(i))});const r=new Map;return Object.entries(t.attributes).forEach(([s,i])=>{r.set(s,i)}),ln.create(k(t.parentCreatedAt),mn(t.from),mn(t.to),e,r,k(t.executedAt))}else{if(n.body.case==="select")return;if(n.body.case==="increase"){const t=n.body.value;return Ur.create(k(t.parentCreatedAt),as(t.value),k(t.executedAt))}else if(n.body.case==="treeEdit"){const t=n.body.value,e=new Map;return Object.entries(t.createdAtMapByActor).forEach(([r,s])=>{e.set(r,k(s))}),hn.create(k(t.parentCreatedAt),Er(t.from),Er(t.to),wu(t.contents),t.splitLevel,e,k(t.executedAt))}else if(n.body.case==="treeStyle"){const t=n.body.value,e=new Map,r=t.attributesToRemove,s=new Map;return t!=null&&t.createdAtMapByActor&&Object.entries(t.createdAtMapByActor).forEach(([i,o])=>{s.set(i,k(o))}),(r==null?void 0:r.length)>0?Qt.createTreeRemoveStyleOperation(k(t.parentCreatedAt),Er(t.from),Er(t.to),s,r,k(t.executedAt)):(Object.entries(t.attributes).forEach(([i,o])=>{e.set(i,o)}),Qt.create(k(t.parentCreatedAt),Er(t.from),Er(t.to),s,e,k(t.executedAt)))}else throw new m(d.ErrUnimplemented,"unimplemented operation")}}function bu(n){const t=[];for(const e of n){const r=Zo(e);r&&t.push(r)}return t}function Qo(n){const t=[];for(const e of n)t.push(Mr.create({id:Ho(e.id),operations:bu(e.operations),presenceChange:e.presenceChange?pu(e.presenceChange):void 0,message:e.message}));return t}function Iu(n){return Or.of(BigInt(n.serverSeq),n.clientSeq)}function Su(n){return es.create(n.documentKey,Iu(n.checkpoint),n.isRemoved,Qo(n.changes),Hs(n.versionVector),n.snapshot,k(n.minSyncedTicket))}function _o(n){const t=new _r;for(const r of n.nodes){const s=Zs(r.element);t.set(r.key,s,s.getPositionedAt())}const e=new ne(k(n.createdAt),t);return e.setMovedAt(k(n.movedAt)),e.setRemovedAt(k(n.removedAt)),e}function ea(n){const t=new tn;for(const r of n.nodes)t.insert(Zs(r.element));const e=new ae(k(n.createdAt),t);return e.setMovedAt(k(n.movedAt)),e.setRemovedAt(k(n.removedAt)),e}function ku(n){const t=z.of(z.valueFromBytes(Yo(n.type),n.value),k(n.createdAt));return t.setMovedAt(k(n.movedAt)),t.setRemovedAt(k(n.removedAt)),t}function Eu(n){const t=new $r;let e=t.getHead();for(const s of n.nodes){const i=t.insertAfter(e,vu(s));s.insPrevId&&i.setInsPrev(t.findNode(Xo(s.insPrevId))),e=i}const r=new Ie(t,k(n.createdAt));return r.setMovedAt(k(n.movedAt)),r.setRemovedAt(k(n.removedAt)),r}function xu(n){const t=ce.create(Wn(n.type),ce.valueFromBytes(Wn(n.type),n.value),k(n.createdAt));return t.setMovedAt(k(n.movedAt)),t.setRemovedAt(k(n.removedAt)),t}function ta(n){const t=Xs(n.nodes);return Se.create(t,k(n.createdAt))}function Zs(n){if(n.body.case==="jsonObject")return _o(n.body.value);if(n.body.case==="jsonArray")return ea(n.body.value);if(n.body.case==="primitive")return ku(n.body.value);if(n.body.case==="text")return Eu(n.body.value);if(n.body.case==="counter")return xu(n.body.value);if(n.body.case==="tree")return ta(n.body.value);throw new m(d.ErrUnimplemented,"unimplemented element")}function Nu(n){if(!n)return{root:ne.create(Ne),presences:new Map};const t=hs.fromBinary(n);return{root:Zs(t.root),presences:yu(t.presences)}}function Cu(n){const t=js(n);return Qs(t.toBinary())}function Pu(n){const t=ei(n),e=Zn.fromBinary(t);return Hs(e)}function ra(n){if(!n)throw new m(d.ErrInvalidArgument,"bytes is empty");const t=se.fromBinary(n);return _o(t.body.value)}function na(n){return Ws(n).toBinary()}function Du(n){if(!n)throw new m(d.ErrInvalidArgument,"bytes is empty");const t=se.fromBinary(n);return ea(t.body.value)}function Ou(n){return Go(n).toBinary()}function Bu(n){if(!n)throw new m(d.ErrInvalidArgument,"bytes is empty");const t=se.fromBinary(n);return ta(t.body.value)}function Ru(n){return Wo(n).toBinary()}function Qs(n){return n?Array.from(n).map(t=>t.toString(16).padStart(2,"0")).join(""):""}function _s(n){return Qs(n)}function ei(n){return new Uint8Array(n.match(/.{1,2}/g).map(t=>parseInt(t,16)))}function ti(n){return ei(n)}function Lu(n){const t=Xn.fromBinary(n);return Ho(t)}function Ju(n){const t=Us.fromBinary(n);return Zo(t)}const j={fromPresence:Ys,toChangePack:mu,fromChangePack:Su,fromChanges:Qo,toTreeNodes:Gs,fromTreeNodes:Xs,objectToBytes:na,bytesToObject:ra,bytesToSnapshot:Nu,bytesToHex:Qs,hexToBytes:ei,toHexString:_s,toUint8Array:ti,toOperation:jo,toChangeID:zo,PbChangeID:Xn,bytesToChangeID:Lu,bytesToOperation:Ju,versionVectorToHex:Cu,hexToVersionVector:Pu};var te=(n=>(n[n.Trivial=0]="Trivial",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warn=3]="Warn",n[n.Error=4]="Error",n[n.Fatal=5]="Fatal",n))(te||{});let dr=3;function Fu(n){dr=n}const x={trivial:(...n)=>{dr>0||typeof console<"u"&&console.log("YORKIE T:",...n)},debug:(...n)=>{dr>1||typeof console<"u"&&console.log("YORKIE D:",...n)},info:(...n)=>{dr>2||typeof console<"u"&&console.log("YORKIE I:",...n)},warn:(...n)=>{dr>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...n):console.log("YORKIE W:",...n))},error:(...n)=>{dr>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...n):console.log("YORKIE E:",...n))},fatal:(...n)=>{typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...n):console.log("YORKIE F:",...n))},isEnabled:n=>dr<=n};function sa(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,n=>{const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)})}class Mu{constructor(t,e,r,s,i){a(this,"reconnectStreamDelay");a(this,"doc");a(this,"docID");a(this,"syncMode");a(this,"remoteChangeEventReceived");a(this,"watchStream");a(this,"watchLoopTimerID");a(this,"watchAbortController");a(this,"unsubscribeBroadcastEvent");this.reconnectStreamDelay=t,this.doc=e,this.docID=r,this.syncMode=s,this.remoteChangeEventReceived=!1,this.unsubscribeBroadcastEvent=i}changeSyncMode(t){this.syncMode=t}needRealtimeSync(){return this.syncMode===Sn.RealtimeSyncOff?!1:this.syncMode===Sn.RealtimePushOnly?this.doc.hasLocalChanges():this.syncMode!==Sn.Manual&&(this.doc.hasLocalChanges()||this.remoteChangeEventReceived)}async runWatchLoop(t){const e=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await t(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.watchLoopTimerID=setTimeout(e,this.reconnectStreamDelay)})}catch{}};await e()}cancelWatchStream(){this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}const cs=()=>{};class $u{constructor(t){a(this,"finalized",!1);a(this,"observers",[]);a(this,"finalError");try{t(this)}catch(e){this.error(e)}}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let s;if(!t)throw new m(d.ErrInvalidArgument,"missing observer");if(this.finalized)throw new m(d.ErrRefused,"observable is finalized due to previous error");typeof t=="object"?s=t:s={next:t,error:e,complete:r},s.next===void 0&&(s.next=cs),s.error===void 0&&(s.error=cs),s.complete===void 0&&(s.complete=cs);const i=sa(),o=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(c){x.warn(c)}return o}unsubscribeOne(t){var e;this.observers=(e=this.observers)==null?void 0:e.filter(r=>r.subscriptionID!==t)}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t].observer)}catch(r){x.error(r)}}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.observers=void 0)}}function Uu(n){const t=new $u(n);return{subscribe:t.subscribe.bind(t),getProxy:()=>t}}class Cr{constructor(t,e,r,s){a(this,"id");a(this,"delimiter");a(this,"message");a(this,"root");a(this,"operations");a(this,"presenceChange");a(this,"previousPresence");a(this,"reversePresenceKeys");this.id=t,this.delimiter=Do,this.root=e,this.operations=[],this.previousPresence=ke(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(t,e,r,s){return new Cr(t,e,r,s)}push(t){this.operations.push(t)}registerElement(t,e){this.root.registerElement(t,e)}registerRemovedElement(t){this.root.registerRemovedElement(t)}registerGCPair(t){this.root.registerGCPair(t)}getChange(){return Mr.create({id:this.id,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(t){this.presenceChange=t}setReversePresence(t,e){for(const r of Object.keys(t))e!=null&&e.addToHistory?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const t={};for(const e of this.reversePresenceKeys)t[e]=this.previousPresence[e];return t}issueTimeTicket(){return this.delimiter+=1,this.id.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.id.createTimeTicket(this.delimiter)}}class nn{constructor(t){a(this,"rootObject");a(this,"elementPairMapByCreatedAt");a(this,"gcElementSetByCreatedAt");a(this,"gcPairMap");this.rootObject=t,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.registerElement(t,void 0),t.getDescendants(e=>{if(e.getRemovedAt()&&this.registerRemovedElement(e),e instanceof Ie||e instanceof Se)for(const r of e.getGCPairs())this.registerGCPair(r);return!1})}static create(){return new nn(ne.create(Ne))}findByCreatedAt(t){const e=this.elementPairMapByCreatedAt.get(t.toIDString());if(e)return e.element}findElementPairByCreatedAt(t){return this.elementPairMapByCreatedAt.get(t.toIDString())}createSubPaths(t){let e=this.elementPairMapByCreatedAt.get(t.toIDString());if(!e)return[];const r=[];for(;e.parent;){const s=e.element.getCreatedAt(),i=e.parent.subPathOf(s);if(i===void 0)throw new m(d.ErrInvalidArgument,`cant find the given element: ${s.toIDString()}`);r.unshift(i),e=this.elementPairMapByCreatedAt.get(e.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(t){return this.createSubPaths(t).join(".")}registerElement(t,e){this.elementPairMapByCreatedAt.set(t.getCreatedAt().toIDString(),{parent:e,element:t}),t instanceof cr&&t.getDescendants((r,s)=>(this.registerElement(r,s),!1))}deregisterElement(t){let e=0;const r=s=>{const i=s.getCreatedAt().toIDString();this.elementPairMapByCreatedAt.delete(i),this.gcElementSetByCreatedAt.delete(i),e++};return r(t),t instanceof cr&&t.getDescendants(s=>(r(s),!1)),e}registerRemovedElement(t){this.gcElementSetByCreatedAt.add(t.getCreatedAt().toIDString())}registerGCPair(t){if(this.gcPairMap.get(t.child.toIDString())){this.gcPairMap.delete(t.child.toIDString());return}this.gcPairMap.set(t.child.toIDString(),t)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const t=new Set;for(const e of this.gcElementSetByCreatedAt){t.add(e);const r=this.elementPairMapByCreatedAt.get(e);r.element instanceof cr&&r.element.getDescendants(s=>(t.add(s.getCreatedAt().toIDString()),!1))}return t.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}deepcopy(){return new nn(this.rootObject.deepcopy())}garbageCollect(t){let e=0;for(const r of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(r),i=s.element.getRemovedAt();i&&(t!=null&&t.afterOrEqual(i))&&(s.parent.purge(s.element),e+=this.deregisterElement(s.element))}for(const[,r]of this.gcPairMap){const s=r.child.getRemovedAt();s&&(t!=null&&t.afterOrEqual(s))&&(r.parent.purge(r.child),this.gcPairMap.delete(r.child.toIDString()),e+=1)}return e}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}getStats(){return{elements:this.getElementMapSize(),gcPairs:this.gcPairMap.size,gcElements:this.getGarbageElementSetSize()}}}function ia(n,t){const e=new sn(n);return new Proxy(t,e.getHandlers())}class sn{constructor(t){a(this,"context");a(this,"handlers");this.context=t,this.handlers={set:(e,r,s)=>(x.isEnabled(te.Trivial)&&x.trivial(`obj[${r}]=${JSON.stringify(s)}`),sn.setInternal(t,e,r,s),!0),get:(e,r)=>(x.isEnabled(te.Trivial)&&x.trivial(`obj[${r}]`),r==="getID"?()=>e.getCreatedAt():r==="toJSON"||r==="toString"?()=>e.toJSON():r==="toJS"?()=>e.toJS():r==="toJSForTest"?()=>e.toJSForTest():gr(t,e.get(r))),ownKeys:e=>e.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(e,r)=>(x.isEnabled(te.Trivial)&&x.trivial(`obj[${r}]`),sn.deleteInternal(t,e,r),!0)}}static setInternal(t,e,r,s){if(r.includes("."))throw new m(d.ErrInvalidObjectKey,"key must not contain the '.'.");const i=t.issueTimeTicket(),o=Hn(t,s,i),c=e.set(r,o,i);t.registerElement(o,e),c&&t.registerRemovedElement(c),t.push(br.create(r,o.deepcopy(),e.getCreatedAt(),i))}static buildObjectMembers(t,e){const r={};for(const[s,i]of Object.entries(e)){if(s.includes("."))throw new m(d.ErrInvalidObjectKey,"key must not contain the '.'.");const o=t.issueTimeTicket(),c=Hn(t,i,o);r[s]=c}return r}static deleteInternal(t,e,r){const s=t.issueTimeTicket(),i=e.deleteByKey(r,s);i&&(t.push(fr.create(e.getCreatedAt(),i.getCreatedAt(),s)),t.registerRemovedElement(i))}getHandlers(){return this.handlers}}function qu(n,t){const e=new U(n,t);return new Proxy(t,e.getHandlers())}function zu(n){return typeof n=="string"||n instanceof String?!isNaN(n):!1}function Vu(n){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(n)}class U{constructor(t,e){a(this,"context");a(this,"handlers");a(this,"array");this.context=t,this.array=e,this.handlers={get:(r,s,i)=>s==="getID"?()=>r.getCreatedAt():s==="getElementByID"?o=>{const c=r.getByID(o);if(!(!c||c.isRemoved()))return sr(t,c)}:s==="getElementByIndex"?o=>{const c=r.get(o);return sr(t,c)}:s==="getLast"?()=>sr(t,r.getLast()):s==="deleteByID"?o=>{const c=U.deleteInternalByID(t,r,o);return sr(t,c)}:s==="insertAfter"?(o,c)=>{const l=U.insertAfterInternal(t,r,o,c);return sr(t,l)}:s==="insertBefore"?(o,c)=>{const l=U.insertBeforeInternal(t,r,o,c);return sr(t,l)}:s==="moveBefore"?(o,c)=>{U.moveBeforeInternal(t,r,o,c)}:s==="moveAfter"?(o,c)=>{U.moveAfterInternal(t,r,o,c)}:s==="moveFront"?o=>{U.moveFrontInternal(t,r,o)}:s==="moveLast"?o=>{U.moveLastInternal(t,r,o)}:zu(s)?gr(t,r.get(Number(s))):s==="push"?o=>U.pushInternal(t,r,o):s==="splice"?(o,c,...l)=>U.splice(t,r,o,c,...l):s==="length"?r.length:typeof s=="symbol"&&s===Symbol.iterator?U.iteratorInternal.bind(this,t,r):s==="includes"?(o,c)=>U.includes(t,r,o,c):s==="indexOf"?(o,c)=>U.indexOf(t,r,o,c):s==="lastIndexOf"?(o,c)=>U.lastIndexOf(t,r,o,c):s==="toJSForTest"?()=>r.toJSForTest():s==="toTestString"?()=>U.toTestString(r):typeof s=="string"&&Vu(s)?(...o)=>{const c=Array.from(r).map(l=>gr(t,l));return Array.prototype[s].apply(c,o)}:Reflect.get(r,s,i),deleteProperty:(r,s)=>(x.isEnabled(te.Trivial)&&x.trivial(`array[${s}]`),U.deleteInternalByIndex(t,r,Number.parseInt(s)),!0)}}static*iteratorInternal(t,e){for(const r of e)yield sr(t,r)}static buildArrayElements(t,e){const r=[];for(const s of e){const i=t.issueTimeTicket(),o=Hn(t,s,i);r.push(o)}return r}static pushInternal(t,e,r){return U.insertAfterInternal(t,e,e.getLastCreatedAt(),r),e.length}static moveBeforeInternal(t,e,r,s){const i=t.issueTimeTicket(),o=e.getPrevCreatedAt(r);e.moveAfter(o,s,i),t.push(or.create(e.getCreatedAt(),o,s,i))}static moveAfterInternal(t,e,r,s){const i=t.issueTimeTicket();e.moveAfter(r,s,i),t.push(or.create(e.getCreatedAt(),r,s,i))}static moveFrontInternal(t,e,r){const s=t.issueTimeTicket(),i=e.getHead();e.moveAfter(i.getCreatedAt(),r,s),t.push(or.create(e.getCreatedAt(),i.getCreatedAt(),r,s))}static moveLastInternal(t,e,r){const s=t.issueTimeTicket(),i=e.getLastCreatedAt();e.moveAfter(i,r,s),t.push(or.create(e.getCreatedAt(),i,r,s))}static insertAfterInternal(t,e,r,s){const i=t.issueTimeTicket(),o=Hn(t,s,i);return e.insertAfter(r,o),t.registerElement(o,e),t.push(cn.create(e.getCreatedAt(),r,o.deepcopy(),i)),o}static insertBeforeInternal(t,e,r,s){return U.insertAfterInternal(t,e,e.getPrevCreatedAt(r),s)}static deleteInternalByIndex(t,e,r){const s=t.issueTimeTicket(),i=e.deleteByIndex(r,s);if(i)return t.push(fr.create(e.getCreatedAt(),i.getCreatedAt(),s)),t.registerRemovedElement(i),i}static deleteInternalByID(t,e,r){const s=t.issueTimeTicket(),i=e.delete(r,s);return t.push(fr.create(e.getCreatedAt(),i.getCreatedAt(),s)),t.registerRemovedElement(i),i}static splice(t,e,r,s,...i){const o=e.length,c=r>=0?Math.min(r,o):Math.max(o+r,0),l=s===void 0?o:s<0?c:Math.min(c+s,o),h=[];for(let f=c;f<l;f++){const g=U.deleteInternalByIndex(t,e,c);if(g){const v=g.deepcopy();v.setRemovedAt(),h.push(gr(t,v))}}if(i){let f=c===0?e.getHead().getID():e.get(c-1).getID();for(const g of i)f=U.insertAfterInternal(t,e,f,g).getID()}return h}static includes(t,e,r,s){var c;const i=e.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return!1;if(z.isSupport(r))return Array.from(e).map(h=>gr(t,h)).includes(r,o);for(let l=o;l<i;l++)if(((c=e.get(l))==null?void 0:c.getID())===r.getID())return!0;return!1}static indexOf(t,e,r,s){var c;const i=e.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return-1;if(z.isSupport(r))return Array.from(e).map(h=>gr(t,h)).indexOf(r,o);for(let l=o;l<i;l++)if(((c=e.get(l))==null?void 0:c.getID())===r.getID())return l;return-1}static lastIndexOf(t,e,r,s){var c;const i=e.length,o=s===void 0||s>=i?i-1:s<0?s+i:s;if(o<0)return-1;if(z.isSupport(r))return Array.from(e).map(h=>gr(t,h)).lastIndexOf(r,o);for(let l=o;l>0;l--)if(((c=e.get(l))==null?void 0:c.getID())===r.getID())return l;return-1}static toTestString(t){return t.toTestString()}getHandlers(){return this.handlers}}class ri{constructor(t,e){a(this,"context");a(this,"text");this.context=t,this.text=e}initialize(t,e){this.context=t,this.text=e}getID(){return this.text.getID()}edit(t,e,r,s){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");if(t>e)throw new m(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.text.indexRangeToPosRange(t,e);x.isEnabled(te.Debug)&&x.debug(`EDIT: f:${t}->${i[0].toTestString()}, t:${e}->${i[1].toTestString()} c:${r}`);const o=s?Jr(s):void 0,c=this.context.issueTimeTicket(),[l,,h,f]=this.text.edit(i,r,c,o);for(const g of h)this.context.registerGCPair(g);return this.context.push(new un(this.text.getCreatedAt(),i[0],i[1],l,r,o?new Map(Object.entries(o)):new Map,c)),this.text.findIndexesFromRange(f)}delete(t,e){return this.edit(t,e,"")}empty(){return this.edit(0,this.length,"")}setStyle(t,e,r){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");if(t>e)throw new m(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.text.indexRangeToPosRange(t,e);x.isEnabled(te.Debug)&&x.debug(`STYL: f:${t}->${s[0].toTestString()}, t:${e}->${s[1].toTestString()} a:${JSON.stringify(r)}`);const i=Jr(r),o=this.context.issueTimeTicket(),[c,l]=this.text.setStyle(s,i,o);for(const h of l)this.context.registerGCPair(h);return this.context.push(new ln(this.text.getCreatedAt(),s[0],s[1],c,new Map(Object.entries(i)),o)),!0}indexRangeToPosRange(t){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");const e=this.text.indexRangeToPosRange(t[0],t[1]);return[e[0].toStruct(),e[1].toStruct()]}posRangeToIndexRange(t){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");const e=this.text.findIndexesFromRange([Ce.fromStruct(t[0]),Ce.fromStruct(t[1])]);return[e[0],e[1]]}toTestString(){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(t,e){if(!this.context||!this.text)throw new m(d.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(t,e)}}class ni{constructor(t,e){a(this,"valueType");a(this,"value");a(this,"context");a(this,"counter");this.valueType=t,this.value=e}initialize(t,e){this.valueType=e.getValueType(),this.context=t,this.counter=e,this.value=e.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(t){if(!this.context||!this.counter)throw new m(d.ErrNotInitialized,"Counter is not initialized yet");const e=this.context.issueTimeTicket(),r=z.of(t,e);if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`);return this.counter.increase(r),this.context.push(Ur.create(this.counter.getCreatedAt(),r,e)),this}toJSForTest(){if(!this.context||!this.counter)throw new m(d.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}}function si(n,t,e){const{type:r}=n,s=e.issueTimeTicket();if(r===Zt){oa(n);const{value:i}=n,o=oe.create(Z.of(s,0),r,i);t.append(o)}else{const{children:i=[]}=n,{attributes:o}=n;let c;if(typeof o=="object"&&!Po(o)){const h=Jr(o);c=new er;for(const[f,g]of Object.entries(h))c.set(f,g,s)}const l=oe.create(Z.of(s,0),r,void 0,c);t.append(l);for(const h of i)si(h,l,e)}}function Ku(n,t){const{type:e}=t,r=n.issueTimeTicket();let s;if(t.type===Zt){const{value:i}=t;s=oe.create(Z.of(r,0),e,i)}else if(t){const{children:i=[]}=t,{attributes:o}=t;let c;if(typeof o=="object"&&!Po(o)){const l=Jr(o);c=new er;for(const[h,f]of Object.entries(l))c.set(h,f,r)}s=oe.create(Z.of(n.issueTimeTicket(),0),e,void 0,c);for(const l of i)si(l,s,n)}return s}function oa(n){if(!n.value.length)throw new m(d.ErrInvalidArgument,"text node cannot have empty value");return!0}function Ki(n){if(!n.length)return!0;if(n[0].type===Zt)for(const e of n){const{type:r}=e;if(r!==Zt)throw new m(d.ErrInvalidArgument,"element node and text node cannot be passed together");oa(e)}else for(const e of n){const{type:r}=e;if(r===Zt)throw new m(d.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class ii{constructor(t){a(this,"initialRoot");a(this,"context");a(this,"tree");this.initialRoot=t}initialize(t,e){this.context=t,this.tree=e}getID(){return this.tree.getID()}buildRoot(t){if(!this.initialRoot)return oe.create(Z.of(t.issueTimeTicket(),0),qc);const e=oe.create(Z.of(t.issueTimeTicket(),0),this.initialRoot.type);for(const r of this.initialRoot.children)si(r,e,t);return e}getSize(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}styleByPath(t,e){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(!t.length)throw new m(d.ErrInvalidArgument,"path should not be empty");const[r,s]=this.tree.pathToPosRange(t),i=this.context.issueTimeTicket(),o=e?Jr(e):void 0,[c]=this.tree.style([r,s],o,i);this.context.push(Qt.create(this.tree.getCreatedAt(),r,s,c,o?new Map(Object.entries(o)):new Map,i))}style(t,e,r){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new m(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(t),i=this.tree.findPos(e),o=this.context.issueTimeTicket(),c=r?Jr(r):void 0,[l,h]=this.tree.style([s,i],c,o);for(const f of h)this.context.registerGCPair(f);this.context.push(Qt.create(this.tree.getCreatedAt(),s,i,l,c?new Map(Object.entries(c)):new Map,o))}removeStyle(t,e,r){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new m(d.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(t),i=this.tree.findPos(e),o=this.context.issueTimeTicket(),[c,l]=this.tree.removeStyle([s,i],r,o);for(const h of l)this.context.registerGCPair(h);this.context.push(Qt.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,i,c,r,o))}editInternal(t,e,r,s=0){var h;if(r.length!==0&&r[0]&&(Ki(r),r[0].type!==Zt))for(const f of r){const{children:g=[]}=f;Ki(g)}const i=this.context.getLastTimeTicket();let o=new Array;if(((h=r[0])==null?void 0:h.type)===Zt){let f="";for(const g of r){const{value:v}=g;f+=v}o.push(oe.create(Z.of(this.context.issueTimeTicket(),0),Zt,f))}else o=r.map(f=>f&&Ku(this.context,f)).filter(f=>f);const[,c,l]=this.tree.edit([t,e],o.length?o.map(f=>f==null?void 0:f.deepcopy()):void 0,s,i,()=>this.context.issueTimeTicket());for(const f of c)this.context.registerGCPair(f);return this.context.push(hn.create(this.tree.getCreatedAt(),t,e,o.length?o:void 0,s,l,i)),!0}editByPath(t,e,r,s=0){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(t.length!==e.length)throw new m(d.ErrInvalidArgument,"path length should be equal");if(!t.length||!e.length)throw new m(d.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(t),o=this.tree.pathToPos(e);return this.editInternal(i,o,r?[r]:[],s)}editBulkByPath(t,e,r,s=0){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(t.length!==e.length)throw new m(d.ErrInvalidArgument,"path length should be equal");if(!t.length||!e.length)throw new m(d.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(t),o=this.tree.pathToPos(e);return this.editInternal(i,o,r,s)}edit(t,e,r,s=0){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new m(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(t),o=this.tree.findPos(e);return this.editInternal(i,o,r?[r]:[],s)}editBulk(t,e,r,s=0){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");if(t>e)throw new m(d.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(t),o=this.tree.findPos(e);return this.editInternal(i,o,r,s)}toXML(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(t){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(t)}pathToIndex(t){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(t)}pathRangeToPosRange(t){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");const e=[this.tree.pathToIndex(t[0]),this.tree.pathToIndex(t[1])],r=this.tree.indexRangeToPosRange(e);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(t){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(t)}posRangeToIndexRange(t){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");const e=[xe.fromStruct(t[0]),xe.fromStruct(t[1])];return this.tree.posRangeToIndexRange(e)}posRangeToPathRange(t){if(!this.context||!this.tree)throw new m(d.ErrNotInitialized,"Tree is not initialized yet");const e=[xe.fromStruct(t[0]),xe.fromStruct(t[1])];return this.tree.posRangeToPathRange(e)}}function ji(n,t){return ia(n,t)}function sr(n,t){if(t){if(t instanceof z)return t;if(t instanceof ne)return ia(n,t);if(t instanceof ae)return qu(n,t);if(t instanceof Ie)return new ri(n,t);if(t instanceof ce){const e=new ni(je.IntegerCnt,0);return e.initialize(n,t),e}else if(t instanceof Se){const e=new ii;return e.initialize(n,t),e}}else return;throw new TypeError(`Unsupported type of element: ${typeof t}`)}function gr(n,t){const e=sr(n,t);return e instanceof z?e.getValue():e}function Hn(n,t,e){let r;if(z.isSupport(t))r=z.of(t,e);else if(Array.isArray(t))r=ae.create(e,U.buildArrayElements(n,t));else if(typeof t=="object")t instanceof ri?(r=Ie.create($r.create(),e),t.initialize(n,r)):t instanceof ni?(r=ce.create(t.getValueType(),t.getValue(),e),t.initialize(n,r)):t instanceof ii?(r=Se.create(t.buildRoot(n),e),t.initialize(n,r)):r=ne.create(e,sn.buildObjectMembers(n,t));else throw new TypeError(`Unsupported type of value: ${typeof t}`);return r}const Gi=50;class ju{constructor(){a(this,"undoStack",[]);a(this,"redoStack",[])}hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(t){this.undoStack.length>=Gi&&this.undoStack.shift(),this.undoStack.push(t)}popUndo(){return this.undoStack.pop()}pushRedo(t){this.redoStack.length>=Gi&&this.redoStack.shift(),this.redoStack.push(t)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}}const Gu="yorkie-devtools-panel",Wu="yorkie-devtools-sdk";function Hu(n){return[X.StatusChanged,X.Snapshot,X.LocalChange,X.RemoteChange,X.Initialized,X.Watched,X.Unwatched,X.PresenceChanged].includes(n.type)}function Yu(n){return n.every(Hu)}let xr="disconnected";const Wi=new Map,In=new Map;typeof window<"u"&&(window.docEventsForReplayByDocKey=In);function pn(n,t){(t!=null&&t.force||xr!=="disconnected")&&window.postMessage({source:Wu,...n},"*")}function Xu(n){if(!n.isEnableDevtools()||typeof window>"u"||Wi.has(n.getKey()))return;In.set(n.getKey(),[]);const t=n.subscribe("all",e=>{Yu(e)&&(In.get(n.getKey()).push(e),xr==="synced"&&pn({msg:"doc::sync::partial",docKey:n.getKey(),event:e}))});Wi.set(n.getKey(),[t]),pn({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",e=>{var s;if(((s=e.data)==null?void 0:s.source)!==Gu)return;switch(e.data.msg){case"devtools::connect":if(xr!=="disconnected")break;xr="connected",pn({msg:"doc::available",docKey:n.getKey()}),x.info(`[YD] Devtools connected. Doc: ${n.getKey()}`);break;case"devtools::disconnect":xr="disconnected",x.info(`[YD] Devtools disconnected. Doc: ${n.getKey()}`);break;case"devtools::subscribe":xr="synced",pn({msg:"doc::sync::full",docKey:n.getKey(),events:In.get(n.getKey())}),x.info(`[YD] Devtools subscribed. Doc: ${n.getKey()}`);break}})}var ir=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(ir||{}),X=(n=>(n.StatusChanged="status-changed",n.ConnectionChanged="connection-changed",n.SyncStatusChanged="sync-status-changed",n.Snapshot="snapshot",n.LocalChange="local-change",n.RemoteChange="remote-change",n.Initialized="initialized",n.Watched="watched",n.Unwatched="unwatched",n.PresenceChanged="presence-changed",n.Broadcast="broadcast",n.LocalBroadcast="local-broadcast",n.AuthError="auth-error",n))(X||{}),on=(n=>(n.Connected="connected",n.Disconnected="disconnected",n))(on||{}),Fs=(n=>(n.Synced="synced",n.SyncFailed="sync-failed",n))(Fs||{});class aa{constructor(t,e){a(this,"key");a(this,"status");a(this,"opts");a(this,"changeID");a(this,"checkpoint");a(this,"localChanges");a(this,"root");a(this,"clone");a(this,"eventStream");a(this,"eventStreamObserver");a(this,"onlineClients");a(this,"presences");a(this,"history");a(this,"internalHistory");a(this,"isUpdating");this.opts=e||{},this.key=t,this.status="detached",this.root=nn.create(),this.changeID=Xc,this.checkpoint=Zc,this.localChanges=[],this.eventStream=Uu(r=>{this.eventStreamObserver=r}),this.onlineClients=new Set,this.presences=new Map,this.isUpdating=!1,this.internalHistory=new ju,this.history={canUndo:this.canUndo.bind(this),canRedo:this.canRedo.bind(this),undo:this.undo.bind(this),redo:this.redo.bind(this)},Xu(this)}update(t,e){if(this.getStatus()==="removed")throw new m(d.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const r=this.changeID.getActorID(),s=Cr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(r)||{},e);try{const i=ji(s,this.clone.root.getObject());this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,t(i,new is(s,this.clone.presences.get(r)))}catch(i){throw this.clone=void 0,i}finally{this.isUpdating=!1}if(s.hasChange()){x.isEnabled(te.Trivial)&&x.trivial(`trying to update a local change: ${this.toJSON()}`);const i=s.getChange(),{opInfos:o,reverseOps:c}=i.execute(this.root,this.presences,J.Local),l=s.getReversePresence();l&&c.push({type:"presence",value:l}),this.localChanges.push(i),c.length>0&&this.internalHistory.pushUndo(c),o.length>0&&this.internalHistory.clearRedo(),this.changeID=i.getID();const h=[];o.length>0&&h.push({type:"local-change",source:J.Local,value:{message:i.getMessage()||"",operations:o,actor:r,clientSeq:i.getID().getClientSeq(),serverSeq:i.getID().getServerSeq()},rawChange:this.isEnableDevtools()?i.toStruct():void 0}),i.hasPresenceChange()&&h.push({type:"presence-changed",source:J.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(h),x.isEnabled(te.Trivial)&&x.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(t,e,r,s){if(typeof t=="string"){if(typeof e!="function")throw new m(d.ErrInvalidArgument,"Second argument must be a callback function");if(t==="presence"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="initialized"&&h.type!=="watched"&&h.type!=="unwatched"&&h.type!=="presence-changed"||c(h)},r,s)}if(t==="my-presence"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="initialized"&&h.type!=="presence-changed"||h.type==="presence-changed"&&h.value.clientID!==this.changeID.getActorID()||c(h)},r,s)}if(t==="others"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="watched"&&h.type!=="unwatched"&&h.type!=="presence-changed"||h.value.clientID!==this.changeID.getActorID()&&c(h)},r,s)}if(t==="connection"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="connection-changed"&&c(h)},r,s)}if(t==="status"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="status-changed"&&c(h)},r,s)}if(t==="sync"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="sync-status-changed"&&c(h)},r,s)}if(t==="local-broadcast"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="local-broadcast"&&c(h)},r)}if(t==="broadcast"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="broadcast"&&c(h)},r)}if(t==="auth-error"){const c=e;return this.eventStream.subscribe(l=>{for(const h of l)h.type==="auth-error"&&c(h)},r)}if(t==="all"){const c=e;return this.eventStream.subscribe(c,r,s)}const i=t,o=e;return this.eventStream.subscribe(c=>{for(const l of c){if(l.type!=="local-change"&&l.type!=="remote-change")continue;const h=[];for(const f of l.value.operations)this.isSameElementOrChildOf(f.path,i)&&h.push(f);h.length&&o({...l,value:{...l.value,operations:h}})}},r,s)}if(typeof t=="function"){const i=t,o=e,c=r;return this.eventStream.subscribe(l=>{for(const h of l)h.type!=="snapshot"&&h.type!=="local-change"&&h.type!=="remote-change"||i(h)},o,c)}throw new m(d.ErrInvalidArgument,`"${t}" is not a valid`)}publish(t){this.eventStreamObserver&&this.eventStreamObserver.next(t)}isSameElementOrChildOf(t,e){if(e===t)return!0;const r=t.split(".");return e.split(".").every((i,o)=>i===r[o])}removePushedLocalChanges(t){for(;this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>t);)this.localChanges.shift()}applyChangePack(t){const e=t.hasSnapshot();e?this.applySnapshot(t.getCheckpoint().getServerSeq(),t.getVersionVector(),t.getSnapshot(),t.getCheckpoint().getClientSeq()):(this.applyChanges(t.getChanges(),J.Remote),this.removePushedLocalChanges(t.getCheckpoint().getClientSeq())),this.checkpoint=this.checkpoint.forward(t.getCheckpoint()),e||this.garbageCollect(t.getVersionVector()),t.getIsRemoved()&&this.applyStatus("removed"),x.isEnabled(te.Trivial)&&x.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:ke(this.presences)})}createChangePack(){const t=Array.from(this.localChanges),e=this.checkpoint.increaseClientSeq(t.length);return es.create(this.key,e,!1,t,this.getVersionVector())}setActor(t){for(const e of this.localChanges)e.setActor(t);this.changeID=this.changeID.setActor(t)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const t=Cr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return ji(t,this.clone.root.getObject())}garbageCollect(t){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(t),this.root.garbageCollect(t))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}getStats(){return this.root.getStats()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(t,e,r,s=-1){const{root:i,presences:o}=j.bytesToSnapshot(r);this.root=new nn(i),this.presences=o,this.changeID=this.changeID.setClocks(e.maxLamport(),e),this.clone=void 0,this.removePushedLocalChanges(s),this.applyChanges(this.localChanges,J.Local),this.publish([{type:"snapshot",source:J.Remote,value:{serverSeq:t.toString(),snapshot:this.isEnableDevtools()?j.bytesToHex(r):void 0,snapshotVector:j.versionVectorToHex(e)}}])}applyChanges(t,e){x.isEnabled(te.Debug)&&x.debug(`trying to apply ${t.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),x.isEnabled(te.Trivial)&&x.trivial(t.map(r=>`${r.getID().toTestString()}	${r.toTestString()}`).join(`
`));for(const r of t)this.applyChange(r,e);x.isEnabled(te.Debug)&&x.debug(`after appling ${t.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(t,e){this.ensureClone(),t.execute(this.clone.root,this.clone.presences,e);const r=[],s=t.getID().getActorID();if(t.hasPresenceChange()&&this.onlineClients.has(s)){const o=t.getPresenceChange();switch(o.type){case hr.Put:r.push(this.presences.has(s)?{type:"presence-changed",source:e,value:{clientID:s,presence:o.presence}}:{type:"watched",source:J.Remote,value:{clientID:s,presence:o.presence}});break;case hr.Clear:r.push({type:"unwatched",source:J.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:i}=t.execute(this.root,this.presences,e);if(this.changeID=this.changeID.syncClocks(t.getID()),i.length>0){const o=this.isEnableDevtools()?t.toStruct():void 0;r.push(e===J.Remote?{type:"remote-change",source:e,value:{actor:s,clientSeq:t.getID().getClientSeq(),serverSeq:t.getID().getServerSeq(),message:t.getMessage()||"",operations:i},rawChange:o}:{type:"local-change",source:e,value:{actor:s,clientSeq:t.getID().getClientSeq(),serverSeq:t.getID().getServerSeq(),message:t.getMessage()||"",operations:i},rawChange:o})}r.length>0&&this.publish(r)}applyWatchStream(t){if(t.body.case==="initialization"){const e=t.body.value.clientIds,r=new Set;for(const s of e)s!==this.changeID.getActorID()&&r.add(s);this.setOnlineClients(r),this.publish([{type:"initialized",source:J.Local,value:this.getPresences()}]);return}if(t.body.case==="event"){const{type:e,publisher:r}=t.body.value,s=[];if(e===wr.DOCUMENT_WATCHED){if(this.onlineClients.has(r)&&this.hasPresence(r))return;this.addOnlineClient(r),this.hasPresence(r)&&s.push({type:"watched",source:J.Remote,value:{clientID:r,presence:this.getPresence(r)}})}else if(e===wr.DOCUMENT_UNWATCHED){const i=this.getPresence(r);this.removeOnlineClient(r),i&&s.push({type:"unwatched",source:J.Remote,value:{clientID:r,presence:i}})}else if(e===wr.DOCUMENT_BROADCAST&&t.body.value.body){const{topic:i,payload:o}=t.body.value.body,c=new TextDecoder;s.push({type:"broadcast",value:{clientID:r,topic:i,payload:JSON.parse(c.decode(o))}})}s.length>0&&this.publish(s)}}applyStatus(t){this.status=t,t==="detached"&&this.setActor(Qn),this.publish([{source:t==="removed"?J.Remote:J.Local,type:"status-changed",value:t==="attached"?{status:t,actorID:this.changeID.getActorID()}:{status:t}}])}applyDocEventForReplay(t){if(t.type==="status-changed"){this.applyStatus(t.value.status),t.value.status==="attached"&&this.setActor(t.value.actorID);return}if(t.type==="snapshot"){const{snapshot:e,serverSeq:r,snapshotVector:s}=t.value;if(!e)return;this.applySnapshot(BigInt(r),j.hexToVersionVector(s),j.hexToBytes(e));return}if(t.type==="local-change"||t.type==="remote-change"){if(!t.rawChange)return;const e=Mr.fromStruct(t.rawChange);this.applyChange(e,t.source)}if(t.type==="initialized"){const e=new Set;for(const{clientID:r,presence:s}of t.value)e.add(r),this.presences.set(r,s);this.setOnlineClients(e);return}if(t.type==="watched"){const{clientID:e,presence:r}=t.value;this.addOnlineClient(e),this.presences.set(e,r);return}if(t.type==="unwatched"){const{clientID:e}=t.value;this.removeOnlineClient(e),this.presences.delete(e)}if(t.type==="presence-changed"){const{clientID:e,presence:r}=t.value;this.presences.set(e,r)}}applyDocEventsForReplay(t){for(const e of t)this.applyDocEventForReplay(e)}getValueByPath(t){if(!t.startsWith("$"))throw new m(d.ErrInvalidArgument,'path must start with "$"');const e=t.split(".");e.shift();let r=this.getRoot();for(const s of e)if(r=r[s],r===void 0)return;return r}setOnlineClients(t){this.onlineClients=t}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(t){this.onlineClients.add(t)}removeOnlineClient(t){this.onlineClients.delete(t)}hasPresence(t){return this.presences.has(t)}getMyPresence(){if(this.status!=="attached")return{};const t=this.presences.get(this.changeID.getActorID());return t?ke(t):{}}getPresence(t){if(t===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(t))return;const e=this.presences.get(t);return e?ke(e):void 0}getPresenceForTest(t){const e=this.presences.get(t);return e?ke(e):void 0}getPresences(){const t=[];t.push({clientID:this.changeID.getActorID(),presence:ke(this.getMyPresence())});for(const e of this.onlineClients)this.presences.has(e)&&t.push({clientID:e,presence:ke(this.presences.get(e))});return t}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const t=this.getChangeID().getActorID();return this.getPresences().filter(e=>e.clientID!==t).sort((e,r)=>e.clientID>r.clientID?1:-1)}canUndo(){return this.internalHistory.hasUndo()&&!this.isUpdating}filterVersionVector(t){const r=this.changeID.getVersionVector().filter(t);this.changeID=this.changeID.setVersionVector(r)}canRedo(){return this.internalHistory.hasRedo()&&!this.isUpdating}undo(){if(this.isUpdating)throw new m(d.ErrRefused,"Undo is not allowed during an update");const t=this.internalHistory.popUndo();if(t===void 0)throw new m(d.ErrRefused,"There is no operation to be undone");this.ensureClone();const e=Cr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const h of t){if(!(h instanceof Pe)){new is(e,ke(this.clone.presences.get(this.changeID.getActorID()))).set(h.value,{addToHistory:!0});continue}const f=e.issueTimeTicket();h.setExecutedAt(f),e.push(h)}const r=e.getChange();r.execute(this.clone.root,this.clone.presences,J.UndoRedo);const{opInfos:s,reverseOps:i}=r.execute(this.root,this.presences,J.UndoRedo),o=e.getReversePresence();if(o&&i.push({type:"presence",value:o}),i.length>0&&this.internalHistory.pushRedo(i),!r.hasPresenceChange()&&s.length===0)return;this.localChanges.push(r),this.changeID=r.getID();const c=this.changeID.getActorID(),l=[];s.length>0&&l.push({type:"local-change",source:J.UndoRedo,value:{message:r.getMessage()||"",operations:s,actor:c,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&l.push({type:"presence-changed",source:J.UndoRedo,value:{clientID:c,presence:this.getPresence(c)}}),this.publish(l)}redo(){if(this.isUpdating)throw new m(d.ErrRefused,"Redo is not allowed during an update");const t=this.internalHistory.popRedo();if(t===void 0)throw new m(d.ErrRefused,"There is no operation to be redone");this.ensureClone();const e=Cr.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const h of t){if(!(h instanceof Pe)){new is(e,ke(this.clone.presences.get(this.changeID.getActorID()))).set(h.value,{addToHistory:!0});continue}const f=e.issueTimeTicket();h.setExecutedAt(f),e.push(h)}const r=e.getChange();r.execute(this.clone.root,this.clone.presences,J.UndoRedo);const{opInfos:s,reverseOps:i}=r.execute(this.root,this.presences,J.UndoRedo),o=e.getReversePresence();if(o&&i.push({type:"presence",value:o}),i.length>0&&this.internalHistory.pushUndo(i),!r.hasPresenceChange()&&s.length===0)return;this.localChanges.push(r),this.changeID=r.getID();const c=this.changeID.getActorID(),l=[];s.length>0&&l.push({type:"local-change",source:J.UndoRedo,value:{message:r.getMessage()||"",operations:s,actor:c,clientSeq:r.getID().getClientSeq(),serverSeq:r.getID().getServerSeq()},rawChange:this.isEnableDevtools()?r.toStruct():void 0}),r.hasPresenceChange()&&l.push({type:"presence-changed",source:J.UndoRedo,value:{clientID:c,presence:this.getPresence(c)}}),this.publish(l)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}broadcast(t,e,r){const s={type:"local-broadcast",value:{topic:t,payload:e},options:r};this.publish([s])}getVersionVector(){return this.changeID.getVersionVector()}}function Zu(n,t){let e=t;return{authInterceptor:i=>async o=>(n&&o.header.set("x-api-key",n),e&&o.header.set("authorization",e),await i(o)),setToken:i=>{e=i}}}const Qu="@yorkie-js/sdk",_u="0.6.5",Hi={name:Qu,version:_u};function el(){return n=>async t=>(t.header.set("x-yorkie-user-agent",Hi.name+"/"+Hi.version),await n(t))}const tl=n=>{try{if(JSON.stringify(n)===void 0)return!1}catch{return!1}return!0};var Sn=(n=>(n.Manual="manual",n.Realtime="realtime",n.RealtimePushOnly="realtime-pushonly",n.RealtimeSyncOff="realtime-syncoff",n))(Sn||{});const yn={syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3},us={maxRetries:1/0,initialRetryInterval:1e3,maxBackoff:2e4};class ca{constructor(t,e){a(this,"id");a(this,"key");a(this,"metadata");a(this,"status");a(this,"attachmentMap");a(this,"apiKey");a(this,"authTokenInjector");a(this,"conditions");a(this,"syncLoopDuration");a(this,"reconnectStreamDelay");a(this,"retrySyncLoopDelay");a(this,"rpcClient");a(this,"setAuthToken");a(this,"taskQueue");a(this,"processing",!1);a(this,"keepalive",!1);e=e||yn,this.key=e.key?e.key:sa(),this.metadata=e.metadata||{},this.status="deactivated",this.attachmentMap=new Map,this.apiKey=e.apiKey||"",this.authTokenInjector=e.authTokenInjector,this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=e.syncLoopDuration??yn.syncLoopDuration,this.reconnectStreamDelay=e.reconnectStreamDelay??yn.reconnectStreamDelay,this.retrySyncLoopDelay=e.retrySyncLoopDelay??yn.retrySyncLoopDelay;const{authInterceptor:r,setToken:s}=Zu(this.apiKey);this.setAuthToken=s,this.rpcClient=uc(Oc,Dc({baseUrl:t,interceptors:[r,el()],fetch:(i,o)=>{const c={...o,keepalive:this.keepalive};return fetch(i,c)}})),this.taskQueue=[]}async activate(){if(this.isActive())return Promise.resolve();if(this.authTokenInjector){const t=await this.authTokenInjector();this.setAuthToken(t)}return this.enqueueTask(async()=>this.rpcClient.activateClient({clientKey:this.key,metadata:this.metadata},{headers:{"x-shard-key":this.apiKey}}).then(t=>{this.id=t.clientId,this.status="activated",this.runSyncLoop(),x.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`)}).catch(async t=>{throw x.error(`[AC] c:"${this.getKey()}" err :`,t),await this.handleConnectError(t),t}))}deactivate(t={keepalive:!1}){if(this.status==="deactivated")return Promise.resolve();const e=async()=>{try{await this.rpcClient.deactivateClient({clientId:this.id},{headers:{"x-shard-key":this.apiKey}}),this.deactivateInternal(),x.info(`[DC] c"${this.getKey()}" deactivated`)}catch(r){throw x.error(`[DC] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};if(t.keepalive){this.keepalive=!0;const r=e();return this.keepalive=!1,r}return this.enqueueTask(e)}hasDocument(t){return this.attachmentMap.has(t)}attach(t,e={}){if(!this.isActive())throw new m(d.ErrClientNotActivated,`${this.key} is not active`);if(t.getStatus()!==ir.Detached)throw new m(d.ErrDocumentNotDetached,`${t.getKey()} is not detached`);t.setActor(this.id),t.update((i,o)=>o.set(e.initialPresence||{}));const r=t.subscribe("local-broadcast",async i=>{var f;const{topic:o,payload:c}=i.value,l=(f=i.options)==null?void 0:f.error,h=i.options;try{await this.broadcast(t.getKey(),o,c,h)}catch(g){g instanceof Error&&(l==null||l(g))}}),s=e.syncMode??"realtime";return this.enqueueTask(async()=>this.rpcClient.attachDocument({clientId:this.id,changePack:j.toChangePack(t.createChangePack())},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}}).then(async i=>{const o=j.fromChangePack(i.changePack);if(t.applyChangePack(o),t.getStatus()===ir.Removed)return t;t.applyStatus(ir.Attached),this.attachmentMap.set(t.getKey(),new Mu(this.reconnectStreamDelay,t,i.documentId,s,r)),s!=="manual"&&await this.runWatchLoop(t.getKey()),x.info(`[AD] c:"${this.getKey()}" attaches d:"${t.getKey()}"`);const c=t.getRootObject();if(e.initialRoot){const l=e.initialRoot;t.update(h=>{for(const[f,g]of Object.entries(l))if(!c.has(f)){const v=f;h[v]=g}})}return t}).catch(async i=>{throw x.error(`[AD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}))}detach(t,e={keepalive:!1}){if(!this.isActive())throw new m(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(t.getKey());if(!r)throw new m(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);t.update((i,o)=>o.clear());const s=async()=>await this.rpcClient.detachDocument({clientId:this.id,documentId:r.docID,changePack:j.toChangePack(t.createChangePack()),removeIfNotAttached:e.removeIfNotAttached??!1},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}}).then(i=>{const o=j.fromChangePack(i.changePack);return t.applyChangePack(o),t.getStatus()!==ir.Removed&&t.applyStatus(ir.Detached),this.detachInternal(t.getKey()),x.info(`[DD] c:"${this.getKey()}" detaches d:"${t.getKey()}"`),t}).catch(async i=>{throw x.error(`[DD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i});if(e.keepalive){this.keepalive=!0;const i=s();return this.keepalive=!1,i}return this.enqueueTask(s)}async changeSyncMode(t,e){if(!this.isActive())throw new m(d.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(t.getKey());if(!r)throw new m(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);const s=r.syncMode;return s===e?t:(r.changeSyncMode(e),e==="manual"?(r.cancelWatchStream(),t):(e==="realtime"&&(r.remoteChangeEventReceived=!0),s==="manual"&&await this.runWatchLoop(t.getKey()),t))}sync(t){if(!this.isActive())throw new m(d.ErrClientNotActivated,`${this.key} is not active`);if(t){const e=this.attachmentMap.get(t.getKey());if(!e)throw new m(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(e,"realtime").catch(async r=>{throw x.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}return this.enqueueTask(async()=>{const e=[];for(const[,r]of this.attachmentMap)e.push(this.syncInternal(r,r.syncMode));return Promise.all(e).catch(async r=>{throw x.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r})})}remove(t){if(!this.isActive())throw new m(d.ErrClientNotActivated,`${this.key} is not active`);const e=this.attachmentMap.get(t.getKey());if(!e)throw new m(d.ErrDocumentNotAttached,`${t.getKey()} is not attached`);t.setActor(this.id);const r=j.toChangePack(t.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>this.rpcClient.removeDocument({clientId:this.id,documentId:e.docID,changePack:r},{headers:{"x-shard-key":`${this.apiKey}/${t.getKey()}`}}).then(s=>{const i=j.fromChangePack(s.changePack);t.applyChangePack(i),this.detachInternal(t.getKey()),x.info(`[RD] c:"${this.getKey()}" removes d:"${t.getKey()}"`)}).catch(async s=>{throw x.error(`[RD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}))}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(t){return this.conditions[t]}broadcast(t,e,r,s){if(!this.isActive())throw new m(d.ErrClientNotActivated,`${this.key} is not active`);const i=this.attachmentMap.get(t);if(!i)throw new m(d.ErrDocumentNotAttached,`${t} is not attached`);if(!tl(r))throw new m(d.ErrInvalidArgument,"payload is not serializable");const o=(s==null?void 0:s.maxRetries)??us.maxRetries,c=us.maxBackoff;let l=0;const h=g=>Math.min(us.initialRetryInterval*2**g,c),f=async()=>this.enqueueTask(async()=>this.rpcClient.broadcast({clientId:this.id,documentId:i.docID,topic:e,payload:new TextEncoder().encode(JSON.stringify(r))},{headers:{"x-shard-key":`${this.apiKey}/${t}`}}).then(()=>{x.info(`[BC] c:"${this.getKey()}" broadcasts d:"${t}" t:"${e}"`)}).catch(async g=>{if(x.error(`[BC] c:"${this.getKey()}" err:`,g),await this.handleConnectError(g))if(g instanceof M&&nr(g)===d.ErrUnauthenticated&&i.doc.publish([{type:X.AuthError,value:{reason:Vr(g).reason,method:"Broadcast"}}]),l<o)l++,setTimeout(()=>f(),h(l-1)),x.info(`[BC] c:"${this.getKey()}" retry attempt ${l}/${o}`);else throw x.error(`[BC] c:"${this.getKey()}" exceeded maximum retry attempts`),g;else throw g}));return f()}runSyncLoop(){const t=()=>{if(!this.isActive()){x.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}const e=[];for(const[,r]of this.attachmentMap)r.needRealtimeSync()&&(r.remoteChangeEventReceived=!1,e.push(this.syncInternal(r,r.syncMode).catch(async s=>{throw s instanceof M&&nr(s)===d.ErrUnauthenticated&&r.doc.publish([{type:X.AuthError,value:{reason:Vr(s).reason,method:"PushPull"}}]),s})));Promise.all(e).then(()=>setTimeout(t,this.syncLoopDuration)).catch(async r=>{x.error(`[SL] c:"${this.getKey()}" sync failed:`,r),await this.handleConnectError(r)?setTimeout(t,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1})};x.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,t()}async runWatchLoop(t){const e=this.attachmentMap.get(t);if(!e)throw new m(d.ErrDocumentNotAttached,`${t} is not attached`);return this.conditions.WatchLoop=!0,e.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new m(d.ErrClientNotActivated,`${this.key} is not active`));const s=new AbortController,i=this.rpcClient.watchDocument({clientId:this.id,documentId:e.docID},{headers:{"x-shard-key":`${this.apiKey}/${t}`},signal:s.signal});return e.doc.publish([{type:X.ConnectionChanged,value:on.Connected}]),x.info(`[WD] c:"${this.getKey()}" watches d:"${t}"`),new Promise((o,c)=>{(async()=>{try{for await(const h of i)this.handleWatchDocumentsResponse(e,h),h.body.case==="initialization"&&o([i,s])}catch(h){e.doc.resetOnlineClients(),e.doc.publish([{type:X.Initialized,source:J.Local,value:e.doc.getPresences()}]),e.doc.publish([{type:X.ConnectionChanged,value:on.Disconnected}]),x.debug(`[WD] c:"${this.getKey()}" unwatches`),await this.handleConnectError(h)?(h instanceof M&&nr(h)===d.ErrUnauthenticated&&e.doc.publish([{type:X.AuthError,value:{reason:Vr(h).reason,method:"WatchDocuments"}}]),r()):this.conditions.WatchLoop=!1,c(h)}})()})})}handleWatchDocumentsResponse(t,e){if(e.body.case==="event"&&e.body.value.type===wr.DOCUMENT_CHANGED){t.remoteChangeEventReceived=!0;return}t.doc.applyWatchStream(e)}deactivateInternal(){this.status="deactivated";for(const[t,e]of this.attachmentMap)this.detachInternal(t),e.doc.applyStatus(ir.Detached)}detachInternal(t){const e=this.attachmentMap.get(t);e&&(e.cancelWatchStream(),e.unsubscribeBroadcastEvent(),this.attachmentMap.delete(t))}syncInternal(t,e){const{doc:r,docID:s}=t,i=r.createChangePack();return this.rpcClient.pushPullChanges({clientId:this.id,documentId:s,changePack:j.toChangePack(i),pushOnly:e==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${r.getKey()}`}}).then(o=>{const c=j.fromChangePack(o.changePack);if(c.hasChanges()&&(t.syncMode==="realtime-pushonly"||t.syncMode==="realtime-syncoff"))return r;r.applyChangePack(c),t.doc.publish([{type:X.SyncStatusChanged,value:Fs.Synced}]),r.getStatus()===ir.Removed&&this.detachInternal(r.getKey());const l=r.getKey(),h=c.getChangeSize();return x.info(`[PP] c:"${this.getKey()}" sync d:"${l}", push:${i.getChangeSize()} pull:${h} cp:${c.getCheckpoint().toTestString()}`),r}).catch(async o=>{throw r.publish([{type:X.SyncStatusChanged,value:Fs.SyncFailed}]),x.error(`[PP] c:"${this.getKey()}" err :`,o),o})}async handleConnectError(t){if(!(t instanceof M))return!1;if(t.code===R.Canceled||t.code===R.Unknown||t.code===R.ResourceExhausted||t.code===R.Unavailable)return!0;if(nr(t)===d.ErrUnauthenticated){if(this.authTokenInjector){const e=await this.authTokenInjector(Vr(t).reason);this.setAuthToken(e)}return!0}return nr(t)===d.ErrTooManySubscribers?(x.error(`[WD] c:"${this.getKey()}" err :`,t.rawMessage),!0):(nr(t)===d.ErrTooManyAttachments||(nr(t)===d.ErrClientNotActivated||nr(t)===d.ErrClientNotFound)&&this.deactivateInternal(),!1)}enqueueTask(t){return new Promise((e,r)=>{this.taskQueue.push(()=>t().then(e).catch(r)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{x.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}const Yi={Client:ca,Document:aa,IntType:je.IntegerCnt,LongType:je.LongCnt};typeof globalThis<"u"&&(globalThis.yorkie={Client:ca,Document:aa,Primitive:z,Text:ri,Counter:ni,Tree:ii,LogLevel:te,setLogLevel:Fu,IntType:je.IntegerCnt,LongType:je.LongCnt});const mr={isOnline:!1,showOffline:(n,t,e)=>{mr.isOnline=!1,n.innerHTML='<span class="red"> </span>',t.disabled=!0,e.innerHTML="Stream subscription is disconnected"},showOnline:(n,t,e)=>{mr.isOnline=!0,n.innerHTML='<span class="green"> </span>',t.disabled=!1,e.innerHTML=""},statusListener:(n,t,e)=>r=>{mr.isOnline&&r.value===on.Disconnected?mr.showOffline(n,t,e):!mr.isOnline&&r.value===on.Connected&&mr.showOnline(n,t,e)}};function rl(n,t,e){const r=[];for(const{clientID:s,presence:i}of t)r.push(e===s?`<b>${i.username}</b>`:i.username);n.innerHTML=r.join(", ")}function Xi(n,t){n.innerHTML=`<b>${t}</b>`}const nl=document.getElementById("peers"),Zi=document.getElementById("counter-value"),Qi=document.getElementById("increment"),_i=document.getElementById("error"),sl=document.getElementById("connection-status"),il=document.getElementById("peers-container"),ol=document.getElementById("connection-status-container"),al=document.getElementById("counter-container");async function cl(){const n=new Yi.Client("http://localhost:8080",{apiKey:""});await n.activate(),window.addEventListener("beforeunload",()=>{n.deactivate({keepalive:!0})});const t=new Yi.Document("vanilla-document-limit",{enableDevtools:!0});t.subscribe("presence",r=>{if(r.type!==X.PresenceChanged){const s=t.getPresences();rl(nl,s,n.getID())}}),t.subscribe("connection",r=>{mr.statusListener(sl,Qi,_i)(r)}),t.subscribe(()=>{const r=t.getRoot();Xi(Zi,r.counter)}),t.subscribe("status",r=>{console.log(r)}),Qi.addEventListener("click",()=>{t.update(r=>{const s=r;s.counter+=1},"increment counter")}),await n.attach(t,{initialRoot:{counter:0},initialPresence:{username:n.getID().slice(-2)}}).catch(r=>{r.message.includes("attachment limit exceeded")&&(_i.innerHTML=`<p>${r.message}</p>`,il.innerHTML="",ol.innerHTML="",al.innerHTML="")});const e=t.getRoot();Xi(Zi,e.counter)}cl();
