var Tp=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var jw=Tp((Nn,wn)=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var Pe;(function(n){n[n.Canceled=1]="Canceled",n[n.Unknown=2]="Unknown",n[n.InvalidArgument=3]="InvalidArgument",n[n.DeadlineExceeded=4]="DeadlineExceeded",n[n.NotFound=5]="NotFound",n[n.AlreadyExists=6]="AlreadyExists",n[n.PermissionDenied=7]="PermissionDenied",n[n.ResourceExhausted=8]="ResourceExhausted",n[n.FailedPrecondition=9]="FailedPrecondition",n[n.Aborted=10]="Aborted",n[n.OutOfRange=11]="OutOfRange",n[n.Unimplemented=12]="Unimplemented",n[n.Internal=13]="Internal",n[n.Unavailable=14]="Unavailable",n[n.DataLoss=15]="DataLoss",n[n.Unauthenticated=16]="Unauthenticated"})(Pe||(Pe={}));function Jl(n,e){return n!==null&&typeof n=="object"&&"$typeName"in n&&typeof n.$typeName=="string"?e===void 0?!0:e.typeName===n.$typeName:!1}var V;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(V||(V={}));function xp(){let n=0,e=0;for(let r=0;r<28;r+=7){let s=this.buf[this.pos++];if(n|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,e]}let t=this.buf[this.pos++];if(n|=(t&15)<<28,e=(t&112)>>4,(t&128)==0)return this.assertBounds(),[n,e];for(let r=3;r<=31;r+=7){let s=this.buf[this.pos++];if(e|=(s&127)<<r,(s&128)==0)return this.assertBounds(),[n,e]}throw new Error("invalid varint")}function Ya(n,e,t){for(let i=0;i<28;i=i+7){const o=n>>>i,a=!(!(o>>>7)&&e==0),l=(a?o|128:o)&255;if(t.push(l),!a)return}const r=n>>>28&15|(e&7)<<4,s=e>>3!=0;if(t.push((s?r|128:r)&255),!!s){for(let i=3;i<31;i=i+7){const o=e>>>i,a=!!(o>>>7),l=(a?o|128:o)&255;if(t.push(l),!a)return}t.push(e>>>31&1)}}const ia=4294967296;function au(n){const e=n[0]==="-";e&&(n=n.slice(1));const t=1e6;let r=0,s=0;function i(o,a){const l=Number(n.slice(o,a));s*=t,r=r*t+l,r>=ia&&(s=s+(r/ia|0),r=r%ia)}return i(-24,-18),i(-18,-12),i(-12,-6),i(-6),e?Mf(r,s):Hl(r,s)}function Cp(n,e){let t=Hl(n,e);const r=t.hi&2147483648;r&&(t=Mf(t.lo,t.hi));const s=Pf(t.lo,t.hi);return r?"-"+s:s}function Pf(n,e){if({lo:n,hi:e}=Rp(n,e),e<=2097151)return String(ia*e+n);const t=n&16777215,r=(n>>>24|e<<8)&16777215,s=e>>16&65535;let i=t+r*6777216+s*6710656,o=r+s*8147497,a=s*2;const l=1e7;return i>=l&&(o+=Math.floor(i/l),i%=l),o>=l&&(a+=Math.floor(o/l),o%=l),a.toString()+lu(o)+lu(i)}function Rp(n,e){return{lo:n>>>0,hi:e>>>0}}function Hl(n,e){return{lo:n|0,hi:e|0}}function Mf(n,e){return e=~e,n?n=~n+1:e+=1,Hl(n,e)}const lu=n=>{const e=String(n);return"0000000".slice(e.length)+e};function El(n,e){if(n>=0){for(;n>127;)e.push(n&127|128),n=n>>>7;e.push(n)}else{for(let t=0;t<9;t++)e.push(n&127|128),n=n>>7;e.push(1)}}function _p(){let n=this.buf[this.pos++],e=n&127;if((n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<7,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<14,(n&128)==0)return this.assertBounds(),e;if(n=this.buf[this.pos++],e|=(n&127)<<21,(n&128)==0)return this.assertBounds(),e;n=this.buf[this.pos++],e|=(n&15)<<28;for(let t=5;(n&128)!==0&&t<10;t++)n=this.buf[this.pos++];if((n&128)!=0)throw new Error("invalid varint");return this.assertBounds(),e>>>0}var cu={};const gt=Lp();function Lp(){const n=new DataView(new ArrayBuffer(8));if(typeof BigInt=="function"&&typeof n.getBigInt64=="function"&&typeof n.getBigUint64=="function"&&typeof n.setBigInt64=="function"&&typeof n.setBigUint64=="function"&&(!!globalThis.Deno||typeof process!="object"||typeof cu!="object"||cu.BUF_BIGINT_DISABLE!=="1")){const t=BigInt("-9223372036854775808"),r=BigInt("9223372036854775807"),s=BigInt("0"),i=BigInt("18446744073709551615");return{zero:BigInt(0),supported:!0,parse(o){const a=typeof o=="bigint"?o:BigInt(o);if(a>r||a<t)throw new Error(`invalid int64: ${o}`);return a},uParse(o){const a=typeof o=="bigint"?o:BigInt(o);if(a>i||a<s)throw new Error(`invalid uint64: ${o}`);return a},enc(o){return n.setBigInt64(0,this.parse(o),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},uEnc(o){return n.setBigInt64(0,this.uParse(o),!0),{lo:n.getInt32(0,!0),hi:n.getInt32(4,!0)}},dec(o,a){return n.setInt32(0,o,!0),n.setInt32(4,a,!0),n.getBigInt64(0,!0)},uDec(o,a){return n.setInt32(0,o,!0),n.setInt32(4,a,!0),n.getBigUint64(0,!0)}}}return{zero:"0",supported:!1,parse(t){return typeof t!="string"&&(t=t.toString()),uu(t),t},uParse(t){return typeof t!="string"&&(t=t.toString()),hu(t),t},enc(t){return typeof t!="string"&&(t=t.toString()),uu(t),au(t)},uEnc(t){return typeof t!="string"&&(t=t.toString()),hu(t),au(t)},dec(t,r){return Cp(t,r)},uDec(t,r){return Pf(t,r)}}}function uu(n){if(!/^-?[0-9]+$/.test(n))throw new Error("invalid int64: "+n)}function hu(n){if(!/^[0-9]+$/.test(n))throw new Error("invalid uint64: "+n)}function Ps(n,e){switch(n){case V.STRING:return"";case V.BOOL:return!1;case V.DOUBLE:case V.FLOAT:return 0;case V.INT64:case V.UINT64:case V.SFIXED64:case V.FIXED64:case V.SINT64:return e?"0":gt.zero;case V.BYTES:return new Uint8Array(0);default:return 0}}function Op(n,e){switch(n){case V.BOOL:return e===!1;case V.STRING:return e==="";case V.BYTES:return e instanceof Uint8Array&&!e.byteLength;default:return e==0}}const Uf=2,Fr=Symbol.for("reflect unsafe local");function Wf(n,e){const t=n[e.localName].case;return t===void 0?t:e.fields.find(r=>r.localName===t)}function kp(n,e){const t=e.localName;if(e.oneof)return n[e.oneof.localName].case===t;if(e.presence!=Uf)return n[t]!==void 0&&Object.prototype.hasOwnProperty.call(n,t);switch(e.fieldKind){case"list":return n[t].length>0;case"map":return Object.keys(n[t]).length>0;case"scalar":return!Op(e.scalar,n[t]);case"enum":return n[t]!==e.enum.values[0].number}throw new Error("message field with implicit presence")}function io(n,e){return Object.prototype.hasOwnProperty.call(n,e)&&n[e]!==void 0}function Ff(n,e){if(e.oneof){const t=n[e.oneof.localName];return t.case===e.localName?t.value:void 0}return n[e.localName]}function Zf(n,e,t){e.oneof?n[e.oneof.localName]={case:e.localName,value:t}:n[e.localName]=t}function Dp(n,e){const t=e.localName;if(e.oneof){const r=e.oneof.localName;n[r].case===t&&(n[r]={case:void 0})}else if(e.presence!=Uf)delete n[t];else switch(e.fieldKind){case"map":n[t]={};break;case"list":n[t]=[];break;case"enum":n[t]=e.enum.values[0].number;break;case"scalar":n[t]=Ps(e.scalar,e.longAsString);break}}function vs(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function Ql(n,e){var t,r,s,i;if(vs(n)&&Fr in n&&"add"in n&&"field"in n&&typeof n.field=="function"){if(e!==void 0){const o=e,a=n.field();return o.listKind==a.listKind&&o.scalar===a.scalar&&((t=o.message)===null||t===void 0?void 0:t.typeName)===((r=a.message)===null||r===void 0?void 0:r.typeName)&&((s=o.enum)===null||s===void 0?void 0:s.typeName)===((i=a.enum)===null||i===void 0?void 0:i.typeName)}return!0}return!1}function ec(n,e){var t,r,s,i;if(vs(n)&&Fr in n&&"has"in n&&"field"in n&&typeof n.field=="function"){if(e!==void 0){const o=e,a=n.field();return o.mapKey===a.mapKey&&o.mapKind==a.mapKind&&o.scalar===a.scalar&&((t=o.message)===null||t===void 0?void 0:t.typeName)===((r=a.message)===null||r===void 0?void 0:r.typeName)&&((s=o.enum)===null||s===void 0?void 0:s.typeName)===((i=a.enum)===null||i===void 0?void 0:i.typeName)}return!0}return!1}function tc(n,e){return vs(n)&&Fr in n&&"desc"in n&&vs(n.desc)&&n.desc.kind==="message"&&(e===void 0||n.desc.typeName==e.typeName)}function Bp(n){return Gf(n.$typeName)}function Io(n){const e=n.fields[0];return Gf(n.typeName)&&e!==void 0&&e.fieldKind=="scalar"&&e.name=="value"&&e.number==1}function Gf(n){return n.startsWith("google.protobuf.")&&["DoubleValue","FloatValue","Int64Value","UInt64Value","Int32Value","UInt32Value","BoolValue","StringValue","BytesValue"].includes(n.substring(16))}const Vp=999,Pp=998,oa=2;function fe(n,e){if(Jl(e,n))return e;const t=Zp(n);return e!==void 0&&Mp(n,t,e),t}function Mp(n,e,t){for(const r of n.members){let s=t[r.localName];if(s==null)continue;let i;if(r.kind=="oneof"){const o=Wf(t,r);if(!o)continue;i=o,s=Ff(t,o)}else i=r;switch(i.fieldKind){case"message":s=nc(i,s);break;case"scalar":s=$f(i,s);break;case"list":s=Wp(i,s);break;case"map":s=Up(i,s);break}Zf(e,i,s)}return e}function $f(n,e){return n.scalar==V.BYTES?rc(e):e}function Up(n,e){if(vs(e)){if(n.scalar==V.BYTES)return fu(e,rc);if(n.mapKind=="message")return fu(e,t=>nc(n,t))}return e}function Wp(n,e){if(Array.isArray(e)){if(n.scalar==V.BYTES)return e.map(rc);if(n.listKind=="message")return e.map(t=>nc(n,t))}return e}function nc(n,e){if(n.fieldKind=="message"&&!n.oneof&&Io(n.message))return $f(n.message.fields[0],e);if(vs(e)){if(n.message.typeName=="google.protobuf.Struct"&&n.parent.typeName!=="google.protobuf.Value")return e;if(!Jl(e,n.message))return fe(n.message,e)}return e}function rc(n){return Array.isArray(n)?new Uint8Array(n):n}function fu(n,e){const t={};for(const r of Object.entries(n))t[r[0]]=e(r[1]);return t}const Fp=Symbol(),du=new WeakMap;function Zp(n){let e;if(Gp(n)){const t=du.get(n);let r,s;if(t)({prototype:r,members:s}=t);else{r={},s=new Set;for(const i of n.members)i.kind!="oneof"&&(i.fieldKind!="scalar"&&i.fieldKind!="enum"||i.presence!=oa&&(s.add(i),r[i.localName]=qa(i)));du.set(n,{prototype:r,members:s})}e=Object.create(r),e.$typeName=n.typeName;for(const i of n.members)s.has(i)||i.kind=="field"&&(i.fieldKind=="message"||(i.fieldKind=="scalar"||i.fieldKind=="enum")&&i.presence!=oa)||(e[i.localName]=qa(i))}else{e={$typeName:n.typeName};for(const t of n.members)(t.kind=="oneof"||t.presence==oa)&&(e[t.localName]=qa(t))}return e}function Gp(n){switch(n.file.edition){case Vp:return!1;case Pp:return!0;default:return n.fields.some(e=>e.presence!=oa&&e.fieldKind!="message"&&!e.oneof)}}function qa(n){if(n.kind=="oneof")return{case:void 0};if(n.fieldKind=="list")return[];if(n.fieldKind=="map")return{};if(n.fieldKind=="message")return Fp;const e=n.getDefaultValue();return e!==void 0?n.fieldKind=="scalar"&&n.longAsString?e.toString():e:n.fieldKind=="scalar"?Ps(n.scalar,n.longAsString):n.enum.values[0].number}const $p=["FieldValueInvalidError","FieldListRangeError","ForeignFieldError"];class yn extends Error{constructor(e,t,r="FieldValueInvalidError"){super(t),this.name=r,this.field=()=>e}}function Kp(n){return n instanceof Error&&$p.includes(n.name)&&"field"in n&&typeof n.field=="function"}const za=Symbol.for("@bufbuild/protobuf/text-encoding");function sc(){if(globalThis[za]==null){const n=new globalThis.TextEncoder,e=new globalThis.TextDecoder;globalThis[za]={encodeUtf8(t){return n.encode(t)},decodeUtf8(t){return e.decode(t)},checkUtf8(t){try{return encodeURIComponent(t),!0}catch{return!1}}}}return globalThis[za]}var Nt;(function(n){n[n.Varint=0]="Varint",n[n.Bit64=1]="Bit64",n[n.LengthDelimited=2]="LengthDelimited",n[n.StartGroup=3]="StartGroup",n[n.EndGroup=4]="EndGroup",n[n.Bit32=5]="Bit32"})(Nt||(Nt={}));const Kf=34028234663852886e22,jf=-34028234663852886e22,Yf=4294967295,qf=2147483647,zf=-2147483648;class Xf{constructor(e=sc().encodeUtf8){this.encodeUtf8=e,this.stack=[],this.chunks=[],this.buf=[]}finish(){this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]);let e=0;for(let s=0;s<this.chunks.length;s++)e+=this.chunks[s].length;let t=new Uint8Array(e),r=0;for(let s=0;s<this.chunks.length;s++)t.set(this.chunks[s],r),r+=this.chunks[s].length;return this.chunks=[],t}fork(){return this.stack.push({chunks:this.chunks,buf:this.buf}),this.chunks=[],this.buf=[],this}join(){let e=this.finish(),t=this.stack.pop();if(!t)throw new Error("invalid state, fork stack empty");return this.chunks=t.chunks,this.buf=t.buf,this.uint32(e.byteLength),this.raw(e)}tag(e,t){return this.uint32((e<<3|t)>>>0)}raw(e){return this.buf.length&&(this.chunks.push(new Uint8Array(this.buf)),this.buf=[]),this.chunks.push(e),this}uint32(e){for(gu(e);e>127;)this.buf.push(e&127|128),e=e>>>7;return this.buf.push(e),this}int32(e){return Xa(e),El(e,this.buf),this}bool(e){return this.buf.push(e?1:0),this}bytes(e){return this.uint32(e.byteLength),this.raw(e)}string(e){let t=this.encodeUtf8(e);return this.uint32(t.byteLength),this.raw(t)}float(e){jp(e);let t=new Uint8Array(4);return new DataView(t.buffer).setFloat32(0,e,!0),this.raw(t)}double(e){let t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),this.raw(t)}fixed32(e){gu(e);let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,e,!0),this.raw(t)}sfixed32(e){Xa(e);let t=new Uint8Array(4);return new DataView(t.buffer).setInt32(0,e,!0),this.raw(t)}sint32(e){return Xa(e),e=(e<<1^e>>31)>>>0,El(e,this.buf),this}sfixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=gt.enc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}fixed64(e){let t=new Uint8Array(8),r=new DataView(t.buffer),s=gt.uEnc(e);return r.setInt32(0,s.lo,!0),r.setInt32(4,s.hi,!0),this.raw(t)}int64(e){let t=gt.enc(e);return Ya(t.lo,t.hi,this.buf),this}sint64(e){const t=gt.enc(e),r=t.hi>>31,s=t.lo<<1^r,i=(t.hi<<1|t.lo>>>31)^r;return Ya(s,i,this.buf),this}uint64(e){const t=gt.uEnc(e);return Ya(t.lo,t.hi,this.buf),this}}class ic{constructor(e,t=sc().decodeUtf8){this.decodeUtf8=t,this.varint64=xp,this.uint32=_p,this.buf=e,this.len=e.length,this.pos=0,this.view=new DataView(e.buffer,e.byteOffset,e.byteLength)}tag(){let e=this.uint32(),t=e>>>3,r=e&7;if(t<=0||r<0||r>5)throw new Error("illegal tag: field no "+t+" wire type "+r);return[t,r]}skip(e,t){let r=this.pos;switch(e){case Nt.Varint:for(;this.buf[this.pos++]&128;);break;case Nt.Bit64:this.pos+=4;case Nt.Bit32:this.pos+=4;break;case Nt.LengthDelimited:let s=this.uint32();this.pos+=s;break;case Nt.StartGroup:for(;;){const[i,o]=this.tag();if(o===Nt.EndGroup){if(t!==void 0&&i!==t)throw new Error("invalid end group tag");break}this.skip(o,i)}break;default:throw new Error("cant skip wire type "+e)}return this.assertBounds(),this.buf.subarray(r,this.pos)}assertBounds(){if(this.pos>this.len)throw new RangeError("premature EOF")}int32(){return this.uint32()|0}sint32(){let e=this.uint32();return e>>>1^-(e&1)}int64(){return gt.dec(...this.varint64())}uint64(){return gt.uDec(...this.varint64())}sint64(){let[e,t]=this.varint64(),r=-(e&1);return e=(e>>>1|(t&1)<<31)^r,t=t>>>1^r,gt.dec(e,t)}bool(){let[e,t]=this.varint64();return e!==0||t!==0}fixed32(){return this.view.getUint32((this.pos+=4)-4,!0)}sfixed32(){return this.view.getInt32((this.pos+=4)-4,!0)}fixed64(){return gt.uDec(this.sfixed32(),this.sfixed32())}sfixed64(){return gt.dec(this.sfixed32(),this.sfixed32())}float(){return this.view.getFloat32((this.pos+=4)-4,!0)}double(){return this.view.getFloat64((this.pos+=8)-8,!0)}bytes(){let e=this.uint32(),t=this.pos;return this.pos+=e,this.assertBounds(),this.buf.subarray(t,t+e)}string(){return this.decodeUtf8(this.bytes())}}function Xa(n){if(typeof n=="string")n=Number(n);else if(typeof n!="number")throw new Error("invalid int32: "+typeof n);if(!Number.isInteger(n)||n>qf||n<zf)throw new Error("invalid int32: "+n)}function gu(n){if(typeof n=="string")n=Number(n);else if(typeof n!="number")throw new Error("invalid uint32: "+typeof n);if(!Number.isInteger(n)||n>Yf||n<0)throw new Error("invalid uint32: "+n)}function jp(n){if(typeof n=="string"){const e=n;if(n=Number(n),Number.isNaN(n)&&e!=="NaN")throw new Error("invalid float32: "+e)}else if(typeof n!="number")throw new Error("invalid float32: "+typeof n);if(Number.isFinite(n)&&(n>Kf||n<jf))throw new Error("invalid float32: "+n)}function Rs(n,e){const t=n.fieldKind=="list"?Ql(e,n):n.fieldKind=="map"?ec(e,n):oc(n,e);if(t===!0)return;let r;switch(n.fieldKind){case"list":r=`expected ${Qf(n)}, got ${Mt(e)}`;break;case"map":r=`expected ${ed(n)}, got ${Mt(e)}`;break;default:r=ha(n,e,t)}return new yn(n,r)}function pu(n,e,t){const r=oc(n,t);if(r!==!0)return new yn(n,`list item #${e+1}: ${ha(n,t,r)}`)}function Yp(n,e,t){const r=Jf(e,n.mapKey);if(r!==!0)return new yn(n,`invalid map key: ${ha({scalar:n.mapKey},e,r)}`);const s=oc(n,t);if(s!==!0)return new yn(n,`map entry ${Mt(e)}: ${ha(n,t,s)}`)}function oc(n,e){return n.scalar!==void 0?Jf(e,n.scalar):n.enum!==void 0?n.enum.open?Number.isInteger(e):n.enum.values.some(t=>t.number===e):tc(e,n.message)}function Jf(n,e){switch(e){case V.DOUBLE:return typeof n=="number";case V.FLOAT:return typeof n!="number"?!1:Number.isNaN(n)||!Number.isFinite(n)?!0:n>Kf||n<jf?`${n.toFixed()} out of range`:!0;case V.INT32:case V.SFIXED32:case V.SINT32:return typeof n!="number"||!Number.isInteger(n)?!1:n>qf||n<zf?`${n.toFixed()} out of range`:!0;case V.FIXED32:case V.UINT32:return typeof n!="number"||!Number.isInteger(n)?!1:n>Yf||n<0?`${n.toFixed()} out of range`:!0;case V.BOOL:return typeof n=="boolean";case V.STRING:return typeof n!="string"?!1:sc().checkUtf8(n)||"invalid UTF8";case V.BYTES:return n instanceof Uint8Array;case V.INT64:case V.SFIXED64:case V.SINT64:if(typeof n=="bigint"||typeof n=="number"||typeof n=="string"&&n.length>0)try{return gt.parse(n),!0}catch{return`${n} out of range`}return!1;case V.FIXED64:case V.UINT64:if(typeof n=="bigint"||typeof n=="number"||typeof n=="string"&&n.length>0)try{return gt.uParse(n),!0}catch{return`${n} out of range`}return!1}}function ha(n,e,t){return t=typeof t=="string"?`: ${t}`:`, got ${Mt(e)}`,n.scalar!==void 0?`expected ${qp(n.scalar)}`+t:n.enum!==void 0?`expected ${n.enum.toString()}`+t:`expected ${Hf(n.message)}`+t}function Mt(n){switch(typeof n){case"object":return n===null?"null":n instanceof Uint8Array?`Uint8Array(${n.length})`:Array.isArray(n)?`Array(${n.length})`:Ql(n)?Qf(n.field()):ec(n)?ed(n.field()):tc(n)?Hf(n.desc):Jl(n)?`message ${n.$typeName}`:"object";case"string":return n.length>30?"string":`"${n.split('"').join('\\"')}"`;case"boolean":return String(n);case"number":return String(n);case"bigint":return String(n)+"n";default:return typeof n}}function Hf(n){return`ReflectMessage (${n.typeName})`}function Qf(n){switch(n.listKind){case"message":return`ReflectList (${n.message.toString()})`;case"enum":return`ReflectList (${n.enum.toString()})`;case"scalar":return`ReflectList (${V[n.scalar]})`}}function ed(n){switch(n.mapKind){case"message":return`ReflectMap (${V[n.mapKey]}, ${n.message.toString()})`;case"enum":return`ReflectMap (${V[n.mapKey]}, ${n.enum.toString()})`;case"scalar":return`ReflectMap (${V[n.mapKey]}, ${V[n.scalar]})`}}function qp(n){switch(n){case V.STRING:return"string";case V.BOOL:return"boolean";case V.INT64:case V.SINT64:case V.SFIXED64:return"bigint (int64)";case V.UINT64:case V.FIXED64:return"bigint (uint64)";case V.BYTES:return"Uint8Array";case V.DOUBLE:return"number (float64)";case V.FLOAT:return"number (float32)";case V.FIXED32:case V.UINT32:return"number (uint32)";case V.INT32:case V.SFIXED32:case V.SINT32:return"number (int32)"}}function Zn(n,e,t=!0){return new td(n,e,t)}const mu=new WeakMap;class td{get sortedFields(){const e=mu.get(this.desc);if(e)return e;const t=this.desc.fields.concat().sort((r,s)=>r.number-s.number);return mu.set(this.desc,t),t}constructor(e,t,r=!0){this.lists=new Map,this.maps=new Map,this.check=r,this.desc=e,this.message=this[Fr]=t??fe(e),this.fields=e.fields,this.oneofs=e.oneofs,this.members=e.members}findNumber(e){return this._fieldsByNumber||(this._fieldsByNumber=new Map(this.desc.fields.map(t=>[t.number,t]))),this._fieldsByNumber.get(e)}oneofCase(e){return Wi(this.message,e),Wf(this.message,e)}isSet(e){return Wi(this.message,e),kp(this.message,e)}clear(e){Wi(this.message,e),Dp(this.message,e)}get(e){Wi(this.message,e);const t=Ff(this.message,e);switch(e.fieldKind){case"list":let r=this.lists.get(e);return(!r||r[Fr]!==t)&&this.lists.set(e,r=new zp(e,t,this.check)),r;case"map":let s=this.maps.get(e);return(!s||s[Fr]!==t)&&this.maps.set(e,s=new Xp(e,t,this.check)),s;case"message":return lc(e,t,this.check);case"scalar":return t===void 0?Ps(e.scalar,!1):cc(e,t);case"enum":return t??e.enum.values[0].number}}set(e,t){if(Wi(this.message,e),this.check){const s=Rs(e,t);if(s)throw s}let r;e.fieldKind=="message"?r=ac(e,t):ec(t)||Ql(t)?r=t[Fr]:r=uc(e,t),Zf(this.message,e,r)}getUnknown(){return this.message.$unknown}setUnknown(e){this.message.$unknown=e}}function Wi(n,e){if(e.parent.typeName!==n.$typeName)throw new yn(e,`cannot use ${e.toString()} with message ${n.$typeName}`,"ForeignFieldError")}class zp{field(){return this._field}get size(){return this._arr.length}constructor(e,t,r){this._field=e,this._arr=this[Fr]=t,this.check=r}get(e){const t=this._arr[e];return t===void 0?void 0:Ja(this._field,t,this.check)}set(e,t){if(e<0||e>=this._arr.length)throw new yn(this._field,`list item #${e+1}: out of range`);if(this.check){const r=pu(this._field,e,t);if(r)throw r}this._arr[e]=bu(this._field,t)}add(e){if(this.check){const t=pu(this._field,this._arr.length,e);if(t)throw t}this._arr.push(bu(this._field,e))}clear(){this._arr.splice(0,this._arr.length)}[Symbol.iterator](){return this.values()}keys(){return this._arr.keys()}*values(){for(const e of this._arr)yield Ja(this._field,e,this.check)}*entries(){for(let e=0;e<this._arr.length;e++)yield[e,Ja(this._field,this._arr[e],this.check)]}}class Xp{constructor(e,t,r=!0){this.obj=this[Fr]=t??{},this.check=r,this._field=e}field(){return this._field}set(e,t){if(this.check){const r=Yp(this._field,e,t);if(r)throw r}return this.obj[Wo(e)]=Jp(this._field,t),this}delete(e){const t=Wo(e),r=Object.prototype.hasOwnProperty.call(this.obj,t);return r&&delete this.obj[t],r}clear(){for(const e of Object.keys(this.obj))delete this.obj[e]}get(e){let t=this.obj[Wo(e)];return t!==void 0&&(t=Ha(this._field,t,this.check)),t}has(e){return Object.prototype.hasOwnProperty.call(this.obj,Wo(e))}*keys(){for(const e of Object.keys(this.obj))yield yu(e,this._field.mapKey)}*entries(){for(const e of Object.entries(this.obj))yield[yu(e[0],this._field.mapKey),Ha(this._field,e[1],this.check)]}[Symbol.iterator](){return this.entries()}get size(){return Object.keys(this.obj).length}*values(){for(const e of Object.values(this.obj))yield Ha(this._field,e,this.check)}forEach(e,t){for(const r of this.entries())e.call(t,r[1],r[0],this)}}function ac(n,e){return tc(e)?Bp(e.message)&&!n.oneof&&n.fieldKind=="message"?e.message.value:e.desc.typeName=="google.protobuf.Struct"&&n.parent.typeName!="google.protobuf.Value"?rd(e.message):e.message:e}function lc(n,e,t){return e!==void 0&&(Io(n.message)&&!n.oneof&&n.fieldKind=="message"?e={$typeName:n.message.typeName,value:cc(n.message.fields[0],e)}:n.message.typeName=="google.protobuf.Struct"&&n.parent.typeName!="google.protobuf.Value"&&vs(e)&&(e=nd(e))),new td(n.message,e,t)}function bu(n,e){return n.listKind=="message"?ac(n,e):uc(n,e)}function Ja(n,e,t){return n.listKind=="message"?lc(n,e,t):cc(n,e)}function Jp(n,e){return n.mapKind=="message"?ac(n,e):uc(n,e)}function Ha(n,e,t){return n.mapKind=="message"?lc(n,e,t):e}function Wo(n){return typeof n=="string"||typeof n=="number"?n:String(n)}function yu(n,e){switch(e){case V.STRING:return n;case V.INT32:case V.FIXED32:case V.UINT32:case V.SFIXED32:case V.SINT32:{const t=Number.parseInt(n);if(Number.isFinite(t))return t;break}case V.BOOL:switch(n){case"true":return!0;case"false":return!1}break;case V.UINT64:case V.FIXED64:try{return gt.uParse(n)}catch{}break;default:try{return gt.parse(n)}catch{}break}return n}function cc(n,e){switch(n.scalar){case V.INT64:case V.SFIXED64:case V.SINT64:"longAsString"in n&&n.longAsString&&typeof e=="string"&&(e=gt.parse(e));break;case V.FIXED64:case V.UINT64:"longAsString"in n&&n.longAsString&&typeof e=="string"&&(e=gt.uParse(e));break}return e}function uc(n,e){switch(n.scalar){case V.INT64:case V.SFIXED64:case V.SINT64:"longAsString"in n&&n.longAsString?e=String(e):(typeof e=="string"||typeof e=="number")&&(e=gt.parse(e));break;case V.FIXED64:case V.UINT64:"longAsString"in n&&n.longAsString?e=String(e):(typeof e=="string"||typeof e=="number")&&(e=gt.uParse(e));break}return e}function nd(n){const e={$typeName:"google.protobuf.Struct",fields:{}};if(vs(n))for(const[t,r]of Object.entries(n))e.fields[t]=id(r);return e}function rd(n){const e={};for(const[t,r]of Object.entries(n.fields))e[t]=sd(r);return e}function sd(n){switch(n.kind.case){case"structValue":return rd(n.kind.value);case"listValue":return n.kind.value.values.map(sd);case"nullValue":case void 0:return null;default:return n.kind.value}}function id(n){const e={$typeName:"google.protobuf.Value",kind:{case:void 0}};switch(typeof n){case"number":e.kind={case:"numberValue",value:n};break;case"string":e.kind={case:"stringValue",value:n};break;case"boolean":e.kind={case:"boolValue",value:n};break;case"object":if(n===null)e.kind={case:"nullValue",value:0};else if(Array.isArray(n)){const t={$typeName:"google.protobuf.ListValue",values:[]};if(Array.isArray(n))for(const r of n)t.values.push(id(r));e.kind={case:"listValue",value:t}}else e.kind={case:"structValue",value:nd(n)};break}return e}function hc(n){const e=Qp();let t=n.length*3/4;n[n.length-2]=="="?t-=2:n[n.length-1]=="="&&(t-=1);let r=new Uint8Array(t),s=0,i=0,o,a=0;for(let l=0;l<n.length;l++){if(o=e[n.charCodeAt(l)],o===void 0)switch(n[l]){case"=":i=0;case`
`:case"\r":case"	":case" ":continue;default:throw Error("invalid base64 string")}switch(i){case 0:a=o,i=1;break;case 1:r[s++]=a<<2|(o&48)>>4,a=o,i=2;break;case 2:r[s++]=(a&15)<<4|(o&60)>>2,a=o,i=3;break;case 3:r[s++]=(a&3)<<6|o,i=0;break}}if(i==1)throw Error("invalid base64 string");return r.subarray(0,s)}function Hp(n,e="std"){const t=od(e),r=e=="std";let s="",i=0,o,a=0;for(let l=0;l<n.length;l++)switch(o=n[l],i){case 0:s+=t[o>>2],a=(o&3)<<4,i=1;break;case 1:s+=t[a|o>>4],a=(o&15)<<2,i=2;break;case 2:s+=t[a|o>>6],s+=t[o&63],i=0;break}return i&&(s+=t[a],r&&(s+="=",i==1&&(s+="="))),s}let Fo,vu,ei;function od(n){return Fo||(Fo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),vu=Fo.slice(0,-2).concat("-","_")),n=="url"?vu:Fo}function Qp(){if(!ei){ei=[];const n=od("std");for(let e=0;e<n.length;e++)ei[n[e].charCodeAt(0)]=e;ei[45]=n.indexOf("+"),ei[95]=n.indexOf("/")}return ei}function oo(n){let e=!1;const t=[];for(let r=0;r<n.length;r++){let s=n.charAt(r);switch(s){case"_":e=!0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":t.push(s),e=!1;break;default:e&&(e=!1,s=s.toUpperCase()),t.push(s);break}}return t.join("")}const em=new Set(["constructor","toString","toJSON","valueOf"]);function ao(n){return em.has(n)?n+"$":n}function fc(n){for(const e of n.field)io(e,"jsonName")||(e.jsonName=oo(e.name));n.nestedType.forEach(fc)}function tm(n,e){const t=n.values.find(r=>r.name===e);if(!t)throw new Error(`cannot parse ${n} default value: ${e}`);return t.number}function nm(n,e){switch(n){case V.STRING:return e;case V.BYTES:{const t=rm(e);if(t===!1)throw new Error(`cannot parse ${V[n]} default value: ${e}`);return t}case V.INT64:case V.SFIXED64:case V.SINT64:return gt.parse(e);case V.UINT64:case V.FIXED64:return gt.uParse(e);case V.DOUBLE:case V.FLOAT:switch(e){case"inf":return Number.POSITIVE_INFINITY;case"-inf":return Number.NEGATIVE_INFINITY;case"nan":return Number.NaN;default:return parseFloat(e)}case V.BOOL:return e==="true";case V.INT32:case V.UINT32:case V.SINT32:case V.FIXED32:case V.SFIXED32:return parseInt(e,10)}}function rm(n){const e=[],t={tail:n,c:"",next(){return this.tail.length==0?!1:(this.c=this.tail[0],this.tail=this.tail.substring(1),!0)},take(r){if(this.tail.length>=r){const s=this.tail.substring(0,r);return this.tail=this.tail.substring(r),s}return!1}};for(;t.next();)switch(t.c){case"\\":if(t.next())switch(t.c){case"\\":e.push(t.c.charCodeAt(0));break;case"b":e.push(8);break;case"f":e.push(12);break;case"n":e.push(10);break;case"r":e.push(13);break;case"t":e.push(9);break;case"v":e.push(11);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":{const r=t.c,s=t.take(2);if(s===!1)return!1;const i=parseInt(r+s,8);if(Number.isNaN(i))return!1;e.push(i);break}case"x":{const r=t.c,s=t.take(2);if(s===!1)return!1;const i=parseInt(r+s,16);if(Number.isNaN(i))return!1;e.push(i);break}case"u":{const r=t.c,s=t.take(4);if(s===!1)return!1;const i=parseInt(r+s,16);if(Number.isNaN(i))return!1;const o=new Uint8Array(4);new DataView(o.buffer).setInt32(0,i,!0),e.push(o[0],o[1],o[2],o[3]);break}case"U":{const r=t.c,s=t.take(8);if(s===!1)return!1;const i=gt.uEnc(r+s),o=new Uint8Array(8),a=new DataView(o.buffer);a.setInt32(0,i.lo,!0),a.setInt32(4,i.hi,!0),e.push(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7]);break}}break;default:e.push(t.c.charCodeAt(0))}return new Uint8Array(e)}function*Sl(n){switch(n.kind){case"file":for(const e of n.messages)yield e,yield*Sl(e);yield*n.enums,yield*n.services,yield*n.extensions;break;case"message":for(const e of n.nestedMessages)yield e,yield*Sl(e);yield*n.nestedEnums,yield*n.nestedExtensions;break}}function ad(...n){const e=sm();if(!n.length)return e;if("$typeName"in n[0]&&n[0].$typeName=="google.protobuf.FileDescriptorSet"){for(const r of n[0].file)Iu(r,e);return e}if("$typeName"in n[0]){let o=function(a){const l=[];for(const c of a.dependency){if(e.getFile(c)!=null||i.has(c))continue;const f=s(c);if(!f)throw new Error(`Unable to resolve ${c}, imported by ${a.name}`);"kind"in f?e.addFile(f,!1,!0):(i.add(f.name),l.push(f))}return l.concat(...l.map(o))};var t=o;const r=n[0],s=n[1],i=new Set;for(const a of[r,...o(r)].reverse())Iu(a,e)}else for(const r of n)for(const s of r.files)e.addFile(s);return e}function sm(){const n=new Map,e=new Map,t=new Map;return{kind:"registry",types:n,extendees:e,[Symbol.iterator](){return n.values()},get files(){return t.values()},addFile(r,s,i){if(t.set(r.proto.name,r),!s)for(const o of Sl(r))this.add(o);if(i)for(const o of r.dependencies)this.addFile(o,s,i)},add(r){if(r.kind=="extension"){let s=e.get(r.extendee.typeName);s||e.set(r.extendee.typeName,s=new Map),s.set(r.number,r)}n.set(r.typeName,r)},get(r){return n.get(r)},getFile(r){return t.get(r)},getMessage(r){const s=n.get(r);return s?.kind=="message"?s:void 0},getEnum(r){const s=n.get(r);return s?.kind=="enum"?s:void 0},getExtension(r){const s=n.get(r);return s?.kind=="extension"?s:void 0},getExtensionFor(r,s){var i;return(i=e.get(r.typeName))===null||i===void 0?void 0:i.get(s)},getService(r){const s=n.get(r);return s?.kind=="service"?s:void 0}}}const im=998,om=999,am=9,lo=10,Hi=11,lm=12,Au=14,dc=3,cm=2,Eu=1,um=0,Qa=1,Su=2,hm=3,fm=1,dm=2,gm=1,ld={998:{fieldPresence:1,enumType:2,repeatedFieldEncoding:2,utf8Validation:3,messageEncoding:1,jsonFormat:2,enforceNamingStyle:2,defaultSymbolVisibility:1},999:{fieldPresence:2,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1e3:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:2,defaultSymbolVisibility:1},1001:{fieldPresence:1,enumType:1,repeatedFieldEncoding:1,utf8Validation:2,messageEncoding:1,jsonFormat:1,enforceNamingStyle:1,defaultSymbolVisibility:2}};function Iu(n,e){var t,r;const s={kind:"file",proto:n,deprecated:(r=(t=n.options)===null||t===void 0?void 0:t.deprecated)!==null&&r!==void 0?r:!1,edition:ym(n),name:n.name.replace(/\.proto$/,""),dependencies:vm(n,e),enums:[],messages:[],extensions:[],services:[],toString(){return`file ${n.name}`}},i=new Map,o={get(a){return i.get(a)},add(a){var l;Hn(((l=a.proto.options)===null||l===void 0?void 0:l.mapEntry)===!0),i.set(a.typeName,a)}};for(const a of n.enumType)cd(a,s,void 0,e);for(const a of n.messageType)ud(a,s,void 0,e,o);for(const a of n.service)pm(a,s,e);Il(s,e);for(const a of i.values())Nl(a,e,o);for(const a of s.messages)Nl(a,e,o),Il(a,e);e.addFile(s,!0)}function Il(n,e){switch(n.kind){case"file":for(const t of n.proto.extension){const r=wl(t,n,e);n.extensions.push(r),e.add(r)}break;case"message":for(const t of n.proto.extension){const r=wl(t,n,e);n.nestedExtensions.push(r),e.add(r)}for(const t of n.nestedMessages)Il(t,e);break}}function Nl(n,e,t){const r=n.proto.oneofDecl.map(i=>bm(i,n)),s=new Set;for(const i of n.proto.field){const o=Sm(i,r),a=wl(i,n,e,o,t);n.fields.push(a),n.field[a.localName]=a,o===void 0?n.members.push(a):(o.fields.push(a),s.has(o)||(s.add(o),n.members.push(o)))}for(const i of r.filter(o=>s.has(o)))n.oneofs.push(i);for(const i of n.nestedMessages)Nl(i,e,t)}function cd(n,e,t,r){var s,i,o,a,l;const c=Am(n.name,n.value),f={kind:"enum",proto:n,deprecated:(i=(s=n.options)===null||s===void 0?void 0:s.deprecated)!==null&&i!==void 0?i:!1,file:e,parent:t,open:!0,name:n.name,typeName:wa(n,t,e),value:{},values:[],sharedPrefix:c,toString(){return`enum ${this.typeName}`}};f.open=Tm(f),r.add(f);for(const g of n.value){const h=g.name;f.values.push(f.value[g.number]={kind:"enum_value",proto:g,deprecated:(a=(o=g.options)===null||o===void 0?void 0:o.deprecated)!==null&&a!==void 0?a:!1,parent:f,name:h,localName:ao(c==null?h:h.substring(c.length)),number:g.number,toString(){return`enum value ${f.typeName}.${h}`}})}((l=t?.nestedEnums)!==null&&l!==void 0?l:e.enums).push(f)}function ud(n,e,t,r,s){var i,o,a,l;const c={kind:"message",proto:n,deprecated:(o=(i=n.options)===null||i===void 0?void 0:i.deprecated)!==null&&o!==void 0?o:!1,file:e,parent:t,name:n.name,typeName:wa(n,t,e),fields:[],field:{},oneofs:[],members:[],nestedEnums:[],nestedMessages:[],nestedExtensions:[],toString(){return`message ${this.typeName}`}};((a=n.options)===null||a===void 0?void 0:a.mapEntry)===!0?s.add(c):(((l=t?.nestedMessages)!==null&&l!==void 0?l:e.messages).push(c),r.add(c));for(const f of n.enumType)cd(f,e,c,r);for(const f of n.nestedType)ud(f,e,c,r,s)}function pm(n,e,t){var r,s;const i={kind:"service",proto:n,deprecated:(s=(r=n.options)===null||r===void 0?void 0:r.deprecated)!==null&&s!==void 0?s:!1,file:e,name:n.name,typeName:wa(n,void 0,e),methods:[],method:{},toString(){return`service ${this.typeName}`}};e.services.push(i),t.add(i);for(const o of n.method){const a=mm(o,i,t);i.methods.push(a),i.method[a.localName]=a}}function mm(n,e,t){var r,s,i,o;let a;n.clientStreaming&&n.serverStreaming?a="bidi_streaming":n.clientStreaming?a="client_streaming":n.serverStreaming?a="server_streaming":a="unary";const l=t.getMessage(Wr(n.inputType)),c=t.getMessage(Wr(n.outputType));Hn(l,`invalid MethodDescriptorProto: input_type ${n.inputType} not found`),Hn(c,`invalid MethodDescriptorProto: output_type ${n.inputType} not found`);const f=n.name;return{kind:"rpc",proto:n,deprecated:(s=(r=n.options)===null||r===void 0?void 0:r.deprecated)!==null&&s!==void 0?s:!1,parent:e,name:f,localName:ao(f.length?ao(f[0].toLowerCase()+f.substring(1)):f),methodKind:a,input:l,output:c,idempotency:(o=(i=n.options)===null||i===void 0?void 0:i.idempotencyLevel)!==null&&o!==void 0?o:um,toString(){return`rpc ${e.typeName}.${f}`}}}function bm(n,e){return{kind:"oneof",proto:n,deprecated:!1,parent:e,fields:[],name:n.name,localName:ao(oo(n.name)),toString(){return`oneof ${e.typeName}.${this.name}`}}}function wl(n,e,t,r,s){var i,o,a;const l=s===void 0,c={kind:"field",proto:n,deprecated:(o=(i=n.options)===null||i===void 0?void 0:i.deprecated)!==null&&o!==void 0?o:!1,name:n.name,number:n.number,scalar:void 0,message:void 0,enum:void 0,presence:Im(n,r,l,e),listKind:void 0,mapKind:void 0,mapKey:void 0,delimitedEncoding:void 0,packed:void 0,longAsString:!1,getDefaultValue:void 0};if(l){const d=e.kind=="file"?e:e.file,m=e.kind=="file"?void 0:e,v=wa(n,m,d);c.kind="extension",c.file=d,c.parent=m,c.oneof=void 0,c.typeName=v,c.jsonName=`[${v}]`,c.toString=()=>`extension ${v}`;const I=t.getMessage(Wr(n.extendee));Hn(I,`invalid FieldDescriptorProto: extendee ${n.extendee} not found`),c.extendee=I}else{const d=e;Hn(d.kind=="message"),c.parent=d,c.oneof=r,c.localName=r?oo(n.name):ao(oo(n.name)),c.jsonName=n.jsonName,c.toString=()=>`field ${d.typeName}.${n.name}`}const f=n.label,g=n.type,h=(a=n.options)===null||a===void 0?void 0:a.jstype;if(f===dc){const d=g==Hi?s?.get(Wr(n.typeName)):void 0;if(d){c.fieldKind="map";const{key:m,value:v}=wm(d);return c.mapKey=m.scalar,c.mapKind=v.fieldKind,c.message=v.message,c.delimitedEncoding=!1,c.enum=v.enum,c.scalar=v.scalar,c}switch(c.fieldKind="list",g){case Hi:case lo:c.listKind="message",c.message=t.getMessage(Wr(n.typeName)),Hn(c.message),c.delimitedEncoding=Nu(n,e);break;case Au:c.listKind="enum",c.enum=t.getEnum(Wr(n.typeName)),Hn(c.enum);break;default:c.listKind="scalar",c.scalar=g,c.longAsString=h==Eu;break}return c.packed=Nm(n,e),c}switch(g){case Hi:case lo:c.fieldKind="message",c.message=t.getMessage(Wr(n.typeName)),Hn(c.message,`invalid FieldDescriptorProto: type_name ${n.typeName} not found`),c.delimitedEncoding=Nu(n,e),c.getDefaultValue=()=>{};break;case Au:{const d=t.getEnum(Wr(n.typeName));Hn(d!==void 0,`invalid FieldDescriptorProto: type_name ${n.typeName} not found`),c.fieldKind="enum",c.enum=t.getEnum(Wr(n.typeName)),c.getDefaultValue=()=>io(n,"defaultValue")?tm(d,n.defaultValue):void 0;break}default:{c.fieldKind="scalar",c.scalar=g,c.longAsString=h==Eu,c.getDefaultValue=()=>io(n,"defaultValue")?nm(g,n.defaultValue):void 0;break}}return c}function ym(n){switch(n.syntax){case"":case"proto2":return im;case"proto3":return om;case"editions":if(n.edition in ld)return n.edition;throw new Error(`${n.name}: unsupported edition`);default:throw new Error(`${n.name}: unsupported syntax "${n.syntax}"`)}}function vm(n,e){return n.dependency.map(t=>{const r=e.getFile(t);if(!r)throw new Error(`Cannot find ${t}, imported by ${n.name}`);return r})}function Am(n,e){const t=Em(n)+"_";for(const r of e){if(!r.name.toLowerCase().startsWith(t))return;const s=r.name.substring(t.length);if(s.length==0||/^\d/.test(s))return}return t}function Em(n){return(n.substring(0,1)+n.substring(1).replace(/[A-Z]/g,e=>"_"+e)).toLowerCase()}function wa(n,e,t){let r;return e?r=`${e.typeName}.${n.name}`:t.proto.package.length>0?r=`${t.proto.package}.${n.name}`:r=`${n.name}`,r}function Wr(n){return n.startsWith(".")?n.substring(1):n}function Sm(n,e){if(!io(n,"oneofIndex")||n.proto3Optional)return;const t=e[n.oneofIndex];return Hn(t,`invalid FieldDescriptorProto: oneof #${n.oneofIndex} for field #${n.number} not found`),t}function Im(n,e,t,r){if(n.label==cm)return hm;if(n.label==dc)return Su;if(e||n.proto3Optional||t)return Qa;const s=Ei("fieldPresence",{proto:n,parent:r});return s==Su&&(n.type==Hi||n.type==lo)?Qa:s}function Nm(n,e){if(n.label!=dc)return!1;switch(n.type){case am:case lm:case lo:case Hi:return!1}const t=n.options;return t&&io(t,"packed")?t.packed:fm==Ei("repeatedFieldEncoding",{proto:n,parent:e})}function wm(n){const e=n.fields.find(r=>r.number===1),t=n.fields.find(r=>r.number===2);return Hn(e&&e.fieldKind=="scalar"&&e.scalar!=V.BYTES&&e.scalar!=V.FLOAT&&e.scalar!=V.DOUBLE&&t&&t.fieldKind!="list"&&t.fieldKind!="map"),{key:e,value:t}}function Tm(n){var e;return gm==Ei("enumType",{proto:n.proto,parent:(e=n.parent)!==null&&e!==void 0?e:n.file})}function Nu(n,e){return n.type==lo?!0:dm==Ei("messageEncoding",{proto:n,parent:e})}function Ei(n,e){var t,r;const s=(t=e.proto.options)===null||t===void 0?void 0:t.features;if(s){const i=s[n];if(i!=0)return i}if("kind"in e){if(e.kind=="message")return Ei(n,(r=e.parent)!==null&&r!==void 0?r:e.file);const i=ld[e.edition];if(!i)throw new Error(`feature default for edition ${e.edition} not found`);return i[n]}return Ei(n,e.parent)}function Hn(n,e){if(!n)throw new Error(e)}function xm(n){const e=Cm(n);return e.messageType.forEach(fc),ad(e,()=>{}).getFile(e.name)}function Cm(n){return Object.assign(Object.create({syntax:"",edition:0}),Object.assign(Object.assign({$typeName:"google.protobuf.FileDescriptorProto",dependency:[],publicDependency:[],weakDependency:[],optionDependency:[],service:[],extension:[]},n),{messageType:n.messageType.map(hd),enumType:n.enumType.map(fd)}))}function hd(n){var e,t,r,s,i,o,a,l;return Object.assign(Object.create({visibility:0}),{$typeName:"google.protobuf.DescriptorProto",name:n.name,field:(t=(e=n.field)===null||e===void 0?void 0:e.map(Rm))!==null&&t!==void 0?t:[],extension:[],nestedType:(s=(r=n.nestedType)===null||r===void 0?void 0:r.map(hd))!==null&&s!==void 0?s:[],enumType:(o=(i=n.enumType)===null||i===void 0?void 0:i.map(fd))!==null&&o!==void 0?o:[],extensionRange:(l=(a=n.extensionRange)===null||a===void 0?void 0:a.map(f=>Object.assign({$typeName:"google.protobuf.DescriptorProto.ExtensionRange"},f)))!==null&&l!==void 0?l:[],oneofDecl:[],reservedRange:[],reservedName:[]})}function Rm(n){return Object.assign(Object.create({label:1,typeName:"",extendee:"",defaultValue:"",oneofIndex:0,jsonName:"",proto3Optional:!1}),Object.assign(Object.assign({$typeName:"google.protobuf.FieldDescriptorProto"},n),{options:n.options?_m(n.options):void 0}))}function _m(n){var e,t,r;return Object.assign(Object.create({ctype:0,packed:!1,jstype:0,lazy:!1,unverifiedLazy:!1,deprecated:!1,weak:!1,debugRedact:!1,retention:0}),Object.assign(Object.assign({$typeName:"google.protobuf.FieldOptions"},n),{targets:(e=n.targets)!==null&&e!==void 0?e:[],editionDefaults:(r=(t=n.editionDefaults)===null||t===void 0?void 0:t.map(i=>Object.assign({$typeName:"google.protobuf.FieldOptions.EditionDefault"},i)))!==null&&r!==void 0?r:[],uninterpretedOption:[]}))}function fd(n){return Object.assign(Object.create({visibility:0}),{$typeName:"google.protobuf.EnumDescriptorProto",name:n.name,reservedName:[],reservedRange:[],value:n.value.map(t=>Object.assign({$typeName:"google.protobuf.EnumValueDescriptorProto"},t))})}function xe(n,e,...t){return t.reduce((r,s)=>r.nestedMessages[s],n.messages[e])}const Lm=xm({name:"google/protobuf/descriptor.proto",package:"google.protobuf",messageType:[{name:"FileDescriptorSet",field:[{name:"file",number:1,type:11,label:3,typeName:".google.protobuf.FileDescriptorProto"}],extensionRange:[{start:536e6,end:536000001}]},{name:"FileDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"package",number:2,type:9,label:1},{name:"dependency",number:3,type:9,label:3},{name:"public_dependency",number:10,type:5,label:3},{name:"weak_dependency",number:11,type:5,label:3},{name:"option_dependency",number:15,type:9,label:3},{name:"message_type",number:4,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:5,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"service",number:6,type:11,label:3,typeName:".google.protobuf.ServiceDescriptorProto"},{name:"extension",number:7,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FileOptions"},{name:"source_code_info",number:9,type:11,label:1,typeName:".google.protobuf.SourceCodeInfo"},{name:"syntax",number:12,type:9,label:1},{name:"edition",number:14,type:14,label:1,typeName:".google.protobuf.Edition"}]},{name:"DescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"field",number:2,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"extension",number:6,type:11,label:3,typeName:".google.protobuf.FieldDescriptorProto"},{name:"nested_type",number:3,type:11,label:3,typeName:".google.protobuf.DescriptorProto"},{name:"enum_type",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto"},{name:"extension_range",number:5,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ExtensionRange"},{name:"oneof_decl",number:8,type:11,label:3,typeName:".google.protobuf.OneofDescriptorProto"},{name:"options",number:7,type:11,label:1,typeName:".google.protobuf.MessageOptions"},{name:"reserved_range",number:9,type:11,label:3,typeName:".google.protobuf.DescriptorProto.ReservedRange"},{name:"reserved_name",number:10,type:9,label:3},{name:"visibility",number:11,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"ExtensionRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ExtensionRangeOptions"}]},{name:"ReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"ExtensionRangeOptions",field:[{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"},{name:"declaration",number:2,type:11,label:3,typeName:".google.protobuf.ExtensionRangeOptions.Declaration",options:{retention:2}},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"verification",number:3,type:14,label:1,typeName:".google.protobuf.ExtensionRangeOptions.VerificationState",defaultValue:"UNVERIFIED",options:{retention:2}}],nestedType:[{name:"Declaration",field:[{name:"number",number:1,type:5,label:1},{name:"full_name",number:2,type:9,label:1},{name:"type",number:3,type:9,label:1},{name:"reserved",number:5,type:8,label:1},{name:"repeated",number:6,type:8,label:1}]}],enumType:[{name:"VerificationState",value:[{name:"DECLARATION",number:0},{name:"UNVERIFIED",number:1}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"FieldDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:3,type:5,label:1},{name:"label",number:4,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Label"},{name:"type",number:5,type:14,label:1,typeName:".google.protobuf.FieldDescriptorProto.Type"},{name:"type_name",number:6,type:9,label:1},{name:"extendee",number:2,type:9,label:1},{name:"default_value",number:7,type:9,label:1},{name:"oneof_index",number:9,type:5,label:1},{name:"json_name",number:10,type:9,label:1},{name:"options",number:8,type:11,label:1,typeName:".google.protobuf.FieldOptions"},{name:"proto3_optional",number:17,type:8,label:1}],enumType:[{name:"Type",value:[{name:"TYPE_DOUBLE",number:1},{name:"TYPE_FLOAT",number:2},{name:"TYPE_INT64",number:3},{name:"TYPE_UINT64",number:4},{name:"TYPE_INT32",number:5},{name:"TYPE_FIXED64",number:6},{name:"TYPE_FIXED32",number:7},{name:"TYPE_BOOL",number:8},{name:"TYPE_STRING",number:9},{name:"TYPE_GROUP",number:10},{name:"TYPE_MESSAGE",number:11},{name:"TYPE_BYTES",number:12},{name:"TYPE_UINT32",number:13},{name:"TYPE_ENUM",number:14},{name:"TYPE_SFIXED32",number:15},{name:"TYPE_SFIXED64",number:16},{name:"TYPE_SINT32",number:17},{name:"TYPE_SINT64",number:18}]},{name:"Label",value:[{name:"LABEL_OPTIONAL",number:1},{name:"LABEL_REPEATED",number:3},{name:"LABEL_REQUIRED",number:2}]}]},{name:"OneofDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"options",number:2,type:11,label:1,typeName:".google.protobuf.OneofOptions"}]},{name:"EnumDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"value",number:2,type:11,label:3,typeName:".google.protobuf.EnumValueDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumOptions"},{name:"reserved_range",number:4,type:11,label:3,typeName:".google.protobuf.EnumDescriptorProto.EnumReservedRange"},{name:"reserved_name",number:5,type:9,label:3},{name:"visibility",number:6,type:14,label:1,typeName:".google.protobuf.SymbolVisibility"}],nestedType:[{name:"EnumReservedRange",field:[{name:"start",number:1,type:5,label:1},{name:"end",number:2,type:5,label:1}]}]},{name:"EnumValueDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"number",number:2,type:5,label:1},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.EnumValueOptions"}]},{name:"ServiceDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"method",number:2,type:11,label:3,typeName:".google.protobuf.MethodDescriptorProto"},{name:"options",number:3,type:11,label:1,typeName:".google.protobuf.ServiceOptions"}]},{name:"MethodDescriptorProto",field:[{name:"name",number:1,type:9,label:1},{name:"input_type",number:2,type:9,label:1},{name:"output_type",number:3,type:9,label:1},{name:"options",number:4,type:11,label:1,typeName:".google.protobuf.MethodOptions"},{name:"client_streaming",number:5,type:8,label:1,defaultValue:"false"},{name:"server_streaming",number:6,type:8,label:1,defaultValue:"false"}]},{name:"FileOptions",field:[{name:"java_package",number:1,type:9,label:1},{name:"java_outer_classname",number:8,type:9,label:1},{name:"java_multiple_files",number:10,type:8,label:1,defaultValue:"false"},{name:"java_generate_equals_and_hash",number:20,type:8,label:1,options:{deprecated:!0}},{name:"java_string_check_utf8",number:27,type:8,label:1,defaultValue:"false"},{name:"optimize_for",number:9,type:14,label:1,typeName:".google.protobuf.FileOptions.OptimizeMode",defaultValue:"SPEED"},{name:"go_package",number:11,type:9,label:1},{name:"cc_generic_services",number:16,type:8,label:1,defaultValue:"false"},{name:"java_generic_services",number:17,type:8,label:1,defaultValue:"false"},{name:"py_generic_services",number:18,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:23,type:8,label:1,defaultValue:"false"},{name:"cc_enable_arenas",number:31,type:8,label:1,defaultValue:"true"},{name:"objc_class_prefix",number:36,type:9,label:1},{name:"csharp_namespace",number:37,type:9,label:1},{name:"swift_prefix",number:39,type:9,label:1},{name:"php_class_prefix",number:40,type:9,label:1},{name:"php_namespace",number:41,type:9,label:1},{name:"php_metadata_namespace",number:44,type:9,label:1},{name:"ruby_package",number:45,type:9,label:1},{name:"features",number:50,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"OptimizeMode",value:[{name:"SPEED",number:1},{name:"CODE_SIZE",number:2},{name:"LITE_RUNTIME",number:3}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"MessageOptions",field:[{name:"message_set_wire_format",number:1,type:8,label:1,defaultValue:"false"},{name:"no_standard_descriptor_accessor",number:2,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"map_entry",number:7,type:8,label:1},{name:"deprecated_legacy_json_field_conflicts",number:11,type:8,label:1,options:{deprecated:!0}},{name:"features",number:12,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"FieldOptions",field:[{name:"ctype",number:1,type:14,label:1,typeName:".google.protobuf.FieldOptions.CType",defaultValue:"STRING"},{name:"packed",number:2,type:8,label:1},{name:"jstype",number:6,type:14,label:1,typeName:".google.protobuf.FieldOptions.JSType",defaultValue:"JS_NORMAL"},{name:"lazy",number:5,type:8,label:1,defaultValue:"false"},{name:"unverified_lazy",number:15,type:8,label:1,defaultValue:"false"},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"weak",number:10,type:8,label:1,defaultValue:"false",options:{deprecated:!0}},{name:"debug_redact",number:16,type:8,label:1,defaultValue:"false"},{name:"retention",number:17,type:14,label:1,typeName:".google.protobuf.FieldOptions.OptionRetention"},{name:"targets",number:19,type:14,label:3,typeName:".google.protobuf.FieldOptions.OptionTargetType"},{name:"edition_defaults",number:20,type:11,label:3,typeName:".google.protobuf.FieldOptions.EditionDefault"},{name:"features",number:21,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"feature_support",number:22,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],nestedType:[{name:"EditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"value",number:2,type:9,label:1}]},{name:"FeatureSupport",field:[{name:"edition_introduced",number:1,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"edition_deprecated",number:2,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"deprecation_warning",number:3,type:9,label:1},{name:"edition_removed",number:4,type:14,label:1,typeName:".google.protobuf.Edition"}]}],enumType:[{name:"CType",value:[{name:"STRING",number:0},{name:"CORD",number:1},{name:"STRING_PIECE",number:2}]},{name:"JSType",value:[{name:"JS_NORMAL",number:0},{name:"JS_STRING",number:1},{name:"JS_NUMBER",number:2}]},{name:"OptionRetention",value:[{name:"RETENTION_UNKNOWN",number:0},{name:"RETENTION_RUNTIME",number:1},{name:"RETENTION_SOURCE",number:2}]},{name:"OptionTargetType",value:[{name:"TARGET_TYPE_UNKNOWN",number:0},{name:"TARGET_TYPE_FILE",number:1},{name:"TARGET_TYPE_EXTENSION_RANGE",number:2},{name:"TARGET_TYPE_MESSAGE",number:3},{name:"TARGET_TYPE_FIELD",number:4},{name:"TARGET_TYPE_ONEOF",number:5},{name:"TARGET_TYPE_ENUM",number:6},{name:"TARGET_TYPE_ENUM_ENTRY",number:7},{name:"TARGET_TYPE_SERVICE",number:8},{name:"TARGET_TYPE_METHOD",number:9}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"OneofOptions",field:[{name:"features",number:1,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"EnumOptions",field:[{name:"allow_alias",number:2,type:8,label:1},{name:"deprecated",number:3,type:8,label:1,defaultValue:"false"},{name:"deprecated_legacy_json_field_conflicts",number:6,type:8,label:1,options:{deprecated:!0}},{name:"features",number:7,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"EnumValueOptions",field:[{name:"deprecated",number:1,type:8,label:1,defaultValue:"false"},{name:"features",number:2,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"debug_redact",number:3,type:8,label:1,defaultValue:"false"},{name:"feature_support",number:4,type:11,label:1,typeName:".google.protobuf.FieldOptions.FeatureSupport"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"ServiceOptions",field:[{name:"features",number:34,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],extensionRange:[{start:1e3,end:536870912}]},{name:"MethodOptions",field:[{name:"deprecated",number:33,type:8,label:1,defaultValue:"false"},{name:"idempotency_level",number:34,type:14,label:1,typeName:".google.protobuf.MethodOptions.IdempotencyLevel",defaultValue:"IDEMPOTENCY_UNKNOWN"},{name:"features",number:35,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"uninterpreted_option",number:999,type:11,label:3,typeName:".google.protobuf.UninterpretedOption"}],enumType:[{name:"IdempotencyLevel",value:[{name:"IDEMPOTENCY_UNKNOWN",number:0},{name:"NO_SIDE_EFFECTS",number:1},{name:"IDEMPOTENT",number:2}]}],extensionRange:[{start:1e3,end:536870912}]},{name:"UninterpretedOption",field:[{name:"name",number:2,type:11,label:3,typeName:".google.protobuf.UninterpretedOption.NamePart"},{name:"identifier_value",number:3,type:9,label:1},{name:"positive_int_value",number:4,type:4,label:1},{name:"negative_int_value",number:5,type:3,label:1},{name:"double_value",number:6,type:1,label:1},{name:"string_value",number:7,type:12,label:1},{name:"aggregate_value",number:8,type:9,label:1}],nestedType:[{name:"NamePart",field:[{name:"name_part",number:1,type:9,label:2},{name:"is_extension",number:2,type:8,label:2}]}]},{name:"FeatureSet",field:[{name:"field_presence",number:1,type:14,label:1,typeName:".google.protobuf.FeatureSet.FieldPresence",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPLICIT",edition:900},{value:"IMPLICIT",edition:999},{value:"EXPLICIT",edition:1e3}]}},{name:"enum_type",number:2,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnumType",options:{retention:1,targets:[6,1],editionDefaults:[{value:"CLOSED",edition:900},{value:"OPEN",edition:999}]}},{name:"repeated_field_encoding",number:3,type:14,label:1,typeName:".google.protobuf.FeatureSet.RepeatedFieldEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"EXPANDED",edition:900},{value:"PACKED",edition:999}]}},{name:"utf8_validation",number:4,type:14,label:1,typeName:".google.protobuf.FeatureSet.Utf8Validation",options:{retention:1,targets:[4,1],editionDefaults:[{value:"NONE",edition:900},{value:"VERIFY",edition:999}]}},{name:"message_encoding",number:5,type:14,label:1,typeName:".google.protobuf.FeatureSet.MessageEncoding",options:{retention:1,targets:[4,1],editionDefaults:[{value:"LENGTH_PREFIXED",edition:900}]}},{name:"json_format",number:6,type:14,label:1,typeName:".google.protobuf.FeatureSet.JsonFormat",options:{retention:1,targets:[3,6,1],editionDefaults:[{value:"LEGACY_BEST_EFFORT",edition:900},{value:"ALLOW",edition:999}]}},{name:"enforce_naming_style",number:7,type:14,label:1,typeName:".google.protobuf.FeatureSet.EnforceNamingStyle",options:{retention:2,targets:[1,2,3,4,5,6,7,8,9],editionDefaults:[{value:"STYLE_LEGACY",edition:900},{value:"STYLE2024",edition:1001}]}},{name:"default_symbol_visibility",number:8,type:14,label:1,typeName:".google.protobuf.FeatureSet.VisibilityFeature.DefaultSymbolVisibility",options:{retention:2,targets:[1],editionDefaults:[{value:"EXPORT_ALL",edition:900},{value:"EXPORT_TOP_LEVEL",edition:1001}]}}],nestedType:[{name:"VisibilityFeature",enumType:[{name:"DefaultSymbolVisibility",value:[{name:"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",number:0},{name:"EXPORT_ALL",number:1},{name:"EXPORT_TOP_LEVEL",number:2},{name:"LOCAL_ALL",number:3},{name:"STRICT",number:4}]}]}],enumType:[{name:"FieldPresence",value:[{name:"FIELD_PRESENCE_UNKNOWN",number:0},{name:"EXPLICIT",number:1},{name:"IMPLICIT",number:2},{name:"LEGACY_REQUIRED",number:3}]},{name:"EnumType",value:[{name:"ENUM_TYPE_UNKNOWN",number:0},{name:"OPEN",number:1},{name:"CLOSED",number:2}]},{name:"RepeatedFieldEncoding",value:[{name:"REPEATED_FIELD_ENCODING_UNKNOWN",number:0},{name:"PACKED",number:1},{name:"EXPANDED",number:2}]},{name:"Utf8Validation",value:[{name:"UTF8_VALIDATION_UNKNOWN",number:0},{name:"VERIFY",number:2},{name:"NONE",number:3}]},{name:"MessageEncoding",value:[{name:"MESSAGE_ENCODING_UNKNOWN",number:0},{name:"LENGTH_PREFIXED",number:1},{name:"DELIMITED",number:2}]},{name:"JsonFormat",value:[{name:"JSON_FORMAT_UNKNOWN",number:0},{name:"ALLOW",number:1},{name:"LEGACY_BEST_EFFORT",number:2}]},{name:"EnforceNamingStyle",value:[{name:"ENFORCE_NAMING_STYLE_UNKNOWN",number:0},{name:"STYLE2024",number:1},{name:"STYLE_LEGACY",number:2}]}],extensionRange:[{start:1e3,end:9995},{start:9995,end:1e4},{start:1e4,end:10001}]},{name:"FeatureSetDefaults",field:[{name:"defaults",number:1,type:11,label:3,typeName:".google.protobuf.FeatureSetDefaults.FeatureSetEditionDefault"},{name:"minimum_edition",number:4,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"maximum_edition",number:5,type:14,label:1,typeName:".google.protobuf.Edition"}],nestedType:[{name:"FeatureSetEditionDefault",field:[{name:"edition",number:3,type:14,label:1,typeName:".google.protobuf.Edition"},{name:"overridable_features",number:4,type:11,label:1,typeName:".google.protobuf.FeatureSet"},{name:"fixed_features",number:5,type:11,label:1,typeName:".google.protobuf.FeatureSet"}]}]},{name:"SourceCodeInfo",field:[{name:"location",number:1,type:11,label:3,typeName:".google.protobuf.SourceCodeInfo.Location"}],nestedType:[{name:"Location",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"span",number:2,type:5,label:3,options:{packed:!0}},{name:"leading_comments",number:3,type:9,label:1},{name:"trailing_comments",number:4,type:9,label:1},{name:"leading_detached_comments",number:6,type:9,label:3}]}],extensionRange:[{start:536e6,end:536000001}]},{name:"GeneratedCodeInfo",field:[{name:"annotation",number:1,type:11,label:3,typeName:".google.protobuf.GeneratedCodeInfo.Annotation"}],nestedType:[{name:"Annotation",field:[{name:"path",number:1,type:5,label:3,options:{packed:!0}},{name:"source_file",number:2,type:9,label:1},{name:"begin",number:3,type:5,label:1},{name:"end",number:4,type:5,label:1},{name:"semantic",number:5,type:14,label:1,typeName:".google.protobuf.GeneratedCodeInfo.Annotation.Semantic"}],enumType:[{name:"Semantic",value:[{name:"NONE",number:0},{name:"SET",number:1},{name:"ALIAS",number:2}]}]}]}],enumType:[{name:"Edition",value:[{name:"EDITION_UNKNOWN",number:0},{name:"EDITION_LEGACY",number:900},{name:"EDITION_PROTO2",number:998},{name:"EDITION_PROTO3",number:999},{name:"EDITION_2023",number:1e3},{name:"EDITION_2024",number:1001},{name:"EDITION_1_TEST_ONLY",number:1},{name:"EDITION_2_TEST_ONLY",number:2},{name:"EDITION_99997_TEST_ONLY",number:99997},{name:"EDITION_99998_TEST_ONLY",number:99998},{name:"EDITION_99999_TEST_ONLY",number:99999},{name:"EDITION_MAX",number:2147483647}]},{name:"SymbolVisibility",value:[{name:"VISIBILITY_UNSET",number:0},{name:"VISIBILITY_LOCAL",number:1},{name:"VISIBILITY_EXPORT",number:2}]}]}),Om=xe(Lm,1);var wu;(function(n){n[n.DECLARATION=0]="DECLARATION",n[n.UNVERIFIED=1]="UNVERIFIED"})(wu||(wu={}));var Tu;(function(n){n[n.DOUBLE=1]="DOUBLE",n[n.FLOAT=2]="FLOAT",n[n.INT64=3]="INT64",n[n.UINT64=4]="UINT64",n[n.INT32=5]="INT32",n[n.FIXED64=6]="FIXED64",n[n.FIXED32=7]="FIXED32",n[n.BOOL=8]="BOOL",n[n.STRING=9]="STRING",n[n.GROUP=10]="GROUP",n[n.MESSAGE=11]="MESSAGE",n[n.BYTES=12]="BYTES",n[n.UINT32=13]="UINT32",n[n.ENUM=14]="ENUM",n[n.SFIXED32=15]="SFIXED32",n[n.SFIXED64=16]="SFIXED64",n[n.SINT32=17]="SINT32",n[n.SINT64=18]="SINT64"})(Tu||(Tu={}));var xu;(function(n){n[n.OPTIONAL=1]="OPTIONAL",n[n.REPEATED=3]="REPEATED",n[n.REQUIRED=2]="REQUIRED"})(xu||(xu={}));var Cu;(function(n){n[n.SPEED=1]="SPEED",n[n.CODE_SIZE=2]="CODE_SIZE",n[n.LITE_RUNTIME=3]="LITE_RUNTIME"})(Cu||(Cu={}));var Ru;(function(n){n[n.STRING=0]="STRING",n[n.CORD=1]="CORD",n[n.STRING_PIECE=2]="STRING_PIECE"})(Ru||(Ru={}));var _u;(function(n){n[n.JS_NORMAL=0]="JS_NORMAL",n[n.JS_STRING=1]="JS_STRING",n[n.JS_NUMBER=2]="JS_NUMBER"})(_u||(_u={}));var Lu;(function(n){n[n.RETENTION_UNKNOWN=0]="RETENTION_UNKNOWN",n[n.RETENTION_RUNTIME=1]="RETENTION_RUNTIME",n[n.RETENTION_SOURCE=2]="RETENTION_SOURCE"})(Lu||(Lu={}));var Ou;(function(n){n[n.TARGET_TYPE_UNKNOWN=0]="TARGET_TYPE_UNKNOWN",n[n.TARGET_TYPE_FILE=1]="TARGET_TYPE_FILE",n[n.TARGET_TYPE_EXTENSION_RANGE=2]="TARGET_TYPE_EXTENSION_RANGE",n[n.TARGET_TYPE_MESSAGE=3]="TARGET_TYPE_MESSAGE",n[n.TARGET_TYPE_FIELD=4]="TARGET_TYPE_FIELD",n[n.TARGET_TYPE_ONEOF=5]="TARGET_TYPE_ONEOF",n[n.TARGET_TYPE_ENUM=6]="TARGET_TYPE_ENUM",n[n.TARGET_TYPE_ENUM_ENTRY=7]="TARGET_TYPE_ENUM_ENTRY",n[n.TARGET_TYPE_SERVICE=8]="TARGET_TYPE_SERVICE",n[n.TARGET_TYPE_METHOD=9]="TARGET_TYPE_METHOD"})(Ou||(Ou={}));var ku;(function(n){n[n.IDEMPOTENCY_UNKNOWN=0]="IDEMPOTENCY_UNKNOWN",n[n.NO_SIDE_EFFECTS=1]="NO_SIDE_EFFECTS",n[n.IDEMPOTENT=2]="IDEMPOTENT"})(ku||(ku={}));var Du;(function(n){n[n.DEFAULT_SYMBOL_VISIBILITY_UNKNOWN=0]="DEFAULT_SYMBOL_VISIBILITY_UNKNOWN",n[n.EXPORT_ALL=1]="EXPORT_ALL",n[n.EXPORT_TOP_LEVEL=2]="EXPORT_TOP_LEVEL",n[n.LOCAL_ALL=3]="LOCAL_ALL",n[n.STRICT=4]="STRICT"})(Du||(Du={}));var Bu;(function(n){n[n.FIELD_PRESENCE_UNKNOWN=0]="FIELD_PRESENCE_UNKNOWN",n[n.EXPLICIT=1]="EXPLICIT",n[n.IMPLICIT=2]="IMPLICIT",n[n.LEGACY_REQUIRED=3]="LEGACY_REQUIRED"})(Bu||(Bu={}));var Vu;(function(n){n[n.ENUM_TYPE_UNKNOWN=0]="ENUM_TYPE_UNKNOWN",n[n.OPEN=1]="OPEN",n[n.CLOSED=2]="CLOSED"})(Vu||(Vu={}));var Pu;(function(n){n[n.REPEATED_FIELD_ENCODING_UNKNOWN=0]="REPEATED_FIELD_ENCODING_UNKNOWN",n[n.PACKED=1]="PACKED",n[n.EXPANDED=2]="EXPANDED"})(Pu||(Pu={}));var Mu;(function(n){n[n.UTF8_VALIDATION_UNKNOWN=0]="UTF8_VALIDATION_UNKNOWN",n[n.VERIFY=2]="VERIFY",n[n.NONE=3]="NONE"})(Mu||(Mu={}));var Uu;(function(n){n[n.MESSAGE_ENCODING_UNKNOWN=0]="MESSAGE_ENCODING_UNKNOWN",n[n.LENGTH_PREFIXED=1]="LENGTH_PREFIXED",n[n.DELIMITED=2]="DELIMITED"})(Uu||(Uu={}));var Wu;(function(n){n[n.JSON_FORMAT_UNKNOWN=0]="JSON_FORMAT_UNKNOWN",n[n.ALLOW=1]="ALLOW",n[n.LEGACY_BEST_EFFORT=2]="LEGACY_BEST_EFFORT"})(Wu||(Wu={}));var Fu;(function(n){n[n.ENFORCE_NAMING_STYLE_UNKNOWN=0]="ENFORCE_NAMING_STYLE_UNKNOWN",n[n.STYLE2024=1]="STYLE2024",n[n.STYLE_LEGACY=2]="STYLE_LEGACY"})(Fu||(Fu={}));var Zu;(function(n){n[n.NONE=0]="NONE",n[n.SET=1]="SET",n[n.ALIAS=2]="ALIAS"})(Zu||(Zu={}));var Gu;(function(n){n[n.EDITION_UNKNOWN=0]="EDITION_UNKNOWN",n[n.EDITION_LEGACY=900]="EDITION_LEGACY",n[n.EDITION_PROTO2=998]="EDITION_PROTO2",n[n.EDITION_PROTO3=999]="EDITION_PROTO3",n[n.EDITION_2023=1e3]="EDITION_2023",n[n.EDITION_2024=1001]="EDITION_2024",n[n.EDITION_1_TEST_ONLY=1]="EDITION_1_TEST_ONLY",n[n.EDITION_2_TEST_ONLY=2]="EDITION_2_TEST_ONLY",n[n.EDITION_99997_TEST_ONLY=99997]="EDITION_99997_TEST_ONLY",n[n.EDITION_99998_TEST_ONLY=99998]="EDITION_99998_TEST_ONLY",n[n.EDITION_99999_TEST_ONLY=99999]="EDITION_99999_TEST_ONLY",n[n.EDITION_MAX=2147483647]="EDITION_MAX"})(Gu||(Gu={}));var $u;(function(n){n[n.VISIBILITY_UNSET=0]="VISIBILITY_UNSET",n[n.VISIBILITY_LOCAL=1]="VISIBILITY_LOCAL",n[n.VISIBILITY_EXPORT=2]="VISIBILITY_EXPORT"})($u||($u={}));const Ku={readUnknownFields:!0};function km(n){return n?Object.assign(Object.assign({},Ku),n):Ku}function Gn(n,e,t){const r=Zn(n,void 0,!1);return dd(r,new ic(e),km(t),!1,e.byteLength),r.message}function dd(n,e,t,r,s){var i;const o=r?e.len:e.pos+s;let a,l;const c=(i=n.getUnknown())!==null&&i!==void 0?i:[];for(;e.pos<o&&([a,l]=e.tag(),!(r&&l==Nt.EndGroup));){const f=n.findNumber(a);if(!f){const g=e.skip(l,a);t.readUnknownFields&&c.push({no:a,wireType:l,data:g});continue}gd(n,e,f,l,t)}if(r&&(l!=Nt.EndGroup||a!==s))throw new Error("invalid end group tag");c.length>0&&n.setUnknown(c)}function gd(n,e,t,r,s){var i;switch(t.fieldKind){case"scalar":n.set(t,Si(e,t.scalar));break;case"enum":const o=Si(e,V.INT32);if(t.enum.open)n.set(t,o);else if(t.enum.values.some(l=>l.number===o))n.set(t,o);else if(s.readUnknownFields){const l=[];El(o,l);const c=(i=n.getUnknown())!==null&&i!==void 0?i:[];c.push({no:t.number,wireType:r,data:new Uint8Array(l)}),n.setUnknown(c)}break;case"message":n.set(t,gc(e,s,t,n.get(t)));break;case"list":Bm(e,r,n.get(t),s);break;case"map":Dm(e,n.get(t),s);break}}function Dm(n,e,t){const r=e.field();let s,i;const o=n.uint32(),a=n.pos+o;for(;n.pos<a;){const[l]=n.tag();switch(l){case 1:s=Si(n,r.mapKey);break;case 2:switch(r.mapKind){case"scalar":i=Si(n,r.scalar);break;case"enum":i=n.int32();break;case"message":i=gc(n,t,r);break}break}}if(s===void 0&&(s=Ps(r.mapKey,!1)),i===void 0)switch(r.mapKind){case"scalar":i=Ps(r.scalar,!1);break;case"enum":i=r.enum.values[0].number;break;case"message":i=Zn(r.message,void 0,!1);break}e.set(s,i)}function Bm(n,e,t,r){var s;const i=t.field();if(i.listKind==="message"){t.add(gc(n,r,i));return}const o=(s=i.scalar)!==null&&s!==void 0?s:V.INT32;if(!(e==Nt.LengthDelimited&&o!=V.STRING&&o!=V.BYTES)){t.add(Si(n,o));return}const l=n.uint32()+n.pos;for(;n.pos<l;)t.add(Si(n,o))}function gc(n,e,t,r){const s=t.delimitedEncoding,i=r??Zn(t.message,void 0,!1);return dd(i,n,e,s,s?t.number:n.uint32()),i}function Si(n,e){switch(e){case V.STRING:return n.string();case V.BOOL:return n.bool();case V.DOUBLE:return n.double();case V.FLOAT:return n.float();case V.INT32:return n.int32();case V.INT64:return n.int64();case V.UINT64:return n.uint64();case V.FIXED64:return n.fixed64();case V.BYTES:return n.bytes();case V.FIXED32:return n.fixed32();case V.SFIXED32:return n.sfixed32();case V.SFIXED64:return n.sfixed64();case V.SINT64:return n.sint64();case V.UINT32:return n.uint32();case V.SINT32:return n.sint32()}}function zr(n,e){var t;const r=Gn(Om,hc(n));return r.messageType.forEach(fc),r.dependency=(t=e?.map(i=>i.proto.name))!==null&&t!==void 0?t:[],ad(r,i=>e?.find(o=>o.proto.name===i)).getFile(r.name)}const Vm=zr("Ch9nb29nbGUvcHJvdG9idWYvdGltZXN0YW1wLnByb3RvEg9nb29nbGUucHJvdG9idWYiKwoJVGltZXN0YW1wEg8KB3NlY29uZHMYASABKAMSDQoFbmFub3MYAiABKAVChQEKE2NvbS5nb29nbGUucHJvdG9idWZCDlRpbWVzdGFtcFByb3RvUAFaMmdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL3RpbWVzdGFtcHBi+AEBogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM");function Pm(n){return new Date(Mm(n))}function Mm(n){return Number(n.seconds)*1e3+Math.round(n.nanos/1e6)}const Um=zr("Ch5nb29nbGUvcHJvdG9idWYvZHVyYXRpb24ucHJvdG8SD2dvb2dsZS5wcm90b2J1ZiIqCghEdXJhdGlvbhIPCgdzZWNvbmRzGAEgASgDEg0KBW5hbm9zGAIgASgFQoMBChNjb20uZ29vZ2xlLnByb3RvYnVmQg1EdXJhdGlvblByb3RvUAFaMWdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL2R1cmF0aW9ucGL4AQGiAgNHUEKqAh5Hb29nbGUuUHJvdG9idWYuV2VsbEtub3duVHlwZXNiBnByb3RvMw"),pd=zr("Chlnb29nbGUvcHJvdG9idWYvYW55LnByb3RvEg9nb29nbGUucHJvdG9idWYiJgoDQW55EhAKCHR5cGVfdXJsGAEgASgJEg0KBXZhbHVlGAIgASgMQnYKE2NvbS5nb29nbGUucHJvdG9idWZCCEFueVByb3RvUAFaLGdvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL2FueXBiogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM"),Wm=xe(pd,0),Fm=3,ju={writeUnknownFields:!0};function Zm(n){return n?Object.assign(Object.assign({},ju),n):ju}function As(n,e,t){return fa(new Xf,Zm(t),Zn(n,e)).finish()}function fa(n,e,t){var r;for(const s of t.sortedFields){if(!t.isSet(s)){if(s.presence==Fm)throw new Error(`cannot encode ${s} to binary: required field not set`);continue}md(n,e,t,s)}if(e.writeUnknownFields)for(const{no:s,wireType:i,data:o}of(r=t.getUnknown())!==null&&r!==void 0?r:[])n.tag(s,i).raw(o);return n}function md(n,e,t,r){var s;switch(r.fieldKind){case"scalar":case"enum":da(n,t.desc.typeName,r.name,(s=r.scalar)!==null&&s!==void 0?s:V.INT32,r.number,t.get(r));break;case"list":Gm(n,e,r,t.get(r));break;case"message":bd(n,e,r,t.get(r));break;case"map":for(const[i,o]of t.get(r))$m(n,e,r,i,o);break}}function da(n,e,t,r,s,i){yd(n.tag(s,Km(r)),e,t,r,i)}function bd(n,e,t,r){t.delimitedEncoding?fa(n.tag(t.number,Nt.StartGroup),e,r).tag(t.number,Nt.EndGroup):fa(n.tag(t.number,Nt.LengthDelimited).fork(),e,r).join()}function Gm(n,e,t,r){var s;if(t.listKind=="message"){for(const o of r)bd(n,e,t,o);return}const i=(s=t.scalar)!==null&&s!==void 0?s:V.INT32;if(t.packed){if(!r.size)return;n.tag(t.number,Nt.LengthDelimited).fork();for(const o of r)yd(n,t.parent.typeName,t.name,i,o);n.join();return}for(const o of r)da(n,t.parent.typeName,t.name,i,t.number,o)}function $m(n,e,t,r,s){var i;switch(n.tag(t.number,Nt.LengthDelimited).fork(),da(n,t.parent.typeName,t.name,t.mapKey,1,r),t.mapKind){case"scalar":case"enum":da(n,t.parent.typeName,t.name,(i=t.scalar)!==null&&i!==void 0?i:V.INT32,2,s);break;case"message":fa(n.tag(2,Nt.LengthDelimited).fork(),e,s).join();break}n.join()}function yd(n,e,t,r,s){try{switch(r){case V.STRING:n.string(s);break;case V.BOOL:n.bool(s);break;case V.DOUBLE:n.double(s);break;case V.FLOAT:n.float(s);break;case V.INT32:n.int32(s);break;case V.INT64:n.int64(s);break;case V.UINT64:n.uint64(s);break;case V.FIXED64:n.fixed64(s);break;case V.BYTES:n.bytes(s);break;case V.FIXED32:n.fixed32(s);break;case V.SFIXED32:n.sfixed32(s);break;case V.SFIXED64:n.sfixed64(s);break;case V.SINT64:n.sint64(s);break;case V.UINT32:n.uint32(s);break;case V.SINT32:n.sint32(s);break}}catch(i){throw i instanceof Error?new Error(`cannot encode field ${e}.${t} to binary: ${i.message}`):i}}function Km(n){switch(n){case V.BYTES:case V.STRING:return Nt.LengthDelimited;case V.DOUBLE:case V.FIXED64:case V.SFIXED64:return Nt.Bit64;case V.FIXED32:case V.SFIXED32:case V.FLOAT:return Nt.Bit32;default:return Nt.Varint}}function jm(n,e,t){let r=!1;return t||(t=fe(Wm),r=!0),t.value=As(n,e),t.typeUrl=zm(e.$typeName),r?t:void 0}function Ym(n,e){if(n.typeUrl==="")return!1;const t=typeof e=="string"?e:e.typeName,r=vd(n.typeUrl);return t===r}function qm(n,e){if(n.typeUrl==="")return;const t=e.kind=="message"?e:e.getMessage(vd(n.typeUrl));if(!(!t||!Ym(n,t)))return Gn(t,n.value)}function zm(n){return`type.googleapis.com/${n}`}function vd(n){const e=n.lastIndexOf("/"),t=e>=0?n.substring(e+1):n;if(!t.length)throw new Error(`invalid type url: ${n}`);return t}const pc=zr("Chxnb29nbGUvcHJvdG9idWYvc3RydWN0LnByb3RvEg9nb29nbGUucHJvdG9idWYihAEKBlN0cnVjdBIzCgZmaWVsZHMYASADKAsyIy5nb29nbGUucHJvdG9idWYuU3RydWN0LkZpZWxkc0VudHJ5GkUKC0ZpZWxkc0VudHJ5EgsKA2tleRgBIAEoCRIlCgV2YWx1ZRgCIAEoCzIWLmdvb2dsZS5wcm90b2J1Zi5WYWx1ZToCOAEi6gEKBVZhbHVlEjAKCm51bGxfdmFsdWUYASABKA4yGi5nb29nbGUucHJvdG9idWYuTnVsbFZhbHVlSAASFgoMbnVtYmVyX3ZhbHVlGAIgASgBSAASFgoMc3RyaW5nX3ZhbHVlGAMgASgJSAASFAoKYm9vbF92YWx1ZRgEIAEoCEgAEi8KDHN0cnVjdF92YWx1ZRgFIAEoCzIXLmdvb2dsZS5wcm90b2J1Zi5TdHJ1Y3RIABIwCgpsaXN0X3ZhbHVlGAYgASgLMhouZ29vZ2xlLnByb3RvYnVmLkxpc3RWYWx1ZUgAQgYKBGtpbmQiMwoJTGlzdFZhbHVlEiYKBnZhbHVlcxgBIAMoCzIWLmdvb2dsZS5wcm90b2J1Zi5WYWx1ZSobCglOdWxsVmFsdWUSDgoKTlVMTF9WQUxVRRAAQn8KE2NvbS5nb29nbGUucHJvdG9idWZCC1N0cnVjdFByb3RvUAFaL2dvb2dsZS5nb2xhbmcub3JnL3Byb3RvYnVmL3R5cGVzL2tub3duL3N0cnVjdHBi+AEBogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM"),Xm=xe(pc,0),Ad=xe(pc,1),Jm=xe(pc,2);var Tl;(function(n){n[n.NULL_VALUE=0]="NULL_VALUE"})(Tl||(Tl={}));const Hm=zr("Ch5nb29nbGUvcHJvdG9idWYvd3JhcHBlcnMucHJvdG8SD2dvb2dsZS5wcm90b2J1ZiIcCgtEb3VibGVWYWx1ZRINCgV2YWx1ZRgBIAEoASIbCgpGbG9hdFZhbHVlEg0KBXZhbHVlGAEgASgCIhsKCkludDY0VmFsdWUSDQoFdmFsdWUYASABKAMiHAoLVUludDY0VmFsdWUSDQoFdmFsdWUYASABKAQiGwoKSW50MzJWYWx1ZRINCgV2YWx1ZRgBIAEoBSIcCgtVSW50MzJWYWx1ZRINCgV2YWx1ZRgBIAEoDSIaCglCb29sVmFsdWUSDQoFdmFsdWUYASABKAgiHAoLU3RyaW5nVmFsdWUSDQoFdmFsdWUYASABKAkiGwoKQnl0ZXNWYWx1ZRINCgV2YWx1ZRgBIAEoDEKDAQoTY29tLmdvb2dsZS5wcm90b2J1ZkINV3JhcHBlcnNQcm90b1ABWjFnb29nbGUuZ29sYW5nLm9yZy9wcm90b2J1Zi90eXBlcy9rbm93bi93cmFwcGVyc3Bi+AEBogIDR1BCqgIeR29vZ2xlLlByb3RvYnVmLldlbGxLbm93blR5cGVzYgZwcm90bzM");function Qm(n,e){Ed(e,n);const t=tb(n.$unknown,e),[r,s,i]=Ta(e);for(const o of t)gd(r,new ic(o.data),s,o.wireType,{readUnknownFields:!0});return i()}function eb(n,e,t){var r;Ed(e,n);const s=((r=n.$unknown)!==null&&r!==void 0?r:[]).filter(c=>c.no!==e.number),[i,o]=Ta(e,t),a=new Xf;md(a,{writeUnknownFields:!0},i,o);const l=new ic(a.finish());for(;l.pos<l.len;){const[c,f]=l.tag(),g=l.skip(f,c);s.push({no:c,wireType:f,data:g})}n.$unknown=s}function tb(n,e){if(n===void 0)return[];if(e.fieldKind==="enum"||e.fieldKind==="scalar"){for(let t=n.length-1;t>=0;--t)if(n[t].no==e.number)return[n[t]];return[]}return n.filter(t=>t.no===e.number)}function Ta(n,e){const t=n.typeName,r=Object.assign(Object.assign({},n),{kind:"field",parent:n.extendee,localName:t}),s=Object.assign(Object.assign({},n.extendee),{fields:[r],members:[r],oneofs:[]}),i=fe(s,e!==void 0?{[t]:e}:void 0);return[Zn(s,i),r,()=>{const o=i[t];if(o===void 0){const a=n.message;return Io(a)?Ps(a.fields[0].scalar,a.fields[0].longAsString):fe(a)}return o}]}function Ed(n,e){if(n.extendee.typeName!=e.$typeName)throw new Error(`extension ${n.typeName} can only be applied to message ${n.extendee.typeName}`)}const nb=3,rb=2,Yu={alwaysEmitImplicit:!1,enumAsInteger:!1,useProtoFieldName:!1};function sb(n){return n?Object.assign(Object.assign({},Yu),n):Yu}function ib(n,e,t){return No(Zn(n,e),sb(t))}function ob(n,e,t){var r;const s=ib(n,e,t);return JSON.stringify(s,null,(r=t?.prettySpaces)!==null&&r!==void 0?r:0)}function No(n,e){var t;const r=ub(n,e);if(r!==void 0)return r;const s={};for(const i of n.sortedFields){if(!n.isSet(i)){if(i.presence==nb)throw new Error(`cannot encode ${i} to JSON: required field not set`);if(!e.alwaysEmitImplicit||i.presence!==rb)continue}const o=qu(i,n.get(i),e);o!==void 0&&(s[cb(i,e)]=o)}if(e.registry){const i=new Set;for(const{no:o}of(t=n.getUnknown())!==null&&t!==void 0?t:[])if(!i.has(o)){i.add(o);const a=e.registry.getExtensionFor(n.desc,o);if(!a)continue;const l=Qm(n.message,a),[c,f]=Ta(a,l),g=qu(f,c.get(f),e);g!==void 0&&(s[a.jsonName]=g)}}return s}function qu(n,e,t){switch(n.fieldKind){case"scalar":return xa(n,e);case"message":return No(e,t);case"enum":return mc(n.enum,e,t.enumAsInteger);case"list":return lb(e,t);case"map":return ab(e,t)}}function ab(n,e){const t=n.field(),r={};switch(t.mapKind){case"scalar":for(const[s,i]of n)r[s]=xa(t,i);break;case"message":for(const[s,i]of n)r[s]=No(i,e);break;case"enum":for(const[s,i]of n)r[s]=mc(t.enum,i,e.enumAsInteger);break}return e.alwaysEmitImplicit||n.size>0?r:void 0}function lb(n,e){const t=n.field(),r=[];switch(t.listKind){case"scalar":for(const s of n)r.push(xa(t,s));break;case"enum":for(const s of n)r.push(mc(t.enum,s,e.enumAsInteger));break;case"message":for(const s of n)r.push(No(s,e));break}return e.alwaysEmitImplicit||r.length>0?r:void 0}function mc(n,e,t){var r;if(typeof e!="number")throw new Error(`cannot encode ${n} to JSON: expected number, got ${Mt(e)}`);if(n.typeName=="google.protobuf.NullValue")return null;if(t)return e;const s=n.value[e];return(r=s?.name)!==null&&r!==void 0?r:e}function xa(n,e){var t,r,s,i,o,a;switch(n.scalar){case V.INT32:case V.SFIXED32:case V.SINT32:case V.FIXED32:case V.UINT32:if(typeof e!="number")throw new Error(`cannot encode ${n} to JSON: ${(t=Rs(n,e))===null||t===void 0?void 0:t.message}`);return e;case V.FLOAT:case V.DOUBLE:if(typeof e!="number")throw new Error(`cannot encode ${n} to JSON: ${(r=Rs(n,e))===null||r===void 0?void 0:r.message}`);return Number.isNaN(e)?"NaN":e===Number.POSITIVE_INFINITY?"Infinity":e===Number.NEGATIVE_INFINITY?"-Infinity":e;case V.STRING:if(typeof e!="string")throw new Error(`cannot encode ${n} to JSON: ${(s=Rs(n,e))===null||s===void 0?void 0:s.message}`);return e;case V.BOOL:if(typeof e!="boolean")throw new Error(`cannot encode ${n} to JSON: ${(i=Rs(n,e))===null||i===void 0?void 0:i.message}`);return e;case V.UINT64:case V.FIXED64:case V.INT64:case V.SFIXED64:case V.SINT64:if(typeof e!="bigint"&&typeof e!="string")throw new Error(`cannot encode ${n} to JSON: ${(o=Rs(n,e))===null||o===void 0?void 0:o.message}`);return e.toString();case V.BYTES:if(e instanceof Uint8Array)return Hp(e);throw new Error(`cannot encode ${n} to JSON: ${(a=Rs(n,e))===null||a===void 0?void 0:a.message}`)}}function cb(n,e){return e.useProtoFieldName?n.name:n.jsonName}function ub(n,e){if(n.desc.typeName.startsWith("google.protobuf."))switch(n.desc.typeName){case"google.protobuf.Any":return hb(n.message,e);case"google.protobuf.Timestamp":return gb(n.message);case"google.protobuf.Duration":return fb(n.message);case"google.protobuf.FieldMask":return db(n.message);case"google.protobuf.Struct":return Sd(n.message);case"google.protobuf.Value":return bc(n.message);case"google.protobuf.ListValue":return Id(n.message);default:if(Io(n.desc)){const t=n.desc.fields[0];return xa(t,n.get(t))}return}}function hb(n,e){if(n.typeUrl==="")return{};const{registry:t}=e;let r,s;if(t&&(r=qm(n,t),r&&(s=t.getMessage(r.$typeName))),!s||!r)throw new Error(`cannot encode message ${n.$typeName} to JSON: "${n.typeUrl}" is not in the type registry`);let i=No(Zn(s,r),e);return(s.typeName.startsWith("google.protobuf.")||i===null||Array.isArray(i)||typeof i!="object")&&(i={value:i}),i["@type"]=n.typeUrl,i}function fb(n){const e=Number(n.seconds),t=n.nanos;if(e>315576e6||e<-315576e6)throw new Error(`cannot encode message ${n.$typeName} to JSON: value out of range`);if(e>0&&t<0||e<0&&t>0)throw new Error(`cannot encode message ${n.$typeName} to JSON: nanos sign must match seconds sign`);let r=n.seconds.toString();if(t!==0){let s=Math.abs(t).toString();s="0".repeat(9-s.length)+s,s.substring(3)==="000000"?s=s.substring(0,3):s.substring(6)==="000"&&(s=s.substring(0,6)),r+="."+s,t<0&&e==0&&(r="-"+r)}return r+"s"}function db(n){return n.paths.map(e=>{if(e.match(/_[0-9]?_/g)||e.match(/[A-Z]/g))throw new Error(`cannot encode message ${n.$typeName} to JSON: lowerCamelCase of path name "`+e+'" is irreversible');return oo(e)}).join(",")}function Sd(n){const e={};for(const[t,r]of Object.entries(n.fields))e[t]=bc(r);return e}function bc(n){switch(n.kind.case){case"nullValue":return null;case"numberValue":if(!Number.isFinite(n.kind.value))throw new Error(`${n.$typeName} cannot be NaN or Infinity`);return n.kind.value;case"boolValue":return n.kind.value;case"stringValue":return n.kind.value;case"structValue":return Sd(n.kind.value);case"listValue":return Id(n.kind.value);default:throw new Error(`${n.$typeName} must have a value`)}}function Id(n){return n.values.map(bc)}function gb(n){const e=Number(n.seconds)*1e3;if(e<Date.parse("0001-01-01T00:00:00Z")||e>Date.parse("9999-12-31T23:59:59Z"))throw new Error(`cannot encode message ${n.$typeName} to JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive`);if(n.nanos<0)throw new Error(`cannot encode message ${n.$typeName} to JSON: nanos must not be negative`);if(n.nanos>999999999)throw new Error(`cannot encode message ${n.$typeName} to JSON: nanos must not be greater than 99999999`);let t="Z";if(n.nanos>0){const r=(n.nanos+1e9).toString().substring(1);r.substring(3)==="000000"?t="."+r.substring(0,3)+"Z":r.substring(6)==="000"?t="."+r.substring(0,6)+"Z":t="."+r+"Z"}return new Date(e).toISOString().replace(".000Z",t)}const zu={ignoreUnknownFields:!1};function pb(n){return n?Object.assign(Object.assign({},zu),n):zu}function mb(n,e,t){return bb(n,Nb(e,n.typeName),t)}function bb(n,e,t){const r=Zn(n);try{Ii(r,e,pb(t))}catch(s){throw Kp(s)?new Error(`cannot decode ${s.field()} from JSON: ${s.message}`,{cause:s}):s}return r.message}function Ii(n,e,t){var r;if(wb(n,e,t))return;if(e==null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode ${n.desc} from JSON: ${Mt(e)}`);const s=new Map,i=new Map;for(const o of n.desc.fields)i.set(o.name,o).set(o.jsonName,o);for(const[o,a]of Object.entries(e)){const l=i.get(o);if(l){if(l.oneof){if(a===null&&l.fieldKind=="scalar")continue;const c=s.get(l.oneof);if(c!==void 0)throw new yn(l.oneof,`oneof set multiple times by ${c.name} and ${l.name}`);s.set(l.oneof,l)}Xu(n,l,a,t)}else{let c;if(o.startsWith("[")&&o.endsWith("]")&&(c=(r=t.registry)===null||r===void 0?void 0:r.getExtension(o.substring(1,o.length-1)))&&c.extendee.typeName===n.desc.typeName){const[f,g,h]=Ta(c);Xu(f,g,a,t),eb(n.message,c,h())}if(!c&&!t.ignoreUnknownFields)throw new Error(`cannot decode ${n.desc} from JSON: key "${o}" is unknown`)}}}function Xu(n,e,t,r){switch(e.fieldKind){case"scalar":Sb(n,e,t);break;case"enum":Eb(n,e,t,r);break;case"message":Ab(n,e,t,r);break;case"list":vb(n.get(e),t,r);break;case"map":yb(n.get(e),t,r);break}}function yb(n,e,t){if(e===null)return;const r=n.field();if(typeof e!="object"||Array.isArray(e))throw new yn(r,"expected object, got "+Mt(e));for(const[s,i]of Object.entries(e)){if(i===null)throw new yn(r,"map value must not be null");let o;switch(r.mapKind){case"message":const l=Zn(r.message);Ii(l,i,t),o=l;break;case"enum":if(o=yc(r.enum,i,t.ignoreUnknownFields,!0),o===Ca)return;break;case"scalar":o=_a(r,i,!0);break}const a=Ib(r.mapKey,s);n.set(a,o)}}function vb(n,e,t){if(e===null)return;const r=n.field();if(!Array.isArray(e))throw new yn(r,"expected Array, got "+Mt(e));for(const s of e){if(s===null)throw new yn(r,"list item must not be null");switch(r.listKind){case"message":const i=Zn(r.message);Ii(i,s,t),n.add(i);break;case"enum":const o=yc(r.enum,s,t.ignoreUnknownFields,!0);o!==Ca&&n.add(o);break;case"scalar":n.add(_a(r,s,!0));break}}}function Ab(n,e,t,r){if(t===null&&e.message.typeName!="google.protobuf.Value"){n.clear(e);return}const s=n.isSet(e)?n.get(e):Zn(e.message);Ii(s,t,r),n.set(e,s)}function Eb(n,e,t,r){const s=yc(e.enum,t,r.ignoreUnknownFields,!1);s===Ra?n.clear(e):s!==Ca&&n.set(e,s)}function Sb(n,e,t){const r=_a(e,t,!1);r===Ra?n.clear(e):n.set(e,r)}const Ca=Symbol();function yc(n,e,t,r){if(e===null)return n.typeName=="google.protobuf.NullValue"?0:r?n.values[0].number:Ra;switch(typeof e){case"number":if(Number.isInteger(e))return e;break;case"string":const s=n.values.find(i=>i.name===e);if(s!==void 0)return s.number;if(t)return Ca;break}throw new Error(`cannot decode ${n} from JSON: ${Mt(e)}`)}const Ra=Symbol();function _a(n,e,t){if(e===null)return t?Ps(n.scalar,!1):Ra;switch(n.scalar){case V.DOUBLE:case V.FLOAT:if(e==="NaN")return NaN;if(e==="Infinity")return Number.POSITIVE_INFINITY;if(e==="-Infinity")return Number.NEGATIVE_INFINITY;if(typeof e=="number"){if(Number.isNaN(e))throw new yn(n,"unexpected NaN number");if(!Number.isFinite(e))throw new yn(n,"unexpected infinite number");break}if(typeof e=="string"){if(e===""||e.trim().length!==e.length)break;const r=Number(e);if(!Number.isFinite(r))break;return r}break;case V.INT32:case V.FIXED32:case V.SFIXED32:case V.SINT32:case V.UINT32:return Nd(e);case V.BYTES:if(typeof e=="string"){if(e==="")return new Uint8Array(0);try{return hc(e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new yn(n,s)}}break}return e}function Ib(n,e){switch(n){case V.BOOL:switch(e){case"true":return!0;case"false":return!1}return e;case V.INT32:case V.FIXED32:case V.UINT32:case V.SFIXED32:case V.SINT32:return Nd(e);default:return e}}function Nd(n){if(typeof n=="string"){if(n===""||n.trim().length!==n.length)return n;const e=Number(n);return Number.isNaN(e)?n:e}return n}function Nb(n,e){try{return JSON.parse(n)}catch(t){const r=t instanceof Error?t.message:String(t);throw new Error(`cannot decode message ${e} from JSON: ${r}`,{cause:t})}}function wb(n,e,t){if(!n.desc.typeName.startsWith("google.protobuf."))return!1;switch(n.desc.typeName){case"google.protobuf.Any":return Tb(n.message,e,t),!0;case"google.protobuf.Timestamp":return xb(n.message,e),!0;case"google.protobuf.Duration":return Cb(n.message,e),!0;case"google.protobuf.FieldMask":return Rb(n.message,e),!0;case"google.protobuf.Struct":return wd(n.message,e),!0;case"google.protobuf.Value":return vc(n.message,e),!0;case"google.protobuf.ListValue":return Td(n.message,e),!0;default:if(Io(n.desc)){const r=n.desc.fields[0];return e===null?n.clear(r):n.set(r,_a(r,e,!0)),!0}return!1}}function Tb(n,e,t){var r;if(e===null||Array.isArray(e)||typeof e!="object")throw new Error(`cannot decode message ${n.$typeName} from JSON: expected object but got ${Mt(e)}`);if(Object.keys(e).length==0)return;const s=e["@type"];if(typeof s!="string"||s=="")throw new Error(`cannot decode message ${n.$typeName} from JSON: "@type" is empty`);const i=s.includes("/")?s.substring(s.lastIndexOf("/")+1):s;if(!i.length)throw new Error(`cannot decode message ${n.$typeName} from JSON: "@type" is invalid`);const o=(r=t.registry)===null||r===void 0?void 0:r.getMessage(i);if(!o)throw new Error(`cannot decode message ${n.$typeName} from JSON: ${s} is not in the type registry`);const a=Zn(o);if(i.startsWith("google.protobuf.")&&Object.prototype.hasOwnProperty.call(e,"value")){const l=e.value;Ii(a,l,t)}else{const l=Object.assign({},e);delete l["@type"],Ii(a,l,t)}jm(a.desc,a.message,n)}function xb(n,e){if(typeof e!="string")throw new Error(`cannot decode message ${n.$typeName} from JSON: ${Mt(e)}`);const t=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:\.([0-9]{1,9}))?(?:Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!t)throw new Error(`cannot decode message ${n.$typeName} from JSON: invalid RFC 3339 string`);const r=Date.parse(t[1]+"-"+t[2]+"-"+t[3]+"T"+t[4]+":"+t[5]+":"+t[6]+(t[8]?t[8]:"Z"));if(Number.isNaN(r))throw new Error(`cannot decode message ${n.$typeName} from JSON: invalid RFC 3339 string`);if(r<Date.parse("0001-01-01T00:00:00Z")||r>Date.parse("9999-12-31T23:59:59Z"))throw new Error(`cannot decode message ${n.$typeName} from JSON: must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive`);n.seconds=gt.parse(r/1e3),n.nanos=0,t[7]&&(n.nanos=parseInt("1"+t[7]+"0".repeat(9-t[7].length))-1e9)}function Cb(n,e){if(typeof e!="string")throw new Error(`cannot decode message ${n.$typeName} from JSON: ${Mt(e)}`);const t=e.match(/^(-?[0-9]+)(?:\.([0-9]+))?s/);if(t===null)throw new Error(`cannot decode message ${n.$typeName} from JSON: ${Mt(e)}`);const r=Number(t[1]);if(r>315576e6||r<-315576e6)throw new Error(`cannot decode message ${n.$typeName} from JSON: ${Mt(e)}`);if(n.seconds=gt.parse(r),typeof t[2]!="string")return;const s=t[2]+"0".repeat(9-t[2].length);n.nanos=parseInt(s),(r<0||Object.is(r,-0))&&(n.nanos=-n.nanos)}function Rb(n,e){if(typeof e!="string")throw new Error(`cannot decode message ${n.$typeName} from JSON: ${Mt(e)}`);if(e==="")return;function t(r){if(r.includes("_"))throw new Error(`cannot decode message ${n.$typeName} from JSON: path names must be lowerCamelCase`);const s=r.replace(/[A-Z]/g,i=>"_"+i.toLowerCase());return s[0]==="_"?s.substring(1):s}n.paths=e.split(",").map(t)}function wd(n,e){if(typeof e!="object"||e==null||Array.isArray(e))throw new Error(`cannot decode message ${n.$typeName} from JSON ${Mt(e)}`);for(const[t,r]of Object.entries(e)){const s=fe(Ad);vc(s,r),n.fields[t]=s}}function vc(n,e){switch(typeof e){case"number":n.kind={case:"numberValue",value:e};break;case"string":n.kind={case:"stringValue",value:e};break;case"boolean":n.kind={case:"boolValue",value:e};break;case"object":if(e===null)n.kind={case:"nullValue",value:Tl.NULL_VALUE};else if(Array.isArray(e)){const t=fe(Jm);Td(t,e),n.kind={case:"listValue",value:t}}else{const t=fe(Xm);wd(t,e),n.kind={case:"structValue",value:t}}break;default:throw new Error(`cannot decode message ${n.$typeName} from JSON ${Mt(e)}`)}return n}function Td(n,e){if(!Array.isArray(e))throw new Error(`cannot decode message ${n.$typeName} from JSON ${Mt(e)}`);for(const t of e){const r=fe(Ad);vc(r,t),n.values.push(r)}}function Ju(n){const e=Pe[n];return typeof e!="string"?n.toString():e[0].toLowerCase()+e.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}class He extends Error{constructor(e,t=Pe.Unknown,r,s,i){super(_b(e,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=e,this.code=t,this.metadata=new Headers(r??{}),this.details=s??[],this.cause=i}static from(e,t=Pe.Unknown){return e instanceof He?e:e instanceof Error?e.name=="AbortError"||e.name=="TimeoutError"?new He(e.message,Pe.Canceled):new He(e.message,t,void 0,void 0,e):new He(String(e),t,void 0,void 0,e)}static[Symbol.hasInstance](e){return e instanceof Error?Object.getPrototypeOf(e)===He.prototype?!0:e.name==="ConnectError"&&"code"in e&&typeof e.code=="number"&&"metadata"in e&&"details"in e&&Array.isArray(e.details)&&"rawMessage"in e&&typeof e.rawMessage=="string"&&"cause"in e:!1}findDetails(e){const t=e.kind==="message"?{getMessage:s=>s===e.typeName?e:void 0}:e,r=[];for(const s of this.details){if("desc"in s){t.getMessage(s.desc.typeName)&&r.push(fe(s.desc,s.value));continue}const i=t.getMessage(s.type);if(i)try{r.push(Gn(i,s.value))}catch{}}return r}}function _b(n,e){return n.length?`[${Ju(e)}] ${n}`:`[${Ju(e)}]`}function Lb(n,e,t){try{const r=hc(n);return e?Gn(e,r,t):r}catch(r){throw He.from(r,Pe.DataLoss)}}function Ob(n,e){const t={};for(const r of n.methods){const s=e(r);s!=null&&(t[r.localName]=s)}return t}const Hu=1;function kb(n,e,t=!1){if(e>n){let r=`message size is larger than configured readMaxBytes ${n}`;throw t&&(r=`message size ${e} is larger than configured readMaxBytes ${n}`),new He(r,Pe.ResourceExhausted)}}function Db(n){return new Bb(n)}class Bb{constructor(e){this.readMaxBytes=e,this.header=new Uint8Array(5),this.headerView=new DataView(this.header.buffer),this.buf=[]}get byteLength(){return this.buf.reduce((e,t)=>e+t.byteLength,0)}decode(e){this.buf.push(e);const t=[];for(;;){let r=this.pop();if(!r)break;t.push(r)}return t}pop(){if(!(!this.env&&(this.env=this.head(),!this.env))&&this.cons(this.env.data)){const e=this.env;return this.env=void 0,e}}head(){if(!this.cons(this.header))return;const e=this.headerView.getUint8(0),t=this.headerView.getUint32(1);return kb(this.readMaxBytes,t,!0),{flags:e,data:new Uint8Array(t)}}cons(e){const t=e.byteLength;if(this.byteLength<t)return!1;let r=0;for(;r<t;){const s=this.buf.shift();s.byteLength>t-r?(e.set(s.subarray(0,t-r),r),this.buf.unshift(s.subarray(t-r)),r+=t-r):(e.set(s,r),r+=s.byteLength)}return!0}}function Qu(n){let e;const t=Db(4294967295);return new ReadableStream({start(){e=n.getReader()},async pull(r){let s=!1;for(;!s;){const i=await e.read();if(i.done)t.byteLength>0&&r.error(new He("protocol error: incomplete envelope",Pe.InvalidArgument)),r.close();else for(const o of t.decode(i.value))r.enqueue(o),s=!0}}})}function eh(n,e){const t=new Uint8Array(e.length+5);t.set(e,5);const r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setUint8(0,n),r.setUint32(1,e.length),t}var Vb=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,l){o=n[i](o),s(a,l,o.done,o.value)})}}function s(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}},co=function(n){return this instanceof co?(this.v=n,this):new co(n)},Pb=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(d){return function(m){return Promise.resolve(m).then(d,g)}}function a(d,m){r[d]&&(s[d]=function(v){return new Promise(function(I,E){i.push([d,v,I,E])>1||l(d,v)})},m&&(s[d]=m(s[d])))}function l(d,m){try{c(r[d](m))}catch(v){h(i[0][3],v)}}function c(d){d.value instanceof co?Promise.resolve(d.value.v).then(f,g):h(i[0][2],d)}function f(d){l("next",d)}function g(d){l("throw",d)}function h(d,m){d(m),i.shift(),i.length&&l(i[0][0],i[0][1])}},Mb=function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:co(n[s](o)),done:!1}:i?i(o):o}:i}};function Ub(n){return Pb(this,arguments,function*(){yield co(yield*Mb(Vb(n)))})}var xd=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=n[i]&&function(o){return new Promise(function(a,l){o=n[i](o),s(a,l,o.done,o.value)})}}function s(i,o,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},o)}},Ni=function(n){return this instanceof Ni?(this.v=n,this):new Ni(n)},Wb=function(n){var e,t;return e={},r("next"),r("throw",function(s){throw s}),r("return"),e[Symbol.iterator]=function(){return this},e;function r(s,i){e[s]=n[s]?function(o){return(t=!t)?{value:Ni(n[s](o)),done:!1}:i?i(o):o}:i}},Fb=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(d){return function(m){return Promise.resolve(m).then(d,g)}}function a(d,m){r[d]&&(s[d]=function(v){return new Promise(function(I,E){i.push([d,v,I,E])>1||l(d,v)})},m&&(s[d]=m(s[d])))}function l(d,m){try{c(r[d](m))}catch(v){h(i[0][3],v)}}function c(d){d.value instanceof Ni?Promise.resolve(d.value.v).then(f,g):h(i[0][2],d)}function f(d){l("next",d)}function g(d){l("throw",d)}function h(d,m){d(m),i.shift(),i.length&&l(i[0][0],i[0][1])}};function Zb(n,e){return Ob(n,t=>{switch(t.methodKind){case"unary":return Gb(e,t);case"server_streaming":return $b(e,t);case"client_streaming":return Kb(e,t);case"bidi_streaming":return jb(e,t);default:return null}})}function Gb(n,e){return async(t,r)=>{var s,i;const o=await n.unary(e,r?.signal,r?.timeoutMs,r?.headers,t,r?.contextValues);return(s=r?.onHeader)===null||s===void 0||s.call(r,o.header),(i=r?.onTrailer)===null||i===void 0||i.call(r,o.trailer),o.message}}function $b(n,e){return(t,r)=>Cd(n.stream(e,r?.signal,r?.timeoutMs,r?.headers,Ub([t]),r?.contextValues),r)}function Kb(n,e){return async(t,r)=>{var s,i,o,a,l,c;const f=await n.stream(e,r?.signal,r?.timeoutMs,r?.headers,t,r?.contextValues);(l=r?.onHeader)===null||l===void 0||l.call(r,f.header);let g,h=0;try{for(var d=!0,m=xd(f.message),v;v=await m.next(),s=v.done,!s;d=!0)a=v.value,d=!1,g=a,h++}catch(I){i={error:I}}finally{try{!d&&!s&&(o=m.return)&&await o.call(m)}finally{if(i)throw i.error}}if(!g)throw new He("protocol error: missing response message",Pe.Unimplemented);if(h>1)throw new He("protocol error: received extra messages for client streaming method",Pe.Unimplemented);return(c=r?.onTrailer)===null||c===void 0||c.call(r,f.trailer),g}}function jb(n,e){return(t,r)=>Cd(n.stream(e,r?.signal,r?.timeoutMs,r?.headers,t,r?.contextValues),r)}function Cd(n,e){const t=(function(){return Fb(this,arguments,function*(){var r,s;const i=yield Ni(n);(r=e?.onHeader)===null||r===void 0||r.call(e,i.header),yield Ni(yield*Wb(xd(i.message))),(s=e?.onTrailer)===null||s===void 0||s.call(e,i.trailer)})})()[Symbol.asyncIterator]();return{[Symbol.asyncIterator]:()=>({next:()=>t.next()})}}function Yb(...n){const e=new AbortController,t=n.filter(s=>s!==void 0).concat(e.signal);for(const s of t){if(s.aborted){r.apply(s);break}s.addEventListener("abort",r)}function r(){e.signal.aborted||e.abort(Rd(this));for(const s of t)s.removeEventListener("abort",r)}return e}function qb(n){const e=new AbortController,t=()=>{e.abort(new He("the operation timed out",Pe.DeadlineExceeded))};let r;return n!==void 0&&(n<=0?t():r=setTimeout(t,n)),{signal:e.signal,cleanup:()=>clearTimeout(r)}}function Rd(n){if(!n.aborted)return;if(n.reason!==void 0)return n.reason;const e=new Error("This operation was aborted");return e.name="AbortError",e}function th(){return{get(n){return n.id in this?this[n.id]:n.defaultValue},set(n,e){return this[n.id]=e,this},delete(n){return delete this[n.id],this}}}const el=128;function nh(n){const e=new Headers,t=new TextDecoder().decode(n).split(`\r
`);for(const r of t){if(r==="")continue;const s=r.indexOf(":");if(s>0){const i=r.substring(0,s).trim(),o=r.substring(s+1).trim();e.append(i,o)}}return e}const zb="Content-Type",Xb="Grpc-Timeout",wi="Grpc-Status",_d="Grpc-Message",Jb="Grpc-Status-Details-Bin",Hb="User-Agent",rh="X-User-Agent",Qb="X-Grpc-Web",ey="application/grpc-web+proto",ty="application/grpc-web+json";function ny(n,e,...t){if(t.length>0)throw new Error;return n.services[e]}const ry=zr("CgxzdGF0dXMucHJvdG8SCmdvb2dsZS5ycGMiTgoGU3RhdHVzEgwKBGNvZGUYASABKAUSDwoHbWVzc2FnZRgCIAEoCRIlCgdkZXRhaWxzGAMgAygLMhQuZ29vZ2xlLnByb3RvYnVmLkFueUJeCg5jb20uZ29vZ2xlLnJwY0ILU3RhdHVzUHJvdG9QAVo3Z29vZ2xlLmdvbGFuZy5vcmcvZ2VucHJvdG8vZ29vZ2xlYXBpcy9ycGMvc3RhdHVzO3N0YXR1c6ICA1JQQ2IGcHJvdG8z",[pd]),sy=xe(ry,0),iy="0";function Ld(n){var e;const t=n.get(Jb);if(t!=null){const s=Lb(t,sy);if(s.code==0)return;const i=new He(s.message,s.code,n);return i.details=s.details.map(o=>({type:o.typeUrl.substring(o.typeUrl.lastIndexOf("/")+1),value:o.value})),i}const r=n.get(wi);if(r!=null){if(r===iy)return;const s=parseInt(r,10);return s in Pe?new He(decodeURIComponent((e=n.get(_d))!==null&&e!==void 0?e:""),s,n):new He(`invalid grpc-status: ${r}`,Pe.Internal,n)}}function sh(n,e){return n.toString().replace(/\/?$/,`/${e.parent.typeName}/${e.name}`)}function Od(n,e){return fe(n,e)}function oy(n,e){function t(r){return r.done===!0?r:{done:r.done,value:Od(n,r.value)}}return{[Symbol.asyncIterator](){const r=e[Symbol.asyncIterator](),s={next:()=>r.next().then(t)};return r.throw!==void 0&&(s.throw=i=>r.throw(i).then(t)),r.return!==void 0&&(s.return=i=>r.return(i).then(t)),s}}}function kd(n,e){if(!e)return n;for(const t of e.concat().reverse())n=t(n);return n}function ay(n){var e;const t=Object.assign({},n);return(e=t.ignoreUnknownFields)!==null&&e!==void 0||(t.ignoreUnknownFields=!0),t}function ih(n,e,t,r){const s=e?oh(n.input,r):ah(n.input,t);return{parse:(e?oh(n.output,r):ah(n.output,t)).parse,serialize:s.serialize}}function oh(n,e){return{parse(t){try{return Gn(n,t,e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new He(`parse binary: ${s}`,Pe.Internal)}},serialize(t){try{return As(n,t,e)}catch(r){const s=r instanceof Error?r.message:String(r);throw new He(`serialize binary: ${s}`,Pe.Internal)}}}}function ah(n,e){var t,r;const s=(t=e?.textEncoder)!==null&&t!==void 0?t:new TextEncoder,i=(r=e?.textDecoder)!==null&&r!==void 0?r:new TextDecoder,o=ay(e);return{parse(a){try{const l=i.decode(a);return mb(n,l,o)}catch(l){throw He.from(l,Pe.InvalidArgument)}},serialize(a){try{const l=ob(n,a,o);return s.encode(l)}catch(l){throw He.from(l,Pe.Internal)}}}}function ly(n){const e=kd(n.next,n.interceptors),[t,r,s]=Dd(n),i=Object.assign(Object.assign({},n.req),{message:Od(n.req.method.input,n.req.message),signal:t});return e(i).then(o=>(s(),o),r)}function cy(n){const e=kd(n.next,n.interceptors),[t,r,s]=Dd(n),i=Object.assign(Object.assign({},n.req),{message:oy(n.req.method.input,n.req.message),signal:t});let o=!1;return t.addEventListener("abort",function(){var a,l;const c=n.req.message[Symbol.asyncIterator]();o||(a=c.throw)===null||a===void 0||a.call(c,this.reason).catch(()=>{}),(l=c.return)===null||l===void 0||l.call(c).catch(()=>{})}),e(i).then(a=>Object.assign(Object.assign({},a),{message:{[Symbol.asyncIterator](){const l=a.message[Symbol.asyncIterator]();return{next(){return l.next().then(c=>(c.done==!0&&(o=!0,s()),c),r)}}}}}),r)}function Dd(n){const{signal:e,cleanup:t}=qb(n.timeoutMs),r=Yb(n.signal,e);return[r.signal,function(i){const o=He.from(e.aborted?Rd(e):i);return r.abort(o),t(),Promise.reject(o)},function(){t(),r.abort()}]}function uy(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}function lh(n,e){const t=Ld(n);if(t)throw e.forEach((r,s)=>{t.metadata.append(s,r)}),t;if(!e.has(wi)&&!n.has(wi))throw new He("protocol error: missing status",Pe.Internal)}function ch(n,e,t,r){var s,i;const o=new Headers(t??{});o.set(zb,n?ey:ty),o.set(Qb,"1");const a=(i=(s=o.get(Hb))!==null&&s!==void 0?s:o.get(rh))!==null&&i!==void 0?i:"connect-es/2.1.1";return o.set(rh,a),e!==void 0&&o.set(Xb,`${e}m`),o}function hy(n){switch(n){case 400:return Pe.Internal;case 401:return Pe.Unauthenticated;case 403:return Pe.PermissionDenied;case 404:return Pe.Unimplemented;case 429:return Pe.Unavailable;case 502:return Pe.Unavailable;case 503:return Pe.Unavailable;case 504:return Pe.Unavailable;default:return Pe.Unknown}}function uh(n,e){var t;if(n>=200&&n<300)return{foundStatus:e.has(wi),headerError:Ld(e)};throw new He(decodeURIComponent((t=e.get(_d))!==null&&t!==void 0?t:`HTTP ${n}`),hy(n),e)}var Bs=function(n){return this instanceof Bs?(this.v=n,this):new Bs(n)},fy=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,i=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",o),s[Symbol.asyncIterator]=function(){return this},s;function o(d){return function(m){return Promise.resolve(m).then(d,g)}}function a(d,m){r[d]&&(s[d]=function(v){return new Promise(function(I,E){i.push([d,v,I,E])>1||l(d,v)})},m&&(s[d]=m(s[d])))}function l(d,m){try{c(r[d](m))}catch(v){h(i[0][3],v)}}function c(d){d.value instanceof Bs?Promise.resolve(d.value.v).then(f,g):h(i[0][2],d)}function f(d){l("next",d)}function g(d){l("throw",d)}function h(d,m){d(m),i.shift(),i.length&&l(i[0][0],i[0][1])}};const hh={redirect:"error"};function dy(n){var e;uy();const t=(e=n.useBinaryFormat)!==null&&e!==void 0?e:!0;return{async unary(r,s,i,o,a,l){const{serialize:c,parse:f}=ih(r,t,n.jsonOptions,n.binaryOptions);return i=i===void 0?n.defaultTimeoutMs:i<=0?void 0:i,await ly({interceptors:n.interceptors,signal:s,timeoutMs:i,req:{stream:!1,service:r.parent,method:r,requestMethod:"POST",url:sh(n.baseUrl,r),header:ch(t,i,o),contextValues:l??th(),message:a},next:async g=>{var h;const m=await((h=n.fetch)!==null&&h!==void 0?h:globalThis.fetch)(g.url,Object.assign(Object.assign({},hh),{method:g.requestMethod,headers:g.header,signal:g.signal,body:eh(0,c(g.message))})),{headerError:v}=uh(m.status,m.headers);if(!m.body)throw v!==void 0?v:"missing response body";const I=Qu(m.body).getReader();let E,y;for(;;){const p=await I.read();if(p.done)break;const{flags:A,data:S}=p.value;if((A&Hu)===Hu)throw new He("protocol error: received unsupported compressed output",Pe.Internal);if(A===el){if(E!==void 0)throw"extra trailer";E=nh(S);continue}if(y!==void 0)throw new He("extra message",Pe.Unimplemented);y=f(S)}if(E===void 0)throw v!==void 0?v:new He("missing trailer",m.headers.has(wi)?Pe.Unimplemented:Pe.Unknown);if(lh(E,m.headers),y===void 0)throw new He("missing message",E.has(wi)?Pe.Unimplemented:Pe.Unknown);return{stream:!1,service:r.parent,method:r,header:m.headers,message:y,trailer:E}}})},async stream(r,s,i,o,a,l){const{serialize:c,parse:f}=ih(r,t,n.jsonOptions,n.binaryOptions);function g(d,m,v,I,E){return fy(this,arguments,function*(){const p=Qu(d).getReader();if(m){if(!(yield Bs(p.read())).done)throw"extra data for trailers-only";return yield Bs(void 0)}let A=!1;for(;;){const S=yield Bs(p.read());if(S.done)break;const{flags:T,data:B}=S.value;if((T&el)===el){if(A)throw"extra trailer";A=!0;const $=nh(B);lh($,I),$.forEach((X,H)=>v.set(H,X));continue}if(A)throw"extra message";yield yield Bs(f(B))}if("throwIfAborted"in E&&E.throwIfAborted(),!A)throw"missing trailer"})}async function h(d){if(r.methodKind!="server_streaming")throw"The fetch API does not support streaming request bodies";const m=await d[Symbol.asyncIterator]().next();if(m.done==!0)throw"missing request message";return eh(0,c(m.value))}return i=i===void 0?n.defaultTimeoutMs:i<=0?void 0:i,cy({interceptors:n.interceptors,signal:s,timeoutMs:i,req:{stream:!0,service:r.parent,method:r,requestMethod:"POST",url:sh(n.baseUrl,r),header:ch(t,i,o),contextValues:l??th(),message:a},next:async d=>{var m;const I=await((m=n.fetch)!==null&&m!==void 0?m:globalThis.fetch)(d.url,Object.assign(Object.assign({},hh),{method:d.requestMethod,headers:d.header,signal:d.signal,body:await h(d.message)})),{foundStatus:E,headerError:y}=uh(I.status,I.headers);if(y!=null)throw y;if(!I.body)throw"missing response body";const p=new Headers;return Object.assign(Object.assign({},d),{header:I.headers,trailer:p,message:g(I.body,E,p,I.headers,d.signal)})}})}}}const Be=zr("CiFzcmMvYXBpL3lvcmtpZS92MS9yZXNvdXJjZXMucHJvdG8SCXlvcmtpZS52MSKuAQoIU25hcHNob3QSJAoEcm9vdBgBIAEoCzIWLnlvcmtpZS52MS5KU09ORWxlbWVudBI1CglwcmVzZW5jZXMYAiADKAsyIi55b3JraWUudjEuU25hcHNob3QuUHJlc2VuY2VzRW50cnkaRQoOUHJlc2VuY2VzRW50cnkSCwoDa2V5GAEgASgJEiIKBXZhbHVlGAIgASgLMhMueW9ya2llLnYxLlByZXNlbmNlOgI4ASL7AQoKQ2hhbmdlUGFjaxIUCgxkb2N1bWVudF9rZXkYASABKAkSKQoKY2hlY2twb2ludBgCIAEoCzIVLnlvcmtpZS52MS5DaGVja3BvaW50EhAKCHNuYXBzaG90GAMgASgMEiIKB2NoYW5nZXMYBCADKAsyES55b3JraWUudjEuQ2hhbmdlEjAKEW1pbl9zeW5jZWRfdGlja2V0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSEgoKaXNfcmVtb3ZlZBgGIAEoCBIwCg52ZXJzaW9uX3ZlY3RvchgHIAEoCzIYLnlvcmtpZS52MS5WZXJzaW9uVmVjdG9yIpgBCgZDaGFuZ2USHwoCaWQYASABKAsyEy55b3JraWUudjEuQ2hhbmdlSUQSDwoHbWVzc2FnZRgCIAEoCRIoCgpvcGVyYXRpb25zGAMgAygLMhQueW9ya2llLnYxLk9wZXJhdGlvbhIyCg9wcmVzZW5jZV9jaGFuZ2UYBCABKAsyGS55b3JraWUudjEuUHJlc2VuY2VDaGFuZ2UihwEKCENoYW5nZUlEEhIKCmNsaWVudF9zZXEYASABKA0SEgoKc2VydmVyX3NlcRgCIAEoAxIPCgdsYW1wb3J0GAMgASgDEhAKCGFjdG9yX2lkGAQgASgMEjAKDnZlcnNpb25fdmVjdG9yGAUgASgLMhgueW9ya2llLnYxLlZlcnNpb25WZWN0b3IidAoNVmVyc2lvblZlY3RvchI0CgZ2ZWN0b3IYASADKAsyJC55b3JraWUudjEuVmVyc2lvblZlY3Rvci5WZWN0b3JFbnRyeRotCgtWZWN0b3JFbnRyeRILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAM6AjgBIqwaCglPcGVyYXRpb24SJwoDc2V0GAEgASgLMhgueW9ya2llLnYxLk9wZXJhdGlvbi5TZXRIABInCgNhZGQYAiABKAsyGC55b3JraWUudjEuT3BlcmF0aW9uLkFkZEgAEikKBG1vdmUYAyABKAsyGS55b3JraWUudjEuT3BlcmF0aW9uLk1vdmVIABItCgZyZW1vdmUYBCABKAsyGy55b3JraWUudjEuT3BlcmF0aW9uLlJlbW92ZUgAEikKBGVkaXQYBSABKAsyGS55b3JraWUudjEuT3BlcmF0aW9uLkVkaXRIABIrCgVzdHlsZRgHIAEoCzIaLnlvcmtpZS52MS5PcGVyYXRpb24uU3R5bGVIABIxCghpbmNyZWFzZRgIIAEoCzIdLnlvcmtpZS52MS5PcGVyYXRpb24uSW5jcmVhc2VIABIyCgl0cmVlX2VkaXQYCSABKAsyHS55b3JraWUudjEuT3BlcmF0aW9uLlRyZWVFZGl0SAASNAoKdHJlZV9zdHlsZRgKIAEoCzIeLnlvcmtpZS52MS5PcGVyYXRpb24uVHJlZVN0eWxlSAASMgoJYXJyYXlfc2V0GAsgASgLMh0ueW9ya2llLnYxLk9wZXJhdGlvbi5BcnJheVNldEgAGp0BCgNTZXQSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBILCgNrZXkYAiABKAkSKwoFdmFsdWUYAyABKAsyHC55b3JraWUudjEuSlNPTkVsZW1lbnRTaW1wbGUSKgoLZXhlY3V0ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBrAAQoDQWRkEjAKEXBhcmVudF9jcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSLgoPcHJldl9jcmVhdGVkX2F0GAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKwoFdmFsdWUYAyABKAsyHC55b3JraWUudjEuSlNPTkVsZW1lbnRTaW1wbGUSKgoLZXhlY3V0ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBq/AQoETW92ZRIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Ei4KD3ByZXZfY3JlYXRlZF9hdBgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EikKCmNyZWF0ZWRfYXQYAyABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIqCgtleGVjdXRlZF9hdBgEIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0GpEBCgZSZW1vdmUSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpjcmVhdGVkX2F0GAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKgoLZXhlY3V0ZWRfYXQYAyABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBrZAwoERWRpdBIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EiQKBGZyb20YAiABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSIgoCdG8YAyABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSUwoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYBCADKAsyMi55b3JraWUudjEuT3BlcmF0aW9uLkVkaXQuQ3JlYXRlZEF0TWFwQnlBY3RvckVudHJ5Eg8KB2NvbnRlbnQYBSABKAkSKgoLZXhlY3V0ZWRfYXQYBiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBI9CgphdHRyaWJ1dGVzGAcgAygLMikueW9ya2llLnYxLk9wZXJhdGlvbi5FZGl0LkF0dHJpYnV0ZXNFbnRyeRpRChhDcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkSCwoDa2V5GAEgASgJEiQKBXZhbHVlGAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQ6AjgBGjEKD0F0dHJpYnV0ZXNFbnRyeRILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAk6AjgBGssDCgVTdHlsZRIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EiQKBGZyb20YAiABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSIgoCdG8YAyABKAsyFi55b3JraWUudjEuVGV4dE5vZGVQb3MSPgoKYXR0cmlidXRlcxgEIAMoCzIqLnlvcmtpZS52MS5PcGVyYXRpb24uU3R5bGUuQXR0cmlidXRlc0VudHJ5EioKC2V4ZWN1dGVkX2F0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSVAoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYBiADKAsyMy55b3JraWUudjEuT3BlcmF0aW9uLlN0eWxlLkNyZWF0ZWRBdE1hcEJ5QWN0b3JFbnRyeRoxCg9BdHRyaWJ1dGVzRW50cnkSCwoDa2V5GAEgASgJEg0KBXZhbHVlGAIgASgJOgI4ARpRChhDcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkSCwoDa2V5GAEgASgJEiQKBXZhbHVlGAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQ6AjgBGpUBCghJbmNyZWFzZRIwChFwYXJlbnRfY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EisKBXZhbHVlGAIgASgLMhwueW9ya2llLnYxLkpTT05FbGVtZW50U2ltcGxlEioKC2V4ZWN1dGVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQakwMKCFRyZWVFZGl0EjAKEXBhcmVudF9jcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSIAoEZnJvbRgCIAEoCzISLnlvcmtpZS52MS5UcmVlUG9zEh4KAnRvGAMgASgLMhIueW9ya2llLnYxLlRyZWVQb3MSVwoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYBCADKAsyNi55b3JraWUudjEuT3BlcmF0aW9uLlRyZWVFZGl0LkNyZWF0ZWRBdE1hcEJ5QWN0b3JFbnRyeRImCghjb250ZW50cxgFIAMoCzIULnlvcmtpZS52MS5UcmVlTm9kZXMSEwoLc3BsaXRfbGV2ZWwYByABKAUSKgoLZXhlY3V0ZWRfYXQYBiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBpRChhDcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkSCwoDa2V5GAEgASgJEiQKBXZhbHVlGAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQ6AjgBGu0DCglUcmVlU3R5bGUSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIgCgRmcm9tGAIgASgLMhIueW9ya2llLnYxLlRyZWVQb3MSHgoCdG8YAyABKAsyEi55b3JraWUudjEuVHJlZVBvcxJCCgphdHRyaWJ1dGVzGAQgAygLMi4ueW9ya2llLnYxLk9wZXJhdGlvbi5UcmVlU3R5bGUuQXR0cmlidXRlc0VudHJ5EioKC2V4ZWN1dGVkX2F0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSHAoUYXR0cmlidXRlc190b19yZW1vdmUYBiADKAkSWAoXY3JlYXRlZF9hdF9tYXBfYnlfYWN0b3IYByADKAsyNy55b3JraWUudjEuT3BlcmF0aW9uLlRyZWVTdHlsZS5DcmVhdGVkQXRNYXBCeUFjdG9yRW50cnkaMQoPQXR0cmlidXRlc0VudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAEaUQoYQ3JlYXRlZEF0TWFwQnlBY3RvckVudHJ5EgsKA2tleRgBIAEoCRIkCgV2YWx1ZRgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0OgI4ARrAAQoIQXJyYXlTZXQSMAoRcGFyZW50X2NyZWF0ZWRfYXQYASABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpjcmVhdGVkX2F0GAIgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKwoFdmFsdWUYAyABKAsyHC55b3JraWUudjEuSlNPTkVsZW1lbnRTaW1wbGUSKgoLZXhlY3V0ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldEIGCgRib2R5IsUBChFKU09ORWxlbWVudFNpbXBsZRIpCgpjcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSJwoIbW92ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpyZW1vdmVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSIgoEdHlwZRgEIAEoDjIULnlvcmtpZS52MS5WYWx1ZVR5cGUSDQoFdmFsdWUYBSABKAwiggsKC0pTT05FbGVtZW50EjgKC2pzb25fb2JqZWN0GAEgASgLMiEueW9ya2llLnYxLkpTT05FbGVtZW50LkpTT05PYmplY3RIABI2Cgpqc29uX2FycmF5GAIgASgLMiAueW9ya2llLnYxLkpTT05FbGVtZW50LkpTT05BcnJheUgAEjUKCXByaW1pdGl2ZRgDIAEoCzIgLnlvcmtpZS52MS5KU09ORWxlbWVudC5QcmltaXRpdmVIABIrCgR0ZXh0GAUgASgLMhsueW9ya2llLnYxLkpTT05FbGVtZW50LlRleHRIABIxCgdjb3VudGVyGAYgASgLMh4ueW9ya2llLnYxLkpTT05FbGVtZW50LkNvdW50ZXJIABIrCgR0cmVlGAcgASgLMhsueW9ya2llLnYxLkpTT05FbGVtZW50LlRyZWVIABquAQoKSlNPTk9iamVjdBIhCgVub2RlcxgBIAMoCzISLnlvcmtpZS52MS5SSFROb2RlEikKCmNyZWF0ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBInCghtb3ZlZF9hdBgDIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EikKCnJlbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBqtAQoJSlNPTkFycmF5EiEKBW5vZGVzGAEgAygLMhIueW9ya2llLnYxLlJHQU5vZGUSKQoKY3JlYXRlZF9hdBgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EicKCG1vdmVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKQoKcmVtb3ZlZF9hdBgEIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Gr0BCglQcmltaXRpdmUSIgoEdHlwZRgBIAEoDjIULnlvcmtpZS52MS5WYWx1ZVR5cGUSDQoFdmFsdWUYAiABKAwSKQoKY3JlYXRlZF9hdBgDIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EicKCG1vdmVkX2F0GAQgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKQoKcmVtb3ZlZF9hdBgFIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0GqkBCgRUZXh0EiIKBW5vZGVzGAEgAygLMhMueW9ya2llLnYxLlRleHROb2RlEikKCmNyZWF0ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBInCghtb3ZlZF9hdBgDIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EikKCnJlbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBq7AQoHQ291bnRlchIiCgR0eXBlGAEgASgOMhQueW9ya2llLnYxLlZhbHVlVHlwZRINCgV2YWx1ZRgCIAEoDBIpCgpjcmVhdGVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSJwoIbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIpCgpyZW1vdmVkX2F0GAUgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQaqQEKBFRyZWUSIgoFbm9kZXMYASADKAsyEy55b3JraWUudjEuVHJlZU5vZGUSKQoKY3JlYXRlZF9hdBgCIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0EicKCG1vdmVkX2F0GAMgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSKQoKcmVtb3ZlZF9hdBgEIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0QgYKBGJvZHkiPwoHUkhUTm9kZRILCgNrZXkYASABKAkSJwoHZWxlbWVudBgCIAEoCzIWLnlvcmtpZS52MS5KU09ORWxlbWVudCJUCgdSR0FOb2RlEiAKBG5leHQYASABKAsyEi55b3JraWUudjEuUkdBTm9kZRInCgdlbGVtZW50GAIgASgLMhYueW9ya2llLnYxLkpTT05FbGVtZW50IlgKCE5vZGVBdHRyEg0KBXZhbHVlGAEgASgJEikKCnVwZGF0ZWRfYXQYAiABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBISCgppc19yZW1vdmVkGAMgASgIIpQCCghUZXh0Tm9kZRIhCgJpZBgBIAEoCzIVLnlvcmtpZS52MS5UZXh0Tm9kZUlEEg0KBXZhbHVlGAIgASgJEikKCnJlbW92ZWRfYXQYAyABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIqCgtpbnNfcHJldl9pZBgEIAEoCzIVLnlvcmtpZS52MS5UZXh0Tm9kZUlEEjcKCmF0dHJpYnV0ZXMYBSADKAsyIy55b3JraWUudjEuVGV4dE5vZGUuQXR0cmlidXRlc0VudHJ5GkYKD0F0dHJpYnV0ZXNFbnRyeRILCgNrZXkYASABKAkSIgoFdmFsdWUYAiABKAsyEy55b3JraWUudjEuTm9kZUF0dHI6AjgBIkcKClRleHROb2RlSUQSKQoKY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Eg4KBm9mZnNldBgCIAEoBSLdAgoIVHJlZU5vZGUSIQoCaWQYASABKAsyFS55b3JraWUudjEuVHJlZU5vZGVJRBIMCgR0eXBlGAIgASgJEg0KBXZhbHVlGAMgASgJEikKCnJlbW92ZWRfYXQYBCABKAsyFS55b3JraWUudjEuVGltZVRpY2tldBIqCgtpbnNfcHJldl9pZBgFIAEoCzIVLnlvcmtpZS52MS5UcmVlTm9kZUlEEioKC2luc19uZXh0X2lkGAYgASgLMhUueW9ya2llLnYxLlRyZWVOb2RlSUQSDQoFZGVwdGgYByABKAUSNwoKYXR0cmlidXRlcxgIIAMoCzIjLnlvcmtpZS52MS5UcmVlTm9kZS5BdHRyaWJ1dGVzRW50cnkaRgoPQXR0cmlidXRlc0VudHJ5EgsKA2tleRgBIAEoCRIiCgV2YWx1ZRgCIAEoCzITLnlvcmtpZS52MS5Ob2RlQXR0cjoCOAEiMQoJVHJlZU5vZGVzEiQKB2NvbnRlbnQYASADKAsyEy55b3JraWUudjEuVHJlZU5vZGUiRwoKVHJlZU5vZGVJRBIpCgpjcmVhdGVkX2F0GAEgASgLMhUueW9ya2llLnYxLlRpbWVUaWNrZXQSDgoGb2Zmc2V0GAIgASgFImMKB1RyZWVQb3MSKAoJcGFyZW50X2lkGAEgASgLMhUueW9ya2llLnYxLlRyZWVOb2RlSUQSLgoPbGVmdF9zaWJsaW5nX2lkGAIgASgLMhUueW9ya2llLnYxLlRyZWVOb2RlSUQiawoEVXNlchIKCgJpZBgBIAEoCRIVCg1hdXRoX3Byb3ZpZGVyGAIgASgJEhAKCHVzZXJuYW1lGAMgASgJEi4KCmNyZWF0ZWRfYXQYBCABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wIukGCgdQcm9qZWN0EgoKAmlkGAEgASgJEgwKBG5hbWUYAiABKAkSEgoKcHVibGljX2tleRgDIAEoCRISCgpzZWNyZXRfa2V5GAQgASgJEhgKEGF1dGhfd2ViaG9va191cmwYBSABKAkSHAoUYXV0aF93ZWJob29rX21ldGhvZHMYBiADKAkSIAoYYXV0aF93ZWJob29rX21heF9yZXRyaWVzGBEgASgEEiYKHmF1dGhfd2ViaG9va19taW5fd2FpdF9pbnRlcnZhbBgSIAEoCRImCh5hdXRoX3dlYmhvb2tfbWF4X3dhaXRfaW50ZXJ2YWwYEyABKAkSJAocYXV0aF93ZWJob29rX3JlcXVlc3RfdGltZW91dBgUIAEoCRIZChFldmVudF93ZWJob29rX3VybBgHIAEoCRIcChRldmVudF93ZWJob29rX2V2ZW50cxgIIAMoCRIhChlldmVudF93ZWJob29rX21heF9yZXRyaWVzGBUgASgEEicKH2V2ZW50X3dlYmhvb2tfbWluX3dhaXRfaW50ZXJ2YWwYFiABKAkSJwofZXZlbnRfd2ViaG9va19tYXhfd2FpdF9pbnRlcnZhbBgXIAEoCRIlCh1ldmVudF93ZWJob29rX3JlcXVlc3RfdGltZW91dBgYIAEoCRIjChtjbGllbnRfZGVhY3RpdmF0ZV90aHJlc2hvbGQYCSABKAkSGgoSc25hcHNob3RfdGhyZXNob2xkGBkgASgDEhkKEXNuYXBzaG90X2ludGVydmFsGBogASgDEiQKHG1heF9zdWJzY3JpYmVyc19wZXJfZG9jdW1lbnQYCiABKAUSJAocbWF4X2F0dGFjaG1lbnRzX3Blcl9kb2N1bWVudBgLIAEoBRIdChVtYXhfc2l6ZV9wZXJfZG9jdW1lbnQYDyABKAUSGAoQcmVtb3ZlX29uX2RldGFjaBgQIAEoCBIdChVhdXRvX3JldmlzaW9uX2VuYWJsZWQYGyABKAgSFwoPYWxsb3dlZF9vcmlnaW5zGA4gAygJEi4KCmNyZWF0ZWRfYXQYDCABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wEi4KCnVwZGF0ZWRfYXQYDSABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wIi8KC01ldHJpY1BvaW50EhEKCXRpbWVzdGFtcBgBIAEoAxINCgV2YWx1ZRgCIAEoBSKjDAoWVXBkYXRhYmxlUHJvamVjdEZpZWxkcxIqCgRuYW1lGAEgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlN0cmluZ1ZhbHVlEjYKEGF1dGhfd2ViaG9va191cmwYAiABKAsyHC5nb29nbGUucHJvdG9idWYuU3RyaW5nVmFsdWUSUgoUYXV0aF93ZWJob29rX21ldGhvZHMYAyABKAsyNC55b3JraWUudjEuVXBkYXRhYmxlUHJvamVjdEZpZWxkcy5BdXRoV2ViaG9va01ldGhvZHMSPgoYYXV0aF93ZWJob29rX21heF9yZXRyaWVzGAwgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlVJbnQ2NFZhbHVlEkQKHmF1dGhfd2ViaG9va19taW5fd2FpdF9pbnRlcnZhbBgNIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJECh5hdXRoX3dlYmhvb2tfbWF4X3dhaXRfaW50ZXJ2YWwYDiABKAsyHC5nb29nbGUucHJvdG9idWYuU3RyaW5nVmFsdWUSQgocYXV0aF93ZWJob29rX3JlcXVlc3RfdGltZW91dBgPIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRI3ChFldmVudF93ZWJob29rX3VybBgEIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJSChRldmVudF93ZWJob29rX2V2ZW50cxgFIAEoCzI0LnlvcmtpZS52MS5VcGRhdGFibGVQcm9qZWN0RmllbGRzLkV2ZW50V2ViaG9va0V2ZW50cxI/ChlldmVudF93ZWJob29rX21heF9yZXRyaWVzGBAgASgLMhwuZ29vZ2xlLnByb3RvYnVmLlVJbnQ2NFZhbHVlEkUKH2V2ZW50X3dlYmhvb2tfbWluX3dhaXRfaW50ZXJ2YWwYESABKAsyHC5nb29nbGUucHJvdG9idWYuU3RyaW5nVmFsdWUSRQofZXZlbnRfd2ViaG9va19tYXhfd2FpdF9pbnRlcnZhbBgSIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJDCh1ldmVudF93ZWJob29rX3JlcXVlc3RfdGltZW91dBgTIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRI3ChJzbmFwc2hvdF90aHJlc2hvbGQYFCABKAsyGy5nb29nbGUucHJvdG9idWYuSW50NjRWYWx1ZRI2ChFzbmFwc2hvdF9pbnRlcnZhbBgVIAEoCzIbLmdvb2dsZS5wcm90b2J1Zi5JbnQ2NFZhbHVlEkEKG2NsaWVudF9kZWFjdGl2YXRlX3RocmVzaG9sZBgGIAEoCzIcLmdvb2dsZS5wcm90b2J1Zi5TdHJpbmdWYWx1ZRJBChxtYXhfc3Vic2NyaWJlcnNfcGVyX2RvY3VtZW50GAcgASgLMhsuZ29vZ2xlLnByb3RvYnVmLkludDMyVmFsdWUSQQocbWF4X2F0dGFjaG1lbnRzX3Blcl9kb2N1bWVudBgIIAEoCzIbLmdvb2dsZS5wcm90b2J1Zi5JbnQzMlZhbHVlEjoKFW1heF9zaXplX3Blcl9kb2N1bWVudBgKIAEoCzIbLmdvb2dsZS5wcm90b2J1Zi5JbnQzMlZhbHVlEjQKEHJlbW92ZV9vbl9kZXRhY2gYCyABKAsyGi5nb29nbGUucHJvdG9idWYuQm9vbFZhbHVlEjkKFWF1dG9fcmV2aXNpb25fZW5hYmxlZBgWIAEoCzIaLmdvb2dsZS5wcm90b2J1Zi5Cb29sVmFsdWUSSQoPYWxsb3dlZF9vcmlnaW5zGAkgASgLMjAueW9ya2llLnYxLlVwZGF0YWJsZVByb2plY3RGaWVsZHMuQWxsb3dlZE9yaWdpbnMaJQoSQXV0aFdlYmhvb2tNZXRob2RzEg8KB21ldGhvZHMYASADKAkaJAoSRXZlbnRXZWJob29rRXZlbnRzEg4KBmV2ZW50cxgBIAMoCRohCg5BbGxvd2VkT3JpZ2lucxIPCgdvcmlnaW5zGAEgAygJIqcDCg9Eb2N1bWVudFN1bW1hcnkSCgoCaWQYASABKAkSCwoDa2V5GAIgASgJEgwKBHJvb3QYAyABKAkSGAoQYXR0YWNoZWRfY2xpZW50cxgHIAEoBRIpCg1kb2N1bWVudF9zaXplGAggASgLMhIueW9ya2llLnYxLkRvY1NpemUSEgoKc2NoZW1hX2tleRgJIAEoCRI8CglwcmVzZW5jZXMYCiADKAsyKS55b3JraWUudjEuRG9jdW1lbnRTdW1tYXJ5LlByZXNlbmNlc0VudHJ5Ei4KCmNyZWF0ZWRfYXQYBCABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wEi8KC2FjY2Vzc2VkX2F0GAUgASgLMhouZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcBIuCgp1cGRhdGVkX2F0GAYgASgLMhouZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcBpFCg5QcmVzZW5jZXNFbnRyeRILCgNrZXkYASABKAkSIgoFdmFsdWUYAiABKAsyEy55b3JraWUudjEuUHJlc2VuY2U6AjgBItoBCg5QcmVzZW5jZUNoYW5nZRIyCgR0eXBlGAEgASgOMiQueW9ya2llLnYxLlByZXNlbmNlQ2hhbmdlLkNoYW5nZVR5cGUSJQoIcHJlc2VuY2UYAiABKAsyEy55b3JraWUudjEuUHJlc2VuY2UibQoKQ2hhbmdlVHlwZRIbChdDSEFOR0VfVFlQRV9VTlNQRUNJRklFRBAAEhMKD0NIQU5HRV9UWVBFX1BVVBABEhYKEkNIQU5HRV9UWVBFX0RFTEVURRACEhUKEUNIQU5HRV9UWVBFX0NMRUFSEAMiZAoIUHJlc2VuY2USKwoEZGF0YRgBIAMoCzIdLnlvcmtpZS52MS5QcmVzZW5jZS5EYXRhRW50cnkaKwoJRGF0YUVudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAEiNAoOQ2hhbm5lbFN1bW1hcnkSCwoDa2V5GAEgASgJEhUKDXNlc3Npb25fY291bnQYAiABKAUiNAoKQ2hlY2twb2ludBISCgpzZXJ2ZXJfc2VxGAEgASgDEhIKCmNsaWVudF9zZXEYAiABKA0iYQoLVGV4dE5vZGVQb3MSKQoKY3JlYXRlZF9hdBgBIAEoCzIVLnlvcmtpZS52MS5UaW1lVGlja2V0Eg4KBm9mZnNldBgCIAEoBRIXCg9yZWxhdGl2ZV9vZmZzZXQYAyABKAUiQgoKVGltZVRpY2tldBIPCgdsYW1wb3J0GAEgASgDEhEKCWRlbGltaXRlchgCIAEoDRIQCghhY3Rvcl9pZBgDIAEoDCIuCgxEb2NFdmVudEJvZHkSDQoFdG9waWMYASABKAkSDwoHcGF5bG9hZBgCIAEoDCJrCghEb2NFdmVudBIlCgR0eXBlGAEgASgOMhcueW9ya2llLnYxLkRvY0V2ZW50VHlwZRIRCglwdWJsaXNoZXIYAiABKAkSJQoEYm9keRgDIAEoCzIXLnlvcmtpZS52MS5Eb2NFdmVudEJvZHkizgEKDENoYW5uZWxFdmVudBIqCgR0eXBlGAEgASgOMhwueW9ya2llLnYxLkNoYW5uZWxFdmVudC5UeXBlEhEKCXB1Ymxpc2hlchgCIAEoCRINCgVjb3VudBgDIAEoAxILCgNzZXEYBCABKAMSDQoFdG9waWMYBSABKAkSDwoHcGF5bG9hZBgGIAEoDCJDCgRUeXBlEhQKEFRZUEVfVU5TUEVDSUZJRUQQABIRCg1UWVBFX1BSRVNFTkNFEAESEgoOVFlQRV9CUk9BRENBU1QQAiImCghEYXRhU2l6ZRIMCgRkYXRhGAEgASgFEgwKBG1ldGEYAiABKAUiTQoHRG9jU2l6ZRIhCgRsaXZlGAEgASgLMhMueW9ya2llLnYxLkRhdGFTaXplEh8KAmdjGAIgASgLMhMueW9ya2llLnYxLkRhdGFTaXplIpEBCgZTY2hlbWESCgoCaWQYASABKAkSDAoEbmFtZRgCIAEoCRIPCgd2ZXJzaW9uGAMgASgFEgwKBGJvZHkYBCABKAkSHgoFcnVsZXMYBSADKAsyDy55b3JraWUudjEuUnVsZRIuCgpjcmVhdGVkX2F0GAYgASgLMhouZ29vZ2xlLnByb3RvYnVmLlRpbWVzdGFtcCIiCgRSdWxlEgwKBHBhdGgYASABKAkSDAoEdHlwZRgCIAEoCSKDAQoPUmV2aXNpb25TdW1tYXJ5EgoKAmlkGAEgASgJEg0KBWxhYmVsGAIgASgJEhMKC2Rlc2NyaXB0aW9uGAMgASgJEhAKCHNuYXBzaG90GAQgASgJEi4KCmNyZWF0ZWRfYXQYBSABKAsyGi5nb29nbGUucHJvdG9idWYuVGltZXN0YW1wKtQCCglWYWx1ZVR5cGUSEwoPVkFMVUVfVFlQRV9OVUxMEAASFgoSVkFMVUVfVFlQRV9CT09MRUFOEAESFgoSVkFMVUVfVFlQRV9JTlRFR0VSEAISEwoPVkFMVUVfVFlQRV9MT05HEAMSFQoRVkFMVUVfVFlQRV9ET1VCTEUQBBIVChFWQUxVRV9UWVBFX1NUUklORxAFEhQKEFZBTFVFX1RZUEVfQllURVMQBhITCg9WQUxVRV9UWVBFX0RBVEUQBxIaChZWQUxVRV9UWVBFX0pTT05fT0JKRUNUEAgSGQoVVkFMVUVfVFlQRV9KU09OX0FSUkFZEAkSEwoPVkFMVUVfVFlQRV9URVhUEAoSGgoWVkFMVUVfVFlQRV9JTlRFR0VSX0NOVBALEhcKE1ZBTFVFX1RZUEVfTE9OR19DTlQQDBITCg9WQUxVRV9UWVBFX1RSRUUQDSqmAQoMRG9jRXZlbnRUeXBlEiMKH0RPQ19FVkVOVF9UWVBFX0RPQ1VNRU5UX0NIQU5HRUQQABIjCh9ET0NfRVZFTlRfVFlQRV9ET0NVTUVOVF9XQVRDSEVEEAESJQohRE9DX0VWRU5UX1RZUEVfRE9DVU1FTlRfVU5XQVRDSEVEEAISJQohRE9DX0VWRU5UX1RZUEVfRE9DVU1FTlRfQlJPQURDQVNUEANCRQoRZGV2LnlvcmtpZS5hcGkudjFQAVouZ2l0aHViLmNvbS95b3JraWUtdGVhbS95b3JraWUvYXBpL3lvcmtpZS92MTt2MWIGcHJvdG8z",[Vm,Hm]),gy=xe(Be,0),py=xe(Be,1),my=xe(Be,2),Ac=xe(Be,3),Ec=xe(Be,4),Sc=xe(Be,5),by=xe(Be,5,0),yy=xe(Be,5,1),vy=xe(Be,5,2),Ay=xe(Be,5,3),Ey=xe(Be,5,4),Sy=xe(Be,5,5),Iy=xe(Be,5,6),Ny=xe(Be,5,7),wy=xe(Be,5,8),Ty=xe(Be,5,9),ti=xe(Be,6),$n=xe(Be,7),xy=xe(Be,7,0),Cy=xe(Be,7,1),Ry=xe(Be,7,2),_y=xe(Be,7,3),Ly=xe(Be,7,4),Oy=xe(Be,7,5),ky=xe(Be,8),Dy=xe(Be,9),Bd=xe(Be,10),By=xe(Be,11),Vy=xe(Be,12),Py=xe(Be,13),My=xe(Be,14),Uy=xe(Be,15),Wy=xe(Be,16),fh=xe(Be,22);var uo=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.PUT=1]="PUT",n[n.DELETE=2]="DELETE",n[n.CLEAR=3]="CLEAR",n))(uo||{});const Fy=xe(Be,23),Zy=xe(Be,25),Gy=xe(Be,26),$y=xe(Be,27);var Vd=(n=>(n[n.UNSPECIFIED=0]="UNSPECIFIED",n[n.PRESENCE=1]="PRESENCE",n[n.BROADCAST=2]="BROADCAST",n))(Vd||{}),De=(n=>(n[n.NULL=0]="NULL",n[n.BOOLEAN=1]="BOOLEAN",n[n.INTEGER=2]="INTEGER",n[n.LONG=3]="LONG",n[n.DOUBLE=4]="DOUBLE",n[n.STRING=5]="STRING",n[n.BYTES=6]="BYTES",n[n.DATE=7]="DATE",n[n.JSON_OBJECT=8]="JSON_OBJECT",n[n.JSON_ARRAY=9]="JSON_ARRAY",n[n.TEXT=10]="TEXT",n[n.INTEGER_CNT=11]="INTEGER_CNT",n[n.LONG_CNT=12]="LONG_CNT",n[n.TREE=13]="TREE",n))(De||{}),ga=(n=>(n[n.DOCUMENT_CHANGED=0]="DOCUMENT_CHANGED",n[n.DOCUMENT_WATCHED=1]="DOCUMENT_WATCHED",n[n.DOCUMENT_UNWATCHED=2]="DOCUMENT_UNWATCHED",n[n.DOCUMENT_BROADCAST=3]="DOCUMENT_BROADCAST",n))(ga||{});const Ky=zr("Ch5zcmMvYXBpL3lvcmtpZS92MS95b3JraWUucHJvdG8SCXlvcmtpZS52MSKeAQoVQWN0aXZhdGVDbGllbnRSZXF1ZXN0EhIKCmNsaWVudF9rZXkYASABKAkSQAoIbWV0YWRhdGEYAiADKAsyLi55b3JraWUudjEuQWN0aXZhdGVDbGllbnRSZXF1ZXN0Lk1ldGFkYXRhRW50cnkaLwoNTWV0YWRhdGFFbnRyeRILCgNrZXkYASABKAkSDQoFdmFsdWUYAiABKAk6AjgBIisKFkFjdGl2YXRlQ2xpZW50UmVzcG9uc2USEQoJY2xpZW50X2lkGAEgASgJIkEKF0RlYWN0aXZhdGVDbGllbnRSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtzeW5jaHJvbm91cxgCIAEoCCIaChhEZWFjdGl2YXRlQ2xpZW50UmVzcG9uc2UiagoVQXR0YWNoRG9jdW1lbnRSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRIqCgtjaGFuZ2VfcGFjaxgCIAEoCzIVLnlvcmtpZS52MS5DaGFuZ2VQYWNrEhIKCnNjaGVtYV9rZXkYAyABKAkinwEKFkF0dGFjaERvY3VtZW50UmVzcG9uc2USEwoLZG9jdW1lbnRfaWQYASABKAkSKgoLY2hhbmdlX3BhY2sYAiABKAsyFS55b3JraWUudjEuQ2hhbmdlUGFjaxIdChVtYXhfc2l6ZV9wZXJfZG9jdW1lbnQYAyABKAUSJQoMc2NoZW1hX3J1bGVzGAQgAygLMg8ueW9ya2llLnYxLlJ1bGUiiwEKFURldGFjaERvY3VtZW50UmVxdWVzdBIRCgljbGllbnRfaWQYASABKAkSEwoLZG9jdW1lbnRfaWQYAiABKAkSKgoLY2hhbmdlX3BhY2sYAyABKAsyFS55b3JraWUudjEuQ2hhbmdlUGFjaxIeChZyZW1vdmVfaWZfbm90X2F0dGFjaGVkGAQgASgIIkQKFkRldGFjaERvY3VtZW50UmVzcG9uc2USKgoLY2hhbmdlX3BhY2sYAiABKAsyFS55b3JraWUudjEuQ2hhbmdlUGFjayI+ChRXYXRjaERvY3VtZW50UmVxdWVzdBIRCgljbGllbnRfaWQYASABKAkSEwoLZG9jdW1lbnRfaWQYAiABKAkitgEKFVdhdGNoRG9jdW1lbnRSZXNwb25zZRJJCg5pbml0aWFsaXphdGlvbhgBIAEoCzIvLnlvcmtpZS52MS5XYXRjaERvY3VtZW50UmVzcG9uc2UuSW5pdGlhbGl6YXRpb25IABIkCgVldmVudBgCIAEoCzITLnlvcmtpZS52MS5Eb2NFdmVudEgAGiQKDkluaXRpYWxpemF0aW9uEhIKCmNsaWVudF9pZHMYASADKAlCBgoEYm9keSJrChVSZW1vdmVEb2N1bWVudFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2RvY3VtZW50X2lkGAIgASgJEioKC2NoYW5nZV9wYWNrGAMgASgLMhUueW9ya2llLnYxLkNoYW5nZVBhY2siRAoWUmVtb3ZlRG9jdW1lbnRSZXNwb25zZRIqCgtjaGFuZ2VfcGFjaxgBIAEoCzIVLnlvcmtpZS52MS5DaGFuZ2VQYWNrIn8KFlB1c2hQdWxsQ2hhbmdlc1JlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2RvY3VtZW50X2lkGAIgASgJEioKC2NoYW5nZV9wYWNrGAMgASgLMhUueW9ya2llLnYxLkNoYW5nZVBhY2sSEQoJcHVzaF9vbmx5GAQgASgIIkUKF1B1c2hQdWxsQ2hhbmdlc1Jlc3BvbnNlEioKC2NoYW5nZV9wYWNrGAEgASgLMhUueW9ya2llLnYxLkNoYW5nZVBhY2siYwoVQ3JlYXRlUmV2aXNpb25SZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtkb2N1bWVudF9pZBgCIAEoCRINCgVsYWJlbBgDIAEoCRITCgtkZXNjcmlwdGlvbhgEIAEoCSJGChZDcmVhdGVSZXZpc2lvblJlc3BvbnNlEiwKCHJldmlzaW9uGAEgASgLMhoueW9ya2llLnYxLlJldmlzaW9uU3VtbWFyeSJRChJHZXRSZXZpc2lvblJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2RvY3VtZW50X2lkGAIgASgJEhMKC3JldmlzaW9uX2lkGAMgASgJIkMKE0dldFJldmlzaW9uUmVzcG9uc2USLAoIcmV2aXNpb24YASABKAsyGi55b3JraWUudjEuUmV2aXNpb25TdW1tYXJ5InUKFExpc3RSZXZpc2lvbnNSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtkb2N1bWVudF9pZBgCIAEoCRIRCglwYWdlX3NpemUYAyABKAUSDgoGb2Zmc2V0GAQgASgFEhIKCmlzX2ZvcndhcmQYBSABKAgiRgoVTGlzdFJldmlzaW9uc1Jlc3BvbnNlEi0KCXJldmlzaW9ucxgBIAMoCzIaLnlvcmtpZS52MS5SZXZpc2lvblN1bW1hcnkiVQoWUmVzdG9yZVJldmlzaW9uUmVxdWVzdBIRCgljbGllbnRfaWQYASABKAkSEwoLZG9jdW1lbnRfaWQYAiABKAkSEwoLcmV2aXNpb25faWQYBCABKAkiGQoXUmVzdG9yZVJldmlzaW9uUmVzcG9uc2UiPgoUQXR0YWNoQ2hhbm5lbFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2NoYW5uZWxfa2V5GAIgASgJIjoKFUF0dGFjaENoYW5uZWxSZXNwb25zZRISCgpzZXNzaW9uX2lkGAEgASgJEg0KBWNvdW50GAIgASgDIlIKFERldGFjaENoYW5uZWxSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtjaGFubmVsX2tleRgCIAEoCRISCgpzZXNzaW9uX2lkGAMgASgJIiYKFURldGFjaENoYW5uZWxSZXNwb25zZRINCgVjb3VudBgBIAEoAyJTChVSZWZyZXNoQ2hhbm5lbFJlcXVlc3QSEQoJY2xpZW50X2lkGAEgASgJEhMKC2NoYW5uZWxfa2V5GAIgASgJEhIKCnNlc3Npb25faWQYAyABKAkiJwoWUmVmcmVzaENoYW5uZWxSZXNwb25zZRINCgVjb3VudBgBIAEoAyI9ChNXYXRjaENoYW5uZWxSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtjaGFubmVsX2tleRgCIAEoCSKDAQoUV2F0Y2hDaGFubmVsUmVzcG9uc2USOQoLaW5pdGlhbGl6ZWQYASABKAsyIi55b3JraWUudjEuV2F0Y2hDaGFubmVsSW5pdGlhbGl6ZWRIABIoCgVldmVudBgCIAEoCzIXLnlvcmtpZS52MS5DaGFubmVsRXZlbnRIAEIGCgRib2R5IjUKF1dhdGNoQ2hhbm5lbEluaXRpYWxpemVkEg0KBWNvdW50GAEgASgDEgsKA3NlcRgCIAEoAyJaChBCcm9hZGNhc3RSZXF1ZXN0EhEKCWNsaWVudF9pZBgBIAEoCRITCgtjaGFubmVsX2tleRgCIAEoCRINCgV0b3BpYxgDIAEoCRIPCgdwYXlsb2FkGAQgASgMIhMKEUJyb2FkY2FzdFJlc3BvbnNlMoULCg1Zb3JraWVTZXJ2aWNlElcKDkFjdGl2YXRlQ2xpZW50EiAueW9ya2llLnYxLkFjdGl2YXRlQ2xpZW50UmVxdWVzdBohLnlvcmtpZS52MS5BY3RpdmF0ZUNsaWVudFJlc3BvbnNlIgASXQoQRGVhY3RpdmF0ZUNsaWVudBIiLnlvcmtpZS52MS5EZWFjdGl2YXRlQ2xpZW50UmVxdWVzdBojLnlvcmtpZS52MS5EZWFjdGl2YXRlQ2xpZW50UmVzcG9uc2UiABJXCg5BdHRhY2hEb2N1bWVudBIgLnlvcmtpZS52MS5BdHRhY2hEb2N1bWVudFJlcXVlc3QaIS55b3JraWUudjEuQXR0YWNoRG9jdW1lbnRSZXNwb25zZSIAElcKDkRldGFjaERvY3VtZW50EiAueW9ya2llLnYxLkRldGFjaERvY3VtZW50UmVxdWVzdBohLnlvcmtpZS52MS5EZXRhY2hEb2N1bWVudFJlc3BvbnNlIgASVwoOUmVtb3ZlRG9jdW1lbnQSIC55b3JraWUudjEuUmVtb3ZlRG9jdW1lbnRSZXF1ZXN0GiEueW9ya2llLnYxLlJlbW92ZURvY3VtZW50UmVzcG9uc2UiABJaCg9QdXNoUHVsbENoYW5nZXMSIS55b3JraWUudjEuUHVzaFB1bGxDaGFuZ2VzUmVxdWVzdBoiLnlvcmtpZS52MS5QdXNoUHVsbENoYW5nZXNSZXNwb25zZSIAElYKDVdhdGNoRG9jdW1lbnQSHy55b3JraWUudjEuV2F0Y2hEb2N1bWVudFJlcXVlc3QaIC55b3JraWUudjEuV2F0Y2hEb2N1bWVudFJlc3BvbnNlIgAwARJXCg5DcmVhdGVSZXZpc2lvbhIgLnlvcmtpZS52MS5DcmVhdGVSZXZpc2lvblJlcXVlc3QaIS55b3JraWUudjEuQ3JlYXRlUmV2aXNpb25SZXNwb25zZSIAEk4KC0dldFJldmlzaW9uEh0ueW9ya2llLnYxLkdldFJldmlzaW9uUmVxdWVzdBoeLnlvcmtpZS52MS5HZXRSZXZpc2lvblJlc3BvbnNlIgASVAoNTGlzdFJldmlzaW9ucxIfLnlvcmtpZS52MS5MaXN0UmV2aXNpb25zUmVxdWVzdBogLnlvcmtpZS52MS5MaXN0UmV2aXNpb25zUmVzcG9uc2UiABJaCg9SZXN0b3JlUmV2aXNpb24SIS55b3JraWUudjEuUmVzdG9yZVJldmlzaW9uUmVxdWVzdBoiLnlvcmtpZS52MS5SZXN0b3JlUmV2aXNpb25SZXNwb25zZSIAElQKDUF0dGFjaENoYW5uZWwSHy55b3JraWUudjEuQXR0YWNoQ2hhbm5lbFJlcXVlc3QaIC55b3JraWUudjEuQXR0YWNoQ2hhbm5lbFJlc3BvbnNlIgASVAoNRGV0YWNoQ2hhbm5lbBIfLnlvcmtpZS52MS5EZXRhY2hDaGFubmVsUmVxdWVzdBogLnlvcmtpZS52MS5EZXRhY2hDaGFubmVsUmVzcG9uc2UiABJXCg5SZWZyZXNoQ2hhbm5lbBIgLnlvcmtpZS52MS5SZWZyZXNoQ2hhbm5lbFJlcXVlc3QaIS55b3JraWUudjEuUmVmcmVzaENoYW5uZWxSZXNwb25zZSIAElMKDFdhdGNoQ2hhbm5lbBIeLnlvcmtpZS52MS5XYXRjaENoYW5uZWxSZXF1ZXN0Gh8ueW9ya2llLnYxLldhdGNoQ2hhbm5lbFJlc3BvbnNlIgAwARJICglCcm9hZGNhc3QSGy55b3JraWUudjEuQnJvYWRjYXN0UmVxdWVzdBocLnlvcmtpZS52MS5Ccm9hZGNhc3RSZXNwb25zZSIAQkUKEWRldi55b3JraWUuYXBpLnYxUAFaLmdpdGh1Yi5jb20veW9ya2llLXRlYW0veW9ya2llL2FwaS95b3JraWUvdjE7djFiBnByb3RvMw",[Be]),jy=ny(Ky,0),Yy=zr("Ch5nb29nbGUvcnBjL2Vycm9yX2RldGFpbHMucHJvdG8SCmdvb2dsZS5ycGMikwEKCUVycm9ySW5mbxIOCgZyZWFzb24YASABKAkSDgoGZG9tYWluGAIgASgJEjUKCG1ldGFkYXRhGAMgAygLMiMuZ29vZ2xlLnJwYy5FcnJvckluZm8uTWV0YWRhdGFFbnRyeRovCg1NZXRhZGF0YUVudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAEiOwoJUmV0cnlJbmZvEi4KC3JldHJ5X2RlbGF5GAEgASgLMhkuZ29vZ2xlLnByb3RvYnVmLkR1cmF0aW9uIjIKCURlYnVnSW5mbxIVCg1zdGFja19lbnRyaWVzGAEgAygJEg4KBmRldGFpbBgCIAEoCSKPAwoMUXVvdGFGYWlsdXJlEjYKCnZpb2xhdGlvbnMYASADKAsyIi5nb29nbGUucnBjLlF1b3RhRmFpbHVyZS5WaW9sYXRpb24axgIKCVZpb2xhdGlvbhIPCgdzdWJqZWN0GAEgASgJEhMKC2Rlc2NyaXB0aW9uGAIgASgJEhMKC2FwaV9zZXJ2aWNlGAMgASgJEhQKDHF1b3RhX21ldHJpYxgEIAEoCRIQCghxdW90YV9pZBgFIAEoCRJRChBxdW90YV9kaW1lbnNpb25zGAYgAygLMjcuZ29vZ2xlLnJwYy5RdW90YUZhaWx1cmUuVmlvbGF0aW9uLlF1b3RhRGltZW5zaW9uc0VudHJ5EhMKC3F1b3RhX3ZhbHVlGAcgASgDEh8KEmZ1dHVyZV9xdW90YV92YWx1ZRgIIAEoA0gAiAEBGjYKFFF1b3RhRGltZW5zaW9uc0VudHJ5EgsKA2tleRgBIAEoCRINCgV2YWx1ZRgCIAEoCToCOAFCFQoTX2Z1dHVyZV9xdW90YV92YWx1ZSKVAQoTUHJlY29uZGl0aW9uRmFpbHVyZRI9Cgp2aW9sYXRpb25zGAEgAygLMikuZ29vZ2xlLnJwYy5QcmVjb25kaXRpb25GYWlsdXJlLlZpb2xhdGlvbho/CglWaW9sYXRpb24SDAoEdHlwZRgBIAEoCRIPCgdzdWJqZWN0GAIgASgJEhMKC2Rlc2NyaXB0aW9uGAMgASgJIswBCgpCYWRSZXF1ZXN0Ej8KEGZpZWxkX3Zpb2xhdGlvbnMYASADKAsyJS5nb29nbGUucnBjLkJhZFJlcXVlc3QuRmllbGRWaW9sYXRpb24afQoORmllbGRWaW9sYXRpb24SDQoFZmllbGQYASABKAkSEwoLZGVzY3JpcHRpb24YAiABKAkSDgoGcmVhc29uGAMgASgJEjcKEWxvY2FsaXplZF9tZXNzYWdlGAQgASgLMhwuZ29vZ2xlLnJwYy5Mb2NhbGl6ZWRNZXNzYWdlIjcKC1JlcXVlc3RJbmZvEhIKCnJlcXVlc3RfaWQYASABKAkSFAoMc2VydmluZ19kYXRhGAIgASgJImAKDFJlc291cmNlSW5mbxIVCg1yZXNvdXJjZV90eXBlGAEgASgJEhUKDXJlc291cmNlX25hbWUYAiABKAkSDQoFb3duZXIYAyABKAkSEwoLZGVzY3JpcHRpb24YBCABKAkiVgoESGVscBIkCgVsaW5rcxgBIAMoCzIVLmdvb2dsZS5ycGMuSGVscC5MaW5rGigKBExpbmsSEwoLZGVzY3JpcHRpb24YASABKAkSCwoDdXJsGAIgASgJIjMKEExvY2FsaXplZE1lc3NhZ2USDgoGbG9jYWxlGAEgASgJEg8KB21lc3NhZ2UYAiABKAlCbAoOY29tLmdvb2dsZS5ycGNCEUVycm9yRGV0YWlsc1Byb3RvUAFaP2dvb2dsZS5nb2xhbmcub3JnL2dlbnByb3RvL2dvb2dsZWFwaXMvcnBjL2VycmRldGFpbHM7ZXJyZGV0YWlsc6ICA1JQQ2IGcHJvdG8z",[Um]),qy=xe(Yy,0);var C=(n=>(n.Ok="ok",n.ErrClientNotActivated="ErrClientNotActivated",n.ErrClientNotFound="ErrClientNotFound",n.ErrUnimplemented="ErrUnimplemented",n.ErrInvalidType="ErrInvalidType",n.ErrDummy="ErrDummy",n.ErrNotAttached="ErrNotAttached",n.ErrNotDetached="ErrNotDetached",n.ErrDocumentRemoved="ErrDocumentRemoved",n.ErrDocumentSizeExceedsLimit="ErrDocumentSizeExceedsLimit",n.ErrDocumentSchemaValidationFailed="ErrDocumentSchemaValidationFailed",n.ErrInvalidObjectKey="ErrInvalidObjectKey",n.ErrInvalidArgument="ErrInvalidArgument",n.ErrNotInitialized="ErrNotInitialized",n.ErrNotReady="ErrNotReady",n.ErrRefused="ErrRefused",n.ErrContextNotProvided="ErrContextNotProvided",n.ErrPermissionDenied="ErrPermissionDenied",n.ErrUnauthenticated="ErrUnauthenticated",n.ErrTooManySubscribers="ErrTooManySubscribers",n.ErrTooManyAttachments="ErrTooManyAttachments",n))(C||{});class L extends Error{constructor(e,t){super(t),this.code=e,this.message=t,this.toString=()=>`[code=${this.code}]: ${this.message}`}name="YorkieError";stack}var _r=(n=>(n.Put="put",n.Clear="clear",n))(_r||{});const Ic="000000000000000000000000",Tr=24;class Fn{lamport;delimiter;actorID;constructor(e,t,r){this.lamport=e,this.delimiter=t,this.actorID=r}static of(e,t,r){return new Fn(e,t,r)}static fromStruct(e){return Fn.of(BigInt(e.lamport),e.delimiter,e.actorID)}toIDString(){return`${this.lamport.toString()}:${this.actorID}:${this.delimiter}`}toStruct(){return{lamport:this.getLamportAsString(),delimiter:this.getDelimiter(),actorID:this.getActorID()}}toTestString(){return`${this.lamport.toString()}:${this.actorID.slice(-2)}:${this.delimiter}`}setActor(e){return new Fn(this.lamport,this.delimiter,e)}getLamportAsString(){return this.lamport.toString()}getLamport(){return this.lamport}getDelimiter(){return this.delimiter}getActorID(){return this.actorID}after(e){return this.compare(e)>0}equals(e){return this.compare(e)===0}compare(e){if(this.lamport>e.lamport)return 1;if(e.lamport>this.lamport)return-1;const t=this.actorID.localeCompare(e.actorID);return t!==0?t:this.delimiter>e.delimiter?1:e.delimiter>this.delimiter?-1:0}}const xl=0n,Pd=0,Cl=9223372036854775807n,Ti=new Fn(xl,Pd,Ic);function wr(n){return n.replace(/["'\\\n\r\f\b\t\u2028\u2029]/g,function(e){switch(e){case'"':case"\\":return"\\"+e;case`
`:return"\\n";case"\r":return"\\r";case"\f":return"\\f";case"\b":return"\\b";case"	":return"\\t";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e}})}class wo{createdAt;movedAt;removedAt;constructor(e){this.createdAt=e}getCreatedAt(){return this.createdAt}getID(){return this.createdAt}getMovedAt(){return this.movedAt}getRemovedAt(){return this.removedAt}getPositionedAt(){return this.movedAt?this.movedAt:this.createdAt}setCreatedAt(e){this.createdAt=e}setMovedAt(e){return!this.movedAt||e&&e.after(this.movedAt)?(this.movedAt=e,!0):!1}setRemovedAt(e){this.removedAt=e}remove(e){return e&&e.after(this.createdAt)&&(!this.removedAt||e.after(this.removedAt))?(this.removedAt=e,!0):!1}isRemoved(){return!!this.removedAt}getMetaUsage(){let e=0;return this.getCreatedAt()&&(e+=Tr),this.getMovedAt()&&(e+=Tr),this.getRemovedAt()&&(e+=Tr),e}}class ps extends wo{constructor(e){super(e)}}class pa{strKey;value;constructor(e,t){this.strKey=e,this.value=t}static of(e,t){return new pa(e,t)}isRemoved(){return this.value.isRemoved()}getStrKey(){return this.strKey}getValue(){return this.value}remove(e){return this.value.remove(e)}}class xi{nodeMapByKey;nodeMapByCreatedAt;constructor(){this.nodeMapByKey=new Map,this.nodeMapByCreatedAt=new Map}static create(){return new xi}set(e,t,r){let s;const i=this.nodeMapByKey.get(e);i&&!i.isRemoved()&&i.remove(r)&&(s=i.getValue());const o=pa.of(e,t);return this.nodeMapByCreatedAt.set(t.getCreatedAt().toIDString(),o),(!i||r.after(i.getValue().getPositionedAt()))&&(this.nodeMapByKey.set(e,o),t.setMovedAt(r)),s}delete(e,t){if(!this.nodeMapByCreatedAt.has(e.toIDString()))throw new L(C.ErrInvalidArgument,`fail to find ${e.toIDString()}`);const r=this.nodeMapByCreatedAt.get(e.toIDString());return r.remove(t),r.getValue()}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return t.getStrKey()}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new L(C.ErrInvalidArgument,`fail to find ${e.getCreatedAt().toIDString()}`);const r=this.nodeMapByKey.get(t.getStrKey());t===r&&this.nodeMapByKey.delete(r.getStrKey()),this.nodeMapByCreatedAt.delete(t.getValue().getCreatedAt().toIDString())}deleteByKey(e,t){const r=this.nodeMapByKey.get(e);if(r&&r.remove(t))return r.getValue()}has(e){const t=this.nodeMapByKey.get(e);return t?!t.isRemoved():!1}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}get(e){const t=this.nodeMapByKey.get(e);if(!(!t||t.isRemoved()))return t}deepcopy(){const e=xi.create();for(const[,t]of this.nodeMapByCreatedAt)e.nodeMapByCreatedAt.set(t.getValue().getCreatedAt().toIDString(),pa.of(t.getStrKey(),t.getValue().deepcopy()));for(const[t,r]of this.nodeMapByKey)e.nodeMapByKey.set(t,e.nodeMapByCreatedAt.get(r.getValue().getCreatedAt().toIDString()));return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByCreatedAt)yield e}}class tn extends ps{memberNodes;constructor(e,t){super(e),this.memberNodes=t}static create(e,t){if(!t)return new tn(e,xi.create());const r=xi.create();for(const[s,i]of Object.entries(t))r.set(s,i.deepcopy(),i.getCreatedAt());return new tn(e,r)}subPathOf(e){return this.memberNodes.subPathOf(e)}purge(e){this.memberNodes.purge(e)}set(e,t,r){return this.memberNodes.set(e,t,r)}delete(e,t){return this.memberNodes.delete(e,t)}deleteByKey(e,t){return this.memberNodes.deleteByKey(e,t)}get(e){return this.memberNodes.get(e)?.getValue()}getByID(e){return this.memberNodes.getByID(e)?.getValue()}has(e){return this.memberNodes.has(e)}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const e=[];for(const[t,r]of this)e.push(`"${wr(t)}":${r.toJSON()}`);return`{${e.join(",")}}`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(const[t,r]of this){const{createdAt:s,value:i,type:o}=r.toJSForTest();e[t]={key:t,createdAt:s,value:i,type:o}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_OBJECT"}}getKeys(){const e=Array();for(const[t]of this)e.push(t);return e}toSortedJSON(){const e=new Set;for(const[r]of this)e.add(r);const t=[];for(const r of Array.from(e).sort()){const s=this.memberNodes.get(r)?.getValue();t.push(`"${wr(r)}":${s.toSortedJSON()}`)}return`{${t.join(",")}}`}getRHT(){return this.memberNodes}deepcopy(){const e=tn.create(this.getCreatedAt());return e.memberNodes=this.memberNodes.deepcopy(),e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}getDescendants(e){for(const t of this.memberNodes){const r=t.getValue();if(e(r,this))return;r instanceof ps&&r.getDescendants(e)}}*[Symbol.iterator](){for(const e of this.memberNodes)e.isRemoved()||(yield[e.getStrKey(),e.getValue()])}}var dt=(n=>(n.Local="local",n.Remote="remote",n.UndoRedo="undoredo",n))(dt||{});class ar{parentCreatedAt;executedAt;constructor(e,t){this.parentCreatedAt=e,this.executedAt=t}getParentCreatedAt(){return this.parentCreatedAt}getExecutedAt(){if(!this.executedAt)throw new L(C.ErrNotReady,"executedAt is not set yet");return this.executedAt}setActor(e){this.executedAt&&(this.executedAt=this.executedAt.setActor(e))}setExecutedAt(e){this.executedAt=e}}class Md{value;left;right;parent;weight;constructor(e){this.value=e,this.initWeight()}getNodeString(){return`${this.weight}${this.value}`}getValue(){return this.value}getLeftWeight(){return this.hasLeft()?this.left.getWeight():0}getRightWeight(){return this.hasRight()?this.right.getWeight():0}getWeight(){return this.weight}getLeft(){return this.left}getRight(){return this.right}getParent(){return this.parent}hasLeft(){return!!this.left}hasRight(){return!!this.right}hasParent(){return!!this.parent}setLeft(e){this.left=e}setRight(e){this.right=e}setParent(e){this.parent=e}unlink(){this.parent=void 0,this.right=void 0,this.left=void 0}hasLinks(){return this.hasParent()||this.hasLeft()||this.hasRight()}increaseWeight(e){this.weight+=e}initWeight(){this.weight=this.getLength()}}class ho{root;constructor(e){this.root=e}get length(){return this.root?this.root.getWeight():0}find(e){if(!this.root||e<0)return[void 0,0];let t=this.root;for(;;)if(t.hasLeft()&&e<=t.getLeftWeight())t=t.getLeft();else if(t.hasRight()&&t.getLeftWeight()+t.getLength()<e)e-=t.getLeftWeight()+t.getLength(),t=t.getRight();else{e-=t.getLeftWeight();break}if(e>t.getLength())throw new L(C.ErrInvalidArgument,`out of index range: pos: ${e} > node.length: ${t.getLength()}`);return this.splayNode(t),[t,e]}indexOf(e){return!e||e!==this.root&&!e.hasLinks()?-1:(this.splayNode(e),this.root.getLeftWeight())}getRoot(){return this.root}insert(e){return this.insertAfter(this.root,e)}insertAfter(e,t){return e?(this.splayNode(e),this.root=t,t.setRight(e.getRight()),e.hasRight()&&e.getRight().setParent(t),t.setLeft(e),e.setParent(t),e.setRight(),this.updateWeight(e),this.updateWeight(t),t):(this.root=t,t)}updateWeight(e){e.initWeight(),e.hasLeft()&&e.increaseWeight(e.getLeftWeight()),e.hasRight()&&e.increaseWeight(e.getRightWeight())}updateTreeWeight(e){for(;e;)this.updateWeight(e),e=e.getParent()}splayNode(e){if(e)for(;;)if(this.isLeftChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e),this.rotateLeft(e);else if(this.isLeftChild(e.getParent())&&this.isLeftChild(e))this.rotateRight(e.getParent()),this.rotateRight(e);else if(this.isRightChild(e.getParent())&&this.isRightChild(e))this.rotateLeft(e.getParent()),this.rotateLeft(e);else{this.isLeftChild(e)?this.rotateRight(e):this.isRightChild(e)&&this.rotateLeft(e),this.updateWeight(e);return}}delete(e){this.splayNode(e);const t=new ho(e.getLeft());t.root&&t.root.setParent();const r=new ho(e.getRight());if(r.root&&r.root.setParent(),t.root){const s=t.getRightmost();t.splayNode(s),t.root.setRight(r.root),r.root&&r.root.setParent(t.root),this.root=t.root}else this.root=r.root;e.unlink(),this.root&&this.updateWeight(this.root)}deleteRange(e,t){if(!t){this.splayNode(e),this.cutOffRight(e);return}this.splayNode(e),this.splayNode(t),t.getLeft()!=e&&this.rotateRight(e),this.cutOffRight(e)}cutOffRight(e){const t=[];this.traversePostorder(e.getRight(),t);for(const r of t)r.initWeight();this.updateTreeWeight(e)}toTestString(){const e=[];return this.traverseInorder(this.root,e),e.map(t=>`[${t.getWeight()},${t.getLength()}]${t.getValue()||""}`).join("")}checkWeight(){const e=[];this.traverseInorder(this.root,e);for(const t of e)if(t.getWeight()!=t.getLength()+t.getLeftWeight()+t.getRightWeight())return!1;return!0}getRightmost(){let e=this.root;for(;e.hasRight();)e=e.getRight();return e}traverseInorder(e,t){e&&(this.traverseInorder(e.getLeft(),t),t.push(e),this.traverseInorder(e.getRight(),t))}traversePostorder(e,t){e&&(this.traversePostorder(e.getLeft(),t),this.traversePostorder(e.getRight(),t),t.push(e))}rotateLeft(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setRight(e.getLeft()),t.hasRight()&&t.getRight().setParent(t),e.setLeft(t),e.getLeft().setParent(e),this.updateWeight(t),this.updateWeight(e)}rotateRight(e){const t=e.getParent();t.hasParent()?t===t.getParent().getLeft()?t.getParent().setLeft(e):t.getParent().setRight(e):this.root=e,e.setParent(t.getParent()),t.setLeft(e.getRight()),t.hasLeft()&&t.getLeft().setParent(t),e.setRight(t),e.getRight().setParent(e),this.updateWeight(t),this.updateWeight(e)}isLeftChild(e){return e&&e.hasParent()?e.getParent().getLeft()===e:!1}isRightChild(e){return e&&e.hasParent()?e.getParent().getRight()===e:!1}}var Mn=null;try{Mn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Me(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Me.prototype.__isLong__;Object.defineProperty(Me.prototype,"__isLong__",{value:!0});function rn(n){return(n&&n.__isLong__)===!0}function dh(n){var e=Math.clz32(n&-n);return n?31-e:e}Me.isLong=rn;var gh={},ph={};function Gs(n,e){var t,r,s;return e?(n>>>=0,(s=0<=n&&n<256)&&(r=ph[n],r)?r:(t=Ge(n,0,!0),s&&(ph[n]=t),t)):(n|=0,(s=-128<=n&&n<128)&&(r=gh[n],r)?r:(t=Ge(n,n<0?-1:0,!1),s&&(gh[n]=t),t))}Me.fromInt=Gs;function Un(n,e){if(isNaN(n))return e?Zr:nr;if(e){if(n<0)return Zr;if(n>=Ud)return Zd}else{if(n<=-bh)return bn;if(n+1>=bh)return Fd}return n<0?Un(-n,e).neg():Ge(n%Ci|0,n/Ci|0,e)}Me.fromNumber=Un;function Ge(n,e,t){return new Me(n,e,t)}Me.fromBits=Ge;var ma=Math.pow;function Nc(n,e,t){if(n.length===0)throw Error("empty string");if(typeof e=="number"?(t=e,e=!1):e=!!e,n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return e?Zr:nr;if(t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Nc(n.substring(1),e,t).neg();for(var s=Un(ma(t,8)),i=nr,o=0;o<n.length;o+=8){var a=Math.min(8,n.length-o),l=parseInt(n.substring(o,o+a),t);if(a<8){var c=Un(ma(t,a));i=i.mul(c).add(Un(l))}else i=i.mul(s),i=i.add(Un(l))}return i.unsigned=e,i}Me.fromString=Nc;function Kn(n,e){return typeof n=="number"?Un(n,e):typeof n=="string"?Nc(n,e):Ge(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Me.fromValue=Kn;var mh=65536,zy=1<<24,Ci=mh*mh,Ud=Ci*Ci,bh=Ud/2,yh=Gs(zy),nr=Gs(0);Me.ZERO=nr;var Zr=Gs(0,!0);Me.UZERO=Zr;var di=Gs(1);Me.ONE=di;var Wd=Gs(1,!0);Me.UONE=Wd;var Rl=Gs(-1);Me.NEG_ONE=Rl;var Fd=Ge(-1,2147483647,!1);Me.MAX_VALUE=Fd;var Zd=Ge(-1,-1,!0);Me.MAX_UNSIGNED_VALUE=Zd;var bn=Ge(0,-2147483648,!1);Me.MIN_VALUE=bn;var j=Me.prototype;j.toInt=function(){return this.unsigned?this.low>>>0:this.low};j.toNumber=function(){return this.unsigned?(this.high>>>0)*Ci+(this.low>>>0):this.high*Ci+(this.low>>>0)};j.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(bn)){var t=Un(e),r=this.div(t),s=r.mul(t).sub(this);return r.toString(e)+s.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Un(ma(e,6),this.unsigned),o=this,a="";;){var l=o.div(i),c=o.sub(l.mul(i)).toInt()>>>0,f=c.toString(e);if(o=l,o.isZero())return f+a;for(;f.length<6;)f="0"+f;a=""+f+a}};j.getHighBits=function(){return this.high};j.getHighBitsUnsigned=function(){return this.high>>>0};j.getLowBits=function(){return this.low};j.getLowBitsUnsigned=function(){return this.low>>>0};j.getNumBitsAbs=function(){if(this.isNegative())return this.eq(bn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};j.isSafeInteger=function(){var e=this.high>>21;return e?this.unsigned?!1:e===-1&&!(this.low===0&&this.high===-2097152):!0};j.isZero=function(){return this.high===0&&this.low===0};j.eqz=j.isZero;j.isNegative=function(){return!this.unsigned&&this.high<0};j.isPositive=function(){return this.unsigned||this.high>=0};j.isOdd=function(){return(this.low&1)===1};j.isEven=function(){return(this.low&1)===0};j.equals=function(e){return rn(e)||(e=Kn(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};j.eq=j.equals;j.notEquals=function(e){return!this.eq(e)};j.neq=j.notEquals;j.ne=j.notEquals;j.lessThan=function(e){return this.comp(e)<0};j.lt=j.lessThan;j.lessThanOrEqual=function(e){return this.comp(e)<=0};j.lte=j.lessThanOrEqual;j.le=j.lessThanOrEqual;j.greaterThan=function(e){return this.comp(e)>0};j.gt=j.greaterThan;j.greaterThanOrEqual=function(e){return this.comp(e)>=0};j.gte=j.greaterThanOrEqual;j.ge=j.greaterThanOrEqual;j.compare=function(e){if(rn(e)||(e=Kn(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};j.comp=j.compare;j.negate=function(){return!this.unsigned&&this.eq(bn)?bn:this.not().add(di)};j.neg=j.negate;j.add=function(e){rn(e)||(e=Kn(e));var t=this.high>>>16,r=this.high&65535,s=this.low>>>16,i=this.low&65535,o=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,g=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=s+l,g+=h>>>16,h&=65535,g+=r+a,f+=g>>>16,g&=65535,f+=t+o,f&=65535,Ge(h<<16|d,f<<16|g,this.unsigned)};j.subtract=function(e){return rn(e)||(e=Kn(e)),this.add(e.neg())};j.sub=j.subtract;j.multiply=function(e){if(this.isZero())return this;if(rn(e)||(e=Kn(e)),Mn){var t=Mn.mul(this.low,this.high,e.low,e.high);return Ge(t,Mn.get_high(),this.unsigned)}if(e.isZero())return this.unsigned?Zr:nr;if(this.eq(bn))return e.isOdd()?bn:nr;if(e.eq(bn))return this.isOdd()?bn:nr;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(yh)&&e.lt(yh))return Un(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,f=e.low&65535,g=0,h=0,d=0,m=0;return m+=o*f,d+=m>>>16,m&=65535,d+=i*f,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=s*f,g+=h>>>16,h&=65535,h+=i*c,g+=h>>>16,h&=65535,h+=o*l,g+=h>>>16,h&=65535,g+=r*f+s*c+i*l+o*a,g&=65535,Ge(d<<16|m,g<<16|h,this.unsigned)};j.mul=j.multiply;j.divide=function(e){if(rn(e)||(e=Kn(e)),e.isZero())throw Error("division by zero");if(Mn){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Mn.div_u:Mn.div_s)(this.low,this.high,e.low,e.high);return Ge(t,Mn.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Zr:nr;var r,s,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Zr;if(e.gt(this.shru(1)))return Wd;i=Zr}else{if(this.eq(bn)){if(e.eq(di)||e.eq(Rl))return bn;if(e.eq(bn))return di;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(nr)?e.isNegative()?di:Rl:(s=this.sub(e.mul(r)),i=r.add(s.div(e)),i)}else if(e.eq(bn))return this.unsigned?Zr:nr;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=nr}for(s=this;s.gte(e);){r=Math.max(1,Math.floor(s.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(r)/Math.LN2),l=a<=48?1:ma(2,a-48),c=Un(r),f=c.mul(e);f.isNegative()||f.gt(s);)r-=l,c=Un(r,this.unsigned),f=c.mul(e);c.isZero()&&(c=di),i=i.add(c),s=s.sub(f)}return i};j.div=j.divide;j.modulo=function(e){if(rn(e)||(e=Kn(e)),Mn){var t=(this.unsigned?Mn.rem_u:Mn.rem_s)(this.low,this.high,e.low,e.high);return Ge(t,Mn.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};j.mod=j.modulo;j.rem=j.modulo;j.not=function(){return Ge(~this.low,~this.high,this.unsigned)};j.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};j.clz=j.countLeadingZeros;j.countTrailingZeros=function(){return this.low?dh(this.low):dh(this.high)+32};j.ctz=j.countTrailingZeros;j.and=function(e){return rn(e)||(e=Kn(e)),Ge(this.low&e.low,this.high&e.high,this.unsigned)};j.or=function(e){return rn(e)||(e=Kn(e)),Ge(this.low|e.low,this.high|e.high,this.unsigned)};j.xor=function(e){return rn(e)||(e=Kn(e)),Ge(this.low^e.low,this.high^e.high,this.unsigned)};j.shiftLeft=function(e){return rn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ge(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Ge(0,this.low<<e-32,this.unsigned)};j.shl=j.shiftLeft;j.shiftRight=function(e){return rn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ge(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Ge(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};j.shr=j.shiftRight;j.shiftRightUnsigned=function(e){return rn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Ge(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):e===32?Ge(this.high,0,this.unsigned):Ge(this.high>>>e-32,0,this.unsigned)};j.shru=j.shiftRightUnsigned;j.shr_u=j.shiftRightUnsigned;j.rotateLeft=function(e){var t;return rn(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ge(this.high,this.low,this.unsigned):e<32?(t=32-e,Ge(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,Ge(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))};j.rotl=j.rotateLeft;j.rotateRight=function(e){var t;return rn(e)&&(e=e.toInt()),(e&=63)===0?this:e===32?Ge(this.high,this.low,this.unsigned):e<32?(t=32-e,Ge(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,Ge(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))};j.rotr=j.rotateRight;j.toSigned=function(){return this.unsigned?Ge(this.low,this.high,!1):this};j.toUnsigned=function(){return this.unsigned?this:Ge(this.low,this.high,!0)};j.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};j.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};j.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Me.fromBytes=function(e,t,r){return r?Me.fromBytesLE(e,t):Me.fromBytesBE(e,t)};Me.fromBytesLE=function(e,t){return new Me(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Me.fromBytesBE=function(e,t){return new Me(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};typeof BigInt=="function"&&(Me.fromBigInt=function(e,t){var r=Number(BigInt.asIntN(32,e)),s=Number(BigInt.asIntN(32,e>>BigInt(32)));return Ge(r,s,t)},Me.fromValue=function(e,t){return typeof e=="bigint"?Me.fromBigInt(e,t):Kn(e,t)},j.toBigInt=function(){var e=BigInt(this.low>>>0),t=BigInt(this.unsigned?this.high>>>0:this.high);return t<<BigInt(32)|e});var nt=(n=>(n[n.Null=0]="Null",n[n.Boolean=1]="Boolean",n[n.Integer=2]="Integer",n[n.Long=3]="Long",n[n.Double=4]="Double",n[n.String=5]="String",n[n.Bytes=6]="Bytes",n[n.Date=7]="Date",n))(nt||{});class bt extends wo{valueType;value;constructor(e,t){super(t),this.valueType=bt.getPrimitiveType(e),this.value=e===void 0?null:e}static of(e,t){return new bt(e,t)}static valueFromBytes(e,t){switch(e){case 0:return null;case 1:return!!t[0];case 2:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 4:{const r=new DataView(t.buffer);return t.forEach(function(s,i){r.setUint8(i,s)}),r.getFloat64(0,!0)}case 5:return new TextDecoder("utf-8").decode(t);case 3:return Me.fromBytesLE(Array.from(t));case 6:return t;case 7:return new Date(Me.fromBytesLE(Array.from(t),!0).toNumber());default:throw new L(C.ErrUnimplemented,`unimplemented type: ${e}`)}}getValueSize(){switch(this.valueType){case 0:return 8;case 1:return 4;case 2:return 4;case 3:return 8;case 4:return 8;case 5:return this.value.length*2;case 6:return this.value.length;case 7:return 8;default:throw new L(C.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}getDataSize(){return{data:this.getValueSize(),meta:this.getMetaUsage()}}toJSON(){return this.valueType===5?`"${wr(this.value)}"`:`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_PRIMITIVE"}}deepcopy(){const e=bt.of(this.value,this.getCreatedAt());return e.setMovedAt(this.getMovedAt()),e.setRemovedAt(this.getRemovedAt()),e}getType(){return this.valueType}static getPrimitiveType(e){switch(typeof e){case"undefined":return 0;case"boolean":return 1;case"number":return this.isInteger(e)?2:4;case"string":return 5;case"object":if(e===null)return 0;if(e instanceof Me)return 3;if(e instanceof Uint8Array)return 6;if(e instanceof Date)return 7}}static isSupport(e){return bt.getPrimitiveType(e)!==void 0}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===2||e===3||e===4}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:return new Uint8Array;case 1:return this.value?new Uint8Array([1]):new Uint8Array([0]);case 2:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 4:{const e=this.value,t=new Uint8Array(8);return new DataView(t.buffer).setFloat64(0,e,!0),t}case 5:return new TextEncoder().encode(this.value);case 3:{const t=this.value.toBytesLE();return Uint8Array.from(t)}case 6:return this.value;case 7:{const e=this.value,t=Me.fromNumber(e.getTime(),!0).toBytesLE();return Uint8Array.from(t)}default:throw new L(C.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}}class ba extends Md{prev;next;movedFrom;constructor(e){super(e),this.value=e}static createAfter(e,t){const r=new ba(t),s=e.next;return e.next=r,r.prev=e,r.next=s,s&&(s.prev=r),r}remove(e){return this.value.remove(e)}getCreatedAt(){return this.value.getCreatedAt()}getPositionedAt(){return this.value.getPositionedAt()}release(){this.prev&&(this.prev.next=this.next),this.next&&(this.next.prev=this.prev),this.prev=void 0,this.next=void 0}getLength(){return this.value.isRemoved()?0:1}getPrev(){return this.prev}getNext(){return this.next}getMovedFrom(){return this.movedFrom}setMovedFrom(e){this.movedFrom=e}getValue(){return this.value}isRemoved(){return this.value.isRemoved()}}class fo{dummyHead;last;nodeMapByIndex;nodeMapByCreatedAt;constructor(){const e=bt.of(0,Ti);e.setRemovedAt(Ti),this.dummyHead=new ba(e),this.last=this.dummyHead,this.nodeMapByIndex=new ho,this.nodeMapByCreatedAt=new Map,this.nodeMapByIndex.insert(this.dummyHead),this.nodeMapByCreatedAt.set(this.dummyHead.getCreatedAt().toIDString(),this.dummyHead)}static create(){return new fo}get length(){return this.nodeMapByIndex.length}findNextBeforeExecutedAt(e,t){let r=this.nodeMapByCreatedAt.get(e.toIDString());if(!r)throw new L(C.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);for(;r.getValue().getMovedAt()&&r.getValue().getMovedAt().after(t)&&r.getMovedFrom();)r=r.getMovedFrom();for(;r.getNext()&&r.getNext().getPositionedAt().after(t);)r=r.getNext();return r}release(e){this.last===e&&(this.last=e.getPrev()),e.release(),this.nodeMapByIndex.delete(e),this.nodeMapByCreatedAt.delete(e.getValue().getCreatedAt().toIDString())}insertAfter(e,t,r=t.getCreatedAt()){const s=this.findNextBeforeExecutedAt(e,r),i=ba.createAfter(s,t);return s===this.last&&(this.last=i),this.nodeMapByIndex.insertAfter(s,i),this.nodeMapByCreatedAt.set(i.getCreatedAt().toIDString(),i),i}moveAfter(e,t,r){let s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new L(C.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);let i=this.nodeMapByCreatedAt.get(t.toIDString());if(!i)throw new L(C.ErrInvalidArgument,`cant find the given node: ${t.toIDString()}`);if(s!==i&&r.after(i.getPositionedAt())){const o=i.getPrev();let a=i.getNext();for(this.release(i),i=this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r),i.setMovedFrom(o);a&&a.getPositionedAt().after(r);)s=i,i=a,a=i.getNext(),this.release(i),i=this.insertAfter(s.getCreatedAt(),i.getValue(),r),i.getValue().setMovedAt(r),i.setMovedFrom(o)}}insert(e){this.insertAfter(this.last.getCreatedAt(),e)}getByID(e){return this.nodeMapByCreatedAt.get(e.toIDString())}subPathOf(e){const t=this.nodeMapByCreatedAt.get(e.toIDString());if(t)return String(this.nodeMapByIndex.indexOf(t))}purge(e){const t=this.nodeMapByCreatedAt.get(e.getCreatedAt().toIDString());if(!t)throw new L(C.ErrInvalidArgument,`fail to find the given createdAt: ${e.getCreatedAt().toIDString()}`);this.release(t)}getByIndex(e){if(e>=this.length)return;const[t,r]=this.nodeMapByIndex.find(e);let s=t;if(e===0&&t===this.dummyHead||r>0)do s&&(s=s.getNext());while(s&&s.isRemoved());return s}getPrevCreatedAt(e){let t=this.nodeMapByCreatedAt.get(e.toIDString());do t=t.getPrev();while(this.dummyHead!==t&&t.isRemoved());return t.getValue().getCreatedAt()}delete(e,t){const r=this.nodeMapByCreatedAt.get(e.toIDString()),s=r.isRemoved();return r.remove(t)&&!s&&this.nodeMapByIndex.splayNode(r),r.getValue()}set(e,t,r){const s=this.nodeMapByCreatedAt.get(e.toIDString());if(!s)throw new L(C.ErrInvalidArgument,`cant find the given node: ${e.toIDString()}`);return this.insertAfter(s.getCreatedAt(),t,r),this.delete(e,r)}deleteByIndex(e,t){const r=this.getByIndex(e);if(r)return r.remove(t)&&this.nodeMapByIndex.splayNode(r),r.getValue()}getHead(){return this.dummyHead.getValue()}getLast(){return this.last.getValue()}getLastCreatedAt(){return this.last.getCreatedAt()}toTestString(){const e=[];for(const t of this){const r=`${t.getCreatedAt().toIDString()}:${t.getValue().toJSON()}`;t.isRemoved()?e.push(`{${r}}`):e.push(`[${r}]`)}return e.join("")}*[Symbol.iterator](){let e=this.dummyHead.getNext();for(;e;)yield e,e=e.getNext()}}class nn extends ps{elements;constructor(e,t){super(e),this.elements=t}static create(e,t){if(!t)return new nn(e,fo.create());const r=fo.create();for(const s of t)r.insertAfter(r.getLastCreatedAt(),s.deepcopy());return new nn(e,r)}subPathOf(e){return this.elements.subPathOf(e)}purge(e){this.elements.purge(e)}insertAfter(e,t,r){this.elements.insertAfter(e,t,r)}moveAfter(e,t,r){this.elements.moveAfter(e,t,r)}get(e){return this.elements.getByIndex(e)?.getValue()}getByID(e){return this.elements.getByID(e)?.getValue()}getHead(){return this.elements.getHead()}getLast(){return this.elements.getLast()}getPrevCreatedAt(e){return this.elements.getPrevCreatedAt(e)}delete(e,t){return this.elements.delete(e,t)}deleteByIndex(e,t){return this.elements.deleteByIndex(e,t)}set(e,t,r){return this.elements.set(e,t,r)}getLastCreatedAt(){return this.elements.getLastCreatedAt()}get length(){return this.elements.length}*[Symbol.iterator](){for(const e of this.elements)e.isRemoved()||(yield e.getValue())}toTestString(){return this.elements.toTestString()}getDescendants(e){for(const t of this.elements){const r=t.getValue();if(e(r,this))return;r instanceof ps&&r.getDescendants(e)}}getDataSize(){return{data:0,meta:this.getMetaUsage()}}toJSON(){const e=[];for(const t of this)e.push(t.toJSON());return`[${e.join(",")}]`}toJS(){return JSON.parse(this.toJSON())}toJSForTest(){const e={};for(let t=0;t<this.length;t++){const{createdAt:r,value:s,type:i}=this.get(t).toJSForTest();e[t]={key:String(t),createdAt:r,value:s,type:i}}return{createdAt:this.getCreatedAt().toTestString(),value:e,type:"YORKIE_ARRAY"}}toSortedJSON(){return this.toJSON()}getElements(){return this.elements}deepcopy(){const e=nn.create(this.getCreatedAt());for(const t of this.elements)e.elements.insertAfter(e.getLastCreatedAt(),t.getValue().deepcopy());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}}class Is extends ar{prevCreatedAt;value;constructor(e,t,r,s){super(e,s),this.prevCreatedAt=t,this.value=r}static create(e,t,r,s){return new Is(e,t,r,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof nn))throw new L(C.ErrInvalidArgument,"fail to execute, only array can execute add");const r=t,s=this.value.deepcopy();return r.insertAfter(this.prevCreatedAt,s,this.getExecutedAt()),e.registerElement(s,r),{opInfos:[{type:"add",path:e.createPath(this.getParentCreatedAt()),index:Number(r.subPathOf(this.getEffectedCreatedAt()))}],reverseOp:this.toReverseOperation()}}toReverseOperation(){return Lr.create(this.getParentCreatedAt(),this.value.getCreatedAt())}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ADD.${this.value.toJSON()}`}getPrevCreatedAt(){return this.prevCreatedAt}getValue(){return this.value}setPrevCreatedAt(e){this.prevCreatedAt=e}}class Lr extends ar{createdAt;constructor(e,t,r){super(e,r),this.createdAt=t}static create(e,t,r){return new Lr(e,t,r)}execute(e,t){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof ps))throw new L(C.ErrInvalidArgument,`only object and array can execute remove: ${r}`);if(t===dt.UndoRedo){let l=r.getByID(this.createdAt);for(;l;){if(l.getRemovedAt())return;l=e.findElementPairByCreatedAt(l.getCreatedAt())?.parent}}const s=r.subPathOf(this.createdAt),i=this.toReverseOperation(r),o=r.delete(this.createdAt,this.getExecutedAt());return e.registerRemovedElement(o),{opInfos:r instanceof nn?[{type:"remove",path:e.createPath(this.getParentCreatedAt()),index:Number(s)}]:[{type:"remove",path:e.createPath(this.getParentCreatedAt()),key:s}],reverseOp:i}}toReverseOperation(e){if(e instanceof nn){const t=e.getByID(this.createdAt);if(t!==void 0){const r=e.getPrevCreatedAt(this.createdAt);return Is.create(this.getParentCreatedAt(),r,t.deepcopy())}}if(e instanceof tn){const t=e.subPathOf(this.createdAt);if(t!==void 0){const r=e.get(t);if(r!==void 0)return Ms.create(t,r.deepcopy(),this.getParentCreatedAt())}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.REMOVE.${this.createdAt.toTestString()}`}getCreatedAt(){return this.createdAt}setCreatedAt(e){this.createdAt=e}}class Ms extends ar{key;value;constructor(e,t,r,s){super(r,s),this.key=e,this.value=t}static create(e,t,r,s){return new Ms(e,t,r,s)}execute(e,t){const r=e.findByCreatedAt(this.getParentCreatedAt());if(!r)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(r instanceof tn))throw new L(C.ErrInvalidArgument,"fail to execute, only object can execute set");if(t===dt.UndoRedo){let l=r;for(;l;){if(l.getRemovedAt())return;l=e.findElementPairByCreatedAt(l.getCreatedAt())?.parent}}const s=r.get(this.key),i=this.toReverseOperation(s),o=this.value.deepcopy(),a=r.set(this.key,o,this.getExecutedAt());return t===dt.UndoRedo&&e.findByCreatedAt(o.getCreatedAt())&&e.deregisterElement(o),e.registerElement(o,r),a&&e.registerRemovedElement(a),{opInfos:[{type:"set",path:e.createPath(this.getParentCreatedAt()),key:this.key}],reverseOp:i}}toReverseOperation(e){let t=Lr.create(this.getParentCreatedAt(),this.value.getCreatedAt());return e!==void 0&&!e.isRemoved()&&(t=Ms.create(this.key,e.deepcopy(),this.getParentCreatedAt())),t}getEffectedCreatedAt(){return this.value.getCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.SET.${this.key}=${this.value.toSortedJSON()}`}getKey(){return this.key}getValue(){return this.value}}class rr extends ar{prevCreatedAt;createdAt;constructor(e,t,r,s){super(e,s),this.prevCreatedAt=t,this.createdAt=r}static create(e,t,r,s){return new rr(e,t,r,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof nn))throw new L(C.ErrInvalidArgument,"fail to execute, only array can execute move");const r=t,s=this.toReverseOperation(r),i=Number(r.subPathOf(this.createdAt));r.moveAfter(this.prevCreatedAt,this.createdAt,this.getExecutedAt());const o=Number(r.subPathOf(this.createdAt));return{opInfos:[{type:"move",path:e.createPath(this.getParentCreatedAt()),index:o,previousIndex:i}],reverseOp:s}}toReverseOperation(e){const t=e.getPrevCreatedAt(this.createdAt);return rr.create(this.getParentCreatedAt(),t,this.createdAt)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.MOVE`}getPrevCreatedAt(){return this.prevCreatedAt}getCreatedAt(){return this.createdAt}setPrevCreatedAt(e){this.prevCreatedAt=e}setCreatedAt(e){this.createdAt=e}}const Xy=(n,e)=>n===e?0:n<e?-1:1;class Jy{key;value;left;right;isRed;constructor(e,t,r){this.key=e,this.value=t,this.isRed=r}}class Hy{stack;constructor(e){this.stack=[],this.traverseInorder(e)}traverseInorder(e){e&&(this.traverseInorder(e.left),this.stack.push({key:e.key,value:e.value}),this.traverseInorder(e.right))}}class Gd{root;comparator;counter;constructor(e){this.comparator=typeof e<"u"?e:Xy,this.counter=0}put(e,t){return this.root=this.putInternal(e,t,this.root),this.root.isRed=!1,t}get(e){const t=this.getInternal(e,this.root);return t?t.value:void 0}remove(e){!this.isRed(this.root.left)&&!this.isRed(this.root.right)&&(this.root.isRed=!0),this.root=this.removeInternal(this.root,e),this.root&&(this.root.isRed=!1)}getIterator(){return new Hy(this.root)}values(){const e=[];for(const t of this.getIterator().stack)e.push(t.value);return e}floorEntry(e){let t=this.root,r;for(;t;){const s=this.comparator(e,t.key);if(s===0)return t;s<0?t=t.left:(r=t,t=t.right)}return r}lastEntry(){if(!this.root)return this.root;let e=this.root;for(;e.right;)e=e.right;return e}size(){return this.counter}isEmpty(){return this.counter===0}getInternal(e,t){for(;t;){const r=this.comparator(e,t.key);if(r===0)return t;r<0?t=t.left:r>0&&(t=t.right)}}putInternal(e,t,r){if(!r)return this.counter+=1,new Jy(e,t,!0);const s=this.comparator(e,r.key);return s<0?r.left=this.putInternal(e,t,r.left):s>0?r.right=this.putInternal(e,t,r.right):r.value=t,this.isRed(r.right)&&!this.isRed(r.left)&&(r=this.rotateLeft(r)),this.isRed(r.left)&&this.isRed(r.left.left)&&(r=this.rotateRight(r)),this.isRed(r.left)&&this.isRed(r.right)&&this.flipColors(r),r}removeInternal(e,t){if(this.comparator(t,e.key)<0)!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeInternal(e.left,t);else{if(this.isRed(e.left)&&(e=this.rotateRight(e)),this.comparator(t,e.key)===0&&!e.right){this.counter-=1;return}if(!this.isRed(e.right)&&!this.isRed(e.right.left)&&(e=this.moveRedRight(e)),this.comparator(t,e.key)===0){this.counter-=1;const r=this.min(e.right);e.value=r.value,e.key=r.key,e.right=this.removeMin(e.right)}else e.right=this.removeInternal(e.right,t)}return this.fixUp(e)}min(e){return e.left?this.min(e.left):e}removeMin(e){if(e.left)return!this.isRed(e.left)&&!this.isRed(e.left.left)&&(e=this.moveRedLeft(e)),e.left=this.removeMin(e.left),this.fixUp(e)}fixUp(e){return this.isRed(e.right)&&(e=this.rotateLeft(e)),this.isRed(e.left)&&this.isRed(e.left.left)&&(e=this.rotateRight(e)),this.isRed(e.left)&&this.isRed(e.right)&&this.flipColors(e),e}moveRedLeft(e){return this.flipColors(e),this.isRed(e.right.left)&&(e.right=this.rotateRight(e.right),e=this.rotateLeft(e),this.flipColors(e)),e}moveRedRight(e){return this.flipColors(e),this.isRed(e.left.left)&&(e=this.rotateRight(e),this.flipColors(e)),e}isRed(e){return e&&e.isRed}rotateLeft(e){const t=e.right;return e.right=t.left,t.left=e,t.isRed=t.left.isRed,t.left.isRed=!0,t}rotateRight(e){const t=e.left;return e.left=t.right,t.right=e,t.isRed=t.right.isRed,t.right.isRed=!0,t}flipColors(e){e.isRed=!e.isRed,e.left.isRed=!e.left.isRed,e.right.isRed=!e.right.isRed}}function Qy(n){return n?vh(n.live)+vh(n.gc):0}function vh(n){return n.data+n.meta}function Kt(n,...e){for(const t of e)n.data+=t.data,n.meta+=t.meta}function Vs(n,e){n.data-=e.data,n.meta-=e.meta}class xr{createdAt;offset;constructor(e,t){this.createdAt=e,this.offset=t}static of(e,t){return new xr(e,t)}static fromStruct(e){return xr.of(Fn.fromStruct(e.createdAt),e.offset)}getCreatedAt(){return this.createdAt}getOffset(){return this.offset}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}hasSameCreatedAt(e){return this.createdAt.compare(e.createdAt)===0}split(e){return new xr(this.createdAt,this.offset+e)}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toTestString(){return`${this.createdAt.toTestString()}:${this.offset}`}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}}const e0=xr.of(Ti,0);class $t{id;relativeOffset;constructor(e,t){this.id=e,this.relativeOffset=t}static of(e,t){return new $t(e,t)}static fromStruct(e){const t=xr.fromStruct(e.id);return $t.of(t,e.relativeOffset)}getID(){return this.id}getRelativeOffset(){return this.relativeOffset}getAbsoluteID(){return xr.of(this.id.getCreatedAt(),this.id.getOffset()+this.relativeOffset)}toTestString(){return`${this.id.toTestString()}:${this.relativeOffset}`}toStruct(){return{id:this.id.toStruct(),relativeOffset:this.relativeOffset}}equals(e){return this.id.equals(e.id)?this.relativeOffset===e.relativeOffset:!1}}class ms extends Md{id;removedAt;prev;next;insPrev;insNext;constructor(e,t,r){super(t),this.id=e,this.removedAt=r}static create(e,t){return new ms(e,t)}static createComparator(){return(e,t)=>{const r=e.getCreatedAt().compare(t.getCreatedAt());return r!==0?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getID(){return this.id}getCreatedAt(){return this.id.getCreatedAt()}getLength(){return this.removedAt?0:this.getContentLength()}getContentLength(){return this.value&&this.value.length||0}getPrev(){return this.prev}getNext(){return this.next}getInsPrev(){return this.insPrev}getInsNext(){return this.insNext}getInsPrevID(){return this.insPrev.getID()}setPrev(e){this.prev=e,e&&(e.next=this)}setNext(e){this.next=e,e&&(e.prev=this)}setInsPrev(e){this.insPrev=e,e&&(e.insNext=this)}setInsNext(e){this.insNext=e,e&&(e.insPrev=this)}hasNext(){return!!this.next}hasInsPrev(){return!!this.insPrev}isRemoved(){return!!this.removedAt}getRemovedAt(){return this.removedAt}split(e){return new ms(this.id.split(e),this.splitValue(e),this.removedAt)}canRemove(e,t,r){return t?!!(!this.removedAt||!r&&e?.after(this.removedAt)):!1}canStyle(e,t){return this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}setRemovedAt(e){this.removedAt=e}remove(e){if(!this.removedAt){this.removedAt=e;return}e.after(this.removedAt)&&(this.removedAt=e)}createPosRange(){return[$t.of(this.id,0),$t.of(this.id,this.getLength())]}getDataSize(){const e=this.value.getDataSize();return this.id&&(e.meta+=Tr),this.removedAt&&(e.meta+=Tr),e}deepcopy(){return new ms(this.id,this.value,this.removedAt)}toTestString(){return`${this.id.toTestString()} ${this.value?this.value:""}`}splitValue(e){const t=this.value;return this.value=t.substring(0,e),t.substring(e,t.length)}toIDString(){return this.id.toIDString()}}class Ri{head;treeByIndex;treeByID;constructor(){this.head=ms.create(e0),this.treeByIndex=new ho,this.treeByID=new Gd(ms.createComparator()),this.treeByIndex.insert(this.head),this.treeByID.put(this.head.getID(),this.head)}static create(){return new Ri}edit(e,t,r,s){const i={data:0,meta:0},[o,a,l]=this.findNodeWithSplit(e[1],t),[c,f,g]=this.findNodeWithSplit(e[0],t);Kt(i,a,f);const h=this.findBetween(g,l),[d,m]=this.deleteNodes(h,t,s),v=l?l.getID():o.getID();let I=$t.of(v,0);if(r){const p=this.posToIndex(c.createPosRange()[1],!0),A=this.insertAfter(c,ms.create(xr.of(t,0),r));Kt(i,A.getDataSize()),d.length&&d[d.length-1].from===p?d[d.length-1].value=r:d.push({actor:t.getActorID(),from:p,to:p,value:r}),I=$t.of(A.getID(),A.getContentLength())}const E=[],y=[];for(const[,p]of m)E.push({parent:this,child:p}),y.push(p.getValue());return[I,E,i,d,y]}indexToPos(e){const[t,r]=this.treeByIndex.find(e),s=t;return $t.of(s.getID(),r)}findIndexesFromRange(e){const[t,r]=e;return[this.posToIndex(t,!1),this.posToIndex(r,!0)]}posToIndex(e,t){const r=e.getAbsoluteID(),s=t?this.findFloorNodePreferToLeft(r):this.findFloorNode(r);if(!s)throw new L(C.ErrInvalidArgument,`the node of the given id should be found: ${r.toTestString()}`);const i=this.treeByIndex.indexOf(s),o=s.isRemoved()?0:r.getOffset()-s.getID().getOffset();return i+o}findNode(e){return this.findFloorNode(e)}get length(){return this.treeByIndex.length}getTreeByIndex(){return this.treeByIndex}getTreeByID(){return this.treeByID}toString(){const e=[];for(const t of this)t.isRemoved()||e.push(t.getValue());return e.join("")}*[Symbol.iterator](){let e=this.head.getNext();for(;e;)yield e,e=e.getNext()}getHead(){return this.head}deepcopy(){const e=new Ri;let t=this.head.getNext(),r=e.head,s;for(;t;){if(s=e.insertAfter(r,t.deepcopy()),t.hasInsPrev()){const i=e.findNode(t.getInsPrevID());s.setInsPrev(i)}r=s,t=t.getNext()}return e}normalizePos(e){const t=this.findFloorNode(e.getID());if(!t)throw new L(C.ErrInvalidArgument,`the node of the given id should be found: ${e.getID().toTestString()}`);let r=e.getRelativeOffset(),s=t,i=t.getPrev();for(;i;)r+=i.getLength(),s=i,i=i.getPrev();return $t.of(s.getID(),r)}refinePos(e){let t=this.findFloorNode(e.getID());if(!t)throw new L(C.ErrInvalidArgument,`the node of the given id should be found: ${e.getID().toTestString()}`);let r=e.getRelativeOffset(),s=t.getContentLength();for(;r>s;){r-=s;const i=t.getNext();if(!i)return $t.of(t.getID(),s);t=i,s=t.getLength()}return $t.of(t.getID(),r)}toTestString(){const e=[];let t=this.head;for(;t;)t.isRemoved()?e.push(`{${t.toTestString()}}`):e.push(`[${t.toTestString()}]`),t=t.getNext();return e.join("")}insertAfter(e,t){const r=e.getNext();return t.setPrev(e),r&&r.setPrev(t),this.treeByID.put(t.getID(),t),this.treeByIndex.insertAfter(e,t),t}findNodeWithSplit(e,t){const r=e.getAbsoluteID();let s=this.findFloorNodePreferToLeft(r);const i=r.getOffset()-s.getID().getOffset(),[,o]=this.splitNode(s,i);for(;s.hasNext()&&s.getNext().getCreatedAt().after(t);)s=s.getNext();return[s,o,s.getNext()]}findFloorNodePreferToLeft(e){let t=this.findFloorNode(e);if(!t)throw new L(C.ErrInvalidArgument,`the node of the given id should be found: ${e.toTestString()}`);if(e.getOffset()>0&&t.getID().getOffset()==e.getOffset()){if(!t.hasInsPrev())return t;t=t.getInsPrev()}return t}findFloorNode(e){const t=this.treeByID.floorEntry(e);if(t&&!(!t.key.equals(e)&&!t.key.hasSameCreatedAt(e)))return t.value}findBetween(e,t){const r=[];let s=e;for(;s&&s!==t;)r.push(s),s=s.getNext();return r}splitNode(e,t){const r={data:0,meta:0};if(t>e.getContentLength())throw new L(C.ErrInvalidArgument,"offset should be less than or equal to length");if(t===0)return[e,r];if(t===e.getContentLength())return[e.getNext(),r];const s=e.getDataSize(),i=e.split(t);this.treeByIndex.updateWeight(i),this.insertAfter(e,i);const o=e.getInsNext();return o&&o.setInsPrev(i),i.setInsPrev(e),Kt(r,e.getDataSize(),i.getDataSize()),Vs(r,s),[i,r]}deleteNodes(e,t,r){if(!e.length)return[[],new Map];const s=r===void 0||r.size()===0,i=[],o=[],[a,l]=this.findEdgesOfCandidates(e);o.push(a);for(const g of e){let h=!1;if(s)h=!0;else{const m=r?.get(g.getCreatedAt().getActorID());m&&m>=g.getCreatedAt().getLamport()&&(h=!0)}let d=!1;if(g.getRemovedAt()){const m=r?.get(g.getRemovedAt().getActorID());(s||m&&m>=g.getRemovedAt().getLamport())&&(d=!0)}g.canRemove(t,h,d)?i.push(g):o.push(g)}o.push(l);const c=this.makeChanges(o,t),f=new Map;for(const g of i)f.set(g.getID().toIDString(),g),g.remove(t);return this.deleteIndexNodes(o),[c,f]}findEdgesOfCandidates(e){return[e[0].getPrev(),e[e.length-1].getNext()]}makeChanges(e,t){const r=[];let s,i;for(let o=0;o<e.length-1;o++){const a=e[o],l=e[o+1];a.getNext()!=l&&([s]=this.findIndexesFromRange(a.getNext().createPosRange()),l?[,i]=this.findIndexesFromRange(l.getPrev().createPosRange()):i=this.treeByIndex.length,s<i&&r.push({actor:t.getActorID(),from:s,to:i}))}return r.reverse()}deleteIndexNodes(e){for(let t=0;t<e.length-1;t++){const r=e[t],s=e[t+1];r.getNext()!=s&&this.treeByIndex.deleteRange(r,s)}}purge(e){this.treeByIndex.delete(e),this.treeByID.remove(e.getID());const t=e.getPrev(),r=e.getNext(),s=e.getInsPrev(),i=e.getInsNext();t&&t.setNext(r),r&&r.setPrev(t),e.setPrev(void 0),e.setNext(void 0),s&&s.setInsNext(i),i&&i.setInsPrev(s),e.setInsPrev(void 0),e.setInsNext(void 0)}}class fs{key;value;updatedAt;_isRemoved;constructor(e,t,r,s){this.key=e,this.value=t,this.updatedAt=r,this._isRemoved=s}static of(e,t,r,s){return new fs(e,t,r,s)}getKey(){return this.key}getValue(){return this.value}getUpdatedAt(){return this.updatedAt}isRemoved(){return this._isRemoved}toIDString(){return`${this.updatedAt.toIDString()}:${this.key}`}getRemovedAt(){if(this._isRemoved)return this.updatedAt}getDataSize(){return{data:(this.key.length+this.value.length)*2,meta:Tr}}}class Kr{nodeMapByKey;numberOfRemovedElement;constructor(){this.nodeMapByKey=new Map,this.numberOfRemovedElement=0}static create(){return new Kr}getNodeMapByKey(){return this.nodeMapByKey}set(e,t,r){const s=this.nodeMapByKey.get(e);if(s&&s.isRemoved()&&r.after(s.getUpdatedAt())&&(this.numberOfRemovedElement-=1),s===void 0||r.after(s.getUpdatedAt())){const i=fs.of(e,t,r,!1);return this.nodeMapByKey.set(e,i),s!==void 0&&s.isRemoved()?[s,i]:[void 0,i]}return s.isRemoved()?[s,void 0]:[void 0,void 0]}setInternal(e,t,r,s){const i=fs.of(e,t,r,s);this.nodeMapByKey.set(e,i),s&&this.numberOfRemovedElement++}remove(e,t){const r=this.nodeMapByKey.get(e),s=[];if(r===void 0||t.after(r.getUpdatedAt())){if(r===void 0){this.numberOfRemovedElement+=1;const a=fs.of(e,"",t,!0);return this.nodeMapByKey.set(e,a),s.push(a),s}const i=r.isRemoved();i||(this.numberOfRemovedElement+=1),i&&s.push(r);const o=fs.of(e,r.getValue(),t,!0);return this.nodeMapByKey.set(e,o),s.push(o),s}return s}has(e){if(this.nodeMapByKey.has(e)){const t=this.nodeMapByKey.get(e);return t!==void 0&&!t.isRemoved()}return!1}get(e){if(this.nodeMapByKey.has(e))return this.nodeMapByKey.get(e).getValue()}deepcopy(){const e=new Kr;for(const[,t]of this.nodeMapByKey)e.setInternal(t.getKey(),t.getValue(),t.getUpdatedAt(),t.isRemoved());return e}toJSON(){if(!this.size())return"{}";const e=[];for(const[t,r]of this.nodeMapByKey)r.isRemoved()||e.push(`"${wr(t)}":"${wr(r.getValue())}"`);return`{${e.join(",")}}`}size(){return this.nodeMapByKey.size-this.numberOfRemovedElement}toObject(){const e={};for(const[t,r]of this.nodeMapByKey)r.isRemoved()||(e[t]=r.getValue());return e}*[Symbol.iterator](){for(const[,e]of this.nodeMapByKey)yield e}purge(e){const t=this.nodeMapByKey.get(e.getKey());t==null||t.toIDString()!=e.toIDString()||(this.nodeMapByKey.delete(e.getKey()),this.numberOfRemovedElement--)}}function Xn(n){if(n instanceof Map){const e=Array.from(n);return new Map(JSON.parse(JSON.stringify(e)))}return JSON.parse(JSON.stringify(n))}const $d=n=>n?Object.entries(n).length===0:!0,_i=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.stringify(r);return e},Gr=n=>{const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.parse(r);return e};class go{attributes;content;constructor(e){this.attributes=Kr.create(),this.content=e}static create(e){return new go(e)}get length(){return this.content.length}substring(e,t){const r=new go(this.content.substring(e,t));return r.attributes=this.attributes.deepcopy(),r}setAttr(e,t,r){return this.attributes.set(e,t,r)}getAttrs(){return this.attributes}toString(){return this.content}getDataSize(){const e={data:0,meta:0};e.data+=this.content.length*2;for(const t of this.attributes){const r=t.getDataSize();e.meta+=r.meta,e.data+=r.data}return e}toJSON(){const e=wr(this.content),t=this.attributes.toObject(),r=[];for(const[s,i]of Object.entries(t)){const o=JSON.parse(i),a=typeof o=="string"?`"${wr(s)}":"${wr(o)}"`:`"${wr(s)}":${String(o)}`;r.push(a)}return r.sort(),r.length===0?`{"val":"${e}"}`:`{"attrs":{${r.join(",")}},"val":"${e}"}`}getAttributes(){return this.attributes.toObject()}getContent(){return this.content}purge(e){this.attributes&&e instanceof fs&&this.attributes.purge(e)}getGCPairs(){const e=[];for(const t of this.attributes)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}class An extends wo{rgaTreeSplit;constructor(e,t){super(t),this.rgaTreeSplit=e}static create(e,t){return new An(e,t)}edit(e,t,r,s,i){const o=t?go.create(t):void 0;if(o&&s)for(const[d,m]of Object.entries(s))o.setAttr(d,m,r);const[a,l,c,f,g]=this.rgaTreeSplit.edit(e,r,o,i);return[f.map(d=>({...d,value:d.value?{attributes:Gr(d.value.getAttributes()),content:d.value.getContent()}:{attributes:void 0,content:""},type:"content"})),l,c,[a,a],g]}setStyle(e,t,r,s){const i={data:0,meta:0},[,o,a]=this.rgaTreeSplit.findNodeWithSplit(e[1],r),[,l,c]=this.rgaTreeSplit.findNodeWithSplit(e[0],r);Kt(i,o,l);const f=[],g=this.rgaTreeSplit.findBetween(c,a),h=[];for(const m of g){const v=m.getCreatedAt().getActorID();let I=Cl;s!=null&&(I=s.get(v)?s.get(v):0n),m.canStyle(r,I)&&h.push(m)}const d=[];for(const m of h){if(m.isRemoved())continue;const[v,I]=this.rgaTreeSplit.findIndexesFromRange(m.createPosRange());f.push({type:"style",actor:r.getActorID(),from:v,to:I,value:{attributes:Gr(t)}});for(const[E,y]of Object.entries(t)){const[p]=m.getValue().setAttr(E,y,r);p!==void 0&&d.push({parent:m.getValue(),child:p});const A=m.getValue().getAttrs().getNodeMapByKey().get(E);A!==void 0&&Kt(i,A.getDataSize())}}return[d,i,f]}indexRangeToPosRange(e,t){const r=this.rgaTreeSplit.indexToPos(e);return e===t?[r,r]:[r,this.rgaTreeSplit.indexToPos(t)]}get length(){return this.rgaTreeSplit.length}getTreeByIndex(){return this.rgaTreeSplit.getTreeByIndex()}getTreeByID(){return this.rgaTreeSplit.getTreeByID()}refinePos(e){return this.rgaTreeSplit.refinePos(e)}normalizePos(e){return this.rgaTreeSplit.normalizePos(e)}getDataSize(){const e={data:0,meta:0};for(const t of this.rgaTreeSplit){if(t.isRemoved())continue;const r=t.getDataSize();e.data+=r.data,e.meta+=r.meta}return{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){const e=[];for(const t of this.rgaTreeSplit)t.isRemoved()||e.push(t.getValue().toJSON());return`[${e.join(",")}]`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TEXT"}}toString(){return this.rgaTreeSplit.toString()}values(){const e=[];for(const t of this.rgaTreeSplit)if(!t.isRemoved()){const r=t.getValue();e.push({attributes:Gr(r.getAttributes()),content:r.getContent()})}return e}getRGATreeSplit(){return this.rgaTreeSplit}toTestString(){return this.rgaTreeSplit.toTestString()}deepcopy(){const e=new An(this.rgaTreeSplit.deepcopy(),this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}findIndexesFromRange(e){return this.rgaTreeSplit.findIndexesFromRange(e)}posToIndex(e,t=!1){return this.rgaTreeSplit.posToIndex(e,t)}getGCPairs(){const e=[];for(const t of this.rgaTreeSplit){t.getRemovedAt()&&e.push({parent:this.rgaTreeSplit,child:t});for(const r of t.getValue().getGCPairs())e.push(r)}return e}}class Es extends ar{fromPos;toPos;content;attributes;isUndoOp;constructor(e,t,r,s,i,o,a){super(e,o),this.fromPos=t,this.toPos=r,this.content=s,this.attributes=i,this.isUndoOp=a}static create(e,t,r,s,i,o,a){return new Es(e,t,r,s,i,o,a)}execute(e,t,r){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof An))throw new L(C.ErrInvalidArgument,"fail to execute, only Text can execute edit");const i=s;this.isUndoOp&&(this.fromPos=i.refinePos(this.fromPos),this.toPos=i.refinePos(this.toPos));const[o,a,l,,c]=i.edit([this.fromPos,this.toPos],this.content,this.getExecutedAt(),Object.fromEntries(this.attributes),r),f=this.toReverseOperation(c,i.normalizePos(this.fromPos));e.acc(l);for(const g of a)e.registerGCPair(g);return{opInfos:o.map(({from:g,to:h,value:d})=>({type:"edit",from:g,to:h,value:d,path:e.createPath(this.getParentCreatedAt())})),reverseOp:f}}toReverseOperation(e,t){const r=e?.length?e.map(i=>i.getContent()).join(""):"";let s;if(e.length===1){const i=e[0].getAttributes();i&&(s=Array.from(Object.entries(i)))}return Es.create(this.getParentCreatedAt(),t,$t.of(t.getID(),t.getRelativeOffset()+(this.content?.length??0)),r,s?new Map(s):new Map,void 0,!0)}normalizePos(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof An))throw new L(C.ErrInvalidArgument,"only Text can normalize edit");const r=t,s=r.normalizePos(this.fromPos).getRelativeOffset(),i=r.normalizePos(this.toPos).getRelativeOffset();return[s,i]}reconcileOperation(e,t,r){if(!this.isUndoOp||e>t)return;const s=t-e,i=this.fromPos.getRelativeOffset(),o=this.toPos.getRelativeOffset(),a=(l,c)=>{this.fromPos=$t.of(this.fromPos.getID(),Math.max(0,l)),this.toPos=$t.of(this.toPos.getID(),Math.max(0,c))};if(t<=i){a(i-s+r,o-s+r);return}if(!(o<=e)){if(e<=i&&o<=t&&e!==t){a(e,e);return}if(i<=e&&t<=o&&i!==o){a(i,o-s+r);return}if(e<i&&i<t&&t<o){a(e,e+(o-t));return}if(i<e&&e<o&&o<t){a(i,e);return}}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),s=this.content;return`${e}.EDIT(${t},${r},${s})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContent(){return this.content}getAttributes(){return this.attributes||new Map}}class To extends ar{fromPos;toPos;attributes;constructor(e,t,r,s,i){super(e,i),this.fromPos=t,this.toPos=r,this.attributes=s}static create(e,t,r,s,i){return new To(e,t,r,s,i)}execute(e,t,r){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof An))throw new L(C.ErrInvalidArgument,"fail to execute, only Text can execute edit");const i=s,[o,a,l]=i.setStyle([this.fromPos,this.toPos],this.attributes?Object.fromEntries(this.attributes):{},this.getExecutedAt(),r);e.acc(a);for(const c of o)e.registerGCPair(c);return{opInfos:l.map(({from:c,to:f,value:g})=>({type:"style",from:c,to:f,value:g,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=this.fromPos.toTestString(),r=this.toPos.toTestString(),s=this.attributes;return`${e}.STYL(${t},${r},${JSON.stringify(s)})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}}const t0=2,n0="root",Cr="text";function Fi(n,e,t=!1){let r=0;const s=t?n.allChildren:n.children;for(let i=0;i<e;i++){const o=s[i];!o||!t&&o.isRemoved||(r+=o.paddedSize(t))}return r}class r0{type;parent;_children;visibleSize;totalSize;constructor(e,t=[]){if(this.type=e,this.visibleSize=0,this.totalSize=0,this._children=t,this.isText&&this._children.length>0)throw new L(C.ErrRefused,"Text node cannot have children")}updateAncestorsSize(e,t=!1){let r=this.parent;for(;r;){if(t)r.totalSize+=e;else if(r.visibleSize+=e,r.isRemoved)break;r=r.parent}}updateDescendantsSize(e=!1){let t=0;for(const r of this._children){const s=r.updateDescendantsSize(e);!e&&r.isRemoved||(t+=s)}return e?this.totalSize+=t:this.visibleSize+=t,this.paddedSize(e)}get isText(){return this.type===Cr}paddedSize(e=!1){let t=this.visibleSize;return e&&(t=this.totalSize),this.isText||(t+=t0),t}isAncestorOf(e){return s0(this,e)}get nextSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e+1];if(t)return t}get prevSibling(){const e=this.parent.findOffset(this),t=this.parent.children[e-1];if(t)return t}splitText(e,t){const r={data:0,meta:0};if(e===0||e===this.visibleSize)return[void 0,r];const s=this.value.slice(0,e),i=this.value.slice(e);if(!i.length)return[void 0,r];const o=this.getDataSize();this.value=s;const a=this.cloneText(e+t);return a.value=i,this.parent.insertAfterInternal(a,this),Kt(r,this.getDataSize(),a.getDataSize()),Vs(r,o),[a,r]}get children(){return this._children.filter(e=>!e.isRemoved)}get allChildren(){return[...this._children]}hasTextChild(){return this.children.length>0&&this.children.every(e=>e.isText)}getChildrenText(){return this.isText?this.value:this.hasTextChild()?this.children.map(e=>e.value).join(""):""}append(...e){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");this._children.push(...e);for(const t of e)t.parent=this,t.updateAncestorsSize(t.paddedSize()),t.updateAncestorsSize(t.paddedSize(!0),!0)}prepend(...e){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");this._children.unshift(...e);for(const t of e)t.parent=this}insertBefore(e,t){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new L(C.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}insertAfter(e,t){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new L(C.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}insertAt(e,t){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");this.insertAtInternal(e,t),e.updateAncestorsSize(e.paddedSize()),e.updateAncestorsSize(e.paddedSize(!0),!0)}removeChild(e){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");const t=this._children.indexOf(e);if(t===-1)throw new L(C.ErrInvalidArgument,"child not found");this._children.splice(t,1),e.updateAncestorsSize(-e.paddedSize(!0),!0),e.parent=void 0}splitElement(e,t){const r={data:0,meta:0},s=this.getDataSize(),i=this.cloneElement(t);this.parent.insertAfterInternal(i,this),i.updateAncestorsSize(i.paddedSize()),i.updateAncestorsSize(i.paddedSize(!0),!0);const o=this.children.slice(0,e),a=this.children.slice(e);this._children=o,i._children=a,this.visibleSize=this._children.reduce((l,c)=>l+c.paddedSize(),0),this.totalSize=this._children.reduce((l,c)=>l+c.paddedSize(!0),0),i.visibleSize=i._children.reduce((l,c)=>l+c.paddedSize(!0),0),i.totalSize=i._children.reduce((l,c)=>l+c.paddedSize(!0),0);for(const l of i._children)l.parent=i;return Kt(r,this.getDataSize(),i.getDataSize()),Vs(r,s),[i,r]}insertAfterInternal(e,t){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");const r=this._children.indexOf(t);if(r===-1)throw new L(C.ErrInvalidArgument,"child not found");this.insertAtInternal(e,r+1)}insertAtInternal(e,t){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");this._children.splice(t,0,e),e.parent=this}findOffset(e,t=!1){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");if(t)return this._children.indexOf(e);if(e.isRemoved){const r=this._children.indexOf(e);return this.allChildren.splice(0,r).filter(i=>!i.isRemoved).length}return this.children.indexOf(e)}findBranchOffset(e){if(this.isText)throw new L(C.ErrRefused,"Text node cannot have children");let t=e;for(;t;){const r=this._children.indexOf(t);if(r!==-1)return r;t=t.parent}return-1}}function s0(n,e){if(n===e)return!1;for(;e.parent;){if(e.parent===n)return!0;e=e.parent}return!1}var St=(n=>(n.Start="Start",n.End="End",n.Text="Text",n))(St||{});function Kd(n,e,t,r,s=!1){if(e>t)throw new L(C.ErrInvalidArgument,`from is greater than to: ${e} > ${t}`);const i=s?n.totalSize:n.visibleSize;if(e>i)throw new L(C.ErrInvalidArgument,`from is out of range: ${e} > ${i}`);if(t>i)throw new L(C.ErrInvalidArgument,`to is out of range: ${t} > ${i}`);if(e===t)return;let o=0;const a=s?n._children:n.children;for(const l of a){if(e-l.paddedSize(s)<o&&o<t){const c=l.isText?e-o:e-o-1,f=l.isText?t-o:t-o-1,g=s?l.totalSize:l.visibleSize,h=!l.isText&&c<0,d=!l.isText&&f>g;(l.isText||h)&&r([l,l.isText?"Text":"Start"],d),Kd(l,Math.max(0,c),Math.min(f,g),r,s),d&&r([l,"End"],d)}o+=l.paddedSize(s)}}function jd(n,e,t=0){for(const r of n.children)jd(r,e,t+1);e(n,t)}function La(n,e,t=0){for(const r of n._children)La(r,e,t+1);e(n,t)}function _l(n,e,t=!0){if(e>n.visibleSize)throw new L(C.ErrInvalidArgument,`index is out of range: ${e} > ${n.visibleSize}`);if(n.isText)return{node:n,offset:e};let r=0,s=0;for(const i of n.children){if(t&&i.isText&&i.visibleSize>=e-s)return _l(i,e-s,t);if(e===s)return{node:n,offset:r};if(!t&&i.paddedSize()===e-s)return{node:n,offset:r+1};if(i.paddedSize()>e-s)return _l(i,e-s-1,t);s+=i.paddedSize(),r+=1}return{node:n,offset:r}}function Yd(n){return n.isText||n.children.length===0?n:Yd(n.children[0])}function i0(n,e){if(n.visibleSize<e)throw new L(C.ErrInvalidArgument,"unacceptable path");for(let t=0;t<n.children.length;t++){const r=n.children[t];if(r.visibleSize<e)e-=r.visibleSize;else{n=r;break}}return{node:n,offset:e}}class o0{root;constructor(e){this.root=e}tokensBetween(e,t,r,s=!1){Kd(this.root,e,t,r,s)}traverse(e){jd(this.root,e,0)}traverseAll(e){La(this.root,e,0)}findTreePos(e,t=!0){return _l(this.root,e,t)}treePosToPath(e){const t=[];let r=e.node;if(r.isText){const s=r.parent.findOffset(r);if(s===-1)throw new L(C.ErrInvalidArgument,"invalid treePos");const i=Fi(r.parent,s);t.push(i+e.offset),r=r.parent}else if(r.hasTextChild()){const s=Fi(r,e.offset);t.push(s)}else t.push(e.offset);for(;r.parent;){const s=r.parent.findOffset(r);if(s===-1)throw new L(C.ErrInvalidArgument,"invalid treePos");t.push(s),r=r.parent}return t.reverse()}pathToIndex(e){const t=this.pathToTreePos(e);return this.indexOf(t)}pathToTreePos(e){if(!e.length)throw new L(C.ErrInvalidArgument,"unacceptable path");let t=this.root;for(let r=0;r<e.length-1;r++){const s=e[r];if(t=t.children[s],!t)throw new L(C.ErrInvalidArgument,"unacceptable path")}if(t.hasTextChild())return i0(t,e[e.length-1]);if(t.children.length<e[e.length-1])throw new L(C.ErrInvalidArgument,"unacceptable path");return{node:t,offset:e[e.length-1]}}getRoot(){return this.root}get size(){return this.root.visibleSize}findPostorderRight(e){const{node:t,offset:r}=e;if(t.isText){if(t.visibleSize===r){const s=t.nextSibling;return s||t.parent}return t}return t.children.length===r?t:Yd(t.children[r])}indexOf(e,t=!1){let{node:r}=e;const{offset:s}=e;let i=0,o=1;if(r.isText){i+=s;const a=r.parent,l=a.findOffset(r,t);if(l===-1)throw new L(C.ErrInvalidArgument,"invalid pos");i+=Fi(a,l,t),r=r.parent}else i+=Fi(r,s,t);for(;r?.parent;){const a=r.parent,l=a.findOffset(r,t);if(l===-1)throw new L(C.ErrInvalidArgument,"invalid pos");i+=Fi(a,l,t),o++,r=r.parent}return i+o-1}indexToPath(e){const t=this.findTreePos(e);return this.treePosToPath(t)}}class sr{parentID;leftSiblingID;constructor(e,t){this.parentID=e,this.leftSiblingID=t}static of(e,t){return new sr(e,t)}static fromTreePos(e){const{offset:t}=e;let{node:r}=e,s;return r.isText?(r.parent.children[0]===r&&t===0?s=r.parent:s=r,r=r.parent):t===0?s=r:s=r.children[t-1],sr.of(r.id,jt.of(s.getCreatedAt(),s.getOffset()+t))}getParentID(){return this.parentID}static fromStruct(e){return sr.of(jt.of(Fn.fromStruct(e.parentID.createdAt),e.parentID.offset),jt.of(Fn.fromStruct(e.leftSiblingID.createdAt),e.leftSiblingID.offset))}toStruct(){return{parentID:{createdAt:this.getParentID().getCreatedAt().toStruct(),offset:this.getParentID().getOffset()},leftSiblingID:{createdAt:this.getLeftSiblingID().getCreatedAt().toStruct(),offset:this.getLeftSiblingID().getOffset()}}}toTreeNodePair(e){const t=this.getParentID(),r=this.getLeftSiblingID(),s=e.findFloorNode(t);let i=e.findFloorNode(r);if(!s||!i)throw new L(C.ErrRefused,`cannot find node of CRDTTreePos(${t.toTestString()}, ${r.toTestString()})`);return!r.equals(t)&&r.getOffset()>0&&r.getOffset()===i.id.getOffset()&&i.insPrevID&&(i=e.findFloorNode(i.insPrevID)),[s,i]}getLeftSiblingID(){return this.leftSiblingID}equals(e){return this.getParentID().getCreatedAt().equals(e.getParentID().getCreatedAt())&&this.getParentID().getOffset()===e.getParentID().getOffset()&&this.getLeftSiblingID().getCreatedAt().equals(e.getLeftSiblingID().getCreatedAt())&&this.getLeftSiblingID().getOffset()===e.getLeftSiblingID().getOffset()}}class jt{createdAt;offset;constructor(e,t){this.createdAt=e,this.offset=t}static of(e,t){return new jt(e,t)}static fromStruct(e){return jt.of(Fn.fromStruct(e.createdAt),e.offset)}static createComparator(){return(e,t)=>{const r=e.getCreatedAt().compare(t.getCreatedAt());return r!==0?r:e.getOffset()>t.getOffset()?1:e.getOffset()<t.getOffset()?-1:0}}getCreatedAt(){return this.createdAt}equals(e){return this.createdAt.compare(e.createdAt)===0&&this.offset===e.offset}getOffset(){return this.offset}setOffset(e){this.offset=e}toStruct(){return{createdAt:this.createdAt.toStruct(),offset:this.offset}}toIDString(){return`${this.createdAt.toIDString()}:${this.offset}`}toTestString(){return`${this.createdAt.toTestString()}/${this.offset}`}}class In extends r0{id;removedAt;attrs;insPrevID;insNextID;_value="";constructor(e,t,r,s,i){super(t),this.id=e,this.removedAt=i,s&&(this.attrs=s),typeof r=="string"?this.value=r:Array.isArray(r)&&(this._children=r)}toIDString(){return this.id.toIDString()}getRemovedAt(){return this.removedAt}static create(e,t,r,s){return new In(e,t,r,s)}deepcopy(){const e=new In(this.id,this.type);return e.removedAt=this.removedAt,e._value=this._value,e.visibleSize=this.visibleSize,e.totalSize=this.totalSize,e.attrs=this.attrs?.deepcopy(),e._children=this._children.map(t=>{const r=t.deepcopy();return r.parent=e,r}),e.insPrevID=this.insPrevID,e.insNextID=this.insNextID,e}get value(){if(!this.isText)throw new L(C.ErrInvalidType,`cannot get value of element node: ${this.type}`);return this._value}set value(e){if(!this.isText)throw new L(C.ErrInvalidType,`cannot set value of element node: ${this.type}`);this._value=e,this.visibleSize=e.length,this.totalSize=e.length}get isRemoved(){return!!this.removedAt}remove(e){return this.removedAt?(e.after(this.removedAt)&&(this.removedAt=e),!1):(this.removedAt=e,this.updateAncestorsSize(-this.paddedSize()),!0)}cloneText(e){return new In(jt.of(this.id.getCreatedAt(),e),this.type,void 0,void 0,this.removedAt)}cloneElement(e){return new In(jt.of(e(),0),this.type,void 0,void 0,this.removedAt)}split(e,t,r){const[s,i]=this.isText?this.splitText(t,this.id.getOffset()):this.splitElement(t,r);if(s){if(s.insPrevID=this.id,this.insNextID){const o=e.findFloorNode(this.insNextID);o.insPrevID=s.id,s.insNextID=this.insNextID}this.insNextID=s.id,e.registerNode(s)}return[s,i]}getCreatedAt(){return this.id.getCreatedAt()}getOffset(){return this.id.getOffset()}canDelete(e,t,r){return t?!!(!this.removedAt||!r&&e?.after(this.removedAt)):!1}canStyle(e,t){return this.isText?!1:this.getCreatedAt().getLamport()<=t&&(!this.removedAt||e.after(this.removedAt))}setAttrs(e,t){this.attrs||(this.attrs=new Kr);const r=[];for(const[s,i]of Object.entries(e))r.push(this.attrs.set(s,i,t));return r}purge(e){this.attrs&&this.attrs.purge(e)}getDataSize(){const e={data:0,meta:0};if(this.isText&&(e.data+=this.visibleSize*2),this.id&&(e.meta+=Tr),this.removedAt&&(e.meta+=Tr),this.attrs)for(const t of this.attrs){if(t.getRemovedAt())continue;const r=t.getDataSize();e.meta+=r.meta,e.data+=r.data}return e}getGCPairs(){const e=[];if(!this.attrs)return e;for(const t of this.attrs)t.getRemovedAt()&&e.push({parent:this,child:t});return e}}function Ll(n){if(n.isText){const t=n;return{type:t.type,value:t.value}}const e={type:n.type,children:n.children.map(Ll)};return n.attrs&&(e.attributes=Gr(n.attrs?.toObject())),e}function wc(n){if(n.isText)return n.value;let e="";return n.attrs&&n.attrs.size()&&(e=" "+Array.from(n.attrs).filter(t=>!t.isRemoved()).sort((t,r)=>t.getKey().localeCompare(r.getKey())).map(t=>{const r=JSON.parse(t.getValue());return typeof r=="string"?`${t.getKey()}="${r}"`:`${t.getKey()}="${wr(t.getValue())}"`}).join(" ")),`<${n.type}${e}>${n.children.map(t=>wc(t)).join("")}</${n.type}>`}function qd(n){if(n.isText){const e=n;return{type:e.type,value:e.value,visibleSize:e.visibleSize,isRemoved:e.isRemoved}}return{type:n.type,children:n.children.map(qd),visibleSize:n.visibleSize,isRemoved:n.isRemoved}}class Tn extends wo{indexTree;nodeMapByID;constructor(e,t){super(t),this.indexTree=new o0(e),this.nodeMapByID=new Gd(jt.createComparator()),this.indexTree.traverseAll(r=>{this.nodeMapByID.put(r.id,r)})}static create(e,t){return new Tn(e,t)}findFloorNode(e){const t=this.nodeMapByID.floorEntry(e);if(!(!t||!t.key.getCreatedAt().equals(e.getCreatedAt())))return t.value}registerNode(e){this.nodeMapByID.put(e.id,e)}findNodesAndSplitText(e,t){let r={data:0,meta:0};const[s,i]=e.toTreeNodePair(this);let o=i;const a=s===o,l=o.parent&&!a?o.parent:s;if(o.isText){const[,c]=o.split(this,e.getLeftSiblingID().getOffset()-o.id.getOffset());r=c}if(t){const c=l.allChildren,f=a?0:c.indexOf(o)+1;for(let g=f;g<c.length;g++){const h=c[g];if(!h.id.getCreatedAt().after(t))break;o=h}}return[[l,o],r]}style(e,t,r,s){const i={data:0,meta:0},[[o,a],l]=this.findNodesAndSplitText(e[0],r),[[c,f],g]=this.findNodesAndSplitText(e[1],r);Kt(i,g,l);const h=[],d=t?Gr(t):{},m=[];return this.traverseInPosRange(o,a,c,f,([v,I])=>{const E=v.getCreatedAt().getActorID();let y=Cl;if(s!=null&&(y=s.get(E)?s.get(E):0n),v.canStyle(r,y)&&t){const p=v.setAttrs(t,r),A=p.reduce((B,[,$])=>($&&(B[$.getKey()]=d[$.getKey()]),B),{}),S=v.parent,T=v.prevSibling||v.parent;Object.keys(A).length>0&&h.push({type:"style",from:this.toIndex(S,T),to:this.toIndex(v,v),fromPath:this.toPath(S,T),toPath:this.toPath(v,v),actor:r.getActorID(),value:A});for(const[B]of p)B&&m.push({parent:v,child:B});for(const[B]of Object.entries(d)){const $=v.attrs?.getNodeMapByKey().get(B);$!==void 0&&I!==St.End&&Kt(i,$.getDataSize())}}}),[m,h,i]}removeStyle(e,t,r,s){const i={data:0,meta:0},[[o,a],l]=this.findNodesAndSplitText(e[0],r),[[c,f],g]=this.findNodesAndSplitText(e[1],r);Kt(i,g,l);const h=[],d=[];return this.traverseInPosRange(o,a,c,f,([m])=>{const v=m.getCreatedAt().getActorID();let I=Cl;if(s!=null&&(I=s.get(v)?s.get(v):0n),m.canStyle(r,I)&&t){m.attrs||(m.attrs=new Kr);for(const p of t){const A=m.attrs.remove(p,r);for(const S of A)d.push({parent:m,child:S})}const E=m.parent,y=m.prevSibling||m.parent;h.push({actor:r.getActorID(),type:"removeStyle",from:this.toIndex(E,y),to:this.toIndex(m,m),fromPath:this.toPath(E,y),toPath:this.toPath(m,m),value:t})}}),[d,h,i]}edit(e,t,r,s,i,o){const a={data:0,meta:0},[[l,c],f]=this.findNodesAndSplitText(e[0],s),[[g,h],d]=this.findNodesAndSplitText(e[1],s);Kt(a,d,f);const m=this.toIndex(l,c),v=this.toPath(l,c),I=[],E=[],y=[];this.traverseInPosRange(l,c,g,h,([S,T],B)=>{if(T===St.Start&&!B)for(const P of S.children)y.push(P);const $=o===void 0;let X=!1;const H=o?.get(S.id.getCreatedAt().getActorID());X=$||H!==void 0&&H>=S.id.getCreatedAt().getLamport();let N=!1;if(S.removedAt){const P=o?.get(S.removedAt.getActorID());N=$||P!==void 0&&P>=S.removedAt.getLamport()}(S.canDelete(s,X,N)||I.includes(S.parent))&&((T===St.Text||T===St.Start)&&I.push(S),E.push([S,T]))},!0);const p=this.makeDeletionChanges(E,s),A=[];for(const S of I)S.remove(s),S.isRemoved&&A.push({parent:this,child:S});for(const S of y)S.removedAt||l.append(S);if(r>0){let S=0,T=l,B=c;for(;S<r;)T.split(this,T.findOffset(B)+1,i),B=T,T=T.parent,S++;p.push({type:"content",from:m,to:m,fromPath:v,toPath:v,actor:s.getActorID()})}if(t?.length){const S=[];let T=c;for(const B of t)T===l?l.insertAt(B,0):l.insertAfter(B,T),T=B,La(B,$=>{l.isRemoved?($.remove(s),A.push({parent:this,child:$})):Kt(a,$.getDataSize()),this.nodeMapByID.put($.id,$)}),B.isRemoved||S.push(B);if(S.length){const B=S.map($=>Ll($));p.length&&p[p.length-1].from===m?p[p.length-1].value=B:p.push({type:"content",from:m,to:m,fromPath:v,toPath:v,actor:s.getActorID(),value:B})}}return[p,A,a]}editT(e,t,r,s,i){const o=this.findPos(e[0]),a=this.findPos(e[1]);return this.edit([o,a],t,r,s,i)}move(e,t,r){throw new L(C.ErrUnimplemented,`not implemented: ${e}, ${t}, ${r}`)}pathToTreePos(e){return this.indexTree.pathToTreePos(e)}purge(e){e.parent?.removeChild(e),this.nodeMapByID.remove(e.id);const t=e.insPrevID,r=e.insNextID;if(t){const s=this.findFloorNode(t);s.insNextID=r}if(r){const s=this.findFloorNode(r);s.insPrevID=t}e.insPrevID=void 0,e.insNextID=void 0}getGCPairs(){const e=[];return this.indexTree.traverse(t=>{t.getRemovedAt()&&e.push({parent:this,child:t});for(const r of t.getGCPairs())e.push(r)}),e}findPos(e,t=!0){const r=this.indexTree.findTreePos(e,t);return sr.fromTreePos(r)}pathToPosRange(e){const t=this.pathToIndex(e);return[this.findPos(t),this.findPos(t+1)]}pathToPos(e){const t=this.indexTree.pathToIndex(e);return this.findPos(t)}getRoot(){return this.indexTree.getRoot()}getSize(){return this.indexTree.size}getNodeSize(){return this.nodeMapByID.size()}getIndexTree(){return this.indexTree}toXML(){return wc(this.indexTree.getRoot())}getDataSize(){const e={data:0,meta:0};return this.indexTree.traverse(t=>{if(t.getRemovedAt())return;const r=t.getDataSize();e.data+=r.data,e.meta+=r.meta}),{data:e.data,meta:e.meta+this.getMetaUsage()}}toJSON(){return JSON.stringify(this.getRootTreeNode())}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:JSON.parse(this.toJSON()),type:"YORKIE_TREE"}}toJSInfoForTest(){const e=this.indexTree.getRoot(),t=(r,s=void 0,i=void 0,o=0)=>{let a,l,c;const f=r.isText?{node:r,offset:0}:s&&i?this.toTreePos(s,i):null;f&&(a=this.indexTree.indexOf(f),l=this.indexTree.treePosToPath(f),c=sr.fromTreePos(f).toStruct());const g={type:r.type,parent:s?.id.toTestString(),size:r.visibleSize,id:r.id.toTestString(),removedAt:r.removedAt?.toTestString(),insPrev:r.insPrevID?.toTestString(),insNext:r.insNextID?.toTestString(),value:r.isText?r.value:void 0,isRemoved:r.isRemoved,children:[],depth:o,attributes:r.attrs?Gr(r.attrs?.toObject()):void 0,index:a,path:l,pos:c};for(let h=0;h<r.allChildren.length;h++){const d=h===0?r:r.allChildren[h-1];g.children.push(t(r.allChildren[h],r,d,o+1))}return g};return t(e)}getRootTreeNode(){return Ll(this.indexTree.getRoot())}toTestTreeNode(){return qd(this.indexTree.getRoot())}toSortedJSON(){return this.toJSON()}deepcopy(){const e=this.getRoot(),t=new Tn(e.deepcopy(),this.getCreatedAt());return t.setRemovedAt(this.getRemovedAt()),t.setMovedAt(this.getMovedAt()),t}toPath(e,t){const r=this.toTreePos(e,t);return r?this.indexTree.treePosToPath(r):[]}toIndex(e,t,r=!1){const s=this.toTreePos(e,t,r);return s?this.indexTree.indexOf(s,r):-1}indexToPath(e){return this.indexTree.indexToPath(e)}pathToIndex(e){return this.indexTree.pathToIndex(e)}indexRangeToPosRange(e){const t=this.findPos(e[0]);return e[0]===e[1]?[t,t]:[t,this.findPos(e[1])]}indexRangeToPosStructRange(e){const[t,r]=e,s=this.findPos(t);return t===r?[s.toStruct(),s.toStruct()]:[s.toStruct(),this.findPos(r).toStruct()]}posRangeToPathRange(e){const[[t,r]]=this.findNodesAndSplitText(e[0]),[[s,i]]=this.findNodesAndSplitText(e[1]);return[this.toPath(t,r),this.toPath(s,i)]}posRangeToIndexRange(e){const[[t,r]]=this.findNodesAndSplitText(e[0]),[[s,i]]=this.findNodesAndSplitText(e[1]);return[this.toIndex(t,r),this.toIndex(s,i)]}traverseInPosRange(e,t,r,s,i,o=!1){const a=this.toIndex(e,t,o),l=this.toIndex(r,s,o);this.indexTree.tokensBetween(a,l,i,o)}toTreePos(e,t,r=!1){if(!e||!t)return;if(!r&&e.isRemoved){let i;for(;e.isRemoved;)i=e,e=i.parent;const o=e.findOffset(i,r);return{node:e,offset:o}}if(e===t)return{node:e,offset:0};let s=e.findOffset(t,r);if(r||!t.isRemoved){if(t.isText)return{node:t,offset:t.paddedSize(r)};s++}return{node:e,offset:s}}makeDeletionChanges(e,t){const r=[],s=[];let i=null,o=null;for(let a=0;a<e.length;a++){const l=e[a],c=e[a+1];i||(i=l),o=l;const f=this.findRightToken(l);(!f||!c||f[0]!==c[0]||f[1]!==c[1])&&(s.push([i,o]),i=null,o=null)}for(const a of s){const[l,c]=a,[f,g]=this.findLeftToken(l),[h,d]=c,m=g===St.Start?f:f.parent,v=d===St.Start?h:h.parent,I=this.toIndex(m,f),E=this.toIndex(v,h);I<E&&(r.length>0&&I===r[r.length-1].to?(r[r.length-1].to=E,r[r.length-1].toPath=this.toPath(v,h)):r.push({type:"content",from:I,to:E,fromPath:this.toPath(m,f),toPath:this.toPath(v,h),actor:t.getActorID()}))}return r.reverse()}findRightToken([e,t]){if(t===St.Start){const a=e.allChildren;return a.length>0?[a[0],a[0].isText?St.Text:St.Start]:[e,St.End]}const r=e.parent,s=r.allChildren,i=s.indexOf(e);if(r&&i===s.length-1)return[r,St.End];const o=s[i+1];return[o,o.isText?St.Text:St.Start]}findLeftToken([e,t]){if(t===St.End){const a=e.allChildren;if(a.length>0){const l=a[a.length-1];return[l,l.isText?St.Text:St.End]}return[e,St.Start]}const r=e.parent,s=r.allChildren,i=s.indexOf(e);if(r&&i===0)return[r,St.Start];const o=s[i-1];return[o,o.isText?St.Text:St.End]}}class xo extends ar{fromPos;toPos;contents;splitLevel;constructor(e,t,r,s,i,o){super(e,o),this.fromPos=t,this.toPos=r,this.contents=s,this.splitLevel=i}static create(e,t,r,s,i,o){return new xo(e,t,r,s,i,o)}execute(e,t,r){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof Tn))throw new L(C.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const i=this.getExecutedAt(),o=s,[a,l,c]=o.edit([this.fromPos,this.toPos],this.contents?.map(f=>f.deepcopy()),this.splitLevel,i,(()=>{let f=i.getDelimiter();return this.contents!==void 0&&(f+=this.contents.length),()=>Fn.of(i.getLamport(),++f,i.getActorID())})(),r);e.acc(c);for(const f of l)e.registerGCPair(f);return{opInfos:a.map(({from:f,to:g,value:h,splitLevel:d,fromPath:m,toPath:v})=>({type:"tree-edit",path:e.createPath(this.getParentCreatedAt()),from:f,to:g,value:h,splitLevel:d,fromPath:m,toPath:v}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.fromPos.getLeftSiblingID().getOffset()}`,r=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}/${this.toPos.getLeftSiblingID().getOffset()}`,s=this.contents||[];return`${e}.EDIT(${t},${r},${s.map(i=>wc(i)).join("")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getContents(){return this.contents}getSplitLevel(){return this.splitLevel}}class pi{vector;constructor(e){this.vector=e||new Map}set(e,t){this.vector.set(e,t)}unset(e){this.vector.delete(e)}get(e){return this.vector.get(e)}has(e){return this.vector.has(e)}maxLamport(){let e=BigInt(0);for(const[,t]of this)t>e&&(e=t);return e}max(e){const t=new Map;for(const[r,s]of e){const i=this.vector.get(r),o=i&&i>s?i:s;t.set(r,o)}for(const[r,s]of this){const i=e.get(r),o=i&&i>s?i:s;t.set(r,o)}return new pi(t)}afterOrEqual(e){const t=this.vector.get(e.getActorID());return t===void 0?!1:t>=e.getLamport()}deepcopy(){const e=new Map;for(const[t,r]of this.vector)e.set(t,r);return new pi(e)}filter(e){const t=new Map;for(const[r]of e){const s=this.vector.get(r);s!==void 0&&t.set(r,s)}return new pi(t)}size(){return this.vector.size}*[Symbol.iterator](){for(const[e,t]of this.vector)yield[e,t]}}const zd=new pi(new Map);class Jn{clientSeq;serverSeq;actor;lamport;versionVector;constructor(e,t,r,s,i){this.clientSeq=e,this.serverSeq=i,this.lamport=t,this.versionVector=s,this.actor=r}hasClocks(){return this.versionVector.size()>0&&this.lamport!=xl}static of(e,t,r,s,i){return new Jn(e,t,r,s,i)}next(e=!1){if(e)return new Jn(this.clientSeq+1,this.lamport,this.actor,zd,xl);const t=this.versionVector.deepcopy();return t.set(this.actor,this.lamport+1n),new Jn(this.clientSeq+1,this.lamport+1n,this.actor,t)}syncClocks(e){if(!e.hasClocks())return this;const t=e.lamport>this.lamport?e.lamport+1n:this.lamport+1n,r=this.versionVector.max(e.versionVector),s=new Jn(this.clientSeq,t,this.actor,r);return s.versionVector.set(this.actor,t),s}setClocks(e,t){const r=e>this.lamport?e+1n:this.lamport+1n,s=this.versionVector.max(t);return s.set(this.actor,r),Jn.of(this.clientSeq,r,this.actor,s)}createTimeTicket(e){return Fn.of(this.lamport,e,this.actor)}setActor(e){return new Jn(this.clientSeq,this.lamport,e,this.versionVector,this.serverSeq)}setLamport(e){return new Jn(this.clientSeq,e,this.actor,this.versionVector,this.serverSeq)}setVersionVector(e){return new Jn(this.clientSeq,this.lamport,this.actor,e,this.serverSeq)}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq?this.serverSeq.toString():""}getLamport(){return this.lamport}getLamportAsString(){return this.lamport.toString()}getActorID(){return this.actor}getVersionVector(){return this.versionVector}toTestString(){return`${this.lamport.toString()}:${this.actor.slice(-2)}:${this.clientSeq}`}}const a0=new Jn(0,0n,Ic,zd);class Li{id;operations;presenceChange;message;constructor({id:e,operations:t,presenceChange:r,message:s}){this.id=e,this.operations=t||[],this.presenceChange=r,this.message=s}static create({id:e,operations:t,presenceChange:r,message:s}){return new Li({id:e,operations:t,presenceChange:r,message:s})}getID(){return this.id}getMessage(){return this.message}hasOperations(){return this.operations.length>0}getOperations(){return this.operations}setActor(e){for(const t of this.operations)t.setActor(e);this.id=this.id.setActor(e)}hasPresenceChange(){return this.presenceChange!==void 0}getPresenceChange(){return this.presenceChange}execute(e,t,r){const s=[],i=[],o=[];for(const a of this.operations){const l=a.execute(e,r,this.id.getVersionVector());if(!l)continue;const{opInfos:c,reverseOp:f}=l;s.push(...c),i.push(a),f&&o.unshift(f)}return this.presenceChange&&(this.presenceChange.type===_r.Put?t.set(this.id.getActorID(),Xn(this.presenceChange.presence)):t.delete(this.id.getActorID())),{operations:i,opInfos:s,reverseOps:o}}toTestString(){return`${this.operations.map(e=>e.toTestString()).join(",")}`}toStruct(){return{changeID:ut.bytesToHex(ut.changeIDToBinary(this.getID())),message:this.getMessage(),operations:this.getOperations().map(e=>ut.bytesToHex(ut.operationToBinary(e))),presenceChange:this.getPresenceChange()}}static fromStruct(e){const{changeID:t,operations:r,presenceChange:s,message:i}=e;return Li.create({id:ut.bytesToChangeID(ut.hexToBytes(t)),operations:r?.map(o=>ut.bytesToOperation(ut.hexToBytes(o))),presenceChange:s,message:i})}}class Oa{documentKey;checkpoint;isRemoved;changes;snapshot;versionVector;constructor(e,t,r,s,i,o){this.documentKey=e,this.checkpoint=t,this.isRemoved=r,this.changes=s,this.snapshot=o,this.versionVector=i}static create(e,t,r,s,i,o){return new Oa(e,t,r,s,i,o)}getDocumentKey(){return this.documentKey}getCheckpoint(){return this.checkpoint}getIsRemoved(){return this.isRemoved}getChanges(){return this.changes}hasChanges(){return this.changes.length>0}getChangeSize(){return this.changes.length}hasSnapshot(){return!!this.snapshot&&!!this.snapshot.length}getSnapshot(){return this.snapshot}getVersionVector(){return this.versionVector}}class mi{serverSeq;clientSeq;constructor(e,t){this.serverSeq=e,this.clientSeq=t}static of(e,t){return new mi(e,t)}increaseClientSeq(e){return e===0?this:new mi(this.serverSeq,this.clientSeq+e)}forward(e){if(this.equals(e))return this;const t=this.serverSeq>e.serverSeq?this.serverSeq:e.serverSeq,r=Math.max(this.clientSeq,e.clientSeq);return mi.of(t,r)}getServerSeqAsString(){return this.serverSeq.toString()}getClientSeq(){return this.clientSeq}getServerSeq(){return this.serverSeq}equals(e){return this.clientSeq===e.clientSeq&&this.serverSeq==e.serverSeq}toTestString(){return`serverSeq=${this.serverSeq}, clientSeq=${this.clientSeq}`}}const l0=new mi(0n,0),Ah=n=>n<0?Math.ceil(n):Math.floor(n);var Or=(n=>(n[n.Int=0]="Int",n[n.Long=1]="Long",n))(Or||{});class vn extends wo{valueType;value;constructor(e,t,r){switch(super(r),this.valueType=e,e){case 0:typeof t=="number"?t>Math.pow(2,31)-1||t<-Math.pow(2,31)?this.value=Me.fromNumber(t).toInt():this.value=Ah(t):this.value=t.toInt();break;case 1:typeof t=="number"?this.value=Me.fromNumber(t):this.value=t;break;default:throw new L(C.ErrUnimplemented,`unimplemented type: ${e}`)}}static create(e,t,r){return new vn(e,t,r)}static valueFromBytes(e,t){switch(e){case 0:return t[0]|t[1]<<8|t[2]<<16|t[3]<<24;case 1:return Me.fromBytesLE(Array.from(t));default:throw new L(C.ErrUnimplemented,`unimplemented type: ${e}`)}}getDataSize(){return{data:this.valueType===0?4:8,meta:this.getMetaUsage()}}toJSON(){return`${this.value}`}toSortedJSON(){return this.toJSON()}toJSForTest(){return{createdAt:this.getCreatedAt().toTestString(),value:this.value,type:"YORKIE_COUNTER"}}deepcopy(){const e=vn.create(this.valueType,this.value,this.getCreatedAt());return e.setRemovedAt(this.getRemovedAt()),e.setMovedAt(this.getMovedAt()),e}getType(){return this.valueType}static getCounterType(e){switch(typeof e){case"object":return e instanceof Me?1:void 0;case"number":return e>Math.pow(2,31)-1||e<-Math.pow(2,31)?1:0;default:return}}static isSupport(e){return!!vn.getCounterType(e)}static isInteger(e){return e%1===0}isNumericType(){const e=this.valueType;return e===0||e===1}getValueType(){return this.valueType}getValue(){return this.value}toBytes(){switch(this.valueType){case 0:{const e=this.value;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}case 1:{const t=this.value.toBytesLE();return Uint8Array.from(t)}default:throw new L(C.ErrUnimplemented,`unimplemented type: ${this.valueType}`)}}increase(e){function t(r){if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`)}return t(this),t(e),this.valueType===1?this.value=this.value.add(e.getValue()):e.getType()===nt.Long?this.value=this.value+e.getValue().toInt():this.value=Me.fromNumber(this.value+Ah(e.getValue())).toInt(),this}}class Oi extends ar{value;constructor(e,t,r){super(e,r),this.value=t}static create(e,t,r){return new Oi(e,t,r)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof vn))throw new L(C.ErrInvalidArgument,"fail to execute, only Counter can execute increase");const r=t,s=this.value.deepcopy();return r.increase(s),{opInfos:[{type:"increase",path:e.createPath(this.getParentCreatedAt()),value:s.getValue()}],reverseOp:this.toReverseOperation()}}toReverseOperation(){const e=this.value.deepcopy(),r=e.getType()===nt.Long?e.getValue().multiply(-1):e.getValue()*-1;return Oi.create(this.getParentCreatedAt(),bt.of(r,e.getCreatedAt()))}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){return`${this.getParentCreatedAt().toTestString()}.INCREASE.${this.value.toJSON()}`}getValue(){return this.value}}class $r extends ar{fromPos;toPos;attributes;attributesToRemove;constructor(e,t,r,s,i,o){super(e,o),this.fromPos=t,this.toPos=r,this.attributes=s,this.attributesToRemove=i}static create(e,t,r,s,i){return new $r(e,t,r,s,[],i)}static createTreeRemoveStyleOperation(e,t,r,s,i){return new $r(e,t,r,new Map,s,i)}execute(e,t,r){const s=e.findByCreatedAt(this.getParentCreatedAt());if(!s)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(s instanceof Tn))throw new L(C.ErrInvalidArgument,"fail to execute, only Tree can execute edit");const i=s;let o,a,l={data:0,meta:0};if(this.attributes.size){const c={};[...this.attributes].forEach(([f,g])=>c[f]=g),[a,o,l]=i.style([this.fromPos,this.toPos],c,this.getExecutedAt(),r)}else{const c=this.attributesToRemove;[a,o,l]=i.removeStyle([this.fromPos,this.toPos],c,this.getExecutedAt(),r)}e.acc(l);for(const c of a)e.registerGCPair(c);return{opInfos:o.map(({from:c,to:f,value:g,fromPath:h,toPath:d})=>({type:"tree-style",from:c,to:f,value:this.attributes.size?{attributes:g}:{attributesToRemove:g},fromPath:h,toPath:d,path:e.createPath(this.getParentCreatedAt())}))}}getEffectedCreatedAt(){return this.getParentCreatedAt()}toTestString(){const e=this.getParentCreatedAt().toTestString(),t=`${this.fromPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.fromPos.getLeftSiblingID().getOffset()}`,r=`${this.toPos.getLeftSiblingID().getCreatedAt().toTestString()}:${this.toPos.getLeftSiblingID().getOffset()}`;return`${e}.STYLE(${t},${r},${Object.entries(this.attributes||{}).map(([s,i])=>`${s}:"${i}"`).join(" ")})`}getFromPos(){return this.fromPos}getToPos(){return this.toPos}getAttributes(){return this.attributes}getAttributesToRemove(){return this.attributesToRemove}}class jr extends ar{createdAt;value;constructor(e,t,r,s){super(e,s),this.createdAt=t,this.value=r}static create(e,t,r,s){return new jr(e,t,r,s)}execute(e){const t=e.findByCreatedAt(this.getParentCreatedAt());if(!t)throw new L(C.ErrInvalidArgument,`fail to find ${this.getParentCreatedAt()}`);if(!(t instanceof nn))throw new L(C.ErrInvalidArgument,"fail to execute, only array can execute set");const r=t.getByID(this.createdAt).deepcopy(),s=this.toReverseOperation(this.value,r),i=this.value.deepcopy();return t.insertAfter(this.createdAt,i,this.getExecutedAt()),t.delete(this.createdAt,this.getExecutedAt()),e.registerElement(i),{opInfos:[{type:"array-set",path:e.createPath(this.getParentCreatedAt())}],reverseOp:s}}toReverseOperation(e,t){return jr.create(this.getParentCreatedAt(),e.getCreatedAt(),t)}getEffectedCreatedAt(){return this.createdAt}toTestString(){return`${this.getParentCreatedAt().toTestString()}.ARRAY_SET.${this.createdAt.toTestString()}=${this.value.toSortedJSON()}`}getCreatedAt(){return this.createdAt}getValue(){return this.value}setCreatedAt(e){this.createdAt=e}}function c0(n){const e={};for(const[t,r]of Object.entries(n))e[t]=JSON.stringify(r);return fe(Fy,{data:e})}function u0(n){if(n.type===_r.Put)return fe(fh,{type:uo.PUT,presence:c0(n.presence)});if(n.type===_r.Clear)return fe(fh,{type:uo.CLEAR});throw new L(C.ErrUnimplemented,"unimplemented type")}function h0(n){return fe(Zy,{serverSeq:n.getServerSeq(),clientSeq:n.getClientSeq()})}function Ol(n){return fe(Ac,{clientSeq:n.getClientSeq(),lamport:n.getLamport(),actorId:Da(n.getActorID()),versionVector:Tc(n.getVersionVector())})}function me(n){if(n)return fe($y,{lamport:n.getLamport(),delimiter:n.getDelimiter(),actorId:Da(n.getActorID())})}function Tc(n){if(!n)return;const e=fe(Ec);for(const[t,r]of n){const s=q0(Da(t));e.vector[s]=BigInt(r.toString())}return e}function Xd(n){switch(n){case nt.Null:return De.NULL;case nt.Boolean:return De.BOOLEAN;case nt.Integer:return De.INTEGER;case nt.Long:return De.LONG;case nt.Double:return De.DOUBLE;case nt.String:return De.STRING;case nt.Bytes:return De.BYTES;case nt.Date:return De.DATE;default:throw new L(C.ErrInvalidType,`unsupported type: ${n}`)}}function Jd(n){switch(n){case Or.Int:return De.INTEGER_CNT;case Or.Long:return De.LONG_CNT;default:throw new L(C.ErrInvalidType,`unsupported type: ${n}`)}}function Zo(n){if(n instanceof tn)return fe(ti,{type:De.JSON_OBJECT,createdAt:me(n.getCreatedAt()),value:cg(n)});if(n instanceof nn)return fe(ti,{type:De.JSON_ARRAY,createdAt:me(n.getCreatedAt()),value:$0(n)});if(n instanceof An)return fe(ti,{type:De.TEXT,createdAt:me(n.getCreatedAt())});if(n instanceof bt)return fe(ti,{type:Xd(n.getType()),createdAt:me(n.getCreatedAt()),value:n.toBytes()});if(n instanceof vn)return fe(ti,{type:Jd(n.getType()),createdAt:me(n.getCreatedAt()),value:n.toBytes()});if(n instanceof Tn)return fe(ti,{type:De.TREE,createdAt:me(n.getCreatedAt()),value:j0(n)});throw new L(C.ErrUnimplemented,"unimplemented element")}function f0(n){return fe(Vy,{createdAt:me(n.getCreatedAt()),offset:n.getOffset()})}function Go(n){return fe(Gy,{createdAt:me(n.getID().getCreatedAt()),offset:n.getID().getOffset(),relativeOffset:n.getRelativeOffset()})}function $o(n){return fe(Wy,{parentId:Qi(n.getParentID()),leftSiblingId:Qi(n.getLeftSiblingID())})}function Qi(n){return fe(Uy,{createdAt:me(n.getCreatedAt()),offset:n.getOffset()})}function kl(n){const e=fe(Sc);if(n instanceof Ms){const t=n,r=fe(by);r.parentCreatedAt=me(t.getParentCreatedAt()),r.key=t.getKey(),r.value=Zo(t.getValue()),r.executedAt=me(t.getExecutedAt()),e.body.case="set",e.body.value=r}else if(n instanceof Is){const t=n,r=fe(yy);r.parentCreatedAt=me(t.getParentCreatedAt()),r.prevCreatedAt=me(t.getPrevCreatedAt()),r.value=Zo(t.getValue()),r.executedAt=me(t.getExecutedAt()),e.body.case="add",e.body.value=r}else if(n instanceof rr){const t=n,r=fe(vy);r.parentCreatedAt=me(t.getParentCreatedAt()),r.prevCreatedAt=me(t.getPrevCreatedAt()),r.createdAt=me(t.getCreatedAt()),r.executedAt=me(t.getExecutedAt()),e.body.case="move",e.body.value=r}else if(n instanceof Lr){const t=n,r=fe(Ay);r.parentCreatedAt=me(t.getParentCreatedAt()),r.createdAt=me(t.getCreatedAt()),r.executedAt=me(t.getExecutedAt()),e.body.case="remove",e.body.value=r}else if(n instanceof Es){const t=n,r=fe(Ey);r.parentCreatedAt=me(t.getParentCreatedAt()),r.from=Go(t.getFromPos()),r.to=Go(t.getToPos()),r.content=t.getContent();const s=r.attributes;for(const[i,o]of t.getAttributes())s[i]=o;r.executedAt=me(t.getExecutedAt()),e.body.case="edit",e.body.value=r}else if(n instanceof To){const t=n,r=fe(Sy);r.parentCreatedAt=me(t.getParentCreatedAt()),r.from=Go(t.getFromPos()),r.to=Go(t.getToPos());const s=r.attributes;for(const[i,o]of t.getAttributes())s[i]=o;r.executedAt=me(t.getExecutedAt()),e.body.case="style",e.body.value=r}else if(n instanceof Oi){const t=n,r=fe(Iy);r.parentCreatedAt=me(t.getParentCreatedAt()),r.value=Zo(t.getValue()),r.executedAt=me(t.getExecutedAt()),e.body.case="increase",e.body.value=r}else if(n instanceof xo){const t=n,r=fe(Ny);r.parentCreatedAt=me(t.getParentCreatedAt()),r.from=$o(t.getFromPos()),r.to=$o(t.getToPos()),r.contents=v0(t.getContents()),r.splitLevel=t.getSplitLevel(),r.executedAt=me(t.getExecutedAt()),e.body.case="treeEdit",e.body.value=r}else if(n instanceof $r){const t=n,r=fe(wy);r.parentCreatedAt=me(t.getParentCreatedAt()),r.from=$o(t.getFromPos()),r.to=$o(t.getToPos());const s=t.getAttributesToRemove();if(s.length>0)r.attributesToRemove=s;else{const i=r.attributes;for(const[o,a]of t.getAttributes())i[o]=a}r.executedAt=me(t.getExecutedAt()),e.body.case="treeStyle",e.body.value=r}else if(n instanceof jr){const t=n,r=fe(Ty);r.parentCreatedAt=me(t.getParentCreatedAt()),r.createdAt=me(t.getCreatedAt()),r.value=Zo(t.getValue()),r.executedAt=me(t.getExecutedAt()),e.body.case="arraySet",e.body.value=r}else throw new L(C.ErrUnimplemented,"unimplemented operation");return e}function d0(n){const e=[];for(const t of n)e.push(kl(t));return e}function g0(n){const e=fe(my,{id:Ol(n.getID()),message:n.getMessage()});return n.hasOperations()&&(e.operations=d0(n.getOperations())),n.hasPresenceChange()&&(e.presenceChange=u0(n.getPresenceChange())),e}function p0(n){const e=[];for(const t of n)e.push(g0(t));return e}function m0(n){const e=[];for(const t of n)e.push(fe(ky,{key:t.getStrKey(),element:Cc(t.getValue())}));return e}function b0(n){const e=[];for(const t of n)e.push(fe(Dy,{element:Cc(t.getValue())}));return e}function y0(n){const e=[];for(const t of n){const r=fe(By);r.id=f0(t.getID()),r.value=t.getValue().getContent(),r.removedAt=me(t.getRemovedAt());const s=r.attributes,i=t.getValue().getAttrs();for(const o of i){const a=fe(Bd);a.value=o.getValue(),a.updatedAt=me(o.getUpdatedAt()),s[o.getKey()]=a}e.push(r)}return e}function v0(n){const e=[];if(!n||!n.length)return e;for(const t of n)e.push(fe(My,{content:xc(t)}));return e}function A0(n){const e={};for(const t of n)e[t.getKey()]=fe(Bd,{value:t.getValue(),updatedAt:me(t.getUpdatedAt()),isRemoved:t.isRemoved()});return e}function xc(n){if(!n)return[];const e=[];return La(n,(t,r)=>{const s=fe(Py,{id:Qi(t.id),type:t.type,removedAt:me(t.removedAt),depth:r});t.isText&&(s.value=t.value),t.insPrevID&&(s.insPrevId=Qi(t.insPrevID)),t.insNextID&&(s.insNextId=Qi(t.insNextID)),t.attrs&&(s.attributes=A0(t.attrs)),e.push(s)}),e}function E0(n){return fe($n,{body:{case:"jsonObject",value:fe(xy,{nodes:m0(n.getRHT()),createdAt:me(n.getCreatedAt()),movedAt:me(n.getMovedAt()),removedAt:me(n.getRemovedAt())})}})}function Hd(n){return fe($n,{body:{case:"jsonArray",value:fe(Cy,{nodes:b0(n.getElements()),createdAt:me(n.getCreatedAt()),movedAt:me(n.getMovedAt()),removedAt:me(n.getRemovedAt())})}})}function S0(n){return fe($n,{body:{case:"primitive",value:fe(Ry,{type:Xd(n.getType()),value:n.toBytes(),createdAt:me(n.getCreatedAt()),movedAt:me(n.getMovedAt()),removedAt:me(n.getRemovedAt())})}})}function I0(n){return fe($n,{body:{case:"text",value:fe(_y,{nodes:y0(n.getRGATreeSplit()),createdAt:me(n.getCreatedAt()),movedAt:me(n.getMovedAt()),removedAt:me(n.getRemovedAt())})}})}function N0(n){return fe($n,{body:{case:"counter",value:fe(Ly,{type:Jd(n.getType()),value:n.toBytes(),createdAt:me(n.getCreatedAt()),movedAt:me(n.getMovedAt()),removedAt:me(n.getRemovedAt())})}})}function Qd(n){return fe($n,{body:{case:"tree",value:fe(Oy,{nodes:xc(n.getRoot()),createdAt:me(n.getCreatedAt()),movedAt:me(n.getMovedAt()),removedAt:me(n.getRemovedAt())})}})}function Cc(n){if(n instanceof tn)return E0(n);if(n instanceof nn)return Hd(n);if(n instanceof bt)return S0(n);if(n instanceof An)return I0(n);if(n instanceof vn)return N0(n);if(n instanceof Tn)return Qd(n);throw new L(C.ErrUnimplemented,"unimplemented element")}function w0(n){return fe(py,{documentKey:n.getDocumentKey(),checkpoint:h0(n.getCheckpoint()),isRemoved:n.getIsRemoved(),changes:p0(n.getChanges()),snapshot:n.getSnapshot(),versionVector:Tc(n.getVersionVector())})}function T0(n){return{id:n.id,label:n.label,description:n.description,snapshot:n.snapshot,createdAt:n.createdAt?Pm(n.createdAt):new Date}}function Ki(n){if(!(n instanceof He))return{};const e=n.findDetails(qy);for(const t of e)return t.metadata;return{}}function si(n){return Ki(n).code??""}function tl(n,e){return n instanceof He&&si(n)===e}function eg(n){return Jn.of(n.clientSeq,BigInt(n.lamport),kc(n.actorId),Rc(n.versionVector),BigInt(n.serverSeq))}function Rc(n){if(!n)return;const e=new pi;return Object.entries(n.vector).forEach(([t,r])=>{const s=ka(Y0(t));e.set(s,BigInt(r.toString()))}),e}function ye(n){if(n)return Fn.of(BigInt(n.lamport),n.delimiter,kc(n.actorId))}function _c(n){const e={};return Object.entries(n.data).forEach(([t,r])=>{e[t]=JSON.parse(r)}),e}function x0(n){const e=n.type;if(e===uo.PUT){const t=_c(n.presence);return{type:_r.Put,presence:t}}if(e===uo.CLEAR)return{type:_r.Clear};throw new L(C.ErrInvalidType,`unsupported type: ${e}`)}function C0(n){const e=new Map;return Object.entries(n).forEach(([t,r])=>{e.set(t,_c(r))}),e}function tg(n){switch(n){case De.NULL:return nt.Null;case De.BOOLEAN:return nt.Boolean;case De.INTEGER:return nt.Integer;case De.LONG:return nt.Long;case De.DOUBLE:return nt.Double;case De.STRING:return nt.String;case De.BYTES:return nt.Bytes;case De.DATE:return nt.Date}throw new L(C.ErrUnimplemented,`unimplemented value type: ${n}`)}function ya(n){switch(n){case De.INTEGER_CNT:return Or.Int;case De.LONG_CNT:return Or.Long}throw new L(C.ErrUnimplemented,`unimplemented value type: ${n}`)}function Ko(n){switch(n.type){case De.JSON_OBJECT:return n.value?lg(n.value):tn.create(ye(n.createdAt));case De.JSON_ARRAY:return n.value?G0(n.value):nn.create(ye(n.createdAt));case De.TEXT:return An.create(Ri.create(),ye(n.createdAt));case De.TREE:return K0(n.value);case De.NULL:case De.BOOLEAN:case De.INTEGER:case De.LONG:case De.DOUBLE:case De.STRING:case De.BYTES:case De.DATE:return bt.of(bt.valueFromBytes(tg(n.type),n.value),ye(n.createdAt));case De.INTEGER_CNT:case De.LONG_CNT:return vn.create(ya(n.type),vn.valueFromBytes(ya(n.type),n.value),ye(n.createdAt))}}function jo(n){return $t.of(xr.of(ye(n.createdAt),n.offset),n.relativeOffset)}function ng(n){return xr.of(ye(n.createdAt),n.offset)}function R0(n){const e=go.create(n.value);Object.entries(n.attributes).forEach(([r,s])=>{e.setAttr(r,s.value,ye(s.updatedAt))});const t=ms.create(ng(n.id),e);return t.setRemovedAt(ye(n.removedAt)),t}function ni(n){return sr.of(eo(n.parentId),eo(n.leftSiblingId))}function eo(n){return jt.of(ye(n.createdAt),n.offset)}function _0(n){if(!n.length)return;const e=[];return n.forEach(t=>{const r=Lc(t.content);e.push(r)}),e}function Lc(n){if(n.length===0)return;const e=[];for(const s of n)e.push(O0(s));const t=e[e.length-1],r=new Map;r.set(n[e.length-1].depth,e[e.length-1]);for(let s=e.length-2;s>=0;s--)r.get(n[s].depth-1).prepend(e[s]),r.set(n[s].depth,e[s]);return t.updateDescendantsSize(),t.updateDescendantsSize(!0),Tn.create(t,Ti).getRoot()}function L0(n){const e=Kr.create();for(const[t,r]of Object.entries(n))e.setInternal(t,r.value,ye(r.updatedAt),r.isRemoved);return e}function O0(n){const e=eo(n.id),t=In.create(e,n.type),r=Object.entries(n.attributes);return t.isText?t.value=n.value:r.length&&(t.attrs=L0(n.attributes)),n.insPrevId&&(t.insPrevID=eo(n.insPrevId)),n.insNextId&&(t.insNextID=eo(n.insNextId)),t.removedAt=ye(n.removedAt),t}function rg(n){if(n.body.case==="set"){const e=n.body.value;return Ms.create(e.key,Ko(e.value),ye(e.parentCreatedAt),ye(e.executedAt))}else if(n.body.case==="add"){const e=n.body.value;return Is.create(ye(e.parentCreatedAt),ye(e.prevCreatedAt),Ko(e.value),ye(e.executedAt))}else if(n.body.case==="move"){const e=n.body.value;return rr.create(ye(e.parentCreatedAt),ye(e.prevCreatedAt),ye(e.createdAt),ye(e.executedAt))}else if(n.body.case==="remove"){const e=n.body.value;return Lr.create(ye(e.parentCreatedAt),ye(e.createdAt),ye(e.executedAt))}else if(n.body.case==="edit"){const e=n.body.value,t=new Map;return Object.entries(e.attributes).forEach(([r,s])=>{t.set(r,s)}),Es.create(ye(e.parentCreatedAt),jo(e.from),jo(e.to),e.content,t,ye(e.executedAt))}else if(n.body.case==="style"){const e=n.body.value,t=new Map;return Object.entries(e.attributes).forEach(([r,s])=>{t.set(r,s)}),To.create(ye(e.parentCreatedAt),jo(e.from),jo(e.to),t,ye(e.executedAt))}else if(n.body.case==="increase"){const e=n.body.value;return Oi.create(ye(e.parentCreatedAt),Ko(e.value),ye(e.executedAt))}else if(n.body.case==="treeEdit"){const e=n.body.value;return xo.create(ye(e.parentCreatedAt),ni(e.from),ni(e.to),_0(e.contents),e.splitLevel,ye(e.executedAt))}else if(n.body.case==="treeStyle"){const e=n.body.value,t=new Map,r=e.attributesToRemove;return r?.length>0?$r.createTreeRemoveStyleOperation(ye(e.parentCreatedAt),ni(e.from),ni(e.to),r,ye(e.executedAt)):(Object.entries(e.attributes).forEach(([s,i])=>{t.set(s,i)}),$r.create(ye(e.parentCreatedAt),ni(e.from),ni(e.to),t,ye(e.executedAt)))}else if(n.body.case==="arraySet"){const e=n.body.value;return jr.create(ye(e.parentCreatedAt),ye(e.createdAt),Ko(e.value),ye(e.executedAt))}else throw new L(C.ErrUnimplemented,"unimplemented operation")}function k0(n){const e=[];for(const t of n){const r=rg(t);r&&e.push(r)}return e}function sg(n){const e=[];for(const t of n)e.push(Li.create({id:eg(t.id),operations:k0(t.operations),presenceChange:t.presenceChange?x0(t.presenceChange):void 0,message:t.message}));return e}function D0(n){return mi.of(BigInt(n.serverSeq),n.clientSeq)}function B0(n){return Oa.create(n.documentKey,D0(n.checkpoint),n.isRemoved,sg(n.changes),Rc(n.versionVector),n.snapshot)}function ig(n){const e=new xi;for(const r of n.nodes){const s=Oc(r.element);e.set(r.key,s,s.getPositionedAt())}const t=new tn(ye(n.createdAt),e);return t.setMovedAt(ye(n.movedAt)),t.setRemovedAt(ye(n.removedAt)),t}function og(n){const e=new fo;for(const r of n.nodes)e.insert(Oc(r.element));const t=new nn(ye(n.createdAt),e);return t.setMovedAt(ye(n.movedAt)),t.setRemovedAt(ye(n.removedAt)),t}function V0(n){const e=bt.of(bt.valueFromBytes(tg(n.type),n.value),ye(n.createdAt));return e.setMovedAt(ye(n.movedAt)),e.setRemovedAt(ye(n.removedAt)),e}function P0(n){const e=new Ri;let t=e.getHead();for(const s of n.nodes){const i=e.insertAfter(t,R0(s));s.insPrevId&&i.setInsPrev(e.findNode(ng(s.insPrevId))),t=i}const r=new An(e,ye(n.createdAt));return r.setMovedAt(ye(n.movedAt)),r.setRemovedAt(ye(n.removedAt)),r}function M0(n){const e=vn.create(ya(n.type),vn.valueFromBytes(ya(n.type),n.value),ye(n.createdAt));return e.setMovedAt(ye(n.movedAt)),e.setRemovedAt(ye(n.removedAt)),e}function ag(n){const e=Lc(n.nodes);return Tn.create(e,ye(n.createdAt))}function Oc(n){if(n.body.case==="jsonObject")return ig(n.body.value);if(n.body.case==="jsonArray")return og(n.body.value);if(n.body.case==="primitive")return V0(n.body.value);if(n.body.case==="text")return P0(n.body.value);if(n.body.case==="counter")return M0(n.body.value);if(n.body.case==="tree")return ag(n.body.value);throw new L(C.ErrUnimplemented,"unimplemented element")}function U0(n){return n.map(e=>({path:e.path,type:e.type}))}function W0(n){if(!n)return{root:tn.create(Ti),presences:new Map};const e=Gn(gy,n);return{root:Oc(e.root),presences:C0(e.presences)}}function F0(n){const e=Tc(n);return ka(As(Ec,e))}function Z0(n){const e=Dc(n),t=Gn(Ec,e);return Rc(t)}function lg(n){if(!n)throw new L(C.ErrInvalidArgument,"bytes is empty");const e=Gn($n,n);return ig(e.body.value)}function cg(n){return As($n,Cc(n))}function G0(n){if(!n)throw new L(C.ErrInvalidArgument,"bytes is empty");const e=Gn($n,n);return og(e.body.value)}function $0(n){return As($n,Hd(n))}function K0(n){if(!n)throw new L(C.ErrInvalidArgument,"bytes is empty");const e=Gn($n,n);return ag(e.body.value)}function j0(n){return As($n,Qd(n))}function ka(n){return n?Array.from(n).map(e=>e.toString(16).padStart(2,"0")).join(""):""}function kc(n){return ka(n)}function Dc(n){return new Uint8Array(n.match(/.{1,2}/g).map(e=>parseInt(e,16)))}function Y0(n){if(typeof window<"u"&&typeof window.atob=="function"){const e=window.atob(n),t=e.length,r=new Uint8Array(t);for(let s=0;s<t;s++)r[s]=e.charCodeAt(s);return r}else if(typeof globalThis<"u"&&typeof globalThis.Buffer<"u"){const e=globalThis.Buffer;return new Uint8Array(e.from(n,"base64"))}else throw new Error("No base64 decoder available")}function Da(n){return Dc(n)}function q0(n){if(typeof window<"u"&&typeof window.btoa=="function"){let e="";for(let t=0;t<n.byteLength;t++)e+=String.fromCharCode(n[t]);return window.btoa(e)}else{if(typeof globalThis<"u"&&typeof globalThis.Buffer<"u")return globalThis.Buffer.from(n).toString("base64");throw new Error("No base64 encoder available")}}function z0(n){const e=Gn(Ac,n);return eg(e)}function X0(n){const e=Gn(Sc,n);return rg(e)}const ut={fromPresence:_c,toChangePack:w0,fromChangePack:B0,fromChanges:sg,toTreeNodes:xc,fromTreeNodes:Lc,objectToBytes:cg,bytesToObject:lg,bytesToSnapshot:W0,bytesToHex:ka,hexToBytes:Dc,toHexString:kc,toUint8Array:Da,toOperation:kl,toChangeID:Ol,bytesToChangeID:z0,bytesToOperation:X0,versionVectorToHex:F0,hexToVersionVector:Z0,fromSchemaRules:U0,toRevisionSummary:T0,changeIDToBinary:n=>As(Ac,Ol(n)),operationToBinary:n=>As(Sc,kl(n))};var mn=(n=>(n[n.Trivial=0]="Trivial",n[n.Debug=1]="Debug",n[n.Info=2]="Info",n[n.Warn=3]="Warn",n[n.Error=4]="Error",n[n.Fatal=5]="Fatal",n))(mn||{});let _s=3;function J0(n){_s=n}const ee={trivial:(...n)=>{_s>0||typeof console<"u"&&console.log("YORKIE T:",...n)},debug:(...n)=>{_s>1||typeof console<"u"&&console.log("YORKIE D:",...n)},info:(...n)=>{_s>2||typeof console<"u"&&console.log("YORKIE I:",...n)},warn:(...n)=>{_s>3||typeof console<"u"&&(typeof console.warn<"u"?console.warn("YORKIE W:",...n):console.log("YORKIE W:",...n))},error:(...n)=>{_s>4||typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE E:",...n):console.log("YORKIE E:",...n))},fatal:(...n)=>{typeof console<"u"&&(typeof console.error<"u"?console.error("YORKIE F:",...n):console.log("YORKIE F:",...n))},isEnabled:n=>_s<=n};function ug(){return"xxxxxxxx-xxxx-4xxxy-xxxx-xxxxxxxxxxx".replace(/[xy]/g,n=>{const e=Math.random()*16|0;return(n==="x"?e:e&3|8).toString(16)})}const nl=()=>{};class H0{finalized=!1;observers=[];finalError;constructor(e){try{e(this)}catch(t){this.error(t)}}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(!e)throw new L(C.ErrInvalidArgument,"missing observer");if(this.finalized)throw new L(C.ErrRefused,"observable is finalized due to previous error");typeof e=="object"?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=nl),s.error===void 0&&(s.error=nl),s.complete===void 0&&(s.complete=nl);const i=ug(),o=this.unsubscribeOne.bind(this,i);if(this.observers.push({subscriptionID:i,observer:s}),this.finalized)try{this.finalError?s.error(this.finalError):s.complete()}catch(a){ee.warn(a)}return o}unsubscribeOne(e){this.observers=this.observers?.filter(t=>t.subscriptionID!==e)}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e].observer)}catch(r){ee.error(r)}}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.observers=void 0)}}function hg(n){const e=new H0(n);return{subscribe:e.subscribe.bind(e),getProxy:()=>e}}class to{prevID;nextID;delimiter;message;root;operations;presenceChange;previousPresence;reversePresenceKeys;constructor(e,t,r,s){this.prevID=e,this.nextID=e.next(),this.delimiter=Pd,this.root=t,this.operations=[],this.previousPresence=Xn(r),this.presenceChange=void 0,this.reversePresenceKeys=new Set,this.message=s}static create(e,t,r,s){return new to(e,t,r,s)}push(e){this.operations.push(e)}registerElement(e,t){this.root.registerElement(e,t)}registerRemovedElement(e){this.root.registerRemovedElement(e)}registerGCPair(e){this.root.registerGCPair(e)}getNextID(){return this.isPresenceOnlyChange()?this.prevID.next(!0).setLamport(this.prevID.getLamport()).setVersionVector(this.prevID.getVersionVector()):this.nextID}toChange(){const e=this.isPresenceOnlyChange()?this.prevID.next(!0):this.nextID;return Li.create({id:e,operations:this.operations,presenceChange:this.presenceChange,message:this.message})}isPresenceOnlyChange(){return this.operations.length===0}hasChange(){return this.operations.length>0||this.presenceChange!==void 0}setPresenceChange(e){this.presenceChange=e}setReversePresence(e,t){for(const r of Object.keys(e))t?.addToHistory?this.reversePresenceKeys.add(r):this.reversePresenceKeys.delete(r)}getReversePresence(){if(this.reversePresenceKeys.size===0)return;const e={};for(const t of this.reversePresenceKeys)e[t]=this.previousPresence[t];return e}issueTimeTicket(){return this.delimiter+=1,this.nextID.createTimeTicket(this.delimiter)}getLastTimeTicket(){return this.nextID.createTimeTicket(this.delimiter)}acc(e){this.root.acc(e)}}function fg(n,e){const t=new po(n);return new Proxy(e,t.getHandlers())}class po{context;handlers;constructor(e){this.context=e,this.handlers={set:(t,r,s)=>(ee.isEnabled(mn.Trivial)&&ee.trivial(`obj[${r}]=${JSON.stringify(s)}`),po.setInternal(e,t,r,s),!0),get:(t,r)=>(ee.isEnabled(mn.Trivial)&&ee.trivial(`obj[${r}]`),r==="getID"?()=>t.getCreatedAt():r==="toJSON"||r==="toString"?()=>t.toJSON():r==="toJS"?()=>t.toJS():r==="toJSForTest"?()=>t.toJSForTest():Ls(e,t.get(r))),ownKeys:t=>t.getKeys(),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),deleteProperty:(t,r)=>(ee.isEnabled(mn.Trivial)&&ee.trivial(`obj[${r}]`),po.deleteInternal(e,t,r),!0)}}static setInternal(e,t,r,s){if(r.includes("."))throw new L(C.ErrInvalidObjectKey,"key must not contain the '.'.");const i=e.issueTimeTicket(),o=no(e,s,i),a=t.set(r,o,i);e.registerElement(o,t),a&&e.registerRemovedElement(a),e.push(Ms.create(r,o.deepcopy(),t.getCreatedAt(),i))}static buildObjectMembers(e,t){const r={};for(const[s,i]of Object.entries(t)){if(s.includes("."))throw new L(C.ErrInvalidObjectKey,"key must not contain the '.'.");const o=e.issueTimeTicket(),a=no(e,i,o);r[s]=a}return r}static deleteInternal(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByKey(r,s);i&&(e.push(Lr.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i))}getHandlers(){return this.handlers}}function Q0(n,e){const t=new ze(n,e);return new Proxy(e,t.getHandlers())}function Eh(n){return typeof n=="string"||n instanceof String?!isNaN(n):!1}function ev(n){return["concat","entries","every","filter","find","findIndex","forEach","join","keys","map","reduce","reduceRight","slice","some","toLocaleString","toString","values"].includes(n)}class ze{context;handlers;array;constructor(e,t){this.context=e,this.array=t,this.handlers={get:(r,s,i)=>s==="getID"?()=>r.getCreatedAt():s==="getElementByID"?o=>{const a=r.getByID(o);if(!(!a||a.isRemoved()))return qn(e,a)}:s==="getElementByIndex"?o=>{const a=r.get(o);return qn(e,a)}:s==="getLast"?()=>qn(e,r.getLast()):s==="delete"?o=>{const a=ze.deleteInternalByIndex(e,r,o);return qn(e,a)}:s==="deleteByID"?o=>{const a=ze.deleteInternalByID(e,r,o);return qn(e,a)}:s==="insertAfter"?(o,a)=>{const l=ze.insertAfterInternal(e,r,o,a);return qn(e,l)}:s==="insertIntegerAfter"?(o,a)=>{const l=ze.insertIntegerAfterInternal(e,r,o,a);return qn(e,l)}:s==="insertBefore"?(o,a)=>{const l=ze.insertBeforeInternal(e,r,o,a);return qn(e,l)}:s==="setValue"?(o,a)=>{const l=ze.setValueInternal(e,r,o,a);return qn(e,l)}:s==="moveBefore"?(o,a)=>{ze.moveBeforeInternal(e,r,o,a)}:s==="moveAfter"?(o,a)=>{ze.moveAfterInternal(e,r,o,a)}:s==="moveAfterByIndex"?(o,a)=>{ze.moveAfterByIndexInternal(e,r,o,a)}:s==="moveFront"?o=>{ze.moveFrontInternal(e,r,o)}:s==="moveLast"?o=>{ze.moveLastInternal(e,r,o)}:Eh(s)?Ls(e,r.get(Number(s))):s==="push"?o=>ze.pushInternal(e,r,o):s==="splice"?(o,a,...l)=>ze.splice(e,r,o,a,...l):s==="length"?r.length:typeof s=="symbol"&&s===Symbol.iterator?ze.iteratorInternal.bind(this,e,r):s==="includes"?(o,a)=>ze.includes(e,r,o,a):s==="indexOf"?(o,a)=>ze.indexOf(e,r,o,a):s==="lastIndexOf"?(o,a)=>ze.lastIndexOf(e,r,o,a):s==="toJSForTest"?()=>r.toJSForTest():s==="toTestString"?()=>ze.toTestString(r):typeof s=="string"&&ev(s)?(...o)=>{const a=Array.from(r).map(l=>Ls(e,l));return Array.prototype[s].apply(a,o)}:Reflect.get(r,s,i),set:(r,s,i)=>{if(Eh(s)){const o=Number(s);return ze.setValueInternal(e,r,o,i),!0}return Reflect.set(r,s,i)},deleteProperty:(r,s)=>(ee.isEnabled(mn.Trivial)&&ee.trivial(`array[${s}]`),ze.deleteInternalByIndex(e,r,Number.parseInt(s)),!0)}}static*iteratorInternal(e,t){for(const r of t)yield qn(e,r)}static buildArrayElements(e,t){const r=[];for(const s of t){const i=e.issueTimeTicket(),o=no(e,s,i);r.push(o)}return r}static pushInternal(e,t,r){return ze.insertAfterInternal(e,t,t.getLastCreatedAt(),r),t.length}static moveBeforeInternal(e,t,r,s){const i=e.issueTimeTicket(),o=t.getPrevCreatedAt(r);t.moveAfter(o,s,i),e.push(rr.create(t.getCreatedAt(),o,s,i))}static moveAfterInternal(e,t,r,s){const i=e.issueTimeTicket();e.push(rr.create(t.getCreatedAt(),r,s,i)),t.moveAfter(r,s,i)}static moveAfterByIndexInternal(e,t,r,s){const i=t.get(r);if(!i)throw new L(C.ErrInvalidArgument,`index out of bounds: ${r}`);const o=t.get(s);if(!o)throw new L(C.ErrInvalidArgument,`index out of bounds: ${s}`);ze.moveAfterInternal(e,t,i.getCreatedAt(),o.getCreatedAt())}static moveFrontInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getHead();t.moveAfter(i.getCreatedAt(),r,s),e.push(rr.create(t.getCreatedAt(),i.getCreatedAt(),r,s))}static moveLastInternal(e,t,r){const s=e.issueTimeTicket(),i=t.getLastCreatedAt();t.moveAfter(i,r,s),e.push(rr.create(t.getCreatedAt(),i,r,s))}static insertAfterInternal(e,t,r,s){const i=e.issueTimeTicket(),o=no(e,s,i);return t.insertAfter(r,o),e.registerElement(o,t),e.push(Is.create(t.getCreatedAt(),r,o.deepcopy(),i)),o}static insertIntegerAfterInternal(e,t,r,s){const i=t.get(r);if(!i)throw new L(C.ErrInvalidArgument,`index out of bounds: ${r}`);return ze.insertAfterInternal(e,t,i.getCreatedAt(),s),t}static insertBeforeInternal(e,t,r,s){return ze.insertAfterInternal(e,t,t.getPrevCreatedAt(r),s)}static setValueInternal(e,t,r,s){const i=t.get(r);if(!i)throw new L(C.ErrInvalidArgument,`index out of bounds: ${r}`);return ze.setByIndexInternal(e,t,i.getCreatedAt(),s),t}static setByIndexInternal(e,t,r,s){const i=e.issueTimeTicket(),o=no(e,s,i),a=o.deepcopy();return e.push(jr.create(t.getCreatedAt(),r,a,i)),t.set(r,o,i),e.registerElement(o,t),o}static deleteInternalByIndex(e,t,r){const s=e.issueTimeTicket(),i=t.deleteByIndex(r,s);if(i)return e.push(Lr.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static deleteInternalByID(e,t,r){const s=e.issueTimeTicket(),i=t.delete(r,s);return e.push(Lr.create(t.getCreatedAt(),i.getCreatedAt(),s)),e.registerRemovedElement(i),i}static splice(e,t,r,s,...i){const o=t.length,a=r>=0?Math.min(r,o):Math.max(o+r,0),l=s===void 0?o:s<0?a:Math.min(a+s,o),c=[];for(let f=a;f<l;f++){const g=ze.deleteInternalByIndex(e,t,a);if(g){const h=g.deepcopy();h.setRemovedAt(),c.push(Ls(e,h))}}if(i){let f=a===0?t.getHead().getID():t.get(a-1).getID();for(const g of i)f=ze.insertAfterInternal(e,t,f,g).getID()}return c}static includes(e,t,r,s){const i=t.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return!1;if(bt.isSupport(r))return Array.from(t).map(l=>Ls(e,l)).includes(r,o);for(let a=o;a<i;a++)if(t.get(a)?.getID()===r.getID())return!0;return!1}static indexOf(e,t,r,s){const i=t.length,o=s===void 0?0:s<0?Math.max(s+i,0):s;if(o>=i)return-1;if(bt.isSupport(r))return Array.from(t).map(l=>Ls(e,l)).indexOf(r,o);for(let a=o;a<i;a++)if(t.get(a)?.getID()===r.getID())return a;return-1}static lastIndexOf(e,t,r,s){const i=t.length,o=s===void 0||s>=i?i-1:s<0?s+i:s;if(o<0)return-1;if(bt.isSupport(r))return Array.from(t).map(l=>Ls(e,l)).lastIndexOf(r,o);for(let a=o;a>0;a--)if(t.get(a)?.getID()===r.getID())return a;return-1}static toTestString(e){return e.toTestString()}getHandlers(){return this.handlers}}let Ba=class{context;text;constructor(e,t){this.context=e,this.text=t}initialize(e,t){this.context=e,this.text=t}getID(){return this.text.getID()}edit(e,t,r,s){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new L(C.ErrInvalidArgument,"from should be less than or equal to to");const i=this.text.indexRangeToPosRange(e,t);ee.isEnabled(mn.Debug)&&ee.debug(`EDIT: f:${e}->${i[0].toTestString()}, t:${t}->${i[1].toTestString()} c:${r}`);const o=s?_i(s):void 0,a=this.context.issueTimeTicket(),[,l,c,f]=this.text.edit(i,r,a,o);this.context.acc(c);for(const g of l)this.context.registerGCPair(g);return this.context.push(new Es(this.text.getCreatedAt(),i[0],i[1],r,o?new Map(Object.entries(o)):new Map,a)),this.text.findIndexesFromRange(f)}delete(e,t){return this.edit(e,t,"")}empty(){return this.edit(0,this.length,"")}setStyle(e,t,r){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");if(e>t)throw new L(C.ErrInvalidArgument,"from should be less than or equal to to");const s=this.text.indexRangeToPosRange(e,t);ee.isEnabled(mn.Debug)&&ee.debug(`STYL: f:${e}->${s[0].toTestString()}, t:${t}->${s[1].toTestString()} a:${JSON.stringify(r)}`);const i=_i(r),o=this.context.issueTimeTicket(),[a,l]=this.text.setStyle(s,i,o);this.context.acc(l);for(const c of a)this.context.registerGCPair(c);return this.context.push(new To(this.text.getCreatedAt(),s[0],s[1],new Map(Object.entries(i)),o)),!0}indexRangeToPosRange(e){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");const t=this.text.indexRangeToPosRange(e[0],e[1]);return[t[0].toStruct(),t[1].toStruct()]}posRangeToIndexRange(e){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");const t=this.text.findIndexesFromRange([$t.fromStruct(e[0]),$t.fromStruct(e[1])]);return[t[0],t[1]]}toTestString(){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");return this.text.toTestString()}values(){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");return this.text.values()}get length(){return this.text.length}getTreeByIndex(){return this.text.getTreeByIndex()}getTreeByID(){return this.text.getTreeByID()}toString(){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");return this.text.toString()}toJSON(){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSON()}toJSForTest(){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");return this.text.toJSForTest()}createRangeForTest(e,t){if(!this.context||!this.text)throw new L(C.ErrNotInitialized,"Text is not initialized yet");return this.text.indexRangeToPosRange(e,t)}};class Bc{valueType;value;context;counter;constructor(e,t){this.valueType=e,this.value=t}initialize(e,t){this.valueType=t.getValueType(),this.context=e,this.counter=t,this.value=t.getValue()}getID(){return this.counter.getID()}getValue(){return this.value}getValueType(){return this.valueType}increase(e){if(!this.context||!this.counter)throw new L(C.ErrNotInitialized,"Counter is not initialized yet");const t=this.context.issueTimeTicket(),r=bt.of(e,t);if(!r.isNumericType())throw new TypeError(`Unsupported type of value: ${typeof r.getValue()}`);return this.counter.increase(r),this.context.push(Oi.create(this.counter.getCreatedAt(),r,t)),this}toJSForTest(){if(!this.context||!this.counter)throw new L(C.ErrNotInitialized,"Counter is not initialized yet");return this.counter.toJSForTest()}}function Vc(n){if(n.isText)return{type:n.type,value:n.value};const e={type:n.type,children:n.children.map(t=>Vc(t))};return n.attrs&&(e.attributes=Gr(n.attrs.toObject())),e}function tv(n,e){const t={type:n.isText?n.parent.type:n.type,children:n.isText?n.parent.getChildrenText().length===e?[]:[{type:Cr,value:n.parent.getChildrenText().slice(e)}]:n.children.slice(e).map(r=>Vc(r))};return n.attrs?t.attributes=Gr(n.attrs.toObject()):n.isText&&n.parent.attrs&&(t.attributes=Gr(n.parent.attrs.toObject())),t}function nv(n,e){const{node:t}=n,r=[...e].slice(0,-1),s=t.isText?t.parent.getChildrenText().length:t.children.length,i=[...r,s],o=[...r],a=[];o[o.length-1]+=1,e.every((c,f)=>c===i[f])||a.push({fromPath:[...e],toPath:i});const l=tv(t,e[e.length-1]);return l&&a.push({fromPath:o,toPath:o,content:l}),a}function rv(n,e){const{node:t,offset:r}=n,s=t.children[r],i=t.children[r-1],{children:o}=s,a=[...e].slice(0,-1),l=[{fromPath:[...e],toPath:[...a,r+1]}];if(!s.children.length)return l;const c=[...a,r-1,i.hasTextChild()?i.getChildrenText().length:i.children.length],f=o.map(g=>Vc(g));return l.push({fromPath:c,toPath:c,content:f}),l}function Pc(n,e,t){const{type:r}=n,s=t.issueTimeTicket();if(r===Cr){dg(n);const{value:i}=n,o=In.create(jt.of(s,0),r,i);e.append(o)}else{const{children:i=[]}=n,{attributes:o}=n;let a;if(typeof o=="object"&&!$d(o)){const c=_i(o);a=new Kr;for(const[f,g]of Object.entries(c))a.set(f,g,s)}const l=In.create(jt.of(s,0),r,void 0,a);e.append(l);for(const c of i)Pc(c,l,t)}}function sv(n,e){const{type:t}=e,r=n.issueTimeTicket();let s;if(e.type===Cr){const{value:i}=e;s=In.create(jt.of(r,0),t,i)}else if(e){const{children:i=[]}=e,{attributes:o}=e;let a;if(typeof o=="object"&&!$d(o)){const l=_i(o);a=new Kr;for(const[c,f]of Object.entries(l))a.set(c,f,r)}s=In.create(jt.of(n.issueTimeTicket(),0),t,void 0,a);for(const l of i)Pc(l,s,n)}return s}function dg(n){if(!n.value.length)throw new L(C.ErrInvalidArgument,"text node cannot have empty value");return!0}function Sh(n){if(!n.length)return!0;if(n[0].type===Cr)for(const t of n){const{type:r}=t;if(r!==Cr)throw new L(C.ErrInvalidArgument,"element node and text node cannot be passed together");dg(t)}else for(const t of n){const{type:r}=t;if(r===Cr)throw new L(C.ErrInvalidArgument,"element node and text node cannot be passed together")}return!0}class Mc{initialRoot;context;tree;constructor(e){this.initialRoot=e}initialize(e,t){this.context=e,this.tree=t}getID(){return this.tree.getID()}buildRoot(e){if(!this.initialRoot)return In.create(jt.of(e.issueTimeTicket(),0),n0);const t=In.create(jt.of(e.issueTimeTicket(),0),this.initialRoot.type);for(const r of this.initialRoot.children)Pc(r,t,e);return t}getSize(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getSize()}getNodeSize(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getNodeSize()}getIndexTree(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getIndexTree()}splitByPath(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new L(C.ErrInvalidArgument,"path should not be empty");const t=this.tree.pathToTreePos(e),r=nv(t,e);for(const s of r){const{fromPath:i,toPath:o,content:a}=s,l=this.tree.pathToPos(i),c=this.tree.pathToPos(o);this.editInternal(l,c,a?[a]:[],0)}}mergeByPath(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new L(C.ErrInvalidArgument,"path should not be empty");const t=this.tree.pathToTreePos(e);if(t.node.isText)throw new L(C.ErrInvalidArgument,"text node cannot be merged");const r=rv(t,e);for(const s of r){const{fromPath:i,toPath:o,content:a}=s,l=this.tree.pathToPos(i),c=this.tree.pathToPos(o);this.editInternal(l,c,a??[],0)}}styleByPath(e,t){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(!e.length)throw new L(C.ErrInvalidArgument,"path should not be empty");const[r,s]=this.tree.pathToPosRange(e),i=this.context.issueTimeTicket(),o=t?_i(t):void 0,[a,,l]=this.tree.style([r,s],o,i);this.context.acc(l);for(const c of a)this.context.registerGCPair(c);this.context.push($r.create(this.tree.getCreatedAt(),r,s,o?new Map(Object.entries(o)):new Map,i))}style(e,t,r){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new L(C.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),a=r?_i(r):void 0,[l,,c]=this.tree.style([s,i],a,o);this.context.acc(c);for(const f of l)this.context.registerGCPair(f);this.context.push($r.create(this.tree.getCreatedAt(),s,i,a?new Map(Object.entries(a)):new Map,o))}removeStyle(e,t,r){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new L(C.ErrInvalidArgument,"from should be less than or equal to to");const s=this.tree.findPos(e),i=this.tree.findPos(t),o=this.context.issueTimeTicket(),[a,,l]=this.tree.removeStyle([s,i],r,o);this.context.acc(l);for(const c of a)this.context.registerGCPair(c);this.context.push($r.createTreeRemoveStyleOperation(this.tree.getCreatedAt(),s,i,r,o))}editInternal(e,t,r,s=0){if(r.length!==0&&r[0]&&(Sh(r),r[0].type!==Cr))for(const c of r){const{children:f=[]}=c;Sh(f)}const i=this.context.getLastTimeTicket();let o=new Array;if(r[0]?.type===Cr){let c="";for(const f of r){const{value:g}=f;c+=g}o.push(In.create(jt.of(this.context.issueTimeTicket(),0),Cr,c))}else o=r.map(c=>c&&sv(this.context,c)).filter(c=>c);const[,a,l]=this.tree.edit([e,t],o.length?o.map(c=>c?.deepcopy()):void 0,s,i,()=>this.context.issueTimeTicket());this.context.acc(l);for(const c of a)this.context.registerGCPair(c);return this.context.push(xo.create(this.tree.getCreatedAt(),e,t,o.length?o:void 0,s,i)),!0}editByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new L(C.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new L(C.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulkByPath(e,t,r,s=0){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(e.length!==t.length)throw new L(C.ErrInvalidArgument,"path length should be equal");if(!e.length||!t.length)throw new L(C.ErrInvalidArgument,"path should not be empty");const i=this.tree.pathToPos(e),o=this.tree.pathToPos(t);return this.editInternal(i,o,r,s)}edit(e,t,r,s=0){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new L(C.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r?[r]:[],s)}editBulk(e,t,r,s=0){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");if(e>t)throw new L(C.ErrInvalidArgument,"from should be less than or equal to to");const i=this.tree.findPos(e),o=this.tree.findPos(t);return this.editInternal(i,o,r,s)}toXML(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toXML()}toJSON(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSON()}toJSForTest(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSForTest()}toJSInfoForTest(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.toJSInfoForTest()}getRootTreeNode(){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.getRootTreeNode()}indexToPath(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexToPath(e)}pathToIndex(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.pathToIndex(e)}pathRangeToPosRange(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");const t=[this.tree.pathToIndex(e[0]),this.tree.pathToIndex(e[1])],r=this.tree.indexRangeToPosRange(t);return[r[0].toStruct(),r[1].toStruct()]}indexRangeToPosRange(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");return this.tree.indexRangeToPosStructRange(e)}posRangeToIndexRange(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");const t=[sr.fromStruct(e[0]),sr.fromStruct(e[1])];return this.tree.posRangeToIndexRange(t)}posRangeToPathRange(e){if(!this.context||!this.tree)throw new L(C.ErrNotInitialized,"Tree is not initialized yet");const t=[sr.fromStruct(e[0]),sr.fromStruct(e[1])];return this.tree.posRangeToPathRange(t)}}function Ih(n,e){return fg(n,e)}function qn(n,e){if(e){if(e instanceof bt)return e;if(e instanceof tn)return fg(n,e);if(e instanceof nn)return Q0(n,e);if(e instanceof An)return new Ba(n,e);if(e instanceof vn){const t=new Bc(Or.Int,0);return t.initialize(n,e),t}else if(e instanceof Tn){const t=new Mc;return t.initialize(n,e),t}}else return;throw new TypeError(`Unsupported type of element: ${typeof e}`)}function Ls(n,e){const t=qn(n,e);return t instanceof bt?t.getValue():t}function no(n,e,t){let r;if(bt.isSupport(e))r=bt.of(e,t);else if(Array.isArray(e))r=nn.create(t,ze.buildArrayElements(n,e));else if(typeof e=="object")e instanceof Ba?(r=An.create(Ri.create(),t),e.initialize(n,r)):e instanceof Bc?(r=vn.create(e.getValueType(),e.getValue(),t),e.initialize(n,r)):e instanceof Mc?(r=Tn.create(e.buildRoot(n),t),e.initialize(n,r)):r=tn.create(t,po.buildObjectMembers(n,e));else throw new TypeError(`Unsupported type of value: ${typeof e}`);return r}class mo{rootObject;elementPairMapByCreatedAt;gcElementSetByCreatedAt;gcPairMap;docSize;constructor(e){this.rootObject=e,this.elementPairMapByCreatedAt=new Map,this.gcElementSetByCreatedAt=new Set,this.gcPairMap=new Map,this.docSize={live:{data:0,meta:0},gc:{data:0,meta:0}},this.registerElement(e,void 0),e.getDescendants(t=>{if(t.getRemovedAt()&&this.registerRemovedElement(t),t instanceof An||t instanceof Tn)for(const r of t.getGCPairs())this.registerGCPair(r);return!1})}static create(){return new mo(tn.create(Ti))}findByCreatedAt(e){const t=this.elementPairMapByCreatedAt.get(e.toIDString());if(t)return t.element}findElementPairByCreatedAt(e){return this.elementPairMapByCreatedAt.get(e.toIDString())}createSubPaths(e){let t=this.elementPairMapByCreatedAt.get(e.toIDString());if(!t)return[];const r=[];for(;t.parent;){const s=t.element.getCreatedAt(),i=t.parent.subPathOf(s);if(i===void 0)throw new L(C.ErrInvalidArgument,`cant find the given element: ${s.toIDString()}`);r.unshift(i),t=this.elementPairMapByCreatedAt.get(t.parent.getCreatedAt().toIDString())}return r.unshift("$"),r}createPath(e){return this.createSubPaths(e).join(".")}registerElement(e,t){this.elementPairMapByCreatedAt.set(e.getCreatedAt().toIDString(),{parent:t,element:e}),Kt(this.docSize.live,e.getDataSize()),e instanceof ps&&e.getDescendants((r,s)=>(this.elementPairMapByCreatedAt.set(r.getCreatedAt().toIDString(),{parent:s,element:r}),Kt(this.docSize.live,r.getDataSize()),!1))}deregisterElement(e){let t=0;const r=s=>{const i=s.getCreatedAt().toIDString();Vs(this.docSize.gc,s.getDataSize()),this.elementPairMapByCreatedAt.delete(i),this.gcElementSetByCreatedAt.delete(i),t++};return r(e),e instanceof ps&&e.getDescendants(s=>(r(s),!1)),t}registerRemovedElement(e){Kt(this.docSize.gc,e.getDataSize()),Vs(this.docSize.live,e.getDataSize()),this.docSize.live.meta+=Tr,this.gcElementSetByCreatedAt.add(e.getCreatedAt().toIDString())}registerGCPair(e){if(this.gcPairMap.get(e.child.toIDString())){this.gcPairMap.delete(e.child.toIDString());return}this.gcPairMap.set(e.child.toIDString(),e);const r=this.gcPairMap.get(e.child.toIDString()).child.getDataSize();Kt(this.docSize.gc,r),Vs(this.docSize.live,r),e.child instanceof fs||(this.docSize.live.meta+=Tr)}getElementMapSize(){return this.elementPairMapByCreatedAt.size}getGarbageElementSetSize(){const e=new Set;for(const t of this.gcElementSetByCreatedAt){e.add(t);const r=this.elementPairMapByCreatedAt.get(t);r.element instanceof ps&&r.element.getDescendants(s=>(e.add(s.getCreatedAt().toIDString()),!1))}return e.size}getObject(){return this.rootObject}getGarbageLen(){return this.getGarbageElementSetSize()+this.gcPairMap.size}getDocSize(){return this.docSize}deepcopy(){return new mo(this.rootObject.deepcopy())}garbageCollect(e){let t=0;for(const r of this.gcElementSetByCreatedAt){const s=this.elementPairMapByCreatedAt.get(r),i=s.element.getRemovedAt();i&&e?.afterOrEqual(i)&&(s.parent.purge(s.element),t+=this.deregisterElement(s.element))}for(const[,r]of this.gcPairMap){const s=r.child.getRemovedAt();s&&e?.afterOrEqual(s)&&(r.parent.purge(r.child),Vs(this.docSize.gc,r.child.getDataSize()),this.gcPairMap.delete(r.child.toIDString()),t+=1)}return t}toJSON(){return this.rootObject.toJSON()}toSortedJSON(){return this.rootObject.toSortedJSON()}getStats(){return{elements:this.getElementMapSize(),gcPairs:this.gcPairMap.size,gcElements:this.getGarbageElementSetSize()}}acc(e){Kt(this.docSize.live,e)}*getGCElementPairs(){for(const e of this.gcElementSetByCreatedAt){const t=this.elementPairMapByCreatedAt.get(e);t&&(yield t)}}}let Nh=class{context;presence;constructor(e,t){this.context=e,this.presence=t}set(e,t){for(const r of Object.keys(e))this.presence[r]=e[r];this.context.setPresenceChange({type:_r.Put,presence:Xn(this.presence)}),this.context.setReversePresence(e,t)}get(e){return this.presence[e]}clear(){this.presence={},this.context.setPresenceChange({type:_r.Clear})}};const wh=50;let iv=class{undoStack=[];redoStack=[];hasUndo(){return this.undoStack.length>0}hasRedo(){return this.redoStack.length>0}pushUndo(e){this.undoStack.length>=wh&&this.undoStack.shift(),this.undoStack.push(e)}popUndo(){return this.undoStack.pop()}pushRedo(e){this.redoStack.length>=wh&&this.redoStack.shift(),this.redoStack.push(e)}popRedo(){return this.redoStack.pop()}clearRedo(){this.redoStack=[]}clearUndo(){this.undoStack=[]}getUndoStackForTest(){return this.undoStack}getRedoStackForTest(){return this.redoStack}reconcileCreatedAt(e,t){const r=s=>{for(const i of s)for(const o of i)(o instanceof jr||o instanceof Lr||o instanceof rr)&&o.getCreatedAt()===e&&o.setCreatedAt(t),(o instanceof Is||o instanceof rr)&&o.getPrevCreatedAt()===e&&o.setPrevCreatedAt(t)};r(this.undoStack),r(this.redoStack)}reconcileTextEdit(e,t,r,s){const i=o=>{for(const a of o)for(const l of a)l instanceof Es&&l.getParentCreatedAt().compare(e)===0&&l.reconcileOperation(t,r,s)};i(this.undoStack),i(this.redoStack)}};function ov(n,e){const t=[];for(const r of e){const s=av(n,r.path),i=lv(s,r);if(!i.valid)for(const o of i.errors||[])t.push(o)}return{valid:t.length===0,errors:t}}function av(n,e){if(!e.startsWith("$"))throw new Error(`Path must start with $, got ${e}`);const t=e.split(".");let r=n;for(let s=1;s<t.length;s++){const i=t[s];if(!(r instanceof tn))return;r=r.get(i)}return r}function lv(n,e){switch(e.type){case"string":case"boolean":case"integer":case"double":case"long":case"date":case"bytes":case"null":return uv(n,e);case"object":if(!(n instanceof tn))return{valid:!1,errors:[{path:e.path,message:`expected object at path ${e.path}`}]};break;case"array":if(!(n instanceof nn))return{valid:!1,errors:[{path:e.path,message:`expected array at path ${e.path}`}]};break;case"yorkie.Text":if(!(n instanceof An))return{valid:!1,errors:[{path:e.path,message:`expected yorkie.Text at path ${e.path}`}]};break;case"yorkie.Tree":if(!(n instanceof Tn))return{valid:!1,errors:[{path:e.path,message:`expected yorkie.Tree at path ${e.path}`}]};break;case"yorkie.Counter":if(!(n instanceof vn))return{valid:!1,errors:[{path:e.path,message:`expected yorkie.Counter at path ${e.path}`}]};break;default:throw new Error(`Unknown rule type: ${e.type}`)}return{valid:!0}}function cv(n){switch(n){case"null":return nt.Null;case"boolean":return nt.Boolean;case"integer":return nt.Integer;case"long":return nt.Long;case"double":return nt.Double;case"string":return nt.String;case"bytes":return nt.Bytes;case"date":return nt.Date;default:throw new Error(`Unknown primitive type: ${n}`)}}function uv(n,e){return n instanceof bt&&n.getType()===cv(e.type)?{valid:!0}:{valid:!1,errors:[{path:e.path,message:`expected ${e.type} at path ${e.path}`}]}}const hv="yorkie-devtools-panel",fv="yorkie-devtools-sdk";function dv(n){return[It.StatusChanged,It.Snapshot,It.LocalChange,It.RemoteChange,It.Initialized,It.Watched,It.Unwatched,It.PresenceChanged].includes(n.type)}function gv(n){return n.every(dv)}let ii="disconnected";const Th=new Map,aa=new Map;typeof window<"u"&&(window.docEventsForReplayByDocKey=aa);function Yo(n,e){(e?.force||ii!=="disconnected")&&window.postMessage({source:fv,...n},"*")}function pv(n){if(!n.isEnableDevtools()||typeof window>"u"||Th.has(n.getKey()))return;aa.set(n.getKey(),[]);const e=n.subscribe("all",t=>{gv(t)&&(aa.get(n.getKey()).push(t),ii==="synced"&&Yo({msg:"doc::sync::partial",docKey:n.getKey(),event:t}))});Th.set(n.getKey(),[e]),Yo({msg:"refresh-devtools"},{force:!0}),window.addEventListener("message",t=>{if(t.data?.source!==hv)return;switch(t.data.msg){case"devtools::connect":if(ii!=="disconnected")break;ii="connected",Yo({msg:"doc::available",docKey:n.getKey()}),ee.info(`[YD] Devtools connected. Doc: ${n.getKey()}`);break;case"devtools::disconnect":ii="disconnected",ee.info(`[YD] Devtools disconnected. Doc: ${n.getKey()}`);break;case"devtools::subscribe":ii="synced",Yo({msg:"doc::sync::full",docKey:n.getKey(),events:aa.get(n.getKey())}),ee.info(`[YD] Devtools subscribed. Doc: ${n.getKey()}`);break}})}var is=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(is||{}),It=(n=>(n.StatusChanged="status-changed",n.ConnectionChanged="connection-changed",n.SyncStatusChanged="sync-status-changed",n.Snapshot="snapshot",n.LocalChange="local-change",n.RemoteChange="remote-change",n.Initialized="initialized",n.Watched="watched",n.Unwatched="unwatched",n.PresenceChanged="presence-changed",n.AuthError="auth-error",n))(It||{}),bi=(n=>(n.Connected="connected",n.Disconnected="disconnected",n))(bi||{}),Dl=(n=>(n.Synced="synced",n.SyncFailed="sync-failed",n))(Dl||{});class hs{key;status;opts;maxSizeLimit;schemaRules;changeID;checkpoint;localChanges;root;presences;clone;internalHistory;isUpdating;onlineClients;eventStream;eventStreamObserver;history;constructor(e,t){this.key=e,this.status="detached",this.opts=t||{},this.maxSizeLimit=0,this.schemaRules=[],this.changeID=a0,this.checkpoint=l0,this.localChanges=[],this.root=mo.create(),this.presences=new Map,this.onlineClients=new Set,this.internalHistory=new iv,this.isUpdating=!1,this.eventStream=hg(r=>this.eventStreamObserver=r),this.history={canUndo:()=>this.internalHistory.hasUndo()&&!this.isUpdating,canRedo:()=>this.internalHistory.hasRedo()&&!this.isUpdating,undo:()=>this.executeUndoRedo(!0),redo:()=>this.executeUndoRedo(!1)},pv(this)}update(e,t){if(this.getStatus()==="removed")throw new L(C.ErrDocumentRemoved,`${this.key} is removed`);this.ensureClone();const r=this.changeID.getActorID(),s=to.create(this.changeID,this.clone.root,this.clone.presences.get(r)||{},t);try{const a=Ih(s,this.clone.root.getObject());this.presences.has(r)||this.clone.presences.set(r,{}),this.isUpdating=!0,e(a,new Nh(s,this.clone.presences.get(r)))}catch(a){throw this.clone=void 0,a}finally{this.isUpdating=!1}const i=this.getSchemaRules();if(!s.isPresenceOnlyChange()&&i.length){const a=ov(this.clone?.root.getObject(),i);if(!a.valid)throw this.clone=void 0,new L(C.ErrDocumentSchemaValidationFailed,`schema validation failed: ${a.errors?.map(l=>l.message).join(", ")}`)}const o=Qy(this.clone?.root.getDocSize());if(!s.isPresenceOnlyChange()&&this.maxSizeLimit>0&&this.maxSizeLimit<o)throw this.clone=void 0,new L(C.ErrDocumentSizeExceedsLimit,`document size exceeded: ${o} > ${this.maxSizeLimit}`);if(s.hasChange()){ee.isEnabled(mn.Trivial)&&ee.trivial(`trying to update a local change: ${this.toJSON()}`);const a=s.toChange(),{opInfos:l,reverseOps:c}=a.execute(this.root,this.presences,dt.Local);for(const h of a.getOperations())h instanceof jr&&this.internalHistory.reconcileCreatedAt(h.getCreatedAt(),h.getValue().getCreatedAt());const f=s.getReversePresence();f&&c.push({type:"presence",value:f}),this.localChanges.push(a),c.length&&this.internalHistory.pushUndo(c),l.length&&this.internalHistory.clearRedo(),this.changeID=s.getNextID();const g=[];l.length&&g.push({type:"local-change",source:dt.Local,value:{message:a.getMessage()||"",operations:l,actor:r,clientSeq:a.getID().getClientSeq(),serverSeq:a.getID().getServerSeq()},rawChange:this.isEnableDevtools()?a.toStruct():void 0}),a.hasPresenceChange()&&g.push({type:"presence-changed",source:dt.Local,value:{clientID:r,presence:this.getPresence(r)}}),this.publish(g),ee.isEnabled(mn.Trivial)&&ee.trivial(`after update a local change: ${this.toJSON()}`)}}subscribe(e,t,r,s){if(typeof e=="string"){if(typeof t!="function")throw new L(C.ErrInvalidArgument,"Second argument must be a callback function");if(e==="presence"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type!=="initialized"&&c.type!=="watched"&&c.type!=="unwatched"&&c.type!=="presence-changed"||a(c)},r,s)}if(e==="my-presence"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type!=="initialized"&&c.type!=="presence-changed"||c.type==="presence-changed"&&c.value.clientID!==this.changeID.getActorID()||a(c)},r,s)}if(e==="others"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type!=="watched"&&c.type!=="unwatched"&&c.type!=="presence-changed"||c.value.clientID!==this.changeID.getActorID()&&a(c)},r,s)}if(e==="connection"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type==="connection-changed"&&a(c)},r,s)}if(e==="status"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type==="status-changed"&&a(c)},r,s)}if(e==="sync"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type==="sync-status-changed"&&a(c)},r,s)}if(e==="auth-error"){const a=t;return this.eventStream.subscribe(l=>{for(const c of l)c.type==="auth-error"&&a(c)},r)}if(e==="all"){const a=t;return this.eventStream.subscribe(a,r,s)}const i=e,o=t;return this.eventStream.subscribe(a=>{for(const l of a){if(l.type!=="local-change"&&l.type!=="remote-change")continue;const c=[];for(const f of l.value.operations)this.isSameElementOrChildOf(f.path,i)&&c.push(f);c.length&&o({...l,value:{...l.value,operations:c}})}},r,s)}if(typeof e=="function"){const i=e,o=t,a=r;return this.eventStream.subscribe(l=>{for(const c of l)c.type!=="snapshot"&&c.type!=="local-change"&&c.type!=="remote-change"||i(c)},o,a)}throw new L(C.ErrInvalidArgument,`"${e}" is not a valid`)}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}applyChangePack(e){e.hasSnapshot()?this.applySnapshot(e.getCheckpoint().getServerSeq(),e.getVersionVector(),e.getSnapshot(),e.getCheckpoint().getClientSeq()):(this.applyChanges(e.getChanges(),dt.Remote),this.removePushedLocalChanges(e.getCheckpoint().getClientSeq())),this.checkpoint=this.checkpoint.forward(e.getCheckpoint()),e.hasSnapshot()||this.garbageCollect(e.getVersionVector()),e.getIsRemoved()&&this.applyStatus("removed"),ee.isEnabled(mn.Trivial)&&ee.trivial(`${this.root.toJSON()}`)}getCheckpoint(){return this.checkpoint}getChangeID(){return this.changeID}hasLocalChanges(){return this.localChanges.length>0}ensureClone(){this.clone||(this.clone={root:this.root.deepcopy(),presences:Xn(this.presences)})}createChangePack(){const e=Array.from(this.localChanges),t=this.checkpoint.increaseClientSeq(e.length);return Oa.create(this.key,t,!1,e,this.getVersionVector())}setActor(e){for(const t of this.localChanges)t.setActor(e);this.changeID=this.changeID.setActor(e)}isEnableDevtools(){return!!this.opts.enableDevtools}getKey(){return this.key}getStatus(){return this.status}getClone(){return this.clone}getCloneRoot(){if(this.clone)return this.clone.root.getObject()}getRoot(){this.ensureClone();const e=to.create(this.changeID.next(),this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});return Ih(e,this.clone.root.getObject())}getDocSize(){return this.root.getDocSize()}getMaxSizePerDocument(){return this.maxSizeLimit}setMaxSizePerDocument(e){this.maxSizeLimit=e}getSchemaRules(){return this.schemaRules}setSchemaRules(e){this.schemaRules=e}garbageCollect(e){return this.opts.disableGC?0:(this.clone&&this.clone.root.garbageCollect(e),this.root.garbageCollect(e))}getRootObject(){return this.root.getObject()}getGarbageLen(){return this.root.getGarbageLen()}getRootCRDT(){return this.root}getGarbageLenFromClone(){return this.clone.root.getGarbageLen()}toJSON(){return this.root.toJSON()}toSortedJSON(){return this.root.toSortedJSON()}getStats(){return this.root.getStats()}toJSForTest(){return{...this.getRoot().toJSForTest(),key:"root"}}applySnapshot(e,t,r,s=-1){const{root:i,presences:o}=ut.bytesToSnapshot(r);this.root=new mo(i),this.presences=o,this.changeID=this.changeID.setClocks(t.maxLamport(),t),this.clone=void 0,this.removePushedLocalChanges(s),this.applyChanges(this.localChanges,dt.Local),this.clearHistory(),this.publish([{type:"snapshot",source:dt.Remote,value:{serverSeq:e.toString(),snapshot:this.isEnableDevtools()?ut.bytesToHex(r):void 0,snapshotVector:ut.versionVectorToHex(t)}}])}clearHistory(){this.internalHistory.clearRedo(),this.internalHistory.clearUndo()}applyChanges(e,t){ee.isEnabled(mn.Debug)&&ee.debug(`trying to apply ${e.length} remote changes.elements:${this.root.getElementMapSize()}, removeds:${this.root.getGarbageElementSetSize()}`),ee.isEnabled(mn.Trivial)&&ee.trivial(e.map(r=>`${r.getID().toTestString()}	${r.toTestString()}`).join(`
`));for(const r of e)this.applyChange(r,t);ee.isEnabled(mn.Debug)&&ee.debug(`after appling ${e.length} remote changes.elements:${this.root.getElementMapSize()},  removeds:${this.root.getGarbageElementSetSize()}`)}applyChange(e,t){this.ensureClone(),e.execute(this.clone.root,this.clone.presences,t);const r=[],s=e.getID().getActorID();if(e.hasPresenceChange()&&this.onlineClients.has(s)){const a=e.getPresenceChange();switch(a.type){case _r.Put:r.push(this.presences.has(s)?{type:"presence-changed",source:t,value:{clientID:s,presence:a.presence}}:{type:"watched",source:dt.Remote,value:{clientID:s,presence:a.presence}});break;case _r.Clear:r.push({type:"unwatched",source:dt.Remote,value:{clientID:s,presence:this.getPresence(s)}}),this.removeOnlineClient(s);break}}const{opInfos:i,operations:o}=e.execute(this.root,this.presences,t);for(const a of o)if(a instanceof Es){const[l,c]=a.normalizePos(this.root);this.internalHistory.reconcileTextEdit(a.getParentCreatedAt(),l,c,a.getContent()?.length??0)}if(this.changeID=this.changeID.syncClocks(e.getID()),i.length){const a=this.isEnableDevtools()?e.toStruct():void 0;r.push(t===dt.Remote?{type:"remote-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:a}:{type:"local-change",source:t,value:{actor:s,clientSeq:e.getID().getClientSeq(),serverSeq:e.getID().getServerSeq(),message:e.getMessage()||"",operations:i},rawChange:a})}r.length&&this.publish(r)}applyWatchStream(e){if(e.body.case==="initialization"){const t=e.body.value.clientIds,r=new Set;for(const s of t)s!==this.changeID.getActorID()&&r.add(s);this.setOnlineClients(r),this.publish([{type:"initialized",source:dt.Local,value:this.getPresences()}]);return}if(e.body.case==="event"){const{type:t,publisher:r}=e.body.value,s=[];if(t===ga.DOCUMENT_WATCHED){if(this.onlineClients.has(r)&&this.hasPresence(r))return;this.addOnlineClient(r),this.hasPresence(r)&&s.push({type:"watched",source:dt.Remote,value:{clientID:r,presence:this.getPresence(r)}})}else if(t===ga.DOCUMENT_UNWATCHED){const i=this.getPresence(r);this.removeOnlineClient(r),i&&s.push({type:"unwatched",source:dt.Remote,value:{clientID:r,presence:i}})}s.length&&this.publish(s)}}applyStatus(e){this.status=e,e==="detached"&&this.setActor(Ic),this.publish([{source:e==="removed"?dt.Remote:dt.Local,type:"status-changed",value:e==="attached"?{status:e,actorID:this.changeID.getActorID()}:{status:e}}])}applyDocEventsForReplay(e){for(const t of e){if(t.type==="status-changed"){this.applyStatus(t.value.status),t.value.status==="attached"&&this.setActor(t.value.actorID);continue}if(t.type==="snapshot"){const{snapshot:r,serverSeq:s,snapshotVector:i}=t.value;if(!r)continue;this.applySnapshot(BigInt(s),ut.hexToVersionVector(i),ut.hexToBytes(r));continue}if(t.type==="local-change"||t.type==="remote-change"){if(!t.rawChange)continue;const r=Li.fromStruct(t.rawChange);this.applyChange(r,t.source)}if(t.type==="initialized"){const r=new Set;for(const{clientID:s,presence:i}of t.value)r.add(s),this.presences.set(s,i);this.setOnlineClients(r)}else if(t.type==="watched"){const{clientID:r,presence:s}=t.value;this.addOnlineClient(r),this.presences.set(r,s)}else if(t.type==="unwatched"){const{clientID:r}=t.value;this.removeOnlineClient(r),this.presences.delete(r)}else if(t.type==="presence-changed"){const{clientID:r,presence:s}=t.value;this.presences.set(r,s)}}}getValueByPath(e){if(!e.startsWith("$"))throw new L(C.ErrInvalidArgument,'path must start with "$"');const t=e.split(".");t.shift();let r=this.getRoot();for(const s of t)if(r=r[s],!r)return;return r}setOnlineClients(e){this.onlineClients=e}resetOnlineClients(){this.onlineClients=new Set}addOnlineClient(e){this.onlineClients.add(e)}removeOnlineClient(e){this.onlineClients.delete(e)}hasPresence(e){return this.presences.has(e)}getMyPresence(){if(this.status!=="attached")return{};const e=this.presences.get(this.changeID.getActorID());return e?Xn(e):{}}getOthersPresences(){const e=[],t=this.changeID.getActorID();for(const r of this.onlineClients)r!==t&&this.presences.has(r)&&e.push({clientID:r,presence:Xn(this.presences.get(r))});return e}getPresence(e){if(e===this.changeID.getActorID())return this.getMyPresence();if(!this.onlineClients.has(e))return;const t=this.presences.get(e);return t?Xn(t):void 0}getPresences(){const e=[];e.push({clientID:this.changeID.getActorID(),presence:Xn(this.getMyPresence())});for(const t of this.onlineClients)this.presences.has(t)&&e.push({clientID:t,presence:Xn(this.presences.get(t))});return e}getPresenceForTest(e){const t=this.presences.get(e);return t?Xn(t):void 0}getSelfForTest(){return{clientID:this.getChangeID().getActorID(),presence:this.getMyPresence()}}getOthersForTest(){const e=this.getChangeID().getActorID();return this.getPresences().filter(t=>t.clientID!==e).sort((t,r)=>t.clientID>r.clientID?1:-1)}getUndoStackForTest(){return this.internalHistory.getUndoStackForTest()}getRedoStackForTest(){return this.internalHistory.getRedoStackForTest()}getVersionVector(){return this.changeID.getVersionVector()}isSameElementOrChildOf(e,t){if(t===e)return!0;const r=e.split(".");return t.split(".").every((s,i)=>s===r[i])}removePushedLocalChanges(e){for(;this.localChanges.length&&!(this.localChanges[0].getID().getClientSeq()>e);)this.localChanges.shift()}executeUndoRedo(e){if(this.isUpdating)throw new L(C.ErrRefused,`${e?"Undo":"Redo"} is not allowed during an update`);const t=e?this.internalHistory.popUndo():this.internalHistory.popRedo();if(!t)throw new L(C.ErrRefused,`There is no operation to be ${e?"undone":"redone"}`);this.ensureClone();const r=to.create(this.changeID,this.clone.root,this.clone.presences.get(this.changeID.getActorID())||{});for(const f of t){if(!(f instanceof ar)){new Nh(r,Xn(this.clone.presences.get(this.changeID.getActorID()))).set(f.value,{addToHistory:!0});continue}const g=r.issueTimeTicket();if(f.setExecutedAt(g),f instanceof jr){const h=f.getCreatedAt();f.getValue().setCreatedAt(g),this.internalHistory.reconcileCreatedAt(h,g)}else if(f instanceof Is){const h=f.getValue().getCreatedAt();f.getValue().setCreatedAt(g),this.internalHistory.reconcileCreatedAt(h,g)}r.push(f)}const s=r.toChange();s.execute(this.clone.root,this.clone.presences,dt.UndoRedo);const{opInfos:i,reverseOps:o}=s.execute(this.root,this.presences,dt.UndoRedo),a=r.getReversePresence();if(a&&o.push({type:"presence",value:a}),o.length&&(e?this.internalHistory.pushRedo(o):this.internalHistory.pushUndo(o)),!s.hasPresenceChange()&&!i.length)return;this.localChanges.push(s),this.changeID=r.getNextID();const l=this.changeID.getActorID(),c=[];i.length&&c.push({type:"local-change",source:dt.UndoRedo,value:{message:s.getMessage()||"",operations:i,actor:l,clientSeq:s.getID().getClientSeq(),serverSeq:s.getID().getServerSeq()},rawChange:this.isEnableDevtools()?s.toStruct():void 0}),s.hasPresenceChange()&&c.push({type:"presence-changed",source:dt.UndoRedo,value:{clientID:l,presence:this.getPresence(l)}}),this.publish(c)}}class xh{resource;resourceID;syncMode;changeEventReceived;lastHeartbeatTime;reconnectStreamDelay;cancelled;watchStream;watchLoopTimerID;watchAbortController;constructor(e,t,r,s){this.reconnectStreamDelay=e,this.resource=t,this.resourceID=r,this.syncMode=s,this.changeEventReceived=s!==void 0?!1:void 0,this.lastHeartbeatTime=Date.now(),this.cancelled=!1}changeSyncMode(e){this.syncMode=e}needRealtimeSync(){return this.syncMode===Yi.RealtimeSyncOff?!1:this.syncMode===Yi.RealtimePushOnly?this.resource.hasLocalChanges():this.syncMode!==Yi.Manual&&(this.resource.hasLocalChanges()||(this.changeEventReceived??!1))}needSync(e){return this.resource instanceof hs?this.needRealtimeSync():this.syncMode===Yi.Manual?!1:Date.now()-this.lastHeartbeatTime>=e}updateHeartbeatTime(){this.lastHeartbeatTime=Date.now()}async runWatchLoop(e){const t=async()=>{if(this.watchStream)return Promise.resolve();this.watchLoopTimerID&&(clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0);try{[this.watchStream,this.watchAbortController]=await e(()=>{this.watchStream=void 0,this.watchAbortController=void 0,this.cancelled||(this.watchLoopTimerID=setTimeout(t,this.reconnectStreamDelay))})}catch{}};await t()}cancelWatchStream(){this.cancelled=!0,this.watchStream&&this.watchAbortController&&(this.watchAbortController.abort(),this.watchStream=void 0,this.watchAbortController=void 0),clearTimeout(this.watchLoopTimerID),this.watchLoopTimerID=void 0}}function mv(n,e){let t=e;return{authInterceptor:i=>async o=>(n&&o.header.set("x-api-key",n),t&&o.header.set("authorization",t),await i(o)),setToken:i=>{t=i}}}const bv="@yorkie-js/sdk",yv="0.6.42",Ch={name:bv,version:yv};function vv(n){return e=>async t=>(n?t.header.set("x-yorkie-user-agent",n):t.header.set("x-yorkie-user-agent",Ch.name+"/"+Ch.version),await e(t))}const Av=n=>{try{if(JSON.stringify(n)===void 0)return!1}catch{return!1}return!0};var ji=(n=>(n.Detached="detached",n.Attached="attached",n.Removed="removed",n))(ji||{}),gi=(n=>(n.PresenceChanged="presence-changed",n.Initialized="initialized",n.Broadcast="broadcast",n.LocalBroadcast="local-broadcast",n.AuthError="auth-error",n))(gi||{});const Zi=".";class os{key;status;actorID;sessionID;count;seq;eventStream;eventStreamObserver;constructor(e){this.validateChannelKey(e),this.key=e,this.status="detached",this.count=0,this.seq=0,this.eventStream=hg(t=>this.eventStreamObserver=t)}getKey(){return this.key}getFirstKeyPath(){return this.key.split(Zi)[0]}getStatus(){return this.status}applyStatus(e){this.status=e}isAttached(){return this.status==="attached"}getActorID(){return this.actorID}setActor(e){this.actorID=e}getSessionID(){return this.sessionID}setSessionID(e){this.sessionID=e}getPresenceCount(){return this.count}updateCount(e,t){return t===0||t>this.seq?(this.count=e,this.seq=t,!0):!1}hasLocalChanges(){return!1}subscribe(e,t){if(typeof e=="function")return this.eventStream.subscribe(e);const r=e,s=t;if(!s)throw new Error("callback is required when subscribing to specific event type or topic");if(r==="broadcast")return this.eventStream.subscribe(o=>{o.type==="broadcast"&&s(o)});if(r==="local-broadcast")return this.eventStream.subscribe(o=>{o.type==="local-broadcast"&&s(o)});if(r==="auth-error")return this.eventStream.subscribe(o=>{o.type==="auth-error"&&s(o)});if(r==="presence")return this.eventStream.subscribe(o=>{(o.type==="presence-changed"||o.type==="initialized")&&s(o)});if(r==="all")return this.eventStream.subscribe(s);const i=r;return this.eventStream.subscribe(o=>{o.type==="broadcast"&&o.topic===i&&s(o)})}publish(e){this.eventStreamObserver&&this.eventStreamObserver.next(e)}broadcast(e,t,r){if(this.status!=="attached")throw new Error(`channel is not attached: ${this.status}`);if(!this.actorID)throw new Error("actorID is not set");this.publish({type:"local-broadcast",clientID:this.actorID,topic:e,payload:t,options:r})}validateChannelKey(e){if(e==="")throw new Error("channel key must not be empty");if(e.includes(" "))throw new Error("channel key must not contain a whitespace");if(e.startsWith(Zi))throw new Error("channel key must not start with a period");if(e.endsWith(Zi))throw new Error("channel key must not end with a period");if(e.includes(`${Zi}${Zi}`))throw new Error("channel key path must not empty")}}var Yi=(n=>(n.Manual="manual",n.Realtime="realtime",n.RealtimePushOnly="realtime-pushonly",n.RealtimeSyncOff="realtime-syncoff",n))(Yi||{});const ri={rpcAddr:"https://api.yorkie.dev",syncLoopDuration:50,retrySyncLoopDelay:1e3,reconnectStreamDelay:1e3,channelHeartbeatInterval:3e4},rl={maxRetries:1/0,initialRetryInterval:1e3,maxBackoff:2e4};class gg{id;key;metadata;status;attachmentMap;apiKey;authTokenInjector;conditions;syncLoopDuration;reconnectStreamDelay;retrySyncLoopDelay;channelHeartbeatInterval;rpcClient;setAuthToken;taskQueue;processing=!1;keepalive=!1;constructor(e){e=e||ri;const t=e.rpcAddr||ri.rpcAddr;this.key=e.key||ug(),this.metadata=e.metadata||{},this.status="deactivated",this.attachmentMap=new Map,this.apiKey=e.apiKey||"",this.authTokenInjector=e.authTokenInjector,this.conditions={SyncLoop:!1,WatchLoop:!1},this.syncLoopDuration=e.syncLoopDuration??ri.syncLoopDuration,this.reconnectStreamDelay=e.reconnectStreamDelay??ri.reconnectStreamDelay,this.retrySyncLoopDelay=e.retrySyncLoopDelay??ri.retrySyncLoopDelay,this.channelHeartbeatInterval=e.channelHeartbeatInterval??ri.channelHeartbeatInterval;const{authInterceptor:r,setToken:s}=mv(this.apiKey);this.setAuthToken=s,this.rpcClient=Zb(jy,dy({baseUrl:t,interceptors:[r,vv(e?.userAgent)],fetch:(i,o)=>fetch(i,{...o,keepalive:this.keepalive})})),this.taskQueue=[]}async activate(){if(this.isActive())return Promise.resolve();if(this.authTokenInjector){const e=await this.authTokenInjector();this.setAuthToken(e)}return this.enqueueTask(async()=>{try{const e=await this.rpcClient.activateClient({clientKey:this.key,metadata:this.metadata},{headers:{"x-shard-key":`${this.apiKey}/${this.key}`}});this.id=e.clientId,this.status="activated",this.runSyncLoop(),ee.info(`[AC] c:"${this.getKey()}" activated, id:"${this.id}"`),typeof window<"u"&&window.addEventListener("beforeunload",async()=>{await this.deactivate({keepalive:!0})})}catch(e){throw ee.error(`[AC] c:"${this.getKey()}" err :`,e),await this.handleConnectError(e),e}})}deactivate(e={keepalive:!1,synchronous:!1}){if(this.status==="deactivated")return Promise.resolve();const t=async()=>{try{await this.rpcClient.deactivateClient({clientId:this.id,synchronous:e.synchronous},{headers:{"x-shard-key":`${this.apiKey}/${this.key}`}}),this.deactivateInternal(),ee.info(`[DC] c"${this.getKey()}" deactivated`)}catch(r){throw ee.error(`[DC] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};if(e.keepalive){this.keepalive=!0;const r=t();return this.keepalive=!1,r}return this.enqueueTask(t)}has(e){return this.attachmentMap.has(e)}attach(e,t){return e instanceof os?this.attachChannel(e,t):this.attachDocument(e,t)}attachDocument(e,t={}){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==is.Detached)throw new L(C.ErrNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id),e.update((s,i)=>i.set(t.initialPresence||{}));const r=t.syncMode??"realtime";return this.enqueueTask(async()=>{try{const s=await this.rpcClient.attachDocument({clientId:this.id,changePack:ut.toChangePack(e.createChangePack()),schemaKey:t.schema},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});(s.maxSizePerDocument??0)>0&&e.setMaxSizePerDocument(s.maxSizePerDocument),s.schemaRules.length>0&&e.setSchemaRules(ut.fromSchemaRules(s.schemaRules));const o=ut.fromChangePack(s.changePack);if(e.applyChangePack(o),e.getStatus()===is.Removed)return e;e.applyStatus(is.Attached),this.attachmentMap.set(e.getKey(),new xh(this.reconnectStreamDelay,e,s.documentId,r)),r!=="manual"&&await this.runWatchLoop(e.getKey()),ee.info(`[AD] c:"${this.getKey()}" attaches d:"${e.getKey()}"`);const a=e.getRootObject();if(t.initialRoot){const l=t.initialRoot;e.update(c=>{for(const[f,g]of Object.entries(l))if(!a.has(f)){const h=f;c[h]=g}})}return e}catch(s){throw ee.error(`[AD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}})}detach(e,t){return e instanceof os?this.detachChannel(e):this.detachDocument(e,t)}detachDocument(e,t={keepalive:!1}){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);e.update((i,o)=>o.clear());const s=async()=>{try{const i=await this.rpcClient.detachDocument({clientId:this.id,documentId:r.resourceID,changePack:ut.toChangePack(e.createChangePack()),removeIfNotAttached:t.removeIfNotAttached??!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),o=ut.fromChangePack(i.changePack);return e.applyChangePack(o),e.getStatus()!==is.Removed&&e.applyStatus(is.Detached),this.detachInternal(e.getKey()),ee.info(`[DD] c:"${this.getKey()}" detaches d:"${e.getKey()}"`),e}catch(i){throw ee.error(`[DD] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};if(t.keepalive){this.keepalive=!0;const i=s();return this.keepalive=!1,i}return this.enqueueTask(s)}async attachChannel(e,t={}){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);if(e.getStatus()!==ji.Detached)throw new L(C.ErrNotDetached,`${e.getKey()} is not detached`);e.setActor(this.id);const r=async()=>{try{const s=await this.rpcClient.attachChannel({clientId:this.id,channelKey:e.getKey()},{headers:{"x-shard-key":`${this.apiKey}/${e.getFirstKeyPath()}`}});e.setSessionID(s.sessionId),e.updateCount(Number(s.count),0),e.applyStatus(ji.Attached);const i=t.isRealtime!==!1?"realtime":"manual",o=new xh(this.reconnectStreamDelay,e,s.sessionId,i);return e.subscribe("local-broadcast",a=>{const{topic:l,payload:c,options:f}=a;this.broadcast(e.getKey(),l,c,f).catch(g=>{f?.error&&f.error(g),ee.error(`[BC] c:"${this.getKey()}" failed: ${g}`)})}),this.attachmentMap.set(e.getKey(),o),i==="realtime"&&await this.runWatchLoop(e.getKey()),ee.info(`[AP] c:"${this.getKey()}" attaches p:"${e.getKey()}" mode:${i} count:${e.getPresenceCount()}`),e}catch(s){throw ee.error(`[AP] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}};return this.enqueueTask(r)}async detachChannel(e){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);if(!this.attachmentMap.has(e.getKey()))throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);const t=async()=>{try{const r=await this.rpcClient.detachChannel({clientId:this.id,channelKey:e.getKey(),sessionId:e.getSessionID()},{headers:{"x-shard-key":`${this.apiKey}/${e.getFirstKeyPath()}`}});return e.updateCount(Number(r.count),0),e.applyStatus(ji.Detached),this.detachInternal(e.getKey()),ee.info(`[DP] c:"${this.getKey()}" detaches p:"${e.getKey()}" count:${e.getPresenceCount()}`),e}catch(r){throw ee.error(`[DP] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}};return this.enqueueTask(t)}async changeSyncMode(e,t){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);const s=r.syncMode;return s===t?e:(r.changeSyncMode(t),t==="manual"?(r.cancelWatchStream(),e):(t==="realtime"&&(r.changeEventReceived=!0),s==="manual"&&await this.runWatchLoop(e.getKey()),e))}sync(e){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);if(e instanceof os){const t=this.attachmentMap.get(e.getKey());if(!t)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t).catch(async r=>{throw ee.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}if(e instanceof hs){const t=this.attachmentMap.get(e.getKey());if(!t)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);return this.enqueueTask(async()=>this.syncInternal(t,"realtime").catch(async r=>{throw ee.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r}))}return this.enqueueTask(async()=>{const t=[];for(const[,r]of this.attachmentMap)r.syncMode!==void 0&&r.resource instanceof hs&&t.push(this.syncInternal(r,r.syncMode));return Promise.all(t).catch(async r=>{throw ee.error(`[SY] c:"${this.getKey()}" err :`,r),await this.handleConnectError(r),r})})}remove(e){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const t=this.attachmentMap.get(e.getKey());if(!t)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);e.setActor(this.id);const r=ut.toChangePack(e.createChangePack());return r.isRemoved=!0,this.enqueueTask(async()=>{try{const s=await this.rpcClient.removeDocument({clientId:this.id,documentId:t.resourceID,changePack:r},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),i=ut.fromChangePack(s.changePack);e.applyChangePack(i),this.detachInternal(e.getKey()),ee.info(`[RD] c:"${this.getKey()}" removes d:"${e.getKey()}"`)}catch(s){throw ee.error(`[RD] c:"${this.getKey()}" err :`,s),await this.handleConnectError(s),s}})}getID(){return this.id}getKey(){return this.key}isActive(){return this.status==="activated"}getStatus(){return this.status}getCondition(e){return this.conditions[e]}async createRevision(e,t,r){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const s=this.attachmentMap.get(e.getKey());if(!s)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);const i=async()=>{try{const o=await this.rpcClient.createRevision({clientId:this.id,documentId:s.resourceID,label:t,description:r||""},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});if(!o.revision)throw new L(C.ErrInvalidArgument,"revision is not returned");return ee.info(`[CR] c:"${this.getKey()}" creates revision d:"${e.getKey()}" l:"${t}"`),ut.toRevisionSummary(o.revision)}catch(o){throw ee.error(`[CR] c:"${this.getKey()}" err :`,o),await this.handleConnectError(o),o}};return this.enqueueTask(i)}async listRevisions(e,t){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);const s=async()=>{try{const i=await this.rpcClient.listRevisions({clientId:this.id,documentId:r.resourceID,pageSize:t?.pageSize||10,offset:t?.offset||0,isForward:t?.isForward??!1},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});return ee.info(`[LR] c:"${this.getKey()}" lists revisions d:"${e.getKey()}" count:${i.revisions.length}`),i.revisions.map(ut.toRevisionSummary)}catch(i){throw ee.error(`[LR] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(s)}async getRevision(e,t){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);const s=async()=>{try{const i=await this.rpcClient.getRevision({clientId:this.id,documentId:r.resourceID,revisionId:t},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}});if(!i.revision)throw new L(C.ErrInvalidArgument,"revision is not returned");return ee.info(`[GR] c:"${this.getKey()}" gets revision d:"${e.getKey()}" r:"${t}"`),ut.toRevisionSummary(i.revision)}catch(i){throw ee.error(`[GR] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(s)}async restoreRevision(e,t){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const r=this.attachmentMap.get(e.getKey());if(!r)throw new L(C.ErrNotAttached,`${e.getKey()} is not attached`);const s=async()=>{try{await this.rpcClient.restoreRevision({clientId:this.id,documentId:r.resourceID,revisionId:t},{headers:{"x-shard-key":`${this.apiKey}/${e.getKey()}`}}),ee.info(`[RR] c:"${this.getKey()}" restores revision d:"${e.getKey()}" r:"${t}"`)}catch(i){throw ee.error(`[RR] c:"${this.getKey()}" err :`,i),await this.handleConnectError(i),i}};return this.enqueueTask(s)}async broadcast(e,t,r,s){if(!this.isActive())throw new L(C.ErrClientNotActivated,`${this.key} is not active`);const i=this.attachmentMap.get(e);if(!i)throw new L(C.ErrNotAttached,`${e} is not attached`);if(!Av(r))throw new L(C.ErrInvalidArgument,"payload is not serializable");const o=i.resource,a=s?.maxRetries??rl.maxRetries,l=rl.maxBackoff;let c=0;const f=h=>Math.min(rl.initialRetryInterval*2**h,l),g=async()=>this.enqueueTask(async()=>{try{await this.rpcClient.broadcast({clientId:this.id,channelKey:e,topic:t,payload:new TextEncoder().encode(JSON.stringify(r))},{headers:{"x-shard-key":`${this.apiKey}/${o.getFirstKeyPath()}`}}),ee.info(`[BC] c:"${this.getKey()}" broadcasts p:"${e}" t:"${t}"`)}catch(h){if(ee.error(`[BC] c:"${this.getKey()}" err:`,h),await this.handleConnectError(h))if(tl(h,C.ErrUnauthenticated)&&i.resource instanceof os&&i.resource.publish({type:gi.AuthError,reason:Ki(h).reason||"unauthenticated",method:"Broadcast"}),c<a)c++,setTimeout(()=>g(),f(c-1)),ee.info(`[BC] c:"${this.getKey()}" retry attempt ${c}/${a}`);else throw ee.error(`[BC] c:"${this.getKey()}" exceeded maximum retry attempts`),h}});return g()}runSyncLoop(){const e=async()=>{if(!this.isActive()){ee.debug(`[SL] c:"${this.getKey()}" exit sync loop`),this.conditions.SyncLoop=!1;return}try{await this.enqueueTask(async()=>{const t=[];for(const[,r]of this.attachmentMap)r.needSync(this.channelHeartbeatInterval)&&(r.changeEventReceived!==void 0&&(r.changeEventReceived=!1),t.push(this.syncInternal(r,r.syncMode).catch(s=>{throw tl(s,C.ErrUnauthenticated)&&r.resource.publish([{type:It.AuthError,value:{reason:Ki(s).reason,method:"PushPull"}}]),s})));await Promise.all(t),setTimeout(e,this.syncLoopDuration)})}catch(t){ee.error(`[SL] c:"${this.getKey()}" sync failed:`,t),await this.handleConnectError(t)?setTimeout(e,this.retrySyncLoopDelay):this.conditions.SyncLoop=!1}};ee.debug(`[SL] c:"${this.getKey()}" run sync loop`),this.conditions.SyncLoop=!0,e()}async runWatchLoop(e){const t=this.attachmentMap.get(e);if(!t)throw new L(C.ErrNotAttached,`${e} is not attached`);return this.conditions.WatchLoop=!0,t.runWatchLoop(r=>{if(!this.isActive())return this.conditions.WatchLoop=!1,Promise.reject(new L(C.ErrClientNotActivated,`${this.key} is not active`));if(!this.attachmentMap.has(e))return this.conditions.WatchLoop=!1,Promise.reject(new L(C.ErrNotAttached,`${e} is not attached`));const s=new AbortController;return t.resource instanceof hs?this.createDocumentWatchStream(t,e,s,r):t.resource instanceof os?this.createChannelWatchStream(t,e,s,r):Promise.reject(new L(C.ErrClientNotActivated,`Unknown resource type for ${e}`))})}createDocumentWatchStream(e,t,r,s){const i=this.rpcClient.watchDocument({clientId:this.id,documentId:e.resourceID},{headers:{"x-shard-key":`${this.apiKey}/${t}`},signal:r.signal});return e.resource.publish([{type:It.ConnectionChanged,value:bi.Connected}]),ee.info(`[WD] c:"${this.getKey()}" watches d:"${t}"`),e.changeEventReceived!==void 0&&(e.changeEventReceived=!0),new Promise((o,a)=>{(async()=>{try{for await(const c of i)this.handleWatchDocumentResponse(e,c),c.body.case==="initialization"&&o([i,r]);e.resource.resetOnlineClients(),e.resource.publish([{type:It.Initialized,source:dt.Local,value:e.resource.getPresences()}]),e.resource.publish([{type:It.ConnectionChanged,value:bi.Disconnected}]),ee.debug(`[WD] c:"${this.getKey()}" unwatches (stream ended)`),s()}catch(c){e.resource.resetOnlineClients(),e.resource.publish([{type:It.Initialized,source:dt.Local,value:e.resource.getPresences()}]),e.resource.publish([{type:It.ConnectionChanged,value:bi.Disconnected}]),ee.debug(`[WD] c:"${this.getKey()}" unwatches`),await this.handleConnectError(c)?(tl(c,C.ErrUnauthenticated)&&e.resource.publish([{type:It.AuthError,value:{reason:Ki(c).reason,method:"WatchDocument"}}]),s()):this.conditions.WatchLoop=!1,a(c)}})()})}createChannelWatchStream(e,t,r,s){const i=this.rpcClient.watchChannel({clientId:this.id,channelKey:t},{headers:{"x-shard-key":`${this.apiKey}/${e.resource.getFirstKeyPath()}`},signal:r.signal});return ee.info(`[WP] c:"${this.getKey()}" watches p:"${t}"`),new Promise((o,a)=>{(async()=>{try{let c=!0;for await(const f of i)this.handleWatchChannelResponse(e,f),c&&(c=!1,o([i,r]));ee.debug(`[WP] c:"${this.getKey()}" p:"${t}" stream ended`),s()}catch(c){if(c instanceof Error&&c.name==="AbortError"){ee.debug(`[WP] c:"${this.getKey()}" p:"${t}" stream aborted`);return}ee.debug(`[WP] c:"${this.getKey()}" p:"${t}" err:`,c),await this.handleConnectError(c)?s():this.conditions.WatchLoop=!1,a(c)}})()})}handleWatchChannelResponse(e,t){const r=e.resource;if(t.body.case==="initialized"){const{count:s,seq:i}=t.body.value;r.updateCount(Number(s),Number(i))&&r.publish({type:gi.Initialized,count:Number(s)})}else if(t.body.case==="event"){const s=t.body.value;if(s.type===Vd.BROADCAST){const i=new TextDecoder;try{const o=JSON.parse(i.decode(s.payload));r.publish({type:gi.Broadcast,clientID:s.publisher,topic:s.topic,payload:o})}catch(o){ee.error(`[WP] c:"${this.getKey()}" failed to parse broadcast payload:`,o)}return}r.updateCount(Number(s.count),Number(s.seq))&&r.publish({type:gi.PresenceChanged,count:Number(s.count)})}}handleWatchDocumentResponse(e,t){if(t.body.case==="event"&&t.body.value.type===ga.DOCUMENT_CHANGED){e.changeEventReceived!==void 0&&(e.changeEventReceived=!0);return}e.resource.applyWatchStream(t)}deactivateInternal(){this.status="deactivated";for(const[e,t]of this.attachmentMap)this.detachInternal(e),t.resource instanceof hs?t.resource.applyStatus(is.Detached):t.resource instanceof os&&t.resource.applyStatus(ji.Detached)}detachInternal(e){const t=this.attachmentMap.get(e);t&&(t.cancelWatchStream(),t.resource instanceof hs&&t.resource.resetOnlineClients(),this.attachmentMap.delete(e))}async syncInternal(e,t){const{resource:r}=e;if(r instanceof os){try{const a=await this.rpcClient.refreshChannel({clientId:this.id,channelKey:r.getKey(),sessionId:r.getSessionID()},{headers:{"x-shard-key":`${this.apiKey}/${r.getFirstKeyPath()}`}});r.updateCount(Number(a.count),0),e.updateHeartbeatTime(),ee.debug(`[RP] c:"${this.getKey()}" refreshes p:"${r.getKey()}" mode:${e.syncMode}`)}catch(a){throw ee.error(`[RP] c:"${this.getKey()}" err :`,a),a}return r}const s=r,{resourceID:i}=e,o=s.createChangePack();try{const a=await this.rpcClient.pushPullChanges({clientId:this.id,documentId:i,changePack:ut.toChangePack(o),pushOnly:t==="realtime-pushonly"},{headers:{"x-shard-key":`${this.apiKey}/${s.getKey()}`}}),l=ut.fromChangePack(a.changePack);if(l.hasChanges()&&(e.syncMode==="realtime-pushonly"||e.syncMode==="realtime-syncoff"))return s;s.applyChangePack(l),e.resource.publish([{type:It.SyncStatusChanged,value:Dl.Synced}]),s.getStatus()===is.Removed&&this.detachInternal(s.getKey());const c=s.getKey(),f=l.getChangeSize();return ee.info(`[PP] c:"${this.getKey()}" sync d:"${c}", push:${o.getChangeSize()} pull:${f} cp:${l.getCheckpoint().toTestString()}`),s}catch(a){throw s.publish([{type:It.SyncStatusChanged,value:Dl.SyncFailed}]),ee.error(`[PP] c:"${this.getKey()}" err :`,a),a}}async handleConnectError(e){if(!(e instanceof He))return!1;if(e.code===Pe.Canceled||e.code===Pe.Unknown||e.code===Pe.ResourceExhausted||e.code===Pe.Unavailable)return!0;if(si(e)===C.ErrUnauthenticated){if(this.authTokenInjector){const t=await this.authTokenInjector(Ki(e).reason);this.setAuthToken(t)}return!0}return si(e)===C.ErrTooManySubscribers?(ee.error(`[WD] c:"${this.getKey()}" err :`,e.rawMessage),!0):(si(e)===C.ErrTooManyAttachments||(si(e)===C.ErrClientNotActivated||si(e)===C.ErrClientNotFound)&&this.deactivateInternal(),!1)}enqueueTask(e){return new Promise((t,r)=>{this.taskQueue.push(()=>e().then(t).catch(r)),this.processing||this.processNext()})}async processNext(){if(this.taskQueue.length===0){this.processing=!1;return}try{this.processing=!0,await this.taskQueue.shift()()}catch{ee.error(`[TQ] c:"${this.getKey()}" process failed, id:"${this.id}"`)}this.processNext()}}function pg(n){return typeof n=="object"&&n!==null&&n.type==="Text"&&Array.isArray(n.nodes)}function mg(n){return typeof n=="object"&&n!==null&&n.type==="Tree"&&typeof n.root=="object"}function bg(n){return typeof n=="object"&&n!==null&&n.type==="Int"&&typeof n.value=="number"}function yg(n){return typeof n=="object"&&n!==null&&n.type==="Long"&&typeof n.value=="number"}function vg(n){return typeof n=="object"&&n!==null&&n.type==="Date"&&typeof n.value=="string"}function Ag(n){return typeof n=="object"&&n!==null&&n.type==="BinData"&&typeof n.value=="string"}function Eg(n){return typeof n=="object"&&n!==null&&n.type==="Counter"&&typeof n.value=="object"}function Ev(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!pg(n)&&!mg(n)&&!bg(n)&&!yg(n)&&!vg(n)&&!Ag(n)&&!Eg(n)}function Sv(n){try{const e=Iv(n),t=JSON.parse(e);return la(t)}catch(e){throw new L(C.ErrInvalidArgument,`Failed to parse YSON: ${e instanceof Error?e.message:String(e)}`)}}function Iv(n){let e=n;return e=e.replace(/Counter\((Int|Long)\((-?\d+)\)\)/g,(t,r,s)=>`{"__yson_type":"Counter","__yson_data":{"__yson_type":"${r}","__yson_data":${s}}}`),e=e.replace(/Int\((-?\d+)\)/g,(t,r)=>`{"__yson_type":"Int","__yson_data":${r}}`),e=e.replace(/Long\((-?\d+)\)/g,(t,r)=>`{"__yson_type":"Long","__yson_data":${r}}`),e=e.replace(/Date\("([^"]*)"\)/g,(t,r)=>`{"__yson_type":"Date","__yson_data":"${r}"}`),e=e.replace(/BinData\("([^"]*)"\)/g,(t,r)=>`{"__yson_type":"BinData","__yson_data":"${r}"}`),e=e.replace(/Text\((\[(?:[^[\]]|\[(?:[^[\]]|\[[^[\]]*\])*\])*\])\)/g,(t,r)=>`{"__yson_type":"Text","__yson_data":${r}}`),e=e.replace(/Tree\((\{[^{}]*(?:\{[^{}]*(?:\{[^{}]*\})*[^{}]*\})*[^{}]*\})\)/g,(t,r)=>`{"__yson_type":"Tree","__yson_data":${r}}`),e}function la(n){if(n===null||typeof n!="object")return n;if(n.__yson_type==="Int"&&typeof n.__yson_data=="number")return{type:"Int",value:n.__yson_data};if(n.__yson_type==="Long"&&typeof n.__yson_data=="number")return{type:"Long",value:n.__yson_data};if(n.__yson_type==="Date"&&typeof n.__yson_data=="string")return{type:"Date",value:n.__yson_data};if(n.__yson_type==="BinData"&&typeof n.__yson_data=="string")return{type:"BinData",value:n.__yson_data};if(n.__yson_type==="Counter"&&typeof n.__yson_data=="object"){const t=la(n.__yson_data);if(typeof t=="object"&&t!==null&&"type"in t&&(t.type==="Int"||t.type==="Long"))return{type:"Counter",value:t};throw new L(C.ErrInvalidArgument,"Counter must contain Int or Long")}if(n.__yson_type==="Text"&&Array.isArray(n.__yson_data))return{type:"Text",nodes:n.__yson_data.map(t=>Nv(t))};if(n.__yson_type==="Tree"&&typeof n.__yson_data=="object")return{type:"Tree",root:Sg(n.__yson_data)};if(Array.isArray(n))return n.map(t=>la(t));const e={};for(const[t,r]of Object.entries(n))e[t]=la(r);return e}function Nv(n){if(typeof n!="object"||n===null||typeof n.val!="string")throw new L(C.ErrInvalidArgument,"invalid text node format");const e={val:n.val};return n.attrs&&typeof n.attrs=="object"&&(e.attrs=n.attrs),e}function Sg(n){if(typeof n!="object"||n===null||typeof n.type!="string")throw new L(C.ErrInvalidArgument,"invalid tree node format");const e={type:n.type};return n.type==="text"&&typeof n.value=="string"?(e.value=n.value,e):(n.attrs&&typeof n.attrs=="object"&&(e.attrs=n.attrs),Array.isArray(n.children)&&(e.children=n.children.map(t=>Sg(t))),e)}function wv(n){return n.nodes.map(e=>e.val).join("")}function Tv(n){return Ig(n.root)}function Ig(n){const e=n.attrs?Object.entries(n.attrs).map(([r,s])=>` ${r}="${Rh(s)}"`).join(""):"";if(n.type==="text"&&n.value!==void 0)return`<${n.type}${e}>${Rh(n.value)}</${n.type}>`;if(!n.children||n.children.length===0)return`<${n.type}${e} />`;const t=n.children.map(r=>Ig(r)).join("");return`<${n.type}${e}>${t}</${n.type}>`}function Rh(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}const xv=Object.freeze(Object.defineProperty({__proto__:null,isBinData:Ag,isCounter:Eg,isDate:vg,isInt:bg,isLong:yg,isObject:Ev,isText:pg,isTree:mg,parse:Sv,textToString:wv,treeToXML:Tv},Symbol.toStringTag,{value:"Module"})),sl={Client:gg,Document:hs,Text:Ba,IntType:Or.Int,LongType:Or.Long};typeof globalThis<"u"&&(globalThis.yorkie={Client:gg,Document:hs,Primitive:bt,Text:Ba,Counter:Bc,Tree:Mc,Channel:os,ChannelEventType:gi,YSON:xv,LogLevel:mn,setLogLevel:J0,IntType:Or.Int,LongType:Or.Long});var Te=function(n,e,t){if(!e.has(n))throw new TypeError("attempted to set private field on non-instance");return e.set(n,t),t},se=function(n,e){if(!e.has(n))throw new TypeError("attempted to get private field on non-instance");return e.get(n)},as,Os,zn,oi,qi,br,yr,vr,Ar,Er,Sr,Ir,Nr,ks,ai,ls,ca,cs;const Cv=function(n){var e=131,t=137,r=0;n+="x";var s=Math.floor(9007199254740991/t);for(let i=0;i<n.length;i++)r>s&&(r=Math.floor(r/t)),r=r*e+n.charCodeAt(i);return r},ae="0123456789abcdef".split(""),Rv=[-2147483648,8388608,32768,128],jn=[24,16,8,0],qo=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Pt=[];class _v{constructor(e=!1,t=!1){as.set(this,void 0),Os.set(this,void 0),zn.set(this,void 0),oi.set(this,void 0),qi.set(this,void 0),br.set(this,void 0),yr.set(this,void 0),vr.set(this,void 0),Ar.set(this,void 0),Er.set(this,void 0),Sr.set(this,void 0),Ir.set(this,void 0),Nr.set(this,void 0),ks.set(this,void 0),ai.set(this,void 0),ls.set(this,void 0),ca.set(this,0),cs.set(this,void 0),this.init(e,t)}init(e,t){t?(Pt[0]=Pt[16]=Pt[1]=Pt[2]=Pt[3]=Pt[4]=Pt[5]=Pt[6]=Pt[7]=Pt[8]=Pt[9]=Pt[10]=Pt[11]=Pt[12]=Pt[13]=Pt[14]=Pt[15]=0,Te(this,Os,Pt)):Te(this,Os,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e?(Te(this,br,3238371032),Te(this,yr,914150663),Te(this,vr,812702999),Te(this,Ar,4144912697),Te(this,Er,4290775857),Te(this,Sr,1750603025),Te(this,Ir,1694076839),Te(this,Nr,3204075428)):(Te(this,br,1779033703),Te(this,yr,3144134277),Te(this,vr,1013904242),Te(this,Ar,2773480762),Te(this,Er,1359893119),Te(this,Sr,2600822924),Te(this,Ir,528734635),Te(this,Nr,1541459225)),Te(this,as,Te(this,cs,Te(this,zn,Te(this,ai,0)))),Te(this,oi,Te(this,ks,!1)),Te(this,qi,!0),Te(this,ls,e)}update(e){if(se(this,oi))return this;let t;e instanceof ArrayBuffer?t=new Uint8Array(e):t=e;let r=0;const s=t.length,i=se(this,Os);for(;r<s;){let o;if(se(this,ks)&&(Te(this,ks,!1),i[0]=se(this,as),i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),typeof t!="string")for(o=se(this,cs);r<s&&o<64;++r)i[o>>2]|=t[r]<<jn[o++&3];else for(o=se(this,cs);r<s&&o<64;++r){let a=t.charCodeAt(r);a<128?i[o>>2]|=a<<jn[o++&3]:a<2048?(i[o>>2]|=(192|a>>6)<<jn[o++&3],i[o>>2]|=(128|a&63)<<jn[o++&3]):a<55296||a>=57344?(i[o>>2]|=(224|a>>12)<<jn[o++&3],i[o>>2]|=(128|a>>6&63)<<jn[o++&3],i[o>>2]|=(128|a&63)<<jn[o++&3]):(a=65536+((a&1023)<<10|t.charCodeAt(++r)&1023),i[o>>2]|=(240|a>>18)<<jn[o++&3],i[o>>2]|=(128|a>>12&63)<<jn[o++&3],i[o>>2]|=(128|a>>6&63)<<jn[o++&3],i[o>>2]|=(128|a&63)<<jn[o++&3])}Te(this,ca,o),Te(this,zn,se(this,zn)+(o-se(this,cs))),o>=64?(Te(this,as,i[16]),Te(this,cs,o-64),this.hash(),Te(this,ks,!0)):Te(this,cs,o)}return se(this,zn)>4294967295&&(Te(this,ai,se(this,ai)+(se(this,zn)/4294967296<<0)),Te(this,zn,se(this,zn)%4294967296)),this}finalize(){if(se(this,oi))return;Te(this,oi,!0);const e=se(this,Os),t=se(this,ca);e[16]=se(this,as),e[t>>2]|=Rv[t&3],Te(this,as,e[16]),t>=56&&(se(this,ks)||this.hash(),e[0]=se(this,as),e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=se(this,ai)<<3|se(this,zn)>>>29,e[15]=se(this,zn)<<3,this.hash()}hash(){let e=se(this,br),t=se(this,yr),r=se(this,vr),s=se(this,Ar),i=se(this,Er),o=se(this,Sr),a=se(this,Ir),l=se(this,Nr);const c=se(this,Os);let f,g,h,d,m,v,I,E,y,p;for(let A=16;A<64;++A)d=c[A-15],f=(d>>>7|d<<25)^(d>>>18|d<<14)^d>>>3,d=c[A-2],g=(d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10,c[A]=c[A-16]+f+c[A-7]+g<<0;p=t&r;for(let A=0;A<64;A+=4)se(this,qi)?(se(this,ls)?(I=300032,d=c[0]-1413257819,l=d-150054599<<0,s=d+24177077<<0):(I=704751109,d=c[0]-210244248,l=d-1521486534<<0,s=d+143694565<<0),Te(this,qi,!1)):(f=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),g=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),I=e&t,h=I^e&r^p,v=i&o^~i&a,d=l+g+v+qo[A]+c[A],m=f+h,l=s+d<<0,s=d+m<<0),f=(s>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10),g=(l>>>6|l<<26)^(l>>>11|l<<21)^(l>>>25|l<<7),E=s&e,h=E^s&t^I,v=l&i^~l&o,d=a+g+v+qo[A+1]+c[A+1],m=f+h,a=r+d<<0,r=d+m<<0,f=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),g=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),y=r&s,h=y^r&e^E,v=a&l^~a&i,d=o+g+v+qo[A+2]+c[A+2],m=f+h,o=t+d<<0,t=d+m<<0,f=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),g=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),p=t&r,h=p^t&s^y,v=o&a^~o&l,d=i+g+v+qo[A+3]+c[A+3],m=f+h,i=e+d<<0,e=d+m<<0;Te(this,br,se(this,br)+e<<0),Te(this,yr,se(this,yr)+t<<0),Te(this,vr,se(this,vr)+r<<0),Te(this,Ar,se(this,Ar)+s<<0),Te(this,Er,se(this,Er)+i<<0),Te(this,Sr,se(this,Sr)+o<<0),Te(this,Ir,se(this,Ir)+a<<0),Te(this,Nr,se(this,Nr)+l<<0)}hex(){this.finalize();const e=se(this,br),t=se(this,yr),r=se(this,vr),s=se(this,Ar),i=se(this,Er),o=se(this,Sr),a=se(this,Ir),l=se(this,Nr);let c=ae[e>>28&15]+ae[e>>24&15]+ae[e>>20&15]+ae[e>>16&15]+ae[e>>12&15]+ae[e>>8&15]+ae[e>>4&15]+ae[e&15]+ae[t>>28&15]+ae[t>>24&15]+ae[t>>20&15]+ae[t>>16&15]+ae[t>>12&15]+ae[t>>8&15]+ae[t>>4&15]+ae[t&15]+ae[r>>28&15]+ae[r>>24&15]+ae[r>>20&15]+ae[r>>16&15]+ae[r>>12&15]+ae[r>>8&15]+ae[r>>4&15]+ae[r&15]+ae[s>>28&15]+ae[s>>24&15]+ae[s>>20&15]+ae[s>>16&15]+ae[s>>12&15]+ae[s>>8&15]+ae[s>>4&15]+ae[s&15]+ae[i>>28&15]+ae[i>>24&15]+ae[i>>20&15]+ae[i>>16&15]+ae[i>>12&15]+ae[i>>8&15]+ae[i>>4&15]+ae[i&15]+ae[o>>28&15]+ae[o>>24&15]+ae[o>>20&15]+ae[o>>16&15]+ae[o>>12&15]+ae[o>>8&15]+ae[o>>4&15]+ae[o&15]+ae[a>>28&15]+ae[a>>24&15]+ae[a>>20&15]+ae[a>>16&15]+ae[a>>12&15]+ae[a>>8&15]+ae[a>>4&15]+ae[a&15];return se(this,ls)||(c+=ae[l>>28&15]+ae[l>>24&15]+ae[l>>20&15]+ae[l>>16&15]+ae[l>>12&15]+ae[l>>8&15]+ae[l>>4&15]+ae[l&15]),c}toString(){return this.hex()}digest(){this.finalize();const e=se(this,br),t=se(this,yr),r=se(this,vr),s=se(this,Ar),i=se(this,Er),o=se(this,Sr),a=se(this,Ir),l=se(this,Nr),c=[e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,s>>24&255,s>>16&255,s>>8&255,s&255,i>>24&255,i>>16&255,i>>8&255,i&255,o>>24&255,o>>16&255,o>>8&255,o&255,a>>24&255,a>>16&255,a>>8&255,a&255];return se(this,ls)||c.push(l>>24&255,l>>16&255,l>>8&255,l&255),c}array(){return this.digest()}arrayBuffer(){this.finalize();const e=new ArrayBuffer(se(this,ls)?28:32),t=new DataView(e);return t.setUint32(0,se(this,br)),t.setUint32(4,se(this,yr)),t.setUint32(8,se(this,vr)),t.setUint32(12,se(this,Ar)),t.setUint32(16,se(this,Er)),t.setUint32(20,se(this,Sr)),t.setUint32(24,se(this,Ir)),se(this,ls)||t.setUint32(28,se(this,Nr)),e}}as=new WeakMap,Os=new WeakMap,zn=new WeakMap,oi=new WeakMap,qi=new WeakMap,br=new WeakMap,yr=new WeakMap,vr=new WeakMap,Ar=new WeakMap,Er=new WeakMap,Sr=new WeakMap,Ir=new WeakMap,Nr=new WeakMap,ks=new WeakMap,ai=new WeakMap,ls=new WeakMap,ca=new WeakMap,cs=new WeakMap;function Lv(n){const e=new _v;return e.update(n),parseInt(e.hex().substring(0,8),16)}const Ov=function(n){var e="#";return n.forEach(function(t){t<16&&(e+=0),e+=t.toString(16)}),e},kv=function(n,e,t){n/=360;var r=t<.5?t*(1+e):t+e-t*e,s=2*t-r;return[n+1/3,n,n-1/3].map(function(i){return i<0&&i++,i>1&&i--,i<1/6?i=s+(r-s)*6*i:i<.5?i=r:i<2/3?i=s+(r-s)*6*(2/3-i):i=s,Math.round(i*255)})};class Dv{constructor(e={}){const[t,r]=[e.lightness,e.saturation].map(function(s){return s=s!==void 0?s:[.35,.5,.65],Array.isArray(s)?s.concat():[s]});this.L=t,this.S=r,typeof e.hue=="number"&&(e.hue={min:e.hue,max:e.hue}),typeof e.hue=="object"&&!Array.isArray(e.hue)&&(e.hue=[e.hue]),typeof e.hue>"u"&&(e.hue=[]),this.hueRanges=e.hue.map(function(s){return{min:typeof s.min>"u"?0:s.min,max:typeof s.max>"u"?360:s.max}}),this.hash=Lv,typeof e.hash=="function"&&(this.hash=e.hash),e.hash==="bkdr"&&(this.hash=Cv)}hsl(e){var t,r,s,i=this.hash(e),o=727;if(this.hueRanges.length){const a=this.hueRanges[i%this.hueRanges.length];t=i/this.hueRanges.length%o*(a.max-a.min)/o+a.min}else t=i%359;return i=Math.ceil(i/360),r=this.S[i%this.S.length],i=Math.ceil(i/this.S.length),s=this.L[i%this.L.length],[t,r,s]}rgb(e){var t=this.hsl(e);return kv.apply(this,t)}hex(e){var t=this.rgb(e);return Ov(t)}}var Ng=typeof global=="object"&&global&&global.Object===Object&&global,Bv=typeof self=="object"&&self&&self.Object===Object&&self,Dr=Ng||Bv||Function("return this")(),Ss=Dr.Symbol,wg=Object.prototype,Vv=wg.hasOwnProperty,Pv=wg.toString,Gi=Ss?Ss.toStringTag:void 0;function Mv(n){var e=Vv.call(n,Gi),t=n[Gi];try{n[Gi]=void 0;var r=!0}catch{}var s=Pv.call(n);return r&&(e?n[Gi]=t:delete n[Gi]),s}var Uv=Object.prototype,Wv=Uv.toString;function Fv(n){return Wv.call(n)}var Zv="[object Null]",Gv="[object Undefined]",_h=Ss?Ss.toStringTag:void 0;function Bi(n){return n==null?n===void 0?Gv:Zv:_h&&_h in Object(n)?Mv(n):Fv(n)}function Yr(n){return n!=null&&typeof n=="object"}var Us=Array.isArray;function Ns(n){var e=typeof n;return n!=null&&(e=="object"||e=="function")}function Tg(n){return n}var $v="[object AsyncFunction]",Kv="[object Function]",jv="[object GeneratorFunction]",Yv="[object Proxy]";function Uc(n){if(!Ns(n))return!1;var e=Bi(n);return e==Kv||e==jv||e==$v||e==Yv}var il=Dr["__core-js_shared__"],Lh=(function(){var n=/[^.]+$/.exec(il&&il.keys&&il.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""})();function qv(n){return!!Lh&&Lh in n}var zv=Function.prototype,Xv=zv.toString;function $s(n){if(n!=null){try{return Xv.call(n)}catch{}try{return n+""}catch{}}return""}var Jv=/[\\^$.*+?()[\]{}|]/g,Hv=/^\[object .+?Constructor\]$/,Qv=Function.prototype,e1=Object.prototype,t1=Qv.toString,n1=e1.hasOwnProperty,r1=RegExp("^"+t1.call(n1).replace(Jv,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function s1(n){if(!Ns(n)||qv(n))return!1;var e=Uc(n)?r1:Hv;return e.test($s(n))}function i1(n,e){return n?.[e]}function Ks(n,e){var t=i1(n,e);return s1(t)?t:void 0}var Bl=Ks(Dr,"WeakMap"),Oh=Object.create,o1=(function(){function n(){}return function(e){if(!Ns(e))return{};if(Oh)return Oh(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}})();function a1(n,e,t){switch(t.length){case 0:return n.call(e);case 1:return n.call(e,t[0]);case 2:return n.call(e,t[0],t[1]);case 3:return n.call(e,t[0],t[1],t[2])}return n.apply(e,t)}function l1(n,e){var t=-1,r=n.length;for(e||(e=Array(r));++t<r;)e[t]=n[t];return e}var c1=800,u1=16,h1=Date.now;function f1(n){var e=0,t=0;return function(){var r=h1(),s=u1-(r-t);if(t=r,s>0){if(++e>=c1)return arguments[0]}else e=0;return n.apply(void 0,arguments)}}function d1(n){return function(){return n}}var va=(function(){try{var n=Ks(Object,"defineProperty");return n({},"",{}),n}catch{}})(),g1=va?function(n,e){return va(n,"toString",{configurable:!0,enumerable:!1,value:d1(e),writable:!0})}:Tg,p1=f1(g1);function m1(n,e){for(var t=-1,r=n==null?0:n.length;++t<r&&e(n[t],t,n)!==!1;);return n}var b1=9007199254740991,y1=/^(?:0|[1-9]\d*)$/;function xg(n,e){var t=typeof n;return e=e??b1,!!e&&(t=="number"||t!="symbol"&&y1.test(n))&&n>-1&&n%1==0&&n<e}function Wc(n,e,t){e=="__proto__"&&va?va(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t}function Co(n,e){return n===e||n!==n&&e!==e}var v1=Object.prototype,A1=v1.hasOwnProperty;function Cg(n,e,t){var r=n[e];(!(A1.call(n,e)&&Co(r,t))||t===void 0&&!(e in n))&&Wc(n,e,t)}function E1(n,e,t,r){var s=!t;t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],l=void 0;l===void 0&&(l=n[a]),s?Wc(t,a,l):Cg(t,a,l)}return t}var kh=Math.max;function S1(n,e,t){return e=kh(e===void 0?n.length-1:e,0),function(){for(var r=arguments,s=-1,i=kh(r.length-e,0),o=Array(i);++s<i;)o[s]=r[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=r[s];return a[e]=t(o),a1(n,this,a)}}function I1(n,e){return p1(S1(n,e,Tg),n+"")}var N1=9007199254740991;function Rg(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=N1}function Va(n){return n!=null&&Rg(n.length)&&!Uc(n)}function w1(n,e,t){if(!Ns(t))return!1;var r=typeof e;return(r=="number"?Va(t)&&xg(e,t.length):r=="string"&&e in t)?Co(t[e],n):!1}function T1(n){return I1(function(e,t){var r=-1,s=t.length,i=s>1?t[s-1]:void 0,o=s>2?t[2]:void 0;for(i=n.length>3&&typeof i=="function"?(s--,i):void 0,o&&w1(t[0],t[1],o)&&(i=s<3?void 0:i,s=1),e=Object(e);++r<s;){var a=t[r];a&&n(e,a,r,i)}return e})}var x1=Object.prototype;function Fc(n){var e=n&&n.constructor,t=typeof e=="function"&&e.prototype||x1;return n===t}function C1(n,e){for(var t=-1,r=Array(n);++t<n;)r[t]=e(t);return r}var R1="[object Arguments]";function Dh(n){return Yr(n)&&Bi(n)==R1}var _g=Object.prototype,_1=_g.hasOwnProperty,L1=_g.propertyIsEnumerable,Vl=Dh((function(){return arguments})())?Dh:function(n){return Yr(n)&&_1.call(n,"callee")&&!L1.call(n,"callee")};function O1(){return!1}var Lg=typeof Nn=="object"&&Nn&&!Nn.nodeType&&Nn,Bh=Lg&&typeof wn=="object"&&wn&&!wn.nodeType&&wn,k1=Bh&&Bh.exports===Lg,Vh=k1?Dr.Buffer:void 0,D1=Vh?Vh.isBuffer:void 0,bo=D1||O1,B1="[object Arguments]",V1="[object Array]",P1="[object Boolean]",M1="[object Date]",U1="[object Error]",W1="[object Function]",F1="[object Map]",Z1="[object Number]",G1="[object Object]",$1="[object RegExp]",K1="[object Set]",j1="[object String]",Y1="[object WeakMap]",q1="[object ArrayBuffer]",z1="[object DataView]",X1="[object Float32Array]",J1="[object Float64Array]",H1="[object Int8Array]",Q1="[object Int16Array]",eA="[object Int32Array]",tA="[object Uint8Array]",nA="[object Uint8ClampedArray]",rA="[object Uint16Array]",sA="[object Uint32Array]",ct={};ct[X1]=ct[J1]=ct[H1]=ct[Q1]=ct[eA]=ct[tA]=ct[nA]=ct[rA]=ct[sA]=!0;ct[B1]=ct[V1]=ct[q1]=ct[P1]=ct[z1]=ct[M1]=ct[U1]=ct[W1]=ct[F1]=ct[Z1]=ct[G1]=ct[$1]=ct[K1]=ct[j1]=ct[Y1]=!1;function iA(n){return Yr(n)&&Rg(n.length)&&!!ct[Bi(n)]}function Zc(n){return function(e){return n(e)}}var Og=typeof Nn=="object"&&Nn&&!Nn.nodeType&&Nn,ro=Og&&typeof wn=="object"&&wn&&!wn.nodeType&&wn,oA=ro&&ro.exports===Og,ol=oA&&Ng.process,ki=(function(){try{var n=ro&&ro.require&&ro.require("util").types;return n||ol&&ol.binding&&ol.binding("util")}catch{}})(),Ph=ki&&ki.isTypedArray,Gc=Ph?Zc(Ph):iA,aA=Object.prototype,lA=aA.hasOwnProperty;function kg(n,e){var t=Us(n),r=!t&&Vl(n),s=!t&&!r&&bo(n),i=!t&&!r&&!s&&Gc(n),o=t||r||s||i,a=o?C1(n.length,String):[],l=a.length;for(var c in n)(e||lA.call(n,c))&&!(o&&(c=="length"||s&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||xg(c,l)))&&a.push(c);return a}function Dg(n,e){return function(t){return n(e(t))}}var cA=Dg(Object.keys,Object),uA=Object.prototype,hA=uA.hasOwnProperty;function fA(n){if(!Fc(n))return cA(n);var e=[];for(var t in Object(n))hA.call(n,t)&&t!="constructor"&&e.push(t);return e}function dA(n){return Va(n)?kg(n):fA(n)}function gA(n){var e=[];if(n!=null)for(var t in Object(n))e.push(t);return e}var pA=Object.prototype,mA=pA.hasOwnProperty;function bA(n){if(!Ns(n))return gA(n);var e=Fc(n),t=[];for(var r in n)r=="constructor"&&(e||!mA.call(n,r))||t.push(r);return t}function Bg(n){return Va(n)?kg(n,!0):bA(n)}var yo=Ks(Object,"create");function yA(){this.__data__=yo?yo(null):{},this.size=0}function vA(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e}var AA="__lodash_hash_undefined__",EA=Object.prototype,SA=EA.hasOwnProperty;function IA(n){var e=this.__data__;if(yo){var t=e[n];return t===AA?void 0:t}return SA.call(e,n)?e[n]:void 0}var NA=Object.prototype,wA=NA.hasOwnProperty;function TA(n){var e=this.__data__;return yo?e[n]!==void 0:wA.call(e,n)}var xA="__lodash_hash_undefined__";function CA(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=yo&&e===void 0?xA:e,this}function Ws(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Ws.prototype.clear=yA;Ws.prototype.delete=vA;Ws.prototype.get=IA;Ws.prototype.has=TA;Ws.prototype.set=CA;function RA(){this.__data__=[],this.size=0}function Pa(n,e){for(var t=n.length;t--;)if(Co(n[t][0],e))return t;return-1}var _A=Array.prototype,LA=_A.splice;function OA(n){var e=this.__data__,t=Pa(e,n);if(t<0)return!1;var r=e.length-1;return t==r?e.pop():LA.call(e,t,1),--this.size,!0}function kA(n){var e=this.__data__,t=Pa(e,n);return t<0?void 0:e[t][1]}function DA(n){return Pa(this.__data__,n)>-1}function BA(n,e){var t=this.__data__,r=Pa(t,n);return r<0?(++this.size,t.push([n,e])):t[r][1]=e,this}function Xr(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}Xr.prototype.clear=RA;Xr.prototype.delete=OA;Xr.prototype.get=kA;Xr.prototype.has=DA;Xr.prototype.set=BA;var vo=Ks(Dr,"Map");function VA(){this.size=0,this.__data__={hash:new Ws,map:new(vo||Xr),string:new Ws}}function PA(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function Ma(n,e){var t=n.__data__;return PA(e)?t[typeof e=="string"?"string":"hash"]:t.map}function MA(n){var e=Ma(this,n).delete(n);return this.size-=e?1:0,e}function UA(n){return Ma(this,n).get(n)}function WA(n){return Ma(this,n).has(n)}function FA(n,e){var t=Ma(this,n),r=t.size;return t.set(n,e),this.size+=t.size==r?0:1,this}function js(n){var e=-1,t=n==null?0:n.length;for(this.clear();++e<t;){var r=n[e];this.set(r[0],r[1])}}js.prototype.clear=VA;js.prototype.delete=MA;js.prototype.get=UA;js.prototype.has=WA;js.prototype.set=FA;function ZA(n,e){for(var t=-1,r=e.length,s=n.length;++t<r;)n[s+t]=e[t];return n}var Vg=Dg(Object.getPrototypeOf,Object),GA="[object Object]",$A=Function.prototype,KA=Object.prototype,Pg=$A.toString,jA=KA.hasOwnProperty,YA=Pg.call(Object);function qA(n){if(!Yr(n)||Bi(n)!=GA)return!1;var e=Vg(n);if(e===null)return!0;var t=jA.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Pg.call(t)==YA}function zA(){this.__data__=new Xr,this.size=0}function XA(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t}function JA(n){return this.__data__.get(n)}function HA(n){return this.__data__.has(n)}var QA=200;function eE(n,e){var t=this.__data__;if(t instanceof Xr){var r=t.__data__;if(!vo||r.length<QA-1)return r.push([n,e]),this.size=++t.size,this;t=this.__data__=new js(r)}return t.set(n,e),this.size=t.size,this}function Rr(n){var e=this.__data__=new Xr(n);this.size=e.size}Rr.prototype.clear=zA;Rr.prototype.delete=XA;Rr.prototype.get=JA;Rr.prototype.has=HA;Rr.prototype.set=eE;var Mg=typeof Nn=="object"&&Nn&&!Nn.nodeType&&Nn,Mh=Mg&&typeof wn=="object"&&wn&&!wn.nodeType&&wn,tE=Mh&&Mh.exports===Mg,Uh=tE?Dr.Buffer:void 0,Wh=Uh?Uh.allocUnsafe:void 0;function Ug(n,e){if(e)return n.slice();var t=n.length,r=Wh?Wh(t):new n.constructor(t);return n.copy(r),r}function nE(n,e){for(var t=-1,r=n==null?0:n.length,s=0,i=[];++t<r;){var o=n[t];e(o,t,n)&&(i[s++]=o)}return i}function rE(){return[]}var sE=Object.prototype,iE=sE.propertyIsEnumerable,Fh=Object.getOwnPropertySymbols,oE=Fh?function(n){return n==null?[]:(n=Object(n),nE(Fh(n),function(e){return iE.call(n,e)}))}:rE;function aE(n,e,t){var r=e(n);return Us(n)?r:ZA(r,t(n))}function Pl(n){return aE(n,dA,oE)}var Ml=Ks(Dr,"DataView"),Ul=Ks(Dr,"Promise"),Wl=Ks(Dr,"Set"),Zh="[object Map]",lE="[object Object]",Gh="[object Promise]",$h="[object Set]",Kh="[object WeakMap]",jh="[object DataView]",cE=$s(Ml),uE=$s(vo),hE=$s(Ul),fE=$s(Wl),dE=$s(Bl),Qn=Bi;(Ml&&Qn(new Ml(new ArrayBuffer(1)))!=jh||vo&&Qn(new vo)!=Zh||Ul&&Qn(Ul.resolve())!=Gh||Wl&&Qn(new Wl)!=$h||Bl&&Qn(new Bl)!=Kh)&&(Qn=function(n){var e=Bi(n),t=e==lE?n.constructor:void 0,r=t?$s(t):"";if(r)switch(r){case cE:return jh;case uE:return Zh;case hE:return Gh;case fE:return $h;case dE:return Kh}return e});var gE=Object.prototype,pE=gE.hasOwnProperty;function mE(n){var e=n.length,t=new n.constructor(e);return e&&typeof n[0]=="string"&&pE.call(n,"index")&&(t.index=n.index,t.input=n.input),t}var Aa=Dr.Uint8Array;function $c(n){var e=new n.constructor(n.byteLength);return new Aa(e).set(new Aa(n)),e}function bE(n,e){var t=$c(n.buffer);return new n.constructor(t,n.byteOffset,n.byteLength)}var yE=/\w*$/;function vE(n){var e=new n.constructor(n.source,yE.exec(n));return e.lastIndex=n.lastIndex,e}var Yh=Ss?Ss.prototype:void 0,qh=Yh?Yh.valueOf:void 0;function AE(n){return qh?Object(qh.call(n)):{}}function Wg(n,e){var t=e?$c(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}var EE="[object Boolean]",SE="[object Date]",IE="[object Map]",NE="[object Number]",wE="[object RegExp]",TE="[object Set]",xE="[object String]",CE="[object Symbol]",RE="[object ArrayBuffer]",_E="[object DataView]",LE="[object Float32Array]",OE="[object Float64Array]",kE="[object Int8Array]",DE="[object Int16Array]",BE="[object Int32Array]",VE="[object Uint8Array]",PE="[object Uint8ClampedArray]",ME="[object Uint16Array]",UE="[object Uint32Array]";function WE(n,e,t){var r=n.constructor;switch(e){case RE:return $c(n);case EE:case SE:return new r(+n);case _E:return bE(n);case LE:case OE:case kE:case DE:case BE:case VE:case PE:case ME:case UE:return Wg(n,t);case IE:return new r;case NE:case xE:return new r(n);case wE:return vE(n);case TE:return new r;case CE:return AE(n)}}function Fg(n){return typeof n.constructor=="function"&&!Fc(n)?o1(Vg(n)):{}}var FE="[object Map]";function ZE(n){return Yr(n)&&Qn(n)==FE}var zh=ki&&ki.isMap,GE=zh?Zc(zh):ZE,$E="[object Set]";function KE(n){return Yr(n)&&Qn(n)==$E}var Xh=ki&&ki.isSet,jE=Xh?Zc(Xh):KE,YE=1,Zg="[object Arguments]",qE="[object Array]",zE="[object Boolean]",XE="[object Date]",JE="[object Error]",Gg="[object Function]",HE="[object GeneratorFunction]",QE="[object Map]",eS="[object Number]",$g="[object Object]",tS="[object RegExp]",nS="[object Set]",rS="[object String]",sS="[object Symbol]",iS="[object WeakMap]",oS="[object ArrayBuffer]",aS="[object DataView]",lS="[object Float32Array]",cS="[object Float64Array]",uS="[object Int8Array]",hS="[object Int16Array]",fS="[object Int32Array]",dS="[object Uint8Array]",gS="[object Uint8ClampedArray]",pS="[object Uint16Array]",mS="[object Uint32Array]",at={};at[Zg]=at[qE]=at[oS]=at[aS]=at[zE]=at[XE]=at[lS]=at[cS]=at[uS]=at[hS]=at[fS]=at[QE]=at[eS]=at[$g]=at[tS]=at[nS]=at[rS]=at[sS]=at[dS]=at[gS]=at[pS]=at[mS]=!0;at[JE]=at[Gg]=at[iS]=!1;function ua(n,e,t,r,s,i){var o,a=e&YE;if(o!==void 0)return o;if(!Ns(n))return n;var l=Us(n);if(l)o=mE(n);else{var c=Qn(n),f=c==Gg||c==HE;if(bo(n))return Ug(n,a);if(c==$g||c==Zg||f&&!s)o=f?{}:Fg(n);else{if(!at[c])return s?n:{};o=WE(n,c,a)}}i||(i=new Rr);var g=i.get(n);if(g)return g;i.set(n,o),jE(n)?n.forEach(function(m){o.add(ua(m,e,t,m,n,i))}):GE(n)&&n.forEach(function(m,v){o.set(v,ua(m,e,t,v,n,i))});var h=Pl,d=l?void 0:h(n);return m1(d||n,function(m,v){d&&(v=m,m=n[v]),Cg(o,v,ua(m,e,t,v,n,i))}),o}var bS=1,yS=4;function yi(n){return ua(n,bS|yS)}var vS="__lodash_hash_undefined__";function AS(n){return this.__data__.set(n,vS),this}function ES(n){return this.__data__.has(n)}function Ea(n){var e=-1,t=n==null?0:n.length;for(this.__data__=new js;++e<t;)this.add(n[e])}Ea.prototype.add=Ea.prototype.push=AS;Ea.prototype.has=ES;function SS(n,e){for(var t=-1,r=n==null?0:n.length;++t<r;)if(e(n[t],t,n))return!0;return!1}function IS(n,e){return n.has(e)}var NS=1,wS=2;function Kg(n,e,t,r,s,i){var o=t&NS,a=n.length,l=e.length;if(a!=l&&!(o&&l>a))return!1;var c=i.get(n),f=i.get(e);if(c&&f)return c==e&&f==n;var g=-1,h=!0,d=t&wS?new Ea:void 0;for(i.set(n,e),i.set(e,n);++g<a;){var m=n[g],v=e[g];if(r)var I=o?r(v,m,g,e,n,i):r(m,v,g,n,e,i);if(I!==void 0){if(I)continue;h=!1;break}if(d){if(!SS(e,function(E,y){if(!IS(d,y)&&(m===E||s(m,E,t,r,i)))return d.push(y)})){h=!1;break}}else if(!(m===v||s(m,v,t,r,i))){h=!1;break}}return i.delete(n),i.delete(e),h}function TS(n){var e=-1,t=Array(n.size);return n.forEach(function(r,s){t[++e]=[s,r]}),t}function xS(n){var e=-1,t=Array(n.size);return n.forEach(function(r){t[++e]=r}),t}var CS=1,RS=2,_S="[object Boolean]",LS="[object Date]",OS="[object Error]",kS="[object Map]",DS="[object Number]",BS="[object RegExp]",VS="[object Set]",PS="[object String]",MS="[object Symbol]",US="[object ArrayBuffer]",WS="[object DataView]",Jh=Ss?Ss.prototype:void 0,al=Jh?Jh.valueOf:void 0;function FS(n,e,t,r,s,i,o){switch(t){case WS:if(n.byteLength!=e.byteLength||n.byteOffset!=e.byteOffset)return!1;n=n.buffer,e=e.buffer;case US:return!(n.byteLength!=e.byteLength||!i(new Aa(n),new Aa(e)));case _S:case LS:case DS:return Co(+n,+e);case OS:return n.name==e.name&&n.message==e.message;case BS:case PS:return n==e+"";case kS:var a=TS;case VS:var l=r&CS;if(a||(a=xS),n.size!=e.size&&!l)return!1;var c=o.get(n);if(c)return c==e;r|=RS,o.set(n,e);var f=Kg(a(n),a(e),r,s,i,o);return o.delete(n),f;case MS:if(al)return al.call(n)==al.call(e)}return!1}var ZS=1,GS=Object.prototype,$S=GS.hasOwnProperty;function KS(n,e,t,r,s,i){var o=t&ZS,a=Pl(n),l=a.length,c=Pl(e),f=c.length;if(l!=f&&!o)return!1;for(var g=l;g--;){var h=a[g];if(!(o?h in e:$S.call(e,h)))return!1}var d=i.get(n),m=i.get(e);if(d&&m)return d==e&&m==n;var v=!0;i.set(n,e),i.set(e,n);for(var I=o;++g<l;){h=a[g];var E=n[h],y=e[h];if(r)var p=o?r(y,E,h,e,n,i):r(E,y,h,n,e,i);if(!(p===void 0?E===y||s(E,y,t,r,i):p)){v=!1;break}I||(I=h=="constructor")}if(v&&!I){var A=n.constructor,S=e.constructor;A!=S&&"constructor"in n&&"constructor"in e&&!(typeof A=="function"&&A instanceof A&&typeof S=="function"&&S instanceof S)&&(v=!1)}return i.delete(n),i.delete(e),v}var jS=1,Hh="[object Arguments]",Qh="[object Array]",zo="[object Object]",YS=Object.prototype,ef=YS.hasOwnProperty;function qS(n,e,t,r,s,i){var o=Us(n),a=Us(e),l=o?Qh:Qn(n),c=a?Qh:Qn(e);l=l==Hh?zo:l,c=c==Hh?zo:c;var f=l==zo,g=c==zo,h=l==c;if(h&&bo(n)){if(!bo(e))return!1;o=!0,f=!1}if(h&&!f)return i||(i=new Rr),o||Gc(n)?Kg(n,e,t,r,s,i):FS(n,e,l,t,r,s,i);if(!(t&jS)){var d=f&&ef.call(n,"__wrapped__"),m=g&&ef.call(e,"__wrapped__");if(d||m){var v=d?n.value():n,I=m?e.value():e;return i||(i=new Rr),s(v,I,t,r,i)}}return h?(i||(i=new Rr),KS(n,e,t,r,s,i)):!1}function jg(n,e,t,r,s){return n===e?!0:n==null||e==null||!Yr(n)&&!Yr(e)?n!==n&&e!==e:qS(n,e,t,r,jg,s)}function zS(n){return function(e,t,r){for(var s=-1,i=Object(e),o=r(e),a=o.length;a--;){var l=o[++s];if(t(i[l],l,i)===!1)break}return e}}var XS=zS();function Fl(n,e,t){(t!==void 0&&!Co(n[e],t)||t===void 0&&!(e in n))&&Wc(n,e,t)}function JS(n){return Yr(n)&&Va(n)}function Zl(n,e){if(!(e==="constructor"&&typeof n[e]=="function")&&e!="__proto__")return n[e]}function HS(n){return E1(n,Bg(n))}function QS(n,e,t,r,s,i,o){var a=Zl(n,t),l=Zl(e,t),c=o.get(l);if(c){Fl(n,t,c);return}var f=i?i(a,l,t+"",n,e,o):void 0,g=f===void 0;if(g){var h=Us(l),d=!h&&bo(l),m=!h&&!d&&Gc(l);f=l,h||d||m?Us(a)?f=a:JS(a)?f=l1(a):d?(g=!1,f=Ug(l,!0)):m?(g=!1,f=Wg(l,!0)):f=[]:qA(l)||Vl(l)?(f=a,Vl(a)?f=HS(a):(!Ns(a)||Uc(a))&&(f=Fg(l))):g=!1}g&&(o.set(l,f),s(f,l,r,i,o),o.delete(l)),Fl(n,t,f)}function Yg(n,e,t,r,s){n!==e&&XS(e,function(i,o){if(s||(s=new Rr),Ns(i))QS(n,e,o,t,Yg,r,s);else{var a=r?r(Zl(n,o),i,o+"",n,e,s):void 0;a===void 0&&(a=i),Fl(n,o,a)}},Bg)}function Kc(n,e){return jg(n,e)}var bs=T1(function(n,e,t){Yg(n,e,t)}),de=(n=>(n[n.TYPE=3]="TYPE",n[n.LEVEL=12]="LEVEL",n[n.ATTRIBUTE=13]="ATTRIBUTE",n[n.BLOT=14]="BLOT",n[n.INLINE=7]="INLINE",n[n.BLOCK=11]="BLOCK",n[n.BLOCK_BLOT=10]="BLOCK_BLOT",n[n.INLINE_BLOT=6]="INLINE_BLOT",n[n.BLOCK_ATTRIBUTE=9]="BLOCK_ATTRIBUTE",n[n.INLINE_ATTRIBUTE=5]="INLINE_ATTRIBUTE",n[n.ANY=15]="ANY",n))(de||{});class kr{constructor(e,t,r={}){this.attrName=e,this.keyName=t;const s=de.TYPE&de.ATTRIBUTE;this.scope=r.scope!=null?r.scope&de.LEVEL|s:de.ATTRIBUTE,r.whitelist!=null&&(this.whitelist=r.whitelist)}static keys(e){return Array.from(e.attributes).map(t=>t.name)}add(e,t){return this.canAdd(e,t)?(e.setAttribute(this.keyName,t),!0):!1}canAdd(e,t){return this.whitelist==null?!0:typeof t=="string"?this.whitelist.indexOf(t.replace(/["']/g,""))>-1:this.whitelist.indexOf(t)>-1}remove(e){e.removeAttribute(this.keyName)}value(e){const t=e.getAttribute(this.keyName);return this.canAdd(e,t)&&t?t:""}}class vi extends Error{constructor(e){e="[Parchment] "+e,super(e),this.message=e,this.name=this.constructor.name}}const qg=class Gl{constructor(){this.attributes={},this.classes={},this.tags={},this.types={}}static find(e,t=!1){if(e==null)return null;if(this.blots.has(e))return this.blots.get(e)||null;if(t){let r=null;try{r=e.parentNode}catch{return null}return this.find(r,t)}return null}create(e,t,r){const s=this.query(t);if(s==null)throw new vi(`Unable to create ${t} blot`);const i=s,o=t instanceof Node||t.nodeType===Node.TEXT_NODE?t:i.create(r),a=new i(e,o,r);return Gl.blots.set(a.domNode,a),a}find(e,t=!1){return Gl.find(e,t)}query(e,t=de.ANY){let r;return typeof e=="string"?r=this.types[e]||this.attributes[e]:e instanceof Text||e.nodeType===Node.TEXT_NODE?r=this.types.text:typeof e=="number"?e&de.LEVEL&de.BLOCK?r=this.types.block:e&de.LEVEL&de.INLINE&&(r=this.types.inline):e instanceof Element&&((e.getAttribute("class")||"").split(/\s+/).some(s=>(r=this.classes[s],!!r)),r=r||this.tags[e.tagName]),r==null?null:"scope"in r&&t&de.LEVEL&r.scope&&t&de.TYPE&r.scope?r:null}register(...e){return e.map(t=>{const r="blotName"in t,s="attrName"in t;if(!r&&!s)throw new vi("Invalid definition");if(r&&t.blotName==="abstract")throw new vi("Cannot register abstract class");const i=r?t.blotName:s?t.attrName:void 0;return this.types[i]=t,s?typeof t.keyName=="string"&&(this.attributes[t.keyName]=t):r&&(t.className&&(this.classes[t.className]=t),t.tagName&&(Array.isArray(t.tagName)?t.tagName=t.tagName.map(o=>o.toUpperCase()):t.tagName=t.tagName.toUpperCase(),(Array.isArray(t.tagName)?t.tagName:[t.tagName]).forEach(o=>{(this.tags[o]==null||t.className==null)&&(this.tags[o]=t)}))),t})}};qg.blots=new WeakMap;let Di=qg;function tf(n,e){return(n.getAttribute("class")||"").split(/\s+/).filter(t=>t.indexOf(`${e}-`)===0)}class eI extends kr{static keys(e){return(e.getAttribute("class")||"").split(/\s+/).map(t=>t.split("-").slice(0,-1).join("-"))}add(e,t){return this.canAdd(e,t)?(this.remove(e),e.classList.add(`${this.keyName}-${t}`),!0):!1}remove(e){tf(e,this.keyName).forEach(t=>{e.classList.remove(t)}),e.classList.length===0&&e.removeAttribute("class")}value(e){const t=(tf(e,this.keyName)[0]||"").slice(this.keyName.length+1);return this.canAdd(e,t)?t:""}}const lr=eI;function ll(n){const e=n.split("-"),t=e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("");return e[0]+t}class tI extends kr{static keys(e){return(e.getAttribute("style")||"").split(";").map(t=>t.split(":")[0].trim())}add(e,t){return this.canAdd(e,t)?(e.style[ll(this.keyName)]=t,!0):!1}remove(e){e.style[ll(this.keyName)]="",e.getAttribute("style")||e.removeAttribute("style")}value(e){const t=e.style[ll(this.keyName)];return this.canAdd(e,t)?t:""}}const ws=tI;class nI{constructor(e){this.attributes={},this.domNode=e,this.build()}attribute(e,t){t?e.add(this.domNode,t)&&(e.value(this.domNode)!=null?this.attributes[e.attrName]=e:delete this.attributes[e.attrName]):(e.remove(this.domNode),delete this.attributes[e.attrName])}build(){this.attributes={};const e=Di.find(this.domNode);if(e==null)return;const t=kr.keys(this.domNode),r=lr.keys(this.domNode),s=ws.keys(this.domNode);t.concat(r).concat(s).forEach(i=>{const o=e.scroll.query(i,de.ATTRIBUTE);o instanceof kr&&(this.attributes[o.attrName]=o)})}copy(e){Object.keys(this.attributes).forEach(t=>{const r=this.attributes[t].value(this.domNode);e.format(t,r)})}move(e){this.copy(e),Object.keys(this.attributes).forEach(t=>{this.attributes[t].remove(this.domNode)}),this.attributes={}}values(){return Object.keys(this.attributes).reduce((e,t)=>(e[t]=this.attributes[t].value(this.domNode),e),{})}}const Ua=nI,zg=class{constructor(e,t){this.scroll=e,this.domNode=t,Di.blots.set(t,this),this.prev=null,this.next=null}static create(e){if(this.tagName==null)throw new vi("Blot definition missing tagName");let t,r;return Array.isArray(this.tagName)?(typeof e=="string"?(r=e.toUpperCase(),parseInt(r,10).toString()===r&&(r=parseInt(r,10))):typeof e=="number"&&(r=e),typeof r=="number"?t=document.createElement(this.tagName[r-1]):r&&this.tagName.indexOf(r)>-1?t=document.createElement(r):t=document.createElement(this.tagName[0])):t=document.createElement(this.tagName),this.className&&t.classList.add(this.className),t}get statics(){return this.constructor}attach(){}clone(){const e=this.domNode.cloneNode(!1);return this.scroll.create(e)}detach(){this.parent!=null&&this.parent.removeChild(this),Di.blots.delete(this.domNode)}deleteAt(e,t){this.isolate(e,t).remove()}formatAt(e,t,r,s){const i=this.isolate(e,t);if(this.scroll.query(r,de.BLOT)!=null&&s)i.wrap(r,s);else if(this.scroll.query(r,de.ATTRIBUTE)!=null){const o=this.scroll.create(this.statics.scope);i.wrap(o),o.format(r,s)}}insertAt(e,t,r){const s=r==null?this.scroll.create("text",t):this.scroll.create(t,r),i=this.split(e);this.parent.insertBefore(s,i||void 0)}isolate(e,t){const r=this.split(e);if(r==null)throw new Error("Attempt to isolate at end");return r.split(t),r}length(){return 1}offset(e=this.parent){return this.parent==null||this===e?0:this.parent.children.offset(this)+this.parent.offset(e)}optimize(e){this.statics.requiredContainer&&!(this.parent instanceof this.statics.requiredContainer)&&this.wrap(this.statics.requiredContainer.blotName)}remove(){this.domNode.parentNode!=null&&this.domNode.parentNode.removeChild(this.domNode),this.detach()}replaceWith(e,t){const r=typeof e=="string"?this.scroll.create(e,t):e;return this.parent!=null&&(this.parent.insertBefore(r,this.next||void 0),this.remove()),r}split(e,t){return e===0?this:this.next}update(e,t){}wrap(e,t){const r=typeof e=="string"?this.scroll.create(e,t):e;if(this.parent!=null&&this.parent.insertBefore(r,this.next||void 0),typeof r.appendChild!="function")throw new vi(`Cannot wrap ${e}`);return r.appendChild(this),r}};zg.blotName="abstract";let Xg=zg;const Jg=class extends Xg{static value(e){return!0}index(e,t){return this.domNode===e||this.domNode.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY?Math.min(t,1):-1}position(e,t){let r=Array.from(this.parent.domNode.childNodes).indexOf(this.domNode);return e>0&&(r+=1),[this.parent.domNode,r]}value(){return{[this.statics.blotName]:this.statics.value(this.domNode)||!0}}};Jg.scope=de.INLINE_BLOT;let rI=Jg;const en=rI;class sI{constructor(){this.head=null,this.tail=null,this.length=0}append(...e){if(this.insertBefore(e[0],null),e.length>1){const t=e.slice(1);this.append(...t)}}at(e){const t=this.iterator();let r=t();for(;r&&e>0;)e-=1,r=t();return r}contains(e){const t=this.iterator();let r=t();for(;r;){if(r===e)return!0;r=t()}return!1}indexOf(e){const t=this.iterator();let r=t(),s=0;for(;r;){if(r===e)return s;s+=1,r=t()}return-1}insertBefore(e,t){e!=null&&(this.remove(e),e.next=t,t!=null?(e.prev=t.prev,t.prev!=null&&(t.prev.next=e),t.prev=e,t===this.head&&(this.head=e)):this.tail!=null?(this.tail.next=e,e.prev=this.tail,this.tail=e):(e.prev=null,this.head=this.tail=e),this.length+=1)}offset(e){let t=0,r=this.head;for(;r!=null;){if(r===e)return t;t+=r.length(),r=r.next}return-1}remove(e){this.contains(e)&&(e.prev!=null&&(e.prev.next=e.next),e.next!=null&&(e.next.prev=e.prev),e===this.head&&(this.head=e.next),e===this.tail&&(this.tail=e.prev),this.length-=1)}iterator(e=this.head){return()=>{const t=e;return e!=null&&(e=e.next),t}}find(e,t=!1){const r=this.iterator();let s=r();for(;s;){const i=s.length();if(e<i||t&&e===i&&(s.next==null||s.next.length()!==0))return[s,e];e-=i,s=r()}return[null,0]}forEach(e){const t=this.iterator();let r=t();for(;r;)e(r),r=t()}forEachAt(e,t,r){if(t<=0)return;const[s,i]=this.find(e);let o=e-i;const a=this.iterator(s);let l=a();for(;l&&o<e+t;){const c=l.length();e>o?r(l,e-o,Math.min(t,o+c-e)):r(l,0,Math.min(c,e+t-o)),o+=c,l=a()}}map(e){return this.reduce((t,r)=>(t.push(e(r)),t),[])}reduce(e,t){const r=this.iterator();let s=r();for(;s;)t=e(t,s),s=r();return t}}function nf(n,e){const t=e.find(n);if(t)return t;try{return e.create(n)}catch{const r=e.create(de.INLINE);return Array.from(n.childNodes).forEach(s=>{r.domNode.appendChild(s)}),n.parentNode&&n.parentNode.replaceChild(r.domNode,n),r.attach(),r}}const Hg=class us extends Xg{constructor(e,t){super(e,t),this.uiNode=null,this.build()}appendChild(e){this.insertBefore(e)}attach(){super.attach(),this.children.forEach(e=>{e.attach()})}attachUI(e){this.uiNode!=null&&this.uiNode.remove(),this.uiNode=e,us.uiClass&&this.uiNode.classList.add(us.uiClass),this.uiNode.setAttribute("contenteditable","false"),this.domNode.insertBefore(this.uiNode,this.domNode.firstChild)}build(){this.children=new sI,Array.from(this.domNode.childNodes).filter(e=>e!==this.uiNode).reverse().forEach(e=>{try{const t=nf(e,this.scroll);this.insertBefore(t,this.children.head||void 0)}catch(t){if(t instanceof vi)return;throw t}})}deleteAt(e,t){if(e===0&&t===this.length())return this.remove();this.children.forEachAt(e,t,(r,s,i)=>{r.deleteAt(s,i)})}descendant(e,t=0){const[r,s]=this.children.find(t);return e.blotName==null&&e(r)||e.blotName!=null&&r instanceof e?[r,s]:r instanceof us?r.descendant(e,s):[null,-1]}descendants(e,t=0,r=Number.MAX_VALUE){let s=[],i=r;return this.children.forEachAt(t,r,(o,a,l)=>{(e.blotName==null&&e(o)||e.blotName!=null&&o instanceof e)&&s.push(o),o instanceof us&&(s=s.concat(o.descendants(e,a,i))),i-=l}),s}detach(){this.children.forEach(e=>{e.detach()}),super.detach()}enforceAllowedChildren(){let e=!1;this.children.forEach(t=>{e||this.statics.allowedChildren.some(r=>t instanceof r)||(t.statics.scope===de.BLOCK_BLOT?(t.next!=null&&this.splitAfter(t),t.prev!=null&&this.splitAfter(t.prev),t.parent.unwrap(),e=!0):t instanceof us?t.unwrap():t.remove())})}formatAt(e,t,r,s){this.children.forEachAt(e,t,(i,o,a)=>{i.formatAt(o,a,r,s)})}insertAt(e,t,r){const[s,i]=this.children.find(e);if(s)s.insertAt(i,t,r);else{const o=r==null?this.scroll.create("text",t):this.scroll.create(t,r);this.appendChild(o)}}insertBefore(e,t){e.parent!=null&&e.parent.children.remove(e);let r=null;this.children.insertBefore(e,t||null),e.parent=this,t!=null&&(r=t.domNode),(this.domNode.parentNode!==e.domNode||this.domNode.nextSibling!==r)&&this.domNode.insertBefore(e.domNode,r),e.attach()}length(){return this.children.reduce((e,t)=>e+t.length(),0)}moveChildren(e,t){this.children.forEach(r=>{e.insertBefore(r,t)})}optimize(e){if(super.optimize(e),this.enforceAllowedChildren(),this.uiNode!=null&&this.uiNode!==this.domNode.firstChild&&this.domNode.insertBefore(this.uiNode,this.domNode.firstChild),this.children.length===0)if(this.statics.defaultChild!=null){const t=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(t)}else this.remove()}path(e,t=!1){const[r,s]=this.children.find(e,t),i=[[this,e]];return r instanceof us?i.concat(r.path(s,t)):(r!=null&&i.push([r,s]),i)}removeChild(e){this.children.remove(e)}replaceWith(e,t){const r=typeof e=="string"?this.scroll.create(e,t):e;return r instanceof us&&this.moveChildren(r),super.replaceWith(r)}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}const r=this.clone();return this.parent&&this.parent.insertBefore(r,this.next||void 0),this.children.forEachAt(e,this.length(),(s,i,o)=>{const a=s.split(i,t);a!=null&&r.appendChild(a)}),r}splitAfter(e){const t=this.clone();for(;e.next!=null;)t.appendChild(e.next);return this.parent&&this.parent.insertBefore(t,this.next||void 0),t}unwrap(){this.parent&&this.moveChildren(this.parent,this.next||void 0),this.remove()}update(e,t){const r=[],s=[];e.forEach(i=>{i.target===this.domNode&&i.type==="childList"&&(r.push(...i.addedNodes),s.push(...i.removedNodes))}),s.forEach(i=>{if(i.parentNode!=null&&i.tagName!=="IFRAME"&&document.body.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)return;const o=this.scroll.find(i);o!=null&&(o.domNode.parentNode==null||o.domNode.parentNode===this.domNode)&&o.detach()}),r.filter(i=>i.parentNode===this.domNode&&i!==this.uiNode).sort((i,o)=>i===o?0:i.compareDocumentPosition(o)&Node.DOCUMENT_POSITION_FOLLOWING?1:-1).forEach(i=>{let o=null;i.nextSibling!=null&&(o=this.scroll.find(i.nextSibling));const a=nf(i,this.scroll);(a.next!==o||a.next==null)&&(a.parent!=null&&a.parent.removeChild(this),this.insertBefore(a,o||void 0))}),this.enforceAllowedChildren()}};Hg.uiClass="";let iI=Hg;const ir=iI;function oI(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(const t in n)if(n[t]!==e[t])return!1;return!0}const li=class ci extends ir{static create(e){return super.create(e)}static formats(e,t){const r=t.query(ci.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new Ua(this.domNode)}format(e,t){if(e===this.statics.blotName&&!t)this.children.forEach(r=>{r instanceof ci||(r=r.wrap(ci.blotName,!0)),this.attributes.copy(r)}),this.unwrap();else{const r=this.scroll.query(e,de.INLINE);if(r==null)return;r instanceof kr?this.attributes.attribute(r,t):t&&(e!==this.statics.blotName||this.formats()[e]!==t)&&this.replaceWith(e,t)}}formats(){const e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,r,s){this.formats()[r]!=null||this.scroll.query(r,de.ATTRIBUTE)?this.isolate(e,t).format(r,s):super.formatAt(e,t,r,s)}optimize(e){super.optimize(e);const t=this.formats();if(Object.keys(t).length===0)return this.unwrap();const r=this.next;r instanceof ci&&r.prev===this&&oI(t,r.formats())&&(r.moveChildren(this),r.remove())}replaceWith(e,t){const r=super.replaceWith(e,t);return this.attributes.copy(r),r}update(e,t){super.update(e,t),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}wrap(e,t){const r=super.wrap(e,t);return r instanceof ci&&this.attributes.move(r),r}};li.allowedChildren=[li,en],li.blotName="inline",li.scope=de.INLINE_BLOT,li.tagName="SPAN";let aI=li;const jc=aI,ui=class $l extends ir{static create(e){return super.create(e)}static formats(e,t){const r=t.query($l.blotName);if(!(r!=null&&e.tagName===r.tagName)){if(typeof this.tagName=="string")return!0;if(Array.isArray(this.tagName))return e.tagName.toLowerCase()}}constructor(e,t){super(e,t),this.attributes=new Ua(this.domNode)}format(e,t){const r=this.scroll.query(e,de.BLOCK);r!=null&&(r instanceof kr?this.attributes.attribute(r,t):e===this.statics.blotName&&!t?this.replaceWith($l.blotName):t&&(e!==this.statics.blotName||this.formats()[e]!==t)&&this.replaceWith(e,t))}formats(){const e=this.attributes.values(),t=this.statics.formats(this.domNode,this.scroll);return t!=null&&(e[this.statics.blotName]=t),e}formatAt(e,t,r,s){this.scroll.query(r,de.BLOCK)!=null?this.format(r,s):super.formatAt(e,t,r,s)}insertAt(e,t,r){if(r==null||this.scroll.query(t,de.INLINE)!=null)super.insertAt(e,t,r);else{const s=this.split(e);if(s!=null){const i=this.scroll.create(t,r);s.parent.insertBefore(i,s)}else throw new Error("Attempt to insertAt after block boundaries")}}replaceWith(e,t){const r=super.replaceWith(e,t);return this.attributes.copy(r),r}update(e,t){super.update(e,t),e.some(r=>r.target===this.domNode&&r.type==="attributes")&&this.attributes.build()}};ui.blotName="block",ui.scope=de.BLOCK_BLOT,ui.tagName="P",ui.allowedChildren=[jc,ui,en];let lI=ui;const Ao=lI,Kl=class extends ir{checkMerge(){return this.next!==null&&this.next.statics.blotName===this.statics.blotName}deleteAt(e,t){super.deleteAt(e,t),this.enforceAllowedChildren()}formatAt(e,t,r,s){super.formatAt(e,t,r,s),this.enforceAllowedChildren()}insertAt(e,t,r){super.insertAt(e,t,r),this.enforceAllowedChildren()}optimize(e){super.optimize(e),this.children.length>0&&this.next!=null&&this.checkMerge()&&(this.next.moveChildren(this),this.next.remove())}};Kl.blotName="container",Kl.scope=de.BLOCK_BLOT;let cI=Kl;const Wa=cI;class uI extends en{static formats(e,t){}format(e,t){super.formatAt(0,this.length(),e,t)}formatAt(e,t,r,s){e===0&&t===this.length()?this.format(r,s):super.formatAt(e,t,r,s)}formats(){return this.statics.formats(this.domNode,this.scroll)}}const xn=uI,hI={attributes:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0},fI=100,hi=class extends ir{constructor(e,t){super(null,t),this.registry=e,this.scroll=this,this.build(),this.observer=new MutationObserver(r=>{this.update(r)}),this.observer.observe(this.domNode,hI),this.attach()}create(e,t){return this.registry.create(this,e,t)}find(e,t=!1){const r=this.registry.find(e,t);return r?r.scroll===this?r:t?this.find(r.scroll.domNode.parentNode,!0):null:null}query(e,t=de.ANY){return this.registry.query(e,t)}register(...e){return this.registry.register(...e)}build(){this.scroll!=null&&super.build()}detach(){super.detach(),this.observer.disconnect()}deleteAt(e,t){this.update(),e===0&&t===this.length()?this.children.forEach(r=>{r.remove()}):super.deleteAt(e,t)}formatAt(e,t,r,s){this.update(),super.formatAt(e,t,r,s)}insertAt(e,t,r){this.update(),super.insertAt(e,t,r)}optimize(e=[],t={}){super.optimize(t);const r=t.mutationsMap||new WeakMap;let s=Array.from(this.observer.takeRecords());for(;s.length>0;)e.push(s.pop());const i=(l,c=!0)=>{l==null||l===this||l.domNode.parentNode!=null&&(r.has(l.domNode)||r.set(l.domNode,[]),c&&i(l.parent))},o=l=>{r.has(l.domNode)&&(l instanceof ir&&l.children.forEach(o),r.delete(l.domNode),l.optimize(t))};let a=e;for(let l=0;a.length>0;l+=1){if(l>=fI)throw new Error("[Parchment] Maximum optimize iterations reached");for(a.forEach(c=>{const f=this.find(c.target,!0);f!=null&&(f.domNode===c.target&&(c.type==="childList"?(i(this.find(c.previousSibling,!1)),Array.from(c.addedNodes).forEach(g=>{const h=this.find(g,!1);i(h,!1),h instanceof ir&&h.children.forEach(d=>{i(d,!1)})})):c.type==="attributes"&&i(f.prev)),i(f))}),this.children.forEach(o),a=Array.from(this.observer.takeRecords()),s=a.slice();s.length>0;)e.push(s.pop())}}update(e,t={}){e=e||this.observer.takeRecords();const r=new WeakMap;e.map(s=>{const i=this.find(s.target,!0);return i==null?null:r.has(i.domNode)?(r.get(i.domNode).push(s),null):(r.set(i.domNode,[s]),i)}).forEach(s=>{s!=null&&s!==this&&r.has(s.domNode)&&s.update(r.get(s.domNode)||[],t)}),t.mutationsMap=r,r.has(this.domNode)&&super.update(r.get(this.domNode),t),this.optimize(e,t)}};hi.blotName="scroll",hi.defaultChild=Ao,hi.allowedChildren=[Ao,Wa],hi.scope=de.BLOCK_BLOT,hi.tagName="DIV";let dI=hi;const Yc=dI,jl=class Qg extends en{static create(e){return document.createTextNode(e)}static value(e){return e.data}constructor(e,t){super(e,t),this.text=this.statics.value(this.domNode)}deleteAt(e,t){this.domNode.data=this.text=this.text.slice(0,e)+this.text.slice(e+t)}index(e,t){return this.domNode===e?t:-1}insertAt(e,t,r){r==null?(this.text=this.text.slice(0,e)+t+this.text.slice(e),this.domNode.data=this.text):super.insertAt(e,t,r)}length(){return this.text.length}optimize(e){super.optimize(e),this.text=this.statics.value(this.domNode),this.text.length===0?this.remove():this.next instanceof Qg&&this.next.prev===this&&(this.insertAt(this.length(),this.next.value()),this.next.remove())}position(e,t=!1){return[this.domNode,e]}split(e,t=!1){if(!t){if(e===0)return this;if(e===this.length())return this.next}const r=this.scroll.create(this.domNode.splitText(e));return this.parent.insertBefore(r,this.next||void 0),this.text=this.statics.value(this.domNode),r}update(e,t){e.some(r=>r.type==="characterData"&&r.target===this.domNode)&&(this.text=this.statics.value(this.domNode))}value(){return this.text}};jl.blotName="text",jl.scope=de.INLINE_BLOT;let gI=jl;const Sa=gI,pI=Object.freeze(Object.defineProperty({__proto__:null,Attributor:kr,AttributorStore:Ua,BlockBlot:Ao,ClassAttributor:lr,ContainerBlot:Wa,EmbedBlot:xn,InlineBlot:jc,LeafBlot:en,ParentBlot:ir,Registry:Di,Scope:de,ScrollBlot:Yc,StyleAttributor:ws,TextBlot:Sa},Symbol.toStringTag,{value:"Module"}));var ds=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Xo={exports:{}},cl,rf;function mI(){if(rf)return cl;rf=1;var n=-1,e=1,t=0;function r(N,P,w,D,O){if(N===P)return N?[[t,N]]:[];if(w!=null){var R=X(N,P,w);if(R)return R}var M=a(N,P),F=N.substring(0,M);N=N.substring(M),P=P.substring(M),M=c(N,P);var q=N.substring(N.length-M);N=N.substring(0,N.length-M),P=P.substring(0,P.length-M);var K=s(N,P);return F&&K.unshift([t,F]),q&&K.push([t,q]),y(K,O),D&&g(K),K}function s(N,P){var w;if(!N)return[[e,P]];if(!P)return[[n,N]];var D=N.length>P.length?N:P,O=N.length>P.length?P:N,R=D.indexOf(O);if(R!==-1)return w=[[e,D.substring(0,R)],[t,O],[e,D.substring(R+O.length)]],N.length>P.length&&(w[0][0]=w[2][0]=n),w;if(O.length===1)return[[n,N],[e,P]];var M=f(N,P);if(M){var F=M[0],q=M[1],K=M[2],oe=M[3],re=M[4],J=r(F,K),Se=r(q,oe);return J.concat([[t,re]],Se)}return i(N,P)}function i(N,P){for(var w=N.length,D=P.length,O=Math.ceil((w+D)/2),R=O,M=2*O,F=new Array(M),q=new Array(M),K=0;K<M;K++)F[K]=-1,q[K]=-1;F[R+1]=0,q[R+1]=0;for(var oe=w-D,re=oe%2!==0,J=0,Se=0,ne=0,ue=0,ve=0;ve<O;ve++){for(var Q=-ve+J;Q<=ve-Se;Q+=2){var be=R+Q,Ae;Q===-ve||Q!==ve&&F[be-1]<F[be+1]?Ae=F[be+1]:Ae=F[be-1]+1;for(var he=Ae-Q;Ae<w&&he<D&&N.charAt(Ae)===P.charAt(he);)Ae++,he++;if(F[be]=Ae,Ae>w)Se+=2;else if(he>D)J+=2;else if(re){var Ie=R+oe-Q;if(Ie>=0&&Ie<M&&q[Ie]!==-1){var Ne=w-q[Ie];if(Ae>=Ne)return o(N,P,Ae,he)}}}for(var we=-ve+ne;we<=ve-ue;we+=2){var Ie=R+we,Ne;we===-ve||we!==ve&&q[Ie-1]<q[Ie+1]?Ne=q[Ie+1]:Ne=q[Ie-1]+1;for(var $e=Ne-we;Ne<w&&$e<D&&N.charAt(w-Ne-1)===P.charAt(D-$e-1);)Ne++,$e++;if(q[Ie]=Ne,Ne>w)ue+=2;else if($e>D)ne+=2;else if(!re){var be=R+oe-we;if(be>=0&&be<M&&F[be]!==-1){var Ae=F[be],he=R+Ae-be;if(Ne=w-Ne,Ae>=Ne)return o(N,P,Ae,he)}}}}return[[n,N],[e,P]]}function o(N,P,w,D){var O=N.substring(0,w),R=P.substring(0,D),M=N.substring(w),F=P.substring(D),q=r(O,R),K=r(M,F);return q.concat(K)}function a(N,P){if(!N||!P||N.charAt(0)!==P.charAt(0))return 0;for(var w=0,D=Math.min(N.length,P.length),O=D,R=0;w<O;)N.substring(R,O)==P.substring(R,O)?(w=O,R=w):D=O,O=Math.floor((D-w)/2+w);return p(N.charCodeAt(O-1))&&O--,O}function l(N,P){var w=N.length,D=P.length;if(w==0||D==0)return 0;w>D?N=N.substring(w-D):w<D&&(P=P.substring(0,w));var O=Math.min(w,D);if(N==P)return O;for(var R=0,M=1;;){var F=N.substring(O-M),q=P.indexOf(F);if(q==-1)return R;M+=q,(q==0||N.substring(O-M)==P.substring(0,M))&&(R=M,M++)}}function c(N,P){if(!N||!P||N.slice(-1)!==P.slice(-1))return 0;for(var w=0,D=Math.min(N.length,P.length),O=D,R=0;w<O;)N.substring(N.length-O,N.length-R)==P.substring(P.length-O,P.length-R)?(w=O,R=w):D=O,O=Math.floor((D-w)/2+w);return A(N.charCodeAt(N.length-O))&&O--,O}function f(N,P){var w=N.length>P.length?N:P,D=N.length>P.length?P:N;if(w.length<4||D.length*2<w.length)return null;function O(Se,ne,ue){for(var ve=Se.substring(ue,ue+Math.floor(Se.length/4)),Q=-1,be="",Ae,he,Ie,Ne;(Q=ne.indexOf(ve,Q+1))!==-1;){var we=a(Se.substring(ue),ne.substring(Q)),$e=c(Se.substring(0,ue),ne.substring(0,Q));be.length<$e+we&&(be=ne.substring(Q-$e,Q)+ne.substring(Q,Q+we),Ae=Se.substring(0,ue-$e),he=Se.substring(ue+we),Ie=ne.substring(0,Q-$e),Ne=ne.substring(Q+we))}return be.length*2>=Se.length?[Ae,he,Ie,Ne,be]:null}var R=O(w,D,Math.ceil(w.length/4)),M=O(w,D,Math.ceil(w.length/2)),F;if(!R&&!M)return null;M?R?F=R[4].length>M[4].length?R:M:F=M:F=R;var q,K,oe,re;N.length>P.length?(q=F[0],K=F[1],oe=F[2],re=F[3]):(oe=F[0],re=F[1],q=F[2],K=F[3]);var J=F[4];return[q,K,oe,re,J]}function g(N){for(var P=!1,w=[],D=0,O=null,R=0,M=0,F=0,q=0,K=0;R<N.length;)N[R][0]==t?(w[D++]=R,M=q,F=K,q=0,K=0,O=N[R][1]):(N[R][0]==e?q+=N[R][1].length:K+=N[R][1].length,O&&O.length<=Math.max(M,F)&&O.length<=Math.max(q,K)&&(N.splice(w[D-1],0,[n,O]),N[w[D-1]+1][0]=e,D--,D--,R=D>0?w[D-1]:-1,M=0,F=0,q=0,K=0,O=null,P=!0)),R++;for(P&&y(N),E(N),R=1;R<N.length;){if(N[R-1][0]==n&&N[R][0]==e){var oe=N[R-1][1],re=N[R][1],J=l(oe,re),Se=l(re,oe);J>=Se?(J>=oe.length/2||J>=re.length/2)&&(N.splice(R,0,[t,re.substring(0,J)]),N[R-1][1]=oe.substring(0,oe.length-J),N[R+1][1]=re.substring(J),R++):(Se>=oe.length/2||Se>=re.length/2)&&(N.splice(R,0,[t,oe.substring(0,Se)]),N[R-1][0]=e,N[R-1][1]=re.substring(0,re.length-Se),N[R+1][0]=n,N[R+1][1]=oe.substring(Se),R++),R++}R++}}var h=/[^a-zA-Z0-9]/,d=/\s/,m=/[\r\n]/,v=/\n\r?\n$/,I=/^\r?\n\r?\n/;function E(N){function P(Se,ne){if(!Se||!ne)return 6;var ue=Se.charAt(Se.length-1),ve=ne.charAt(0),Q=ue.match(h),be=ve.match(h),Ae=Q&&ue.match(d),he=be&&ve.match(d),Ie=Ae&&ue.match(m),Ne=he&&ve.match(m),we=Ie&&Se.match(v),$e=Ne&&ne.match(I);return we||$e?5:Ie||Ne?4:Q&&!Ae&&he?3:Ae||he?2:Q||be?1:0}for(var w=1;w<N.length-1;){if(N[w-1][0]==t&&N[w+1][0]==t){var D=N[w-1][1],O=N[w][1],R=N[w+1][1],M=c(D,O);if(M){var F=O.substring(O.length-M);D=D.substring(0,D.length-M),O=F+O.substring(0,O.length-M),R=F+R}for(var q=D,K=O,oe=R,re=P(D,O)+P(O,R);O.charAt(0)===R.charAt(0);){D+=O.charAt(0),O=O.substring(1)+R.charAt(0),R=R.substring(1);var J=P(D,O)+P(O,R);J>=re&&(re=J,q=D,K=O,oe=R)}N[w-1][1]!=q&&(q?N[w-1][1]=q:(N.splice(w-1,1),w--),N[w][1]=K,oe?N[w+1][1]=oe:(N.splice(w+1,1),w--))}w++}}function y(N,P){N.push([t,""]);for(var w=0,D=0,O=0,R="",M="",F;w<N.length;){if(w<N.length-1&&!N[w][1]){N.splice(w,1);continue}switch(N[w][0]){case e:O++,M+=N[w][1],w++;break;case n:D++,R+=N[w][1],w++;break;case t:var q=w-O-D-1;if(P){if(q>=0&&T(N[q][1])){var K=N[q][1].slice(-1);if(N[q][1]=N[q][1].slice(0,-1),R=K+R,M=K+M,!N[q][1]){N.splice(q,1),w--;var oe=q-1;N[oe]&&N[oe][0]===e&&(O++,M=N[oe][1]+M,oe--),N[oe]&&N[oe][0]===n&&(D++,R=N[oe][1]+R,oe--),q=oe}}if(S(N[w][1])){var K=N[w][1].charAt(0);N[w][1]=N[w][1].slice(1),R+=K,M+=K}}if(w<N.length-1&&!N[w][1]){N.splice(w,1);break}if(R.length>0||M.length>0){R.length>0&&M.length>0&&(F=a(M,R),F!==0&&(q>=0?N[q][1]+=M.substring(0,F):(N.splice(0,0,[t,M.substring(0,F)]),w++),M=M.substring(F),R=R.substring(F)),F=c(M,R),F!==0&&(N[w][1]=M.substring(M.length-F)+N[w][1],M=M.substring(0,M.length-F),R=R.substring(0,R.length-F)));var re=O+D;R.length===0&&M.length===0?(N.splice(w-re,re),w=w-re):R.length===0?(N.splice(w-re,re,[e,M]),w=w-re+1):M.length===0?(N.splice(w-re,re,[n,R]),w=w-re+1):(N.splice(w-re,re,[n,R],[e,M]),w=w-re+2)}w!==0&&N[w-1][0]===t?(N[w-1][1]+=N[w][1],N.splice(w,1)):w++,O=0,D=0,R="",M="";break}}N[N.length-1][1]===""&&N.pop();var J=!1;for(w=1;w<N.length-1;)N[w-1][0]===t&&N[w+1][0]===t&&(N[w][1].substring(N[w][1].length-N[w-1][1].length)===N[w-1][1]?(N[w][1]=N[w-1][1]+N[w][1].substring(0,N[w][1].length-N[w-1][1].length),N[w+1][1]=N[w-1][1]+N[w+1][1],N.splice(w-1,1),J=!0):N[w][1].substring(0,N[w+1][1].length)==N[w+1][1]&&(N[w-1][1]+=N[w+1][1],N[w][1]=N[w][1].substring(N[w+1][1].length)+N[w+1][1],N.splice(w+1,1),J=!0)),w++;J&&y(N,P)}function p(N){return N>=55296&&N<=56319}function A(N){return N>=56320&&N<=57343}function S(N){return A(N.charCodeAt(0))}function T(N){return p(N.charCodeAt(N.length-1))}function B(N){for(var P=[],w=0;w<N.length;w++)N[w][1].length>0&&P.push(N[w]);return P}function $(N,P,w,D){return T(N)||S(D)?null:B([[t,N],[n,P],[e,w],[t,D]])}function X(N,P,w){var D=typeof w=="number"?{index:w,length:0}:w.oldRange,O=typeof w=="number"?null:w.newRange,R=N.length,M=P.length;if(D.length===0&&(O===null||O.length===0)){var F=D.index,q=N.slice(0,F),K=N.slice(F),oe=O?O.index:null;e:{var re=F+M-R;if(oe!==null&&oe!==re||re<0||re>M)break e;var J=P.slice(0,re),Se=P.slice(re);if(Se!==K)break e;var ne=Math.min(F,re),ue=q.slice(0,ne),ve=J.slice(0,ne);if(ue!==ve)break e;var Q=q.slice(ne),be=J.slice(ne);return $(ue,Q,be,K)}e:{if(oe!==null&&oe!==F)break e;var Ae=F,J=P.slice(0,Ae),Se=P.slice(Ae);if(J!==q)break e;var he=Math.min(R-Ae,M-Ae),Ie=K.slice(K.length-he),Ne=Se.slice(Se.length-he);if(Ie!==Ne)break e;var Q=K.slice(0,K.length-he),be=Se.slice(0,Se.length-he);return $(q,Q,be,Ie)}}if(D.length>0&&O&&O.length===0)e:{var ue=N.slice(0,D.index),Ie=N.slice(D.index+D.length),ne=ue.length,he=Ie.length;if(M<ne+he)break e;var ve=P.slice(0,ne),Ne=P.slice(M-he);if(ue!==ve||Ie!==Ne)break e;var Q=N.slice(ne,R-he),be=P.slice(ne,M-he);return $(ue,Q,be,Ie)}return null}function H(N,P,w,D){return r(N,P,w,D,!0)}return H.INSERT=e,H.DELETE=n,H.EQUAL=t,cl=H,cl}var zi={exports:{}};zi.exports;var sf;function ep(){return sf||(sf=1,(function(n,e){var t=200,r="__lodash_hash_undefined__",s=9007199254740991,i="[object Arguments]",o="[object Array]",a="[object Boolean]",l="[object Date]",c="[object Error]",f="[object Function]",g="[object GeneratorFunction]",h="[object Map]",d="[object Number]",m="[object Object]",v="[object Promise]",I="[object RegExp]",E="[object Set]",y="[object String]",p="[object Symbol]",A="[object WeakMap]",S="[object ArrayBuffer]",T="[object DataView]",B="[object Float32Array]",$="[object Float64Array]",X="[object Int8Array]",H="[object Int16Array]",N="[object Int32Array]",P="[object Uint8Array]",w="[object Uint8ClampedArray]",D="[object Uint16Array]",O="[object Uint32Array]",R=/[\\^$.*+?()[\]{}|]/g,M=/\w*$/,F=/^\[object .+?Constructor\]$/,q=/^(?:0|[1-9]\d*)$/,K={};K[i]=K[o]=K[S]=K[T]=K[a]=K[l]=K[B]=K[$]=K[X]=K[H]=K[N]=K[h]=K[d]=K[m]=K[I]=K[E]=K[y]=K[p]=K[P]=K[w]=K[D]=K[O]=!0,K[c]=K[f]=K[A]=!1;var oe=typeof ds=="object"&&ds&&ds.Object===Object&&ds,re=typeof self=="object"&&self&&self.Object===Object&&self,J=oe||re||Function("return this")(),Se=e&&!e.nodeType&&e,ne=Se&&!0&&n&&!n.nodeType&&n,ue=ne&&ne.exports===Se;function ve(u,b){return u.set(b[0],b[1]),u}function Q(u,b){return u.add(b),u}function be(u,b){for(var x=-1,Z=u?u.length:0;++x<Z&&b(u[x],x,u)!==!1;);return u}function Ae(u,b){for(var x=-1,Z=b.length,_e=u.length;++x<Z;)u[_e+x]=b[x];return u}function he(u,b,x,Z){for(var _e=-1,pe=u?u.length:0;++_e<pe;)x=b(x,u[_e],_e,u);return x}function Ie(u,b){for(var x=-1,Z=Array(u);++x<u;)Z[x]=b(x);return Z}function Ne(u,b){return u?.[b]}function we(u){var b=!1;if(u!=null&&typeof u.toString!="function")try{b=!!(u+"")}catch{}return b}function $e(u){var b=-1,x=Array(u.size);return u.forEach(function(Z,_e){x[++b]=[_e,Z]}),x}function vt(u,b){return function(x){return u(b(x))}}function Ut(u){var b=-1,x=Array(u.size);return u.forEach(function(Z){x[++b]=Z}),x}var Ct=Array.prototype,At=Function.prototype,ht=Object.prototype,kt=J["__core-js_shared__"],pt=(function(){var u=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""})(),rt=At.toString,Ue=ht.hasOwnProperty,mt=ht.toString,st=RegExp("^"+rt.call(Ue).replace(R,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xe=ue?J.Buffer:void 0,je=J.Symbol,yt=J.Uint8Array,Ye=vt(Object.getPrototypeOf,Object),ur=Object.create,Cn=ht.propertyIsEnumerable,Ts=Ct.splice,hr=Object.getOwnPropertySymbols,fr=Xe?Xe.isBuffer:void 0,Hr=vt(Object.keys,Object),Rn=Ft(J,"DataView"),qt=Ft(J,"Map"),Rt=Ft(J,"Promise"),Dt=Ft(J,"Set"),_t=Ft(J,"WeakMap"),Et=Ft(Object,"create"),_n=Tt(Rn),Bt=Tt(qt),Ln=Tt(Rt),En=Tt(Dt),dr=Tt(_t),un=je?je.prototype:void 0,gr=un?un.valueOf:void 0;function wt(u){var b=-1,x=u?u.length:0;for(this.clear();++b<x;){var Z=u[b];this.set(Z[0],Z[1])}}function Vt(){this.__data__=Et?Et(null):{}}function Wt(u){return this.has(u)&&delete this.__data__[u]}function On(u){var b=this.__data__;if(Et){var x=b[u];return x===r?void 0:x}return Ue.call(b,u)?b[u]:void 0}function zt(u){var b=this.__data__;return Et?b[u]!==void 0:Ue.call(b,u)}function kn(u,b){var x=this.__data__;return x[u]=Et&&b===void 0?r:b,this}wt.prototype.clear=Vt,wt.prototype.delete=Wt,wt.prototype.get=On,wt.prototype.has=zt,wt.prototype.set=kn;function Je(u){var b=-1,x=u?u.length:0;for(this.clear();++b<x;){var Z=u[b];this.set(Z[0],Z[1])}}function pr(){this.__data__=[]}function Qr(u){var b=this.__data__,x=te(b,u);if(x<0)return!1;var Z=b.length-1;return x==Z?b.pop():Ts.call(b,x,1),!0}function Sn(u){var b=this.__data__,x=te(b,u);return x<0?void 0:b[x][1]}function hn(u){return te(this.__data__,u)>-1}function Vr(u,b){var x=this.__data__,Z=te(x,u);return Z<0?x.push([u,b]):x[Z][1]=b,this}Je.prototype.clear=pr,Je.prototype.delete=Qr,Je.prototype.get=Sn,Je.prototype.has=hn,Je.prototype.set=Vr;function Qe(u){var b=-1,x=u?u.length:0;for(this.clear();++b<x;){var Z=u[b];this.set(Z[0],Z[1])}}function es(){this.__data__={hash:new wt,map:new(qt||Je),string:new wt}}function Dn(u){return Jt(this,u).delete(u)}function fn(u){return Jt(this,u).get(u)}function ts(u){return Jt(this,u).has(u)}function k(u,b){return Jt(this,u).set(u,b),this}Qe.prototype.clear=es,Qe.prototype.delete=Dn,Qe.prototype.get=fn,Qe.prototype.has=ts,Qe.prototype.set=k;function U(u){this.__data__=new Je(u)}function Y(){this.__data__=new Je}function ie(u){return this.__data__.delete(u)}function Ve(u){return this.__data__.get(u)}function Ce(u){return this.__data__.has(u)}function _(u,b){var x=this.__data__;if(x instanceof Je){var Z=x.__data__;if(!qt||Z.length<t-1)return Z.push([u,b]),this;x=this.__data__=new Qe(Z)}return x.set(u,b),this}U.prototype.clear=Y,U.prototype.delete=ie,U.prototype.get=Ve,U.prototype.has=Ce,U.prototype.set=_;function W(u,b){var x=Pi(u)||Hs(u)?Ie(u.length,String):[],Z=x.length,_e=!!Z;for(var pe in u)Ue.call(u,pe)&&!(_e&&(pe=="length"||ns(pe,Z)))&&x.push(pe);return x}function z(u,b,x){var Z=u[b];(!(Ue.call(u,b)&&Do(Z,x))||x===void 0&&!(b in u))&&(u[b]=x)}function te(u,b){for(var x=u.length;x--;)if(Do(u[x][0],b))return x;return-1}function Ee(u,b){return u&&ft(b,Ui(b),u)}function We(u,b,x,Z,_e,pe,Ke){var Ze;if(Z&&(Ze=pe?Z(u,_e,pe,Ke):Z(u)),Ze!==void 0)return Ze;if(!mr(u))return u;var xt=Pi(u);if(xt){if(Ze=Xs(u),!b)return Oe(u,Ze)}else{var qe=Lt(u),Ht=qe==f||qe==g;if(Bo(u))return Xt(u,b);if(qe==m||qe==i||Ht&&!pe){if(we(u))return pe?u:{};if(Ze=an(Ht?{}:u),!b)return ot(u,Ee(Ze,u))}else{if(!K[qe])return pe?u:{};Ze=xs(u,qe,We,b)}}Ke||(Ke=new U);var pn=Ke.get(u);if(pn)return pn;if(Ke.set(u,Ze),!xt)var Ot=x?on(u):Ui(u);return be(Ot||u,function(Qt,Gt){Ot&&(Gt=Qt,Qt=u[Gt]),z(Ze,Gt,We(Qt,b,x,Z,Gt,u,Ke))}),Ze}function et(u){return mr(u)?ur(u):{}}function Le(u,b,x){var Z=b(u);return Pi(u)?Z:Ae(Z,x(u))}function lt(u){return mt.call(u)}function tt(u){if(!mr(u)||Js(u))return!1;var b=Mi(u)||we(u)?st:F;return b.test(Tt(u))}function dn(u){if(!Pr(u))return Hr(u);var b=[];for(var x in Object(u))Ue.call(u,x)&&x!="constructor"&&b.push(x);return b}function Xt(u,b){if(b)return u.slice();var x=new u.constructor(u.length);return u.copy(x),x}function gn(u){var b=new u.constructor(u.byteLength);return new yt(b).set(new yt(u)),b}function ge(u,b){var x=b?gn(u.buffer):u.buffer;return new u.constructor(x,u.byteOffset,u.byteLength)}function Fe(u,b,x){var Z=b?x($e(u),!0):$e(u);return he(Z,ve,new u.constructor)}function it(u){var b=new u.constructor(u.source,M.exec(u));return b.lastIndex=u.lastIndex,b}function Re(u,b,x){var Z=b?x(Ut(u),!0):Ut(u);return he(Z,Q,new u.constructor)}function ke(u){return gr?Object(gr.call(u)):{}}function sn(u,b){var x=b?gn(u.buffer):u.buffer;return new u.constructor(x,u.byteOffset,u.length)}function Oe(u,b){var x=-1,Z=u.length;for(b||(b=Array(Z));++x<Z;)b[x]=u[x];return b}function ft(u,b,x,Z){x||(x={});for(var _e=-1,pe=b.length;++_e<pe;){var Ke=b[_e],Ze=void 0;z(x,Ke,Ze===void 0?u[Ke]:Ze)}return x}function ot(u,b){return ft(u,Zt(u),b)}function on(u){return Le(u,Ui,Zt)}function Jt(u,b){var x=u.__data__;return rs(b)?x[typeof b=="string"?"string":"hash"]:x.map}function Ft(u,b){var x=Ne(u,b);return tt(x)?x:void 0}var Zt=hr?vt(hr,Object):Ka,Lt=lt;(Rn&&Lt(new Rn(new ArrayBuffer(1)))!=T||qt&&Lt(new qt)!=h||Rt&&Lt(Rt.resolve())!=v||Dt&&Lt(new Dt)!=E||_t&&Lt(new _t)!=A)&&(Lt=function(u){var b=mt.call(u),x=b==m?u.constructor:void 0,Z=x?Tt(x):void 0;if(Z)switch(Z){case _n:return T;case Bt:return h;case Ln:return v;case En:return E;case dr:return A}return b});function Xs(u){var b=u.length,x=u.constructor(b);return b&&typeof u[0]=="string"&&Ue.call(u,"index")&&(x.index=u.index,x.input=u.input),x}function an(u){return typeof u.constructor=="function"&&!Pr(u)?et(Ye(u)):{}}function xs(u,b,x,Z){var _e=u.constructor;switch(b){case S:return gn(u);case a:case l:return new _e(+u);case T:return ge(u,Z);case B:case $:case X:case H:case N:case P:case w:case D:case O:return sn(u,Z);case h:return Fe(u,Z,x);case d:case y:return new _e(u);case I:return it(u);case E:return Re(u,Z,x);case p:return ke(u)}}function ns(u,b){return b=b??s,!!b&&(typeof u=="number"||q.test(u))&&u>-1&&u%1==0&&u<b}function rs(u){var b=typeof u;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?u!=="__proto__":u===null}function Js(u){return!!pt&&pt in u}function Pr(u){var b=u&&u.constructor,x=typeof b=="function"&&b.prototype||ht;return u===x}function Tt(u){if(u!=null){try{return rt.call(u)}catch{}try{return u+""}catch{}}return""}function ko(u){return We(u,!0,!0)}function Do(u,b){return u===b||u!==u&&b!==b}function Hs(u){return $a(u)&&Ue.call(u,"callee")&&(!Cn.call(u,"callee")||mt.call(u)==i)}var Pi=Array.isArray;function Qs(u){return u!=null&&Vo(u.length)&&!Mi(u)}function $a(u){return Po(u)&&Qs(u)}var Bo=fr||ja;function Mi(u){var b=mr(u)?mt.call(u):"";return b==f||b==g}function Vo(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=s}function mr(u){var b=typeof u;return!!u&&(b=="object"||b=="function")}function Po(u){return!!u&&typeof u=="object"}function Ui(u){return Qs(u)?W(u):dn(u)}function Ka(){return[]}function ja(){return!1}n.exports=ko})(zi,zi.exports)),zi.exports}var Xi={exports:{}};Xi.exports;var of;function tp(){return of||(of=1,(function(n,e){var t=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",f="[object Boolean]",g="[object Date]",h="[object Error]",d="[object Function]",m="[object GeneratorFunction]",v="[object Map]",I="[object Number]",E="[object Null]",y="[object Object]",p="[object Promise]",A="[object Proxy]",S="[object RegExp]",T="[object Set]",B="[object String]",$="[object Symbol]",X="[object Undefined]",H="[object WeakMap]",N="[object ArrayBuffer]",P="[object DataView]",w="[object Float32Array]",D="[object Float64Array]",O="[object Int8Array]",R="[object Int16Array]",M="[object Int32Array]",F="[object Uint8Array]",q="[object Uint8ClampedArray]",K="[object Uint16Array]",oe="[object Uint32Array]",re=/[\\^$.*+?()[\]{}|]/g,J=/^\[object .+?Constructor\]$/,Se=/^(?:0|[1-9]\d*)$/,ne={};ne[w]=ne[D]=ne[O]=ne[R]=ne[M]=ne[F]=ne[q]=ne[K]=ne[oe]=!0,ne[a]=ne[l]=ne[N]=ne[f]=ne[P]=ne[g]=ne[h]=ne[d]=ne[v]=ne[I]=ne[y]=ne[S]=ne[T]=ne[B]=ne[H]=!1;var ue=typeof ds=="object"&&ds&&ds.Object===Object&&ds,ve=typeof self=="object"&&self&&self.Object===Object&&self,Q=ue||ve||Function("return this")(),be=e&&!e.nodeType&&e,Ae=be&&!0&&n&&!n.nodeType&&n,he=Ae&&Ae.exports===be,Ie=he&&ue.process,Ne=(function(){try{return Ie&&Ie.binding&&Ie.binding("util")}catch{}})(),we=Ne&&Ne.isTypedArray;function $e(u,b){for(var x=-1,Z=u==null?0:u.length,_e=0,pe=[];++x<Z;){var Ke=u[x];b(Ke,x,u)&&(pe[_e++]=Ke)}return pe}function vt(u,b){for(var x=-1,Z=b.length,_e=u.length;++x<Z;)u[_e+x]=b[x];return u}function Ut(u,b){for(var x=-1,Z=u==null?0:u.length;++x<Z;)if(b(u[x],x,u))return!0;return!1}function Ct(u,b){for(var x=-1,Z=Array(u);++x<u;)Z[x]=b(x);return Z}function At(u){return function(b){return u(b)}}function ht(u,b){return u.has(b)}function kt(u,b){return u?.[b]}function pt(u){var b=-1,x=Array(u.size);return u.forEach(function(Z,_e){x[++b]=[_e,Z]}),x}function rt(u,b){return function(x){return u(b(x))}}function Ue(u){var b=-1,x=Array(u.size);return u.forEach(function(Z){x[++b]=Z}),x}var mt=Array.prototype,st=Function.prototype,Xe=Object.prototype,je=Q["__core-js_shared__"],yt=st.toString,Ye=Xe.hasOwnProperty,ur=(function(){var u=/[^.]+$/.exec(je&&je.keys&&je.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""})(),Cn=Xe.toString,Ts=RegExp("^"+yt.call(Ye).replace(re,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hr=he?Q.Buffer:void 0,fr=Q.Symbol,Hr=Q.Uint8Array,Rn=Xe.propertyIsEnumerable,qt=mt.splice,Rt=fr?fr.toStringTag:void 0,Dt=Object.getOwnPropertySymbols,_t=hr?hr.isBuffer:void 0,Et=rt(Object.keys,Object),_n=Zt(Q,"DataView"),Bt=Zt(Q,"Map"),Ln=Zt(Q,"Promise"),En=Zt(Q,"Set"),dr=Zt(Q,"WeakMap"),un=Zt(Object,"create"),gr=Tt(_n),wt=Tt(Bt),Vt=Tt(Ln),Wt=Tt(En),On=Tt(dr),zt=fr?fr.prototype:void 0,kn=zt?zt.valueOf:void 0;function Je(u){var b=-1,x=u==null?0:u.length;for(this.clear();++b<x;){var Z=u[b];this.set(Z[0],Z[1])}}function pr(){this.__data__=un?un(null):{},this.size=0}function Qr(u){var b=this.has(u)&&delete this.__data__[u];return this.size-=b?1:0,b}function Sn(u){var b=this.__data__;if(un){var x=b[u];return x===r?void 0:x}return Ye.call(b,u)?b[u]:void 0}function hn(u){var b=this.__data__;return un?b[u]!==void 0:Ye.call(b,u)}function Vr(u,b){var x=this.__data__;return this.size+=this.has(u)?0:1,x[u]=un&&b===void 0?r:b,this}Je.prototype.clear=pr,Je.prototype.delete=Qr,Je.prototype.get=Sn,Je.prototype.has=hn,Je.prototype.set=Vr;function Qe(u){var b=-1,x=u==null?0:u.length;for(this.clear();++b<x;){var Z=u[b];this.set(Z[0],Z[1])}}function es(){this.__data__=[],this.size=0}function Dn(u){var b=this.__data__,x=Xt(b,u);if(x<0)return!1;var Z=b.length-1;return x==Z?b.pop():qt.call(b,x,1),--this.size,!0}function fn(u){var b=this.__data__,x=Xt(b,u);return x<0?void 0:b[x][1]}function ts(u){return Xt(this.__data__,u)>-1}function k(u,b){var x=this.__data__,Z=Xt(x,u);return Z<0?(++this.size,x.push([u,b])):x[Z][1]=b,this}Qe.prototype.clear=es,Qe.prototype.delete=Dn,Qe.prototype.get=fn,Qe.prototype.has=ts,Qe.prototype.set=k;function U(u){var b=-1,x=u==null?0:u.length;for(this.clear();++b<x;){var Z=u[b];this.set(Z[0],Z[1])}}function Y(){this.size=0,this.__data__={hash:new Je,map:new(Bt||Qe),string:new Je}}function ie(u){var b=Ft(this,u).delete(u);return this.size-=b?1:0,b}function Ve(u){return Ft(this,u).get(u)}function Ce(u){return Ft(this,u).has(u)}function _(u,b){var x=Ft(this,u),Z=x.size;return x.set(u,b),this.size+=x.size==Z?0:1,this}U.prototype.clear=Y,U.prototype.delete=ie,U.prototype.get=Ve,U.prototype.has=Ce,U.prototype.set=_;function W(u){var b=-1,x=u==null?0:u.length;for(this.__data__=new U;++b<x;)this.add(u[b])}function z(u){return this.__data__.set(u,r),this}function te(u){return this.__data__.has(u)}W.prototype.add=W.prototype.push=z,W.prototype.has=te;function Ee(u){var b=this.__data__=new Qe(u);this.size=b.size}function We(){this.__data__=new Qe,this.size=0}function et(u){var b=this.__data__,x=b.delete(u);return this.size=b.size,x}function Le(u){return this.__data__.get(u)}function lt(u){return this.__data__.has(u)}function tt(u,b){var x=this.__data__;if(x instanceof Qe){var Z=x.__data__;if(!Bt||Z.length<t-1)return Z.push([u,b]),this.size=++x.size,this;x=this.__data__=new U(Z)}return x.set(u,b),this.size=x.size,this}Ee.prototype.clear=We,Ee.prototype.delete=et,Ee.prototype.get=Le,Ee.prototype.has=lt,Ee.prototype.set=tt;function dn(u,b){var x=Hs(u),Z=!x&&Do(u),_e=!x&&!Z&&Qs(u),pe=!x&&!Z&&!_e&&Po(u),Ke=x||Z||_e||pe,Ze=Ke?Ct(u.length,String):[],xt=Ze.length;for(var qe in u)Ye.call(u,qe)&&!(Ke&&(qe=="length"||_e&&(qe=="offset"||qe=="parent")||pe&&(qe=="buffer"||qe=="byteLength"||qe=="byteOffset")||xs(qe,xt)))&&Ze.push(qe);return Ze}function Xt(u,b){for(var x=u.length;x--;)if(ko(u[x][0],b))return x;return-1}function gn(u,b,x){var Z=b(u);return Hs(u)?Z:vt(Z,x(u))}function ge(u){return u==null?u===void 0?X:E:Rt&&Rt in Object(u)?Lt(u):Pr(u)}function Fe(u){return mr(u)&&ge(u)==a}function it(u,b,x,Z,_e){return u===b?!0:u==null||b==null||!mr(u)&&!mr(b)?u!==u&&b!==b:Re(u,b,x,Z,it,_e)}function Re(u,b,x,Z,_e,pe){var Ke=Hs(u),Ze=Hs(b),xt=Ke?l:an(u),qe=Ze?l:an(b);xt=xt==a?y:xt,qe=qe==a?y:qe;var Ht=xt==y,pn=qe==y,Ot=xt==qe;if(Ot&&Qs(u)){if(!Qs(b))return!1;Ke=!0,Ht=!1}if(Ot&&!Ht)return pe||(pe=new Ee),Ke||Po(u)?ft(u,b,x,Z,_e,pe):ot(u,b,xt,x,Z,_e,pe);if(!(x&s)){var Qt=Ht&&Ye.call(u,"__wrapped__"),Gt=pn&&Ye.call(b,"__wrapped__");if(Qt||Gt){var ss=Qt?u.value():u,Mr=Gt?b.value():b;return pe||(pe=new Ee),_e(ss,Mr,x,Z,pe)}}return Ot?(pe||(pe=new Ee),on(u,b,x,Z,_e,pe)):!1}function ke(u){if(!Vo(u)||rs(u))return!1;var b=Bo(u)?Ts:J;return b.test(Tt(u))}function sn(u){return mr(u)&&Mi(u.length)&&!!ne[ge(u)]}function Oe(u){if(!Js(u))return Et(u);var b=[];for(var x in Object(u))Ye.call(u,x)&&x!="constructor"&&b.push(x);return b}function ft(u,b,x,Z,_e,pe){var Ke=x&s,Ze=u.length,xt=b.length;if(Ze!=xt&&!(Ke&&xt>Ze))return!1;var qe=pe.get(u);if(qe&&pe.get(b))return qe==b;var Ht=-1,pn=!0,Ot=x&i?new W:void 0;for(pe.set(u,b),pe.set(b,u);++Ht<Ze;){var Qt=u[Ht],Gt=b[Ht];if(Z)var ss=Ke?Z(Gt,Qt,Ht,b,u,pe):Z(Qt,Gt,Ht,u,b,pe);if(ss!==void 0){if(ss)continue;pn=!1;break}if(Ot){if(!Ut(b,function(Mr,Cs){if(!ht(Ot,Cs)&&(Qt===Mr||_e(Qt,Mr,x,Z,pe)))return Ot.push(Cs)})){pn=!1;break}}else if(!(Qt===Gt||_e(Qt,Gt,x,Z,pe))){pn=!1;break}}return pe.delete(u),pe.delete(b),pn}function ot(u,b,x,Z,_e,pe,Ke){switch(x){case P:if(u.byteLength!=b.byteLength||u.byteOffset!=b.byteOffset)return!1;u=u.buffer,b=b.buffer;case N:return!(u.byteLength!=b.byteLength||!pe(new Hr(u),new Hr(b)));case f:case g:case I:return ko(+u,+b);case h:return u.name==b.name&&u.message==b.message;case S:case B:return u==b+"";case v:var Ze=pt;case T:var xt=Z&s;if(Ze||(Ze=Ue),u.size!=b.size&&!xt)return!1;var qe=Ke.get(u);if(qe)return qe==b;Z|=i,Ke.set(u,b);var Ht=ft(Ze(u),Ze(b),Z,_e,pe,Ke);return Ke.delete(u),Ht;case $:if(kn)return kn.call(u)==kn.call(b)}return!1}function on(u,b,x,Z,_e,pe){var Ke=x&s,Ze=Jt(u),xt=Ze.length,qe=Jt(b),Ht=qe.length;if(xt!=Ht&&!Ke)return!1;for(var pn=xt;pn--;){var Ot=Ze[pn];if(!(Ke?Ot in b:Ye.call(b,Ot)))return!1}var Qt=pe.get(u);if(Qt&&pe.get(b))return Qt==b;var Gt=!0;pe.set(u,b),pe.set(b,u);for(var ss=Ke;++pn<xt;){Ot=Ze[pn];var Mr=u[Ot],Cs=b[Ot];if(Z)var ou=Ke?Z(Cs,Mr,Ot,b,u,pe):Z(Mr,Cs,Ot,u,b,pe);if(!(ou===void 0?Mr===Cs||_e(Mr,Cs,x,Z,pe):ou)){Gt=!1;break}ss||(ss=Ot=="constructor")}if(Gt&&!ss){var Mo=u.constructor,Uo=b.constructor;Mo!=Uo&&"constructor"in u&&"constructor"in b&&!(typeof Mo=="function"&&Mo instanceof Mo&&typeof Uo=="function"&&Uo instanceof Uo)&&(Gt=!1)}return pe.delete(u),pe.delete(b),Gt}function Jt(u){return gn(u,Ui,Xs)}function Ft(u,b){var x=u.__data__;return ns(b)?x[typeof b=="string"?"string":"hash"]:x.map}function Zt(u,b){var x=kt(u,b);return ke(x)?x:void 0}function Lt(u){var b=Ye.call(u,Rt),x=u[Rt];try{u[Rt]=void 0;var Z=!0}catch{}var _e=Cn.call(u);return Z&&(b?u[Rt]=x:delete u[Rt]),_e}var Xs=Dt?function(u){return u==null?[]:(u=Object(u),$e(Dt(u),function(b){return Rn.call(u,b)}))}:Ka,an=ge;(_n&&an(new _n(new ArrayBuffer(1)))!=P||Bt&&an(new Bt)!=v||Ln&&an(Ln.resolve())!=p||En&&an(new En)!=T||dr&&an(new dr)!=H)&&(an=function(u){var b=ge(u),x=b==y?u.constructor:void 0,Z=x?Tt(x):"";if(Z)switch(Z){case gr:return P;case wt:return v;case Vt:return p;case Wt:return T;case On:return H}return b});function xs(u,b){return b=b??o,!!b&&(typeof u=="number"||Se.test(u))&&u>-1&&u%1==0&&u<b}function ns(u){var b=typeof u;return b=="string"||b=="number"||b=="symbol"||b=="boolean"?u!=="__proto__":u===null}function rs(u){return!!ur&&ur in u}function Js(u){var b=u&&u.constructor,x=typeof b=="function"&&b.prototype||Xe;return u===x}function Pr(u){return Cn.call(u)}function Tt(u){if(u!=null){try{return yt.call(u)}catch{}try{return u+""}catch{}}return""}function ko(u,b){return u===b||u!==u&&b!==b}var Do=Fe((function(){return arguments})())?Fe:function(u){return mr(u)&&Ye.call(u,"callee")&&!Rn.call(u,"callee")},Hs=Array.isArray;function Pi(u){return u!=null&&Mi(u.length)&&!Bo(u)}var Qs=_t||ja;function $a(u,b){return it(u,b)}function Bo(u){if(!Vo(u))return!1;var b=ge(u);return b==d||b==m||b==c||b==A}function Mi(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=o}function Vo(u){var b=typeof u;return u!=null&&(b=="object"||b=="function")}function mr(u){return u!=null&&typeof u=="object"}var Po=we?At(we):sn;function Ui(u){return Pi(u)?dn(u):Oe(u)}function Ka(){return[]}function ja(){return!1}n.exports=$a})(Xi,Xi.exports)),Xi.exports}var Jo={},af;function bI(){if(af)return Jo;af=1,Object.defineProperty(Jo,"__esModule",{value:!0});const n=ep(),e=tp();var t;return(function(r){function s(l={},c={},f=!1){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});let g=n(c);f||(g=Object.keys(g).reduce((h,d)=>(g[d]!=null&&(h[d]=g[d]),h),{}));for(const h in l)l[h]!==void 0&&c[h]===void 0&&(g[h]=l[h]);return Object.keys(g).length>0?g:void 0}r.compose=s;function i(l={},c={}){typeof l!="object"&&(l={}),typeof c!="object"&&(c={});const f=Object.keys(l).concat(Object.keys(c)).reduce((g,h)=>(e(l[h],c[h])||(g[h]=c[h]===void 0?null:c[h]),g),{});return Object.keys(f).length>0?f:void 0}r.diff=i;function o(l={},c={}){l=l||{};const f=Object.keys(c).reduce((g,h)=>(c[h]!==l[h]&&l[h]!==void 0&&(g[h]=c[h]),g),{});return Object.keys(l).reduce((g,h)=>(l[h]!==c[h]&&c[h]===void 0&&(g[h]=null),g),f)}r.invert=o;function a(l,c,f=!1){if(typeof l!="object")return c;if(typeof c!="object")return;if(!f)return c;const g=Object.keys(c).reduce((h,d)=>(l[d]===void 0&&(h[d]=c[d]),h),{});return Object.keys(g).length>0?g:void 0}r.transform=a})(t||(t={})),Jo.default=t,Jo}var Ho={},lf;function np(){if(lf)return Ho;lf=1,Object.defineProperty(Ho,"__esModule",{value:!0});var n;return(function(e){function t(r){return typeof r.delete=="number"?r.delete:typeof r.retain=="number"?r.retain:typeof r.retain=="object"&&r.retain!==null?1:typeof r.insert=="string"?r.insert.length:1}e.length=t})(n||(n={})),Ho.default=n,Ho}var Qo={},cf;function yI(){if(cf)return Qo;cf=1,Object.defineProperty(Qo,"__esModule",{value:!0});const n=np();class e{constructor(r){this.ops=r,this.index=0,this.offset=0}hasNext(){return this.peekLength()<1/0}next(r){r||(r=1/0);const s=this.ops[this.index];if(s){const i=this.offset,o=n.default.length(s);if(r>=o-i?(r=o-i,this.index+=1,this.offset=0):this.offset+=r,typeof s.delete=="number")return{delete:r};{const a={};return s.attributes&&(a.attributes=s.attributes),typeof s.retain=="number"?a.retain=r:typeof s.retain=="object"&&s.retain!==null?a.retain=s.retain:typeof s.insert=="string"?a.insert=s.insert.substr(i,r):a.insert=s.insert,a}}else return{retain:1/0}}peek(){return this.ops[this.index]}peekLength(){return this.ops[this.index]?n.default.length(this.ops[this.index])-this.offset:1/0}peekType(){const r=this.ops[this.index];return r?typeof r.delete=="number"?"delete":typeof r.retain=="number"||typeof r.retain=="object"&&r.retain!==null?"retain":"insert":"retain"}rest(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);{const r=this.offset,s=this.index,i=this.next(),o=this.ops.slice(this.index);return this.offset=r,this.index=s,[i].concat(o)}}else return[]}}return Qo.default=e,Qo}var uf;function vI(){return uf||(uf=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.AttributeMap=e.OpIterator=e.Op=void 0;const t=mI(),r=ep(),s=tp(),i=bI();e.AttributeMap=i.default;const o=np();e.Op=o.default;const a=yI();e.OpIterator=a.default;const l="\0",c=(g,h)=>{if(typeof g!="object"||g===null)throw new Error(`cannot retain a ${typeof g}`);if(typeof h!="object"||h===null)throw new Error(`cannot retain a ${typeof h}`);const d=Object.keys(g)[0];if(!d||d!==Object.keys(h)[0])throw new Error(`embed types not matched: ${d} != ${Object.keys(h)[0]}`);return[d,g[d],h[d]]};class f{constructor(h){Array.isArray(h)?this.ops=h:h!=null&&Array.isArray(h.ops)?this.ops=h.ops:this.ops=[]}static registerEmbed(h,d){this.handlers[h]=d}static unregisterEmbed(h){delete this.handlers[h]}static getHandler(h){const d=this.handlers[h];if(!d)throw new Error(`no handlers for embed type "${h}"`);return d}insert(h,d){const m={};return typeof h=="string"&&h.length===0?this:(m.insert=h,d!=null&&typeof d=="object"&&Object.keys(d).length>0&&(m.attributes=d),this.push(m))}delete(h){return h<=0?this:this.push({delete:h})}retain(h,d){if(typeof h=="number"&&h<=0)return this;const m={retain:h};return d!=null&&typeof d=="object"&&Object.keys(d).length>0&&(m.attributes=d),this.push(m)}push(h){let d=this.ops.length,m=this.ops[d-1];if(h=r(h),typeof m=="object"){if(typeof h.delete=="number"&&typeof m.delete=="number")return this.ops[d-1]={delete:m.delete+h.delete},this;if(typeof m.delete=="number"&&h.insert!=null&&(d-=1,m=this.ops[d-1],typeof m!="object"))return this.ops.unshift(h),this;if(s(h.attributes,m.attributes)){if(typeof h.insert=="string"&&typeof m.insert=="string")return this.ops[d-1]={insert:m.insert+h.insert},typeof h.attributes=="object"&&(this.ops[d-1].attributes=h.attributes),this;if(typeof h.retain=="number"&&typeof m.retain=="number")return this.ops[d-1]={retain:m.retain+h.retain},typeof h.attributes=="object"&&(this.ops[d-1].attributes=h.attributes),this}}return d===this.ops.length?this.ops.push(h):this.ops.splice(d,0,h),this}chop(){const h=this.ops[this.ops.length-1];return h&&typeof h.retain=="number"&&!h.attributes&&this.ops.pop(),this}filter(h){return this.ops.filter(h)}forEach(h){this.ops.forEach(h)}map(h){return this.ops.map(h)}partition(h){const d=[],m=[];return this.forEach(v=>{(h(v)?d:m).push(v)}),[d,m]}reduce(h,d){return this.ops.reduce(h,d)}changeLength(){return this.reduce((h,d)=>d.insert?h+o.default.length(d):d.delete?h-d.delete:h,0)}length(){return this.reduce((h,d)=>h+o.default.length(d),0)}slice(h=0,d=1/0){const m=[],v=new a.default(this.ops);let I=0;for(;I<d&&v.hasNext();){let E;I<h?E=v.next(h-I):(E=v.next(d-I),m.push(E)),I+=o.default.length(E)}return new f(m)}compose(h){const d=new a.default(this.ops),m=new a.default(h.ops),v=[],I=m.peek();if(I!=null&&typeof I.retain=="number"&&I.attributes==null){let y=I.retain;for(;d.peekType()==="insert"&&d.peekLength()<=y;)y-=d.peekLength(),v.push(d.next());I.retain-y>0&&m.next(I.retain-y)}const E=new f(v);for(;d.hasNext()||m.hasNext();)if(m.peekType()==="insert")E.push(m.next());else if(d.peekType()==="delete")E.push(d.next());else{const y=Math.min(d.peekLength(),m.peekLength()),p=d.next(y),A=m.next(y);if(A.retain){const S={};if(typeof p.retain=="number")S.retain=typeof A.retain=="number"?y:A.retain;else if(typeof A.retain=="number")p.retain==null?S.insert=p.insert:S.retain=p.retain;else{const B=p.retain==null?"insert":"retain",[$,X,H]=c(p[B],A.retain),N=f.getHandler($);S[B]={[$]:N.compose(X,H,B==="retain")}}const T=i.default.compose(p.attributes,A.attributes,typeof p.retain=="number");if(T&&(S.attributes=T),E.push(S),!m.hasNext()&&s(E.ops[E.ops.length-1],S)){const B=new f(d.rest());return E.concat(B).chop()}}else typeof A.delete=="number"&&(typeof p.retain=="number"||typeof p.retain=="object"&&p.retain!==null)&&E.push(A)}return E.chop()}concat(h){const d=new f(this.ops.slice());return h.ops.length>0&&(d.push(h.ops[0]),d.ops=d.ops.concat(h.ops.slice(1))),d}diff(h,d){if(this.ops===h.ops)return new f;const m=[this,h].map(p=>p.map(A=>{if(A.insert!=null)return typeof A.insert=="string"?A.insert:l;const S=p===h?"on":"with";throw new Error("diff() called "+S+" non-document")}).join("")),v=new f,I=t(m[0],m[1],d,!0),E=new a.default(this.ops),y=new a.default(h.ops);return I.forEach(p=>{let A=p[1].length;for(;A>0;){let S=0;switch(p[0]){case t.INSERT:S=Math.min(y.peekLength(),A),v.push(y.next(S));break;case t.DELETE:S=Math.min(A,E.peekLength()),E.next(S),v.delete(S);break;case t.EQUAL:S=Math.min(E.peekLength(),y.peekLength(),A);const T=E.next(S),B=y.next(S);s(T.insert,B.insert)?v.retain(S,i.default.diff(T.attributes,B.attributes)):v.push(B).delete(S);break}A-=S}}),v.chop()}eachLine(h,d=`
`){const m=new a.default(this.ops);let v=new f,I=0;for(;m.hasNext();){if(m.peekType()!=="insert")return;const E=m.peek(),y=o.default.length(E)-m.peekLength(),p=typeof E.insert=="string"?E.insert.indexOf(d,y)-y:-1;if(p<0)v.push(m.next());else if(p>0)v.push(m.next(p));else{if(h(v,m.next(1).attributes||{},I)===!1)return;I+=1,v=new f}}v.length()>0&&h(v,{},I)}invert(h){const d=new f;return this.reduce((m,v)=>{if(v.insert)d.delete(o.default.length(v));else{if(typeof v.retain=="number"&&v.attributes==null)return d.retain(v.retain),m+v.retain;if(v.delete||typeof v.retain=="number"){const I=v.delete||v.retain;return h.slice(m,m+I).forEach(y=>{v.delete?d.push(y):v.retain&&v.attributes&&d.retain(o.default.length(y),i.default.invert(v.attributes,y.attributes))}),m+I}else if(typeof v.retain=="object"&&v.retain!==null){const I=h.slice(m,m+1),E=new a.default(I.ops).next(),[y,p,A]=c(v.retain,E.insert),S=f.getHandler(y);return d.retain({[y]:S.invert(p,A)},i.default.invert(v.attributes,E.attributes)),m+1}}return m},0),d.chop()}transform(h,d=!1){if(d=!!d,typeof h=="number")return this.transformPosition(h,d);const m=h,v=new a.default(this.ops),I=new a.default(m.ops),E=new f;for(;v.hasNext()||I.hasNext();)if(v.peekType()==="insert"&&(d||I.peekType()!=="insert"))E.retain(o.default.length(v.next()));else if(I.peekType()==="insert")E.push(I.next());else{const y=Math.min(v.peekLength(),I.peekLength()),p=v.next(y),A=I.next(y);if(p.delete)continue;if(A.delete)E.push(A);else{const S=p.retain,T=A.retain;let B=typeof T=="object"&&T!==null?T:y;if(typeof S=="object"&&S!==null&&typeof T=="object"&&T!==null){const $=Object.keys(S)[0];if($===Object.keys(T)[0]){const X=f.getHandler($);X&&(B={[$]:X.transform(S[$],T[$],d)})}}E.retain(B,i.default.transform(p.attributes,A.attributes,d))}}return E.chop()}transformPosition(h,d=!1){d=!!d;const m=new a.default(this.ops);let v=0;for(;m.hasNext()&&v<=h;){const I=m.peekLength(),E=m.peekType();if(m.next(),E==="delete"){h-=Math.min(I,h-v);continue}else E==="insert"&&(v<h||!d)&&(h+=I);v+=I}return h}}f.Op=o.default,f.OpIterator=a.default,f.AttributeMap=i.default,f.handlers={},e.default=f,n.exports=f,n.exports.default=f})(Xo,Xo.exports)),Xo.exports}var Wn=vI();const le=qc(Wn);class cr extends xn{static value(){}optimize(){(this.prev||this.next)&&this.remove()}length(){return 0}value(){return""}}cr.blotName="break";cr.tagName="BR";let or=class extends Sa{};const AI={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Fa(n){return n.replace(/[&<>"']/g,e=>AI[e])}class ln extends jc{static allowedChildren=[ln,cr,xn,or];static order=["cursor","inline","link","underline","strike","italic","bold","script","code"];static compare(e,t){const r=ln.order.indexOf(e),s=ln.order.indexOf(t);return r>=0||s>=0?r-s:e===t?0:e<t?-1:1}formatAt(e,t,r,s){if(ln.compare(this.statics.blotName,r)<0&&this.scroll.query(r,de.BLOT)){const i=this.isolate(e,t);s&&i.wrap(r,s)}else super.formatAt(e,t,r,s)}optimize(e){if(super.optimize(e),this.parent instanceof ln&&ln.compare(this.statics.blotName,this.parent.statics.blotName)>0){const t=this.parent.isolate(this.offset(),this.length());this.moveChildren(t),t.wrap(this)}}}const hf=1;class Yt extends Ao{cache={};delta(){return this.cache.delta==null&&(this.cache.delta=rp(this)),this.cache.delta}deleteAt(e,t){super.deleteAt(e,t),this.cache={}}formatAt(e,t,r,s){t<=0||(this.scroll.query(r,de.BLOCK)?e+t===this.length()&&this.format(r,s):super.formatAt(e,Math.min(t,this.length()-e-1),r,s),this.cache={})}insertAt(e,t,r){if(r!=null){super.insertAt(e,t,r),this.cache={};return}if(t.length===0)return;const s=t.split(`
`),i=s.shift();i.length>0&&(e<this.length()-1||this.children.tail==null?super.insertAt(Math.min(e,this.length()-1),i):this.children.tail.insertAt(this.children.tail.length(),i),this.cache={});let o=this;s.reduce((a,l)=>(o=o.split(a,!0),o.insertAt(0,l),l.length),e+i.length)}insertBefore(e,t){const{head:r}=this.children;super.insertBefore(e,t),r instanceof cr&&r.remove(),this.cache={}}length(){return this.cache.length==null&&(this.cache.length=super.length()+hf),this.cache.length}moveChildren(e,t){super.moveChildren(e,t),this.cache={}}optimize(e){super.optimize(e),this.cache={}}path(e){return super.path(e,!0)}removeChild(e){super.removeChild(e),this.cache={}}split(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(t&&(e===0||e>=this.length()-hf)){const s=this.clone();return e===0?(this.parent.insertBefore(s,this),this):(this.parent.insertBefore(s,this.next),s)}const r=super.split(e,t);return this.cache={},r}}Yt.blotName="block";Yt.tagName="P";Yt.defaultChild=cr;Yt.allowedChildren=[cr,ln,xn,or];class Pn extends xn{attach(){super.attach(),this.attributes=new Ua(this.domNode)}delta(){return new le().insert(this.value(),{...this.formats(),...this.attributes.values()})}format(e,t){const r=this.scroll.query(e,de.BLOCK_ATTRIBUTE);r!=null&&this.attributes.attribute(r,t)}formatAt(e,t,r,s){this.format(r,s)}insertAt(e,t,r){if(r!=null){super.insertAt(e,t,r);return}const s=t.split(`
`),i=s.pop(),o=s.map(l=>{const c=this.scroll.create(Yt.blotName);return c.insertAt(0,l),c}),a=this.split(e);o.forEach(l=>{this.parent.insertBefore(l,a)}),i&&this.parent.insertBefore(this.scroll.create("text",i),a)}}Pn.scope=de.BLOCK_BLOT;function rp(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return n.descendants(en).reduce((t,r)=>r.length()===0?t:t.insert(r.value(),Bn(r,{},e)),new le).insert(`
`,Bn(n))}function Bn(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return n==null||("formats"in n&&typeof n.formats=="function"&&(e={...e,...n.formats()},t&&delete e["code-token"]),n.parent==null||n.parent.statics.blotName==="scroll"||n.parent.statics.scope!==n.statics.scope)?e:Bn(n.parent,e,t)}class er extends xn{static blotName="cursor";static className="ql-cursor";static tagName="span";static CONTENTS="\uFEFF";static value(){}constructor(e,t,r){super(e,t),this.selection=r,this.textNode=document.createTextNode(er.CONTENTS),this.domNode.appendChild(this.textNode),this.savedLength=0}detach(){this.parent!=null&&this.parent.removeChild(this)}format(e,t){if(this.savedLength!==0){super.format(e,t);return}let r=this,s=0;for(;r!=null&&r.statics.scope!==de.BLOCK_BLOT;)s+=r.offset(r.parent),r=r.parent;r!=null&&(this.savedLength=er.CONTENTS.length,r.optimize(),r.formatAt(s,er.CONTENTS.length,e,t),this.savedLength=0)}index(e,t){return e===this.textNode?0:super.index(e,t)}length(){return this.savedLength}position(){return[this.textNode,this.textNode.data.length]}remove(){super.remove(),this.parent=null}restore(){if(this.selection.composing||this.parent==null)return null;const e=this.selection.getNativeRange();for(;this.domNode.lastChild!=null&&this.domNode.lastChild!==this.textNode;)this.domNode.parentNode.insertBefore(this.domNode.lastChild,this.domNode);const t=this.prev instanceof or?this.prev:null,r=t?t.length():0,s=this.next instanceof or?this.next:null,i=s?s.text:"",{textNode:o}=this,a=o.data.split(er.CONTENTS).join("");o.data=er.CONTENTS;let l;if(t)l=t,(a||s)&&(t.insertAt(t.length(),a+i),s&&s.remove());else if(s)l=s,s.insertAt(0,a);else{const c=document.createTextNode(a);l=this.scroll.create(c),this.parent.insertBefore(l,this)}if(this.remove(),e){const c=(h,d)=>t&&h===t.domNode?d:h===o?r+d-1:s&&h===s.domNode?r+a.length+d:null,f=c(e.start.node,e.start.offset),g=c(e.end.node,e.end.offset);if(f!==null&&g!==null)return{startNode:l.domNode,startOffset:f,endNode:l.domNode,endOffset:g}}return null}update(e,t){if(e.some(r=>r.type==="characterData"&&r.target===this.textNode)){const r=this.restore();r&&(t.range=r)}}optimize(e){super.optimize(e);let{parent:t}=this;for(;t;){if(t.domNode.tagName==="A"){this.savedLength=er.CONTENTS.length,t.isolate(this.offset(t),this.length()).unwrap(),this.savedLength=0;break}t=t.parent}}value(){return""}}var ul={exports:{}},ff;function EI(){return ff||(ff=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(l,c,f){this.fn=l,this.context=c,this.once=f||!1}function i(l,c,f,g,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var d=new s(f,g||l,h),m=t?t+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],d]:l._events[m].push(d):(l._events[m]=d,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],f,g;if(this._eventsCount===0)return c;for(g in f=this._events)e.call(f,g)&&c.push(t?g.slice(1):g);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(f)):c},a.prototype.listeners=function(c){var f=t?t+c:c,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var h=0,d=g.length,m=new Array(d);h<d;h++)m[h]=g[h].fn;return m},a.prototype.listenerCount=function(c){var f=t?t+c:c,g=this._events[f];return g?g.fn?1:g.length:0},a.prototype.emit=function(c,f,g,h,d,m){var v=t?t+c:c;if(!this._events[v])return!1;var I=this._events[v],E=arguments.length,y,p;if(I.fn){switch(I.once&&this.removeListener(c,I.fn,void 0,!0),E){case 1:return I.fn.call(I.context),!0;case 2:return I.fn.call(I.context,f),!0;case 3:return I.fn.call(I.context,f,g),!0;case 4:return I.fn.call(I.context,f,g,h),!0;case 5:return I.fn.call(I.context,f,g,h,d),!0;case 6:return I.fn.call(I.context,f,g,h,d,m),!0}for(p=1,y=new Array(E-1);p<E;p++)y[p-1]=arguments[p];I.fn.apply(I.context,y)}else{var A=I.length,S;for(p=0;p<A;p++)switch(I[p].once&&this.removeListener(c,I[p].fn,void 0,!0),E){case 1:I[p].fn.call(I[p].context);break;case 2:I[p].fn.call(I[p].context,f);break;case 3:I[p].fn.call(I[p].context,f,g);break;case 4:I[p].fn.call(I[p].context,f,g,h);break;default:if(!y)for(S=1,y=new Array(E-1);S<E;S++)y[S-1]=arguments[S];I[p].fn.apply(I[p].context,y)}}return!0},a.prototype.on=function(c,f,g){return i(this,c,f,g,!1)},a.prototype.once=function(c,f,g){return i(this,c,f,g,!0)},a.prototype.removeListener=function(c,f,g,h){var d=t?t+c:c;if(!this._events[d])return this;if(!f)return o(this,d),this;var m=this._events[d];if(m.fn)m.fn===f&&(!h||m.once)&&(!g||m.context===g)&&o(this,d);else{for(var v=0,I=[],E=m.length;v<E;v++)(m[v].fn!==f||h&&!m[v].once||g&&m[v].context!==g)&&I.push(m[v]);I.length?this._events[d]=I.length===1?I[0]:I:o(this,d)}return this},a.prototype.removeAllListeners=function(c){var f;return c?(f=t?t+c:c,this._events[f]&&o(this,f)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(ul)),ul.exports}var SI=EI();const II=qc(SI),Yl=new WeakMap,ql=["error","warn","log","info"];let zl="warn";function sp(n){if(zl&&ql.indexOf(n)<=ql.indexOf(zl)){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];console[n](...t)}}function Jr(n){return ql.reduce((e,t)=>(e[t]=sp.bind(console,t,n),e),{})}Jr.level=n=>{zl=n};sp.level=Jr.level;const hl=Jr("quill:events"),NI=["selectionchange","mousedown","mouseup","click"];NI.forEach(n=>{document.addEventListener(n,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];Array.from(document.querySelectorAll(".ql-container")).forEach(s=>{const i=Yl.get(s);i&&i.emitter&&i.emitter.handleDOM(...t)})})});class ce extends II{static events={EDITOR_CHANGE:"editor-change",SCROLL_BEFORE_UPDATE:"scroll-before-update",SCROLL_BLOT_MOUNT:"scroll-blot-mount",SCROLL_BLOT_UNMOUNT:"scroll-blot-unmount",SCROLL_OPTIMIZE:"scroll-optimize",SCROLL_UPDATE:"scroll-update",SCROLL_EMBED_UPDATE:"scroll-embed-update",SELECTION_CHANGE:"selection-change",TEXT_CHANGE:"text-change",COMPOSITION_BEFORE_START:"composition-before-start",COMPOSITION_START:"composition-start",COMPOSITION_BEFORE_END:"composition-before-end",COMPOSITION_END:"composition-end"};static sources={API:"api",SILENT:"silent",USER:"user"};constructor(){super(),this.domListeners={},this.on("error",hl.error)}emit(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return hl.log.call(hl,...t),super.emit(...t)}handleDOM(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];(this.domListeners[e.type]||[]).forEach(i=>{let{node:o,handler:a}=i;(e.target===o||o.contains(e.target))&&a(e,...r)})}listenDOM(e,t,r){this.domListeners[e]||(this.domListeners[e]=[]),this.domListeners[e].push({node:t,handler:r})}}const fl=Jr("quill:selection");class Fs{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.index=e,this.length=t}}class wI{constructor(e,t){this.emitter=t,this.scroll=e,this.composing=!1,this.mouseDown=!1,this.root=this.scroll.domNode,this.cursor=this.scroll.create("cursor",this),this.savedRange=new Fs(0,0),this.lastRange=this.savedRange,this.lastNative=null,this.handleComposition(),this.handleDragging(),this.emitter.listenDOM("selectionchange",document,()=>{!this.mouseDown&&!this.composing&&setTimeout(this.update.bind(this,ce.sources.USER),1)}),this.emitter.on(ce.events.SCROLL_BEFORE_UPDATE,()=>{if(!this.hasFocus())return;const r=this.getNativeRange();r!=null&&r.start.node!==this.cursor.textNode&&this.emitter.once(ce.events.SCROLL_UPDATE,(s,i)=>{try{this.root.contains(r.start.node)&&this.root.contains(r.end.node)&&this.setNativeRange(r.start.node,r.start.offset,r.end.node,r.end.offset);const o=i.some(a=>a.type==="characterData"||a.type==="childList"||a.type==="attributes"&&a.target===this.root);this.update(o?ce.sources.SILENT:s)}catch{}})}),this.emitter.on(ce.events.SCROLL_OPTIMIZE,(r,s)=>{if(s.range){const{startNode:i,startOffset:o,endNode:a,endOffset:l}=s.range;this.setNativeRange(i,o,a,l),this.update(ce.sources.SILENT)}}),this.update(ce.sources.SILENT)}handleComposition(){this.emitter.on(ce.events.COMPOSITION_BEFORE_START,()=>{this.composing=!0}),this.emitter.on(ce.events.COMPOSITION_END,()=>{if(this.composing=!1,this.cursor.parent){const e=this.cursor.restore();if(!e)return;setTimeout(()=>{this.setNativeRange(e.startNode,e.startOffset,e.endNode,e.endOffset)},1)}})}handleDragging(){this.emitter.listenDOM("mousedown",document.body,()=>{this.mouseDown=!0}),this.emitter.listenDOM("mouseup",document.body,()=>{this.mouseDown=!1,this.update(ce.sources.USER)})}focus(){this.hasFocus()||(this.root.focus({preventScroll:!0}),this.setRange(this.savedRange))}format(e,t){this.scroll.update();const r=this.getNativeRange();if(!(r==null||!r.native.collapsed||this.scroll.query(e,de.BLOCK))){if(r.start.node!==this.cursor.textNode){const s=this.scroll.find(r.start.node,!1);if(s==null)return;if(s instanceof en){const i=s.split(r.start.offset);s.parent.insertBefore(this.cursor,i)}else s.insertBefore(this.cursor,r.start.node);this.cursor.attach()}this.cursor.format(e,t),this.scroll.optimize(),this.setNativeRange(this.cursor.textNode,this.cursor.textNode.data.length),this.update()}}getBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const r=this.scroll.length();e=Math.min(e,r-1),t=Math.min(e+t,r-1)-e;let s,[i,o]=this.scroll.leaf(e);if(i==null)return null;if(t>0&&o===i.length()){const[f]=this.scroll.leaf(e+1);if(f){const[g]=this.scroll.line(e),[h]=this.scroll.line(e+1);g===h&&(i=f,o=0)}}[s,o]=i.position(o,!0);const a=document.createRange();if(t>0)return a.setStart(s,o),[i,o]=this.scroll.leaf(e+t),i==null?null:([s,o]=i.position(o,!0),a.setEnd(s,o),a.getBoundingClientRect());let l="left",c;if(s instanceof Text){if(!s.data.length)return null;o<s.data.length?(a.setStart(s,o),a.setEnd(s,o+1)):(a.setStart(s,o-1),a.setEnd(s,o),l="right"),c=a.getBoundingClientRect()}else{if(!(i.domNode instanceof Element))return null;c=i.domNode.getBoundingClientRect(),o>0&&(l="right")}return{bottom:c.top+c.height,height:c.height,left:c[l],right:c[l],top:c.top,width:0}}getNativeRange(){const e=document.getSelection();if(e==null||e.rangeCount<=0)return null;const t=e.getRangeAt(0);if(t==null)return null;const r=this.normalizeNative(t);return fl.info("getNativeRange",r),r}getRange(){const e=this.scroll.domNode;if("isConnected"in e&&!e.isConnected)return[null,null];const t=this.getNativeRange();return t==null?[null,null]:[this.normalizedToRange(t),t]}hasFocus(){return document.activeElement===this.root||document.activeElement!=null&&dl(this.root,document.activeElement)}normalizedToRange(e){const t=[[e.start.node,e.start.offset]];e.native.collapsed||t.push([e.end.node,e.end.offset]);const r=t.map(o=>{const[a,l]=o,c=this.scroll.find(a,!0),f=c.offset(this.scroll);return l===0?f:c instanceof en?f+c.index(a,l):f+c.length()}),s=Math.min(Math.max(...r),this.scroll.length()-1),i=Math.min(s,...r);return new Fs(i,s-i)}normalizeNative(e){if(!dl(this.root,e.startContainer)||!e.collapsed&&!dl(this.root,e.endContainer))return null;const t={start:{node:e.startContainer,offset:e.startOffset},end:{node:e.endContainer,offset:e.endOffset},native:e};return[t.start,t.end].forEach(r=>{let{node:s,offset:i}=r;for(;!(s instanceof Text)&&s.childNodes.length>0;)if(s.childNodes.length>i)s=s.childNodes[i],i=0;else if(s.childNodes.length===i)s=s.lastChild,s instanceof Text?i=s.data.length:s.childNodes.length>0?i=s.childNodes.length:i=s.childNodes.length+1;else break;r.node=s,r.offset=i}),t}rangeToNative(e){const t=this.scroll.length(),r=(s,i)=>{s=Math.min(t-1,s);const[o,a]=this.scroll.leaf(s);return o?o.position(a,i):[null,-1]};return[...r(e.index,!1),...r(e.index+e.length,!0)]}setNativeRange(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:t,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1;if(fl.info("setNativeRange",e,t,r,s),e!=null&&(this.root.parentNode==null||e.parentNode==null||r.parentNode==null))return;const o=document.getSelection();if(o!=null)if(e!=null){this.hasFocus()||this.root.focus({preventScroll:!0});const{native:a}=this.getNativeRange()||{};if(a==null||i||e!==a.startContainer||t!==a.startOffset||r!==a.endContainer||s!==a.endOffset){e instanceof Element&&e.tagName==="BR"&&(t=Array.from(e.parentNode.childNodes).indexOf(e),e=e.parentNode),r instanceof Element&&r.tagName==="BR"&&(s=Array.from(r.parentNode.childNodes).indexOf(r),r=r.parentNode);const l=document.createRange();l.setStart(e,t),l.setEnd(r,s),o.removeAllRanges(),o.addRange(l)}}else o.removeAllRanges(),this.root.blur()}setRange(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ce.sources.API;if(typeof t=="string"&&(r=t,t=!1),fl.info("setRange",e),e!=null){const s=this.rangeToNative(e);this.setNativeRange(...s,t)}else this.setNativeRange(null);this.update(r)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ce.sources.USER;const t=this.lastRange,[r,s]=this.getRange();if(this.lastRange=r,this.lastNative=s,this.lastRange!=null&&(this.savedRange=this.lastRange),!Kc(t,this.lastRange)){if(!this.composing&&s!=null&&s.native.collapsed&&s.start.node!==this.cursor.textNode){const o=this.cursor.restore();o&&this.setNativeRange(o.startNode,o.startOffset,o.endNode,o.endOffset)}const i=[ce.events.SELECTION_CHANGE,yi(this.lastRange),yi(t),e];this.emitter.emit(ce.events.EDITOR_CHANGE,...i),e!==ce.sources.SILENT&&this.emitter.emit(...i)}}}function dl(n,e){try{e.parentNode}catch{return!1}return n.contains(e)}const TI=/^[ -~]*$/;class xI{constructor(e){this.scroll=e,this.delta=this.getDelta()}applyDelta(e){this.scroll.update();let t=this.scroll.length();this.scroll.batchStart();const r=df(e),s=new le;return RI(r.ops.slice()).reduce((o,a)=>{const l=Wn.Op.length(a);let c=a.attributes||{},f=!1,g=!1;if(a.insert!=null){if(s.retain(l),typeof a.insert=="string"){const m=a.insert;g=!m.endsWith(`
`)&&(t<=o||!!this.scroll.descendant(Pn,o)[0]),this.scroll.insertAt(o,m);const[v,I]=this.scroll.line(o);let E=bs({},Bn(v));if(v instanceof Yt){const[y]=v.descendant(en,I);y&&(E=bs(E,Bn(y)))}c=Wn.AttributeMap.diff(E,c)||{}}else if(typeof a.insert=="object"){const m=Object.keys(a.insert)[0];if(m==null)return o;const v=this.scroll.query(m,de.INLINE)!=null;if(v)(t<=o||this.scroll.descendant(Pn,o)[0])&&(g=!0);else if(o>0){const[I,E]=this.scroll.descendant(en,o-1);I instanceof or?I.value()[E]!==`
`&&(f=!0):I instanceof xn&&I.statics.scope===de.INLINE_BLOT&&(f=!0)}if(this.scroll.insertAt(o,m,a.insert[m]),v){const[I]=this.scroll.descendant(en,o);if(I){const E=bs({},Bn(I));c=Wn.AttributeMap.diff(E,c)||{}}}}t+=l}else if(s.push(a),a.retain!==null&&typeof a.retain=="object"){const m=Object.keys(a.retain)[0];if(m==null)return o;this.scroll.updateEmbedAt(o,m,a.retain[m])}Object.keys(c).forEach(m=>{this.scroll.formatAt(o,l,m,c[m])});const h=f?1:0,d=g?1:0;return t+=h+d,s.retain(h),s.delete(d),o+l+h+d},0),s.reduce((o,a)=>typeof a.delete=="number"?(this.scroll.deleteAt(o,a.delete),o):o+Wn.Op.length(a),0),this.scroll.batchEnd(),this.scroll.optimize(),this.update(r)}deleteText(e,t){return this.scroll.deleteAt(e,t),this.update(new le().retain(e).delete(t))}formatLine(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.scroll.update(),Object.keys(r).forEach(i=>{this.scroll.lines(e,Math.max(t,1)).forEach(o=>{o.format(i,r[i])})}),this.scroll.optimize();const s=new le().retain(e).retain(t,yi(r));return this.update(s)}formatText(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};Object.keys(r).forEach(i=>{this.scroll.formatAt(e,t,i,r[i])});const s=new le().retain(e).retain(t,yi(r));return this.update(s)}getContents(e,t){return this.delta.slice(e,e+t)}getDelta(){return this.scroll.lines().reduce((e,t)=>e.concat(t.delta()),new le)}getFormat(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=[],s=[];t===0?this.scroll.path(e).forEach(a=>{const[l]=a;l instanceof Yt?r.push(l):l instanceof en&&s.push(l)}):(r=this.scroll.lines(e,t),s=this.scroll.descendants(en,e,t));const[i,o]=[r,s].map(a=>{const l=a.shift();if(l==null)return{};let c=Bn(l);for(;Object.keys(c).length>0;){const f=a.shift();if(f==null)return c;c=CI(Bn(f),c)}return c});return{...i,...o}}getHTML(e,t){const[r,s]=this.scroll.line(e);if(r){const i=r.length();return r.length()>=s+t&&!(s===0&&t===i)?Eo(r,s,t,!0):Eo(this.scroll,e,t,!0)}return""}getText(e,t){return this.getContents(e,t).filter(r=>typeof r.insert=="string").map(r=>r.insert).join("")}insertContents(e,t){const r=df(t),s=new le().retain(e).concat(r);return this.scroll.insertContents(e,r),this.update(s)}insertEmbed(e,t,r){return this.scroll.insertAt(e,t,r),this.update(new le().retain(e).insert({[t]:r}))}insertText(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return t=t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),this.scroll.insertAt(e,t),Object.keys(r).forEach(s=>{this.scroll.formatAt(e,t.length,s,r[s])}),this.update(new le().retain(e).insert(t,yi(r)))}isBlank(){if(this.scroll.children.length===0)return!0;if(this.scroll.children.length>1)return!1;const e=this.scroll.children.head;if(e?.statics.blotName!==Yt.blotName)return!1;const t=e;return t.children.length>1?!1:t.children.head instanceof cr}removeFormat(e,t){const r=this.getText(e,t),[s,i]=this.scroll.line(e+t);let o=0,a=new le;s!=null&&(o=s.length()-i,a=s.delta().slice(i,i+o-1).insert(`
`));const c=this.getContents(e,t+o).diff(new le().insert(r).concat(a)),f=new le().retain(e).concat(c);return this.applyDelta(f)}update(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const s=this.delta;if(t.length===1&&t[0].type==="characterData"&&t[0].target.data.match(TI)&&this.scroll.find(t[0].target)){const i=this.scroll.find(t[0].target),o=Bn(i),a=i.offset(this.scroll),l=t[0].oldValue.replace(er.CONTENTS,""),c=new le().insert(l),f=new le().insert(i.value()),g=r&&{oldRange:gf(r.oldRange,-a),newRange:gf(r.newRange,-a)};e=new le().retain(a).concat(c.diff(f,g)).reduce((d,m)=>m.insert?d.insert(m.insert,o):d.push(m),new le),this.delta=s.compose(e)}else this.delta=this.getDelta(),(!e||!Kc(s.compose(e),this.delta))&&(e=s.diff(this.delta,r));return e}}function fi(n,e,t){if(n.length===0){const[d]=gl(t.pop());return e<=0?`</li></${d}>`:`</li></${d}>${fi([],e-1,t)}`}const[{child:r,offset:s,length:i,indent:o,type:a},...l]=n,[c,f]=gl(a);if(o>e)return t.push(a),o===e+1?`<${c}><li${f}>${Eo(r,s,i)}${fi(l,o,t)}`:`<${c}><li>${fi(n,e+1,t)}`;const g=t[t.length-1];if(o===e&&a===g)return`</li><li${f}>${Eo(r,s,i)}${fi(l,o,t)}`;const[h]=gl(t.pop());return`</li></${h}>${fi(n,e-1,t)}`}function Eo(n,e,t){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if("html"in n&&typeof n.html=="function")return n.html(e,t);if(n instanceof or)return Fa(n.value().slice(e,e+t)).replaceAll(" ","&nbsp;");if(n instanceof ir){if(n.statics.blotName==="list-container"){const c=[];return n.children.forEachAt(e,t,(f,g,h)=>{const d="formats"in f&&typeof f.formats=="function"?f.formats():{};c.push({child:f,offset:g,length:h,indent:d.indent||0,type:d.list})}),fi(c,-1,[])}const s=[];if(n.children.forEachAt(e,t,(c,f,g)=>{s.push(Eo(c,f,g))}),r||n.statics.blotName==="list")return s.join("");const{outerHTML:i,innerHTML:o}=n.domNode,[a,l]=i.split(`>${o}<`);return a==="<table"?`<table style="border: 1px solid #000;">${s.join("")}<${l}`:`${a}>${s.join("")}<${l}`}return n.domNode instanceof Element?n.domNode.outerHTML:""}function CI(n,e){return Object.keys(e).reduce((t,r)=>{if(n[r]==null)return t;const s=e[r];return s===n[r]?t[r]=s:Array.isArray(s)?s.indexOf(n[r])<0?t[r]=s.concat([n[r]]):t[r]=s:t[r]=[s,n[r]],t},{})}function gl(n){const e=n==="ordered"?"ol":"ul";switch(n){case"checked":return[e,' data-list="checked"'];case"unchecked":return[e,' data-list="unchecked"'];default:return[e,""]}}function df(n){return n.reduce((e,t)=>{if(typeof t.insert=="string"){const r=t.insert.replace(/\r\n/g,`
`).replace(/\r/g,`
`);return e.insert(r,t.attributes)}return e.push(t)},new le)}function gf(n,e){let{index:t,length:r}=n;return new Fs(t+e,r)}function RI(n){const e=[];return n.forEach(t=>{typeof t.insert=="string"?t.insert.split(`
`).forEach((s,i)=>{i&&e.push({insert:`
`,attributes:t.attributes}),s&&e.push({insert:s,attributes:t.attributes})}):e.push(t)}),e}class Br{static DEFAULTS={};constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.quill=e,this.options=t}}const ea="\uFEFF";class zc extends xn{constructor(e,t){super(e,t),this.contentNode=document.createElement("span"),this.contentNode.setAttribute("contenteditable","false"),Array.from(this.domNode.childNodes).forEach(r=>{this.contentNode.appendChild(r)}),this.leftGuard=document.createTextNode(ea),this.rightGuard=document.createTextNode(ea),this.domNode.appendChild(this.leftGuard),this.domNode.appendChild(this.contentNode),this.domNode.appendChild(this.rightGuard)}index(e,t){return e===this.leftGuard?0:e===this.rightGuard?1:super.index(e,t)}restore(e){let t=null,r;const s=e.data.split(ea).join("");if(e===this.leftGuard)if(this.prev instanceof or){const i=this.prev.length();this.prev.insertAt(i,s),t={startNode:this.prev.domNode,startOffset:i+s.length}}else r=document.createTextNode(s),this.parent.insertBefore(this.scroll.create(r),this),t={startNode:r,startOffset:s.length};else e===this.rightGuard&&(this.next instanceof or?(this.next.insertAt(0,s),t={startNode:this.next.domNode,startOffset:s.length}):(r=document.createTextNode(s),this.parent.insertBefore(this.scroll.create(r),this.next),t={startNode:r,startOffset:s.length}));return e.data=ea,t}update(e,t){e.forEach(r=>{if(r.type==="characterData"&&(r.target===this.leftGuard||r.target===this.rightGuard)){const s=this.restore(r.target);s&&(t.range=s)}})}}class _I{isComposing=!1;constructor(e,t){this.scroll=e,this.emitter=t,this.setupListeners()}setupListeners(){this.scroll.domNode.addEventListener("compositionstart",e=>{this.isComposing||this.handleCompositionStart(e)}),this.scroll.domNode.addEventListener("compositionend",e=>{this.isComposing&&queueMicrotask(()=>{this.handleCompositionEnd(e)})})}handleCompositionStart(e){const t=e.target instanceof Node?this.scroll.find(e.target,!0):null;t&&!(t instanceof zc)&&(this.emitter.emit(ce.events.COMPOSITION_BEFORE_START,e),this.scroll.batchStart(),this.emitter.emit(ce.events.COMPOSITION_START,e),this.isComposing=!0)}handleCompositionEnd(e){this.emitter.emit(ce.events.COMPOSITION_BEFORE_END,e),this.scroll.batchEnd(),this.emitter.emit(ce.events.COMPOSITION_END,e),this.isComposing=!1}}class Vi{static DEFAULTS={modules:{}};static themes={default:Vi};modules={};constructor(e,t){this.quill=e,this.options=t}init(){Object.keys(this.options.modules).forEach(e=>{this.modules[e]==null&&this.addModule(e)})}addModule(e){const t=this.quill.constructor.import(`modules/${e}`);return this.modules[e]=new t(this.quill,this.options.modules[e]||{}),this.modules[e]}}const LI=n=>n.parentElement||n.getRootNode().host||null,OI=n=>{const e=n.getBoundingClientRect(),t="offsetWidth"in n&&Math.abs(e.width)/n.offsetWidth||1,r="offsetHeight"in n&&Math.abs(e.height)/n.offsetHeight||1;return{top:e.top,right:e.left+n.clientWidth*t,bottom:e.top+n.clientHeight*r,left:e.left}},ta=n=>{const e=parseInt(n,10);return Number.isNaN(e)?0:e},pf=(n,e,t,r,s,i)=>n<t&&e>r?0:n<t?-(t-n+s):e>r?e-n>r-t?n+s-t:e-r+i:0,kI=(n,e)=>{const t=n.ownerDocument;let r=e,s=n;for(;s;){const i=s===t.body,o=i?{top:0,right:window.visualViewport?.width??t.documentElement.clientWidth,bottom:window.visualViewport?.height??t.documentElement.clientHeight,left:0}:OI(s),a=getComputedStyle(s),l=pf(r.left,r.right,o.left,o.right,ta(a.scrollPaddingLeft),ta(a.scrollPaddingRight)),c=pf(r.top,r.bottom,o.top,o.bottom,ta(a.scrollPaddingTop),ta(a.scrollPaddingBottom));if(l||c)if(i)t.defaultView?.scrollBy(l,c);else{const{scrollLeft:f,scrollTop:g}=s;c&&(s.scrollTop+=c),l&&(s.scrollLeft+=l);const h=s.scrollLeft-f,d=s.scrollTop-g;r={left:r.left-h,top:r.top-d,right:r.right-h,bottom:r.bottom-d}}s=i||a.position==="fixed"?null:LI(s)}},DI=100,BI=["block","break","cursor","inline","scroll","text"],VI=(n,e,t)=>{const r=new Di;return BI.forEach(s=>{const i=e.query(s);i&&r.register(i)}),n.forEach(s=>{let i=e.query(s);i||t.error(`Cannot register "${s}" specified in "formats" config. Are you sure it was registered?`);let o=0;for(;i;)if(r.register(i),i="blotName"in i?i.requiredContainer??null:null,o+=1,o>DI){t.error(`Cycle detected in registering blot requiredContainer: "${s}"`);break}}),r},Ai=Jr("quill"),na=new Di;ir.uiClass="ql-ui";class G{static DEFAULTS={bounds:null,modules:{clipboard:!0,keyboard:!0,history:!0,uploader:!0},placeholder:"",readOnly:!1,registry:na,theme:"default"};static events=ce.events;static sources=ce.sources;static version="2.0.3";static imports={delta:le,parchment:pI,"core/module":Br,"core/theme":Vi};static debug(e){e===!0&&(e="log"),Jr.level(e)}static find(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return Yl.get(e)||na.find(e,t)}static import(e){return this.imports[e]==null&&Ai.error(`Cannot import ${e}. Are you sure it was registered?`),this.imports[e]}static register(){if(typeof(arguments.length<=0?void 0:arguments[0])!="string"){const e=arguments.length<=0?void 0:arguments[0],t=!!(!(arguments.length<=1)&&arguments[1]),r="attrName"in e?e.attrName:e.blotName;typeof r=="string"?this.register(`formats/${r}`,e,t):Object.keys(e).forEach(s=>{this.register(s,e[s],t)})}else{const e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],r=!!(!(arguments.length<=2)&&arguments[2]);this.imports[e]!=null&&!r&&Ai.warn(`Overwriting ${e} with`,t),this.imports[e]=t,(e.startsWith("blots/")||e.startsWith("formats/"))&&t&&typeof t!="boolean"&&t.blotName!=="abstract"&&na.register(t),typeof t.register=="function"&&t.register(na)}}constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.options=PI(e,t),this.container=this.options.container,this.container==null){Ai.error("Invalid Quill container",e);return}this.options.debug&&G.debug(this.options.debug);const r=this.container.innerHTML.trim();this.container.classList.add("ql-container"),this.container.innerHTML="",Yl.set(this.container,this),this.root=this.addContainer("ql-editor"),this.root.classList.add("ql-blank"),this.emitter=new ce;const s=Yc.blotName,i=this.options.registry.query(s);if(!i||!("blotName"in i))throw new Error(`Cannot initialize Quill without "${s}" blot`);if(this.scroll=new i(this.options.registry,this.root,{emitter:this.emitter}),this.editor=new xI(this.scroll),this.selection=new wI(this.scroll,this.emitter),this.composition=new _I(this.scroll,this.emitter),this.theme=new this.options.theme(this,this.options),this.keyboard=this.theme.addModule("keyboard"),this.clipboard=this.theme.addModule("clipboard"),this.history=this.theme.addModule("history"),this.uploader=this.theme.addModule("uploader"),this.theme.addModule("input"),this.theme.addModule("uiNode"),this.theme.init(),this.emitter.on(ce.events.EDITOR_CHANGE,o=>{o===ce.events.TEXT_CHANGE&&this.root.classList.toggle("ql-blank",this.editor.isBlank())}),this.emitter.on(ce.events.SCROLL_UPDATE,(o,a)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),f=l&&c?{oldRange:l,newRange:c}:void 0;Yn.call(this,()=>this.editor.update(null,a,f),o)}),this.emitter.on(ce.events.SCROLL_EMBED_UPDATE,(o,a)=>{const l=this.selection.lastRange,[c]=this.selection.getRange(),f=l&&c?{oldRange:l,newRange:c}:void 0;Yn.call(this,()=>{const g=new le().retain(o.offset(this)).retain({[o.statics.blotName]:a});return this.editor.update(g,[],f)},G.sources.USER)}),r){const o=this.clipboard.convert({html:`${r}<p><br></p>`,text:`
`});this.setContents(o)}this.history.clear(),this.options.placeholder&&this.root.setAttribute("data-placeholder",this.options.placeholder),this.options.readOnly&&this.disable(),this.allowReadOnlyEdits=!1}addContainer(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(typeof e=="string"){const r=e;e=document.createElement("div"),e.classList.add(r)}return this.container.insertBefore(e,t),e}blur(){this.selection.setRange(null)}deleteText(e,t,r){return[e,t,,r]=Ur(e,t,r),Yn.call(this,()=>this.editor.deleteText(e,t),r,e,-1*t)}disable(){this.enable(!1)}editReadOnly(e){this.allowReadOnlyEdits=!0;const t=e();return this.allowReadOnlyEdits=!1,t}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.scroll.enable(e),this.container.classList.toggle("ql-disabled",!e)}focus(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.selection.focus(),e.preventScroll||this.scrollSelectionIntoView()}format(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:ce.sources.API;return Yn.call(this,()=>{const s=this.getSelection(!0);let i=new le;if(s==null)return i;if(this.scroll.query(e,de.BLOCK))i=this.editor.formatLine(s.index,s.length,{[e]:t});else{if(s.length===0)return this.selection.format(e,t),i;i=this.editor.formatText(s.index,s.length,{[e]:t})}return this.setSelection(s,ce.sources.SILENT),i},r)}formatLine(e,t,r,s,i){let o;return[e,t,o,i]=Ur(e,t,r,s,i),Yn.call(this,()=>this.editor.formatLine(e,t,o),i,e,0)}formatText(e,t,r,s,i){let o;return[e,t,o,i]=Ur(e,t,r,s,i),Yn.call(this,()=>this.editor.formatText(e,t,o),i,e,0)}getBounds(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=null;if(typeof e=="number"?r=this.selection.getBounds(e,t):r=this.selection.getBounds(e.index,e.length),!r)return null;const s=this.container.getBoundingClientRect();return{bottom:r.bottom-s.top,height:r.height,left:r.left-s.left,right:r.right-s.left,top:r.top-s.top,width:r.width}}getContents(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.getLength()-e;return[e,t]=Ur(e,t),this.editor.getContents(e,t)}getFormat(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.getSelection(!0),t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return typeof e=="number"?this.editor.getFormat(e,t):this.editor.getFormat(e.index,e.length)}getIndex(e){return e.offset(this.scroll)}getLength(){return this.scroll.length()}getLeaf(e){return this.scroll.leaf(e)}getLine(e){return this.scroll.line(e)}getLines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;return typeof e!="number"?this.scroll.lines(e.index,e.length):this.scroll.lines(e,t)}getModule(e){return this.theme.modules[e]}getSelection(){return(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)&&this.focus(),this.update(),this.selection.getRange()[0]}getSemanticHTML(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(t=t??this.getLength()-e),[e,t]=Ur(e,t),this.editor.getHTML(e,t)}getText(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return typeof e=="number"&&(t=t??this.getLength()-e),[e,t]=Ur(e,t),this.editor.getText(e,t)}hasFocus(){return this.selection.hasFocus()}insertEmbed(e,t,r){let s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:G.sources.API;return Yn.call(this,()=>this.editor.insertEmbed(e,t,r),s,e)}insertText(e,t,r,s,i){let o;return[e,,o,i]=Ur(e,0,r,s,i),Yn.call(this,()=>this.editor.insertText(e,t,o),i,e,t.length)}isEnabled(){return this.scroll.isEnabled()}off(){return this.emitter.off(...arguments)}on(){return this.emitter.on(...arguments)}once(){return this.emitter.once(...arguments)}removeFormat(e,t,r){return[e,t,,r]=Ur(e,t,r),Yn.call(this,()=>this.editor.removeFormat(e,t),r,e)}scrollRectIntoView(e){kI(this.root,e)}scrollIntoView(){console.warn("Quill#scrollIntoView() has been deprecated and will be removed in the near future. Please use Quill#scrollSelectionIntoView() instead."),this.scrollSelectionIntoView()}scrollSelectionIntoView(){const e=this.selection.lastRange,t=e&&this.selection.getBounds(e.index,e.length);t&&this.scrollRectIntoView(t)}setContents(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ce.sources.API;return Yn.call(this,()=>{e=new le(e);const r=this.getLength(),s=this.editor.deleteText(0,r),i=this.editor.insertContents(0,e),o=this.editor.deleteText(this.getLength()-1,1);return s.compose(i).compose(o)},t)}setSelection(e,t,r){e==null?this.selection.setRange(null,t||G.sources.API):([e,t,,r]=Ur(e,t,r),this.selection.setRange(new Fs(Math.max(0,e),t),r),r!==ce.sources.SILENT&&this.scrollSelectionIntoView())}setText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ce.sources.API;const r=new le().insert(e);return this.setContents(r,t)}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ce.sources.USER;const t=this.scroll.update(e);return this.selection.update(e),t}updateContents(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ce.sources.API;return Yn.call(this,()=>(e=new le(e),this.editor.applyDelta(e)),t,!0)}}function mf(n){return typeof n=="string"?document.querySelector(n):n}function pl(n){return Object.entries(n??{}).reduce((e,t)=>{let[r,s]=t;return{...e,[r]:s===!0?{}:s}},{})}function bf(n){return Object.fromEntries(Object.entries(n).filter(e=>e[1]!==void 0))}function PI(n,e){const t=mf(n);if(!t)throw new Error("Invalid Quill container");const s=!e.theme||e.theme===G.DEFAULTS.theme?Vi:G.import(`themes/${e.theme}`);if(!s)throw new Error(`Invalid theme ${e.theme}. Did you register it?`);const{modules:i,...o}=G.DEFAULTS,{modules:a,...l}=s.DEFAULTS;let c=pl(e.modules);c!=null&&c.toolbar&&c.toolbar.constructor!==Object&&(c={...c,toolbar:{container:c.toolbar}});const f=bs({},pl(i),pl(a),c),g={...o,...bf(l),...bf(e)};let h=e.registry;return h?e.formats&&Ai.warn('Ignoring "formats" option because "registry" is specified'):h=e.formats?VI(e.formats,g.registry,Ai):g.registry,{...g,registry:h,container:t,theme:s,modules:Object.entries(f).reduce((d,m)=>{let[v,I]=m;if(!I)return d;const E=G.import(`modules/${v}`);return E==null?(Ai.error(`Cannot load ${v} module. Are you sure you registered it?`),d):{...d,[v]:bs({},E.DEFAULTS||{},I)}},{}),bounds:mf(g.bounds)}}function Yn(n,e,t,r){if(!this.isEnabled()&&e===ce.sources.USER&&!this.allowReadOnlyEdits)return new le;let s=t==null?null:this.getSelection();const i=this.editor.delta,o=n();if(s!=null&&(t===!0&&(t=s.index),r==null?s=yf(s,o,e):r!==0&&(s=yf(s,t,r,e)),this.setSelection(s,ce.sources.SILENT)),o.length()>0){const a=[ce.events.TEXT_CHANGE,o,i,e];this.emitter.emit(ce.events.EDITOR_CHANGE,...a),e!==ce.sources.SILENT&&this.emitter.emit(...a)}return o}function Ur(n,e,t,r,s){let i={};return typeof n.index=="number"&&typeof n.length=="number"?typeof e!="number"?(s=r,r=t,t=e,e=n.length,n=n.index):(e=n.length,n=n.index):typeof e!="number"&&(s=r,r=t,t=e,e=0),typeof t=="object"?(i=t,s=r):typeof t=="string"&&(r!=null?i[t]=r:s=t),s=s||ce.sources.API,[n,e,i,s]}function yf(n,e,t,r){const s=typeof t=="number"?t:0;if(n==null)return null;let i,o;return e&&typeof e.transformPosition=="function"?[i,o]=[n.index,n.index+n.length].map(a=>e.transformPosition(a,r!==ce.sources.USER)):[i,o]=[n.index,n.index+n.length].map(a=>a<e||a===e&&r===ce.sources.USER?a:s>=0?a+s:Math.max(e,a+s)),new Fs(i,o-i)}class Ys extends Wa{}function vf(n){return n instanceof Yt||n instanceof Pn}function Af(n){return typeof n.updateContent=="function"}class MI extends Yc{static blotName="scroll";static className="ql-editor";static tagName="DIV";static defaultChild=Yt;static allowedChildren=[Yt,Pn,Ys];constructor(e,t,r){let{emitter:s}=r;super(e,t),this.emitter=s,this.batch=!1,this.optimize(),this.enable(),this.domNode.addEventListener("dragstart",i=>this.handleDragStart(i))}batchStart(){Array.isArray(this.batch)||(this.batch=[])}batchEnd(){if(!this.batch)return;const e=this.batch;this.batch=!1,this.update(e)}emitMount(e){this.emitter.emit(ce.events.SCROLL_BLOT_MOUNT,e)}emitUnmount(e){this.emitter.emit(ce.events.SCROLL_BLOT_UNMOUNT,e)}emitEmbedUpdate(e,t){this.emitter.emit(ce.events.SCROLL_EMBED_UPDATE,e,t)}deleteAt(e,t){const[r,s]=this.line(e),[i]=this.line(e+t);if(super.deleteAt(e,t),i!=null&&r!==i&&s>0){if(r instanceof Pn||i instanceof Pn){this.optimize();return}const o=i.children.head instanceof cr?null:i.children.head;r.moveChildren(i,o),r.remove()}this.optimize()}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.domNode.setAttribute("contenteditable",e?"true":"false")}formatAt(e,t,r,s){super.formatAt(e,t,r,s),this.optimize()}insertAt(e,t,r){if(e>=this.length())if(r==null||this.scroll.query(t,de.BLOCK)==null){const s=this.scroll.create(this.statics.defaultChild.blotName);this.appendChild(s),r==null&&t.endsWith(`
`)?s.insertAt(0,t.slice(0,-1),r):s.insertAt(0,t,r)}else{const s=this.scroll.create(t,r);this.appendChild(s)}else super.insertAt(e,t,r);this.optimize()}insertBefore(e,t){if(e.statics.scope===de.INLINE_BLOT){const r=this.scroll.create(this.statics.defaultChild.blotName);r.appendChild(e),super.insertBefore(r,t)}else super.insertBefore(e,t)}insertContents(e,t){const r=this.deltaToRenderBlocks(t.concat(new le().insert(`
`))),s=r.pop();if(s==null)return;this.batchStart();const i=r.shift();if(i){const l=i.type==="block"&&(i.delta.length()===0||!this.descendant(Pn,e)[0]&&e<this.length()),c=i.type==="block"?i.delta:new le().insert({[i.key]:i.value});ml(this,e,c);const f=i.type==="block"?1:0,g=e+c.length()+f;l&&this.insertAt(g-1,`
`);const h=Bn(this.line(e)[0]),d=Wn.AttributeMap.diff(h,i.attributes)||{};Object.keys(d).forEach(m=>{this.formatAt(g-1,1,m,d[m])}),e=g}let[o,a]=this.children.find(e);if(r.length&&(o&&(o=o.split(a),a=0),r.forEach(l=>{if(l.type==="block"){const c=this.createBlock(l.attributes,o||void 0);ml(c,0,l.delta)}else{const c=this.create(l.key,l.value);this.insertBefore(c,o||void 0),Object.keys(l.attributes).forEach(f=>{c.format(f,l.attributes[f])})}})),s.type==="block"&&s.delta.length()){const l=o?o.offset(o.scroll)+a:this.length();ml(this,l,s.delta)}this.batchEnd(),this.optimize()}isEnabled(){return this.domNode.getAttribute("contenteditable")==="true"}leaf(e){const t=this.path(e).pop();if(!t)return[null,-1];const[r,s]=t;return r instanceof en?[r,s]:[null,-1]}line(e){return e===this.length()?this.line(e-1):this.descendant(vf,e)}lines(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Number.MAX_VALUE;const r=(s,i,o)=>{let a=[],l=o;return s.children.forEachAt(i,o,(c,f,g)=>{vf(c)?a.push(c):c instanceof Wa&&(a=a.concat(r(c,f,l))),l-=g}),a};return r(this,e,t)}optimize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.batch||(super.optimize(e,t),e.length>0&&this.emitter.emit(ce.events.SCROLL_OPTIMIZE,e,t))}path(e){return super.path(e).slice(1)}remove(){}update(e){if(this.batch){Array.isArray(e)&&(this.batch=this.batch.concat(e));return}let t=ce.sources.USER;typeof e=="string"&&(t=e),Array.isArray(e)||(e=this.observer.takeRecords()),e=e.filter(r=>{let{target:s}=r;const i=this.find(s,!0);return i&&!Af(i)}),e.length>0&&this.emitter.emit(ce.events.SCROLL_BEFORE_UPDATE,t,e),super.update(e.concat([])),e.length>0&&this.emitter.emit(ce.events.SCROLL_UPDATE,t,e)}updateEmbedAt(e,t,r){const[s]=this.descendant(i=>i instanceof Pn,e);s&&s.statics.blotName===t&&Af(s)&&s.updateContent(r)}handleDragStart(e){e.preventDefault()}deltaToRenderBlocks(e){const t=[];let r=new le;return e.forEach(s=>{const i=s?.insert;if(i)if(typeof i=="string"){const o=i.split(`
`);o.slice(0,-1).forEach(l=>{r.insert(l,s.attributes),t.push({type:"block",delta:r,attributes:s.attributes??{}}),r=new le});const a=o[o.length-1];a&&r.insert(a,s.attributes)}else{const o=Object.keys(i)[0];if(!o)return;this.query(o,de.INLINE)?r.push(s):(r.length()&&t.push({type:"block",delta:r,attributes:{}}),r=new le,t.push({type:"blockEmbed",key:o,value:i[o],attributes:s.attributes??{}}))}}),r.length()&&t.push({type:"block",delta:r,attributes:{}}),t}createBlock(e,t){let r;const s={};Object.entries(e).forEach(a=>{let[l,c]=a;this.query(l,de.BLOCK&de.BLOT)!=null?r=l:s[l]=c});const i=this.create(r||this.statics.defaultChild.blotName,r?e[r]:void 0);this.insertBefore(i,t||void 0);const o=i.length();return Object.entries(s).forEach(a=>{let[l,c]=a;i.formatAt(0,o,l,c)}),i}}function ml(n,e,t){t.reduce((r,s)=>{const i=Wn.Op.length(s);let o=s.attributes||{};if(s.insert!=null){if(typeof s.insert=="string"){const a=s.insert;n.insertAt(r,a);const[l]=n.descendant(en,r),c=Bn(l);o=Wn.AttributeMap.diff(c,o)||{}}else if(typeof s.insert=="object"){const a=Object.keys(s.insert)[0];if(a==null)return r;if(n.insertAt(r,a,s.insert[a]),n.scroll.query(a,de.INLINE)!=null){const[c]=n.descendant(en,r),f=Bn(c);o=Wn.AttributeMap.diff(f,o)||{}}}}return Object.keys(o).forEach(a=>{n.formatAt(r,i,a,o[a])}),r+i},e)}const Xc={scope:de.BLOCK,whitelist:["right","center","justify"]},UI=new kr("align","align",Xc),ip=new lr("align","ql-align",Xc),op=new ws("align","text-align",Xc);class ap extends ws{value(e){let t=super.value(e);return t.startsWith("rgb(")?(t=t.replace(/^[^\d]+/,"").replace(/[^\d]+$/,""),`#${t.split(",").map(s=>`00${parseInt(s,10).toString(16)}`.slice(-2)).join("")}`):t}}const WI=new lr("color","ql-color",{scope:de.INLINE}),Jc=new ap("color","color",{scope:de.INLINE}),FI=new lr("background","ql-bg",{scope:de.INLINE}),Hc=new ap("background","background-color",{scope:de.INLINE});class qs extends Ys{static create(e){const t=super.create(e);return t.setAttribute("spellcheck","false"),t}code(e,t){return this.children.map(r=>r.length()<=1?"":r.domNode.innerText).join(`
`).slice(e,e+t)}html(e,t){return`<pre>
${Fa(this.code(e,t))}
</pre>`}}class cn extends Yt{static TAB="  ";static register(){G.register(qs)}}class Qc extends ln{}Qc.blotName="code";Qc.tagName="CODE";cn.blotName="code-block";cn.className="ql-code-block";cn.tagName="DIV";qs.blotName="code-block-container";qs.className="ql-code-block-container";qs.tagName="DIV";qs.allowedChildren=[cn];cn.allowedChildren=[or,cr,er];cn.requiredContainer=qs;const eu={scope:de.BLOCK,whitelist:["rtl"]},lp=new kr("direction","dir",eu),cp=new lr("direction","ql-direction",eu),up=new ws("direction","direction",eu),hp={scope:de.INLINE,whitelist:["serif","monospace"]},fp=new lr("font","ql-font",hp);class ZI extends ws{value(e){return super.value(e).replace(/["']/g,"")}}const dp=new ZI("font","font-family",hp),gp=new lr("size","ql-size",{scope:de.INLINE,whitelist:["small","large","huge"]}),pp=new ws("size","font-size",{scope:de.INLINE,whitelist:["10px","18px","32px"]}),GI=Jr("quill:keyboard"),$I=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class Za extends Br{static match(e,t){return["altKey","ctrlKey","metaKey","shiftKey"].some(r=>!!t[r]!==e[r]&&t[r]!==null)?!1:t.key===e.key||t.key===e.which}constructor(e,t){super(e,t),this.bindings={},Object.keys(this.options.bindings).forEach(r=>{this.options.bindings[r]&&this.addBinding(this.options.bindings[r])}),this.addBinding({key:"Enter",shiftKey:null},this.handleEnter),this.addBinding({key:"Enter",metaKey:null,ctrlKey:null,altKey:null},()=>{}),/Firefox/i.test(navigator.userAgent)?(this.addBinding({key:"Backspace"},{collapsed:!0},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0},this.handleDelete)):(this.addBinding({key:"Backspace"},{collapsed:!0,prefix:/^.?$/},this.handleBackspace),this.addBinding({key:"Delete"},{collapsed:!0,suffix:/^.?$/},this.handleDelete)),this.addBinding({key:"Backspace"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Delete"},{collapsed:!1},this.handleDeleteRange),this.addBinding({key:"Backspace",altKey:null,ctrlKey:null,metaKey:null,shiftKey:null},{collapsed:!0,offset:0},this.handleBackspace),this.listen()}addBinding(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const s=jI(e);if(s==null){GI.warn("Attempted to add invalid keyboard binding",s);return}typeof t=="function"&&(t={handler:t}),typeof r=="function"&&(r={handler:r}),(Array.isArray(s.key)?s.key:[s.key]).forEach(o=>{const a={...s,key:o,...t,...r};this.bindings[a.key]=this.bindings[a.key]||[],this.bindings[a.key].push(a)})}listen(){this.quill.root.addEventListener("keydown",e=>{if(e.defaultPrevented||e.isComposing||e.keyCode===229&&(e.key==="Enter"||e.key==="Backspace"))return;const s=(this.bindings[e.key]||[]).concat(this.bindings[e.which]||[]).filter(E=>Za.match(e,E));if(s.length===0)return;const i=G.find(e.target,!0);if(i&&i.scroll!==this.quill.scroll)return;const o=this.quill.getSelection();if(o==null||!this.quill.hasFocus())return;const[a,l]=this.quill.getLine(o.index),[c,f]=this.quill.getLeaf(o.index),[g,h]=o.length===0?[c,f]:this.quill.getLeaf(o.index+o.length),d=c instanceof Sa?c.value().slice(0,f):"",m=g instanceof Sa?g.value().slice(h):"",v={collapsed:o.length===0,empty:o.length===0&&a.length()<=1,format:this.quill.getFormat(o),line:a,offset:l,prefix:d,suffix:m,event:e};s.some(E=>{if(E.collapsed!=null&&E.collapsed!==v.collapsed||E.empty!=null&&E.empty!==v.empty||E.offset!=null&&E.offset!==v.offset)return!1;if(Array.isArray(E.format)){if(E.format.every(y=>v.format[y]==null))return!1}else if(typeof E.format=="object"&&!Object.keys(E.format).every(y=>E.format[y]===!0?v.format[y]!=null:E.format[y]===!1?v.format[y]==null:Kc(E.format[y],v.format[y])))return!1;return E.prefix!=null&&!E.prefix.test(v.prefix)||E.suffix!=null&&!E.suffix.test(v.suffix)?!1:E.handler.call(this,o,v,E)!==!0})&&e.preventDefault()})}handleBackspace(e,t){const r=/[\uD800-\uDBFF][\uDC00-\uDFFF]$/.test(t.prefix)?2:1;if(e.index===0||this.quill.getLength()<=1)return;let s={};const[i]=this.quill.getLine(e.index);let o=new le().retain(e.index-r).delete(r);if(t.offset===0){const[a]=this.quill.getLine(e.index-1);if(a&&!(a.statics.blotName==="block"&&a.length()<=1)){const c=i.formats(),f=this.quill.getFormat(e.index-1,1);if(s=Wn.AttributeMap.diff(c,f)||{},Object.keys(s).length>0){const g=new le().retain(e.index+i.length()-2).retain(1,s);o=o.compose(g)}}}this.quill.updateContents(o,G.sources.USER),this.quill.focus()}handleDelete(e,t){const r=/^[\uD800-\uDBFF][\uDC00-\uDFFF]/.test(t.suffix)?2:1;if(e.index>=this.quill.getLength()-r)return;let s={};const[i]=this.quill.getLine(e.index);let o=new le().retain(e.index).delete(r);if(t.offset>=i.length()-1){const[a]=this.quill.getLine(e.index+1);if(a){const l=i.formats(),c=this.quill.getFormat(e.index,1);s=Wn.AttributeMap.diff(l,c)||{},Object.keys(s).length>0&&(o=o.retain(a.length()-1).retain(1,s))}}this.quill.updateContents(o,G.sources.USER),this.quill.focus()}handleDeleteRange(e){tu({range:e,quill:this.quill}),this.quill.focus()}handleEnter(e,t){const r=Object.keys(t.format).reduce((i,o)=>(this.quill.scroll.query(o,de.BLOCK)&&!Array.isArray(t.format[o])&&(i[o]=t.format[o]),i),{}),s=new le().retain(e.index).delete(e.length).insert(`
`,r);this.quill.updateContents(s,G.sources.USER),this.quill.setSelection(e.index+1,G.sources.SILENT),this.quill.focus()}}const KI={bindings:{bold:bl("bold"),italic:bl("italic"),underline:bl("underline"),indent:{key:"Tab",format:["blockquote","indent","list"],handler(n,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","+1",G.sources.USER),!1)}},outdent:{key:"Tab",shiftKey:!0,format:["blockquote","indent","list"],handler(n,e){return e.collapsed&&e.offset!==0?!0:(this.quill.format("indent","-1",G.sources.USER),!1)}},"outdent backspace":{key:"Backspace",collapsed:!0,shiftKey:null,metaKey:null,ctrlKey:null,altKey:null,format:["indent","list"],offset:0,handler(n,e){e.format.indent!=null?this.quill.format("indent","-1",G.sources.USER):e.format.list!=null&&this.quill.format("list",!1,G.sources.USER)}},"indent code-block":Ef(!0),"outdent code-block":Ef(!1),"remove tab":{key:"Tab",shiftKey:!0,collapsed:!0,prefix:/\t$/,handler(n){this.quill.deleteText(n.index-1,1,G.sources.USER)}},tab:{key:"Tab",handler(n,e){if(e.format.table)return!0;this.quill.history.cutoff();const t=new le().retain(n.index).delete(n.length).insert("	");return this.quill.updateContents(t,G.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(n.index+1,G.sources.SILENT),!1}},"blockquote empty enter":{key:"Enter",collapsed:!0,format:["blockquote"],empty:!0,handler(){this.quill.format("blockquote",!1,G.sources.USER)}},"list empty enter":{key:"Enter",collapsed:!0,format:["list"],empty:!0,handler(n,e){const t={list:!1};e.format.indent&&(t.indent=!1),this.quill.formatLine(n.index,n.length,t,G.sources.USER)}},"checklist enter":{key:"Enter",collapsed:!0,format:{list:"checked"},handler(n){const[e,t]=this.quill.getLine(n.index),r={...e.formats(),list:"checked"},s=new le().retain(n.index).insert(`
`,r).retain(e.length()-t-1).retain(1,{list:"unchecked"});this.quill.updateContents(s,G.sources.USER),this.quill.setSelection(n.index+1,G.sources.SILENT),this.quill.scrollSelectionIntoView()}},"header enter":{key:"Enter",collapsed:!0,format:["header"],suffix:/^$/,handler(n,e){const[t,r]=this.quill.getLine(n.index),s=new le().retain(n.index).insert(`
`,e.format).retain(t.length()-r-1).retain(1,{header:null});this.quill.updateContents(s,G.sources.USER),this.quill.setSelection(n.index+1,G.sources.SILENT),this.quill.scrollSelectionIntoView()}},"table backspace":{key:"Backspace",format:["table"],collapsed:!0,offset:0,handler(){}},"table delete":{key:"Delete",format:["table"],collapsed:!0,suffix:/^$/,handler(){}},"table enter":{key:"Enter",shiftKey:null,format:["table"],handler(n){const e=this.quill.getModule("table");if(e){const[t,r,s,i]=e.getTable(n),o=YI(t,r,s,i);if(o==null)return;let a=t.offset();if(o<0){const l=new le().retain(a).insert(`
`);this.quill.updateContents(l,G.sources.USER),this.quill.setSelection(n.index+1,n.length,G.sources.SILENT)}else if(o>0){a+=t.length();const l=new le().retain(a).insert(`
`);this.quill.updateContents(l,G.sources.USER),this.quill.setSelection(a,G.sources.USER)}}}},"table tab":{key:"Tab",shiftKey:null,format:["table"],handler(n,e){const{event:t,line:r}=e,s=r.offset(this.quill.scroll);t.shiftKey?this.quill.setSelection(s-1,G.sources.USER):this.quill.setSelection(s+r.length(),G.sources.USER)}},"list autofill":{key:" ",shiftKey:null,collapsed:!0,format:{"code-block":!1,blockquote:!1,table:!1},prefix:/^\s*?(\d+\.|-|\*|\[ ?\]|\[x\])$/,handler(n,e){if(this.quill.scroll.query("list")==null)return!0;const{length:t}=e.prefix,[r,s]=this.quill.getLine(n.index);if(s>t)return!0;let i;switch(e.prefix.trim()){case"[]":case"[ ]":i="unchecked";break;case"[x]":i="checked";break;case"-":case"*":i="bullet";break;default:i="ordered"}this.quill.insertText(n.index," ",G.sources.USER),this.quill.history.cutoff();const o=new le().retain(n.index-s).delete(t+1).retain(r.length()-2-s).retain(1,{list:i});return this.quill.updateContents(o,G.sources.USER),this.quill.history.cutoff(),this.quill.setSelection(n.index-t,G.sources.SILENT),!1}},"code exit":{key:"Enter",collapsed:!0,format:["code-block"],prefix:/^$/,suffix:/^\s*$/,handler(n){const[e,t]=this.quill.getLine(n.index);let r=2,s=e;for(;s!=null&&s.length()<=1&&s.formats()["code-block"];)if(s=s.prev,r-=1,r<=0){const i=new le().retain(n.index+e.length()-t-2).retain(1,{"code-block":null}).delete(1);return this.quill.updateContents(i,G.sources.USER),this.quill.setSelection(n.index-1,G.sources.SILENT),!1}return!0}},"embed left":ra("ArrowLeft",!1),"embed left shift":ra("ArrowLeft",!0),"embed right":ra("ArrowRight",!1),"embed right shift":ra("ArrowRight",!0),"table down":Sf(!1),"table up":Sf(!0)}};Za.DEFAULTS=KI;function Ef(n){return{key:"Tab",shiftKey:!n,format:{"code-block":!0},handler(e,t){let{event:r}=t;const s=this.quill.scroll.query("code-block"),{TAB:i}=s;if(e.length===0&&!r.shiftKey){this.quill.insertText(e.index,i,G.sources.USER),this.quill.setSelection(e.index+i.length,G.sources.SILENT);return}const o=e.length===0?this.quill.getLines(e.index,1):this.quill.getLines(e);let{index:a,length:l}=e;o.forEach((c,f)=>{n?(c.insertAt(0,i),f===0?a+=i.length:l+=i.length):c.domNode.textContent.startsWith(i)&&(c.deleteAt(0,i.length),f===0?a-=i.length:l-=i.length)}),this.quill.update(G.sources.USER),this.quill.setSelection(a,l,G.sources.SILENT)}}}function ra(n,e){return{key:n,shiftKey:e,altKey:null,[n==="ArrowLeft"?"prefix":"suffix"]:/^$/,handler(r){let{index:s}=r;n==="ArrowRight"&&(s+=r.length+1);const[i]=this.quill.getLeaf(s);return i instanceof xn?(n==="ArrowLeft"?e?this.quill.setSelection(r.index-1,r.length+1,G.sources.USER):this.quill.setSelection(r.index-1,G.sources.USER):e?this.quill.setSelection(r.index,r.length+1,G.sources.USER):this.quill.setSelection(r.index+r.length+1,G.sources.USER),!1):!0}}}function bl(n){return{key:n[0],shortKey:!0,handler(e,t){this.quill.format(n,!t.format[n],G.sources.USER)}}}function Sf(n){return{key:n?"ArrowUp":"ArrowDown",collapsed:!0,format:["table"],handler(e,t){const r=n?"prev":"next",s=t.line,i=s.parent[r];if(i!=null){if(i.statics.blotName==="table-row"){let o=i.children.head,a=s;for(;a.prev!=null;)a=a.prev,o=o.next;const l=o.offset(this.quill.scroll)+Math.min(t.offset,o.length()-1);this.quill.setSelection(l,0,G.sources.USER)}}else{const o=s.table()[r];o!=null&&(n?this.quill.setSelection(o.offset(this.quill.scroll)+o.length()-1,0,G.sources.USER):this.quill.setSelection(o.offset(this.quill.scroll),0,G.sources.USER))}return!1}}}function jI(n){if(typeof n=="string"||typeof n=="number")n={key:n};else if(typeof n=="object")n=yi(n);else return null;return n.shortKey&&(n[$I]=n.shortKey,delete n.shortKey),n}function tu(n){let{quill:e,range:t}=n;const r=e.getLines(t);let s={};if(r.length>1){const i=r[0].formats(),o=r[r.length-1].formats();s=Wn.AttributeMap.diff(o,i)||{}}e.deleteText(t,G.sources.USER),Object.keys(s).length>0&&e.formatLine(t.index,1,s,G.sources.USER),e.setSelection(t.index,G.sources.SILENT)}function YI(n,e,t,r){return e.prev==null&&e.next==null?t.prev==null&&t.next==null?r===0?-1:1:t.prev==null?-1:1:e.prev==null?-1:e.next==null?1:null}const qI=/font-weight:\s*normal/,zI=["P","OL","UL"],If=n=>n&&zI.includes(n.tagName),XI=n=>{Array.from(n.querySelectorAll("br")).filter(e=>If(e.previousElementSibling)&&If(e.nextElementSibling)).forEach(e=>{e.parentNode?.removeChild(e)})},JI=n=>{Array.from(n.querySelectorAll('b[style*="font-weight"]')).filter(e=>e.getAttribute("style")?.match(qI)).forEach(e=>{const t=n.createDocumentFragment();t.append(...e.childNodes),e.parentNode?.replaceChild(t,e)})};function HI(n){n.querySelector('[id^="docs-internal-guid-"]')&&(JI(n),XI(n))}const QI=/\bmso-list:[^;]*ignore/i,eN=/\bmso-list:[^;]*\bl(\d+)/i,tN=/\bmso-list:[^;]*\blevel(\d+)/i,nN=(n,e)=>{const t=n.getAttribute("style"),r=t?.match(eN);if(!r)return null;const s=Number(r[1]),i=t?.match(tN),o=i?Number(i[1]):1,a=new RegExp(`@list l${s}:level${o}\\s*\\{[^\\}]*mso-level-number-format:\\s*([\\w-]+)`,"i"),l=e.match(a),c=l&&l[1]==="bullet"?"bullet":"ordered";return{id:s,indent:o,type:c,element:n}},rN=n=>{const e=Array.from(n.querySelectorAll("[style*=mso-list]")),t=[],r=[];e.forEach(o=>{(o.getAttribute("style")||"").match(QI)?t.push(o):r.push(o)}),t.forEach(o=>o.parentNode?.removeChild(o));const s=n.documentElement.innerHTML,i=r.map(o=>nN(o,s)).filter(o=>o);for(;i.length;){const o=[];let a=i.shift();for(;a;)o.push(a),a=i.length&&i[0]?.element===a.element.nextElementSibling&&i[0].id===a.id?i.shift():null;const l=document.createElement("ul");o.forEach(g=>{const h=document.createElement("li");h.setAttribute("data-list",g.type),g.indent>1&&h.setAttribute("class",`ql-indent-${g.indent-1}`),h.innerHTML=g.element.innerHTML,l.appendChild(h)});const c=o[0]?.element,{parentNode:f}=c??{};c&&f?.replaceChild(l,c),o.slice(1).forEach(g=>{let{element:h}=g;f?.removeChild(h)})}};function sN(n){n.documentElement.getAttribute("xmlns:w")==="urn:schemas-microsoft-com:office:word"&&rN(n)}const iN=[sN,HI],oN=n=>{n.documentElement&&iN.forEach(e=>{e(n)})},aN=Jr("quill:clipboard"),lN=[[Node.TEXT_NODE,EN],[Node.TEXT_NODE,wf],["br",gN],[Node.ELEMENT_NODE,wf],[Node.ELEMENT_NODE,dN],[Node.ELEMENT_NODE,fN],[Node.ELEMENT_NODE,vN],["li",bN],["ol, ul",yN],["pre",pN],["tr",AN],["b",yl("bold")],["i",yl("italic")],["strike",yl("strike")],["style",mN]],cN=[UI,lp].reduce((n,e)=>(n[e.keyName]=e,n),{}),Nf=[op,Hc,Jc,up,dp,pp].reduce((n,e)=>(n[e.keyName]=e,n),{});class uN extends Br{static DEFAULTS={matchers:[]};constructor(e,t){super(e,t),this.quill.root.addEventListener("copy",r=>this.onCaptureCopy(r,!1)),this.quill.root.addEventListener("cut",r=>this.onCaptureCopy(r,!0)),this.quill.root.addEventListener("paste",this.onCapturePaste.bind(this)),this.matchers=[],lN.concat(this.options.matchers??[]).forEach(r=>{let[s,i]=r;this.addMatcher(s,i)})}addMatcher(e,t){this.matchers.push([e,t])}convert(e){let{html:t,text:r}=e,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(s[cn.blotName])return new le().insert(r||"",{[cn.blotName]:s[cn.blotName]});if(!t)return new le().insert(r||"",s);const i=this.convertHTML(t);return Ro(i,`
`)&&(i.ops[i.ops.length-1].attributes==null||s.table)?i.compose(new le().retain(i.length()-1).delete(1)):i}normalizeHTML(e){oN(e)}convertHTML(e){const t=new DOMParser().parseFromString(e,"text/html");this.normalizeHTML(t);const r=t.body,s=new WeakMap,[i,o]=this.prepareMatching(r,s);return nu(this.quill.scroll,r,i,o,s)}dangerouslyPasteHTML(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:G.sources.API;if(typeof e=="string"){const s=this.convert({html:e,text:""});this.quill.setContents(s,t),this.quill.setSelection(0,G.sources.SILENT)}else{const s=this.convert({html:t,text:""});this.quill.updateContents(new le().retain(e).concat(s),r),this.quill.setSelection(e+s.length(),G.sources.SILENT)}}onCaptureCopy(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(e.defaultPrevented)return;e.preventDefault();const[r]=this.quill.selection.getRange();if(r==null)return;const{html:s,text:i}=this.onCopy(r,t);e.clipboardData?.setData("text/plain",i),e.clipboardData?.setData("text/html",s),t&&tu({range:r,quill:this.quill})}normalizeURIList(e){return e.split(/\r?\n/).filter(t=>t[0]!=="#").join(`
`)}onCapturePaste(e){if(e.defaultPrevented||!this.quill.isEnabled())return;e.preventDefault();const t=this.quill.getSelection(!0);if(t==null)return;const r=e.clipboardData?.getData("text/html");let s=e.clipboardData?.getData("text/plain");if(!r&&!s){const o=e.clipboardData?.getData("text/uri-list");o&&(s=this.normalizeURIList(o))}const i=Array.from(e.clipboardData?.files||[]);if(!r&&i.length>0){this.quill.uploader.upload(t,i);return}if(r&&i.length>0){const o=new DOMParser().parseFromString(r,"text/html");if(o.body.childElementCount===1&&o.body.firstElementChild?.tagName==="IMG"){this.quill.uploader.upload(t,i);return}}this.onPaste(t,{html:r,text:s})}onCopy(e){const t=this.quill.getText(e);return{html:this.quill.getSemanticHTML(e),text:t}}onPaste(e,t){let{text:r,html:s}=t;const i=this.quill.getFormat(e.index),o=this.convert({text:r,html:s},i);aN.log("onPaste",o,{text:r,html:s});const a=new le().retain(e.index).delete(e.length).concat(o);this.quill.updateContents(a,G.sources.USER),this.quill.setSelection(a.length()-e.length,G.sources.SILENT),this.quill.scrollSelectionIntoView()}prepareMatching(e,t){const r=[],s=[];return this.matchers.forEach(i=>{const[o,a]=i;switch(o){case Node.TEXT_NODE:s.push(a);break;case Node.ELEMENT_NODE:r.push(a);break;default:Array.from(e.querySelectorAll(o)).forEach(l=>{t.has(l)?t.get(l)?.push(a):t.set(l,[a])});break}}),[r,s]}}function zs(n,e,t,r){return r.query(e)?n.reduce((s,i)=>{if(!i.insert)return s;if(i.attributes&&i.attributes[e])return s.push(i);const o=t?{[e]:t}:{};return s.insert(i.insert,{...o,...i.attributes})},new le):n}function Ro(n,e){let t="";for(let r=n.ops.length-1;r>=0&&t.length<e.length;--r){const s=n.ops[r];if(typeof s.insert!="string")break;t=s.insert+t}return t.slice(-1*e.length)===e}function gs(n,e){if(!(n instanceof Element))return!1;const t=e.query(n);return t&&t.prototype instanceof xn?!1:["address","article","blockquote","canvas","dd","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","iframe","li","main","nav","ol","output","p","pre","section","table","td","tr","ul","video"].includes(n.tagName.toLowerCase())}function hN(n,e){return n.previousElementSibling&&n.nextElementSibling&&!gs(n.previousElementSibling,e)&&!gs(n.nextElementSibling,e)}const sa=new WeakMap;function mp(n){return n==null?!1:(sa.has(n)||(n.tagName==="PRE"?sa.set(n,!0):sa.set(n,mp(n.parentNode))),sa.get(n))}function nu(n,e,t,r,s){return e.nodeType===e.TEXT_NODE?r.reduce((i,o)=>o(e,i,n),new le):e.nodeType===e.ELEMENT_NODE?Array.from(e.childNodes||[]).reduce((i,o)=>{let a=nu(n,o,t,r,s);return o.nodeType===e.ELEMENT_NODE&&(a=t.reduce((l,c)=>c(o,l,n),a),a=(s.get(o)||[]).reduce((l,c)=>c(o,l,n),a)),i.concat(a)},new le):new le}function yl(n){return(e,t,r)=>zs(t,n,!0,r)}function fN(n,e,t){const r=kr.keys(n),s=lr.keys(n),i=ws.keys(n),o={};return r.concat(s).concat(i).forEach(a=>{let l=t.query(a,de.ATTRIBUTE);l!=null&&(o[l.attrName]=l.value(n),o[l.attrName])||(l=cN[a],l!=null&&(l.attrName===a||l.keyName===a)&&(o[l.attrName]=l.value(n)||void 0),l=Nf[a],l!=null&&(l.attrName===a||l.keyName===a)&&(l=Nf[a],o[l.attrName]=l.value(n)||void 0))}),Object.entries(o).reduce((a,l)=>{let[c,f]=l;return zs(a,c,f,t)},e)}function dN(n,e,t){const r=t.query(n);if(r==null)return e;if(r.prototype instanceof xn){const s={},i=r.value(n);if(i!=null)return s[r.blotName]=i,new le().insert(s,r.formats(n,t))}else if(r.prototype instanceof Ao&&!Ro(e,`
`)&&e.insert(`
`),"blotName"in r&&"formats"in r&&typeof r.formats=="function")return zs(e,r.blotName,r.formats(n,t),t);return e}function gN(n,e){return Ro(e,`
`)||e.insert(`
`),e}function pN(n,e,t){const r=t.query("code-block"),s=r&&"formats"in r&&typeof r.formats=="function"?r.formats(n,t):!0;return zs(e,"code-block",s,t)}function mN(){return new le}function bN(n,e,t){const r=t.query(n);if(r==null||r.blotName!=="list"||!Ro(e,`
`))return e;let s=-1,i=n.parentNode;for(;i!=null;)["OL","UL"].includes(i.tagName)&&(s+=1),i=i.parentNode;return s<=0?e:e.reduce((o,a)=>a.insert?a.attributes&&typeof a.attributes.indent=="number"?o.push(a):o.insert(a.insert,{indent:s,...a.attributes||{}}):o,new le)}function yN(n,e,t){const r=n;let s=r.tagName==="OL"?"ordered":"bullet";const i=r.getAttribute("data-checked");return i&&(s=i==="true"?"checked":"unchecked"),zs(e,"list",s,t)}function wf(n,e,t){if(!Ro(e,`
`)){if(gs(n,t)&&(n.childNodes.length>0||n instanceof HTMLParagraphElement))return e.insert(`
`);if(e.length()>0&&n.nextSibling){let r=n.nextSibling;for(;r!=null;){if(gs(r,t))return e.insert(`
`);const s=t.query(r);if(s&&s.prototype instanceof Pn)return e.insert(`
`);r=r.firstChild}}}return e}function vN(n,e,t){const r={},s=n.style||{};return s.fontStyle==="italic"&&(r.italic=!0),s.textDecoration==="underline"&&(r.underline=!0),s.textDecoration==="line-through"&&(r.strike=!0),(s.fontWeight?.startsWith("bold")||parseInt(s.fontWeight,10)>=700)&&(r.bold=!0),e=Object.entries(r).reduce((i,o)=>{let[a,l]=o;return zs(i,a,l,t)},e),parseFloat(s.textIndent||0)>0?new le().insert("	").concat(e):e}function AN(n,e,t){const r=n.parentElement?.tagName==="TABLE"?n.parentElement:n.parentElement?.parentElement;if(r!=null){const i=Array.from(r.querySelectorAll("tr")).indexOf(n)+1;return zs(e,"table",i,t)}return e}function EN(n,e,t){let r=n.data;if(n.parentElement?.tagName==="O:P")return e.insert(r.trim());if(!mp(n)){if(r.trim().length===0&&r.includes(`
`)&&!hN(n,t))return e;r=r.replace(/[^\S\u00a0]/g," "),r=r.replace(/ {2,}/g," "),(n.previousSibling==null&&n.parentElement!=null&&gs(n.parentElement,t)||n.previousSibling instanceof Element&&gs(n.previousSibling,t))&&(r=r.replace(/^ /,"")),(n.nextSibling==null&&n.parentElement!=null&&gs(n.parentElement,t)||n.nextSibling instanceof Element&&gs(n.nextSibling,t))&&(r=r.replace(/ $/,"")),r=r.replaceAll(""," ")}return e.insert(r)}class SN extends Br{static DEFAULTS={delay:1e3,maxStack:100,userOnly:!1};lastRecorded=0;ignoreChange=!1;stack={undo:[],redo:[]};currentRange=null;constructor(e,t){super(e,t),this.quill.on(G.events.EDITOR_CHANGE,(r,s,i,o)=>{r===G.events.SELECTION_CHANGE?s&&o!==G.sources.SILENT&&(this.currentRange=s):r===G.events.TEXT_CHANGE&&(this.ignoreChange||(!this.options.userOnly||o===G.sources.USER?this.record(s,i):this.transform(s)),this.currentRange=Xl(this.currentRange,s))}),this.quill.keyboard.addBinding({key:"z",shortKey:!0},this.undo.bind(this)),this.quill.keyboard.addBinding({key:["z","Z"],shortKey:!0,shiftKey:!0},this.redo.bind(this)),/Win/i.test(navigator.platform)&&this.quill.keyboard.addBinding({key:"y",shortKey:!0},this.redo.bind(this)),this.quill.root.addEventListener("beforeinput",r=>{r.inputType==="historyUndo"?(this.undo(),r.preventDefault()):r.inputType==="historyRedo"&&(this.redo(),r.preventDefault())})}change(e,t){if(this.stack[e].length===0)return;const r=this.stack[e].pop();if(!r)return;const s=this.quill.getContents(),i=r.delta.invert(s);this.stack[t].push({delta:i,range:Xl(r.range,i)}),this.lastRecorded=0,this.ignoreChange=!0,this.quill.updateContents(r.delta,G.sources.USER),this.ignoreChange=!1,this.restoreSelection(r)}clear(){this.stack={undo:[],redo:[]}}cutoff(){this.lastRecorded=0}record(e,t){if(e.ops.length===0)return;this.stack.redo=[];let r=e.invert(t),s=this.currentRange;const i=Date.now();if(this.lastRecorded+this.options.delay>i&&this.stack.undo.length>0){const o=this.stack.undo.pop();o&&(r=r.compose(o.delta),s=o.range)}else this.lastRecorded=i;r.length()!==0&&(this.stack.undo.push({delta:r,range:s}),this.stack.undo.length>this.options.maxStack&&this.stack.undo.shift())}redo(){this.change("redo","undo")}transform(e){Tf(this.stack.undo,e),Tf(this.stack.redo,e)}undo(){this.change("undo","redo")}restoreSelection(e){if(e.range)this.quill.setSelection(e.range,G.sources.USER);else{const t=NN(this.quill.scroll,e.delta);this.quill.setSelection(t,G.sources.USER)}}}function Tf(n,e){let t=e;for(let r=n.length-1;r>=0;r-=1){const s=n[r];n[r]={delta:t.transform(s.delta,!0),range:s.range&&Xl(s.range,t)},t=s.delta.transform(t),n[r].delta.length()===0&&n.splice(r,1)}}function IN(n,e){const t=e.ops[e.ops.length-1];return t==null?!1:t.insert!=null?typeof t.insert=="string"&&t.insert.endsWith(`
`):t.attributes!=null?Object.keys(t.attributes).some(r=>n.query(r,de.BLOCK)!=null):!1}function NN(n,e){const t=e.reduce((s,i)=>s+(i.delete||0),0);let r=e.length()-t;return IN(n,e)&&(r-=1),r}function Xl(n,e){if(!n)return n;const t=e.transformPosition(n.index),r=e.transformPosition(n.index+n.length);return{index:t,length:r-t}}class bp extends Br{constructor(e,t){super(e,t),e.root.addEventListener("drop",r=>{r.preventDefault();let s=null;if(document.caretRangeFromPoint)s=document.caretRangeFromPoint(r.clientX,r.clientY);else if(document.caretPositionFromPoint){const o=document.caretPositionFromPoint(r.clientX,r.clientY);s=document.createRange(),s.setStart(o.offsetNode,o.offset),s.setEnd(o.offsetNode,o.offset)}const i=s&&e.selection.normalizeNative(s);if(i){const o=e.selection.normalizedToRange(i);r.dataTransfer?.files&&this.upload(o,r.dataTransfer.files)}})}upload(e,t){const r=[];Array.from(t).forEach(s=>{s&&this.options.mimetypes?.includes(s.type)&&r.push(s)}),r.length>0&&this.options.handler.call(this,e,r)}}bp.DEFAULTS={mimetypes:["image/png","image/jpeg"],handler(n,e){if(!this.quill.scroll.query("image"))return;const t=e.map(r=>new Promise(s=>{const i=new FileReader;i.onload=()=>{s(i.result)},i.readAsDataURL(r)}));Promise.all(t).then(r=>{const s=r.reduce((i,o)=>i.insert({image:o}),new le().retain(n.index).delete(n.length));this.quill.updateContents(s,ce.sources.USER),this.quill.setSelection(n.index+r.length,ce.sources.SILENT)})}};const wN=["insertText","insertReplacementText"];class TN extends Br{constructor(e,t){super(e,t),e.root.addEventListener("beforeinput",r=>{this.handleBeforeInput(r)}),/Android/i.test(navigator.userAgent)||e.on(G.events.COMPOSITION_BEFORE_START,()=>{this.handleCompositionStart()})}deleteRange(e){tu({range:e,quill:this.quill})}replaceText(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e.length===0)return!1;if(t){const r=this.quill.getFormat(e.index,1);this.deleteRange(e),this.quill.updateContents(new le().retain(e.index).insert(t,r),G.sources.USER)}else this.deleteRange(e);return this.quill.setSelection(e.index+t.length,0,G.sources.SILENT),!0}handleBeforeInput(e){if(this.quill.composition.isComposing||e.defaultPrevented||!wN.includes(e.inputType))return;const t=e.getTargetRanges?e.getTargetRanges()[0]:null;if(!t||t.collapsed===!0)return;const r=xN(e);if(r==null)return;const s=this.quill.selection.normalizeNative(t),i=s?this.quill.selection.normalizedToRange(s):null;i&&this.replaceText(i,r)&&e.preventDefault()}handleCompositionStart(){const e=this.quill.getSelection();e&&this.replaceText(e)}}function xN(n){return typeof n.data=="string"?n.data:n.dataTransfer?.types.includes("text/plain")?n.dataTransfer.getData("text/plain"):null}const CN=/Mac/i.test(navigator.platform),RN=100,_N=n=>!!(n.key==="ArrowLeft"||n.key==="ArrowRight"||n.key==="ArrowUp"||n.key==="ArrowDown"||n.key==="Home"||CN&&n.key==="a"&&n.ctrlKey===!0);class LN extends Br{isListening=!1;selectionChangeDeadline=0;constructor(e,t){super(e,t),this.handleArrowKeys(),this.handleNavigationShortcuts()}handleArrowKeys(){this.quill.keyboard.addBinding({key:["ArrowLeft","ArrowRight"],offset:0,shiftKey:null,handler(e,t){let{line:r,event:s}=t;if(!(r instanceof ir)||!r.uiNode)return!0;const i=getComputedStyle(r.domNode).direction==="rtl";return i&&s.key!=="ArrowRight"||!i&&s.key!=="ArrowLeft"?!0:(this.quill.setSelection(e.index-1,e.length+(s.shiftKey?1:0),G.sources.USER),!1)}})}handleNavigationShortcuts(){this.quill.root.addEventListener("keydown",e=>{!e.defaultPrevented&&_N(e)&&this.ensureListeningToSelectionChange()})}ensureListeningToSelectionChange(){if(this.selectionChangeDeadline=Date.now()+RN,this.isListening)return;this.isListening=!0;const e=()=>{this.isListening=!1,Date.now()<=this.selectionChangeDeadline&&this.handleSelectionChange()};document.addEventListener("selectionchange",e,{once:!0})}handleSelectionChange(){const e=document.getSelection();if(!e)return;const t=e.getRangeAt(0);if(t.collapsed!==!0||t.startOffset!==0)return;const r=this.quill.scroll.find(t.startContainer);if(!(r instanceof ir)||!r.uiNode)return;const s=document.createRange();s.setStartAfter(r.uiNode),s.setEndAfter(r.uiNode),e.removeAllRanges(),e.addRange(s)}}G.register({"blots/block":Yt,"blots/block/embed":Pn,"blots/break":cr,"blots/container":Ys,"blots/cursor":er,"blots/embed":zc,"blots/inline":ln,"blots/scroll":MI,"blots/text":or,"modules/clipboard":uN,"modules/history":SN,"modules/keyboard":Za,"modules/uploader":bp,"modules/input":TN,"modules/uiNode":LN});class ON extends lr{add(e,t){let r=0;if(t==="+1"||t==="-1"){const s=this.value(e)||0;r=t==="+1"?s+1:s-1}else typeof t=="number"&&(r=t);return r===0?(this.remove(e),!0):super.add(e,r.toString())}canAdd(e,t){return super.canAdd(e,t)||super.canAdd(e,parseInt(t,10))}value(e){return parseInt(super.value(e),10)||void 0}}const kN=new ON("indent","ql-indent",{scope:de.BLOCK,whitelist:[1,2,3,4,5,6,7,8]});class DN extends Yt{static blotName="blockquote";static tagName="blockquote"}class BN extends Yt{static blotName="header";static tagName=["H1","H2","H3","H4","H5","H6"];static formats(e){return this.tagName.indexOf(e.tagName)+1}}class _o extends Ys{}_o.blotName="list-container";_o.tagName="OL";class Lo extends Yt{static create(e){const t=super.create();return t.setAttribute("data-list",e),t}static formats(e){return e.getAttribute("data-list")||void 0}static register(){G.register(_o)}constructor(e,t){super(e,t);const r=t.ownerDocument.createElement("span"),s=i=>{if(!e.isEnabled())return;const o=this.statics.formats(t,e);o==="checked"?(this.format("list","unchecked"),i.preventDefault()):o==="unchecked"&&(this.format("list","checked"),i.preventDefault())};r.addEventListener("mousedown",s),r.addEventListener("touchstart",s),this.attachUI(r)}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("data-list",t):super.format(e,t)}}Lo.blotName="list";Lo.tagName="LI";_o.allowedChildren=[Lo];Lo.requiredContainer=_o;class ru extends ln{static blotName="bold";static tagName=["STRONG","B"];static create(){return super.create()}static formats(){return!0}optimize(e){super.optimize(e),this.domNode.tagName!==this.statics.tagName[0]&&this.replaceWith(this.statics.blotName)}}class VN extends ru{static blotName="italic";static tagName=["EM","I"]}class Ia extends ln{static blotName="link";static tagName="A";static SANITIZED_URL="about:blank";static PROTOCOL_WHITELIST=["http","https","mailto","tel","sms"];static create(e){const t=super.create(e);return t.setAttribute("href",this.sanitize(e)),t.setAttribute("rel","noopener noreferrer"),t.setAttribute("target","_blank"),t}static formats(e){return e.getAttribute("href")}static sanitize(e){return yp(e,this.PROTOCOL_WHITELIST)?e:this.SANITIZED_URL}format(e,t){e!==this.statics.blotName||!t?super.format(e,t):this.domNode.setAttribute("href",this.constructor.sanitize(t))}}function yp(n,e){const t=document.createElement("a");t.href=n;const r=t.href.slice(0,t.href.indexOf(":"));return e.indexOf(r)>-1}class PN extends ln{static blotName="script";static tagName=["SUB","SUP"];static create(e){return e==="super"?document.createElement("sup"):e==="sub"?document.createElement("sub"):super.create(e)}static formats(e){if(e.tagName==="SUB")return"sub";if(e.tagName==="SUP")return"super"}}class MN extends ru{static blotName="strike";static tagName=["S","STRIKE"]}class UN extends ln{static blotName="underline";static tagName="U"}class WN extends zc{static blotName="formula";static className="ql-formula";static tagName="SPAN";static create(e){if(window.katex==null)throw new Error("Formula module requires KaTeX.");const t=super.create(e);return typeof e=="string"&&(window.katex.render(e,t,{throwOnError:!1,errorColor:"#f00"}),t.setAttribute("data-value",e)),t}static value(e){return e.getAttribute("data-value")}html(){const{formula:e}=this.value();return`<span>${e}</span>`}}const xf=["alt","height","width"];class FN extends xn{static blotName="image";static tagName="IMG";static create(e){const t=super.create(e);return typeof e=="string"&&t.setAttribute("src",this.sanitize(e)),t}static formats(e){return xf.reduce((t,r)=>(e.hasAttribute(r)&&(t[r]=e.getAttribute(r)),t),{})}static match(e){return/\.(jpe?g|gif|png)$/.test(e)||/^data:image\/.+;base64/.test(e)}static sanitize(e){return yp(e,["http","https","data"])?e:"//:0"}static value(e){return e.getAttribute("src")}format(e,t){xf.indexOf(e)>-1?t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):super.format(e,t)}}const Cf=["height","width"];class ZN extends Pn{static blotName="video";static className="ql-video";static tagName="IFRAME";static create(e){const t=super.create(e);return t.setAttribute("frameborder","0"),t.setAttribute("allowfullscreen","true"),t.setAttribute("src",this.sanitize(e)),t}static formats(e){return Cf.reduce((t,r)=>(e.hasAttribute(r)&&(t[r]=e.getAttribute(r)),t),{})}static sanitize(e){return Ia.sanitize(e)}static value(e){return e.getAttribute("src")}format(e,t){Cf.indexOf(e)>-1?t?this.domNode.setAttribute(e,t):this.domNode.removeAttribute(e):super.format(e,t)}html(){const{video:e}=this.value();return`<a href="${e}">${e}</a>`}}const Ji=new lr("code-token","hljs",{scope:de.INLINE});class qr extends ln{static formats(e,t){for(;e!=null&&e!==t.domNode;){if(e.classList&&e.classList.contains(cn.className))return super.formats(e,t);e=e.parentNode}}constructor(e,t,r){super(e,t,r),Ji.add(this.domNode,r)}format(e,t){e!==qr.blotName?super.format(e,t):t?Ji.add(this.domNode,t):(Ji.remove(this.domNode),this.domNode.classList.remove(this.statics.className))}optimize(){super.optimize(...arguments),Ji.value(this.domNode)||this.unwrap()}}qr.blotName="code-token";qr.className="ql-token";class Vn extends cn{static create(e){const t=super.create(e);return typeof e=="string"&&t.setAttribute("data-language",e),t}static formats(e){return e.getAttribute("data-language")||"plain"}static register(){}format(e,t){e===this.statics.blotName&&t?this.domNode.setAttribute("data-language",t):super.format(e,t)}replaceWith(e,t){return this.formatAt(0,this.length(),qr.blotName,!1),super.replaceWith(e,t)}}class so extends qs{attach(){super.attach(),this.forceNext=!1,this.scroll.emitMount(this)}format(e,t){e===Vn.blotName&&(this.forceNext=!0,this.children.forEach(r=>{r.format(e,t)}))}formatAt(e,t,r,s){r===Vn.blotName&&(this.forceNext=!0),super.formatAt(e,t,r,s)}highlight(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.children.head==null)return;const s=`${Array.from(this.domNode.childNodes).filter(o=>o!==this.uiNode).map(o=>o.textContent).join(`
`)}
`,i=Vn.formats(this.children.head.domNode);if(t||this.forceNext||this.cachedText!==s){if(s.trim().length>0||this.cachedText==null){const o=this.children.reduce((l,c)=>l.concat(rp(c,!1)),new le),a=e(s,i);o.diff(a).reduce((l,c)=>{let{retain:f,attributes:g}=c;return f?(g&&Object.keys(g).forEach(h=>{[Vn.blotName,qr.blotName].includes(h)&&this.formatAt(l,f,h,g[h])}),l+f):l},0)}this.cachedText=s,this.forceNext=!1}}html(e,t){const[r]=this.children.find(e);return`<pre data-language="${r?Vn.formats(r.domNode):"plain"}">
${Fa(this.code(e,t))}
</pre>`}optimize(e){if(super.optimize(e),this.parent!=null&&this.children.head!=null&&this.uiNode!=null){const t=Vn.formats(this.children.head.domNode);t!==this.uiNode.value&&(this.uiNode.value=t)}}}so.allowedChildren=[Vn];Vn.requiredContainer=so;Vn.allowedChildren=[qr,er,or,cr];const GN=(n,e,t)=>{if(typeof n.versionString=="string"){const r=n.versionString.split(".")[0];if(parseInt(r,10)>=11)return n.highlight(t,{language:e}).value}return n.highlight(e,t).value};class vp extends Br{static register(){G.register(qr,!0),G.register(Vn,!0),G.register(so,!0)}constructor(e,t){if(super(e,t),this.options.hljs==null)throw new Error("Syntax module requires highlight.js. Please include the library on the page before Quill.");this.languages=this.options.languages.reduce((r,s)=>{let{key:i}=s;return r[i]=!0,r},{}),this.highlightBlot=this.highlightBlot.bind(this),this.initListener(),this.initTimer()}initListener(){this.quill.on(G.events.SCROLL_BLOT_MOUNT,e=>{if(!(e instanceof so))return;const t=this.quill.root.ownerDocument.createElement("select");this.options.languages.forEach(r=>{let{key:s,label:i}=r;const o=t.ownerDocument.createElement("option");o.textContent=i,o.setAttribute("value",s),t.appendChild(o)}),t.addEventListener("change",()=>{e.format(Vn.blotName,t.value),this.quill.root.focus(),this.highlight(e,!0)}),e.uiNode==null&&(e.attachUI(t),e.children.head&&(t.value=Vn.formats(e.children.head.domNode)))})}initTimer(){let e=null;this.quill.on(G.events.SCROLL_OPTIMIZE,()=>{e&&clearTimeout(e),e=setTimeout(()=>{this.highlight(),e=null},this.options.interval)})}highlight(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(this.quill.selection.composing)return;this.quill.update(G.sources.USER);const r=this.quill.getSelection();(e==null?this.quill.scroll.descendants(so):[e]).forEach(i=>{i.highlight(this.highlightBlot,t)}),this.quill.update(G.sources.SILENT),r!=null&&this.quill.setSelection(r,G.sources.SILENT)}highlightBlot(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"plain";if(t=this.languages[t]?t:"plain",t==="plain")return Fa(e).split(`
`).reduce((s,i,o)=>(o!==0&&s.insert(`
`,{[cn.blotName]:t}),s.insert(i)),new le);const r=this.quill.root.ownerDocument.createElement("div");return r.classList.add(cn.className),r.innerHTML=GN(this.options.hljs,t,e),nu(this.quill.scroll,r,[(s,i)=>{const o=Ji.value(s);return o?i.compose(new le().retain(i.length(),{[qr.blotName]:o})):i}],[(s,i)=>s.data.split(`
`).reduce((o,a,l)=>(l!==0&&o.insert(`
`,{[cn.blotName]:t}),o.insert(a)),i)],new WeakMap)}}vp.DEFAULTS={hljs:window.hljs,interval:1e3,languages:[{key:"plain",label:"Plain"},{key:"bash",label:"Bash"},{key:"cpp",label:"C++"},{key:"cs",label:"C#"},{key:"css",label:"CSS"},{key:"diff",label:"Diff"},{key:"xml",label:"HTML/XML"},{key:"java",label:"Java"},{key:"javascript",label:"JavaScript"},{key:"markdown",label:"Markdown"},{key:"php",label:"PHP"},{key:"python",label:"Python"},{key:"ruby",label:"Ruby"},{key:"sql",label:"SQL"}]};class tr extends Yt{static blotName="table";static tagName="TD";static create(e){const t=super.create();return e?t.setAttribute("data-row",e):t.setAttribute("data-row",su()),t}static formats(e){if(e.hasAttribute("data-row"))return e.getAttribute("data-row")}cellOffset(){return this.parent?this.parent.children.indexOf(this):-1}format(e,t){e===tr.blotName&&t?this.domNode.setAttribute("data-row",t):super.format(e,t)}row(){return this.parent}rowOffset(){return this.row()?this.row().rowOffset():-1}table(){return this.row()&&this.row().table()}}class Zs extends Ys{static blotName="table-row";static tagName="TR";checkMerge(){if(super.checkMerge()&&this.next.children.head!=null){const e=this.children.head.formats(),t=this.children.tail.formats(),r=this.next.children.head.formats(),s=this.next.children.tail.formats();return e.table===t.table&&e.table===r.table&&e.table===s.table}return!1}optimize(e){super.optimize(e),this.children.forEach(t=>{if(t.next==null)return;const r=t.formats(),s=t.next.formats();if(r.table!==s.table){const i=this.splitAfter(t);i&&i.optimize(),this.prev&&this.prev.optimize()}})}rowOffset(){return this.parent?this.parent.children.indexOf(this):-1}table(){return this.parent&&this.parent.parent}}class ys extends Ys{static blotName="table-body";static tagName="TBODY"}class Na extends Ys{static blotName="table-container";static tagName="TABLE";balanceCells(){const e=this.descendants(Zs),t=e.reduce((r,s)=>Math.max(s.children.length,r),0);e.forEach(r=>{new Array(t-r.children.length).fill(0).forEach(()=>{let s;r.children.head!=null&&(s=tr.formats(r.children.head.domNode));const i=this.scroll.create(tr.blotName,s);r.appendChild(i),i.optimize()})})}cells(e){return this.rows().map(t=>t.children.at(e))}deleteColumn(e){const[t]=this.descendant(ys);t==null||t.children.head==null||t.children.forEach(r=>{const s=r.children.at(e);s?.remove()})}insertColumn(e){const[t]=this.descendant(ys);t==null||t.children.head==null||t.children.forEach(r=>{const s=r.children.at(e),i=tr.formats(r.children.head.domNode),o=this.scroll.create(tr.blotName,i);r.insertBefore(o,s)})}insertRow(e){const[t]=this.descendant(ys);if(t==null||t.children.head==null)return;const r=su(),s=this.scroll.create(Zs.blotName);t.children.head.children.forEach(()=>{const o=this.scroll.create(tr.blotName,r);s.appendChild(o)});const i=t.children.at(e);t.insertBefore(s,i)}rows(){const e=this.children.head;return e==null?[]:e.children.map(t=>t)}}Na.allowedChildren=[ys];ys.requiredContainer=Na;ys.allowedChildren=[Zs];Zs.requiredContainer=ys;Zs.allowedChildren=[tr];tr.requiredContainer=Zs;function su(){return`row-${Math.random().toString(36).slice(2,6)}`}class $N extends Br{static register(){G.register(tr),G.register(Zs),G.register(ys),G.register(Na)}constructor(){super(...arguments),this.listenBalanceCells()}balanceTables(){this.quill.scroll.descendants(Na).forEach(e=>{e.balanceCells()})}deleteColumn(){const[e,,t]=this.getTable();t!=null&&(e.deleteColumn(t.cellOffset()),this.quill.update(G.sources.USER))}deleteRow(){const[,e]=this.getTable();e!=null&&(e.remove(),this.quill.update(G.sources.USER))}deleteTable(){const[e]=this.getTable();if(e==null)return;const t=e.offset();e.remove(),this.quill.update(G.sources.USER),this.quill.setSelection(t,G.sources.SILENT)}getTable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.quill.getSelection();if(e==null)return[null,null,null,-1];const[t,r]=this.quill.getLine(e.index);if(t==null||t.statics.blotName!==tr.blotName)return[null,null,null,-1];const s=t.parent;return[s.parent.parent,s,t,r]}insertColumn(e){const t=this.quill.getSelection();if(!t)return;const[r,s,i]=this.getTable(t);if(i==null)return;const o=i.cellOffset();r.insertColumn(o+e),this.quill.update(G.sources.USER);let a=s.rowOffset();e===0&&(a+=1),this.quill.setSelection(t.index+a,t.length,G.sources.SILENT)}insertColumnLeft(){this.insertColumn(0)}insertColumnRight(){this.insertColumn(1)}insertRow(e){const t=this.quill.getSelection();if(!t)return;const[r,s,i]=this.getTable(t);if(i==null)return;const o=s.rowOffset();r.insertRow(o+e),this.quill.update(G.sources.USER),e>0?this.quill.setSelection(t,G.sources.SILENT):this.quill.setSelection(t.index+s.children.length,t.length,G.sources.SILENT)}insertRowAbove(){this.insertRow(0)}insertRowBelow(){this.insertRow(1)}insertTable(e,t){const r=this.quill.getSelection();if(r==null)return;const s=new Array(e).fill(0).reduce(i=>{const o=new Array(t).fill(`
`).join("");return i.insert(o,{table:su()})},new le().retain(r.index));this.quill.updateContents(s,G.sources.USER),this.quill.setSelection(r.index,G.sources.SILENT),this.balanceTables()}listenBalanceCells(){this.quill.on(G.events.SCROLL_OPTIMIZE,e=>{e.some(t=>["TD","TR","TBODY","TABLE"].includes(t.target.tagName)?(this.quill.once(G.events.TEXT_CHANGE,(r,s,i)=>{i===G.sources.USER&&this.balanceTables()}),!0):!1)})}}const Rf=Jr("quill:toolbar");class iu extends Br{constructor(e,t){if(super(e,t),Array.isArray(this.options.container)){const r=document.createElement("div");r.setAttribute("role","toolbar"),KN(r,this.options.container),e.container?.parentNode?.insertBefore(r,e.container),this.container=r}else typeof this.options.container=="string"?this.container=document.querySelector(this.options.container):this.container=this.options.container;if(!(this.container instanceof HTMLElement)){Rf.error("Container required for toolbar",this.options);return}this.container.classList.add("ql-toolbar"),this.controls=[],this.handlers={},this.options.handlers&&Object.keys(this.options.handlers).forEach(r=>{const s=this.options.handlers?.[r];s&&this.addHandler(r,s)}),Array.from(this.container.querySelectorAll("button, select")).forEach(r=>{this.attach(r)}),this.quill.on(G.events.EDITOR_CHANGE,()=>{const[r]=this.quill.selection.getRange();this.update(r)})}addHandler(e,t){this.handlers[e]=t}attach(e){let t=Array.from(e.classList).find(s=>s.indexOf("ql-")===0);if(!t)return;if(t=t.slice(3),e.tagName==="BUTTON"&&e.setAttribute("type","button"),this.handlers[t]==null&&this.quill.scroll.query(t)==null){Rf.warn("ignoring attaching to nonexistent format",t,e);return}const r=e.tagName==="SELECT"?"change":"click";e.addEventListener(r,s=>{let i;if(e.tagName==="SELECT"){if(e.selectedIndex<0)return;const a=e.options[e.selectedIndex];a.hasAttribute("selected")?i=!1:i=a.value||!1}else e.classList.contains("ql-active")?i=!1:i=e.value||!e.hasAttribute("value"),s.preventDefault();this.quill.focus();const[o]=this.quill.selection.getRange();if(this.handlers[t]!=null)this.handlers[t].call(this,i);else if(this.quill.scroll.query(t).prototype instanceof xn){if(i=prompt(`Enter ${t}`),!i)return;this.quill.updateContents(new le().retain(o.index).delete(o.length).insert({[t]:i}),G.sources.USER)}else this.quill.format(t,i,G.sources.USER);this.update(o)}),this.controls.push([t,e])}update(e){const t=e==null?{}:this.quill.getFormat(e);this.controls.forEach(r=>{const[s,i]=r;if(i.tagName==="SELECT"){let o=null;if(e==null)o=null;else if(t[s]==null)o=i.querySelector("option[selected]");else if(!Array.isArray(t[s])){let a=t[s];typeof a=="string"&&(a=a.replace(/"/g,'\\"')),o=i.querySelector(`option[value="${a}"]`)}o==null?(i.value="",i.selectedIndex=-1):o.selected=!0}else if(e==null)i.classList.remove("ql-active"),i.setAttribute("aria-pressed","false");else if(i.hasAttribute("value")){const o=t[s],a=o===i.getAttribute("value")||o!=null&&o.toString()===i.getAttribute("value")||o==null&&!i.getAttribute("value");i.classList.toggle("ql-active",a),i.setAttribute("aria-pressed",a.toString())}else{const o=t[s]!=null;i.classList.toggle("ql-active",o),i.setAttribute("aria-pressed",o.toString())}})}}iu.DEFAULTS={};function _f(n,e,t){const r=document.createElement("button");r.setAttribute("type","button"),r.classList.add(`ql-${e}`),r.setAttribute("aria-pressed","false"),t!=null?(r.value=t,r.setAttribute("aria-label",`${e}: ${t}`)):r.setAttribute("aria-label",e),n.appendChild(r)}function KN(n,e){Array.isArray(e[0])||(e=[e]),e.forEach(t=>{const r=document.createElement("span");r.classList.add("ql-formats"),t.forEach(s=>{if(typeof s=="string")_f(r,s);else{const i=Object.keys(s)[0],o=s[i];Array.isArray(o)?jN(r,i,o):_f(r,i,o)}}),n.appendChild(r)})}function jN(n,e,t){const r=document.createElement("select");r.classList.add(`ql-${e}`),t.forEach(s=>{const i=document.createElement("option");s!==!1?i.setAttribute("value",String(s)):i.setAttribute("selected","selected"),r.appendChild(i)}),n.appendChild(r)}iu.DEFAULTS={container:null,handlers:{clean(){const n=this.quill.getSelection();if(n!=null)if(n.length===0){const e=this.quill.getFormat();Object.keys(e).forEach(t=>{this.quill.scroll.query(t,de.INLINE)!=null&&this.quill.format(t,!1,G.sources.USER)})}else this.quill.removeFormat(n.index,n.length,G.sources.USER)},direction(n){const{align:e}=this.quill.getFormat();n==="rtl"&&e==null?this.quill.format("align","right",G.sources.USER):!n&&e==="right"&&this.quill.format("align",!1,G.sources.USER),this.quill.format("direction",n,G.sources.USER)},indent(n){const e=this.quill.getSelection(),t=this.quill.getFormat(e),r=parseInt(t.indent||0,10);if(n==="+1"||n==="-1"){let s=n==="+1"?1:-1;t.direction==="rtl"&&(s*=-1),this.quill.format("indent",r+s,G.sources.USER)}},link(n){n===!0&&(n=prompt("Enter link URL:")),this.quill.format("link",n,G.sources.USER)},list(n){const e=this.quill.getSelection(),t=this.quill.getFormat(e);n==="check"?t.list==="checked"||t.list==="unchecked"?this.quill.format("list",!1,G.sources.USER):this.quill.format("list","unchecked",G.sources.USER):this.quill.format("list",n,G.sources.USER)}}};const YN='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="13" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="9" y1="4" y2="4"/></svg>',qN='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="14" x2="4" y1="14" y2="14"/><line class="ql-stroke" x1="12" x2="6" y1="4" y2="4"/></svg>',zN='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="5" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="9" y1="4" y2="4"/></svg>',XN='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="15" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="15" x2="3" y1="14" y2="14"/><line class="ql-stroke" x1="15" x2="3" y1="4" y2="4"/></svg>',JN='<svg viewbox="0 0 18 18"><g class="ql-fill ql-color-label"><polygon points="6 6.868 6 6 5 6 5 7 5.942 7 6 6.868"/><rect height="1" width="1" x="4" y="4"/><polygon points="6.817 5 6 5 6 6 6.38 6 6.817 5"/><rect height="1" width="1" x="2" y="6"/><rect height="1" width="1" x="3" y="5"/><rect height="1" width="1" x="4" y="7"/><polygon points="4 11.439 4 11 3 11 3 12 3.755 12 4 11.439"/><rect height="1" width="1" x="2" y="12"/><rect height="1" width="1" x="2" y="9"/><rect height="1" width="1" x="2" y="15"/><polygon points="4.63 10 4 10 4 11 4.192 11 4.63 10"/><rect height="1" width="1" x="3" y="8"/><path d="M10.832,4.2L11,4.582V4H10.708A1.948,1.948,0,0,1,10.832,4.2Z"/><path d="M7,4.582L7.168,4.2A1.929,1.929,0,0,1,7.292,4H7V4.582Z"/><path d="M8,13H7.683l-0.351.8a1.933,1.933,0,0,1-.124.2H8V13Z"/><rect height="1" width="1" x="12" y="2"/><rect height="1" width="1" x="11" y="3"/><path d="M9,3H8V3.282A1.985,1.985,0,0,1,9,3Z"/><rect height="1" width="1" x="2" y="3"/><rect height="1" width="1" x="6" y="2"/><rect height="1" width="1" x="3" y="2"/><rect height="1" width="1" x="5" y="3"/><rect height="1" width="1" x="9" y="2"/><rect height="1" width="1" x="15" y="14"/><polygon points="13.447 10.174 13.469 10.225 13.472 10.232 13.808 11 14 11 14 10 13.37 10 13.447 10.174"/><rect height="1" width="1" x="13" y="7"/><rect height="1" width="1" x="15" y="5"/><rect height="1" width="1" x="14" y="6"/><rect height="1" width="1" x="15" y="8"/><rect height="1" width="1" x="14" y="9"/><path d="M3.775,14H3v1H4V14.314A1.97,1.97,0,0,1,3.775,14Z"/><rect height="1" width="1" x="14" y="3"/><polygon points="12 6.868 12 6 11.62 6 12 6.868"/><rect height="1" width="1" x="15" y="2"/><rect height="1" width="1" x="12" y="5"/><rect height="1" width="1" x="13" y="4"/><polygon points="12.933 9 13 9 13 8 12.495 8 12.933 9"/><rect height="1" width="1" x="9" y="14"/><rect height="1" width="1" x="8" y="15"/><path d="M6,14.926V15H7V14.316A1.993,1.993,0,0,1,6,14.926Z"/><rect height="1" width="1" x="5" y="15"/><path d="M10.668,13.8L10.317,13H10v1h0.792A1.947,1.947,0,0,1,10.668,13.8Z"/><rect height="1" width="1" x="11" y="15"/><path d="M14.332,12.2a1.99,1.99,0,0,1,.166.8H15V12H14.245Z"/><rect height="1" width="1" x="14" y="15"/><rect height="1" width="1" x="15" y="11"/></g><polyline class="ql-stroke" points="5.5 13 9 5 12.5 13"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="11" y2="11"/></svg>',HN='<svg viewbox="0 0 18 18"><rect class="ql-fill ql-stroke" height="3" width="3" x="4" y="5"/><rect class="ql-fill ql-stroke" height="3" width="3" x="11" y="5"/><path class="ql-even ql-fill ql-stroke" d="M7,8c0,4.031-3,5-3,5"/><path class="ql-even ql-fill ql-stroke" d="M14,8c0,4.031-3,5-3,5"/></svg>',QN='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,4H9.5A2.5,2.5,0,0,1,12,6.5v0A2.5,2.5,0,0,1,9.5,9H5A0,0,0,0,1,5,9V4A0,0,0,0,1,5,4Z"/><path class="ql-stroke" d="M5,9h5.5A2.5,2.5,0,0,1,13,11.5v0A2.5,2.5,0,0,1,10.5,14H5a0,0,0,0,1,0,0V9A0,0,0,0,1,5,9Z"/></svg>',ew='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="5" x2="13" y1="3" y2="3"/><line class="ql-stroke" x1="6" x2="9.35" y1="12" y2="3"/><line class="ql-stroke" x1="11" x2="15" y1="11" y2="15"/><line class="ql-stroke" x1="15" x2="11" y1="11" y2="15"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="7" x="2" y="14"/></svg>',Lf='<svg viewbox="0 0 18 18"><polyline class="ql-even ql-stroke" points="5 7 3 9 5 11"/><polyline class="ql-even ql-stroke" points="13 7 15 9 13 11"/><line class="ql-stroke" x1="10" x2="8" y1="5" y2="13"/></svg>',tw='<svg viewbox="0 0 18 18"><line class="ql-color-label ql-stroke ql-transparent" x1="3" x2="15" y1="15" y2="15"/><polyline class="ql-stroke" points="5.5 11 9 3 12.5 11"/><line class="ql-stroke" x1="11.63" x2="6.38" y1="9" y2="9"/></svg>',nw='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="3 11 5 9 3 7 3 11"/><line class="ql-stroke ql-fill" x1="15" x2="11" y1="4" y2="4"/><path class="ql-fill" d="M11,3a3,3,0,0,0,0,6h1V3H11Z"/><rect class="ql-fill" height="11" width="1" x="11" y="4"/><rect class="ql-fill" height="11" width="1" x="13" y="4"/></svg>',rw='<svg viewbox="0 0 18 18"><polygon class="ql-stroke ql-fill" points="15 12 13 10 15 8 15 12"/><line class="ql-stroke ql-fill" x1="9" x2="5" y1="4" y2="4"/><path class="ql-fill" d="M5,3A3,3,0,0,0,5,9H6V3H5Z"/><rect class="ql-fill" height="11" width="1" x="5" y="4"/><rect class="ql-fill" height="11" width="1" x="7" y="4"/></svg>',sw='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M11.759,2.482a2.561,2.561,0,0,0-3.53.607A7.656,7.656,0,0,0,6.8,6.2C6.109,9.188,5.275,14.677,4.15,14.927a1.545,1.545,0,0,0-1.3-.933A0.922,0.922,0,0,0,2,15.036S1.954,16,4.119,16s3.091-2.691,3.7-5.553c0.177-.826.36-1.726,0.554-2.6L8.775,6.2c0.381-1.421.807-2.521,1.306-2.676a1.014,1.014,0,0,0,1.02.56A0.966,0.966,0,0,0,11.759,2.482Z"/><rect class="ql-fill" height="1.6" rx="0.8" ry="0.8" width="5" x="5.15" y="6.2"/><path class="ql-fill" d="M13.663,12.027a1.662,1.662,0,0,1,.266-0.276q0.193,0.069.456,0.138a2.1,2.1,0,0,0,.535.069,1.075,1.075,0,0,0,.767-0.3,1.044,1.044,0,0,0,.314-0.8,0.84,0.84,0,0,0-.238-0.619,0.8,0.8,0,0,0-.594-0.239,1.154,1.154,0,0,0-.781.3,4.607,4.607,0,0,0-.781,1q-0.091.15-.218,0.346l-0.246.38c-0.068-.288-0.137-0.582-0.212-0.885-0.459-1.847-2.494-.984-2.941-0.8-0.482.2-.353,0.647-0.094,0.529a0.869,0.869,0,0,1,1.281.585c0.217,0.751.377,1.436,0.527,2.038a5.688,5.688,0,0,1-.362.467,2.69,2.69,0,0,1-.264.271q-0.221-.08-0.471-0.147a2.029,2.029,0,0,0-.522-0.066,1.079,1.079,0,0,0-.768.3A1.058,1.058,0,0,0,9,15.131a0.82,0.82,0,0,0,.832.852,1.134,1.134,0,0,0,.787-0.3,5.11,5.11,0,0,0,.776-0.993q0.141-.219.215-0.34c0.046-.076.122-0.194,0.223-0.346a2.786,2.786,0,0,0,.918,1.726,2.582,2.582,0,0,0,2.376-.185c0.317-.181.212-0.565,0-0.494A0.807,0.807,0,0,1,14.176,15a5.159,5.159,0,0,1-.913-2.446l0,0Q13.487,12.24,13.663,12.027Z"/></svg>',iw='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm6.06787,9.209H14.98975V7.59863a.54085.54085,0,0,0-.605-.60547h-.62744a1.01119,1.01119,0,0,0-.748.29688L11.645,8.56641a.5435.5435,0,0,0-.022.8584l.28613.30762a.53861.53861,0,0,0,.84717.0332l.09912-.08789a1.2137,1.2137,0,0,0,.2417-.35254h.02246s-.01123.30859-.01123.60547V13.209H12.041a.54085.54085,0,0,0-.605.60547v.43945a.54085.54085,0,0,0,.605.60547h4.02686a.54085.54085,0,0,0,.605-.60547v-.43945A.54085.54085,0,0,0,16.06787,13.209Z"/></svg>',ow='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.73975,13.81445v.43945a.54085.54085,0,0,1-.605.60547H11.855a.58392.58392,0,0,1-.64893-.60547V14.0127c0-2.90527,3.39941-3.42187,3.39941-4.55469a.77675.77675,0,0,0-.84717-.78125,1.17684,1.17684,0,0,0-.83594.38477c-.2749.26367-.561.374-.85791.13184l-.4292-.34082c-.30811-.24219-.38525-.51758-.1543-.81445a2.97155,2.97155,0,0,1,2.45361-1.17676,2.45393,2.45393,0,0,1,2.68408,2.40918c0,2.45312-3.1792,2.92676-3.27832,3.93848h2.79443A.54085.54085,0,0,1,16.73975,13.81445ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',aw='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.65186,12.30664a2.6742,2.6742,0,0,1-2.915,2.68457,3.96592,3.96592,0,0,1-2.25537-.6709.56007.56007,0,0,1-.13232-.83594L11.64648,13c.209-.34082.48389-.36328.82471-.1543a2.32654,2.32654,0,0,0,1.12256.33008c.71484,0,1.12207-.35156,1.12207-.78125,0-.61523-.61621-.86816-1.46338-.86816H13.2085a.65159.65159,0,0,1-.68213-.41895l-.05518-.10937a.67114.67114,0,0,1,.14307-.78125l.71533-.86914a8.55289,8.55289,0,0,1,.68213-.7373V8.58887a3.93913,3.93913,0,0,1-.748.05469H11.9873a.54085.54085,0,0,1-.605-.60547V7.59863a.54085.54085,0,0,1,.605-.60547h3.75146a.53773.53773,0,0,1,.60547.59375v.17676a1.03723,1.03723,0,0,1-.27539.748L14.74854,10.0293A2.31132,2.31132,0,0,1,16.65186,12.30664ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',lw='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Zm7.05371,7.96582v.38477c0,.39648-.165.60547-.46191.60547h-.47314v1.29785a.54085.54085,0,0,1-.605.60547h-.69336a.54085.54085,0,0,1-.605-.60547V12.95605H11.333a.5412.5412,0,0,1-.60547-.60547v-.15332a1.199,1.199,0,0,1,.22021-.748l2.56348-4.05957a.7819.7819,0,0,1,.72607-.39648h1.27637a.54085.54085,0,0,1,.605.60547v3.7627h.33008A.54055.54055,0,0,1,17.05371,11.96582ZM14.28125,8.7207h-.022a4.18969,4.18969,0,0,1-.38525.81348l-1.188,1.80469v.02246h1.5293V9.60059A7.04058,7.04058,0,0,1,14.28125,8.7207Z"/></svg>',cw='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M16.74023,12.18555a2.75131,2.75131,0,0,1-2.91553,2.80566,3.908,3.908,0,0,1-2.25537-.68164.54809.54809,0,0,1-.13184-.8252L11.73438,13c.209-.34082.48389-.36328.8252-.1543a2.23757,2.23757,0,0,0,1.1001.33008,1.01827,1.01827,0,0,0,1.1001-.96777c0-.61621-.53906-.97949-1.25439-.97949a2.15554,2.15554,0,0,0-.64893.09961,1.15209,1.15209,0,0,1-.814.01074l-.12109-.04395a.64116.64116,0,0,1-.45117-.71484l.231-3.00391a.56666.56666,0,0,1,.62744-.583H15.541a.54085.54085,0,0,1,.605.60547v.43945a.54085.54085,0,0,1-.605.60547H13.41748l-.04395.72559a1.29306,1.29306,0,0,1-.04395.30859h.022a2.39776,2.39776,0,0,1,.57227-.07715A2.53266,2.53266,0,0,1,16.74023,12.18555ZM9,3A.99974.99974,0,0,0,8,4V8H3V4A1,1,0,0,0,1,4V14a1,1,0,0,0,2,0V10H8v4a1,1,0,0,0,2,0V4A.99974.99974,0,0,0,9,3Z"/></svg>',uw='<svg viewBox="0 0 18 18"><path class="ql-fill" d="M14.51758,9.64453a1.85627,1.85627,0,0,0-1.24316.38477H13.252a1.73532,1.73532,0,0,1,1.72754-1.4082,2.66491,2.66491,0,0,1,.5498.06641c.35254.05469.57227.01074.70508-.40723l.16406-.5166a.53393.53393,0,0,0-.373-.75977,4.83723,4.83723,0,0,0-1.17773-.14258c-2.43164,0-3.7627,2.17773-3.7627,4.43359,0,2.47559,1.60645,3.69629,3.19043,3.69629A2.70585,2.70585,0,0,0,16.96,12.19727,2.43861,2.43861,0,0,0,14.51758,9.64453Zm-.23047,3.58691c-.67187,0-1.22168-.81445-1.22168-1.45215,0-.47363.30762-.583.72559-.583.96875,0,1.27734.59375,1.27734,1.12207A.82182.82182,0,0,1,14.28711,13.23145ZM10,4V14a1,1,0,0,1-2,0V10H3v4a1,1,0,0,1-2,0V4A1,1,0,0,1,3,4V8H8V4a1,1,0,0,1,2,0Z"/></svg>',hw='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="13" y1="4" y2="4"/><line class="ql-stroke" x1="5" x2="11" y1="14" y2="14"/><line class="ql-stroke" x1="8" x2="10" y1="14" y2="4"/></svg>',fw='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="10" width="12" x="3" y="4"/><circle class="ql-fill" cx="6" cy="7" r="1"/><polyline class="ql-even ql-fill" points="5 12 5 11 7 9 8 10 11 7 13 9 13 12 5 12"/></svg>',dw='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-fill ql-stroke" points="3 7 3 11 5 9 3 7"/></svg>',gw='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="3" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="5 7 5 11 3 9 5 7"/></svg>',pw='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="11" y1="7" y2="11"/><path class="ql-even ql-stroke" d="M8.9,4.577a3.476,3.476,0,0,1,.36,4.679A3.476,3.476,0,0,1,4.577,8.9C3.185,7.5,2.035,6.4,4.217,4.217S7.5,3.185,8.9,4.577Z"/><path class="ql-even ql-stroke" d="M13.423,9.1a3.476,3.476,0,0,0-4.679-.36,3.476,3.476,0,0,0,.36,4.679c1.392,1.392,2.5,2.542,4.679.36S14.815,10.5,13.423,9.1Z"/></svg>',mw='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="6" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="6" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="6" x2="15" y1="14" y2="14"/><line class="ql-stroke" x1="3" x2="3" y1="4" y2="4"/><line class="ql-stroke" x1="3" x2="3" y1="9" y2="9"/><line class="ql-stroke" x1="3" x2="3" y1="14" y2="14"/></svg>',bw='<svg class="" viewbox="0 0 18 18"><line class="ql-stroke" x1="9" x2="15" y1="4" y2="4"/><polyline class="ql-stroke" points="3 4 4 5 6 3"/><line class="ql-stroke" x1="9" x2="15" y1="14" y2="14"/><polyline class="ql-stroke" points="3 14 4 15 6 13"/><line class="ql-stroke" x1="9" x2="15" y1="9" y2="9"/><polyline class="ql-stroke" points="3 9 4 10 6 8"/></svg>',yw='<svg viewbox="0 0 18 18"><line class="ql-stroke" x1="7" x2="15" y1="4" y2="4"/><line class="ql-stroke" x1="7" x2="15" y1="9" y2="9"/><line class="ql-stroke" x1="7" x2="15" y1="14" y2="14"/><line class="ql-stroke ql-thin" x1="2.5" x2="4.5" y1="5.5" y2="5.5"/><path class="ql-fill" d="M3.5,6A0.5,0.5,0,0,1,3,5.5V3.085l-0.276.138A0.5,0.5,0,0,1,2.053,3c-0.124-.247-0.023-0.324.224-0.447l1-.5A0.5,0.5,0,0,1,4,2.5v3A0.5,0.5,0,0,1,3.5,6Z"/><path class="ql-stroke ql-thin" d="M4.5,10.5h-2c0-.234,1.85-1.076,1.85-2.234A0.959,0.959,0,0,0,2.5,8.156"/><path class="ql-stroke ql-thin" d="M2.5,14.846a0.959,0.959,0,0,0,1.85-.109A0.7,0.7,0,0,0,3.75,14a0.688,0.688,0,0,0,.6-0.736,0.959,0.959,0,0,0-1.85-.109"/></svg>',vw='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,15H13.861a3.858,3.858,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.921,1.921,0,0,0,12.021,11.7a0.50013,0.50013,0,1,0,.957.291h0a0.914,0.914,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.076-1.16971,1.86982-1.93971,2.43082A1.45639,1.45639,0,0,0,12,15.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,15Z"/><path class="ql-fill" d="M9.65,5.241a1,1,0,0,0-1.409.108L6,7.964,3.759,5.349A1,1,0,0,0,2.192,6.59178Q2.21541,6.6213,2.241,6.649L4.684,9.5,2.241,12.35A1,1,0,0,0,3.71,13.70722q0.02557-.02768.049-0.05722L6,11.036,8.241,13.65a1,1,0,1,0,1.567-1.24277Q9.78459,12.3777,9.759,12.35L7.316,9.5,9.759,6.651A1,1,0,0,0,9.65,5.241Z"/></svg>',Aw='<svg viewbox="0 0 18 18"><path class="ql-fill" d="M15.5,7H13.861a4.015,4.015,0,0,0,1.914-2.975,1.8,1.8,0,0,0-1.6-1.751A1.922,1.922,0,0,0,12.021,3.7a0.5,0.5,0,1,0,.957.291,0.917,0.917,0,0,1,1.053-.725,0.81,0.81,0,0,1,.744.762c0,1.077-1.164,1.925-1.934,2.486A1.423,1.423,0,0,0,12,7.5a0.5,0.5,0,0,0,.5.5h3A0.5,0.5,0,0,0,15.5,7Z"/><path class="ql-fill" d="M9.651,5.241a1,1,0,0,0-1.41.108L6,7.964,3.759,5.349a1,1,0,1,0-1.519,1.3L4.683,9.5,2.241,12.35a1,1,0,1,0,1.519,1.3L6,11.036,8.241,13.65a1,1,0,0,0,1.519-1.3L7.317,9.5,9.759,6.651A1,1,0,0,0,9.651,5.241Z"/></svg>',Ew='<svg viewbox="0 0 18 18"><line class="ql-stroke ql-thin" x1="15.5" x2="2.5" y1="8.5" y2="9.5"/><path class="ql-fill" d="M9.007,8C6.542,7.791,6,7.519,6,6.5,6,5.792,7.283,5,9,5c1.571,0,2.765.679,2.969,1.309a1,1,0,0,0,1.9-.617C13.356,4.106,11.354,3,9,3,6.2,3,4,4.538,4,6.5a3.2,3.2,0,0,0,.5,1.843Z"/><path class="ql-fill" d="M8.984,10C11.457,10.208,12,10.479,12,11.5c0,0.708-1.283,1.5-3,1.5-1.571,0-2.765-.679-2.969-1.309a1,1,0,1,0-1.9.617C4.644,13.894,6.646,15,9,15c2.8,0,5-1.538,5-3.5a3.2,3.2,0,0,0-.5-1.843Z"/></svg>',Sw='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="2" width="3" x="5" y="5"/><rect class="ql-fill" height="2" width="4" x="9" y="5"/><g class="ql-fill ql-transparent"><rect height="2" width="3" x="5" y="8"/><rect height="2" width="4" x="9" y="8"/><rect height="2" width="3" x="5" y="11"/><rect height="2" width="4" x="9" y="11"/></g></svg>',Iw='<svg viewbox="0 0 18 18"><path class="ql-stroke" d="M5,3V9a4.012,4.012,0,0,0,4,4H9a4.012,4.012,0,0,0,4-4V3"/><rect class="ql-fill" height="1" rx="0.5" ry="0.5" width="12" x="3" y="15"/></svg>',Nw='<svg viewbox="0 0 18 18"><rect class="ql-stroke" height="12" width="12" x="3" y="3"/><rect class="ql-fill" height="12" width="1" x="5" y="3"/><rect class="ql-fill" height="12" width="1" x="12" y="3"/><rect class="ql-fill" height="2" width="8" x="5" y="8"/><rect class="ql-fill" height="1" width="3" x="3" y="5"/><rect class="ql-fill" height="1" width="3" x="3" y="7"/><rect class="ql-fill" height="1" width="3" x="3" y="10"/><rect class="ql-fill" height="1" width="3" x="3" y="12"/><rect class="ql-fill" height="1" width="3" x="12" y="5"/><rect class="ql-fill" height="1" width="3" x="12" y="7"/><rect class="ql-fill" height="1" width="3" x="12" y="10"/><rect class="ql-fill" height="1" width="3" x="12" y="12"/></svg>',So={align:{"":YN,center:qN,right:zN,justify:XN},background:JN,blockquote:HN,bold:QN,clean:ew,code:Lf,"code-block":Lf,color:tw,direction:{"":nw,rtl:rw},formula:sw,header:{1:iw,2:ow,3:aw,4:lw,5:cw,6:uw},italic:hw,image:fw,indent:{"+1":dw,"-1":gw},link:pw,list:{bullet:mw,check:bw,ordered:yw},script:{sub:vw,super:Aw},strike:Ew,table:Sw,underline:Iw,video:Nw},ww='<svg viewbox="0 0 18 18"><polygon class="ql-stroke" points="7 11 9 13 11 11 7 11"/><polygon class="ql-stroke" points="7 7 9 5 11 7 7 7"/></svg>';let Of=0;function kf(n,e){n.setAttribute(e,`${n.getAttribute(e)!=="true"}`)}class Ga{constructor(e){this.select=e,this.container=document.createElement("span"),this.buildPicker(),this.select.style.display="none",this.select.parentNode.insertBefore(this.container,this.select),this.label.addEventListener("mousedown",()=>{this.togglePicker()}),this.label.addEventListener("keydown",t=>{switch(t.key){case"Enter":this.togglePicker();break;case"Escape":this.escape(),t.preventDefault();break}}),this.select.addEventListener("change",this.update.bind(this))}togglePicker(){this.container.classList.toggle("ql-expanded"),kf(this.label,"aria-expanded"),kf(this.options,"aria-hidden")}buildItem(e){const t=document.createElement("span");t.tabIndex="0",t.setAttribute("role","button"),t.classList.add("ql-picker-item");const r=e.getAttribute("value");return r&&t.setAttribute("data-value",r),e.textContent&&t.setAttribute("data-label",e.textContent),t.addEventListener("click",()=>{this.selectItem(t,!0)}),t.addEventListener("keydown",s=>{switch(s.key){case"Enter":this.selectItem(t,!0),s.preventDefault();break;case"Escape":this.escape(),s.preventDefault();break}}),t}buildLabel(){const e=document.createElement("span");return e.classList.add("ql-picker-label"),e.innerHTML=ww,e.tabIndex="0",e.setAttribute("role","button"),e.setAttribute("aria-expanded","false"),this.container.appendChild(e),e}buildOptions(){const e=document.createElement("span");e.classList.add("ql-picker-options"),e.setAttribute("aria-hidden","true"),e.tabIndex="-1",e.id=`ql-picker-options-${Of}`,Of+=1,this.label.setAttribute("aria-controls",e.id),this.options=e,Array.from(this.select.options).forEach(t=>{const r=this.buildItem(t);e.appendChild(r),t.selected===!0&&this.selectItem(r)}),this.container.appendChild(e)}buildPicker(){Array.from(this.select.attributes).forEach(e=>{this.container.setAttribute(e.name,e.value)}),this.container.classList.add("ql-picker"),this.label=this.buildLabel(),this.buildOptions()}escape(){this.close(),setTimeout(()=>this.label.focus(),1)}close(){this.container.classList.remove("ql-expanded"),this.label.setAttribute("aria-expanded","false"),this.options.setAttribute("aria-hidden","true")}selectItem(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=this.container.querySelector(".ql-selected");e!==r&&(r?.classList.remove("ql-selected"),e!=null&&(e.classList.add("ql-selected"),this.select.selectedIndex=Array.from(e.parentNode.children).indexOf(e),e.hasAttribute("data-value")?this.label.setAttribute("data-value",e.getAttribute("data-value")):this.label.removeAttribute("data-value"),e.hasAttribute("data-label")?this.label.setAttribute("data-label",e.getAttribute("data-label")):this.label.removeAttribute("data-label"),t&&(this.select.dispatchEvent(new Event("change")),this.close())))}update(){let e;if(this.select.selectedIndex>-1){const r=this.container.querySelector(".ql-picker-options").children[this.select.selectedIndex];e=this.select.options[this.select.selectedIndex],this.selectItem(r)}else this.selectItem(null);const t=e!=null&&e!==this.select.querySelector("option[selected]");this.label.classList.toggle("ql-active",t)}}class Ap extends Ga{constructor(e,t){super(e),this.label.innerHTML=t,this.container.classList.add("ql-color-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).slice(0,7).forEach(r=>{r.classList.add("ql-primary")})}buildItem(e){const t=super.buildItem(e);return t.style.backgroundColor=e.getAttribute("value")||"",t}selectItem(e,t){super.selectItem(e,t);const r=this.label.querySelector(".ql-color-label"),s=e&&e.getAttribute("data-value")||"";r&&(r.tagName==="line"?r.style.stroke=s:r.style.fill=s)}}class Ep extends Ga{constructor(e,t){super(e),this.container.classList.add("ql-icon-picker"),Array.from(this.container.querySelectorAll(".ql-picker-item")).forEach(r=>{r.innerHTML=t[r.getAttribute("data-value")||""]}),this.defaultItem=this.container.querySelector(".ql-selected"),this.selectItem(this.defaultItem)}selectItem(e,t){super.selectItem(e,t);const r=e||this.defaultItem;if(r!=null){if(this.label.innerHTML===r.innerHTML)return;this.label.innerHTML=r.innerHTML}}}const Tw=n=>{const{overflowY:e}=getComputedStyle(n,null);return e!=="visible"&&e!=="clip"};class Sp{constructor(e,t){this.quill=e,this.boundsContainer=t||document.body,this.root=e.addContainer("ql-tooltip"),this.root.innerHTML=this.constructor.TEMPLATE,Tw(this.quill.root)&&this.quill.root.addEventListener("scroll",()=>{this.root.style.marginTop=`${-1*this.quill.root.scrollTop}px`}),this.hide()}hide(){this.root.classList.add("ql-hidden")}position(e){const t=e.left+e.width/2-this.root.offsetWidth/2,r=e.bottom+this.quill.root.scrollTop;this.root.style.left=`${t}px`,this.root.style.top=`${r}px`,this.root.classList.remove("ql-flip");const s=this.boundsContainer.getBoundingClientRect(),i=this.root.getBoundingClientRect();let o=0;if(i.right>s.right&&(o=s.right-i.right,this.root.style.left=`${t+o}px`),i.left<s.left&&(o=s.left-i.left,this.root.style.left=`${t+o}px`),i.bottom>s.bottom){const a=i.bottom-i.top,l=e.bottom-e.top+a;this.root.style.top=`${r-l}px`,this.root.classList.add("ql-flip")}return o}show(){this.root.classList.remove("ql-editing"),this.root.classList.remove("ql-hidden")}}const xw=[!1,"center","right","justify"],Cw=["#000000","#e60000","#ff9900","#ffff00","#008a00","#0066cc","#9933ff","#ffffff","#facccc","#ffebcc","#ffffcc","#cce8cc","#cce0f5","#ebd6ff","#bbbbbb","#f06666","#ffc266","#ffff66","#66b966","#66a3e0","#c285ff","#888888","#a10000","#b26b00","#b2b200","#006100","#0047b2","#6b24b2","#444444","#5c0000","#663d00","#666600","#003700","#002966","#3d1466"],Rw=[!1,"serif","monospace"],_w=["1","2","3",!1],Lw=["small",!1,"large","huge"];class Oo extends Vi{constructor(e,t){super(e,t);const r=s=>{if(!document.body.contains(e.root)){document.body.removeEventListener("click",r);return}this.tooltip!=null&&!this.tooltip.root.contains(s.target)&&document.activeElement!==this.tooltip.textbox&&!this.quill.hasFocus()&&this.tooltip.hide(),this.pickers!=null&&this.pickers.forEach(i=>{i.container.contains(s.target)||i.close()})};e.emitter.listenDOM("click",document.body,r)}addModule(e){const t=super.addModule(e);return e==="toolbar"&&this.extendToolbar(t),t}buildButtons(e,t){Array.from(e).forEach(r=>{(r.getAttribute("class")||"").split(/\s+/).forEach(i=>{if(i.startsWith("ql-")&&(i=i.slice(3),t[i]!=null))if(i==="direction")r.innerHTML=t[i][""]+t[i].rtl;else if(typeof t[i]=="string")r.innerHTML=t[i];else{const o=r.value||"";o!=null&&t[i][o]&&(r.innerHTML=t[i][o])}})})}buildPickers(e,t){this.pickers=Array.from(e).map(s=>{if(s.classList.contains("ql-align")&&(s.querySelector("option")==null&&$i(s,xw),typeof t.align=="object"))return new Ep(s,t.align);if(s.classList.contains("ql-background")||s.classList.contains("ql-color")){const i=s.classList.contains("ql-background")?"background":"color";return s.querySelector("option")==null&&$i(s,Cw,i==="background"?"#ffffff":"#000000"),new Ap(s,t[i])}return s.querySelector("option")==null&&(s.classList.contains("ql-font")?$i(s,Rw):s.classList.contains("ql-header")?$i(s,_w):s.classList.contains("ql-size")&&$i(s,Lw)),new Ga(s)});const r=()=>{this.pickers.forEach(s=>{s.update()})};this.quill.on(ce.events.EDITOR_CHANGE,r)}}Oo.DEFAULTS=bs({},Vi.DEFAULTS,{modules:{toolbar:{handlers:{formula(){this.quill.theme.tooltip.edit("formula")},image(){let n=this.container.querySelector("input.ql-image[type=file]");n==null&&(n=document.createElement("input"),n.setAttribute("type","file"),n.setAttribute("accept",this.quill.uploader.options.mimetypes.join(", ")),n.classList.add("ql-image"),n.addEventListener("change",()=>{const e=this.quill.getSelection(!0);this.quill.uploader.upload(e,n.files),n.value=""}),this.container.appendChild(n)),n.click()},video(){this.quill.theme.tooltip.edit("video")}}}}});class Ip extends Sp{constructor(e,t){super(e,t),this.textbox=this.root.querySelector('input[type="text"]'),this.listen()}listen(){this.textbox.addEventListener("keydown",e=>{e.key==="Enter"?(this.save(),e.preventDefault()):e.key==="Escape"&&(this.cancel(),e.preventDefault())})}cancel(){this.hide(),this.restoreFocus()}edit(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"link",t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(this.root.classList.remove("ql-hidden"),this.root.classList.add("ql-editing"),this.textbox==null)return;t!=null?this.textbox.value=t:e!==this.root.getAttribute("data-mode")&&(this.textbox.value="");const r=this.quill.getBounds(this.quill.selection.savedRange);r!=null&&this.position(r),this.textbox.select(),this.textbox.setAttribute("placeholder",this.textbox.getAttribute(`data-${e}`)||""),this.root.setAttribute("data-mode",e)}restoreFocus(){this.quill.focus({preventScroll:!0})}save(){let{value:e}=this.textbox;switch(this.root.getAttribute("data-mode")){case"link":{const{scrollTop:t}=this.quill.root;this.linkRange?(this.quill.formatText(this.linkRange,"link",e,ce.sources.USER),delete this.linkRange):(this.restoreFocus(),this.quill.format("link",e,ce.sources.USER)),this.quill.root.scrollTop=t;break}case"video":e=Ow(e);case"formula":{if(!e)break;const t=this.quill.getSelection(!0);if(t!=null){const r=t.index+t.length;this.quill.insertEmbed(r,this.root.getAttribute("data-mode"),e,ce.sources.USER),this.root.getAttribute("data-mode")==="formula"&&this.quill.insertText(r+1," ",ce.sources.USER),this.quill.setSelection(r+2,ce.sources.USER)}break}}this.textbox.value="",this.hide()}}function Ow(n){let e=n.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtube\.com\/watch.*v=([a-zA-Z0-9_-]+)/)||n.match(/^(?:(https?):\/\/)?(?:(?:www|m)\.)?youtu\.be\/([a-zA-Z0-9_-]+)/);return e?`${e[1]||"https"}://www.youtube.com/embed/${e[2]}?showinfo=0`:(e=n.match(/^(?:(https?):\/\/)?(?:www\.)?vimeo\.com\/(\d+)/))?`${e[1]||"https"}://player.vimeo.com/video/${e[2]}/`:n}function $i(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.forEach(r=>{const s=document.createElement("option");r===t?s.setAttribute("selected","selected"):s.setAttribute("value",String(r)),n.appendChild(s)})}const kw=[["bold","italic","link"],[{header:1},{header:2},"blockquote"]];class Dw extends Ip{static TEMPLATE=['<span class="ql-tooltip-arrow"></span>','<div class="ql-tooltip-editor">','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-close"></a>',"</div>"].join("");constructor(e,t){super(e,t),this.quill.on(ce.events.EDITOR_CHANGE,(r,s,i,o)=>{if(r===ce.events.SELECTION_CHANGE)if(s!=null&&s.length>0&&o===ce.sources.USER){this.show(),this.root.style.left="0px",this.root.style.width="",this.root.style.width=`${this.root.offsetWidth}px`;const a=this.quill.getLines(s.index,s.length);if(a.length===1){const l=this.quill.getBounds(s);l!=null&&this.position(l)}else{const l=a[a.length-1],c=this.quill.getIndex(l),f=Math.min(l.length()-1,s.index+s.length-c),g=this.quill.getBounds(new Fs(c,f));g!=null&&this.position(g)}}else document.activeElement!==this.textbox&&this.quill.hasFocus()&&this.hide()})}listen(){super.listen(),this.root.querySelector(".ql-close").addEventListener("click",()=>{this.root.classList.remove("ql-editing")}),this.quill.on(ce.events.SCROLL_OPTIMIZE,()=>{setTimeout(()=>{if(this.root.classList.contains("ql-hidden"))return;const e=this.quill.getSelection();if(e!=null){const t=this.quill.getBounds(e);t!=null&&this.position(t)}},1)})}cancel(){this.show()}position(e){const t=super.position(e),r=this.root.querySelector(".ql-tooltip-arrow");return r.style.marginLeft="",t!==0&&(r.style.marginLeft=`${-1*t-r.offsetWidth/2}px`),t}}class Np extends Oo{constructor(e,t){t.modules.toolbar!=null&&t.modules.toolbar.container==null&&(t.modules.toolbar.container=kw),super(e,t),this.quill.container.classList.add("ql-bubble")}extendToolbar(e){this.tooltip=new Dw(this.quill,this.options.bounds),e.container!=null&&(this.tooltip.root.appendChild(e.container),this.buildButtons(e.container.querySelectorAll("button"),So),this.buildPickers(e.container.querySelectorAll("select"),So))}}Np.DEFAULTS=bs({},Oo.DEFAULTS,{modules:{toolbar:{handlers:{link(n){n?this.quill.theme.tooltip.edit():this.quill.format("link",!1,G.sources.USER)}}}}});const Bw=[[{header:["1","2","3",!1]}],["bold","italic","underline","link"],[{list:"ordered"},{list:"bullet"}],["clean"]];class Vw extends Ip{static TEMPLATE=['<a class="ql-preview" rel="noopener noreferrer" target="_blank" href="about:blank"></a>','<input type="text" data-formula="e=mc^2" data-link="https://quilljs.com" data-video="Embed URL">','<a class="ql-action"></a>','<a class="ql-remove"></a>'].join("");preview=this.root.querySelector("a.ql-preview");listen(){super.listen(),this.root.querySelector("a.ql-action").addEventListener("click",e=>{this.root.classList.contains("ql-editing")?this.save():this.edit("link",this.preview.textContent),e.preventDefault()}),this.root.querySelector("a.ql-remove").addEventListener("click",e=>{if(this.linkRange!=null){const t=this.linkRange;this.restoreFocus(),this.quill.formatText(t,"link",!1,ce.sources.USER),delete this.linkRange}e.preventDefault(),this.hide()}),this.quill.on(ce.events.SELECTION_CHANGE,(e,t,r)=>{if(e!=null){if(e.length===0&&r===ce.sources.USER){const[s,i]=this.quill.scroll.descendant(Ia,e.index);if(s!=null){this.linkRange=new Fs(e.index-i,s.length());const o=Ia.formats(s.domNode);this.preview.textContent=o,this.preview.setAttribute("href",o),this.show();const a=this.quill.getBounds(this.linkRange);a!=null&&this.position(a);return}}else delete this.linkRange;this.hide()}})}show(){super.show(),this.root.removeAttribute("data-mode")}}class wp extends Oo{constructor(e,t){t.modules.toolbar!=null&&t.modules.toolbar.container==null&&(t.modules.toolbar.container=Bw),super(e,t),this.quill.container.classList.add("ql-snow")}extendToolbar(e){e.container!=null&&(e.container.classList.add("ql-snow"),this.buildButtons(e.container.querySelectorAll("button"),So),this.buildPickers(e.container.querySelectorAll("select"),So),this.tooltip=new Vw(this.quill,this.options.bounds),e.container.querySelector(".ql-link")&&this.quill.keyboard.addBinding({key:"k",shortKey:!0},(t,r)=>{e.handlers.link.call(e,!r.format.link)}))}}wp.DEFAULTS=bs({},Oo.DEFAULTS,{modules:{toolbar:{handlers:{link(n){if(n){const e=this.quill.getSelection();if(e==null||e.length===0)return;let t=this.quill.getText(e);/^\S+@\S+\.\S+$/.test(t)&&t.indexOf("mailto:")!==0&&(t=`mailto:${t}`);const{tooltip:r}=this.quill.theme;r.edit("link",t)}else this.quill.format("link",!1,G.sources.USER)}}}}});G.register({"attributors/attribute/direction":lp,"attributors/class/align":ip,"attributors/class/background":FI,"attributors/class/color":WI,"attributors/class/direction":cp,"attributors/class/font":fp,"attributors/class/size":gp,"attributors/style/align":op,"attributors/style/background":Hc,"attributors/style/color":Jc,"attributors/style/direction":up,"attributors/style/font":dp,"attributors/style/size":pp},!0);G.register({"formats/align":ip,"formats/direction":cp,"formats/indent":kN,"formats/background":Hc,"formats/color":Jc,"formats/font":fp,"formats/size":gp,"formats/blockquote":DN,"formats/code-block":cn,"formats/header":BN,"formats/list":Lo,"formats/bold":ru,"formats/code":Qc,"formats/italic":VN,"formats/link":Ia,"formats/script":PN,"formats/strike":MN,"formats/underline":UN,"formats/formula":WN,"formats/image":FN,"formats/video":ZN,"modules/syntax":vp,"modules/table":$N,"modules/toolbar":iu,"themes/bubble":Np,"themes/snow":wp,"ui/icons":So,"ui/picker":Ga,"ui/icon-picker":Ep,"ui/color-picker":Ap,"ui/tooltip":Sp},!0);var vl={exports:{}};var Df;function Pw(){return Df||(Df=1,(function(n,e){(function(t,r){n.exports=r()})(self,(()=>(()=>{var t={582:(o,a,l)=>{l.d(a,{Z:()=>d});var c=l(81),f=l.n(c),g=l(645),h=l.n(g)()(f());h.push([o.id,".ql-container{position:relative;overflow:hidden}@media(pointer: coarse){.ql-cursor-caret-container{z-index:-1}}.ql-cursor.hidden{display:none}.ql-cursor .ql-cursor-caret-container,.ql-cursor .ql-cursor-flag{position:absolute}.ql-cursor .ql-cursor-flag{z-index:1;transform:translate3d(-1px, -100%, 0);opacity:0;visibility:hidden;color:#fff;padding-bottom:2px;border-radius:0 3px 3px 0}.ql-cursor .ql-cursor-flag.flag-flipped{border-radius:3px 0 0 3px;transform:translate3d(calc(-100% + 1px ), -100%, 0)}@media screen{.ql-cursor .ql-cursor-flag{transition:opacity 0ms cubic-bezier(0.25, 0.46, 0.45, 0.94) 0ms,visibility 0ms cubic-bezier(0.25, 0.46, 0.45, 0.94) 0ms}}.ql-cursor .ql-cursor-flag .ql-cursor-name{margin-left:5px;margin-right:5px;display:inline-block;margin-top:-2px;white-space:nowrap}.ql-cursor .ql-cursor-flag.no-delay[style]{transition-delay:unset !important}.ql-cursor .ql-cursor-caret-container{cursor:text;margin-left:-9px;padding:0 9px}.ql-cursor .ql-cursor-caret-container.hover+.ql-cursor-flag{opacity:1;visibility:visible;transition:none}.ql-cursor .ql-cursor-caret-container.no-pointer{pointer-events:none}.ql-cursor .ql-cursor-caret-container .ql-cursor-caret{position:absolute;top:0;bottom:0;width:2px;margin-left:-1px;background-color:attr(data-color)}.ql-cursor .ql-cursor-selection-block{position:absolute;pointer-events:none}",""]);const d=h},645:o=>{o.exports=function(a){var l=[];return l.toString=function(){return this.map((function(c){var f="",g=c[5]!==void 0;return c[4]&&(f+="@supports (".concat(c[4],") {")),c[2]&&(f+="@media ".concat(c[2]," {")),g&&(f+="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {")),f+=a(c),g&&(f+="}"),c[2]&&(f+="}"),c[4]&&(f+="}"),f})).join("")},l.i=function(c,f,g,h,d){typeof c=="string"&&(c=[[null,c,void 0]]);var m={};if(g)for(var v=0;v<this.length;v++){var I=this[v][0];I!=null&&(m[I]=!0)}for(var E=0;E<c.length;E++){var y=[].concat(c[E]);g&&m[y[0]]||(d!==void 0&&(y[5]===void 0||(y[1]="@layer".concat(y[5].length>0?" ".concat(y[5]):""," {").concat(y[1],"}")),y[5]=d),f&&(y[2]&&(y[1]="@media ".concat(y[2]," {").concat(y[1],"}")),y[2]=f),h&&(y[4]?(y[1]="@supports (".concat(y[4],") {").concat(y[1],"}"),y[4]=h):y[4]="".concat(h)),l.push(y))}},l}},81:o=>{o.exports=function(a){return a[1]}},529:o=>{var a=-1;function l(p,A,S,T){if(p===A)return p?[[0,p]]:[];if(S!=null){var B=(function(P,w,D){var O=typeof D=="number"?{index:D,length:0}:D.oldRange,R=typeof D=="number"?null:D.newRange,M=P.length,F=w.length;if(O.length===0&&(R===null||R.length===0)){var q=O.index,K=P.slice(0,q),oe=P.slice(q),re=R?R.index:null,J=q+F-M;if((re===null||re===J)&&!(J<0||J>F)){var Se=w.slice(0,J);if((ve=w.slice(J))===oe){var ne=Math.min(q,J);if((be=K.slice(0,ne))===(he=Se.slice(0,ne)))return E(be,K.slice(ne),Se.slice(ne),oe)}}if(re===null||re===q){var ue=q,ve=(Se=w.slice(0,ue),w.slice(ue));if(Se===K){var Q=Math.min(M-ue,F-ue);if((Ae=oe.slice(oe.length-Q))===(Ie=ve.slice(ve.length-Q)))return E(K,oe.slice(0,oe.length-Q),ve.slice(0,ve.length-Q),Ae)}}}if(O.length>0&&R&&R.length===0){var be=P.slice(0,O.index),Ae=P.slice(O.index+O.length);if(!(F<(ne=be.length)+(Q=Ae.length))){var he=w.slice(0,ne),Ie=w.slice(F-Q);if(be===he&&Ae===Ie)return E(be,P.slice(ne,M-Q),w.slice(ne,F-Q),Ae)}}return null})(p,A,S);if(B)return B}var $=f(p,A),X=p.substring(0,$);$=g(p=p.substring($),A=A.substring($));var H=p.substring(p.length-$),N=(function(P,w){var D;if(!P)return[[1,w]];if(!w)return[[a,P]];var O=P.length>w.length?P:w,R=P.length>w.length?w:P,M=O.indexOf(R);if(M!==-1)return D=[[1,O.substring(0,M)],[0,R],[1,O.substring(M+R.length)]],P.length>w.length&&(D[0][0]=D[2][0]=a),D;if(R.length===1)return[[a,P],[1,w]];var F=(function(ue,ve){var Q=ue.length>ve.length?ue:ve,be=ue.length>ve.length?ve:ue;if(Q.length<4||2*be.length<Q.length)return null;function Ae(Ct,At,ht){for(var kt,pt,rt,Ue,mt=Ct.substring(ht,ht+Math.floor(Ct.length/4)),st=-1,Xe="";(st=At.indexOf(mt,st+1))!==-1;){var je=f(Ct.substring(ht),At.substring(st)),yt=g(Ct.substring(0,ht),At.substring(0,st));Xe.length<yt+je&&(Xe=At.substring(st-yt,st)+At.substring(st,st+je),kt=Ct.substring(0,ht-yt),pt=Ct.substring(ht+je),rt=At.substring(0,st-yt),Ue=At.substring(st+je))}return 2*Xe.length>=Ct.length?[kt,pt,rt,Ue,Xe]:null}var he,Ie,Ne,we,$e,vt=Ae(Q,be,Math.ceil(Q.length/4)),Ut=Ae(Q,be,Math.ceil(Q.length/2));return vt||Ut?(he=Ut?vt&&vt[4].length>Ut[4].length?vt:Ut:vt,ue.length>ve.length?(Ie=he[0],Ne=he[1],we=he[2],$e=he[3]):(we=he[0],$e=he[1],Ie=he[2],Ne=he[3]),[Ie,Ne,we,$e,he[4]]):null})(P,w);if(F){var q=F[0],K=F[1],oe=F[2],re=F[3],J=F[4],Se=l(q,oe),ne=l(K,re);return Se.concat([[0,J]],ne)}return(function(ue,ve){for(var Q=ue.length,be=ve.length,Ae=Math.ceil((Q+be)/2),he=Ae,Ie=2*Ae,Ne=new Array(Ie),we=new Array(Ie),$e=0;$e<Ie;$e++)Ne[$e]=-1,we[$e]=-1;Ne[he+1]=0,we[he+1]=0;for(var vt=Q-be,Ut=vt%2!=0,Ct=0,At=0,ht=0,kt=0,pt=0;pt<Ae;pt++){for(var rt=-pt+Ct;rt<=pt-At;rt+=2){for(var Ue=he+rt,mt=(Ye=rt===-pt||rt!==pt&&Ne[Ue-1]<Ne[Ue+1]?Ne[Ue+1]:Ne[Ue-1]+1)-rt;Ye<Q&&mt<be&&ue.charAt(Ye)===ve.charAt(mt);)Ye++,mt++;if(Ne[Ue]=Ye,Ye>Q)At+=2;else if(mt>be)Ct+=2;else if(Ut&&(je=he+vt-rt)>=0&&je<Ie&&we[je]!==-1&&Ye>=(Xe=Q-we[je]))return c(ue,ve,Ye,mt)}for(var st=-pt+ht;st<=pt-kt;st+=2){for(var Xe,je=he+st,yt=(Xe=st===-pt||st!==pt&&we[je-1]<we[je+1]?we[je+1]:we[je-1]+1)-st;Xe<Q&&yt<be&&ue.charAt(Q-Xe-1)===ve.charAt(be-yt-1);)Xe++,yt++;if(we[je]=Xe,Xe>Q)kt+=2;else if(yt>be)ht+=2;else if(!Ut){var Ye;if((Ue=he+vt-st)>=0&&Ue<Ie&&Ne[Ue]!==-1&&(mt=he+(Ye=Ne[Ue])-Ue,Ye>=(Xe=Q-Xe)))return c(ue,ve,Ye,mt)}}}return[[a,ue],[1,ve]]})(P,w)})(p=p.substring(0,p.length-$),A=A.substring(0,A.length-$));return X&&N.unshift([0,X]),H&&N.push([0,H]),h(N,T),N}function c(p,A,S,T){var B=p.substring(0,S),$=A.substring(0,T),X=p.substring(S),H=A.substring(T),N=l(B,$),P=l(X,H);return N.concat(P)}function f(p,A){if(!p||!A||p.charAt(0)!==A.charAt(0))return 0;for(var S=0,T=Math.min(p.length,A.length),B=T,$=0;S<B;)p.substring($,B)==A.substring($,B)?$=S=B:T=B,B=Math.floor((T-S)/2+S);return d(p.charCodeAt(B-1))&&B--,B}function g(p,A){if(!p||!A||p.slice(-1)!==A.slice(-1))return 0;for(var S=0,T=Math.min(p.length,A.length),B=T,$=0;S<B;)p.substring(p.length-B,p.length-$)==A.substring(A.length-B,A.length-$)?$=S=B:T=B,B=Math.floor((T-S)/2+S);return m(p.charCodeAt(p.length-B))&&B--,B}function h(p,A){p.push([0,""]);for(var S,T=0,B=0,$=0,X="",H="";T<p.length;)if(T<p.length-1&&!p[T][1])p.splice(T,1);else switch(p[T][0]){case 1:$++,H+=p[T][1],T++;break;case a:B++,X+=p[T][1],T++;break;case 0:var N=T-$-B-1;if(A){if(N>=0&&I(p[N][1])){var P=p[N][1].slice(-1);if(p[N][1]=p[N][1].slice(0,-1),X=P+X,H=P+H,!p[N][1]){p.splice(N,1),T--;var w=N-1;p[w]&&p[w][0]===1&&($++,H=p[w][1]+H,w--),p[w]&&p[w][0]===a&&(B++,X=p[w][1]+X,w--),N=w}}v(p[T][1])&&(P=p[T][1].charAt(0),p[T][1]=p[T][1].slice(1),X+=P,H+=P)}if(T<p.length-1&&!p[T][1]){p.splice(T,1);break}if(X.length>0||H.length>0){X.length>0&&H.length>0&&((S=f(H,X))!==0&&(N>=0?p[N][1]+=H.substring(0,S):(p.splice(0,0,[0,H.substring(0,S)]),T++),H=H.substring(S),X=X.substring(S)),(S=g(H,X))!==0&&(p[T][1]=H.substring(H.length-S)+p[T][1],H=H.substring(0,H.length-S),X=X.substring(0,X.length-S)));var D=$+B;X.length===0&&H.length===0?(p.splice(T-D,D),T-=D):X.length===0?(p.splice(T-D,D,[1,H]),T=T-D+1):H.length===0?(p.splice(T-D,D,[a,X]),T=T-D+1):(p.splice(T-D,D,[a,X],[1,H]),T=T-D+2)}T!==0&&p[T-1][0]===0?(p[T-1][1]+=p[T][1],p.splice(T,1)):T++,$=0,B=0,X="",H=""}p[p.length-1][1]===""&&p.pop();var O=!1;for(T=1;T<p.length-1;)p[T-1][0]===0&&p[T+1][0]===0&&(p[T][1].substring(p[T][1].length-p[T-1][1].length)===p[T-1][1]?(p[T][1]=p[T-1][1]+p[T][1].substring(0,p[T][1].length-p[T-1][1].length),p[T+1][1]=p[T-1][1]+p[T+1][1],p.splice(T-1,1),O=!0):p[T][1].substring(0,p[T+1][1].length)==p[T+1][1]&&(p[T-1][1]+=p[T+1][1],p[T][1]=p[T][1].substring(p[T+1][1].length)+p[T+1][1],p.splice(T+1,1),O=!0)),T++;O&&h(p,A)}function d(p){return p>=55296&&p<=56319}function m(p){return p>=56320&&p<=57343}function v(p){return m(p.charCodeAt(0))}function I(p){return d(p.charCodeAt(p.length-1))}function E(p,A,S,T){return I(p)||v(T)?null:(function(B){for(var $=[],X=0;X<B.length;X++)B[X][1].length>0&&$.push(B[X]);return $})([[0,p],[a,A],[1,S],[0,T]])}function y(p,A,S){return l(p,A,S,!0)}y.INSERT=1,y.DELETE=a,y.EQUAL=0,o.exports=y},465:(o,a,l)=>{o=l.nmd(o);var c="__lodash_hash_undefined__",f=9007199254740991,g="[object Arguments]",h="[object Boolean]",d="[object Date]",m="[object Function]",v="[object GeneratorFunction]",I="[object Map]",E="[object Number]",y="[object Object]",p="[object Promise]",A="[object RegExp]",S="[object Set]",T="[object String]",B="[object Symbol]",$="[object WeakMap]",X="[object ArrayBuffer]",H="[object DataView]",N="[object Float32Array]",P="[object Float64Array]",w="[object Int8Array]",D="[object Int16Array]",O="[object Int32Array]",R="[object Uint8Array]",M="[object Uint8ClampedArray]",F="[object Uint16Array]",q="[object Uint32Array]",K=/\w*$/,oe=/^\[object .+?Constructor\]$/,re=/^(?:0|[1-9]\d*)$/,J={};J[g]=J["[object Array]"]=J[X]=J[H]=J[h]=J[d]=J[N]=J[P]=J[w]=J[D]=J[O]=J[I]=J[E]=J[y]=J[A]=J[S]=J[T]=J[B]=J[R]=J[M]=J[F]=J[q]=!0,J["[object Error]"]=J[m]=J[$]=!1;var Se=typeof l.g=="object"&&l.g&&l.g.Object===Object&&l.g,ne=typeof self=="object"&&self&&self.Object===Object&&self,ue=Se||ne||Function("return this")(),ve=a&&!a.nodeType&&a,Q=ve&&o&&!o.nodeType&&o,be=Q&&Q.exports===ve;function Ae(_,W){return _.set(W[0],W[1]),_}function he(_,W){return _.add(W),_}function Ie(_,W,z,te){var Ee=-1,We=_?_.length:0;for(te;++Ee<We;)z=W(z,_[Ee],Ee,_);return z}function Ne(_){var W=!1;if(_!=null&&typeof _.toString!="function")try{W=!!(_+"")}catch{}return W}function we(_){var W=-1,z=Array(_.size);return _.forEach((function(te,Ee){z[++W]=[Ee,te]})),z}function $e(_,W){return function(z){return _(W(z))}}function vt(_){var W=-1,z=Array(_.size);return _.forEach((function(te){z[++W]=te})),z}var Ut,Ct=Array.prototype,At=Function.prototype,ht=Object.prototype,kt=ue["__core-js_shared__"],pt=(Ut=/[^.]+$/.exec(kt&&kt.keys&&kt.keys.IE_PROTO||""))?"Symbol(src)_1."+Ut:"",rt=At.toString,Ue=ht.hasOwnProperty,mt=ht.toString,st=RegExp("^"+rt.call(Ue).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Xe=be?ue.Buffer:void 0,je=ue.Symbol,yt=ue.Uint8Array,Ye=$e(Object.getPrototypeOf,Object),ur=Object.create,Cn=ht.propertyIsEnumerable,Ts=Ct.splice,hr=Object.getOwnPropertySymbols,fr=Xe?Xe.isBuffer:void 0,Hr=$e(Object.keys,Object),Rn=hn(ue,"DataView"),qt=hn(ue,"Map"),Rt=hn(ue,"Promise"),Dt=hn(ue,"Set"),_t=hn(ue,"WeakMap"),Et=hn(Object,"create"),_n=fn(Rn),Bt=fn(qt),Ln=fn(Rt),En=fn(Dt),dr=fn(_t),un=je?je.prototype:void 0,gr=un?un.valueOf:void 0;function wt(_){var W=-1,z=_?_.length:0;for(this.clear();++W<z;){var te=_[W];this.set(te[0],te[1])}}function Vt(_){var W=-1,z=_?_.length:0;for(this.clear();++W<z;){var te=_[W];this.set(te[0],te[1])}}function Wt(_){var W=-1,z=_?_.length:0;for(this.clear();++W<z;){var te=_[W];this.set(te[0],te[1])}}function On(_){this.__data__=new Vt(_)}function zt(_,W,z){var te=_[W];Ue.call(_,W)&&ts(te,z)&&(z!==void 0||W in _)||(_[W]=z)}function kn(_,W){for(var z=_.length;z--;)if(ts(_[z][0],W))return z;return-1}function Je(_,W,z,te,Ee,We,et){var Le;if(te&&(Le=We?te(_,Ee,We,et):te(_)),Le!==void 0)return Le;if(!Ve(_))return _;var lt=k(_);if(lt){if(Le=(function(ge){var Fe=ge.length,it=ge.constructor(Fe);return Fe&&typeof ge[0]=="string"&&Ue.call(ge,"index")&&(it.index=ge.index,it.input=ge.input),it})(_),!W)return(function(ge,Fe){var it=-1,Re=ge.length;for(Fe||(Fe=Array(Re));++it<Re;)Fe[it]=ge[it];return Fe})(_,Le)}else{var tt=Qe(_),dn=tt==m||tt==v;if(Y(_))return(function(ge,Fe){if(Fe)return ge.slice();var it=new ge.constructor(ge.length);return ge.copy(it),it})(_,W);if(tt==y||tt==g||dn&&!We){if(Ne(_))return We?_:{};if(Le=(function(ge){return typeof ge.constructor!="function"||Dn(ge)?{}:Ve(Fe=Ye(ge))?ur(Fe):{};var Fe})(dn?{}:_),!W)return(function(ge,Fe){return Qr(ge,Vr(ge),Fe)})(_,(function(ge,Fe){return ge&&Qr(Fe,Ce(Fe),ge)})(Le,_))}else{if(!J[tt])return We?_:{};Le=(function(ge,Fe,it,Re){var ke,sn=ge.constructor;switch(Fe){case X:return pr(ge);case h:case d:return new sn(+ge);case H:return(function(Oe,ft){var ot=ft?pr(Oe.buffer):Oe.buffer;return new Oe.constructor(ot,Oe.byteOffset,Oe.byteLength)})(ge,Re);case N:case P:case w:case D:case O:case R:case M:case F:case q:return(function(Oe,ft){var ot=ft?pr(Oe.buffer):Oe.buffer;return new Oe.constructor(ot,Oe.byteOffset,Oe.length)})(ge,Re);case I:return(function(Oe,ft,ot){return Ie(ft?ot(we(Oe),!0):we(Oe),Ae,new Oe.constructor)})(ge,Re,it);case E:case T:return new sn(ge);case A:return(function(Oe){var ft=new Oe.constructor(Oe.source,K.exec(Oe));return ft.lastIndex=Oe.lastIndex,ft})(ge);case S:return(function(Oe,ft,ot){return Ie(ft?ot(vt(Oe),!0):vt(Oe),he,new Oe.constructor)})(ge,Re,it);case B:return ke=ge,gr?Object(gr.call(ke)):{}}})(_,tt,Je,W)}}et||(et=new On);var Xt=et.get(_);if(Xt)return Xt;if(et.set(_,Le),!lt)var gn=z?(function(ge){return(function(Fe,it,Re){var ke=it(Fe);return k(Fe)?ke:(function(sn,Oe){for(var ft=-1,ot=Oe.length,on=sn.length;++ft<ot;)sn[on+ft]=Oe[ft];return sn})(ke,Re(Fe))})(ge,Ce,Vr)})(_):Ce(_);return(function(ge,Fe){for(var it=-1,Re=ge?ge.length:0;++it<Re&&Fe(ge[it],it)!==!1;);})(gn||_,(function(ge,Fe){gn&&(ge=_[Fe=ge]),zt(Le,Fe,Je(ge,W,z,te,Fe,_,et))})),Le}function pr(_){var W=new _.constructor(_.byteLength);return new yt(W).set(new yt(_)),W}function Qr(_,W,z,te){z||(z={});for(var Ee=-1,We=W.length;++Ee<We;){var et=W[Ee],Le=void 0;zt(z,et,Le===void 0?_[et]:Le)}return z}function Sn(_,W){var z,te,Ee=_.__data__;return((te=typeof(z=W))=="string"||te=="number"||te=="symbol"||te=="boolean"?z!=="__proto__":z===null)?Ee[typeof W=="string"?"string":"hash"]:Ee.map}function hn(_,W){var z=(function(te,Ee){return te?.[Ee]})(_,W);return(function(te){return!(!Ve(te)||(Ee=te,pt&&pt in Ee))&&(ie(te)||Ne(te)?st:oe).test(fn(te));var Ee})(z)?z:void 0}wt.prototype.clear=function(){this.__data__=Et?Et(null):{}},wt.prototype.delete=function(_){return this.has(_)&&delete this.__data__[_]},wt.prototype.get=function(_){var W=this.__data__;if(Et){var z=W[_];return z===c?void 0:z}return Ue.call(W,_)?W[_]:void 0},wt.prototype.has=function(_){var W=this.__data__;return Et?W[_]!==void 0:Ue.call(W,_)},wt.prototype.set=function(_,W){return this.__data__[_]=Et&&W===void 0?c:W,this},Vt.prototype.clear=function(){this.__data__=[]},Vt.prototype.delete=function(_){var W=this.__data__,z=kn(W,_);return!(z<0||(z==W.length-1?W.pop():Ts.call(W,z,1),0))},Vt.prototype.get=function(_){var W=this.__data__,z=kn(W,_);return z<0?void 0:W[z][1]},Vt.prototype.has=function(_){return kn(this.__data__,_)>-1},Vt.prototype.set=function(_,W){var z=this.__data__,te=kn(z,_);return te<0?z.push([_,W]):z[te][1]=W,this},Wt.prototype.clear=function(){this.__data__={hash:new wt,map:new(qt||Vt),string:new wt}},Wt.prototype.delete=function(_){return Sn(this,_).delete(_)},Wt.prototype.get=function(_){return Sn(this,_).get(_)},Wt.prototype.has=function(_){return Sn(this,_).has(_)},Wt.prototype.set=function(_,W){return Sn(this,_).set(_,W),this},On.prototype.clear=function(){this.__data__=new Vt},On.prototype.delete=function(_){return this.__data__.delete(_)},On.prototype.get=function(_){return this.__data__.get(_)},On.prototype.has=function(_){return this.__data__.has(_)},On.prototype.set=function(_,W){var z=this.__data__;if(z instanceof Vt){var te=z.__data__;if(!qt||te.length<199)return te.push([_,W]),this;z=this.__data__=new Wt(te)}return z.set(_,W),this};var Vr=hr?$e(hr,Object):function(){return[]},Qe=function(_){return mt.call(_)};function es(_,W){return!!(W=W??f)&&(typeof _=="number"||re.test(_))&&_>-1&&_%1==0&&_<W}function Dn(_){var W=_&&_.constructor;return _===(typeof W=="function"&&W.prototype||ht)}function fn(_){if(_!=null){try{return rt.call(_)}catch{}try{return _+""}catch{}}return""}function ts(_,W){return _===W||_!=_&&W!=W}(Rn&&Qe(new Rn(new ArrayBuffer(1)))!=H||qt&&Qe(new qt)!=I||Rt&&Qe(Rt.resolve())!=p||Dt&&Qe(new Dt)!=S||_t&&Qe(new _t)!=$)&&(Qe=function(_){var W=mt.call(_),z=W==y?_.constructor:void 0,te=z?fn(z):void 0;if(te)switch(te){case _n:return H;case Bt:return I;case Ln:return p;case En:return S;case dr:return $}return W});var k=Array.isArray;function U(_){return _!=null&&(function(W){return typeof W=="number"&&W>-1&&W%1==0&&W<=f})(_.length)&&!ie(_)}var Y=fr||function(){return!1};function ie(_){var W=Ve(_)?mt.call(_):"";return W==m||W==v}function Ve(_){var W=typeof _;return!!_&&(W=="object"||W=="function")}function Ce(_){return U(_)?(function(W,z){var te=k(W)||(function(Le){return(function(lt){return(function(tt){return!!tt&&typeof tt=="object"})(lt)&&U(lt)})(Le)&&Ue.call(Le,"callee")&&(!Cn.call(Le,"callee")||mt.call(Le)==g)})(W)?(function(Le,lt){for(var tt=-1,dn=Array(Le);++tt<Le;)dn[tt]=lt(tt);return dn})(W.length,String):[],Ee=te.length,We=!!Ee;for(var et in W)!Ue.call(W,et)||We&&(et=="length"||es(et,Ee))||te.push(et);return te})(_):(function(W){if(!Dn(W))return Hr(W);var z=[];for(var te in Object(W))Ue.call(W,te)&&te!="constructor"&&z.push(te);return z})(_)}o.exports=function(_){return Je(_,!0,!0)}},307:(o,a,l)=>{o=l.nmd(o);var c="__lodash_hash_undefined__",f=9007199254740991,g="[object Arguments]",h="[object Array]",d="[object Boolean]",m="[object Date]",v="[object Error]",I="[object Function]",E="[object Map]",y="[object Number]",p="[object Object]",A="[object Promise]",S="[object RegExp]",T="[object Set]",B="[object String]",$="[object WeakMap]",X="[object ArrayBuffer]",H="[object DataView]",N=/^\[object .+?Constructor\]$/,P=/^(?:0|[1-9]\d*)$/,w={};w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w[g]=w[h]=w[X]=w[d]=w[H]=w[m]=w[v]=w[I]=w[E]=w[y]=w[p]=w[S]=w[T]=w[B]=w[$]=!1;var D=typeof l.g=="object"&&l.g&&l.g.Object===Object&&l.g,O=typeof self=="object"&&self&&self.Object===Object&&self,R=D||O||Function("return this")(),M=a&&!a.nodeType&&a,F=M&&o&&!o.nodeType&&o,q=F&&F.exports===M,K=q&&D.process,oe=(function(){try{return K&&K.binding&&K.binding("util")}catch{}})(),re=oe&&oe.isTypedArray;function J(k,U){for(var Y=-1,ie=k==null?0:k.length;++Y<ie;)if(U(k[Y],Y,k))return!0;return!1}function Se(k){var U=-1,Y=Array(k.size);return k.forEach((function(ie,Ve){Y[++U]=[Ve,ie]})),Y}function ne(k){var U=-1,Y=Array(k.size);return k.forEach((function(ie){Y[++U]=ie})),Y}var ue,ve,Q,be=Array.prototype,Ae=Function.prototype,he=Object.prototype,Ie=R["__core-js_shared__"],Ne=Ae.toString,we=he.hasOwnProperty,$e=(ue=/[^.]+$/.exec(Ie&&Ie.keys&&Ie.keys.IE_PROTO||""))?"Symbol(src)_1."+ue:"",vt=he.toString,Ut=RegExp("^"+Ne.call(we).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ct=q?R.Buffer:void 0,At=R.Symbol,ht=R.Uint8Array,kt=he.propertyIsEnumerable,pt=be.splice,rt=At?At.toStringTag:void 0,Ue=Object.getOwnPropertySymbols,mt=Ct?Ct.isBuffer:void 0,st=(ve=Object.keys,Q=Object,function(k){return ve(Q(k))}),Xe=Wt(R,"DataView"),je=Wt(R,"Map"),yt=Wt(R,"Promise"),Ye=Wt(R,"Set"),ur=Wt(R,"WeakMap"),Cn=Wt(Object,"create"),Ts=Je(Xe),hr=Je(je),fr=Je(yt),Hr=Je(Ye),Rn=Je(ur),qt=At?At.prototype:void 0,Rt=qt?qt.valueOf:void 0;function Dt(k){var U=-1,Y=k==null?0:k.length;for(this.clear();++U<Y;){var ie=k[U];this.set(ie[0],ie[1])}}function _t(k){var U=-1,Y=k==null?0:k.length;for(this.clear();++U<Y;){var ie=k[U];this.set(ie[0],ie[1])}}function Et(k){var U=-1,Y=k==null?0:k.length;for(this.clear();++U<Y;){var ie=k[U];this.set(ie[0],ie[1])}}function _n(k){var U=-1,Y=k==null?0:k.length;for(this.__data__=new Et;++U<Y;)this.add(k[U])}function Bt(k){var U=this.__data__=new _t(k);this.size=U.size}function Ln(k,U){for(var Y=k.length;Y--;)if(pr(k[Y][0],U))return Y;return-1}function En(k){return k==null?k===void 0?"[object Undefined]":"[object Null]":rt&&rt in Object(k)?(function(U){var Y=we.call(U,rt),ie=U[rt];try{U[rt]=void 0;var Ve=!0}catch{}var Ce=vt.call(U);return Ve&&(Y?U[rt]=ie:delete U[rt]),Ce})(k):(function(U){return vt.call(U)})(k)}function dr(k){return Dn(k)&&En(k)==g}function un(k,U,Y,ie,Ve){return k===U||(k==null||U==null||!Dn(k)&&!Dn(U)?k!=k&&U!=U:(function(Ce,_,W,z,te,Ee){var We=Sn(Ce),et=Sn(_),Le=We?h:zt(Ce),lt=et?h:zt(_),tt=(Le=Le==g?p:Le)==p,dn=(lt=lt==g?p:lt)==p,Xt=Le==lt;if(Xt&&hn(Ce)){if(!hn(_))return!1;We=!0,tt=!1}if(Xt&&!tt)return Ee||(Ee=new Bt),We||fn(Ce)?gr(Ce,_,W,z,te,Ee):(function(Re,ke,sn,Oe,ft,ot,on){switch(sn){case H:if(Re.byteLength!=ke.byteLength||Re.byteOffset!=ke.byteOffset)return!1;Re=Re.buffer,ke=ke.buffer;case X:return!(Re.byteLength!=ke.byteLength||!ot(new ht(Re),new ht(ke)));case d:case m:case y:return pr(+Re,+ke);case v:return Re.name==ke.name&&Re.message==ke.message;case S:case B:return Re==ke+"";case E:var Jt=Se;case T:var Ft=1&Oe;if(Jt||(Jt=ne),Re.size!=ke.size&&!Ft)return!1;var Zt=on.get(Re);if(Zt)return Zt==ke;Oe|=2,on.set(Re,ke);var Lt=gr(Jt(Re),Jt(ke),Oe,ft,ot,on);return on.delete(Re),Lt;case"[object Symbol]":if(Rt)return Rt.call(Re)==Rt.call(ke)}return!1})(Ce,_,Le,W,z,te,Ee);if(!(1&W)){var gn=tt&&we.call(Ce,"__wrapped__"),ge=dn&&we.call(_,"__wrapped__");if(gn||ge){var Fe=gn?Ce.value():Ce,it=ge?_.value():_;return Ee||(Ee=new Bt),te(Fe,it,W,z,Ee)}}return!!Xt&&(Ee||(Ee=new Bt),(function(Re,ke,sn,Oe,ft,ot){var on=1&sn,Jt=wt(Re),Ft=Jt.length;if(Ft!=wt(ke).length&&!on)return!1;for(var Zt=Ft;Zt--;){var Lt=Jt[Zt];if(!(on?Lt in ke:we.call(ke,Lt)))return!1}var Xs=ot.get(Re);if(Xs&&ot.get(ke))return Xs==ke;var an=!0;ot.set(Re,ke),ot.set(ke,Re);for(var xs=on;++Zt<Ft;){var ns=Re[Lt=Jt[Zt]],rs=ke[Lt];if(Oe)var Js=on?Oe(rs,ns,Lt,ke,Re,ot):Oe(ns,rs,Lt,Re,ke,ot);if(!(Js===void 0?ns===rs||ft(ns,rs,sn,Oe,ot):Js)){an=!1;break}xs||(xs=Lt=="constructor")}if(an&&!xs){var Pr=Re.constructor,Tt=ke.constructor;Pr==Tt||!("constructor"in Re)||!("constructor"in ke)||typeof Pr=="function"&&Pr instanceof Pr&&typeof Tt=="function"&&Tt instanceof Tt||(an=!1)}return ot.delete(Re),ot.delete(ke),an})(Ce,_,W,z,te,Ee))})(k,U,Y,ie,un,Ve))}function gr(k,U,Y,ie,Ve,Ce){var _=1&Y,W=k.length,z=U.length;if(W!=z&&!(_&&z>W))return!1;var te=Ce.get(k);if(te&&Ce.get(U))return te==U;var Ee=-1,We=!0,et=2&Y?new _n:void 0;for(Ce.set(k,U),Ce.set(U,k);++Ee<W;){var Le=k[Ee],lt=U[Ee];if(ie)var tt=_?ie(lt,Le,Ee,U,k,Ce):ie(Le,lt,Ee,k,U,Ce);if(tt!==void 0){if(tt)continue;We=!1;break}if(et){if(!J(U,(function(dn,Xt){if(gn=Xt,!et.has(gn)&&(Le===dn||Ve(Le,dn,Y,ie,Ce)))return et.push(Xt);var gn}))){We=!1;break}}else if(Le!==lt&&!Ve(Le,lt,Y,ie,Ce)){We=!1;break}}return Ce.delete(k),Ce.delete(U),We}function wt(k){return(function(U,Y,ie){var Ve=Y(U);return Sn(U)?Ve:(function(Ce,_){for(var W=-1,z=_.length,te=Ce.length;++W<z;)Ce[te+W]=_[W];return Ce})(Ve,ie(U))})(k,ts,On)}function Vt(k,U){var Y,ie,Ve=k.__data__;return((ie=typeof(Y=U))=="string"||ie=="number"||ie=="symbol"||ie=="boolean"?Y!=="__proto__":Y===null)?Ve[typeof U=="string"?"string":"hash"]:Ve.map}function Wt(k,U){var Y=(function(ie,Ve){return ie?.[Ve]})(k,U);return(function(ie){return!(!es(ie)||(function(Ve){return!!$e&&$e in Ve})(ie))&&(Vr(ie)?Ut:N).test(Je(ie))})(Y)?Y:void 0}Dt.prototype.clear=function(){this.__data__=Cn?Cn(null):{},this.size=0},Dt.prototype.delete=function(k){var U=this.has(k)&&delete this.__data__[k];return this.size-=U?1:0,U},Dt.prototype.get=function(k){var U=this.__data__;if(Cn){var Y=U[k];return Y===c?void 0:Y}return we.call(U,k)?U[k]:void 0},Dt.prototype.has=function(k){var U=this.__data__;return Cn?U[k]!==void 0:we.call(U,k)},Dt.prototype.set=function(k,U){var Y=this.__data__;return this.size+=this.has(k)?0:1,Y[k]=Cn&&U===void 0?c:U,this},_t.prototype.clear=function(){this.__data__=[],this.size=0},_t.prototype.delete=function(k){var U=this.__data__,Y=Ln(U,k);return!(Y<0||(Y==U.length-1?U.pop():pt.call(U,Y,1),--this.size,0))},_t.prototype.get=function(k){var U=this.__data__,Y=Ln(U,k);return Y<0?void 0:U[Y][1]},_t.prototype.has=function(k){return Ln(this.__data__,k)>-1},_t.prototype.set=function(k,U){var Y=this.__data__,ie=Ln(Y,k);return ie<0?(++this.size,Y.push([k,U])):Y[ie][1]=U,this},Et.prototype.clear=function(){this.size=0,this.__data__={hash:new Dt,map:new(je||_t),string:new Dt}},Et.prototype.delete=function(k){var U=Vt(this,k).delete(k);return this.size-=U?1:0,U},Et.prototype.get=function(k){return Vt(this,k).get(k)},Et.prototype.has=function(k){return Vt(this,k).has(k)},Et.prototype.set=function(k,U){var Y=Vt(this,k),ie=Y.size;return Y.set(k,U),this.size+=Y.size==ie?0:1,this},_n.prototype.add=_n.prototype.push=function(k){return this.__data__.set(k,c),this},_n.prototype.has=function(k){return this.__data__.has(k)},Bt.prototype.clear=function(){this.__data__=new _t,this.size=0},Bt.prototype.delete=function(k){var U=this.__data__,Y=U.delete(k);return this.size=U.size,Y},Bt.prototype.get=function(k){return this.__data__.get(k)},Bt.prototype.has=function(k){return this.__data__.has(k)},Bt.prototype.set=function(k,U){var Y=this.__data__;if(Y instanceof _t){var ie=Y.__data__;if(!je||ie.length<199)return ie.push([k,U]),this.size=++Y.size,this;Y=this.__data__=new Et(ie)}return Y.set(k,U),this.size=Y.size,this};var On=Ue?function(k){return k==null?[]:(k=Object(k),(function(U,Y){for(var ie=-1,Ve=U==null?0:U.length,Ce=0,_=[];++ie<Ve;){var W=U[ie];z=W,kt.call(k,z)&&(_[Ce++]=W)}var z;return _})(Ue(k)))}:function(){return[]},zt=En;function kn(k,U){return!!(U=U??f)&&(typeof k=="number"||P.test(k))&&k>-1&&k%1==0&&k<U}function Je(k){if(k!=null){try{return Ne.call(k)}catch{}try{return k+""}catch{}}return""}function pr(k,U){return k===U||k!=k&&U!=U}(Xe&&zt(new Xe(new ArrayBuffer(1)))!=H||je&&zt(new je)!=E||yt&&zt(yt.resolve())!=A||Ye&&zt(new Ye)!=T||ur&&zt(new ur)!=$)&&(zt=function(k){var U=En(k),Y=U==p?k.constructor:void 0,ie=Y?Je(Y):"";if(ie)switch(ie){case Ts:return H;case hr:return E;case fr:return A;case Hr:return T;case Rn:return $}return U});var Qr=dr((function(){return arguments})())?dr:function(k){return Dn(k)&&we.call(k,"callee")&&!kt.call(k,"callee")},Sn=Array.isArray,hn=mt||function(){return!1};function Vr(k){if(!es(k))return!1;var U=En(k);return U==I||U=="[object GeneratorFunction]"||U=="[object AsyncFunction]"||U=="[object Proxy]"}function Qe(k){return typeof k=="number"&&k>-1&&k%1==0&&k<=f}function es(k){var U=typeof k;return k!=null&&(U=="object"||U=="function")}function Dn(k){return k!=null&&typeof k=="object"}var fn=re?(function(k){return function(U){return k(U)}})(re):function(k){return Dn(k)&&Qe(k.length)&&!!w[En(k)]};function ts(k){return(U=k)!=null&&Qe(U.length)&&!Vr(U)?(function(Y,ie){var Ve=Sn(Y),Ce=!Ve&&Qr(Y),_=!Ve&&!Ce&&hn(Y),W=!Ve&&!Ce&&!_&&fn(Y),z=Ve||Ce||_||W,te=z?(function(et,Le){for(var lt=-1,tt=Array(et);++lt<et;)tt[lt]=Le(lt);return tt})(Y.length,String):[],Ee=te.length;for(var We in Y)!we.call(Y,We)||z&&(We=="length"||_&&(We=="offset"||We=="parent")||W&&(We=="buffer"||We=="byteLength"||We=="byteOffset")||kn(We,Ee))||te.push(We);return te})(k):(function(Y){if(Ve=(ie=Y)&&ie.constructor,ie!==(typeof Ve=="function"&&Ve.prototype||he))return st(Y);var ie,Ve,Ce=[];for(var _ in Object(Y))we.call(Y,_)&&_!="constructor"&&Ce.push(_);return Ce})(k);var U}o.exports=function(k,U){return un(k,U)}},210:function(o,a,l){var c=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(a,"__esModule",{value:!0});var f,g=c(l(465)),h=c(l(307));(function(d){d.compose=function(m,v,I){m===void 0&&(m={}),v===void 0&&(v={}),typeof m!="object"&&(m={}),typeof v!="object"&&(v={});var E=g.default(v);for(var y in I||(E=Object.keys(E).reduce((function(p,A){return E[A]!=null&&(p[A]=E[A]),p}),{})),m)m[y]!==void 0&&v[y]===void 0&&(E[y]=m[y]);return Object.keys(E).length>0?E:void 0},d.diff=function(m,v){m===void 0&&(m={}),v===void 0&&(v={}),typeof m!="object"&&(m={}),typeof v!="object"&&(v={});var I=Object.keys(m).concat(Object.keys(v)).reduce((function(E,y){return h.default(m[y],v[y])||(E[y]=v[y]===void 0?null:v[y]),E}),{});return Object.keys(I).length>0?I:void 0},d.invert=function(m,v){m===void 0&&(m={}),v===void 0&&(v={}),m=m||{};var I=Object.keys(v).reduce((function(E,y){return v[y]!==m[y]&&m[y]!==void 0&&(E[y]=v[y]),E}),{});return Object.keys(m).reduce((function(E,y){return m[y]!==v[y]&&v[y]===void 0&&(E[y]=null),E}),I)},d.transform=function(m,v,I){if(I===void 0&&(I=!1),typeof m!="object")return v;if(typeof v=="object"){if(!I)return v;var E=Object.keys(v).reduce((function(y,p){return m[p]===void 0&&(y[p]=v[p]),y}),{});return Object.keys(E).length>0?E:void 0}}})(f||(f={})),a.default=f},895:function(o,a,l){var c=this&&this.__importDefault||function(E){return E&&E.__esModule?E:{default:E}},f=c(l(529)),g=c(l(465)),h=c(l(307)),d=c(l(210)),m=c(l(430)),v="\0",I=(function(){function E(y){Array.isArray(y)?this.ops=y:y!=null&&Array.isArray(y.ops)?this.ops=y.ops:this.ops=[]}return E.prototype.insert=function(y,p){var A={};return typeof y=="string"&&y.length===0?this:(A.insert=y,p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(A.attributes=p),this.push(A))},E.prototype.delete=function(y){return y<=0?this:this.push({delete:y})},E.prototype.retain=function(y,p){if(y<=0)return this;var A={retain:y};return p!=null&&typeof p=="object"&&Object.keys(p).length>0&&(A.attributes=p),this.push(A)},E.prototype.push=function(y){var p=this.ops.length,A=this.ops[p-1];if(y=g.default(y),typeof A=="object"){if(typeof y.delete=="number"&&typeof A.delete=="number")return this.ops[p-1]={delete:A.delete+y.delete},this;if(typeof A.delete=="number"&&y.insert!=null&&(p-=1,typeof(A=this.ops[p-1])!="object"))return this.ops.unshift(y),this;if(h.default(y.attributes,A.attributes)){if(typeof y.insert=="string"&&typeof A.insert=="string")return this.ops[p-1]={insert:A.insert+y.insert},typeof y.attributes=="object"&&(this.ops[p-1].attributes=y.attributes),this;if(typeof y.retain=="number"&&typeof A.retain=="number")return this.ops[p-1]={retain:A.retain+y.retain},typeof y.attributes=="object"&&(this.ops[p-1].attributes=y.attributes),this}}return p===this.ops.length?this.ops.push(y):this.ops.splice(p,0,y),this},E.prototype.chop=function(){var y=this.ops[this.ops.length-1];return y&&y.retain&&!y.attributes&&this.ops.pop(),this},E.prototype.filter=function(y){return this.ops.filter(y)},E.prototype.forEach=function(y){this.ops.forEach(y)},E.prototype.map=function(y){return this.ops.map(y)},E.prototype.partition=function(y){var p=[],A=[];return this.forEach((function(S){(y(S)?p:A).push(S)})),[p,A]},E.prototype.reduce=function(y,p){return this.ops.reduce(y,p)},E.prototype.changeLength=function(){return this.reduce((function(y,p){return p.insert?y+m.default.length(p):p.delete?y-p.delete:y}),0)},E.prototype.length=function(){return this.reduce((function(y,p){return y+m.default.length(p)}),0)},E.prototype.slice=function(y,p){y===void 0&&(y=0),p===void 0&&(p=1/0);for(var A=[],S=m.default.iterator(this.ops),T=0;T<p&&S.hasNext();){var B=void 0;T<y?B=S.next(y-T):(B=S.next(p-T),A.push(B)),T+=m.default.length(B)}return new E(A)},E.prototype.compose=function(y){var p=m.default.iterator(this.ops),A=m.default.iterator(y.ops),S=[],T=A.peek();if(T!=null&&typeof T.retain=="number"&&T.attributes==null){for(var B=T.retain;p.peekType()==="insert"&&p.peekLength()<=B;)B-=p.peekLength(),S.push(p.next());T.retain-B>0&&A.next(T.retain-B)}for(var $=new E(S);p.hasNext()||A.hasNext();)if(A.peekType()==="insert")$.push(A.next());else if(p.peekType()==="delete")$.push(p.next());else{var X=Math.min(p.peekLength(),A.peekLength()),H=p.next(X),N=A.next(X);if(typeof N.retain=="number"){var P={};typeof H.retain=="number"?P.retain=X:P.insert=H.insert;var w=d.default.compose(H.attributes,N.attributes,typeof H.retain=="number");if(w&&(P.attributes=w),$.push(P),!A.hasNext()&&h.default($.ops[$.ops.length-1],P)){var D=new E(p.rest());return $.concat(D).chop()}}else typeof N.delete=="number"&&typeof H.retain=="number"&&$.push(N)}return $.chop()},E.prototype.concat=function(y){var p=new E(this.ops.slice());return y.ops.length>0&&(p.push(y.ops[0]),p.ops=p.ops.concat(y.ops.slice(1))),p},E.prototype.diff=function(y,p){if(this.ops===y.ops)return new E;var A=[this,y].map((function(X){return X.map((function(H){if(H.insert!=null)return typeof H.insert=="string"?H.insert:v;throw new Error("diff() called "+(X===y?"on":"with")+" non-document")})).join("")})),S=new E,T=f.default(A[0],A[1],p),B=m.default.iterator(this.ops),$=m.default.iterator(y.ops);return T.forEach((function(X){for(var H=X[1].length;H>0;){var N=0;switch(X[0]){case f.default.INSERT:N=Math.min($.peekLength(),H),S.push($.next(N));break;case f.default.DELETE:N=Math.min(H,B.peekLength()),B.next(N),S.delete(N);break;case f.default.EQUAL:N=Math.min(B.peekLength(),$.peekLength(),H);var P=B.next(N),w=$.next(N);h.default(P.insert,w.insert)?S.retain(N,d.default.diff(P.attributes,w.attributes)):S.push(w).delete(N)}H-=N}})),S.chop()},E.prototype.eachLine=function(y,p){p===void 0&&(p=`
`);for(var A=m.default.iterator(this.ops),S=new E,T=0;A.hasNext();){if(A.peekType()!=="insert")return;var B=A.peek(),$=m.default.length(B)-A.peekLength(),X=typeof B.insert=="string"?B.insert.indexOf(p,$)-$:-1;if(X<0)S.push(A.next());else if(X>0)S.push(A.next(X));else{if(y(S,A.next(1).attributes||{},T)===!1)return;T+=1,S=new E}}S.length()>0&&y(S,{},T)},E.prototype.invert=function(y){var p=new E;return this.reduce((function(A,S){if(S.insert)p.delete(m.default.length(S));else{if(S.retain&&S.attributes==null)return p.retain(S.retain),A+S.retain;if(S.delete||S.retain&&S.attributes){var T=S.delete||S.retain;return y.slice(A,A+T).forEach((function(B){S.delete?p.push(B):S.retain&&S.attributes&&p.retain(m.default.length(B),d.default.invert(S.attributes,B.attributes))})),A+T}}return A}),0),p.chop()},E.prototype.transform=function(y,p){if(p===void 0&&(p=!1),p=!!p,typeof y=="number")return this.transformPosition(y,p);for(var A=y,S=m.default.iterator(this.ops),T=m.default.iterator(A.ops),B=new E;S.hasNext()||T.hasNext();)if(S.peekType()!=="insert"||!p&&T.peekType()==="insert")if(T.peekType()==="insert")B.push(T.next());else{var $=Math.min(S.peekLength(),T.peekLength()),X=S.next($),H=T.next($);if(X.delete)continue;H.delete?B.push(H):B.retain($,d.default.transform(X.attributes,H.attributes,p))}else B.retain(m.default.length(S.next()));return B.chop()},E.prototype.transformPosition=function(y,p){p===void 0&&(p=!1),p=!!p;for(var A=m.default.iterator(this.ops),S=0;A.hasNext()&&S<=y;){var T=A.peekLength(),B=A.peekType();A.next(),B!=="delete"?(B==="insert"&&(S<y||!p)&&(y+=T),S+=T):y-=Math.min(T,y-S)}return y},E.Op=m.default,E.AttributeMap=d.default,E})();o.exports=I},977:function(o,a,l){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(a,"__esModule",{value:!0});var f=c(l(430)),g=(function(){function h(d){this.ops=d,this.index=0,this.offset=0}return h.prototype.hasNext=function(){return this.peekLength()<1/0},h.prototype.next=function(d){d||(d=1/0);var m=this.ops[this.index];if(m){var v=this.offset,I=f.default.length(m);if(d>=I-v?(d=I-v,this.index+=1,this.offset=0):this.offset+=d,typeof m.delete=="number")return{delete:d};var E={};return m.attributes&&(E.attributes=m.attributes),typeof m.retain=="number"?E.retain=d:typeof m.insert=="string"?E.insert=m.insert.substr(v,d):E.insert=m.insert,E}return{retain:1/0}},h.prototype.peek=function(){return this.ops[this.index]},h.prototype.peekLength=function(){return this.ops[this.index]?f.default.length(this.ops[this.index])-this.offset:1/0},h.prototype.peekType=function(){return this.ops[this.index]?typeof this.ops[this.index].delete=="number"?"delete":typeof this.ops[this.index].retain=="number"?"retain":"insert":"retain"},h.prototype.rest=function(){if(this.hasNext()){if(this.offset===0)return this.ops.slice(this.index);var d=this.offset,m=this.index,v=this.next(),I=this.ops.slice(this.index);return this.offset=d,this.index=m,[v].concat(I)}return[]},h})();a.default=g},430:function(o,a,l){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(a,"__esModule",{value:!0});var f,g=c(l(977));(function(h){h.iterator=function(d){return new g.default(d)},h.length=function(d){return typeof d.delete=="number"?d.delete:typeof d.retain=="number"?d.retain:typeof d.insert=="string"?d.insert.length:1}})(f||(f={})),a.default=f},165:function(o,a,l){var c,f;(f=typeof(c=function(){var g,h={};function d(I,E,y){var p=I.getClientRects();if(p.length===2){var A=I.getBoundingClientRect();return p[E][y]<A[y]}return!1}function m(I){if(!I||screen.deviceXDPI===screen.logicalXDPI)return I;if("length"in I)return Array.prototype.map.call(I,m);var E=screen.deviceXDPI/screen.logicalXDPI;return{top:I.top/E,bottom:I.bottom/E,left:I.left/E,right:I.right/E,width:I.width/E,height:I.height/E}}function v(I,E){var y,p=0,A=1024;if(A>=E.length)return Array.prototype.push.apply(I,E);for(;p<E.length;)y=Array.prototype.push.apply(I,Array.prototype.slice.call(E,p,p+A)),p+=A;return y}return h.isBroken=function(){if(g===void 0){var I=document.createElement("p"),E=document.createElement("span"),y=document.createTextNode("aa"),p=document.createTextNode("aa"),A=document.createElement("img");A.setAttribute("src","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=");var S=document.createRange();if(g={},I.appendChild(y),I.appendChild(E),E.appendChild(A),E.appendChild(p),document.body.appendChild(I),S.setStart(y,1),S.setEnd(E,0),g.getClientRects=g.getBoundingClientRect=S.getClientRects().length>1,g.getClientRects||(S.setEnd(p,1),g.getClientRects=g.getBoundingClientRect=S.getClientRects().length===2),!g.getBoundingClientRect){S.setEnd(S.startContainer,S.startOffset);var T=S.getBoundingClientRect();g.getBoundingClientRect=T.top===0&&T.left===0}if(document.body.removeChild(I),!g.getBoundingClientRect){var B=document.createElement("p");B.style.width="0px",B.style.fontSize="20px",B.style.whiteSpace="normal",B.style.wordBreak="normal";var $=document.createTextNode("m mm");B.appendChild($),document.body.appendChild(B),S.setStart($,1),S.setEnd($,2),d(S,1,"left")?g.getBoundingClientRect=!0:(S.setStart($,1),S.setEnd($,3),d(S,0,"top")&&(g.getBoundingClientRect=!0)),document.body.removeChild(B)}var X=window.ActiveXObject&&new Function("/*@cc_on return @_jscript_version; @*/")();g.ieZoom=!!X&&X<=10}return g},h.getClientRects=function(I){var E=this.isBroken();if(E.ieZoom)return m(I.getClientRects());if(!E.getClientRects)return I.getClientRects();var y=[],p=[],A=I.endContainer,S=I.endOffset,T=document.createRange();function B($){for(var X=0;$=$.previousSibling;)X++;return X}for(;A!==I.commonAncestorContainer;)T.setStart(A,0),T.setEnd(A,S),v(p,T.getClientRects()),S=B(A),A=A.parentNode;return(T=I.cloneRange()).setEnd(A,S),v(y,T.getClientRects()),v(y,p),y},h.getBoundingClientRect=function(I){var E=this.getClientRects(I);if(E.length===0)return null;var y,p=I.getBoundingClientRect(),A=this.isBroken();if(A.ieZoom)return m(p);if(!A.getBoundingClientRect)return p;if(p.width===0&&p.height===0)return E[0];for(var S=0,T=E.length;S<T;S++){var B=E[S];y?(y.left=Math.min(y.left,B.left),y.top=Math.min(y.top,B.top),y.right=Math.max(y.right,B.right),y.bottom=Math.max(y.bottom,B.bottom)):y={left:B.left,top:B.top,right:B.right,bottom:B.bottom}}return y&&(y.width=y.right-y.left,y.height=y.bottom-y.top),y},h})=="function"?c.call(a,l,a,o):c)===void 0||(o.exports=f)},33:(o,a,l)=>{l.r(a),l.d(a,{default:()=>w});var c=(function(){if(typeof Map<"u")return Map;function D(O,R){var M=-1;return O.some((function(F,q){return F[0]===R&&(M=q,!0)})),M}return(function(){function O(){this.__entries__=[]}return Object.defineProperty(O.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),O.prototype.get=function(R){var M=D(this.__entries__,R),F=this.__entries__[M];return F&&F[1]},O.prototype.set=function(R,M){var F=D(this.__entries__,R);~F?this.__entries__[F][1]=M:this.__entries__.push([R,M])},O.prototype.delete=function(R){var M=this.__entries__,F=D(M,R);~F&&M.splice(F,1)},O.prototype.has=function(R){return!!~D(this.__entries__,R)},O.prototype.clear=function(){this.__entries__.splice(0)},O.prototype.forEach=function(R,M){M===void 0&&(M=null);for(var F=0,q=this.__entries__;F<q.length;F++){var K=q[F];R.call(M,K[1],K[0])}},O})()})(),f=typeof window<"u"&&typeof document<"u"&&window.document===document,g=l.g!==void 0&&l.g.Math===Math?l.g:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")(),h=typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(g):function(D){return setTimeout((function(){return D(Date.now())}),1e3/60)},d=["top","right","bottom","left","width","height","size","weight"],m=typeof MutationObserver<"u",v=(function(){function D(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=(function(O,R){var M=!1,F=!1,q=0;function K(){M&&(M=!1,O()),F&&re()}function oe(){h(K)}function re(){var J=Date.now();if(M){if(J-q<2)return;F=!0}else M=!0,F=!1,setTimeout(oe,20);q=J}return re})(this.refresh.bind(this))}return D.prototype.addObserver=function(O){~this.observers_.indexOf(O)||this.observers_.push(O),this.connected_||this.connect_()},D.prototype.removeObserver=function(O){var R=this.observers_,M=R.indexOf(O);~M&&R.splice(M,1),!R.length&&this.connected_&&this.disconnect_()},D.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},D.prototype.updateObservers_=function(){var O=this.observers_.filter((function(R){return R.gatherActive(),R.hasActive()}));return O.forEach((function(R){return R.broadcastActive()})),O.length>0},D.prototype.connect_=function(){f&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),m?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},D.prototype.disconnect_=function(){f&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},D.prototype.onTransitionEnd_=function(O){var R=O.propertyName,M=R===void 0?"":R;d.some((function(F){return!!~M.indexOf(F)}))&&this.refresh()},D.getInstance=function(){return this.instance_||(this.instance_=new D),this.instance_},D.instance_=null,D})(),I=function(D,O){for(var R=0,M=Object.keys(O);R<M.length;R++){var F=M[R];Object.defineProperty(D,F,{value:O[F],enumerable:!1,writable:!1,configurable:!0})}return D},E=function(D){return D&&D.ownerDocument&&D.ownerDocument.defaultView||g},y=B(0,0,0,0);function p(D){return parseFloat(D)||0}function A(D){for(var O=[],R=1;R<arguments.length;R++)O[R-1]=arguments[R];return O.reduce((function(M,F){return M+p(D["border-"+F+"-width"])}),0)}var S=typeof SVGGraphicsElement<"u"?function(D){return D instanceof E(D).SVGGraphicsElement}:function(D){return D instanceof E(D).SVGElement&&typeof D.getBBox=="function"};function T(D){return f?S(D)?(function(O){var R=O.getBBox();return B(0,0,R.width,R.height)})(D):(function(O){var R=O.clientWidth,M=O.clientHeight;if(!R&&!M)return y;var F=E(O).getComputedStyle(O),q=(function(ue){for(var ve={},Q=0,be=["top","right","bottom","left"];Q<be.length;Q++){var Ae=be[Q],he=ue["padding-"+Ae];ve[Ae]=p(he)}return ve})(F),K=q.left+q.right,oe=q.top+q.bottom,re=p(F.width),J=p(F.height);if(F.boxSizing==="border-box"&&(Math.round(re+K)!==R&&(re-=A(F,"left","right")+K),Math.round(J+oe)!==M&&(J-=A(F,"top","bottom")+oe)),!(function(ue){return ue===E(ue).document.documentElement})(O)){var Se=Math.round(re+K)-R,ne=Math.round(J+oe)-M;Math.abs(Se)!==1&&(re-=Se),Math.abs(ne)!==1&&(J-=ne)}return B(q.left,q.top,re,J)})(D):y}function B(D,O,R,M){return{x:D,y:O,width:R,height:M}}var $=(function(){function D(O){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=B(0,0,0,0),this.target=O}return D.prototype.isActive=function(){var O=T(this.target);return this.contentRect_=O,O.width!==this.broadcastWidth||O.height!==this.broadcastHeight},D.prototype.broadcastRect=function(){var O=this.contentRect_;return this.broadcastWidth=O.width,this.broadcastHeight=O.height,O},D})(),X=function(D,O){var R,M,F,q,K,oe,re,J=(M=(R=O).x,F=R.y,q=R.width,K=R.height,oe=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,re=Object.create(oe.prototype),I(re,{x:M,y:F,width:q,height:K,top:F,right:M+q,bottom:K+F,left:M}),re);I(this,{target:D,contentRect:J})},H=(function(){function D(O,R,M){if(this.activeObservations_=[],this.observations_=new c,typeof O!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=O,this.controller_=R,this.callbackCtx_=M}return D.prototype.observe=function(O){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(O instanceof E(O).Element))throw new TypeError('parameter 1 is not of type "Element".');var R=this.observations_;R.has(O)||(R.set(O,new $(O)),this.controller_.addObserver(this),this.controller_.refresh())}},D.prototype.unobserve=function(O){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(O instanceof E(O).Element))throw new TypeError('parameter 1 is not of type "Element".');var R=this.observations_;R.has(O)&&(R.delete(O),R.size||this.controller_.removeObserver(this))}},D.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},D.prototype.gatherActive=function(){var O=this;this.clearActive(),this.observations_.forEach((function(R){R.isActive()&&O.activeObservations_.push(R)}))},D.prototype.broadcastActive=function(){if(this.hasActive()){var O=this.callbackCtx_,R=this.activeObservations_.map((function(M){return new X(M.target,M.broadcastRect())}));this.callback_.call(O,R,O),this.clearActive()}},D.prototype.clearActive=function(){this.activeObservations_.splice(0)},D.prototype.hasActive=function(){return this.activeObservations_.length>0},D})(),N=typeof WeakMap<"u"?new WeakMap:new c,P=function D(O){if(!(this instanceof D))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var R=v.getInstance(),M=new H(O,R,this);N.set(this,M)};["observe","unobserve","disconnect"].forEach((function(D){P.prototype[D]=function(){var O;return(O=N.get(this))[D].apply(O,arguments)}}));const w=g.ResizeObserver!==void 0?g.ResizeObserver:P},413:(o,a,l)=>{l.r(a),l.d(a,{default:()=>B});var c=l(379),f=l.n(c),g=l(795),h=l.n(g),d=l(569),m=l.n(d),v=l(565),I=l.n(v),E=l(216),y=l.n(E),p=l(589),A=l.n(p),S=l(582),T={};T.styleTagTransform=A(),T.setAttributes=I(),T.insert=m().bind(null,"head"),T.domAPI=h(),T.insertStyleElement=y(),f()(S.Z,T);const B=S.Z&&S.Z.locals?S.Z.locals:void 0},379:o=>{var a=[];function l(g){for(var h=-1,d=0;d<a.length;d++)if(a[d].identifier===g){h=d;break}return h}function c(g,h){for(var d={},m=[],v=0;v<g.length;v++){var I=g[v],E=h.base?I[0]+h.base:I[0],y=d[E]||0,p="".concat(E," ").concat(y);d[E]=y+1;var A=l(p),S={css:I[1],media:I[2],sourceMap:I[3],supports:I[4],layer:I[5]};if(A!==-1)a[A].references++,a[A].updater(S);else{var T=f(S,h);h.byIndex=v,a.splice(v,0,{identifier:p,updater:T,references:1})}m.push(p)}return m}function f(g,h){var d=h.domAPI(h);return d.update(g),function(m){if(m){if(m.css===g.css&&m.media===g.media&&m.sourceMap===g.sourceMap&&m.supports===g.supports&&m.layer===g.layer)return;d.update(g=m)}else d.remove()}}o.exports=function(g,h){var d=c(g=g||[],h=h||{});return function(m){m=m||[];for(var v=0;v<d.length;v++){var I=l(d[v]);a[I].references--}for(var E=c(m,h),y=0;y<d.length;y++){var p=l(d[y]);a[p].references===0&&(a[p].updater(),a.splice(p,1))}d=E}}},569:o=>{var a={};o.exports=function(l,c){var f=(function(g){if(a[g]===void 0){var h=document.querySelector(g);if(window.HTMLIFrameElement&&h instanceof window.HTMLIFrameElement)try{h=h.contentDocument.head}catch{h=null}a[g]=h}return a[g]})(l);if(!f)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");f.appendChild(c)}},216:o=>{o.exports=function(a){var l=document.createElement("style");return a.setAttributes(l,a.attributes),a.insert(l,a.options),l}},565:(o,a,l)=>{o.exports=function(c){var f=l.nc;f&&c.setAttribute("nonce",f)}},795:o=>{o.exports=function(a){var l=a.insertStyleElement(a);return{update:function(c){(function(f,g,h){var d="";h.supports&&(d+="@supports (".concat(h.supports,") {")),h.media&&(d+="@media ".concat(h.media," {"));var m=h.layer!==void 0;m&&(d+="@layer".concat(h.layer.length>0?" ".concat(h.layer):""," {")),d+=h.css,m&&(d+="}"),h.media&&(d+="}"),h.supports&&(d+="}");var v=h.sourceMap;v&&typeof btoa<"u"&&(d+=`
/*# sourceMappingURL=data:application/json;base64,`.concat(btoa(unescape(encodeURIComponent(JSON.stringify(v))))," */")),g.styleTagTransform(d,f,g.options)})(l,a,c)},remove:function(){(function(c){if(c.parentNode===null)return!1;c.parentNode.removeChild(c)})(l)}}}},589:o=>{o.exports=function(a,l){if(l.styleSheet)l.styleSheet.cssText=a;else{for(;l.firstChild;)l.removeChild(l.firstChild);l.appendChild(document.createTextNode(a))}}},607:function(o,a,l){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(a,"__esModule",{value:!0}),a.Cursor=a.default=void 0;var f=c(l(678));a.default=f.default;var g=c(l(353));a.Cursor=g.default,l(413)},353:(o,a)=>{Object.defineProperty(a,"__esModule",{value:!0});var l=(function(){function c(f,g,h){this.id=f,this.name=g,this.color=h,this.toggleNearCursor=this.toggleNearCursor.bind(this),this._toggleOpenedCursor=this._toggleOpenedCursor.bind(this),this._setHoverState=this._setHoverState.bind(this)}return c.prototype.build=function(f){var g=document.createElement(c.CONTAINER_ELEMENT_TAG);g.classList.add(c.CURSOR_CLASS),g.id="ql-cursor-".concat(this.id),g.innerHTML=f.template;var h=g.getElementsByClassName(c.SELECTION_CLASS)[0],d=g.getElementsByClassName(c.CARET_CONTAINER_CLASS)[0],m=d.getElementsByClassName(c.CARET_CLASS)[0],v=g.getElementsByClassName(c.FLAG_CLASS)[0];return v.style.backgroundColor=this.color,m.style.backgroundColor=this.color,g.getElementsByClassName(c.NAME_CLASS)[0].textContent=this.name,this._hideDelay="".concat(f.hideDelayMs,"ms"),this._hideSpeedMs=f.hideSpeedMs,this._positionFlag=f.positionFlag,v.style.transitionDelay=this._hideDelay,v.style.transitionDuration="".concat(this._hideSpeedMs,"ms"),this._el=g,this._selectionEl=h,this._caretEl=d,this._flagEl=v,d.addEventListener("mouseover",this._setHoverState,{passive:!0}),this._el},c.prototype.show=function(){this._el.classList.remove(c.HIDDEN_CLASS)},c.prototype.hide=function(){this._el.classList.add(c.HIDDEN_CLASS)},c.prototype.remove=function(){this._el.parentNode.removeChild(this._el)},c.prototype.toggleNearCursor=function(f,g){var h=this._getCoordinates(),d=h.left,m=h.right,v=h.top,I=h.bottom,E=f>=d&&f<=m&&g>=v&&g<=I;return this._caretEl.classList.toggle(c.CONTAINER_HOVER_CLASS,E),E},c.prototype.toggleFlag=function(f){var g=this;this._caretEl.classList.toggle(c.CONTAINER_HOVER_CLASS,f)||(this._flagEl.classList.add(c.NO_DELAY_CLASS),setTimeout((function(){return g._flagEl.classList.remove(c.NO_DELAY_CLASS)}),this._hideSpeedMs))},c.prototype.updateCaret=function(f,g){this._caretEl.style.top="".concat(f.top,"px"),this._caretEl.style.left="".concat(f.left,"px"),this._caretEl.style.height="".concat(f.height,"px"),this._positionFlag?this._positionFlag(this._flagEl,f,g):this._updateCaretFlag(f,g)},c.prototype.updateSelection=function(f,g){var h=this;this._clearSelection(),f=f||[],f=Array.from(f),f=this._sanitize(f),(f=this._sortByDomPosition(f)).forEach((function(d){return h._addSelection(d,g)}))},c.prototype._setHoverState=function(){document.addEventListener("mousemove",this._toggleOpenedCursor,{passive:!0})},c.prototype._toggleOpenedCursor=function(f){var g=this.toggleNearCursor(f.clientX,f.clientY);this._caretEl.classList.toggle(c.CONTAINER_NO_POINTER_CLASS,g),g||document.removeEventListener("mousemove",this._toggleOpenedCursor)},c.prototype._getCoordinates=function(){return this._caretEl.getBoundingClientRect()},c.prototype._updateCaretFlag=function(f,g){this._flagEl.style.width="";var h=this._flagEl.getBoundingClientRect();this._flagEl.classList.remove(c.FLAG_FLIPPED_CLASS),f.left>g.width-h.width&&this._flagEl.classList.add(c.FLAG_FLIPPED_CLASS),this._flagEl.style.left="".concat(f.left,"px"),this._flagEl.style.top="".concat(f.top,"px"),this._flagEl.style.width="".concat(Math.ceil(h.width),"px")},c.prototype._clearSelection=function(){this._selectionEl.innerHTML=""},c.prototype._addSelection=function(f,g){var h=this._selectionBlock(f,g);this._selectionEl.appendChild(h)},c.prototype._selectionBlock=function(f,g){var h=document.createElement(c.SELECTION_ELEMENT_TAG);return h.classList.add(c.SELECTION_BLOCK_CLASS),h.style.top="".concat(f.top-g.top,"px"),h.style.left="".concat(f.left-g.left,"px"),h.style.width="".concat(f.width,"px"),h.style.height="".concat(f.height,"px"),h.style.backgroundColor=this.color,h.style.opacity="0.3",h},c.prototype._sortByDomPosition=function(f){return f.sort((function(g,h){return g.top===h.top?g.left-h.left:g.top-h.top}))},c.prototype._sanitize=function(f){var g=this,h=new Set;return f.filter((function(d){if(!d.width||!d.height)return!1;var m=g._serialize(d);return!h.has(m)&&(h.add(m),!0)}))},c.prototype._serialize=function(f){return["top:".concat(f.top),"right:".concat(f.right),"bottom:".concat(f.bottom),"left:".concat(f.left)].join(";")},c.CONTAINER_ELEMENT_TAG="SPAN",c.SELECTION_ELEMENT_TAG="SPAN",c.CURSOR_CLASS="ql-cursor",c.SELECTION_CLASS="ql-cursor-selections",c.SELECTION_BLOCK_CLASS="ql-cursor-selection-block",c.CARET_CLASS="ql-cursor-caret",c.CARET_CONTAINER_CLASS="ql-cursor-caret-container",c.CONTAINER_HOVER_CLASS="hover",c.CONTAINER_NO_POINTER_CLASS="no-pointer",c.FLAG_CLASS="ql-cursor-flag",c.FLAG_FLIPPED_CLASS="flag-flipped",c.NAME_CLASS="ql-cursor-name",c.HIDDEN_CLASS="hidden",c.NO_DELAY_CLASS="no-delay",c})();a.default=l},678:function(o,a,l){var c=this&&this.__createBinding||(Object.create?function(p,A,S,T){T===void 0&&(T=S);var B=Object.getOwnPropertyDescriptor(A,S);B&&!("get"in B?!A.__esModule:B.writable||B.configurable)||(B={enumerable:!0,get:function(){return A[S]}}),Object.defineProperty(p,T,B)}:function(p,A,S,T){T===void 0&&(T=S),p[T]=A[S]}),f=this&&this.__setModuleDefault||(Object.create?function(p,A){Object.defineProperty(p,"default",{enumerable:!0,value:A})}:function(p,A){p.default=A}),g=this&&this.__importStar||function(p){if(p&&p.__esModule)return p;var A={};if(p!=null)for(var S in p)S!=="default"&&Object.prototype.hasOwnProperty.call(p,S)&&c(A,p,S);return f(A,p),A},h=this&&this.__importDefault||function(p){return p&&p.__esModule?p:{default:p}};Object.defineProperty(a,"__esModule",{value:!0});var d=h(l(353)),m=g(l(165)),v=h(l(338)),I=h(l(33)),E=l(895),y=(function(){function p(A,S){S===void 0&&(S={}),this._cursors={},this._isObserving=!1,this._handleCursorTouch=this._handleCursorTouch.bind(this),this.quill=A,this.options=this._setDefaults(S),this._container=this.quill.addContainer(this.options.containerClass),this._boundsContainer=this.options.boundsContainer||this.quill.container,this._currentSelection=this.quill.getSelection(),this._registerSelectionChangeListeners(),this._registerTextChangeListener(),this._registerDomListeners()}return p.prototype.createCursor=function(A,S,T){var B=this._cursors[A];if(!B){B=new d.default(A,S,T),this._cursors[A]=B;var $=B.build(this.options);this._container.appendChild($)}return B},p.prototype.moveCursor=function(A,S){var T=this._cursors[A];T&&(T.range=S,this._updateCursor(T))},p.prototype.removeCursor=function(A){var S=this._cursors[A];S&&(S.remove(),delete this._cursors[A])},p.prototype.update=function(){var A=this;this.cursors().forEach((function(S){return A._updateCursor(S)}))},p.prototype.clearCursors=function(){var A=this;this.cursors().forEach((function(S){return A.removeCursor(S.id)}))},p.prototype.toggleFlag=function(A,S){var T=this._cursors[A];T&&T.toggleFlag(S)},p.prototype.cursors=function(){var A=this;return Object.keys(this._cursors).map((function(S){return A._cursors[S]}))},p.prototype._registerSelectionChangeListeners=function(){var A=this;this.quill.on(this.quill.constructor.events.SELECTION_CHANGE,(function(S){A._currentSelection=S}))},p.prototype._registerTextChangeListener=function(){var A=this;this.quill.on(this.quill.constructor.events.TEXT_CHANGE,(function(S){return A._handleTextChange(S)}))},p.prototype._registerDomListeners=function(){var A=this,S=this.quill.container.getElementsByClassName("ql-editor")[0];S.addEventListener("scroll",(function(){return A.update()}),{passive:!0}),S.addEventListener("touchstart",this._handleCursorTouch,{passive:!0})},p.prototype._handleCursorTouch=function(A){var S=this;this.cursors().forEach((function(T){T.toggleNearCursor(A.pageX,A.pageY),setTimeout((function(){return T.toggleFlag(!1)}),S.options.hideDelayMs)}))},p.prototype._registerResizeObserver=function(){var A=this;if(!this._isObserving){var S=this.quill.container.getElementsByClassName("ql-editor")[0],T=new I.default((function(B){if(!B[0].target.isConnected)return T.disconnect(),void(A._isObserving=!1);A.update()}));T.observe(S),this._isObserving=!0}},p.prototype._updateCursor=function(A){if(this._registerResizeObserver(),!A.range)return A.hide();var S=this._indexWithinQuillBounds(A.range.index),T=this._indexWithinQuillBounds(A.range.index+A.range.length),B=this.quill.getLeaf(S),$=this.quill.getLeaf(T);if(!this._leafIsValid(B)||!this._leafIsValid($))return A.hide();A.show();var X=this._boundsContainer.getBoundingClientRect(),H=this.quill.getBounds(T);A.updateCaret(H,X);var N=this._lineRanges(A,B,$).reduce((function(P,w){return P.concat(Array.from(m.getClientRects(w)))}),[]);A.updateSelection(N,X)},p.prototype._indexWithinQuillBounds=function(A){var S=this.quill.getLength(),T=S?S-1:0;return A=Math.max(A,0),Math.min(A,T)},p.prototype._leafIsValid=function(A){return A&&A[0]&&A[0].domNode&&A[1]>=0},p.prototype._handleTextChange=function(A){var S=this;window.setTimeout((function(){S.options.transformOnTextChange&&S._transformCursors(A),S.options.selectionChangeSource&&(S._emitSelection(),S.update())}))},p.prototype._emitSelection=function(){this.quill.emitter.emit(this.quill.constructor.events.SELECTION_CHANGE,this.quill.getSelection(),this._currentSelection,this.options.selectionChangeSource)},p.prototype._setDefaults=function(A){return(A=Object.assign({},A)).template||(A.template=p.DEFAULTS.template),A.containerClass||(A.containerClass=p.DEFAULTS.containerClass),A.selectionChangeSource!==null&&(A.selectionChangeSource||(A.selectionChangeSource=p.DEFAULTS.selectionChangeSource)),A.hideDelayMs=Number.isInteger(A.hideDelayMs)?A.hideDelayMs:p.DEFAULTS.hideDelayMs,A.hideSpeedMs=Number.isInteger(A.hideSpeedMs)?A.hideSpeedMs:p.DEFAULTS.hideSpeedMs,A.transformOnTextChange=!!A.transformOnTextChange,A},p.prototype._lineRanges=function(A,S,T){var B=this.quill.getLines(A.range);return B.reduce((function($,X,H){if(!X.children){var N=document.createRange();return N.selectNode(X.domNode),$.concat(N)}var P=H===0?S:X.path(0).pop(),w=P[0],D=P[1],O=H===B.length-1?T:X.path(X.length()-1).pop(),R=O[0],M=O[1],F=document.createRange();return w.domNode.nodeType===Node.TEXT_NODE?F.setStart(w.domNode,D):F.setStartBefore(w.domNode),R.domNode.nodeType===Node.TEXT_NODE?F.setEnd(R.domNode,M):F.setEndAfter(R.domNode),$.concat(F)}),[])},p.prototype._transformCursors=function(A){var S=this;A=new E(A),this.cursors().filter((function(T){return T.range})).forEach((function(T){T.range.index=A.transformPosition(T.range.index),S._updateCursor(T)}))},p.DEFAULTS={template:v.default,containerClass:"ql-cursors",selectionChangeSource:"api",hideDelayMs:3e3,hideSpeedMs:400},p})();a.default=y},338:function(o,a,l){var c=this&&this.__importDefault||function(h){return h&&h.__esModule?h:{default:h}};Object.defineProperty(a,"__esModule",{value:!0});var f=c(l(353)),g=`
  <span class="`.concat(f.default.SELECTION_CLASS,`"></span>
  <span class="`).concat(f.default.CARET_CONTAINER_CLASS,`">
    <span class="`).concat(f.default.CARET_CLASS,`"></span>
  </span>
  <div class="`).concat(f.default.FLAG_CLASS,`">
    <small class="`).concat(f.default.NAME_CLASS,`"></small>
  </div>
`);a.default=g}},r={};function s(o){var a=r[o];if(a!==void 0)return a.exports;var l=r[o]={id:o,loaded:!1,exports:{}};return t[o].call(l.exports,l,l.exports,s),l.loaded=!0,l.exports}s.n=o=>{var a=o&&o.__esModule?()=>o.default:()=>o;return s.d(a,{a}),a},s.d=(o,a)=>{for(var l in a)s.o(a,l)&&!s.o(o,l)&&Object.defineProperty(o,l,{enumerable:!0,get:a[l]})},s.g=(function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}})(),s.o=(o,a)=>Object.prototype.hasOwnProperty.call(o,a),s.r=o=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.nmd=o=>(o.paths=[],o.children||(o.children=[]),o),s.nc=void 0;var i=s(607);return i.default})()))})(vl)),vl.exports}var Mw=Pw();const Uw=qc(Mw),Ds={isOnline:!1,showOffline:n=>{Ds.isOnline=!1,n.innerHTML='<span class="red"> </span>'},showOnline:n=>{Ds.isOnline=!0,n.innerHTML='<span class="green"> </span>'},statusListener:n=>e=>{Ds.isOnline&&e.value==bi.Disconnected?Ds.showOffline(n):!Ds.isOnline&&e.value==bi.Connected&&Ds.showOnline(n)}};function Ww(n,e,t){const r=[];for(const{clientID:s,presence:i}of e)r.push(t===s?`<b>${i.username}</b>`:i.username);n.innerHTML=JSON.stringify(r)}const Fw=document.getElementById("peers"),Zw=document.getElementById("network-status"),Gw=new Dv,$w=new URLSearchParams(window.location.search),Bf=$w.get("key")||`vanilla-quill-${new Date().toISOString().substring(0,10).replace(/-/g,"")}`;function Vf(n){if(!n)return;const e={};let t=!1;for(const[r,s]of Object.entries(n))s!==null&&(e[r]=s,t=!0);return t?e:void 0}function Al(n,e=!1){const{embed:t,...r}=n.attributes??{};return t?{insert:JSON.parse(t.toString()),attributes:e?Vf(r):r}:{insert:n.content||"",attributes:e?Vf(n.attributes):n.attributes}}async function Kw(){const n=new sl.Client({rpcAddr:"https://api.yorkie.dev",apiKey:"D6sd9E5ehtXBssmeRZ4QQP"});await n.activate();const e=new sl.Document(Bf,{enableDevtools:!0});e.subscribe("connection",g=>{Ds.statusListener(Zw)(g)}),e.subscribe("presence",g=>{g.type!==It.PresenceChanged&&Ww(Fw,e.getPresences(),n.getID())}),await n.attach(e,{initialPresence:{username:n.getID().slice(-2),color:Gw.hex(n.getID().slice(-2)),selection:void 0}}),console.log(`%c Document Key: ${Bf}`,"color: orange; font-weight: bold;"),e.update(g=>{g.content||(g.content=new sl.Text,g.content.edit(0,0,`
`))},"create content if not exists"),e.subscribe(g=>{g.type==="snapshot"&&f()}),e.subscribe("$.content",g=>{g.type==="remote-change"&&c(g.value.operations),r()}),e.subscribe("others",g=>{g.type===It.Unwatched?o.removeCursor(g.value.clientID):g.type===It.PresenceChanged&&t(g.value)});function t(g){const{clientID:h,presence:d}=g;if(h===n.getID()||!d)return;const{username:m,color:v,selection:I}=d;if(!I)return;const E=e.getRoot().content.posRangeToIndexRange(I);o.createCursor(h,m,v),o.moveCursor(h,{index:E[0],length:E[1]-E[0]})}function r(){for(const g of e.getPresences())t(g)}await n.sync();let s=!1;G.register("modules/cursors",Uw);const i=new G("#editor",{modules:{toolbar:{container:[["bold","italic","underline"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],["blockquote","code-block"],["image","video"],["clean"]],handlers:{image:a}},cursors:!0},theme:"snow"}),o=i.getModule("cursors");function a(){const g=document.createElement("input");g.setAttribute("type","file"),g.setAttribute("accept","image/*"),g.click(),g.onchange=()=>{const h=g.files?.[0];if(!h)return;const d=1*1024*1024;if(h.size>d){alert(`Image size is too large. (Max: 1MB)
Current file size: ${(h.size/1024/1024).toFixed(2)}MB`);return}const m=new FileReader;m.onload=v=>{const I=i.getSelection(!0),E=v.target?.result;i.insertEmbed(I.index,"image",E,"user"),i.setSelection(I.index+1,0,"silent")},m.readAsDataURL(h)}}const l=i.root;l.addEventListener("compositionstart",()=>{s=!0}),l.addEventListener("compositionend",()=>{s=!1}),i.on("text-change",(g,h,d)=>{if(d==="api"||!g.ops)return;let m=0,v=0;console.log(`%c quill: ${JSON.stringify(g.ops)}`,"color: green"),e.update((I,E)=>{for(const y of g.ops)if(y.attributes!==void 0||y.insert!==void 0){y.retain!==void 0&&typeof y.retain=="number"&&(v=m+y.retain),console.log(`%c local: ${m}-${v}: ${y.insert} ${y.attributes?JSON.stringify(y.attributes):"{}"}`,"color: green");let p;y.attributes!==void 0&&y.insert===void 0?(I.content.setStyle(m,v,y.attributes),m=v):y.insert!==void 0&&(v<m&&(v=m),typeof y.insert=="object"?p=I.content.edit(m,v," ",{embed:JSON.stringify(y.insert),...y.attributes}):p=I.content.edit(m,v,y.insert,y.attributes),m=v+(typeof y.insert=="string"?y.insert.length:1),v=m),p&&E.set({selection:I.content.indexRangeToPosRange(p)})}else if(y.delete!==void 0){v=m+y.delete,console.log(`%c local: ${m}-${v}: ''`,"color: green");const p=I.content.edit(m,v,"");p&&E.set({selection:I.content.indexRangeToPosRange(p)}),v=m}else y.retain!==void 0&&typeof y.retain=="number"&&(m+=y.retain,v=m)})}).on("selection-change",(g,h,d)=>{if(g&&!s){if(d==="api"){const{selection:m}=e.getMyPresence();if(m){const[v,I]=e.getRoot().content.posRangeToIndexRange(m),{index:E,length:y}=g;if(v===E&&I===E+y)return}}e.update((m,v)=>{v.set({selection:m.content.indexRangeToPosRange([g.index,g.index+g.length])})},`update selection by ${n.getID()}`)}}),document.addEventListener("mouseup",()=>{if(s)return;const g=i.getSelection();g&&e.update((h,d)=>{d.set({selection:h.content.indexRangeToPosRange([g.index,g.index+g.length])})},`update selection by ${n.getID()}`)});function c(g){for(const h of g)if(h.type==="edit"){const d=h.from,m=h.to,{insert:v,attributes:I}=Al(h.value,!0);console.log(`%c remote: ${d}-${m}: ${v}`,"color: skyblue");const E=[];d>0&&E.push({retain:d});const y=m-d;if(y>0&&E.push({delete:y}),v){const p={insert:v};I&&(p.attributes=I),E.push(p)}if(E.length>0){console.log(`%c to quill: ${JSON.stringify(E)}`,"color: green");const p=new le(E);i.updateContents(p,"api")}}else if(h.type==="style"){const d=h.from,m=h.to,{attributes:v}=Al(h.value,!1);if(console.log(`%c remote: ${d}-${m}: ${JSON.stringify(v)}`,"color: skyblue"),v){const I=[];d>0&&I.push({retain:d});const E={attributes:v},y=m-d;y>0&&(E.retain=y),I.push(E),console.log(`%c to quill: ${JSON.stringify(I)}`,"color: green");const p=new le(I);i.updateContents(p,"api")}}}function f(){const g=e.getRoot().content,h=new le(g.values().map(d=>Al(d,!0)));i.setContents(h,"api")}f(),r()}Kw()});export default jw();
